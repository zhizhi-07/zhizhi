# 小程序功能说明

## 概述

在发现页面新增了"小程序"入口，目前包含两个互动性小程序：

1. **火花时刻** - 记录与AI的美好互动瞬间
2. **热梗库** - 浏览和管理流行热梗

---

## 1. 火花时刻

### 功能介绍

火花时刻会自动记录你与AI聊天过程中的高光时刻，通过分析对话内容和情感强度，捕捉那些让人心动的瞬间。

### 主要功能

#### 统计概览
- **总时刻数**: 显示记录的所有火花时刻数量
- **平均强度**: 所有火花时刻的平均情感强度
- **最活跃**: 产生最多火花时刻的联系人

#### 筛选功能
- **按联系人筛选**: 查看与特定AI的火花时刻
- **按时间排序**: 查看最新的火花时刻
- **按强度排序**: 查看情感最强烈的时刻

#### 火花强度等级
- **强烈** (80-100): 非常动人的时刻
- **明显** (60-79): 明显的情感波动
- **微弱** (40-59): 温暖的小瞬间
- **淡淡** (0-39): 轻微的情感涟漪

#### 时刻分类
- **聊天**: 对话中的火花
- **朋友圈**: 朋友圈互动产生的火花
- **通话**: 语音/视频通话的火花
- **礼物**: 收发礼物的火花

### 自动记录机制

系统会自动分析以下因素来计算火花强度：

1. **关键词检测**: 识别情感关键词（喜欢、爱、想你、开心等）
2. **表情符号**: 检测爱心、亲吻等情感符号
3. **消息长度**: 长消息表示更多投入
4. **标点符号**: 感叹号和问号反映情绪强度

只有强度达到30以上的时刻才会被记录，避免数据过多。

### 技术实现

- 文件位置: `src/pages/SparkMoments.tsx`
- 工具函数: `src/utils/sparkMoments.ts`
- 存储方式: localStorage (`spark_moments`)
- 最大记录数: 500条（自动保留最新的）

---

## 2. 热梗库

### 功能介绍

热梗库收录了117+个流行网络热梗，帮助AI更自然地使用当下流行的表达方式。支持浏览、搜索、添加自定义热梗。

### 主要功能

#### 搜索功能
- 支持搜索热梗内容、含义、关键词
- 实时过滤结果
- 一键清空搜索

#### 分类筛选
- 自动提取热梗关键词作为分类
- 快速切换不同类别
- 显示"全部"选项

#### 最常使用
- 显示使用频率最高的5个热梗
- 实时统计使用次数
- 渐变色卡片突出显示

#### 热梗详情
每个热梗卡片包含：
- **热梗内容**: 梗的具体表达
- **含义说明**: 梗的意思和使用场景
- **关键词标签**: 相关的触发关键词
- **使用次数**: 该梗被AI使用的次数

#### 自定义热梗
- **添加**: 点击右上角"+"添加自定义热梗
- **编辑**: 填写热梗内容、含义、关键词
- **删除**: 自定义热梗可以删除
- **标识**: 自定义热梗带有"自定义"标签

### 使用统计

系统会自动追踪AI使用热梗的情况：
- 记录每个热梗的使用次数
- 记录最后使用时间
- 生成使用排行榜

### 技术实现

- 文件位置: `src/pages/MemesLibrary.tsx`
- 热梗数据: `src/utils/memesRetrieval.ts`
- 使用追踪: `src/utils/memeUsageTracker.ts`
- 存储方式: 
  - 自定义热梗: localStorage (`custom_memes`)
  - 使用记录: localStorage (`meme_usages`)

---

## 访问路径

### 通过发现页面
1. 打开微信
2. 点击底部"发现"标签
3. 点击"小程序"
4. 选择要使用的小程序

### 直接访问
- 火花时刻: `/spark-moments`
- 热梗库: `/memes-library`
- 小程序列表: `/mini-programs`

---

## UI设计

### 设计风格
- **液态玻璃效果**: 使用 `glass-card` 和 `glass-effect` 类
- **白色主题**: 干净简洁的白色背景
- **无emoji**: 界面文字不使用emoji（仅在数据内容中使用）
- **iOS风格**: 采用iOS风格的交互和动画

### 颜色方案
- 主色调: 蓝色 (#3B82F6)
- 火花强度:
  - 强烈: 红色 (#EF4444)
  - 明显: 橙色 (#F97316)
  - 微弱: 黄色 (#EAB308)
  - 淡淡: 蓝色 (#3B82F6)
- 热梗分类: 蓝色标签
- 自定义标识: 绿色标签

---

## 数据管理

### 火花时刻
```typescript
interface SparkMoment {
  id: string
  contactId: string
  contactName: string
  contactAvatar: string
  content: string
  intensity: number // 0-100
  timestamp: number
  category: 'chat' | 'moments' | 'call' | 'gift'
}
```

### 热梗数据
```typescript
interface Meme {
  id: number
  梗: string
  含义: string
  keywords: string[]
}
```

### 使用记录
```typescript
interface MemeUsage {
  memeId: number
  count: number
  lastUsed: number
}
```

---

## 测试数据

如需测试功能，可以在浏览器控制台运行：

```javascript
// 导入测试数据初始化函数
import { initAllTestData } from './utils/initTestData'

// 初始化测试数据
initAllTestData()
```

这会创建一些示例火花时刻和热梗使用记录。

---

## 未来扩展

可以考虑添加的功能：
- 火花时刻导出/分享
- 热梗收藏功能
- 热梗使用趋势图表
- 火花时刻时间线视图
- 更多互动性小程序

---

## 技术栈

- React 18
- TypeScript
- React Router
- TailwindCSS
- LocalStorage API

---

## 注意事项

1. 所有数据存储在浏览器 localStorage 中
2. 清除浏览器数据会丢失所有记录
3. 火花时刻最多保存500条
4. 自定义热梗与系统热梗分开存储
5. 使用统计实时更新
