# ğŸº æç¤ºè¯æ¨¡æ¿ç³»ç»Ÿ - é…’é¦†ç©å®¶ç¦åˆ©

## âœ¨ åŠŸèƒ½å®Œæˆï¼

ç°åœ¨ä½ çš„é¡¹ç›®å®Œå…¨æ”¯æŒ**é…’é¦†é£æ ¼çš„å˜é‡æ›¿æ¢ç³»ç»Ÿ**äº†ï¼

---

## ğŸ¯ ä¸»è¦åŠŸèƒ½

### 1. **å˜é‡æ›¿æ¢å¼•æ“**

æ”¯æŒä»¥ä¸‹å˜é‡ï¼š

| å˜é‡ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `{{char}}` | è§’è‰²å | "æ±æ±" |
| `{{user}}` | ç”¨æˆ·å | "ç”¨æˆ·" |
| `{{description}}` | è§’è‰²æè¿° | å®Œæ•´çš„äººè®¾æè¿° |
| `{{personality}}` | æ€§æ ¼ | "æ´»æ³¼å¼€æœ—" |
| `{{scenario}}` | åœºæ™¯è®¾å®š | "åœ¨å­¦æ ¡é£Ÿå ‚" |
| `{{exampleMessages}}` | ç¤ºä¾‹å¯¹è¯ | è§’è‰²è¯´è¯é£æ ¼çš„ç¤ºä¾‹ |
| `{{systemPrompt}}` | ç³»ç»Ÿæç¤ºè¯ | è‡ªå®šä¹‰ç³»ç»ŸæŒ‡ä»¤ |
| `{{history}}` | å†å²å¯¹è¯ | æœ€è¿‘çš„èŠå¤©è®°å½• |
| `{{message}}` | å½“å‰æ¶ˆæ¯ | ç”¨æˆ·åˆšå‘çš„æ¶ˆæ¯ |
| `{{date}}` | å½“å‰æ—¥æœŸ | "2024å¹´10æœˆ24æ—¥ æ˜ŸæœŸå››" |
| `{{time}}` | å½“å‰æ—¶é—´ | "14:30" |
| `{{timeOfDay}}` | æ—¶æ®µ | "ä¸‹åˆ" |

### 2. **6ä¸ªé¢„è®¾æ¨¡æ¿**

- **é»˜è®¤æ¨¡æ¿** - é€‚åˆæ—¥å¸¸èŠå¤©
- **Character Card æ ‡å‡†** - V2æ ¼å¼æ ‡å‡†æ¨¡æ¿
- **è§’è‰²æ‰®æ¼”å¼ºåŒ–** - å¼ºè°ƒè§’è‰²æ²‰æµ¸æ„Ÿ
- **ç®€æ´æ¨¡æ¿** - æœ€å°åŒ–æç¤ºè¯
- **å°è¯´é£æ ¼** - é€‚åˆæ•…äº‹åˆ›ä½œ
- **SillyTavern** - é…’é¦†æ ‡å‡†æ ¼å¼

### 3. **è‡ªå®šä¹‰æ¨¡æ¿ç¼–è¾‘å™¨**

- ğŸ“ å¯è§†åŒ–ç¼–è¾‘
- ğŸ‘€ å®æ—¶é¢„è§ˆ
- ğŸ’¾ ä¿å­˜åˆ°è§’è‰²
- ğŸ“± ç§»åŠ¨ç«¯é€‚é…

---

## ğŸ“– ä½¿ç”¨æ–¹æ³•

### å¿«é€Ÿå¼€å§‹

1. **è¿›å…¥èŠå¤©è®¾ç½®**
   - æ‰“å¼€ä»»æ„èŠå¤©
   - ç‚¹å‡»å³ä¸Šè§’è®¾ç½®æŒ‰é’®
   - å‘ä¸‹æ»šåŠ¨æ‰¾åˆ° "æç¤ºè¯æ¨¡æ¿" ğŸºé…’é¦†

2. **é€‰æ‹©é¢„è®¾æ¨¡æ¿**
   - ç‚¹å‡»"ç¼–è¾‘æç¤ºè¯æ¨¡æ¿"
   - æµè§ˆ6ä¸ªé¢„è®¾æ¨¡æ¿
   - é€‰æ‹©ä¸€ä¸ªé€‚åˆä½ çš„

3. **è‡ªå®šä¹‰æ¨¡æ¿ï¼ˆå¯é€‰ï¼‰**
   - æ‰“å¼€"è‡ªå®šä¹‰æ¨¡æ¿"å¼€å…³
   - ä½¿ç”¨å˜é‡ `{{å˜é‡å}}` ç¼–è¾‘
   - ç‚¹å‡»"æŸ¥çœ‹é¢„è§ˆ"æ£€æŸ¥æ•ˆæœ
   - ä¿å­˜

### è¿›é˜¶ä½¿ç”¨

#### ç¤ºä¾‹ï¼šåˆ›å»ºå°è¯´é£æ ¼æ¨¡æ¿

```
ã€æ•…äº‹èƒŒæ™¯ã€‘
{{scenario}}

ã€è§’è‰²è®¾å®šã€‘
å§“åï¼š{{char}}
æ€§æ ¼ï¼š{{personality}}
æè¿°ï¼š{{description}}

ã€æ—¶é—´ã€‘{{date}} {{timeOfDay}}

ã€å¯¹è¯ã€‘
{{history}}

{{user}}ï¼šã€Œ{{message}}ã€
{{char}}ï¼š
```

#### ç¤ºä¾‹ï¼šCharacter Card å®Œæ•´æ ¼å¼

```
System: {{systemPrompt}}

Character: {{char}}
Description: {{description}}
Personality: {{personality}}
Scenario: {{scenario}}

Example Dialogue:
{{exampleMessages}}

Current Time: {{date}} {{time}}

Chat History:
{{history}}

{{user}}: {{message}}
{{char}}:
```

---

## ğŸ¨ è®©å¯¼å…¥çš„ Character Card æ•°æ®ç”Ÿæ•ˆ

### é—®é¢˜
å¯¼å…¥ Character Cardåï¼Œé‚£äº›å­—æ®µï¼ˆpersonalityã€scenarioã€exampleMessagesï¼‰æ²¡åœ°æ–¹ç”¨ï¼Ÿ

### è§£å†³
ä½¿ç”¨æç¤ºè¯æ¨¡æ¿ï¼

1. é€‰æ‹© "Character Card æ ‡å‡†" æˆ– "SillyTavern" æ¨¡æ¿
2. æ‰€æœ‰å­—æ®µè‡ªåŠ¨è¢«ä½¿ç”¨
3. AI èƒ½è¯»åˆ°å®Œæ•´çš„è§’è‰²è®¾å®š

---

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### æ–‡ä»¶ç»“æ„

```
src/
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ promptTemplate.ts        # æ¨¡æ¿å¼•æ“æ ¸å¿ƒ
â”œâ”€â”€ components/
â”‚   â””â”€â”€ PromptTemplateEditor.tsx # ç¼–è¾‘å™¨UI
â””â”€â”€ pages/
    â””â”€â”€ ChatSettings.tsx          # é›†æˆå…¥å£
```

### æ•°æ®å­˜å‚¨

```javascript
// æ¨¡æ¿ID
localStorage: `prompt_template_id_${characterId}`

// è‡ªå®šä¹‰æ¨¡æ¿å†…å®¹
localStorage: `prompt_custom_template_${characterId}`
```

### API

```typescript
// æ›¿æ¢æ¨¡æ¿å˜é‡
replaceTemplateVariables(template, variables)

// æ„å»ºå˜é‡å¯¹è±¡
buildTemplateVariables(character, userName, options)

// è·å–é¢„è®¾æ¨¡æ¿
getPresetTemplate(templateId)

// æ„å»ºå®Œæ•´æç¤ºè¯
buildPromptFromTemplate(character, userName, history, message)
```

---

## ğŸš€ ä¸‹ä¸€æ­¥é›†æˆ

**é‡è¦ï¼** ç°åœ¨æ¨¡æ¿ç³»ç»Ÿå·²ç»å®Œæˆï¼Œä½†è¿˜æ²¡æœ‰è¢« AI API è°ƒç”¨ä½¿ç”¨ã€‚

### éœ€è¦åšçš„ï¼š

åœ¨ `ChatDetail.tsx` æˆ–è°ƒç”¨ AI çš„åœ°æ–¹ï¼Œæ›¿æ¢åŸæœ‰çš„æç¤ºè¯æ„å»ºé€»è¾‘ï¼š

```typescript
import { buildPromptFromTemplate } from '../utils/promptTemplate'

// åŸæ¥ï¼š
const prompt = buildRoleplayPrompt(character, user, ...)

// æ”¹ä¸ºï¼š
const prompt = buildPromptFromTemplate(
  character,
  userName,
  historyText,
  currentMessage
)
```

---

## ğŸ’¡ ä¼˜ç‚¹

1. **çµæ´»æ€§** - ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰æ ¼å¼
2. **å…¼å®¹æ€§** - Character Card æ•°æ®ç»ˆäºèƒ½ç”¨äº†
3. **æ ‡å‡†åŒ–** - è·Ÿé…’é¦†ç¤¾åŒºä¿æŒä¸€è‡´
4. **æ˜“ç”¨æ€§** - é¢„è®¾æ¨¡æ¿å¼€ç®±å³ç”¨
5. **å¯æ‰©å±•** - è½»æ¾æ·»åŠ æ–°å˜é‡

---

## ğŸ‰ å®ŒæˆçŠ¶æ€

âœ… å˜é‡æ›¿æ¢å¼•æ“  
âœ… é¢„è®¾æ¨¡æ¿åº“  
âœ… è‡ªå®šä¹‰ç¼–è¾‘å™¨  
âœ… å®æ—¶é¢„è§ˆ  
âœ… ç§»åŠ¨ç«¯UI  
âœ… ä¿å­˜åŠŸèƒ½  
âœ… ChatSettings é›†æˆ  
â³ AI API è°ƒç”¨é›†æˆï¼ˆå¾…å®Œæˆï¼‰

---

## ğŸº è‡´é…’é¦†ç©å®¶

ç°åœ¨ä½ å¯ä»¥ï¼š
- ä½¿ç”¨è‡ªå·±å–œæ¬¢çš„æç¤ºè¯æ ¼å¼
- è®© Character Card çš„æ‰€æœ‰å­—æ®µå‘æŒ¥ä½œç”¨
- è·Ÿå…¶ä»–é…’é¦†ç©å®¶åˆ†äº«æ¨¡æ¿
- æ ¹æ®ä¸åŒè§’è‰²åˆ‡æ¢ä¸åŒæ¨¡æ¿

**äº«å—è‡ªç”±å®šåˆ¶çš„ä¹è¶£ï¼** ğŸŠ
