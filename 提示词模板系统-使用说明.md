# 🍺 提示词模板系统 - 酒馆玩家福利

## ✨ 功能完成！

现在你的项目完全支持**酒馆风格的变量替换系统**了！

---

## 🎯 主要功能

### 1. **变量替换引擎**

支持以下变量：

| 变量 | 说明 | 示例 |
|------|------|------|
| `{{char}}` | 角色名 | "汁汁" |
| `{{user}}` | 用户名 | "用户" |
| `{{description}}` | 角色描述 | 完整的人设描述 |
| `{{personality}}` | 性格 | "活泼开朗" |
| `{{scenario}}` | 场景设定 | "在学校食堂" |
| `{{exampleMessages}}` | 示例对话 | 角色说话风格的示例 |
| `{{systemPrompt}}` | 系统提示词 | 自定义系统指令 |
| `{{history}}` | 历史对话 | 最近的聊天记录 |
| `{{message}}` | 当前消息 | 用户刚发的消息 |
| `{{date}}` | 当前日期 | "2024年10月24日 星期四" |
| `{{time}}` | 当前时间 | "14:30" |
| `{{timeOfDay}}` | 时段 | "下午" |

### 2. **6个预设模板**

- **默认模板** - 适合日常聊天
- **Character Card 标准** - V2格式标准模板
- **角色扮演强化** - 强调角色沉浸感
- **简洁模板** - 最小化提示词
- **小说风格** - 适合故事创作
- **SillyTavern** - 酒馆标准格式

### 3. **自定义模板编辑器**

- 📝 可视化编辑
- 👀 实时预览
- 💾 保存到角色
- 📱 移动端适配

---

## 📖 使用方法

### 快速开始

1. **进入聊天设置**
   - 打开任意聊天
   - 点击右上角设置按钮
   - 向下滚动找到 "提示词模板" 🍺酒馆

2. **选择预设模板**
   - 点击"编辑提示词模板"
   - 浏览6个预设模板
   - 选择一个适合你的

3. **自定义模板（可选）**
   - 打开"自定义模板"开关
   - 使用变量 `{{变量名}}` 编辑
   - 点击"查看预览"检查效果
   - 保存

### 进阶使用

#### 示例：创建小说风格模板

```
【故事背景】
{{scenario}}

【角色设定】
姓名：{{char}}
性格：{{personality}}
描述：{{description}}

【时间】{{date}} {{timeOfDay}}

【对话】
{{history}}

{{user}}：「{{message}}」
{{char}}：
```

#### 示例：Character Card 完整格式

```
System: {{systemPrompt}}

Character: {{char}}
Description: {{description}}
Personality: {{personality}}
Scenario: {{scenario}}

Example Dialogue:
{{exampleMessages}}

Current Time: {{date}} {{time}}

Chat History:
{{history}}

{{user}}: {{message}}
{{char}}:
```

---

## 🎨 让导入的 Character Card 数据生效

### 问题
导入 Character Card后，那些字段（personality、scenario、exampleMessages）没地方用？

### 解决
使用提示词模板！

1. 选择 "Character Card 标准" 或 "SillyTavern" 模板
2. 所有字段自动被使用
3. AI 能读到完整的角色设定

---

## 🔧 技术细节

### 文件结构

```
src/
├── utils/
│   └── promptTemplate.ts        # 模板引擎核心
├── components/
│   └── PromptTemplateEditor.tsx # 编辑器UI
└── pages/
    └── ChatSettings.tsx          # 集成入口
```

### 数据存储

```javascript
// 模板ID
localStorage: `prompt_template_id_${characterId}`

// 自定义模板内容
localStorage: `prompt_custom_template_${characterId}`
```

### API

```typescript
// 替换模板变量
replaceTemplateVariables(template, variables)

// 构建变量对象
buildTemplateVariables(character, userName, options)

// 获取预设模板
getPresetTemplate(templateId)

// 构建完整提示词
buildPromptFromTemplate(character, userName, history, message)
```

---

## 🚀 下一步集成

**重要！** 现在模板系统已经完成，但还没有被 AI API 调用使用。

### 需要做的：

在 `ChatDetail.tsx` 或调用 AI 的地方，替换原有的提示词构建逻辑：

```typescript
import { buildPromptFromTemplate } from '../utils/promptTemplate'

// 原来：
const prompt = buildRoleplayPrompt(character, user, ...)

// 改为：
const prompt = buildPromptFromTemplate(
  character,
  userName,
  historyText,
  currentMessage
)
```

---

## 💡 优点

1. **灵活性** - 用户可以自定义格式
2. **兼容性** - Character Card 数据终于能用了
3. **标准化** - 跟酒馆社区保持一致
4. **易用性** - 预设模板开箱即用
5. **可扩展** - 轻松添加新变量

---

## 🎉 完成状态

✅ 变量替换引擎  
✅ 预设模板库  
✅ 自定义编辑器  
✅ 实时预览  
✅ 移动端UI  
✅ 保存功能  
✅ ChatSettings 集成  
⏳ AI API 调用集成（待完成）

---

## 🍺 致酒馆玩家

现在你可以：
- 使用自己喜欢的提示词格式
- 让 Character Card 的所有字段发挥作用
- 跟其他酒馆玩家分享模板
- 根据不同角色切换不同模板

**享受自由定制的乐趣！** 🎊
