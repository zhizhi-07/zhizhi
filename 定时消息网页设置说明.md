# 📱 定时消息网页设置说明

## ✨ 功能介绍

现在你可以**直接在网页中设置**定时消息的时间，不需要修改代码！

---

## 🎯 如何使用

### 1. 在你的应用中添加设置入口

找到合适的位置（比如设置页面），添加定时设置按钮：

```typescript
import { ScheduleSettings } from './components/ScheduleSettings';
import { useState } from 'react';

function YourComponent() {
  const [showSchedule, setShowSchedule] = useState(false);

  return (
    <>
      {/* 设置按钮 */}
      <button onClick={() => setShowSchedule(true)}>
        ⏰ 定时消息设置
      </button>

      {/* 设置弹窗 */}
      {showSchedule && (
        <ScheduleSettings onClose={() => setShowSchedule(false)} />
      )}
    </>
  );
}
```

---

## 🔧 可设置的内容

### 1. **早安问候** 🌅
- 开关：启用/关闭
- 时间：0-23 点（默认 8:00）
- 示例："早上好呀~ 今天要加油哦！"

### 2. **午间问候** 🍱
- 开关：启用/关闭
- 时间：0-23 点（默认 12:00）
- 示例："该吃午饭啦~ 记得好好吃饭哦"

### 3. **晚安问候** 🌙
- 开关：启用/关闭
- 时间：0-23 点（默认 22:00）
- 示例："该睡觉啦，晚安~ 做个好梦"

### 4. **想念提醒** 💭
- 开关：启用/关闭
- 天数：1-30 天（默认 3 天）
- 时间：0-23 点（默认 10:00）
- 示例："好久不见，最近怎么样？"

---

## 💾 数据存储

### 本地存储
设置保存在浏览器的 `localStorage` 中：
```javascript
localStorage.getItem('scheduleConfig')
```

### 云端同步
当你使用数据备份功能时，设置会自动同步到云端：
```typescript
const { autoBackup } = useBackend();

// 保存设置时同时备份
const saveSettings = () => {
  const scheduleConfig = getScheduleConfig();
  autoBackup({
    messages: [...],
    contacts: [...],
    settings: {
      scheduleConfig: scheduleConfig  // 包含定时设置
    }
  });
};
```

---

## 🔄 工作流程

### 1. 用户在网页设置
```
用户打开设置页面
→ 修改定时时间（比如早安改成 7:00）
→ 点击保存
→ 设置保存到 localStorage
→ 自动备份到云端
```

### 2. 后端读取设置
```
定时任务每小时运行
→ 从数据库读取用户数据
→ 获取用户的 scheduleConfig
→ 根据用户设置的时间发送消息
```

### 3. 消息发送
```
当前时间 = 用户设置的时间
→ 生成 AI 消息
→ 保存到数据库
→ 用户打开网页时自动显示
```

---

## 📋 集成步骤

### 步骤 1：导入组件

在你的设置页面或主页面中：

```typescript
import { ScheduleSettings } from '../components/ScheduleSettings';
```

### 步骤 2：添加状态管理

```typescript
const [showScheduleSettings, setShowScheduleSettings] = useState(false);
```

### 步骤 3：添加触发按钮

```typescript
<button 
  onClick={() => setShowScheduleSettings(true)}
  className="设置按钮样式"
>
  ⏰ 定时消息设置
</button>
```

### 步骤 4：渲染设置弹窗

```typescript
{showScheduleSettings && (
  <ScheduleSettings 
    onClose={() => setShowScheduleSettings(false)} 
  />
)}
```

### 步骤 5：同步设置到云端

在数据备份时包含设置：

```typescript
import { getScheduleConfig } from '../components/ScheduleSettings';

const { autoBackup } = useBackend();

// 备份数据时包含设置
const backupAllData = () => {
  const scheduleConfig = getScheduleConfig();
  
  autoBackup({
    messages: messages,
    contacts: contacts,
    moments: moments,
    settings: {
      scheduleConfig: scheduleConfig  // 添加这一行
    }
  });
};
```

---

## 🎨 界面预览

```
┌─────────────────────────────────┐
│  ⏰ AI 定时消息设置        ×   │
├─────────────────────────────────┤
│                                 │
│  ☑ 🌅 早安问候                 │
│     每天 [8] :00 发送           │
│                                 │
│  ☑ 🍱 午间问候                 │
│     每天 [12] :00 发送          │
│                                 │
│  ☑ 🌙 晚安问候                 │
│     每天 [22] :00 发送          │
│                                 │
│  ☑ 💭 想念提醒                 │
│     [3] 天未聊天时提醒          │
│     在 [10] :00 发送            │
│                                 │
│  💡 提示                        │
│  • AI 会在设定的时间主动发送    │
│  • 需要配置后端才能使用         │
│                                 │
│  [重置默认]  [保存设置]         │
└─────────────────────────────────┘
```

---

## 🧪 测试功能

### 测试 1：保存设置
1. 打开定时设置
2. 修改时间（比如早安改成 7:00）
3. 点击保存
4. 刷新页面，重新打开设置
5. 时间应该保持为 7:00

### 测试 2：云端同步
1. 修改定时设置并保存
2. 清除浏览器缓存
3. 刷新页面
4. 设置应该从云端恢复

### 测试 3：实际发送
1. 设置早安时间为当前时间的下一个小时
2. 等待到设定时间
3. 应该收到 AI 的早安消息

---

## 💡 使用建议

### 1. 个性化时间
根据你的作息时间设置：
- 早起的人：早安 6:00
- 晚睡的人：晚安 23:00 或 24:00

### 2. 避免打扰
关闭不需要的提醒：
- 工作日不需要午间问候？关闭它
- 不想被打扰？全部关闭

### 3. 合理设置天数
- 亲密关系：1-2 天未聊天就提醒
- 普通朋友：3-5 天
- 不常联系：7 天以上

---

## ⚠️ 注意事项

1. **需要后端支持**
   - 定时消息功能需要配置后端
   - 本地设置会保存，但不会真正发送消息

2. **时区问题**
   - 时间基于服务器时区（通常是 UTC）
   - 如果时间不准，可能需要调整

3. **Netlify 限制**
   - 免费版定时任务可能不稳定
   - 建议升级 Pro 版获得稳定体验

4. **消息频率**
   - 不要设置太多定时消息
   - 避免打扰用户体验

---

## 🎉 完成！

现在你可以：
- ✅ 在网页中自由设置定时时间
- ✅ 随时开启/关闭定时消息
- ✅ 设置自动同步到云端
- ✅ 不需要修改任何代码

**享受你的智能 AI 助手吧！** 🚀

---

## 📚 相关文档

- `后端部署说明.md` - 如何配置后端
- `后端功能集成指南.md` - 如何集成到代码
- `快速开始-后端功能.md` - 快速部署指南

有问题随时问我！😊
