# ✅ 记忆系统 - 支持 Character Card 格式

## 🎯 更新说明

现在记忆系统支持 **Character Card 格式**（酒馆 AI 格式）！

---

## 📝 支持的格式

### 格式 1：直接描述

```
你是一个温柔的女朋友。
用户是你的男朋友，名字叫小明，25岁，在北京工作。
小明喜欢打篮球，不喜欢吃榴莲。
```

### 格式 2：Character Card 格式 ✨新增✨

```
{{char}} 是一个温柔的女朋友。
{{user}} 是 {{char}} 的男朋友，名字叫小明，25岁，在北京工作。
{{user}} 喜欢打篮球，不喜欢吃榴莲。
```

**变量说明**：
- `{{user}}` 或 `{{User}}` = 用户
- `{{char}}` 或 `{{Char}}` = AI 角色

---

## 🔧 工作原理

系统会自动识别 `{{user}}` 标记，只提取关于用户的信息：

### 输入（Character Card）

```
{{char}} 是一个温柔的女朋友，喜欢做饭。
{{user}} 是 {{char}} 的男朋友，名字叫小明，25岁。
{{user}} 喜欢打篮球，不喜欢吃榴莲。
{{char}} 每天都会给 {{user}} 做早餐。
```

### 提取结果

✅ **会提取**（关于 {{user}}）：
- 用户名字是小明
- 用户25岁
- 用户是我的男朋友
- 用户喜欢打篮球
- 用户不喜欢吃榴莲

❌ **不会提取**（关于 {{char}}）：
- ~~角色喜欢做饭~~
- ~~角色每天做早餐~~

---

## 💡 使用建议

### 1. 两种格式都支持

你可以混用两种格式，系统都能正确识别：

```
{{char}} 是一个温柔的女朋友。
用户是你的男朋友，名字叫小明。  ← 直接描述
{{user}} 25岁，在北京工作。      ← Character Card
小明喜欢打篮球。                  ← 直接描述
```

### 2. 推荐使用 Character Card 格式

如果你从酒馆 AI 导入角色卡，使用 Character Card 格式更清晰：

```
{{char}} = AI 角色的信息
{{user}} = 用户的信息
```

系统会自动过滤掉 `{{char}}` 的信息，只提取 `{{user}}` 的信息。

---

## 📊 示例对比

### 酒馆 AI 角色卡

```
{{char}} 的名字是小雪，是一个温柔体贴的女朋友。
{{char}} 喜欢做饭、看电影。
{{user}} 是 {{char}} 的男朋友，名字叫小明，25岁，在北京工作。
{{user}} 喜欢打篮球，不喜欢吃榴莲。
{{char}} 和 {{user}} 在一起两年了，感情很好。
```

### 提取的记忆

```json
[
  {
    "type": "fact",
    "content": "用户名字是小明",
    "importance": 9,
    "tags": ["基本信息", "初始记忆"]
  },
  {
    "type": "fact",
    "content": "用户25岁",
    "importance": 8,
    "tags": ["基本信息", "初始记忆"]
  },
  {
    "type": "fact",
    "content": "用户在北京工作",
    "importance": 7,
    "tags": ["基本信息", "初始记忆"]
  },
  {
    "type": "relationship",
    "content": "用户是我的男朋友，在一起两年了",
    "importance": 10,
    "tags": ["关系", "初始记忆"]
  },
  {
    "type": "preference",
    "content": "用户喜欢打篮球",
    "importance": 7,
    "tags": ["偏好", "初始记忆"]
  },
  {
    "type": "preference",
    "content": "用户不喜欢吃榴莲",
    "importance": 7,
    "tags": ["偏好", "初始记忆"]
  }
]
```

**注意**：关于 {{char}} 的信息（喜欢做饭、看电影）不会被提取。

---

## 🎊 总结

### ✅ 新增功能

1. ✅ 支持 `{{user}}` 和 `{{User}}` 标记
2. ✅ 支持 `{{char}}` 和 `{{Char}}` 标记
3. ✅ 自动过滤 {{char}} 的信息
4. ✅ 只提取 {{user}} 的信息
5. ✅ 兼容直接描述格式

### 🎯 使用方法

1. 在角色描述中使用 `{{user}}` 标记用户信息
2. 使用 `{{char}}` 标记角色信息
3. 第一次进入聊天时自动提取
4. 系统会自动识别并只提取用户信息

### 💡 提示

- 两种格式都支持，可以混用
- 推荐使用 Character Card 格式，更清晰
- 从酒馆 AI 导入的角色卡可以直接使用

---

**更新时间**: 2025-10-19  
**状态**: ✅ 已完成  
**兼容性**: 完全兼容酒馆 AI 格式

🎉 **现在可以直接使用酒馆 AI 的角色卡了！** 🎉
