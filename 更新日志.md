# 更新日志

## 2024-10-24

### 🔥 紧急修复
- ✅ **修复 PNG Character Card 导入崩溃问题**
  - 问题：导入时报错 "Maximum call stack exceeded"
  - 原因：Character Book 中的循环引用导致栈溢出
  - 解决：添加 `cleanObject` 函数清理循环引用
  - 影响：现在可以正常导入包含 Character Book 的角色卡

### 🎉 新增功能
- ✅ **世界书系统（Lorebook / World Info）**
  - 基于关键词触发的知识库管理
  - 支持全局世界书和角色专属世界书
  - 智能 Token 预算管理
  - 优先级和插入顺序控制
  - 支持正则表达式匹配
  - 导入导出 JSON 格式
  - **自动识别并导入 SillyTavern 世界书格式**
  - 完整的格式转换和字段映射
  - 白色液态玻璃设计，完美适配移动端

### 📚 文档更新
- ✅ 创建 **SillyTavern玩家建议-完整版.md**
  - 作为 SillyTavern 重度玩家的专业建议
  - 功能优先级列表（P0-P3）
  - 详细实现方案和代码示例
  - 差异化竞争优势分析
- ✅ 创建 **PNG导入修复说明.md**
  - 问题分析和修复方案
  - 技术细节说明
  - 测试方法和注意事项
- ✅ 创建 **世界书系统使用说明.md**
  - 完整的功能说明
  - 使用场景和最佳实践
  - 技术细节和性能优化
- ✅ 创建 **SillyTavern世界书导入指南.md**
  - 详细的导入步骤
  - 所有概念的通俗解释
  - 字段对照表和转换说明
  - 实际例子和常见问题

### 🎯 已完成功能
- ✅ Character Card V2 导入修复
- ✅ Lorebook/World Info 系统

### 🎯 待实现功能（优先级排序）
#### P1 - 核心功能（1-2周）
1. Swipe 重新生成功能
2. Token 计数器
3. Instruct 模式支持
4. 世界书集成到聊天系统

#### P2 - 体验优化（1个月）
5. 高级采样参数
6. Regex 输出过滤
7. 快速回复
8. 聊天分支

---

## 2025-10-23

### 新增功能
- ✅ 字体自定义功能：支持上传字体链接
  - 用户可以添加自己的字体URL
  - 支持 .woff2, .woff, .ttf, .otf 格式
  - 实时预览字体效果
  - 字体管理（删除、应用）
- ✅ 音乐播放器小程序入口（开发中）

### 优化
- ✅ 字体全局应用：所有页面文字都使用自定义字体
- ✅ 字体加载速度优化：
  - 并行加载，速度提升 3-4 倍
  - 智能缓存机制，避免重复加载
  - 应用启动时自动加载字体
  - 显示加载状态提示
- ✅ 导航栏时间背景缩小：更精致的显示效果
- ✅ 通话记录时间样式优化：更紧凑的布局

### 技术改进
- ✅ 使用 FontFace API 动态加载字体
- ✅ CSS 变量全局字体管理
- ✅ 字体缓存机制（useRef + Set）
- ✅ Promise.all 并行加载优化

---

## 2025-10-20

### 新增功能
- ✅ AI 撤回消息功能
- ✅ AI 引用消息功能
- ✅ 撤回消息可点击查看原内容
- ✅ 测试机器人角色

### 优化
- ✅ AI 独立性和边界感：不再过度迎合用户
- ✅ 关系渐进系统：对不熟的人保持距离
- ✅ 引用功能优化：AI 不会过度使用引用
- ✅ 撤回消息显示：系统提示居中显示
- ✅ 引用格式清理：防止 AI 模仿错误格式

### 修复
- ✅ 撤回消息不会在回复中提到
- ✅ 引用消息格式解析支持空格
- ✅ AI 错误引用格式自动清理
- ✅ 状态标记解析日志优化

### 提示词调整
- ✅ 强调 AI 是独立个体，有自己的想法
- ✅ 不熟的人：礼貌但有距离
- ✅ 熟悉的人：自然放松
- ✅ 亲密的人：真诚坦率
- ✅ 禁止工具人行为
