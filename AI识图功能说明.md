# AI识图功能说明

## 功能概述

现在AI具备完整的视觉能力！可以看到并理解图片内容，包括：
- 你上传的图片
- 小红书笔记的封面图片
- 任何聊天中出现的图片

## 使用方式

### 1. 上传图片让AI识别

**操作步骤：**
1. 点击聊天输入框左侧的"+"按钮，打开功能菜单
2. 选择"相册"📷
3. 从本地选择要上传的图片
4. 图片会自动发送给AI
5. AI会识别图片内容并回复

**支持的图片格式：**
- JPG/JPEG
- PNG  
- GIF
- WebP

**图片限制：**
- 最大文件大小：10MB
- 自动压缩：超过1024x1024会自动压缩
- 保证画质：使用80%质量压缩，兼顾清晰度和速度

### 2. AI能看到小红书图片

当你或AI分享小红书笔记时，AI会：
- 看到笔记的封面图片
- 理解图片内容
- 根据图片和文字综合回复

**示例对话：**
```
你：[分享了一个咖啡店的小红书]
AI：哇！这家店的装修好有格调啊，那个吊灯很特别，整体走的是工业风吧？
```

### 3. AI的识图能力

AI可以识别：
- **物体识别**：人、动物、物品、食物等
- **场景理解**：室内/室外、时间、氛围
- **文字识别**：图片中的文字内容（OCR）
- **情感分析**：图片传达的情绪和氛围
- **颜色构图**：艺术感、配色、美感

**示例场景：**

**场景1：美食图片**
```
你：[上传一张火锅图片]
AI：哇这火锅看起来好香！红汤锅底，涮肉和青菜都齐全了，看着就很过瘾！
```

**场景2：风景照片**
```
你：[上传一张日落照片]
AI：好美的晚霞！橙红色渐变的天空，太治愈了～你在哪里拍的？
```

**场景3：图片中的文字**
```
你：[上传一张菜单图片]
AI：我看看...有宫保鸡丁、麻婆豆腐、鱼香肉丝，这是川菜馆吧？推荐宫保鸡丁！
```

**场景4：需要建议**
```
你：[上传两件衣服的照片] 你觉得哪件好看？
AI：我觉得左边那件更适合你！颜色更显气质，而且版型也更修身～
```

## 技术细节

### 图片处理流程

1. **用户上传** → 选择本地图片
2. **图片压缩** → 自动优化大小（1024x1024，80%质量）
3. **Base64转换** → 转换为base64字符串
4. **消息创建** → 创建包含图片的消息
5. **AI调用** → 将图片和文字一起发送给AI
6. **AI识别** → AI分析图片内容
7. **智能回复** → AI基于图片内容回复

### API要求

**支持Vision的模型：**
- ✅ GPT-4 Vision / GPT-4o / GPT-4o-mini
- ✅ Claude 3 (Opus/Sonnet/Haiku)  
- ✅ Gemini 1.5 Pro / Gemini 2.0 Flash
- ✅ 其他支持multimodal的模型

**不支持Vision的模型：**
- ❌ GPT-3.5
- ❌ Claude 2
- ❌ 纯文本模型

如果你的模型不支持识图，图片会被忽略，只处理文字部分。

### 消息格式

**图片消息结构：**
```typescript
{
  id: number,
  type: 'sent',
  content: '发送了一张图片',
  messageType: 'image',
  imageUrl: 'data:image/jpeg;base64,/9j/4AAQ...' // base64格式
}
```

**发送给AI的格式：**
```javascript
{
  role: 'user',
  content: [
    { type: 'text', text: '用户发送了一张图片' },
    { type: 'image_url', image_url: { url: 'base64...', detail: 'high' } }
  ]
}
```

### 小红书图片处理

小红书笔记的封面图也会传递给AI：
```javascript
{
  role: 'user',
  content: [
    { type: 'text', text: '[用户分享了小红书]\n标题：北京探店...' },
    { type: 'image_url', image_url: { url: 'https://...', detail: 'low' } }
  ]
}
```

注意：小红书图片使用`detail: 'low'`以节省tokens，用户上传的图片使用`detail: 'high'`以获得更好的识别效果。

## 使用技巧

### 1. 清晰的提问

发送图片后，可以配合文字说明：

**推荐：**
- ✅ [上传图片] "这个菜叫什么？"
- ✅ [上传图片] "帮我看看这个问题怎么解决"
- ✅ [上传图片] "图片里的文字写的什么？"

**不推荐：**
- ❌ [只发图片，不说话] - AI会识别但可能不知道你想问什么
- ❌ "看" - 太简单了

### 2. 多角度利用

- **识别物体**："这是什么花？"
- **提供建议**："这两个哪个好看？"
- **解读文字**："帮我读一下这个通知"
- **分析情况**："你觉得这个地方怎么样？"
- **创意灵感**："根据这张图，帮我想个文案"

### 3. 结合对话

图片+文字效果更好：
```
[上传图片]
这是我今天拍的，你觉得怎么样？有什么建议吗？
```

## 常见问题

### Q: 为什么AI没有识别我的图片？
A: 可能原因：
1. 你的API模型不支持Vision功能
2. 图片格式不被支持
3. 图片过大导致上传失败
4. 网络问题

### Q: AI能识别所有内容吗？
A: AI会尽力识别，但可能有限制：
- 模糊的图片识别效果差
- 小文字可能识别不清
- 特殊语言文字识别有限
- 某些抽象内容难以理解

### Q: 图片会被存储吗？
A: 
- 图片转为base64后保存在本地浏览器
- 不会上传到我们的服务器
- 只在调用AI时传递给你配置的API
- 删除聊天记录即删除图片

### Q: 识图会消耗更多tokens吗？
A: 是的，图片会占用额外的tokens：
- 低清晰度(`detail: 'low'`)：~85 tokens
- 高清晰度(`detail: 'high'`)：~170-1360 tokens（取决于图片大小）
- 建议使用支持大context的模型

### Q: 可以一次发送多张图片吗？
A: 当前版本每次只能发送一张。如需发送多张，请分多次发送。

## 后续优化计划

- [ ] 支持同时上传多张图片
- [ ] 图片编辑功能（裁剪、旋转）
- [ ] 图片历史记录查看
- [ ] 批量识别功能
- [ ] 图片搜索功能

## 总结

现在你的AI助手具备了完整的视觉能力！
- 📷 上传图片让AI识别
- 📕 小红书图片自动传给AI  
- 🤖 AI能理解图片并智能回复

开始使用，让AI成为你的全能助手吧！🎉
