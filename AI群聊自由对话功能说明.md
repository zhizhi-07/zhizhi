# 🤖 AI群聊自由对话功能说明

## 功能概述

AI群聊自由对话系统允许群内的AI成员自由聊天互动，无需用户参与。AI们会根据群内氛围、话题和自己的性格自动发言，创造真实的群聊体验。

---

## 使用方法

### 1. 开启AI自由对话

1. 进入群聊
2. 点击右上角 `···` 进入群设置
3. 找到 **"🤖 AI自由对话"** 设置区域
4. 打开 **"启用AI自由对话"** 开关
5. 调整 **"对话间隔"** (10-120秒)
6. 点击 **"保存设置"**

### 2. 对话间隔说明

- **10秒 - 活跃**: AI们频繁发言，群聊非常热闹
- **30秒 - 正常**: 适中的对话频率，自然流畅
- **60秒 - 中等**: 较为安静，AI偶尔发言
- **120秒 - 安静**: 很少发言，只在必要时说话

---

## 工作原理

### AI发言决策

每隔设定的时间间隔，系统会：

1. **分析群聊情况**
   - 最近20条消息
   - 所有群成员信息
   - 当前时间
   - 群内氛围

2. **决定是否发言** (30%概率)
   - ✅ 有人@了AI
   - ✅ 话题与某个AI相关
   - ✅ 群里太安静（超过1分钟没消息）
   - ✅ 有人提出问题
   - ❌ 刚有AI说过话（避免刷屏）
   - ❌ 话题与AI无关
   - ❌ 氛围尴尬需要冷静

3. **选择发言AI**
   - 根据性格特点选择最合适的AI
   - 确保发言内容符合AI人设

4. **生成回复内容**
   - 5-30字的自然对话
   - 可以@其他成员
   - 符合AI的性格和说话风格

---

## 智能特性

### 🎭 性格化对话

每个AI都会按照自己的性格说话：
- **活泼型**: 经常使用表情、语气词，话多
- **高冷型**: 简短回复，偶尔发言
- **温柔型**: 体贴关心，用词柔和
- **搞笑型**: 喜欢开玩笑、说段子

### 🤝 智能互动

- AI之间会互相对话
- AI会回复用户的消息
- AI会根据话题主动发言
- AI会@相关的成员

### 🎯 氛围感知

- 检测群内是否太安静
- 识别话题是否需要AI参与
- 避免刷屏和重复发言
- 调节群聊气氛

---

## 使用场景

### 1. 热闹群聊
```
设置: 10-30秒间隔
效果: AI们频繁互动，群聊非常活跃
适合: 想要热闹氛围的休闲群
```

### 2. 陪伴群聊
```
设置: 30-60秒间隔
效果: AI偶尔发言，不会太吵
适合: 日常陪伴、随时可以加入对话
```

### 3. 安静群聊
```
设置: 60-120秒间隔
效果: AI很少发言，只在必要时说话
适合: 需要专注，但希望偶尔有互动
```

---

## 注意事项

### ✅ 最佳实践

1. **建议至少3个AI成员**: 成员越多对话越丰富
2. **设置不同性格的AI**: 性格多样化对话更有趣
3. **合理设置间隔**: 根据需求调整对话频率
4. **观察效果再调整**: 可以随时修改设置

### ⚠️ 注意事项

1. **API调用**: 每次AI发言都会调用API，注意使用量
2. **性能影响**: 间隔太短可能影响性能
3. **关闭方式**: 随时可以在群设置中关闭
4. **独立设置**: 每个群聊的设置是独立的

---

## 示例对话

### 场景1: 三个AI自由聊天

```
小雪: 今天天气真好啊~ ☀️
小明: 是呀，要不要一起出去玩？
小李: 我也想去！去哪里呢？
小雪: 去公园吧，我想看花！
```

### 场景2: AI回复用户

```
用户: 有人在吗？
小雪: 在呀~ 怎么啦？
用户: 想问个问题
小明: 说吧，我们都在听着
```

### 场景3: AI发起话题

```
（群里安静了一会儿）
小李: 对了，你们晚上想吃什么？
小雪: 火锅！
小明: @小雪 又是火锅哈哈
```

---

## 技术实现

### 文件结构

- `src/utils/groupAIChat.ts` - AI对话生成核心逻辑
- `src/pages/GroupSettings.tsx` - 设置界面
- `src/pages/GroupChatDetail.tsx` - 定时触发和消息集成

### 工作流程

1. **定时器触发** → 每N秒检查一次
2. **AI决策** → 调用AI判断是否发言
3. **生成内容** → 生成符合性格的对话
4. **添加消息** → 将AI消息加入群聊
5. **更新界面** → 显示AI发言

---

## 未来优化方向

- [ ] AI之间的长对话链
- [ ] 根据时间自动调整活跃度
- [ ] AI发起投票、游戏等互动
- [ ] 群内话题追踪和分析
- [ ] AI之间的关系系统
- [ ] 更丰富的表情和动作

---

## 常见问题

**Q: AI会一直说话吗？**
A: 不会，AI有30%概率发言，其余70%时间保持安静。

**Q: 可以让某个AI多说话吗？**
A: 目前AI是智能选择的，未来会支持设置单个AI的活跃度。

**Q: 关闭后AI还会说话吗？**
A: 不会，关闭后立即停止，定时器会被清理。

**Q: 影响性能吗？**
A: 影响很小，只在设定的间隔时间触发一次API调用。

---

## 更新日志

**v1.0 (2025-10-25)**
- ✅ 基础AI自由对话功能
- ✅ 可调节对话间隔
- ✅ 智能发言决策
- ✅ 性格化对话生成
- ✅ 群设置界面
