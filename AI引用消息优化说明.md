# AI引用消息功能优化说明

## 🎯 优化目标

**之前的问题**：
- ❌ AI很少主动使用引用消息
- ❌ 只有用户明确提到"引用"时才会使用
- ❌ 使用频率过低，不够真实

**优化后的效果**：
- ✅ AI会主动使用引用回复
- ✅ 在合适的场景自然地引用
- ✅ 更接近真实聊天习惯

---

## 📝 优化内容

### 1. 功能说明强化

**原版**：
```
💬 **引用** - [引用:消息ID] 你的回复
```

**优化后**：
```
💬 **引用回复** - [引用:消息ID] 你的回复内容
   • 这是非常常用的功能！当聊天内容多了、话题跳转了、想针对某条具体回复时就用引用
   • 使用场景示例：
     ✅ 对方发了多条消息，你想回复其中一条 → 引用那条消息再回复
     ✅ 聊了很多轮后，突然想起前面说的某件事 → 引用那条消息继续聊
     ✅ 对方问了多个问题，你想逐个回答 → 引用每个问题分别回复
     ✅ 对方发了有趣的话，你想吐槽或调侃 → 引用那条消息加上你的吐槽
     ✅ 话题突然转变，想回到之前的话题 → 引用之前的消息继续
     ✅ 对方说了值得回应的内容（夸奖、询问、吐槽等） → 引用后专门回复
   • 示例对话：
     对方："今天吃了火锅"
     对方："明天想去看电影"
     你："[引用:上一条] 看什么电影？我也想去"
   • 💡 **重要**：引用不是特殊功能，是日常聊天的一部分！就像微信QQ里长按消息回复一样自然
```

### 2. 使用建议强化

**新增专门的引用回复建议**：
```
- **引用回复**：非常重要！这是真实聊天中最常用的功能，主动使用它：
  * 对方一次发了2-3条以上消息时 → 引用其中一条重点回复
  * 聊了5轮以上，想回到前面的话题 → 引用之前的消息
  * 对方问了多个问题 → 引用每个问题逐个回答
  * 看到对方说的某句话有槽点/有趣/值得回应 → 引用那句话专门回复
  * 话题跳转频繁时 → 用引用来保持话题清晰
  * 💡 参考真实聊天习惯：微信/QQ里长按消息回复是很自然的事，你也应该这样
```

---

## 🎮 使用场景详解

### 场景1：对方发了多条消息

**对话示例**：
```
用户：今天天气好好
用户：我去跑步了
用户：顺便买了奶茶
用户：你在干嘛？

AI：[引用:上一条] 在家躺着呢哈哈
    奶茶买的什么口味呀
```

### 场景2：回到之前的话题

**对话示例**：
```
用户：昨天那部电影你看了吗
AI：还没看诶
用户：那你周末有空吗
AI：有空的
（聊了几轮其他的）
AI：[引用:那部电影] 对了，我刚才查了下，这个周末可以一起去看
```

### 场景3：多个问题逐个回答

**对话示例**：
```
用户：你喜欢吃辣吗？
用户：晚上想吃什么？
用户：明天有空吗？

AI：[引用:第1条] 还行，不太能吃特别辣的
    [引用:第2条] 火锅怎么样？
    [引用:第3条] 明天下午有空~
```

### 场景4：吐槽或调侃

**对话示例**：
```
用户：我今天又迟到了😂
AI：[引用:上一条] 哈哈哈笑死，又迟到！你上班是不是快迟到成习惯了
```

### 场景5：专门回应某句话

**对话示例**：
```
用户：今天心情好差
用户：老板骂我了
用户：不想上班

AI：[引用:老板骂我了] 怎么了？发生什么事了吗
```

---

## 📊 触发频率建议

### 高频场景（应该每次都用）
- 对方一次发3条以上消息
- 对方问了多个问题
- 聊了10轮以上，话题已经跳转

### 中频场景（50%概率使用）
- 对方说了有槽点的话
- 想回到之前的话题
- 对方发了值得专门回应的内容

### 低频场景（20%概率使用）
- 正常一问一答的对话
- 刚开始聊天的前几轮

---

## ✨ 关键改进点

### 1. 强调"非常常用"
- 明确告诉AI这是日常功能
- 不是特殊功能，而是聊天的一部分

### 2. 提供具体场景
- 6个详细的使用场景
- 每个场景都有说明和示例

### 3. 对比真实聊天
- 参考微信/QQ的长按回复
- 强调这是自然的聊天习惯

### 4. 示例对话
- 提供真实的对话示例
- 让AI理解如何使用

### 5. 使用建议独立强调
- 在"使用建议"中专门列出
- 给出触发条件和频率建议

---

## 🎯 预期效果

### 优化前：
```
用户：今天吃了什么
用户：天气怎么样
用户：明天有空吗

AI：吃了火锅，天气挺好的，明天有空~
```
（一次性回答所有问题，但不够清晰）

### 优化后：
```
用户：今天吃了什么
用户：天气怎么样
用户：明天有空吗

AI：[引用:今天吃了什么] 吃了火锅哈哈
    [引用:天气怎么样] 今天天气超好！
    [引用:明天有空吗] 明天有空的，怎么了
```
（逐个引用回答，更清晰自然）

---

## 📂 修改的文件

```
src/utils/prompts.ts
  ├─ 引用功能说明 ← 添加详细场景和示例
  └─ 使用建议 ← 强化引用回复的重要性
```

---

## 🔍 验证方法

### 测试场景1：多条消息
1. 连续发送3条以上消息
2. 观察AI是否引用其中某条回复

### 测试场景2：多个问题
1. 一次性问3个不同的问题
2. 观察AI是否逐个引用回答

### 测试场景3：话题跳转
1. 聊了10轮以上
2. 提起之前的话题
3. 观察AI是否引用之前的消息

### 测试场景4：有槽点的话
1. 发送一些有趣/夸张的内容
2. 观察AI是否引用后吐槽

---

## 💡 使用技巧

**对于用户**：
- 如果AI还是不主动引用，可以自己先引用几次
- AI会学习你的引用习惯
- 多条消息一次发送更容易触发AI的引用

**对于开发者**：
- 引用功能的识别在ChatDetail.tsx中实现
- 显示格式在消息卡片中渲染
- Prompt优化在prompts.ts中

---

## ✅ 总结

通过这次优化：
1. ✅ 将引用从"特殊功能"定位为"常用功能"
2. ✅ 提供了6个具体使用场景
3. ✅ 给出了示例对话和触发条件
4. ✅ 在使用建议中专门强调
5. ✅ 对比真实聊天习惯（微信/QQ）

**现在AI应该会更主动、更自然地使用引用消息功能了！** 🎉
