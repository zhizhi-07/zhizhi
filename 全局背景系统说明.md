# 全局背景系统说明

## 📋 概述

重写了整个背景管理系统，使用全局 Context 统一管理所有页面的壁纸背景。

## ✅ 已完成的功能

### 1. 全局背景 Context (`BackgroundContext.tsx`)

创建了统一的背景管理系统：

- **状态管理**：全局管理背景图片/颜色
- **自动同步**：所有页面自动同步背景变化
- **localStorage 持久化**：背景设置自动保存
- **事件监听**：监听 storage 和自定义事件

### 2. 背景样式支持

支持多种背景类型：

- ✅ **图片 URL**：`http://...` 或 `https://...`
- ✅ **Base64 图片**：`data:image/...`
- ✅ **纯色**：`#RRGGBB` 或 `rgb(r, g, b)`
- ✅ **默认渐变**：浅灰色渐变背景

### 3. 已更新的页面

#### ChatList（聊天列表）
- ✅ 使用全局背景
- ✅ 玻璃毛玻璃导航栏
- ✅ 能透过导航栏看到壁纸

#### ChatDetail（聊天详情）
- ✅ 使用全局背景
- ✅ 顶部和底部都是玻璃效果
- ✅ 壁纸覆盖整个页面

## 🎨 使用方法

### 在组件中使用

```tsx
import { useBackground } from '../context/BackgroundContext'

const MyComponent = () => {
  const { background, setBackground, getBackgroundStyle } = useBackground()
  
  return (
    <div className="relative">
      {/* 背景层 */}
      <div 
        className="absolute inset-0 z-0"
        style={getBackgroundStyle()}
      />
      
      {/* 内容层 */}
      <div className="relative z-10">
        {/* 玻璃毛玻璃导航栏 */}
        <div className={background ? 'glass-dark' : 'glass-effect'}>
          导航栏内容
        </div>
      </div>
    </div>
  )
}
```

### 设置背景

```tsx
// 设置图片背景
setBackground('https://example.com/image.jpg')

// 设置纯色背景
setBackground('#FF5733')

// 清除背景（使用默认渐变）
setBackground('')
```

## 🪟 玻璃效果样式

### glass-effect（浅色玻璃）
- 白色半透明背景（85% 不透明度）
- 30px 模糊效果
- 180% 饱和度增强
- 适合无背景或浅色背景

### glass-dark（深色玻璃）
- 白色半透明背景（20% 不透明度）
- 30px 模糊效果
- 180% 饱和度增强
- 适合有壁纸背景

## 📦 文件结构

```
src/
├── context/
│   └── BackgroundContext.tsx    # 全局背景管理
├── pages/
│   ├── ChatList.tsx             # 已更新
│   └── ChatDetail.tsx           # 已更新
└── App.tsx                      # 添加 BackgroundProvider
```

## 🔧 技术细节

### 背景层结构

```tsx
<div className="relative overflow-hidden">
  {/* 背景层 - z-0 */}
  <div className="absolute inset-0 z-0" style={getBackgroundStyle()} />
  
  {/* 内容层 - z-10 */}
  <div className="relative z-10">
    {/* 玻璃导航栏 - z-50 */}
    <div className="glass-effect sticky top-0 z-50">
      导航栏
    </div>
    
    {/* 主内容 */}
    <div>内容</div>
  </div>
</div>
```

### 层级说明

- **z-0**：背景层（最底层）
- **z-10**：内容层
- **z-50**：导航栏（固定在顶部）
- **z-9999**：弹窗/模态框

## 🎯 优势

1. **统一管理**：所有页面使用同一个背景源
2. **自动同步**：修改背景后所有页面立即更新
3. **性能优化**：避免重复读取 localStorage
4. **易于维护**：集中管理背景逻辑
5. **类型安全**：完整的 TypeScript 支持

## 📝 待办事项

- [ ] 更新其他页面使用全局背景（Contacts、Discover、Me 等）
- [ ] 添加背景切换动画
- [ ] 支持多个背景预设
- [ ] 添加背景模糊度调节

## 🐛 已知问题

无

## 💡 提示

- 上传壁纸后会自动保存到 localStorage
- 刷新页面后壁纸会自动恢复
- 玻璃效果需要背景才能显示透明模糊效果
- 如果看不到壁纸，检查浏览器控制台的日志
