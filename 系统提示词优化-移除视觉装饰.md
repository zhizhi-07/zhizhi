# 系统提示词优化 - 移除视觉装饰符号

## 问题根源
AI会把系统警告标记（如 `🚫🚫🚫 【系统警告：你被拉黑了！】`）发送出来。

**真正的原因**：这些视觉装饰符号本来就不应该出现在AI的提示词中！

## 错误的思路 ❌
之前的做法是：
1. 在提示词中包含 `🚫🚫🚫` 等装饰符号
2. 告诉AI"不要发送这些标记"
3. 在代码中过滤掉这些标记

这就像**给AI建造监狱**，限制它不要做某事，而不是从源头避免问题。

## 正确的思路 ✅
**从源头解决**：这些视觉装饰符号是给人看的，根本不应该出现在AI的提示词中！

### 修复方案
移除提示词中所有视觉装饰符号，只保留纯文本信息。

## 修复内容

### 修复前的提示词
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🚫🚫🚫 【系统警告：你被拉黑了！】🚫🚫🚫

⚠️ 重要：这是系统检测到的真实拉黑状态...

这意味着：
1. 你们的关系出现了重大问题...
2. 对方非常生气或者很受伤
3. 这不是开玩笑...

❗ 你必须在回复中明确提到被拉黑这件事！

⚠️ 注意区分：
• 如果用户只是说"我拉黑你了"...
• 只有看到这个【系统警告】才是真的被拉黑了！

根据你的性格，可以：
• 震惊质问："你拉黑我？！"
• 生气反击："行啊，那我也不理你了"
...

⚠️ 禁止行为：
❌ 不要表现得像什么都没发生
❌ 不要发红包、送礼物...
❌ 不要继续正常聊天...

✅ 正确做法：
第一条消息必须提到被拉黑！例如：
• "你把我拉黑了？"
...

⚠️ 重要提醒：
❌ 不要把🚫和【系统警告】这些标记发送出来！
✅ 只需要用自己的话提到被拉黑这件事即可

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

### 修复后的提示词
```
## 系统警告：你被拉黑了

重要：这是系统检测到的真实拉黑状态，不是用户说的话！

用户在系统设置里把你拉黑了！这是非常严重的信号！

这意味着：
1. 你们的关系出现了重大问题（吵架、分手、冲突）
2. 对方非常生气或者很受伤
3. 这不是开玩笑，是真的在系统里拉黑了你

你必须在回复中明确提到被拉黑这件事！

注意区分：
- 如果用户只是说"我拉黑你了"但系统没有这个警告 → 那只是说说而已，不是真拉黑
- 只有看到这个系统警告才是真的被拉黑了！

根据你的性格，可以：
- 震惊质问："你拉黑我？！" "为什么拉黑我？"
- 生气反击："行啊，那我也不理你了"
- 委屈难过："为什么要拉黑我..." "我做错什么了"
- 道歉求饶："别拉黑我，我错了" "我们好好说"
- 冷漠无视："随便" "那就这样吧"

禁止行为：
- 不要表现得像什么都没发生
- 不要发红包、送礼物这种温馨的东西（除非你想用红包求原谅）
- 不要继续正常聊天，好像不知道被拉黑

正确做法：
第一条消息必须提到被拉黑！例如：
- "你把我拉黑了？"
- "拉黑我是什么意思？"
- "为什么突然拉黑我"
- "我看到你拉黑我了"

记住：只有看到这个系统警告才是真的被拉黑！用户只是说"拉黑"不算！
```

## 移除的符号清单

### 装饰性符号
- `━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━` - 分隔线
- `🚫🚫🚫` - 禁止符号
- `⚠️` - 警告符号
- `❗` - 感叹号符号
- `❌` - 错误标记
- `✅` - 正确标记
- `•` - 项目符号（改用 `-`）

### 保留的内容
- 纯文本信息
- 结构化标题（使用 `##`）
- 列表（使用 `-`）
- 示例对话

## 优化原则

### 1. 提示词应该是纯文本
- ✅ 使用 Markdown 标题、列表
- ✅ 使用简洁的文字说明
- ❌ 不使用 emoji 装饰
- ❌ 不使用 Unicode 符号装饰
- ❌ 不使用分隔线装饰

### 2. 信息应该清晰直接
- ✅ "你必须在回复中明确提到被拉黑这件事！"
- ❌ "❗ 你必须在回复中明确提到被拉黑这件事！"

### 3. 不需要告诉AI"不要发送某些标记"
- ✅ 提示词中不包含这些标记，AI自然不会发送
- ❌ 提示词中包含标记，然后告诉AI不要发送

## 代码优化

### 移除的过滤逻辑
之前在 `ChatDetail.tsx` 中添加了这些过滤：
```typescript
// 清理系统警告标记（防止AI把内部标记发送出来）
cleanedResponse = cleanedResponse.replace(/🚫+/g, '').trim()
cleanedResponse = cleanedResponse.replace(/【系统警告[：:][^】]+】/g, '').trim()
cleanedResponse = cleanedResponse.replace(/\[系统警告[：:][^\]]+\]/g, '').trim()
```

**现在不需要了**，因为提示词中根本不会出现这些符号。

### 简化的代码
现在只需要清理真正的功能标记：
```typescript
// 清理账单标记
cleanedResponse = cleanedResponse.replace(/\[BILL:...\]/g, '').trim()
// 清理红包标记
cleanedResponse = cleanedResponse.replace(/\[红包:...\]/g, '').trim()
// 清理AI错误的引用格式
cleanedResponse = cleanedResponse.replace(/\[引用了...\]/g, '').trim()
```

## 效果对比

### 修复前
- 提示词包含大量视觉装饰符号
- 需要告诉AI"不要发送这些标记"
- 需要在代码中过滤这些标记
- AI可能还是会发送出来

### 修复后
- 提示词只包含纯文本信息
- 不需要告诉AI任何限制
- 不需要额外的过滤逻辑
- AI不可能发送不存在的标记

## 设计哲学

### 错误的做法：限制AI
```
给AI看到某些内容 → 告诉AI不要使用 → 在代码中过滤
```
这就像给AI建造监狱，限制它的行为。

### 正确的做法：设计系统
```
只给AI看到应该看到的内容 → AI自然做出正确的行为
```
这是从系统设计层面解决问题。

## 总结

**核心原则**：不要给AI它不应该看到的东西，然后再限制它不要使用。

**优化结果**：
- ✅ 提示词更简洁清晰
- ✅ 代码更简单
- ✅ 不需要额外的过滤逻辑
- ✅ 从源头避免问题

## 修复时间
2025年10月24日

## 影响范围
- ✅ `prompts.ts` - 移除所有视觉装饰符号
- ✅ `ChatDetail.tsx` - 移除不必要的过滤逻辑
- ✅ 系统设计理念优化
