const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/utils-BkWlPcuZ.js","assets/react-vendor-D8ofYTc3.js","assets/vendor-BOALdufa.js"])))=>i.map(i=>d[i]);
import{j as e,r as t,u as s,a,b as r,R as l}from"./react-vendor-D8ofYTc3.js";import{u as n,a as i,b as c,c as o,d,e as x,i as m,f as h,g as u,h as g,j as p,k as f,l as b,m as j,n as v,o as y}from"./context-C_hada-q.js";import{w as N,x as w,y as k,g as C,b as S,c as I,z as _,A as M,B as z,C as L,D as $,E as A,F as T,G as D,H as E,I as B,J as P,K as F,L as O,M as W,N as R,O as U,P as V,Q as J,R as H,s as G,T as q,U as K,V as X,W as Z,X as Q,Y,Z as ee,_ as te,$ as se,a0 as ae,a1 as re,a2 as le,a3 as ne,a4 as ie,a5 as ce,a6 as oe,a7 as de,a8 as xe,a9 as me,aa as he,ab as ue,ac as ge,ad as pe,ae as fe,af as be,ag as je,ah as ve,ai as ye,aj as Ne,ak as we,al as ke,am as Ce,an as Se,ao as Ie,ap as _e,aq as Me,ar as ze,as as Le,at as $e,au as Ae,av as Te,aw as De,ax as Ee,ay as Be,az as Pe,aA as Fe,aB as Oe,aC as We,aD as Re,aE as Ue,aF as Ve,aG as Je,aH as He,aI as Ge,aJ as qe,aK as Ke,aL as Xe,aM as Ze,aN as Qe,aO as Ye,aP as et,aQ as tt,aR as st,aS as at,aT as rt,aU as lt,aV as nt,aW as it,aX as ct,aY as ot,aZ as dt,a_ as xt,a$ as mt,b0 as ht,b1 as ut,b2 as gt,b3 as pt,b4 as ft,b5 as bt,b6 as jt,b7 as vt,b8 as yt,b9 as Nt,ba as wt,bb as kt,bc as Ct,bd as St,be as It,bf as _t,bg as Mt,bh as zt,bi as Lt,bj as $t,bk as At,bl as Tt,bm as Dt,bn as Et,bo as Bt,bp as Pt,bq as Ft,br as Ot,bs as Wt,bt as Rt,bu as Ut,bv as Vt,bw as Jt,bx as Ht,by as Gt,bz as qt,k as Kt,bA as Xt,bB as Zt,bC as Qt,bD as Yt,bE as es}from"./utils-BkWlPcuZ.js";const ts={},ss=function(e,t,s){let a=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),s=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));a=Promise.allSettled(t.map(e=>{if((e=function(e){return"/zhizhi/"+e}(e))in ts)return;ts[e]=!0;const t=e.endsWith(".css"),a=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${a}`))return;const r=document.createElement("link");return r.rel=t?"stylesheet":"modulepreload",t||(r.as="script"),r.crossOrigin="",r.href=e,s&&r.setAttribute("nonce",s),document.head.appendChild(r),t?new Promise((t,s)=>{r.addEventListener("load",t),r.addEventListener("error",()=>s(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function r(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return a.then(t=>{for(const e of t||[])"rejected"===e.status&&r(e.reason);return e().catch(r)})},as=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M12 2C6.477 2 2 6.477 2 12c0 1.592.39 3.093 1.077 4.417L2.27 20.27a1 1 0 001.212 1.213l3.853-.806A9.958 9.958 0 0012 22c5.523 0 10-4.477 10-10S17.523 2 12 2z",fill:"currentColor"})}),rs=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2M9 11a4 4 0 100-8 4 4 0 000 8zM23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),ls=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M16 8l-5.586 5.586a2 2 0 01-2.828 0 2 2 0 010-2.828L13.172 5.172a2 2 0 012.828 0 2 2 0 010 2.828z",fill:"currentColor"})]}),ns=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2M12 11a4 4 0 100-8 4 4 0 000 8z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),is=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("circle",{cx:"11",cy:"11",r:"8",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M21 21l-4.35-4.35",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),cs=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M12 5v14M5 12h14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),os=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M15 18l-6-6 6-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),ds=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("circle",{cx:"12",cy:"5",r:"1.5",fill:"currentColor"}),e.jsx("circle",{cx:"12",cy:"12",r:"1.5",fill:"currentColor"}),e.jsx("circle",{cx:"12",cy:"19",r:"1.5",fill:"currentColor"})]}),xs=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),ms=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("rect",{x:"9",y:"2",width:"6",height:"11",rx:"3",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M5 10v2a7 7 0 0014 0v-2M12 19v3",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),hs=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2"}),e.jsx("circle",{cx:"8",cy:"10",r:"1.5",fill:"currentColor"}),e.jsx("circle",{cx:"16",cy:"10",r:"1.5",fill:"currentColor"}),e.jsx("path",{d:"M8 15s1.5 2 4 2 4-2 4-2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),us=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",stroke:"currentColor",strokeWidth:"2"}),e.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5",fill:"currentColor"}),e.jsx("path",{d:"M21 15l-5-5L5 21",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),gs=({size:t=120,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 120 120",fill:"none",className:s,children:[e.jsx("circle",{cx:"60",cy:"60",r:"50",fill:"currentColor",opacity:"0.1"}),e.jsx("path",{d:"M60 30v40M60 80v5",stroke:"currentColor",strokeWidth:"4",strokeLinecap:"round",opacity:"0.3"})]}),ps=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("circle",{cx:"9",cy:"7",r:"4",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M2 21v-2a5 5 0 015-5h4a5 5 0 015 5v2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("path",{d:"M19 8v6M16 11h6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),fs=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("circle",{cx:"9",cy:"7",r:"3",stroke:"currentColor",strokeWidth:"2"}),e.jsx("circle",{cx:"15",cy:"10",r:"3",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M3 20v-1a4 4 0 014-4h4a4 4 0 014 4v1M14 20v-1a4 4 0 014-4h1",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),bs=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("path",{d:"M20.59 13.41l-7.17 7.17a2 2 0 01-2.83 0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("circle",{cx:"7",cy:"7",r:"1.5",fill:"currentColor"})]}),js=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",stroke:"currentColor",strokeWidth:"2"}),e.jsx("circle",{cx:"8.5",cy:"8.5",r:"2",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M21 15l-5-5L5 21",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),vs=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z",stroke:"currentColor",strokeWidth:"1.8",strokeLinejoin:"round"}),e.jsx("circle",{cx:"9",cy:"9",r:"1.5",fill:"currentColor",opacity:"0.6"}),e.jsx("circle",{cx:"15",cy:"9",r:"1.5",fill:"currentColor",opacity:"0.6"})]}),ys=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("circle",{cx:"12",cy:"12",r:"3",fill:"currentColor"}),e.jsx("path",{d:"M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),Ns=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"3",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M8 8h8M8 12h8M8 16h5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),ws=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("rect",{x:"3",y:"3",width:"7",height:"7",rx:"1",stroke:"currentColor",strokeWidth:"2"}),e.jsx("rect",{x:"14",y:"3",width:"7",height:"7",rx:"1",stroke:"currentColor",strokeWidth:"2"}),e.jsx("rect",{x:"3",y:"14",width:"7",height:"7",rx:"1",stroke:"currentColor",strokeWidth:"2"}),e.jsx("rect",{x:"14",y:"14",width:"7",height:"7",rx:"1",stroke:"currentColor",strokeWidth:"2"})]}),ks=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z",stroke:"currentColor",strokeWidth:"2",strokeLinejoin:"round"})}),Cs=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("rect",{x:"2",y:"6",width:"20",height:"14",rx:"2",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M2 10h20",stroke:"currentColor",strokeWidth:"2"}),e.jsx("rect",{x:"16",y:"13",width:"3",height:"2",rx:"1",fill:"currentColor"})]}),Ss=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("circle",{cx:"12",cy:"12",r:"3",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),Is=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M12 8v8M8 12h8",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),_s=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("path",{d:"M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2v11z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("circle",{cx:"12",cy:"13",r:"4",stroke:"currentColor",strokeWidth:"2"})]}),Ms=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M4 7h16M12 7v8M9 15h6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("circle",{cx:"12",cy:"11",r:"2",fill:"currentColor"})]}),zs=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("path",{d:"M12 2v20M12 2l-4 4M12 2l4 4M12 22l-4-4M12 22l4-4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("circle",{cx:"12",cy:"12",r:"3",stroke:"currentColor",strokeWidth:"2"})]}),Ls=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),$s=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z",stroke:"currentColor",strokeWidth:"2"}),e.jsx("circle",{cx:"12",cy:"10",r:"3",stroke:"currentColor",strokeWidth:"2"})]}),As=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),Ts=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("rect",{x:"2",y:"5",width:"16",height:"14",rx:"2",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M18 10l4-2v8l-4-2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),Ds=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M14 9V5a3 3 0 00-3-3l-4 9v11h11.28a2 2 0 002-1.7l1.38-9a2 2 0 00-2-2.3H14zM3 11h3v11H3V11z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),Es=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2v10z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),Bs=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("circle",{cx:"12",cy:"5",r:"1.5",fill:"currentColor"}),e.jsx("circle",{cx:"12",cy:"12",r:"1.5",fill:"currentColor"}),e.jsx("circle",{cx:"12",cy:"19",r:"1.5",fill:"currentColor"})]}),Ps=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z",fill:"currentColor"})}),Fs=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("path",{d:"M4 4h16a2 2 0 012 2v12a2 2 0 01-2 2H4a2 2 0 01-2-2V6a2 2 0 012-2z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M2 10h20M7 15h5M7 11v8M17 11v8",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),Os=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("rect",{x:"7",y:"4",width:"10",height:"16",rx:"2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M11 5h2M11 19h2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("path",{d:"M4 8l-2 2 2 2M20 8l2 2-2 2M4 14l-2 2 2 2M20 14l2 2-2 2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),Ws=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("path",{d:"M9 18V5l12-2v13",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("circle",{cx:"6",cy:"18",r:"3",stroke:"currentColor",strokeWidth:"2"}),e.jsx("circle",{cx:"18",cy:"16",r:"3",stroke:"currentColor",strokeWidth:"2"})]}),Rs=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z",fill:"currentColor"})}),Us=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M5 3l14 9-14 9V3z",fill:"currentColor"})}),Vs=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",fill:"currentColor"}),e.jsx("rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",fill:"currentColor"})]}),Js=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("path",{d:"M5 4l10 8-10 8V4z",fill:"currentColor"}),e.jsx("path",{d:"M19 5v14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),Hs=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("path",{d:"M13 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V9l-7-7z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M13 2v7h7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),Gs=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M2 12h20M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z",stroke:"currentColor",strokeWidth:"2"})]}),qs=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M16 2v4M8 2v4M3 10h18",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),Ks=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("rect",{x:"2",y:"7",width:"20",height:"10",rx:"2",stroke:"currentColor",strokeWidth:"2"}),e.jsx("circle",{cx:"7",cy:"12",r:"1.5",fill:"currentColor"}),e.jsx("circle",{cx:"17",cy:"10",r:"1.5",fill:"currentColor"}),e.jsx("circle",{cx:"17",cy:"14",r:"1.5",fill:"currentColor"})]}),Xs=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9M13.73 21a2 2 0 01-3.46 0",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),Zs=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",fill:"currentColor"}),e.jsx("path",{d:"M15.54 8.46a5 5 0 010 7.07M19.07 4.93a10 10 0 010 14.14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),Qs=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z",fill:"currentColor"})}),Ys=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("circle",{cx:"12",cy:"12",r:"5",fill:"currentColor"}),e.jsx("path",{d:"M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),ea=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M7 11V7a5 5 0 0110 0v4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),ta=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),sa=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("rect",{x:"1",y:"16",width:"4",height:"8",fill:"currentColor"}),e.jsx("rect",{x:"7",y:"12",width:"4",height:"12",fill:"currentColor"}),e.jsx("rect",{x:"13",y:"8",width:"4",height:"16",fill:"currentColor"}),e.jsx("rect",{x:"19",y:"4",width:"4",height:"20",fill:"currentColor"})]}),aa=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("circle",{cx:"8",cy:"15",r:"4",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M11.5 12.5L21 3M21 3l-3 0M21 3l0 3",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M16 8l-1.5 1.5M13 11l-1.5 1.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),ra=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M21 10c0-4.97-4.03-9-9-9-4.97 0-9 4.03-9 9 0 4.97 4.03 9 9 9 2.39 0 4.56-.94 6.16-2.46M21 10v-4M21 10h-4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),la=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"4",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M12 7v10M7 12h10",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("circle",{cx:"12",cy:"12",r:"2",fill:"currentColor"}),e.jsx("path",{d:"M8 8l8 8M16 8l-8 8",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",opacity:"0.3"})]}),na=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M14 16c0 1.1.9 2 2 2s2-.9 2-2-.9-2-2-2-2 .9-2 2zM6 16c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2zM10 10c0 2.21-1.79 4-4 4s-4-1.79-4-4 1.79-4 4-4 4 1.79 4 4zM22 10c0 2.21-1.79 4-4 4s-4-1.79-4-4 1.79-4 4-4 4 1.79 4 4z",fill:"currentColor"})}),ia=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M7 20l4-16m2 16l4-16M6 9h14M4 15h14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),ca=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("circle",{cx:"9",cy:"21",r:"1",fill:"currentColor"}),e.jsx("circle",{cx:"20",cy:"21",r:"1",fill:"currentColor"}),e.jsx("path",{d:"M1 1h4l2.68 13.39a2 2 0 002 1.61h9.72a2 2 0 002-1.61L23 6H6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),oa=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M2 10h20M6 15h4M14 15h4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),da=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8l-6-6z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M14 2v6h6M8 13h8M8 17h8M8 9h2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),xa=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("rect",{x:"5",y:"2",width:"14",height:"20",rx:"2",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M12 18h.01",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),ma=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),ha=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M15 18l-6-6 6-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),ua=()=>{const[s,a]=t.useState(new Date),[r,l]=t.useState(()=>{const e=localStorage.getItem("focus_mode");return e?JSON.parse(e):null}),[n,i]=t.useState(()=>{const e=localStorage.getItem("time_settings");return e?JSON.parse(e):{showBg:!0,color:"#22c55e"}});t.useEffect(()=>{const e=setInterval(()=>{a(new Date)},1e3);return()=>clearInterval(e)},[]),t.useEffect(()=>{const e=N.observe("focus_mode",e=>{l(e?JSON.parse(e):null)}),t=N.observe("time_settings",e=>{i(e?JSON.parse(e):{showBg:!0,color:"#22c55e"})});return()=>{e(),t()}},[]);return e.jsxs("div",{className:"h-11 flex items-center justify-between pl-6 pr-2 text-sm font-semibold text-gray-900",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"tracking-tight px-2 py-0.5 rounded-full text-sm font-bold",style:{backgroundColor:!1!==n.showBg?n.color||"#22c55e":"transparent",color:!1!==n.showBg?"white":"#111827"},children:(c=s,`${c.getHours().toString().padStart(2,"0")}:${c.getMinutes().toString().padStart(2,"0")}`)}),r&&(r.icon||r.name)&&e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-full text-xs",style:{backgroundColor:!1!==r.showBg?r.color||"#9333ea":"transparent",color:!1!==r.showBg?"white":"#111827"},children:[r.icon&&e.jsx("img",{src:r.icon,alt:"ä¸“æ³¨æ¨¡å¼",className:"w-4 h-4 object-cover rounded"}),r.name&&e.jsx("span",{children:r.name})]})]}),e.jsx("div",{className:"flex-1"}),e.jsx("div",{className:"flex items-center",children:e.jsx("img",{src:"data:image/webp;base64,UklGRkoGAABXRUJQVlA4WAoAAAAQAAAAIwEAYQAAQUxQSBMFAAABoIdt+yG3+n6zipONVdsI6k3tNqpt27Ztxzmqbdvmqe02DTZZzHx/zMxmdmZ2j08iYgIgz/95/v9HvNrRxVlDicerVI3q1apaWKVqlfDwKuHsMN7QsNDQkNDQkJCQkMq8lYp7eKjsjoBG0ZGRbfNbjVRs2X3cil3nbj97fGXfxml9WjcuajUCvT/nGI0GCWZnZd2pamdod6Snp6dnPKtgFaduq/Z8SM/UG8w0IjJmY3ZWRvrDzasqWwe6ZD0dMkiaA4dt1i+1LzabkPNOacGUui2P0g1mzD1jMnzcHmqNrpmvi6qlqgn6DefYFSeQOyNUIK9OV9NNKLz5x8aKgvXNfF4MJByQRC+g7JC0EGG6X0hn0LrGlzOFevO+FEg6YMsHHzup1JEsGq2fc6qSIGPoeCVhFRJ/QS0QACoW99hHQ1/TaOn1hA0buePiE85ZgvTnXkIsZTyAHfc9TfyXCwBFwPunV7at+6+bf909Vmu9uEy08MOoVoFOjrxOTk5+DSZ94UPUjya5W8yoWXEGlCB9xQMAPBJtW+PHJpPJnLPYxUrKzUbkfxnjq1ZALim1V787fJgzQiGABgACv6Akv8XYvsjHDLIN632tMzsLeR8M81eAoCrX/nd40NBCIUw8LQ3mASv+pS1LYZD7Xbh1fC7xJBVTg4AE2Kr8k4xcL3SUQIw08DEryaZtQt4XIdYB7WnWh+5uBLipQhU7jJ0xfURseEECvOqKe1m/11CCMHFS+Z2V+AqACqwIxCZt5HtuLfA/jfigqhK4Y0emvs3U5xgMOfrMF9vGhXEBcRqahidDFCBDCa8AnMZmdAH7Bvwe3ytHAWfsnh8GE1poNrw/HK1kAagazgygQK4cR+MFR1vhXCmiZs26QeKDAC8KAEAZdiPbjLmms0815gBKDULKxij8sc5WzMvS6/X6p03EB2oNpQJq/XcGBaX1CQVZAstBEhfzwEbMMSKbeRchPkIcgdpuRMHNT1poZCyRC2kbkYK8keIDIAG7jGhh2oNrVx9Zgkx2lFL+0EYk8zWXAhS8hLy/LxhQO5+7e8HYwcsNPIghIF9JXMx9e4jkv85xJTpQraQAgCiUqsIT3nENcpCxRK609fIV0DgmqnV1J1kA8DuL+LqHOwWWEqXfgmxEHOQEcjcarzvJlluKwWg0GqY6ygP43thbWgG5Vta/hQMdQe6cJjJtQK61KWZkm0bIBBR2IcDtU6hYUQ0HUP5lNSBrSa8AqICyFJGriTRyp7eQCQKcLlFDPxgMht2DqyqATUDWtKkvAQAIyPZE5E1rLhMAQAj0PpppQkSkTZ83FyNgba5kqTy3RMZlCaDjJwb56ds+ItGmSeQCK8Uum6dHS9MDRQLrpHHNEwA84uyy4EsW9Xew2lJGxVLEXpTApSAAAO1vr+0xcL1kQW8NWN3zY6qCUgAQlwDR+7sDACiiv1ezy8DvDMOh7+cAInzzrARREpAqBZ57vxaVual8WZGsVL5IVhLf23DLssNEANqLHD00IMZmpteFQMKeO+g5IPMDcnge12Qt5vlahzXDyHO2OGsLz+2SYgDfy4g42AFESaLNr3RKyXjtoqcRuaPGZXC8bkpYyhUM630bwiIpXHcqANt9F8f9MBCn33kc5wQiJTGZ9ObJkyQ5ceouejYB2VeVq6vT6eoXBG73sNo6Xb3CBDj9qkXodLr6/sDtVy1Cp6vvA2INruUA4i23zMxINWMy5Pk/z///1goAVlA4IBABAABwDwCdASokAWIAPm02l0gkIyIhJ3MYAIANiWlu4XNBG168UwAUCAioKeend40gRUFPPTf+tXl0L9vtkCKgp51DGCOWbpGwUov6By4W8KepP30aKgprAL/dVPO4e4PtWqQwsq4TyxpAin/V377BgPvBaHvGkCKgp56d3jSBFQU89O7xiAAA/v9zmAcv9L4KD/EATxPgXfUTiTFLRfHIk2f/bBdCJxm4oN0+4ri4sYPBlzbRSfotbmxa7IzZpzz4myROaeYdk4XZf27IGLYtKTcBE/75nb///koAlWpPxl4LHa5sriMqug3S8BdM9Pa9fOb7dG5234y1fjiu6RS7Nv7rEOvmAAn/5Kd///JQAAAAAA==",alt:"çŠ¶æ€æ å›¾æ ‡",className:"h-9"})})]});var c},ga=()=>{const a=s(),{characters:r}=n(),{groups:l}=i(),{background:d,getBackgroundStyle:x}=c(),{showStatusBar:m}=o(),[h,u]=t.useState([]),[g,p]=t.useState(!1),[f,b]=t.useState(!1),[j,v]=t.useState(!1),[y,N]=t.useState({}),[z,L]=t.useState({});t.useEffect(()=>{if(g)return;(async()=>{try{const e=await C(S.SETTINGS,"chatList");if(e&&e.chats)return u(e.chats),void p(!0);const t=localStorage.getItem("chatList");if(t){const e=JSON.parse(t);u(e),await I(S.SETTINGS,{key:"chatList",chats:e}),localStorage.removeItem("chatList")}p(!0)}catch(e){try{const e=localStorage.getItem("chatList");e&&u(JSON.parse(e))}catch(t){}p(!0)}})()},[g]),t.useEffect(()=>{if(!g)return;const e=async e=>{const t=e,s=e,a="chatList"===t.key&&t.newValue,r=s.detail&&"chatlist-updated"===s.type;if(a||r)try{const e=await C(S.SETTINGS,"chatList");e&&e.chats&&u(e.chats)}catch(l){}};return window.addEventListener("storage",e),window.addEventListener("chatlist-updated",e),()=>{window.removeEventListener("storage",e),window.removeEventListener("chatlist-updated",e)}},[g]),t.useEffect(()=>{if(!g||0===h.length)return;(async()=>{try{await I(S.SETTINGS,{key:"chatList",chats:h})}catch(e){try{const e=h.slice(0,100);localStorage.setItem("chatList",JSON.stringify(e))}catch(t){alert("âš ï¸ å­˜å‚¨ç©ºé—´ä¸è¶³ï¼ŒèŠå¤©åˆ—è¡¨å¯èƒ½æ— æ³•ä¿å­˜ã€‚è¯·æ¸…ç†æµè§ˆå™¨ç¼“å­˜æˆ–å¯¼å‡ºé‡è¦æ•°æ®ã€‚")}}})()},[h,g]),t.useEffect(()=>{u(e=>{let t=[...e],s=!1;return l.forEach(e=>{const a=t.findIndex(t=>"group"===t.type&&t.groupId===e.id),r={id:e.id,groupId:e.id,type:"group",name:e.name,avatar:e.avatar,lastMessage:e.lastMessage||"å¼€å§‹ç¾¤èŠå§",time:e.lastMessageTime||(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),memberCount:e.members.length,unread:e.unread};if(a>=0){const l=t[a];l.lastMessage===r.lastMessage&&l.time===r.time&&l.memberCount===r.memberCount||(t[a]=r,e.disbanded||(t=[r,...t.filter((e,t)=>t!==a)]),s=!0)}else t=[r,...t],s=!0}),t.sort((e,t)=>{const s=l.find(t=>t.id===e.groupId),a=l.find(e=>e.id===t.groupId),r=(null==s?void 0:s.disbanded)??!1,n=(null==a?void 0:a.disbanded)??!1;return r&&!n?1:!r&&n?-1:0}),s?t:e})},[l]),t.useEffect(()=>{if(!g)return;(async()=>{try{await I(S.SETTINGS,{key:"chatList",chats:h})}catch(e){}})()},[h,g]),t.useEffect(()=>{const e=()=>{const e={},t={};h.forEach(s=>{if("single"===s.type&&s.characterId){const a=_(s.characterId);a>0&&(e[s.characterId]=a),t[s.characterId]=M(s.characterId)}else if("group"===s.type&&s.groupId){const t=_(s.groupId);t>0&&(e[s.groupId]=t)}}),N(e),L(t)};e();const t=setInterval(e,500);return()=>clearInterval(t)},[h]);const $=r.filter(e=>!h.some(t=>t.characterId===e.id)),A=t=>{const s=l.find(e=>e.id===t);if(!s)return null;const a=s.members.slice(0,9),r=a.length;let n="grid-cols-3",i="12px";return 1===r?(n="grid-cols-1",i="32px"):r<=4&&(n="grid-cols-2",i="16px"),e.jsx("div",{className:`w-14 h-14 rounded-2xl bg-white shadow-lg overflow-hidden grid ${n} gap-[1px] border border-gray-200`,children:a.map((t,s)=>{const a=t.avatar&&t.avatar.startsWith("data:image");return e.jsx("div",{className:"bg-gray-100 flex items-center justify-center",style:{fontSize:i},children:a?e.jsx("img",{src:t.avatar,alt:t.name,className:"w-full h-full object-cover"}):e.jsx("span",{children:t.avatar||"ðŸ¤–"})},s)})})};return e.jsxs("div",{className:"h-full flex flex-col relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 z-0",style:d?x():{background:"linear-gradient(to bottom, #f9fafb, #f3f4f6)"}}),e.jsxs("div",{className:"relative z-10 h-full flex flex-col bg-transparent",children:[e.jsxs("div",{className:"sticky top-0 z-50 "+(d?"glass-dark":"glass-effect"),children:[m&&e.jsx(ua,{}),e.jsxs("div",{className:"px-5 py-4 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a("/"),className:"text-xl font-semibold text-gray-900 ios-button",children:"å¾®ä¿¡"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{className:"ios-button text-gray-700 hover:text-gray-900",children:e.jsx(is,{size:22})}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>b(!f),className:"ios-button text-gray-700 hover:text-gray-900",children:e.jsx(cs,{size:22})}),f&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-30",onClick:()=>b(!1)}),e.jsxs("div",{className:"absolute right-0 top-full mt-2 w-44 glass-card rounded-2xl shadow-xl z-40 overflow-hidden",children:[e.jsxs("button",{onClick:()=>{b(!1),v(!0)},className:"w-full px-4 py-3.5 text-left text-gray-900 hover:bg-gray-50 ios-button border-b border-gray-100 flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-white border border-gray-200 flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-gray-600",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})})}),e.jsx("span",{className:"font-medium",children:"æ·»åŠ è”ç³»äºº"})]}),e.jsxs("button",{onClick:()=>{b(!1),a("/create-group")},className:"w-full px-4 py-3.5 text-left text-gray-900 hover:bg-gray-50 ios-button flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-white border border-gray-200 flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-gray-600",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"})})}),e.jsx("span",{className:"font-medium",children:"åˆ›å»ºç¾¤èŠ"})]})]})]})]})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto hide-scrollbar relative z-0 pt-3",children:0===h.length?e.jsxs("div",{className:"empty-state",children:[e.jsx(gs,{size:100,className:"text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-400 text-base mb-2",children:"æš‚æ— èŠå¤©"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"ç‚¹å‡»å³ä¸Šè§’ + æ·»åŠ è§’è‰²å¼€å§‹èŠå¤©"})]}):h.map(t=>{const s="group"===t.type,l=t.characterId?r.find(e=>e.id===t.characterId):null,n=s?t.name:(null==l?void 0:l.nickname)||(null==l?void 0:l.name)||t.name,i=s?t.avatar:(null==l?void 0:l.avatar)||t.avatar;return e.jsxs("div",{onClick:()=>a(s?`/group/${t.id}`:`/chat/${t.id}`),className:"flex items-center px-5 py-4 ios-button glass-card mb-2 mx-3 rounded-2xl cursor-pointer",children:[s&&t.groupId?A(t.groupId):e.jsx("div",{className:"w-14 h-14 rounded-2xl bg-gray-200 flex items-center justify-center flex-shrink-0 shadow-lg overflow-hidden",children:e.jsx("img",{src:w(i),alt:n,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1 ml-4 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-900",children:n}),s&&t.memberCount&&e.jsxs("span",{className:"text-xs text-gray-400",children:["(",t.memberCount,")"]}),!s&&t.characterId&&(()=>{const s=k(t.characterId);return s.currentStreak>0?e.jsxs("span",{className:"text-xs px-1.5 py-0.5 bg-orange-100 text-orange-600 rounded-md font-medium flex items-center gap-0.5",children:["ðŸ”¥ ",s.currentStreak]}):null})()]}),e.jsx("span",{className:"text-xs text-gray-400",children:t.time})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[t.characterId&&z[t.characterId]?e.jsx("p",{className:"text-sm text-green-500 truncate flex-1",children:"æ­£åœ¨è¾“å…¥..."}):e.jsx("p",{className:"text-sm text-gray-500 truncate flex-1",children:t.lastMessage&&(t.lastMessage.startsWith("ðŸ’¬ æˆ‘")||t.lastMessage.startsWith("ðŸ‘ æˆ‘")||t.lastMessage.startsWith("ðŸŽ™ï¸"))?"å¼€å§‹èŠå¤©å§":t.lastMessage}),(()=>{const s="group"===t.type?t.groupId?y[t.groupId]:0:t.characterId?y[t.characterId]:0;return s>0?e.jsx("span",{className:`ml-2 px-2 min-w-[20px] h-5 rounded-full text-xs text-white flex items-center justify-center ${t.muted?"bg-gray-400":"bg-red-500"} shadow-md`,children:s>99?"99+":s}):null})()]})]})]},t.id)})}),j&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:()=>v(!1)}),e.jsx("div",{className:"fixed inset-x-0 bottom-0 z-50 animate-slide-up",children:e.jsxs("div",{className:"glass-card rounded-t-3xl p-6 max-h-[70vh] overflow-y-auto hide-scrollbar",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"é€‰æ‹©è§’è‰²"}),e.jsx("button",{onClick:()=>v(!1),className:"text-gray-500 hover:text-gray-700 ios-button",children:"âœ•"})]}),0===$.length?e.jsxs("div",{className:"py-10 text-center",children:[e.jsx(gs,{size:80,className:"text-gray-400 mb-3 mx-auto"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"æš‚æ— å¯æ·»åŠ çš„è§’è‰²"}),e.jsx("button",{onClick:()=>{v(!1),a("/create-character")},className:"px-6 py-2 bg-wechat-primary text-white rounded-full ios-button",children:"åˆ›å»ºæ–°è§’è‰²"})]}):e.jsx("div",{className:"space-y-2",children:$.map(t=>e.jsxs("div",{onClick:()=>(e=>{const t=r.find(t=>t.id===e);if(!t)return;const s={id:e,characterId:e,type:"single",name:t.nickname||t.name,avatar:t.avatar,lastMessage:"å¼€å§‹èŠå¤©å§",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})};u(e=>[s,...e]),v(!1)})(t.id),className:"flex items-center p-4 glass-card rounded-2xl ios-button cursor-pointer hover:bg-gray-50",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gray-200 flex items-center justify-center flex-shrink-0 shadow-lg overflow-hidden",children:e.jsx("img",{src:w(t.avatar),alt:t.nickname||t.name,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"ml-3 flex-1 overflow-hidden",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:t.nickname||t.name}),t.signature&&e.jsx("p",{className:"text-sm text-gray-500 truncate",children:t.signature})]})]},t.id))}),$.length>0&&e.jsx("div",{className:"mt-4 text-center",children:e.jsx("button",{onClick:()=>{v(!1),a("/wechat/contacts")},className:"text-sm text-primary ios-button",children:"å‰å¾€é€šè®¯å½•ç®¡ç†è§’è‰²"})})]})})]})]})]})},pa=()=>{const t=s(),{characters:a}=n(),{background:r,getBackgroundStyle:l}=c(),{showStatusBar:i}=o(),d=[{id:1,name:"åˆ›å»ºè§’è‰²",Icon:ps,path:"/create-character"},{id:2,name:"ç¾¤èŠ",Icon:fs,path:"/group-list"},{id:3,name:"æ ‡ç­¾",Icon:bs,path:""}];return e.jsxs("div",{className:"h-full flex flex-col relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 z-0",style:l()}),e.jsxs("div",{className:"relative z-10 h-full flex flex-col bg-transparent",children:[e.jsxs("div",{className:"sticky top-0 z-50 "+(r?"glass-dark":"glass-effect"),children:[i&&e.jsx(ua,{}),e.jsxs("div",{className:"px-5 py-4 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>t("/"),className:"text-xl font-semibold text-gray-900 ios-button",children:"é€šè®¯å½•"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>{},className:"ios-button text-gray-700 hover:text-gray-900 cursor-pointer",children:e.jsx(is,{size:22})}),e.jsx("button",{onClick:()=>t("/create-character"),className:"ios-button text-gray-700 hover:text-gray-900 cursor-pointer",children:e.jsx(cs,{size:22})})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar relative z-0",children:[e.jsx("div",{className:"px-3 pt-3 pb-2",children:d.map(s=>{const a=s.Icon;return e.jsxs("div",{onClick:()=>{s.path&&t(s.path)},className:"flex items-center px-4 py-3 ios-button glass-card mb-2 rounded-2xl cursor-pointer hover:bg-white/90",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-white/80 backdrop-blur-sm flex items-center justify-center flex-shrink-0 shadow-lg border border-gray-200/50",children:e.jsx(a,{size:24,className:"text-gray-600"})}),e.jsx("span",{className:"ml-4 text-gray-900 font-medium",children:s.name})]},s.id)})}),0===a.length?e.jsxs("div",{className:"empty-state mt-10",children:[e.jsx(gs,{size:100,className:"text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-400 text-base",children:"æš‚æ— è”ç³»äºº"}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:'ç‚¹å‡»ä¸Šæ–¹"åˆ›å»ºè§’è‰²"æ·»åŠ AIè§’è‰²'})]}):e.jsx("div",{className:"px-3",children:a.map(s=>e.jsxs("div",{onClick:()=>t(`/character/${s.id}`),className:"flex items-center px-4 py-3 ios-button glass-card mb-2 rounded-2xl cursor-pointer",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0 shadow-lg overflow-hidden bg-gray-200",children:e.jsx("img",{src:w(s.avatar),alt:s.nickname||s.name,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"ml-4 flex-1 overflow-hidden",children:[e.jsx("h3",{className:"text-gray-900 font-medium",children:s.nickname||s.name}),s.signature&&e.jsx("p",{className:"text-sm text-gray-500 truncate mt-0.5",children:s.signature})]})]},s.id))})]})]})]})},fa=({show:s,onClose:a})=>{const{showStatusBar:r}=o(),[l,n]=t.useState([]),[i,c]=t.useState([]),[d,x]=t.useState(!1),[m,h]=t.useState({}),[u,g]=t.useState(!1);t.useEffect(()=>{s&&p()},[s]);const p=async()=>{try{const e=await z();n(e)}catch(e){n([])}},f=e=>new Promise((t,s)=>{const a=new FileReader;a.onload=e=>{var s;return t(null==(s=e.target)?void 0:s.result)},a.onerror=s,a.readAsDataURL(e)});return s?e.jsxs("div",{className:"fixed inset-0 bg-[#EDEDED] z-50 flex flex-col",children:[e.jsxs("div",{className:"glass-effect sticky top-0 z-50",children:[r&&e.jsx(ua,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:a,className:"text-gray-700 text-base",children:"è¿”å›ž"}),e.jsx("h1",{className:"text-base font-semibold text-gray-900",children:"è¡¨æƒ…åŒ…ç®¡ç†"}),e.jsx("div",{className:"w-12"})]})]}),e.jsx("div",{className:"px-4 py-3 glass-card mx-3 mt-3 rounded-2xl shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:["æ€»è®¡ï¼š",e.jsx("span",{className:"font-semibold text-gray-900",children:l.length})," ä¸ªè¡¨æƒ…åŒ…"]}),e.jsxs("span",{className:"text-gray-600",children:["å¤§å°ï¼š",e.jsxs("span",{className:"font-semibold text-gray-900",children:[(JSON.stringify(l).length/1024).toFixed(2)," KB"]})]})]})}),e.jsx("div",{className:"px-3 py-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("label",{className:"flex items-center justify-center px-4 py-2.5 glass-card text-gray-600 text-sm rounded-xl cursor-pointer active:bg-gray-100 shadow-lg border border-gray-200/50",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"æ‰¹é‡ä¸Šä¼ ",e.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:e=>{const t=Array.from(e.target.files||[]).filter(e=>e.type.startsWith("image/"));if(0===t.length)return void alert("è¯·é€‰æ‹©æœ‰æ•ˆçš„å›¾ç‰‡æ–‡ä»¶");c(t),x(!0);const s={};t.forEach((e,t)=>{s[t]=e.name.replace(/\.[^/.]+$/,"")}),h(s)},className:"hidden"})]}),e.jsxs("button",{onClick:async()=>{if(0!==l.length)try{const e=await L(),t=new Blob([e],{type:"application/json"}),s=URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download=`emojis-backup-${Date.now()}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(s),alert(`æˆåŠŸå¯¼å‡º ${l.length} ä¸ªè¡¨æƒ…åŒ…ï¼`)}catch(e){alert("å¯¼å‡ºå¤±è´¥ï¼Œå¯èƒ½æ˜¯æ— ç—•æ¨¡å¼é™åˆ¶")}else alert("æ²¡æœ‰è¡¨æƒ…åŒ…å¯ä»¥å¯¼å‡º")},className:"flex items-center justify-center px-4 py-2.5 glass-card text-gray-600 text-sm rounded-xl active:bg-gray-100 shadow-lg border border-gray-200/50",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"å¯¼å‡ºå¤‡ä»½"]}),e.jsxs("label",{className:"flex items-center justify-center px-4 py-2.5 glass-card text-gray-600 text-sm rounded-xl cursor-pointer active:bg-gray-100 shadow-lg border border-gray-200/50",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),"å¯¼å…¥å¤‡ä»½",e.jsx("input",{type:"file",accept:".json,application/json,text/json",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(!s)return;if(!s.name.endsWith(".json")&&"application/json"!==s.type)return alert("è¯·é€‰æ‹© JSON æ–‡ä»¶"),void(e.target.value="");const a=l.length;let r=!1;if(a>0){const e=confirm(`å½“å‰æœ‰ ${a} ä¸ªè¡¨æƒ…åŒ…\n\nç‚¹å‡»"ç¡®å®š"ï¼šè¿½åŠ å¯¼å…¥ï¼ˆä¿ç•™çŽ°æœ‰ï¼‰\nç‚¹å‡»"å–æ¶ˆ"ï¼šæ›¿æ¢å¯¼å…¥ï¼ˆæ¸…ç©ºçŽ°æœ‰ï¼‰\n\næç¤ºï¼šå¦‚æžœå­˜å‚¨ç©ºé—´ä¸è¶³ï¼Œå»ºè®®é€‰æ‹©"æ›¿æ¢å¯¼å…¥"`);r=!e}const n=new FileReader;n.onload=async e=>{var t;try{const s=await $(null==(t=e.target)?void 0:t.result,r);s.success?(await p(),alert(s.message)):alert(s.message)}catch(s){s instanceof Error&&"å¯¼å…¥è¶…æ—¶"===s.message?alert("âš ï¸ å¯¼å…¥å¤±è´¥\n\nåŽŸå› ï¼šå½“å‰å¤„äºŽæ— ç—•/éšç§æµè§ˆæ¨¡å¼\n\nè§£å†³æ–¹æ¡ˆï¼š\n1. ä½¿ç”¨æ™®é€šæµè§ˆæ¨¡å¼\n2. åœ¨æµè§ˆå™¨è®¾ç½®ä¸­å…è®¸å­˜å‚¨æ•°æ®"):alert("å¯¼å…¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼: "+(s instanceof Error?s.message:""))}},n.onerror=()=>{alert("è¯»å–æ–‡ä»¶å¤±è´¥")},n.readAsText(s),e.target.value=""},className:"hidden"})]}),e.jsxs("button",{onClick:async()=>{if(0!==l.length){if(confirm(`ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ ${l.length} ä¸ªè¡¨æƒ…åŒ…å—ï¼Ÿ\n\næ­¤æ“ä½œæ— æ³•æ’¤é”€ï¼å»ºè®®å…ˆå¯¼å‡ºå¤‡ä»½ã€‚`))try{await A(),await p(),alert("å·²æ¸…ç©ºæ‰€æœ‰è¡¨æƒ…åŒ…")}catch(e){alert("æ¸…ç©ºå¤±è´¥ï¼Œå¯èƒ½æ˜¯æ— ç—•æ¨¡å¼é™åˆ¶")}}else alert("æ²¡æœ‰è¡¨æƒ…åŒ…å¯ä»¥æ¸…ç©º")},className:"flex items-center justify-center px-4 py-2.5 glass-card text-gray-600 text-sm rounded-xl active:bg-gray-100 shadow-lg border border-gray-200/50",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"æ¸…ç©ºå…¨éƒ¨"]})]})}),d&&e.jsx("div",{className:"px-3 py-3",children:e.jsxs("div",{className:"glass-card rounded-2xl p-4 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["å·²é€‰æ‹© ",i.length," ä¸ªæ–‡ä»¶"]}),e.jsx("button",{onClick:()=>x(!1),className:"text-sm text-gray-600",children:"å–æ¶ˆ"})]}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto mb-3",children:i.map((t,s)=>e.jsxs("div",{className:"flex items-center gap-3 bg-white/80 p-2 rounded-xl border border-gray-200/50",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded flex-shrink-0 overflow-hidden",children:e.jsx("img",{src:URL.createObjectURL(t),alt:"",className:"w-full h-full object-cover"})}),e.jsx("input",{type:"text",value:m[s]||"",onChange:e=>h({...m,[s]:e.target.value}),placeholder:"è¾“å…¥æè¿°...",className:"flex-1 px-2 py-1 text-sm border border-gray-200 rounded"}),e.jsx("button",{onClick:()=>(e=>{const t=i.filter((t,s)=>s!==e);if(c(t),0===t.length)x(!1);else{const s={};t.forEach((t,a)=>{s[a]=m[a<e?a:a+1]||t.name.replace(/\.[^/.]+$/,"")}),h(s)}})(s),className:"text-red-500 text-xl w-8 h-8 flex items-center justify-center",children:"Ã—"})]},s))}),e.jsx("button",{onClick:async()=>{if(0!==i.length){g(!0);try{const{addEmoji:t}=await ss(async()=>{const{addEmoji:e}=await import("./utils-BkWlPcuZ.js").then(e=>e.bK);return{addEmoji:e}},__vite__mapDeps([0,1,2]));let s=0,a=0;for(let r=0;r<i.length;r++){const l=i[r];try{const e=await f(l);if(!(await t({url:e,name:l.name,description:m[r]||l.name.replace(/\.[^/.]+$/,"")}))){a++;break}s++}catch(e){a++}}c([]),x(!1),h({}),p()}catch(e){alert("æ‰¹é‡ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{g(!1)}}},disabled:u,className:"w-full py-2.5 bg-[#07C160] text-white text-sm rounded-xl disabled:opacity-50 shadow-lg",children:u?"ä¸Šä¼ ä¸­...":`ç¡®è®¤æ·»åŠ  ${i.length} ä¸ªè¡¨æƒ…åŒ…`})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-3 pb-4",children:0===l.length?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[e.jsxs("svg",{className:"w-16 h-16 mb-4",fill:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",opacity:"0.3"}),e.jsx("path",{d:"M8 14s1.5 2 4 2 4-2 4-2"}),e.jsx("circle",{cx:"9",cy:"9",r:"1"}),e.jsx("circle",{cx:"15",cy:"9",r:"1"})]}),e.jsx("div",{className:"text-sm mb-1",children:"è¿˜æ²¡æœ‰è¡¨æƒ…åŒ…"}),e.jsx("div",{className:"text-xs text-gray-300",children:'ç‚¹å‡»"æ‰¹é‡ä¸Šä¼ "æ·»åŠ è¡¨æƒ…åŒ…'})]}):e.jsx("div",{className:"grid grid-cols-3 gap-3",children:l.map(t=>e.jsxs("div",{className:"relative aspect-square rounded-xl overflow-hidden glass-card shadow-lg border border-gray-200/50 group",children:[e.jsx("img",{src:t.url,alt:t.description,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-2",children:e.jsx("div",{className:"text-white text-xs truncate",children:t.description})}),t.useCount>0&&e.jsxs("div",{className:"absolute top-2 left-2 bg-black/70 text-white text-xs px-2 py-0.5 rounded",children:[t.useCount,"æ¬¡"]}),e.jsx("button",{onClick:()=>(async e=>{if(confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè¡¨æƒ…åŒ…å—ï¼Ÿ"))try{await T(e),await p()}catch(t){alert("åˆ é™¤å¤±è´¥ï¼Œå¯èƒ½æ˜¯æ— ç—•æ¨¡å¼é™åˆ¶")}})(t.id),className:"absolute top-2 right-2 w-6 h-6 bg-red-500/90 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center text-sm shadow-lg",children:"Ã—"})]},t.id))})})]}):null},ba=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:s,children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M8 14s1.5 2 4 2 4-2 4-2"}),e.jsx("line",{x1:"9",y1:"9",x2:"9.01",y2:"9"}),e.jsx("line",{x1:"15",y1:"9",x2:"15.01",y2:"9"})]}),ja=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:s,children:[e.jsx("rect",{x:"2",y:"7",width:"20",height:"15",rx:"2",ry:"2"}),e.jsx("polyline",{points:"17 2 12 7 7 2"}),e.jsx("circle",{cx:"8",cy:"14",r:"1"}),e.jsx("circle",{cx:"16",cy:"14",r:"1"})]}),va=()=>{const a=s(),{background:r,getBackgroundStyle:l}=c(),{showStatusBar:n}=o(),[i,d]=t.useState(!1),x=[{id:1,items:[{id:11,name:"æœ‹å‹åœˆ",Icon:js,path:"/moments"},{id:12,name:"æƒ…ä¾£ç©ºé—´",Icon:vs,path:"/couple-space"}]},{id:2,items:[{id:21,name:"ç›´æ’­",Icon:ys,path:"/live"},{id:22,name:"æ‘‡ä¸€æ‘‡",Icon:Os,path:"/shake-shake"}]},{id:3,items:[{id:31,name:"è¡¨æƒ…åŒ…",Icon:ba,path:"",action:"emoji"},{id:32,name:"æœä¸€æœ",Icon:is,path:""}]},{id:4,items:[{id:41,name:"è®°è´¦æœ¬",Icon:Fs,path:"/accounting"},{id:42,name:"å°ç¨‹åº",Icon:Ns,path:"/mini-programs"}]},{id:5,items:[{id:51,name:"å°æ¸¸æˆ",Icon:ja,path:"/game-list"}]}];return e.jsxs("div",{className:"h-full flex flex-col relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 z-0",style:l()}),e.jsxs("div",{className:"relative z-10 h-full flex flex-col bg-transparent",children:[e.jsxs("div",{className:"sticky top-0 z-50 "+(r?"glass-dark":"glass-effect"),children:[n&&e.jsx(ua,{}),e.jsx("div",{className:"px-5 py-4",children:e.jsx("button",{onClick:()=>a("/"),className:"text-xl font-semibold text-gray-900 ios-button",children:"å‘çŽ°"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-3 pt-3",children:x.map(t=>e.jsx("div",{className:"mb-3",children:e.jsx("div",{className:"glass-card rounded-2xl overflow-hidden",children:t.items.map((s,r)=>{const l=s.Icon;return e.jsxs("div",{children:[e.jsxs("div",{onClick:()=>{"emoji"===s.action?d(!0):s.path&&a(s.path)},className:"flex items-center px-4 py-4 ios-button cursor-pointer",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl glass-card flex items-center justify-center flex-shrink-0 shadow-lg border border-gray-200/50",children:e.jsx(l,{size:22,className:"text-gray-600"})}),e.jsx("span",{className:"ml-4 flex-1 text-gray-900 font-medium",children:s.name}),e.jsx("span",{className:"text-gray-400 text-xl",children:"â€º"})]}),r<t.items.length-1&&e.jsx("div",{className:"ml-16 border-b border-gray-100"})]},s.id)})})},t.id))}),e.jsx(fa,{show:i,onClose:()=>d(!1)})]})]})},ya=()=>{const t=s(),{currentUser:a}=d(),{background:r,getBackgroundStyle:l}=c(),{showStatusBar:n}=o();(null==a?void 0:a.avatar)&&a.avatar.startsWith("data:image");const i=[{id:1,items:[{id:11,name:"æœåŠ¡",Icon:ws,path:"/services"}]},{id:2,items:[{id:21,name:"æ”¶è—",Icon:ks,path:""}]},{id:3,items:[{id:31,name:"è®¾ç½®",Icon:Ss,path:"/settings"}]}];return e.jsxs("div",{className:"h-full flex flex-col relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 z-0",style:l()}),e.jsxs("div",{className:"relative z-10 h-full flex flex-col bg-transparent",children:[e.jsxs("div",{className:"sticky top-0 z-50 "+(r?"glass-dark":"glass-effect"),children:[n&&e.jsx(ua,{}),e.jsx("div",{className:"px-5 py-4",children:e.jsx("button",{onClick:()=>t("/"),className:"text-xl font-semibold text-gray-900 ios-button",children:"æˆ‘"})})]}),e.jsx("div",{className:"px-3 pt-3 mb-3",children:e.jsx("div",{className:"glass-card rounded-2xl overflow-hidden",children:e.jsxs("div",{onClick:()=>t(`/profile/${(null==a?void 0:a.id)||"default"}`),className:"flex items-center px-5 py-5 ios-button cursor-pointer",children:[e.jsx("div",{className:"w-20 h-20 rounded-2xl bg-gray-200 flex items-center justify-center flex-shrink-0 shadow-xl overflow-hidden",children:e.jsx("img",{src:D(null==a?void 0:a.avatar),alt:"å¤´åƒ",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"ml-4 flex-1",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-1",children:(null==a?void 0:a.name)||"å¾®ä¿¡ç”¨æˆ·"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["å¾®ä¿¡å·: ",(null==a?void 0:a.username)||"wxid_123456"]})]}),e.jsx("span",{className:"text-gray-400 text-2xl",children:"â€º"})]})})}),e.jsx("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-3",children:i.map(s=>e.jsx("div",{className:"mb-3",children:e.jsx("div",{className:"glass-card rounded-2xl overflow-hidden",children:s.items.map((a,r)=>{const l=a.Icon;return e.jsxs("div",{children:[e.jsxs("div",{onClick:()=>{a.path&&t(a.path)},className:"flex items-center px-4 py-4 ios-button cursor-pointer",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl glass-card flex items-center justify-center flex-shrink-0 shadow-lg border border-gray-200/50",children:e.jsx(l,{size:22,className:"text-gray-600"})}),e.jsx("span",{className:"ml-4 flex-1 text-gray-900 font-medium",children:a.name}),e.jsx("span",{className:"text-gray-400 text-xl",children:"â€º"})]}),r<s.items.length-1&&e.jsx("div",{className:"ml-16 border-b border-gray-100"})]},a.id)})})},s.id))})]})]})},Na=({inviterName:s,songTitle:a,songArtist:r,songCover:l,onAccept:n,onReject:i,status:c="pending",isSent:o=!1})=>{const[d,x]=t.useState(c);return e.jsxs("div",{className:"bg-white/90 backdrop-blur-xl rounded-xl shadow-lg overflow-hidden max-w-[280px] border border-white/20",children:[e.jsxs("div",{className:"bg-white/60 backdrop-blur-md px-4 py-3 flex items-center gap-2 border-b border-gray-100/50",children:[e.jsx("svg",{className:"w-5 h-5 text-gray-700",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"})}),e.jsx("span",{className:"text-gray-800 font-medium text-sm",children:"ä¸€èµ·å¬é‚€è¯·"})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"text-sm text-gray-700 mb-3",children:[e.jsx("span",{className:"font-medium text-gray-900",children:s})," é‚€è¯·ä½ ä¸€èµ·å¬æ­Œ"]}),e.jsxs("div",{className:"flex items-center gap-3 mb-4 bg-white/50 backdrop-blur-sm rounded-lg p-3 border border-gray-100/50",children:[e.jsx("div",{className:"flex-shrink-0 w-12 h-12 rounded-lg overflow-hidden bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center",children:l?e.jsx("img",{src:l,alt:a,className:"w-full h-full object-cover"}):e.jsx("svg",{className:"w-6 h-6 text-gray-500",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:a}),e.jsx("div",{className:"text-xs text-gray-500 truncate",children:r})]}),e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx("span",{className:"w-0.5 h-3 bg-gray-400 rounded-full animate-pulse",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-0.5 h-4 bg-gray-400 rounded-full animate-pulse",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-0.5 h-2 bg-gray-400 rounded-full animate-pulse",style:{animationDelay:"300ms"}}),e.jsx("span",{className:"w-0.5 h-5 bg-gray-400 rounded-full animate-pulse",style:{animationDelay:"450ms"}})]})]}),"pending"===d&&(o?e.jsxs("div",{className:"text-center py-2 text-sm text-gray-500 font-medium flex items-center justify-center gap-1",children:[e.jsxs("svg",{className:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"ç­‰å¾…å¯¹æ–¹æŽ¥å—..."]}):e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{x("rejected"),null==i||i()},className:"flex-1 px-4 py-2 bg-white/50 backdrop-blur-sm text-gray-700 rounded-full text-sm font-medium ios-button hover:bg-white/70 transition-all border border-gray-200/50",children:"æ‹’ç»"}),e.jsx("button",{onClick:()=>{x("accepted"),null==n||n()},className:"flex-1 px-4 py-2 bg-white backdrop-blur-xl text-gray-900 rounded-full text-sm font-medium ios-button shadow-md hover:shadow-lg transition-all border border-gray-300/50",children:"æŽ¥å—"})]})),"accepted"===d&&e.jsxs("div",{className:"text-center py-2 text-sm text-green-600 font-medium flex items-center justify-center gap-1",children:[e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"å·²æŽ¥å—é‚€è¯·"]}),"rejected"===d&&e.jsx("div",{className:"text-center py-2 text-sm text-gray-500 font-medium",children:"å·²æ‹’ç»"})]})]})},wa=({onClose:s,onSend:a})=>{const{playlist:r}=x(),[l,n]=t.useState("library"),[i,c]=t.useState(""),[o,d]=t.useState("");return e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:s,className:"fixed inset-0 bg-black/40 backdrop-blur-sm z-50"}),e.jsxs("div",{className:"fixed inset-x-0 bottom-0 z-50 bg-white rounded-t-3xl shadow-2xl animate-slide-up",children:[e.jsx("div",{className:"flex justify-center pt-3 pb-2",children:e.jsx("div",{className:"w-12 h-1 bg-gray-300 rounded-full"})}),e.jsxs("div",{className:"px-6 py-3 border-b border-gray-100",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"é‚€è¯·ä¸€èµ·å¬æ­Œ"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"é€‰æ‹©ä¸€é¦–æ­Œæ›²å‘é€é‚€è¯·"})]}),e.jsxs("div",{className:"flex border-b border-gray-100",children:[e.jsxs("button",{onClick:()=>n("library"),className:"flex-1 py-3 text-sm font-medium transition-colors "+("library"===l?"text-blue-600 border-b-2 border-blue-600":"text-gray-500"),children:["æˆ‘çš„éŸ³ä¹åº“ (",r.length,")"]}),e.jsx("button",{onClick:()=>n("input"),className:"flex-1 py-3 text-sm font-medium transition-colors "+("input"===l?"text-blue-600 border-b-2 border-blue-600":"text-gray-500"),children:"æ‰‹åŠ¨è¾“å…¥"})]}),e.jsx("div",{className:"max-h-[60vh] overflow-y-auto",children:"library"===l?e.jsx("div",{className:"px-4 py-2",children:0===r.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-4xl mb-3",children:"ðŸŽµ"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"éŸ³ä¹åº“ä¸ºç©º"}),e.jsx("p",{className:"text-gray-400 text-xs mt-1",children:"è¯·å…ˆä¸Šä¼ æ­Œæ›²æˆ–åˆ‡æ¢åˆ°æ‰‹åŠ¨è¾“å…¥"})]}):e.jsx("div",{className:"space-y-2",children:r.map(t=>e.jsxs("button",{onClick:()=>(e=>{a(e.title,e.artist,e.cover),s()})(t),className:"w-full flex items-center gap-3 p-3 rounded-xl hover:bg-gray-50 active:bg-gray-100 transition-colors ios-button",children:[e.jsx("div",{className:"flex-shrink-0 w-12 h-12 rounded-lg overflow-hidden bg-gradient-to-br from-gray-100 to-gray-200",children:t.cover?e.jsx("img",{src:t.cover,alt:t.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-gray-400",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"})})})}),e.jsxs("div",{className:"flex-1 text-left min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 truncate",children:t.title}),e.jsx("div",{className:"text-sm text-gray-500 truncate",children:t.artist})]}),e.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]},t.id))})}):e.jsx("div",{className:"px-6 py-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["æ­Œæ›²åç§° ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:i,onChange:e=>c(e.target.value),placeholder:"ä¾‹å¦‚ï¼šæ™´å¤©",className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["æ­Œæ‰‹ ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:o,onChange:e=>d(e.target.value),placeholder:"ä¾‹å¦‚ï¼šå‘¨æ°ä¼¦",className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-100 rounded-xl p-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),e.jsx("p",{className:"text-xs text-blue-700",children:"æ‰‹åŠ¨è¾“å…¥çš„æ­Œæ›²ä¼šå°è¯•ä»ŽéŸ³ä¹åº“ä¸­åŒ¹é…æ’­æ”¾ï¼Œå¦‚æžœæ‰¾ä¸åˆ°åˆ™ä½¿ç”¨é»˜è®¤å°é¢"})]})}),e.jsx("button",{onClick:()=>{i.trim()&&o.trim()?(a(i.trim(),o.trim()),s()):alert("è¯·è¾“å…¥æ­Œæ›²åå’Œæ­Œæ‰‹")},disabled:!i.trim()||!o.trim(),className:"w-full py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl font-medium ios-button shadow-lg disabled:opacity-50 disabled:cursor-not-allowed",children:"å‘é€é‚€è¯·"})]})})}),e.jsx("div",{className:"h-safe"})]})]})},ka=({songTitle:t,songArtist:s,songCover:a,onClick:r})=>e.jsxs("div",{className:"bg-white/90 backdrop-blur-xl rounded-xl shadow-lg overflow-hidden max-w-[280px] border border-white/20 cursor-pointer hover:shadow-xl transition-shadow",onClick:r,children:[e.jsxs("div",{className:"bg-white/60 backdrop-blur-md px-4 py-3 flex items-center gap-2 border-b border-gray-100/50",children:[e.jsx("svg",{className:"w-5 h-5 text-gray-700",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"})}),e.jsx("span",{className:"text-gray-800 font-medium text-sm",children:"éŸ³ä¹åˆ†äº«"})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 bg-white/50 backdrop-blur-sm rounded-lg p-3 border border-gray-100/50",children:[e.jsx("div",{className:"flex-shrink-0 w-12 h-12 rounded-lg overflow-hidden bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center",children:a?e.jsx("img",{src:a,alt:t,className:"w-full h-full object-cover"}):e.jsx("svg",{className:"w-6 h-6 text-gray-500",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:t}),e.jsx("div",{className:"text-xs text-gray-500 truncate",children:s})]}),e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx("span",{className:"w-0.5 h-3 bg-gray-400 rounded-full animate-pulse",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-0.5 h-4 bg-gray-400 rounded-full animate-pulse",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-0.5 h-2 bg-gray-400 rounded-full animate-pulse",style:{animationDelay:"300ms"}}),e.jsx("span",{className:"w-0.5 h-5 bg-gray-400 rounded-full animate-pulse",style:{animationDelay:"450ms"}})]})]}),e.jsx("div",{className:"text-xs text-gray-400 text-center mt-2",children:"ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…"})]})]});async function Ca(e,t=50){try{const s=await async function(e,t=50){var s,a;try{let r,l;r="https://c.y.qq.com/soso/fcgi-bin/client_search_cp",l=new URLSearchParams({ct:"24",qqmusic_ver:"1298",new_json:"1",remoteplace:"txt.yqq.song",searchid:Math.random().toString(),t:"0",aggr:"1",cr:"1",catZhida:"1",lossless:"0",flag_qc:"0",p:"1",n:t.toString(),w:e,g_tk:"5381",loginUin:"0",hostUin:"0",format:"json",inCharset:"utf8",outCharset:"utf-8",notice:"0",platform:"yqq.json",needNewCode:"0"});const n=await fetch(`${r}?${l}`,{method:"GET"});if(!n.ok)return[];const i=await n.json();return(null==(a=null==(s=i.data)?void 0:s.song)?void 0:a.list)?i.data.song.list.map(e=>{var t;return{id:e.songmid||e.songid,name:e.songname||e.name,artists:(null==(t=e.singer)?void 0:t.map(e=>e.name).join(" / "))||"æœªçŸ¥",album:e.albumname||"æœªçŸ¥ä¸“è¾‘",duration:e.interval||0,cover:e.albummid?`https://y.gtimg.cn/music/photo_new/T002R300x300M000${e.albummid}.jpg`:"",fee:0}}):[]}catch(r){return[]}}(e,t);if(s.length>0)return s}catch(s){}try{const e=await async function(){return[]}(0,t);if(e.length>0)return e}catch(s){}return[]}async function Sa(e,t=50){try{let t,s;!1||(t="https://zhizhi-api.2373922440jhj.workers.dev/api/music/search",s=new URLSearchParams({keyword:e}));const a=await fetch(`${t}?${s}`,{method:"GET"});if(!a.ok)throw new Error("ç½‘æ˜“äº‘APIè¯·æ±‚å¤±è´¥");const r=await a.json();if(r.result&&r.result.songs)return r.result.songs.map(e=>({id:e.id,name:e.name,artists:e.artists.map(e=>e.name).join(" / "),album:e.album.name,duration:Math.floor(e.duration/1e3),cover:e.album.picUrl,fee:e.fee}));throw new Error("ç½‘æ˜“äº‘APIè¿”å›žç©ºç»“æžœ")}catch(s){try{const s=await Ca(e,t);if(s.length>0)return s}catch(a){}return[]}}async function Ia(e){try{let t,s;!1||(t="https://zhizhi-api.2373922440jhj.workers.dev/api/music/url",s=new URLSearchParams({id:e.toString()}));const a=await fetch(`${t}?${s}`,{method:"GET"});if(!a.ok)return null;const r=await a.json();return r.data&&r.data.length>0&&r.data[0].url?r.data[0].url:null}catch(t){return async function(e){try{return`https://ws.stream.qqmusic.qq.com/C400${"string"==typeof e?e:e.toString()}.m4a?guid=0&vkey=&uin=0&fromtag=120032`}catch(t){return null}}(e)}}async function _a(e){try{let t,s;!1||(t="https://zhizhi-api.2373922440jhj.workers.dev/api/music/lyric",s=new URLSearchParams({id:e.toString()}));const a=await fetch(`${t}?${s}`,{method:"GET"});if(!a.ok)return null;const r=await a.json();return r.lrc&&r.lrc.lyric?r.lrc.lyric:null}catch(t){return null}}const Ma=({songTitle:a,songArtist:r,songCover:l,isOpen:n,onClose:i})=>{const c=s(),o=x(),[d,m]=t.useState(!1),[h,u]=t.useState(!1);t.useEffect(()=>(document.body.style.overflow=n?"hidden":"",()=>{document.body.style.overflow=""}),[n]);const g=()=>{m(!0),setTimeout(()=>{m(!1),i()},300)};return n||d?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 transition-all duration-300 "+(d?"opacity-0":"opacity-100"),onClick:g,children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm"}),e.jsxs("div",{className:"relative bg-white/95 backdrop-blur-xl rounded-3xl shadow-2xl max-w-md w-full overflow-hidden transform transition-all duration-300 "+(d?"scale-95 opacity-0":"scale-100 opacity-100"),onClick:e=>e.stopPropagation(),children:[e.jsx("button",{onClick:g,className:"absolute top-4 right-4 z-10 w-8 h-8 rounded-full bg-black/20 hover:bg-black/30 flex items-center justify-center transition-colors",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"relative h-64 bg-gradient-to-br from-purple-400 via-pink-400 to-red-400",children:[l?e.jsx("img",{src:l,alt:a,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("svg",{className:"w-24 h-24 text-white/60",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"})})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent"})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2 leading-tight",children:a}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 mb-6",children:[e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})}),e.jsx("span",{className:"text-lg",children:r})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:async()=>{u(!0);try{const e=`${a} ${r}`,t=await Sa(e);if(0===t.length)return alert("æœªæ‰¾åˆ°è¯¥æ­Œæ›²ï¼Œè¯·å°è¯•å…¶ä»–æœç´¢æ–¹å¼"),void u(!1);const s=t[0],l=await Ia(s.id);if(!l)return alert("æ— æ³•èŽ·å–æ’­æ”¾é“¾æŽ¥ï¼Œè¯¥æ­Œæ›²å¯èƒ½æš‚æ—¶æ— æ³•æ’­æ”¾"),void u(!1);const n=await _a(s.id),i={id:s.id,title:s.name,artist:s.artists,album:s.album,duration:s.duration,cover:s.cover,audioUrl:l,lyrics:n||void 0};o.setPlaylist([i]),o.setCurrentSong(i,0),o.play(),g(),setTimeout(()=>{c("/music-player")},100)}catch(e){alert("æ’­æ”¾å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{u(!1)}},disabled:h,className:"flex-1 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-full py-3 px-6 font-medium shadow-lg hover:shadow-xl transition-all flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:h?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"æœç´¢ä¸­..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M8 5v14l11-7z"})}),"æ’­æ”¾"]})}),e.jsxs("button",{onClick:()=>{const e=`${a} - ${r}`;navigator.clipboard.writeText(e),alert("å·²å¤åˆ¶æ­Œæ›²ä¿¡æ¯")},className:"bg-gray-100 text-gray-700 rounded-full py-3 px-6 font-medium hover:bg-gray-200 transition-colors flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),"å¤åˆ¶"]})]}),e.jsx("p",{className:"text-xs text-gray-400 text-center mt-4",children:h?"æ­£åœ¨æœç´¢æ­Œæ›²...":"ç‚¹å‡»æ’­æ”¾æŒ‰é’®åœ¨çº¿æœç´¢å¹¶æ’­æ”¾"})]})]})]}):null},za=({onClose:t,onSelectImage:s,onSelectCamera:a,onSelectRedPacket:r,onSelectTransfer:l,onSelectIntimatePay:n,onSelectCoupleSpaceInvite:i,onSelectCoupleSpaceContent:c,onSelectLocation:o,onSelectVoiceMessage:d,onSelectVoiceCall:x,onSelectVideoCall:m,onSelectXiaohongshu:h,onSelectMusicInvite:u,onRegenerateAI:g,hasCoupleSpace:p})=>{const f=[{id:"image",label:"ç›¸å†Œ",Icon:us,onClick:s},{id:"camera",label:"æ‹æ‘„",Icon:_s,onClick:a},{id:"xiaohongshu",label:"å°çº¢ä¹¦",Icon:la,onClick:h},{id:"redpacket",label:"çº¢åŒ…",Icon:Ms,onClick:r},{id:"transfer",label:"è½¬è´¦",Icon:zs,onClick:l},{id:"intimate-pay",label:"äº²å¯†ä»˜",Icon:Ls,onClick:n},{id:"couple-space",label:"æƒ…ä¾£ç©ºé—´",Icon:vs,onClick:()=>{p?c():i()}},{id:"voice-msg",label:"è¯­éŸ³",Icon:ms,onClick:d},{id:"voice",label:"è¯­éŸ³é€šè¯",Icon:As,onClick:x},{id:"video",label:"è§†é¢‘é€šè¯",Icon:Ts,onClick:m},{id:"music-invite",label:"ä¸€èµ·å¬",Icon:Ws,onClick:u},{id:"location",label:"ä½ç½®",Icon:$s,onClick:o},{id:"regenerate",label:"é‡å›ž",Icon:ra,onClick:g}];return e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:t,className:"fixed inset-0 bg-black bg-opacity-30 z-40",style:{bottom:0}}),e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 glass-effect border-t border-gray-200/50 z-50 pb-safe animate-slide-up",children:[e.jsx("div",{className:"w-full mx-auto px-6 py-8",children:e.jsx("div",{className:"grid grid-cols-4 gap-6",children:f.map(s=>{const a=s.Icon;return e.jsxs("button",{onClick:e=>{e.stopPropagation(),s.onClick(),t()},className:"flex flex-col items-center gap-3 ios-button",children:[e.jsx("div",{className:"w-14 h-14 glass-card rounded-2xl flex items-center justify-center shadow-md border border-gray-200/50 hover:shadow-lg transition-all",children:e.jsx(a,{size:26,className:"text-gray-700"})}),e.jsx("span",{className:"text-[13px] text-gray-700 font-medium",children:s.label})]},s.id)})})}),e.jsx("div",{className:"flex justify-center pt-1 pb-3",children:e.jsx("div",{className:"w-32 h-1 bg-gray-900 rounded-full opacity-30"})})]})]})},La=({show:t,character:s,isVideoCall:a,onAccept:r,onReject:l})=>t?e.jsxs("div",{className:"fixed top-20 left-1/2 transform -translate-x-1/2 z-50 w-[90%] max-w-sm animate-slide-down",children:[e.jsx("div",{className:"rounded-[28px] p-5 border",style:{background:"linear-gradient(135deg, rgba(60, 60, 70, 0.85) 0%, rgba(45, 45, 55, 0.90) 100%)",backdropFilter:"blur(40px) saturate(180%)",WebkitBackdropFilter:"blur(40px) saturate(180%)",borderColor:"rgba(255, 255, 255, 0.18)",boxShadow:"\n            0 20px 60px -12px rgba(0, 0, 0, 0.5),\n            0 8px 20px -6px rgba(0, 0, 0, 0.3),\n            inset 0 1px 0 0 rgba(255, 255, 255, 0.2),\n            inset 0 -1px 0 0 rgba(0, 0, 0, 0.2)\n          "},children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"relative w-14 h-14 rounded-full overflow-hidden flex-shrink-0",style:{background:"linear-gradient(135deg, rgba(80, 80, 90, 0.9), rgba(60, 60, 70, 0.9))",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3), inset 0 1px 2px rgba(255, 255, 255, 0.1)"},children:s.avatar?s.avatar.startsWith("data:image")||s.avatar.startsWith("http")?e.jsx("img",{src:s.avatar,alt:s.name,className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-2xl flex items-center justify-center h-full",children:s.avatar}):e.jsx("span",{className:"text-white text-lg font-semibold flex items-center justify-center h-full",children:s.name.charAt(0)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-[17px] truncate mb-0.5",style:{color:"rgba(255, 255, 255, 0.95)",textShadow:"0 1px 2px rgba(0, 0, 0, 0.3)"},children:s.name}),e.jsx("p",{className:"text-[13px]",style:{color:"rgba(255, 255, 255, 0.65)",textShadow:"0 1px 1px rgba(0, 0, 0, 0.2)"},children:a?"è§†é¢‘é€šè¯":"è¯­éŸ³é€šè¯"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:r,className:"w-[52px] h-[52px] rounded-full flex items-center justify-center transition-all active:scale-95",style:{background:"linear-gradient(135deg, #34C759 0%, #30B350 100%)",boxShadow:"\n                  0 4px 16px rgba(52, 199, 89, 0.4),\n                  0 2px 8px rgba(0, 0, 0, 0.3),\n                  inset 0 1px 0 rgba(255, 255, 255, 0.25)\n                "},children:e.jsx("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"white",style:{filter:"drop-shadow(0 1px 1px rgba(0, 0, 0, 0.2))"},children:e.jsx("path",{d:"M20.01 15.38c-1.23 0-2.42-.2-3.53-.56-.35-.12-.74-.03-1.01.24l-1.57 1.97c-2.83-1.35-5.48-3.9-6.89-6.83l1.95-1.66c.27-.28.35-.67.24-1.02-.37-1.11-.56-2.3-.56-3.53 0-.54-.45-.99-.99-.99H4.19C3.65 3 3 3.24 3 3.99 3 13.28 10.73 21 20.01 21c.71 0 .99-.63.99-1.18v-3.45c0-.54-.45-.99-.99-.99z"})})}),e.jsx("button",{onClick:l,className:"w-[52px] h-[52px] rounded-full flex items-center justify-center transition-all active:scale-95",style:{background:"linear-gradient(135deg, #FF3B30 0%, #E8352A 100%)",boxShadow:"\n                  0 4px 16px rgba(255, 59, 48, 0.4),\n                  0 2px 8px rgba(0, 0, 0, 0.3),\n                  inset 0 1px 0 rgba(255, 255, 255, 0.25)\n                "},children:e.jsx("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"white",style:{filter:"drop-shadow(0 1px 1px rgba(0, 0, 0, 0.2))"},children:e.jsx("path",{d:"M12,9C10.4,9,8.85,9.25,7.4,9.72v2.09C7.4,12.46,6.86,13,6.21,13H3.78c-0.65,0-1.18-0.54-1.18-1.18v-1.09 C2.6,5.88,6.88,1.6,11.73,1.6h0.55c4.85,0,9.13,4.28,9.13,9.13v1.09c0,0.65-0.54,1.18-1.18,1.18h-2.43 c-0.65,0-1.18-0.54-1.18-1.18V9.72C15.15,9.25,13.6,9,12,9z"})})})]})]})}),e.jsx("style",{children:"\n        @keyframes slide-down {\n          from {\n            opacity: 0;\n            transform: translate(-50%, -20px);\n          }\n          to {\n            opacity: 1;\n            transform: translate(-50%, 0);\n          }\n        }\n        .animate-slide-down {\n          animation: slide-down 0.3s ease-out forwards;\n        }\n      "})]}):null,$a=({show:s,onClose:a,onSend:r,characterId:l,characterName:n})=>{const[i,c]=t.useState(""),[o,d]=t.useState("æ­å–œå‘è´¢ï¼Œå¤§å‰å¤§åˆ©"),[x,m]=t.useState(!1),[h,u]=t.useState([]),[g,p]=t.useState("");t.useEffect(()=>{if(s){const e=E().filter(e=>"character_to_user"===e.type).map(e=>({id:e.characterId,name:e.characterName,remaining:e.monthlyLimit-e.usedAmount})).filter(e=>e.remaining>0);if(u(e),e.length>0){const t=(l?e.find(e=>e.id===l):null)||e[0];p(t.id),m(!0)}else m(!1),p("")}},[s]);const f=()=>{c(""),d("æ­å–œå‘è´¢ï¼Œå¤§å‰å¤§åˆ©"),m(!1),p(""),a()};return s?e.jsx("div",{className:"red-packet-modal "+(s?"show":""),onClick:e=>{e.target===e.currentTarget&&f()},children:e.jsxs("div",{className:"red-packet-panel",children:[e.jsx("div",{className:"red-packet-header",children:e.jsx("div",{className:"red-packet-title",children:"å‘çº¢åŒ…"})}),e.jsxs("div",{className:"red-packet-form",children:[e.jsxs("div",{className:"red-packet-field",children:[e.jsx("label",{className:"red-packet-label",children:"é‡‘é¢"}),e.jsx("input",{type:"text",className:"red-packet-input",placeholder:"è¯·è¾“å…¥é‡‘é¢",value:i,onChange:e=>{let t=e.target.value.replace(/[^\d.]/g,"");const s=t.split(".");s.length>2&&(t=s[0]+"."+s.slice(1).join("")),s[1]&&s[1].length>2&&(t=s[0]+"."+s[1].substring(0,2)),c(t)},autoFocus:!0}),e.jsxs("div",{className:"red-packet-hint",children:["æœ€å¤šÂ¥",200,"å…ƒ"]})]}),e.jsxs("div",{className:"red-packet-field",children:[e.jsx("label",{className:"red-packet-label",children:"ç¥ç¦è¯­"}),e.jsx("input",{type:"text",className:"red-packet-input",placeholder:"æ­å–œå‘è´¢ï¼Œå¤§å‰å¤§åˆ©",value:o,onChange:e=>d(e.target.value),maxLength:20})]}),h.length>0&&e.jsxs("div",{className:"red-packet-field",children:[e.jsxs("label",{className:"flex items-center cursor-pointer mb-2",children:[e.jsx("input",{type:"checkbox",checked:x,onChange:e=>m(e.target.checked),className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-700 font-medium",children:"ä½¿ç”¨äº²å¯†ä»˜"})]}),x&&e.jsx("select",{value:g,onChange:e=>p(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-red-500",children:h.map(t=>e.jsxs("option",{value:t.id,children:[t.name,"çš„äº²å¯†ä»˜ï¼ˆå‰©ä½™ï¿¥",t.remaining.toFixed(2),"ï¼‰"]},t.id))})]}),e.jsxs("div",{className:"red-packet-buttons",children:[e.jsx("button",{className:"red-packet-btn red-packet-btn-cancel",onClick:f,children:"å–æ¶ˆ"}),e.jsx("button",{className:"red-packet-btn red-packet-btn-send",onClick:()=>{const e=parseFloat(i);if(!e||e<=0)return void alert("è¯·è¾“å…¥æœ‰æ•ˆé‡‘é¢");if(e>200)return void alert("æœ€å¤šÂ¥200å…ƒ");if(x){const t=h.find(e=>e.id===g);if(!t)return void alert("è¯·é€‰æ‹©è¦ä½¿ç”¨çš„äº²å¯†ä»˜");if(e>t.remaining)return void alert(`${t.name}çš„äº²å¯†ä»˜å‰©ä½™é¢åº¦ä¸è¶³\nå‰©ä½™ï¼šï¿¥${t.remaining.toFixed(2)}\néœ€è¦ï¼šï¿¥${e.toFixed(2)}\n\næ‚¨å¯ä»¥å–æ¶ˆå‹¾é€‰"ä½¿ç”¨äº²å¯†ä»˜"ï¼Œä½¿ç”¨é›¶é’±ä½™é¢æ”¯ä»˜`)}else{if(e>B())return void alert("ä½™é¢ä¸è¶³ï¼Œè¯·å…ˆå……å€¼")}const t=o.trim()||"æ­å–œå‘è´¢ï¼Œå¤§å‰å¤§åˆ©";r(e,t,x,x?g:void 0),c(""),d("æ­å–œå‘è´¢ï¼Œå¤§å‰å¤§åˆ©"),m(!1)},children:"å‘é€"})]})]})]})}):null},Aa=({show:t,redEnvelope:s,canClaim:a,onClose:r,onClaim:l})=>{if(!t||!s)return null;const n=m(s),i="claimed"===s.status;return e.jsx("div",{className:"red-packet-detail-modal "+(t?"show":""),onClick:e=>{e.target===e.currentTarget&&r()},children:e.jsxs("div",{className:"red-packet-detail-panel",children:[e.jsxs("div",{className:"red-packet-detail-header",children:[e.jsx("button",{className:"red-packet-detail-close",onClick:r,children:"Ã—"}),e.jsx("div",{className:"red-packet-detail-icon",children:"ðŸ§§"}),e.jsx("div",{className:"red-packet-detail-blessing",children:s.blessing}),e.jsx("div",{className:"red-packet-detail-status",children:i?"å·²é¢†å–":n?"å·²è¿‡æœŸ":"ç­‰å¾…é¢†å–"})]}),e.jsxs("div",{className:"red-packet-detail-body",children:[e.jsx("div",{className:"red-packet-detail-amount",children:i?e.jsxs("span",{className:"amount-value",children:["Â¥",s.amount.toFixed(2)]}):n?e.jsx("span",{className:"amount-value expired",children:"å·²è¿‡æœŸ"}):e.jsx("span",{className:"amount-hidden",children:"æœªé¢†å–"})}),i&&s.claimedBy&&s.claimedAt&&e.jsx("div",{className:"red-packet-detail-claimer",children:e.jsxs("div",{className:"claimer-info",children:[e.jsx("div",{className:"claimer-name",children:s.claimedBy}),e.jsx("div",{className:"claim-time",children:(o=s.claimedAt,new Date(o).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}))})]})}),e.jsxs("div",{className:"red-packet-detail-time",children:["æœ‰æ•ˆæœŸè‡³ ",(c=s.createdAt,new Date(c+864e5).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}))]}),a&&e.jsx("button",{className:"red-packet-claim-btn",onClick:l,children:"å¼€çº¢åŒ…"})]})]})});var c,o},Ta=({redEnvelope:t,onClick:s,coverImage:a,iconImage:r})=>{const l=m(t),n="claimed"===t.status;let i="red-packet-pending",c=null;return l&&!n?(i="red-packet-expired",c=e.jsx("div",{className:"red-packet-status",children:"å·²è¿‡æœŸ"})):n&&(i="red-packet-claimed",c=e.jsx("div",{className:"red-packet-status",children:"å·²é¢†å–"})),e.jsxs("div",{className:`message-bubble red-packet ${i}`,onClick:s,"data-red-envelope-id":t.id,style:{position:"relative",overflow:"hidden"},children:[a&&e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundImage:`url(${a})`,backgroundSize:"cover",backgroundPosition:"center",zIndex:0}}),e.jsxs("div",{style:{position:"relative",zIndex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"space-around",height:"100%"},children:[c,e.jsx("div",{className:"red-packet-content",children:e.jsx("div",{className:"red-packet-blessing",children:t.blessing})}),e.jsx("div",{className:"red-packet-icon",style:{backgroundImage:r?`url(${r})`:"none",backgroundSize:"cover",backgroundPosition:"center",color:r?"transparent":void 0},children:"é¢†"})]})]})},Da=({note:t,onClick:s})=>{const a=e=>e>=1e4?(e/1e4).toFixed(1)+"w":e.toString();return e.jsxs("div",{className:"xiaohongshu-card",onClick:s,style:{background:"white",borderRadius:"12px",overflow:"hidden",maxWidth:"280px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",cursor:"pointer",transition:"transform 0.2s"},onMouseEnter:e=>{e.currentTarget.style.transform="scale(1.02)"},onMouseLeave:e=>{e.currentTarget.style.transform="scale(1)"},children:[e.jsxs("div",{style:{position:"relative",width:"100%",paddingBottom:"133%",background:"#f5f5f5"},children:[e.jsx("img",{src:t.coverImage,alt:t.title,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover"},onError:e=>{e.currentTarget.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjI2NyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjI2NyIgZmlsbD0iI2Y1ZjVmNSIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LXNpemU9IjE0IiBmaWxsPSIjOTk5IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+5Zu+54mH5Yqg6L295aSx6LSlPC90ZXh0Pjwvc3ZnPg=="}}),e.jsxs("div",{style:{position:"absolute",top:"8px",left:"8px",background:"rgba(255,44,85,0.9)",color:"white",padding:"4px 8px",borderRadius:"4px",fontSize:"11px",fontWeight:"bold",display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z"})}),"å°çº¢ä¹¦"]})]}),e.jsxs("div",{style:{padding:"12px"},children:[e.jsx("div",{style:{fontSize:"14px",fontWeight:"500",color:"#333",marginBottom:"8px",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",lineHeight:"1.4"},children:t.title}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",marginBottom:"8px"},children:[e.jsx("img",{src:t.author.avatar,alt:t.author.nickname,style:{width:"20px",height:"20px",borderRadius:"50%",objectFit:"cover"},onError:e=>{e.currentTarget.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iMTAiIGN5PSIxMCIgcj0iMTAiIGZpbGw9IiNkZGQiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1zaXplPSIxMiIgZmlsbD0iI2ZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPjwvdGV4dD48L3N2Zz4="}}),e.jsx("span",{style:{fontSize:"12px",color:"#666"},children:t.author.nickname})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",fontSize:"12px",color:"#999"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx("span",{children:"â¤ï¸"}),e.jsx("span",{children:a(t.stats.likes)})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx("span",{children:"ðŸ’¬"}),e.jsx("span",{children:a(t.stats.comments)})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx("span",{children:"â­"}),e.jsx("span",{children:a(t.stats.collects)})]})]})]})]})},Ea=({onClose:s,onSelect:a})=>{const[r,l]=t.useState(""),[n,i]=t.useState([]),[c,o]=t.useState(!1),[d,x]=t.useState("æŽ¨è");t.useEffect(()=>{m()},[]);const m=async()=>{o(!0);try{const e=await P(6);i(e)}catch(e){}finally{o(!1)}},h=e=>e>=1e4?(e/1e4).toFixed(1)+"w":e.toString();return e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:s,className:"fixed inset-0 bg-black bg-opacity-50 z-50"}),e.jsxs("div",{className:"fixed inset-x-4 top-20 bottom-20 bg-white rounded-3xl shadow-2xl z-50 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"é€‰æ‹©å°çº¢ä¹¦ç¬”è®°"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{s();const e=new CustomEvent("openXiaohongshuInput");window.dispatchEvent(e)},className:"px-3 py-1.5 text-sm bg-red-50 text-red-600 rounded-full hover:bg-red-100 transition-colors",children:"âœï¸ æ‰‹åŠ¨è¾“å…¥"}),e.jsx("button",{onClick:s,className:"w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition-colors",children:e.jsx("svg",{className:"w-5 h-5 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-2 bg-gray-100 rounded-full px-4 py-2",children:[e.jsx(is,{size:20,className:"text-gray-400"}),e.jsx("input",{type:"text",placeholder:"æœç´¢å°çº¢ä¹¦ç¬”è®°...",value:r,onChange:e=>l(e.target.value),onKeyPress:e=>"Enter"===e.key&&(async()=>{if(r.trim()){o(!0);try{const e=await F(r,10);i(e.notes)}catch(e){}finally{o(!1)}}else m()})(),className:"flex-1 bg-transparent border-none outline-none text-sm text-gray-900 placeholder-gray-400"}),r&&e.jsx("button",{onClick:()=>{l(""),m()},className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})})]})}),e.jsx("div",{className:"flex gap-2 px-4 py-3 border-b border-gray-200 overflow-x-auto",children:["æŽ¨è","ç¾Žé£Ÿ","ç©¿æ­","ç¾Žå¦†","æ—…è¡Œ","æŽ¢åº—"].map(t=>e.jsx("button",{onClick:()=>(async e=>{if(x(e),"æŽ¨è"===e)m();else{o(!0);try{const t=await F(e,10);i(t.notes)}catch(t){}finally{o(!1)}}})(t),className:"px-4 py-1.5 rounded-full text-sm whitespace-nowrap transition-colors "+(d===t?"bg-red-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:t},t))}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:c?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"text-gray-400",children:"åŠ è½½ä¸­..."})}):0===n.length?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center text-gray-400",children:[e.jsx("div",{className:"text-4xl mb-2",children:"ðŸ“•"}),e.jsx("div",{children:"æš‚æ— ç›¸å…³ç¬”è®°"})]})}):e.jsx("div",{className:"grid grid-cols-2 gap-3",children:n.map(t=>e.jsxs("div",{onClick:()=>a(t),className:"bg-white rounded-xl overflow-hidden shadow-md hover:shadow-lg transition-shadow cursor-pointer",children:[e.jsx("div",{className:"relative w-full pb-[133%] bg-gray-100",children:e.jsx("img",{src:t.coverImage,alt:t.title,className:"absolute inset-0 w-full h-full object-cover",onError:e=>{e.currentTarget.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjI2NyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjI2NyIgZmlsbD0iI2Y1ZjVmNSIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LXNpemU9IjE0IiBmaWxsPSIjOTk5IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+5Zu+54mH5Yqg6L295aSx6LSlPC90ZXh0Pjwvc3ZnPg=="}})}),e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 line-clamp-2 mb-1",children:t.title}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"â¤ï¸"}),e.jsx("span",{children:h(t.stats.likes)})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"ðŸ’¬"}),e.jsx("span",{children:h(t.stats.comments)})]})]})]})]},t.id))})})]})]})},Ba=({onClose:s,onSubmit:a})=>{const[r,l]=t.useState(""),[n,i]=t.useState(""),[c,o]=t.useState(""),[d,x]=t.useState(""),[m,h]=t.useState(""),[u,g]=t.useState(""),[p,f]=t.useState(""),[b,j]=t.useState([]),[v,y]=t.useState(""),[N,w]=t.useState(!1),[k,C]=t.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:s,className:"fixed inset-0 bg-black bg-opacity-50 z-50"}),e.jsxs("div",{className:"fixed inset-x-4 top-10 bottom-10 bg-white rounded-3xl shadow-2xl z-50 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"ðŸ“• åˆ†äº«å°çº¢ä¹¦ç¬”è®°"}),e.jsx("button",{onClick:s,className:"w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition-colors",children:e.jsx("svg",{className:"w-5 h-5 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[e.jsx("div",{className:"text-sm text-gray-500 bg-blue-50 p-3 rounded-lg",children:'âœ¨ ç²˜è´´å°çº¢ä¹¦é“¾æŽ¥ï¼Œç‚¹å‡»"è‡ªåŠ¨æå–"å³å¯ï¼AIä¼šçœ‹åˆ°å®Œæ•´å†…å®¹'}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"å°çº¢ä¹¦é“¾æŽ¥ *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:r,onChange:e=>{l(e.target.value),C(!1)},placeholder:"ç²˜è´´å°çº¢ä¹¦é“¾æŽ¥...",className:"flex-1 px-4 py-3 border border-gray-300 rounded-2xl focus:outline-none focus:ring-2 focus:ring-red-500",autoFocus:!0}),e.jsx("button",{onClick:async()=>{var e,t,s,a,l,n;if(r.trim()){w(!0);try{const c=await fetch("/.netlify/functions/xiaohongshu-extract",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:r})});if(!c.ok)throw new Error("æå–å¤±è´¥");const d=await c.json();if(d.needManualInput)return alert("è‡ªåŠ¨æå–å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¡«å†™ä¿¡æ¯"),void w(!1);i(d.title||""),o(d.description||""),x(d.coverImage||(null==(e=d.images)?void 0:e[0])||""),h((null==(s=null==(t=d.stats)?void 0:t.likes)?void 0:s.toString())||""),g((null==(l=null==(a=d.stats)?void 0:a.comments)?void 0:l.toString())||""),f((null==(n=d.author)?void 0:n.nickname)||""),j(d.topComments||[]),C(!0),alert("âœ… è‡ªåŠ¨æå–æˆåŠŸï¼è¯·æ£€æŸ¥ä¿¡æ¯åŽåˆ†äº«")}catch(c){alert("è‡ªåŠ¨æå–å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¡«å†™ä¿¡æ¯")}finally{w(!1)}}else alert("è¯·å…ˆç²˜è´´å°çº¢ä¹¦é“¾æŽ¥")},disabled:!r.trim()||N,className:"px-6 py-3 bg-red-500 text-white rounded-2xl font-medium hover:bg-red-600 disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap",children:N?"æå–ä¸­...":"ðŸ” è‡ªåŠ¨æå–"})]}),e.jsx("div",{className:"mt-1 text-xs text-gray-500",children:"æ”¯æŒæ ¼å¼: https://www.xiaohongshu.com/explore/xxxxx"})]}),k&&e.jsx("div",{className:"text-sm text-green-600 bg-green-50 p-3 rounded-lg",children:'âœ… ä¿¡æ¯å·²è‡ªåŠ¨æå–ï¼è¯·æ£€æŸ¥åŽç‚¹å‡»"åˆ†äº«ç»™AI"'}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"æ ‡é¢˜ *"}),e.jsx("input",{type:"text",value:n,onChange:e=>i(e.target.value),placeholder:"ç¬”è®°æ ‡é¢˜",className:"w-full px-4 py-3 border border-gray-300 rounded-2xl focus:outline-none focus:ring-2 focus:ring-red-500",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"å†…å®¹æè¿°"}),e.jsx("textarea",{value:c,onChange:e=>o(e.target.value),placeholder:"ç¬”è®°çš„è¯¦ç»†å†…å®¹...",className:"w-full h-32 px-4 py-3 border border-gray-300 rounded-2xl resize-none focus:outline-none focus:ring-2 focus:ring-red-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"å°é¢å›¾ç‰‡é“¾æŽ¥ï¼ˆå¯é€‰ï¼‰"}),e.jsx("input",{type:"text",value:d,onChange:e=>x(e.target.value),placeholder:"https://...",className:"w-full px-4 py-3 border border-gray-300 rounded-2xl focus:outline-none focus:ring-2 focus:ring-red-500"}),d&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:d,alt:"é¢„è§ˆ",className:"w-32 h-32 object-cover rounded-xl",onError:e=>{e.currentTarget.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI2VlZSIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LXNpemU9IjEyIiBmaWxsPSIjOTk5IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+5Zu+54mH5Yqg6L295aSx6LSlPC90ZXh0Pjwvc3ZnPg=="}})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ä½œè€…æ˜µç§°"}),e.jsx("input",{type:"text",value:p,onChange:e=>f(e.target.value),placeholder:"ä½œè€…åå­—",className:"w-full px-4 py-3 border border-gray-300 rounded-2xl focus:outline-none focus:ring-2 focus:ring-red-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ç‚¹èµžæ•°"}),e.jsx("input",{type:"number",value:m,onChange:e=>h(e.target.value),placeholder:"0",className:"w-full px-4 py-3 border border-gray-300 rounded-2xl focus:outline-none focus:ring-2 focus:ring-red-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"è¯„è®ºæ•°"}),e.jsx("input",{type:"number",value:u,onChange:e=>g(e.target.value),placeholder:"0",className:"w-full px-4 py-3 border border-gray-300 rounded-2xl focus:outline-none focus:ring-2 focus:ring-red-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"çƒ­é—¨è¯„è®ºï¼ˆAIä¼šçœ‹åˆ°ï¼‰"}),b.length>0&&e.jsx("div",{className:"mb-3 space-y-2",children:b.map((t,s)=>e.jsxs("div",{className:"bg-gray-50 p-3 rounded-xl flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.author}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:t.content}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["ðŸ‘ ",t.likes]})]}),e.jsx("button",{onClick:()=>{j(b.filter((e,t)=>t!==s))},className:"text-gray-400 hover:text-red-500 ml-2",children:e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})})]},s))}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-2xl p-4",children:[e.jsx("textarea",{value:v,onChange:e=>y(e.target.value),placeholder:"è¾“å…¥ä¸€æ¡è¯„è®ºå†…å®¹...ï¼ˆæ ¼å¼ï¼šç”¨æˆ·å|è¯„è®ºå†…å®¹|ç‚¹èµžæ•°ï¼‰\nä¾‹å¦‚ï¼šå°æ˜Ž|è¿™ä¸ªå¤ªå¥½äº†ï¼|520",className:"w-full px-3 py-2 border border-gray-300 rounded-xl resize-none focus:outline-none focus:ring-2 focus:ring-red-500 text-sm",rows:2}),e.jsx("button",{onClick:()=>{if(!v.trim())return;const e=v.split("|").map(e=>e.trim());3===e.length?(j([...b,{author:e[0],content:e[1],likes:parseInt(e[2])||0}]),y("")):alert("æ ¼å¼é”™è¯¯ï¼è¯·æŒ‰ç…§ï¼šç”¨æˆ·å|è¯„è®ºå†…å®¹|ç‚¹èµžæ•°")},className:"mt-2 w-full px-4 py-2 bg-gray-100 text-gray-700 rounded-xl text-sm hover:bg-gray-200",children:"âž• æ·»åŠ è¯„è®º"})]}),e.jsx("div",{className:"mt-1 text-xs text-gray-500",children:"ðŸ’¡ æ·»åŠ çƒ­é—¨è¯„è®ºè®©AIæ›´å¥½ç†è§£è¿™ä¸ªç¬”è®°çš„åé¦ˆ"})]})]}),e.jsxs("div",{className:"p-4 border-t border-gray-200 flex gap-3",children:[e.jsx("button",{onClick:s,className:"flex-1 px-4 py-3 bg-gray-100 text-gray-700 rounded-full font-medium",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:()=>{if(!n.trim())return void alert("è¯·è‡³å°‘å¡«å†™æ ‡é¢˜");const e={id:`user_share_${Date.now()}`,title:n,description:c||n,coverImage:d||"https://picsum.photos/300/400?random=999",images:d?[d]:[],author:{id:"real_author",nickname:p||"å°çº¢ä¹¦ç”¨æˆ·",avatar:"https://i.pravatar.cc/150?img=9"},stats:{likes:parseInt(m)||0,comments:parseInt(u)||0,collects:parseInt(m)?Math.floor(.8*parseInt(m)):0},tags:[],url:r||"https://www.xiaohongshu.com",createTime:Date.now(),topComments:b.length>0?b:void 0};a(e)},className:"flex-1 px-4 py-3 bg-red-500 text-white rounded-full font-medium",children:"åˆ†äº«ç»™AI"})]})]})]})},Pa=({show:s,onClose:a,onSend:r,characterId:l,characterName:n})=>{const[i,c]=t.useState(""),[o,d]=t.useState(""),[x,m]=t.useState(!1),[h,u]=t.useState([]),[g,p]=t.useState("");t.useEffect(()=>{s&&(c(""),d(""),m(!1))},[s]),t.useEffect(()=>{if(s){const e=E().filter(e=>"character_to_user"===e.type).map(e=>({id:e.characterId,name:e.characterName,remaining:e.monthlyLimit-e.usedAmount})).filter(e=>e.remaining>0);if(u(e),e.length>0){const t=(l?e.find(e=>e.id===l):null)||e[0];p(t.id),m(!0)}else m(!1),p("")}},[s]);const f=()=>{c(""),d(""),m(!1),p(""),a()};return s?e.jsx("div",{className:"red-packet-modal "+(s?"show":""),onClick:e=>{e.target===e.currentTarget&&f()},children:e.jsxs("div",{className:"red-packet-panel",children:[e.jsx("div",{className:"red-packet-header",style:{background:"linear-gradient(135deg, #fff5f0 0%, #ffe8dc 100%)"},children:e.jsx("div",{className:"red-packet-title",children:"è½¬è´¦"})}),e.jsxs("div",{className:"red-packet-form",children:[e.jsxs("div",{className:"red-packet-field",children:[e.jsx("label",{className:"red-packet-label",children:"é‡‘é¢"}),e.jsx("input",{type:"text",className:"red-packet-input",placeholder:"è¯·è¾“å…¥é‡‘é¢",value:i,onChange:e=>{let t=e.target.value.replace(/[^\d.]/g,"");const s=t.split(".");s.length>2&&(t=s[0]+"."+s.slice(1).join("")),s[1]&&s[1].length>2&&(t=s[0]+"."+s[1].substring(0,2)),c(t)},autoFocus:!0})]}),e.jsxs("div",{className:"red-packet-field",children:[e.jsx("label",{className:"red-packet-label",children:"è½¬è´¦è¯´æ˜Ž"}),e.jsx("input",{type:"text",className:"red-packet-input",placeholder:"æ·»åŠ è½¬è´¦è¯´æ˜Žï¼ˆå¯é€‰ï¼‰",value:o,onChange:e=>d(e.target.value),maxLength:20})]}),h.length>0&&e.jsxs("div",{className:"red-packet-field",children:[e.jsxs("label",{className:"flex items-center cursor-pointer mb-2",children:[e.jsx("input",{type:"checkbox",checked:x,onChange:e=>m(e.target.checked),className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-700 font-medium",children:"ä½¿ç”¨äº²å¯†ä»˜"})]}),x&&e.jsx("select",{value:g,onChange:e=>p(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-500",children:h.map(t=>e.jsxs("option",{value:t.id,children:[t.name,"çš„äº²å¯†ä»˜ï¼ˆå‰©ä½™ï¿¥",t.remaining.toFixed(2),"ï¼‰"]},t.id))})]}),e.jsxs("div",{className:"red-packet-buttons",children:[e.jsx("button",{className:"red-packet-btn red-packet-btn-cancel",onClick:f,children:"å–æ¶ˆ"}),e.jsx("button",{className:"red-packet-btn",onClick:()=>{const e=parseFloat(i);if(!e||e<=0)return void alert("è¯·è¾“å…¥æœ‰æ•ˆé‡‘é¢");if(x){const t=h.find(e=>e.id===g);if(!t)return void alert("è¯·é€‰æ‹©è¦ä½¿ç”¨çš„äº²å¯†ä»˜");if(e>t.remaining)return void alert(`${t.name}çš„äº²å¯†ä»˜å‰©ä½™é¢åº¦ä¸è¶³\nå‰©ä½™ï¼šï¿¥${t.remaining.toFixed(2)}\néœ€è¦ï¼šï¿¥${e.toFixed(2)}\n\næ‚¨å¯ä»¥å–æ¶ˆå‹¾é€‰"ä½¿ç”¨äº²å¯†ä»˜"ï¼Œä½¿ç”¨é›¶é’±ä½™é¢æ”¯ä»˜`)}else{if(e>B())return void alert("ä½™é¢ä¸è¶³ï¼Œè¯·å…ˆå……å€¼")}const t=o.trim();r(e,t,x,x?g:void 0),c(""),d(""),m(!1)},style:{background:"linear-gradient(135deg, #FF9500 0%, #FF8000 100%)",color:"white",boxShadow:"0 6px 20px rgba(255, 149, 0, 0.35)"},children:"è½¬è´¦"})]})]})]})}):null},Fa="/zhizhi/assets/intimate-pay-icon-tdmSPkmO.webp",Oa=({onSend:s,onCancel:a})=>{const[r,l]=t.useState(""),[n,i]=t.useState(!1),[c,o]=t.useState(0);t.useEffect(()=>{o(B())},[]);return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-end justify-center z-50",onClick:a,children:e.jsxs("div",{className:"bg-white rounded-t-3xl w-full max-w-md p-6 pb-8 animate-slide-up",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"å¼€é€šäº²å¯†ä»˜"}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 text-2xl leading-none",children:"Ã—"})]}),e.jsxs("div",{className:"bg-pink-50 rounded-xl p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full overflow-hidden flex-shrink-0",children:e.jsx("img",{src:Fa,alt:"äº²å¯†ä»˜",className:"w-full h-full object-cover"})}),e.jsx("span",{className:"text-sm font-medium text-pink-600",children:"ä»€ä¹ˆæ˜¯äº²å¯†ä»˜ï¼Ÿ"})]}),e.jsx("p",{className:"text-xs text-pink-600 leading-relaxed mb-3",children:"ä¸ºå¯¹æ–¹å¼€é€šåŽï¼ŒTAæ¯æœˆå¯ä½¿ç”¨ä½ çš„é›¶é’±è¿›è¡Œæ¶ˆè´¹ï¼Œä½ å¯ä»¥éšæ—¶æŸ¥çœ‹æ¶ˆè´¹è®°å½•"}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-pink-200",children:[e.jsx("span",{className:"text-xs text-pink-600",children:"å½“å‰é›¶é’±ä½™é¢"}),e.jsxs("span",{className:"text-sm font-semibold "+(c<500?"text-orange-500":"text-pink-600"),children:["Â¥",c.toFixed(2)]})]}),e.jsx("div",{className:"mt-2 text-xs text-pink-600",children:"ðŸ’¡ æç¤ºï¼šä½ çš„ä½™é¢å¿…é¡»â‰¥æœˆé¢åº¦æ‰èƒ½å¼€é€š"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-sm text-gray-600 mb-3",children:"è®¾ç½®æœˆé¢åº¦"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:[{label:"500å…ƒ/æœˆ",value:500},{label:"1000å…ƒ/æœˆ",value:1e3},{label:"2000å…ƒ/æœˆ",value:2e3},{label:"3000å…ƒ/æœˆ",value:3e3},{label:"5000å…ƒ/æœˆ",value:5e3},{label:"è‡ªå®šä¹‰",value:0}].map(t=>{const s=t.value>0&&c<t.value,a=0===t.value&&n||t.value>0&&r===t.value.toString();return e.jsxs("button",{onClick:()=>{return!s&&void(0===(e=t.value)?(i(!0),l("")):(i(!1),l(e.toString())));var e},disabled:s,className:"py-3 rounded-xl text-[15px] font-medium transition-colors relative "+(s?"bg-gray-100 text-gray-400 border-2 border-transparent cursor-not-allowed":a?"bg-pink-50 text-pink-500 border-2 border-pink-500":"bg-gray-50 text-gray-700 border-2 border-transparent active:bg-gray-100"),children:[t.label,s&&e.jsx("span",{className:"absolute top-1 right-1 text-xs",children:"ðŸ”’"})]},t.label)})}),n&&e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"flex items-center border-2 border-pink-500 rounded-xl px-4 py-3 bg-white",children:[e.jsx("span",{className:"text-xl text-gray-900 mr-2",children:"Â¥"}),e.jsx("input",{type:"number",value:r,onChange:e=>l(e.target.value),placeholder:"è¯·è¾“å…¥æœˆé¢åº¦",className:"flex-1 text-xl outline-none",autoFocus:!0}),e.jsx("span",{className:"text-sm text-gray-500",children:"/æœˆ"})]})})]}),e.jsx("button",{onClick:()=>{const e=parseFloat(r);isNaN(e)||e<=0?alert("è¯·è¾“å…¥æœ‰æ•ˆçš„æœˆé¢åº¦"):c<e?alert(`ä½™é¢ä¸è¶³ï¼Œæ— æ³•å¼€é€šäº²å¯†ä»˜\n\nå½“å‰ä½™é¢ï¼šï¿¥${c.toFixed(2)}\nè®¾ç½®é¢åº¦ï¼šï¿¥${e.toFixed(2)}\n\nä½ çš„ä½™é¢ä¸è¶³ä»¥æ”¯æŒæ­¤é¢åº¦ï¼Œè¯·å…ˆå……å€¼æˆ–é™ä½Žæœˆé¢åº¦`):s(e)},disabled:!r,className:"w-full py-4 rounded-xl text-[16px] font-medium transition-all "+(r?"bg-gradient-to-r from-pink-400 to-red-400 text-white active:opacity-80":"bg-gray-100 text-gray-400"),children:"å‘é€äº²å¯†ä»˜"})]})})},Wa=({show:s,onClose:a,onSelect:r})=>{const[l,n]=t.useState([]),[i,c]=t.useState("all"),o=t.useRef(null);t.useEffect(()=>{s&&d()},[s]);const d=async()=>{try{const e=await Promise.race([z(),new Promise((e,t)=>setTimeout(()=>t(new Error("è¡¨æƒ…åŒ…åŠ è½½è¶…æ—¶")),3e3))]);o.current=e,n(e)}catch(e){n([]),o.current=[]}},x=l.filter(e=>e.useCount>0).sort((e,t)=>t.useCount-e.useCount).slice(0,12),m="frequent"===i?x:l;return s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/20 z-40",onClick:a}),e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 glass-effect rounded-t-2xl z-50 max-h-[60vh] flex flex-col shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200/50",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>c("all"),className:"text-sm font-medium pb-1 border-b-2 transition-colors "+("all"===i?"text-[#576B95] border-[#576B95]":"text-gray-400 border-transparent"),children:"å…¨éƒ¨è¡¨æƒ…"}),e.jsx("button",{onClick:()=>c("frequent"),className:"text-sm font-medium pb-1 border-b-2 transition-colors "+("frequent"===i?"text-[#576B95] border-[#576B95]":"text-gray-400 border-transparent"),children:"å¸¸ç”¨è¡¨æƒ…"})]}),e.jsx("button",{onClick:a,className:"text-gray-400 text-2xl w-8 h-8 flex items-center justify-center",children:"Ã—"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:0===m.length?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400 py-8",children:[e.jsxs("svg",{className:"w-12 h-12 mb-3",fill:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",opacity:"0.3"}),e.jsx("path",{d:"M8 14s1.5 2 4 2 4-2 4-2"}),e.jsx("circle",{cx:"9",cy:"9",r:"1"}),e.jsx("circle",{cx:"15",cy:"9",r:"1"})]}),e.jsx("div",{className:"text-sm",children:"frequent"===i?"è¿˜æ²¡æœ‰å¸¸ç”¨è¡¨æƒ…åŒ…":"è¿˜æ²¡æœ‰è¡¨æƒ…åŒ…"}),e.jsx("div",{className:"text-xs text-gray-300 mt-1",children:"frequent"===i?"å¤šå‘å‡ æ¬¡è¡¨æƒ…åŒ…å°±ä¼šå‡ºçŽ°åœ¨è¿™é‡Œ":"åœ¨å‘çŽ°é¡µé¢æ·»åŠ è¡¨æƒ…åŒ…"})]}):e.jsx("div",{className:"grid grid-cols-4 gap-3",children:m.map(t=>e.jsxs("div",{onClick:()=>(e=>{r(e),a(),O(e.id).catch(e=>{})})(t),className:"relative aspect-square rounded-xl overflow-hidden glass-card shadow-lg border border-gray-200/50 active:scale-95 cursor-pointer transition-transform",children:[e.jsx("img",{src:t.url,alt:t.description,className:"w-full h-full object-cover",loading:"lazy"}),"frequent"===i&&t.useCount>0&&e.jsx("div",{className:"absolute bottom-1 right-1 bg-black/70 text-white text-xs px-1.5 py-0.5 rounded",children:t.useCount})]},t.id))})})]})]}):null},Ra=({description:s})=>{const[a,r]=t.useState(!1);return e.jsx("div",{className:"relative w-[200px] h-[200px] cursor-pointer",style:{perspective:"1000px"},onClick:()=>r(!a),children:e.jsxs("div",{className:"relative w-full h-full transition-transform duration-700 "+(a?"[transform:rotateY(180deg)]":""),style:{transformStyle:"preserve-3d"},children:[e.jsx("div",{className:"absolute w-full h-full rounded-2xl overflow-hidden shadow-lg",style:{backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},children:e.jsx("img",{src:"/zhizhi/assets/photo-placeholder-B_NHJ1Xw.webp",alt:"ç…§ç‰‡",className:"w-full h-full object-cover"})}),e.jsx("div",{className:"absolute w-full h-full rounded-2xl shadow-lg bg-white p-4 overflow-y-auto flex items-center justify-center",style:{backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",transform:"rotateY(180deg)"},children:e.jsx("div",{className:"text-sm text-gray-900 whitespace-pre-wrap break-words text-center",children:s})})]})})},Ua=({groupId:t,groupName:a,memberNames:r,inviterName:l="ç”¨æˆ·"})=>{const n=s();return e.jsx("div",{className:"flex justify-center my-4",children:e.jsxs("div",{className:"glass-card rounded-xl p-4 max-w-sm cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>n(`/group/${t}`),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center shadow-md",children:e.jsx("span",{className:"text-white text-xl",children:"ðŸ‘¥"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:"ç¾¤èŠé‚€è¯·"}),e.jsxs("div",{className:"text-xs text-gray-500",children:[l,"é‚€è¯·ä½ åŠ å…¥ç¾¤èŠ"]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-base",children:"ðŸ“"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:a})]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx("span",{children:"æˆå‘˜ï¼š"}),e.jsx("span",{className:"flex-1 truncate",children:r.join("ã€")}),e.jsxs("span",{className:"text-gray-400",children:["(",r.length,"äºº)"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-400",children:[e.jsx("span",{children:"ðŸ’¬"}),e.jsx("span",{children:"ç‚¹å‡»æŸ¥çœ‹ç¾¤èŠ"})]}),e.jsx("div",{className:"px-2 py-1 bg-green-50 text-green-600 text-xs rounded",children:"å·²åŠ å…¥"})]})]})})},Va=({content:t,className:s=""})=>{let a=t;t.startsWith("```")&&(a=t.replace(/^```[a-z]*\n?/i,"").replace(/\n?```$/,""));return a.includes("<!DOCTYPE")||a.includes("<html")||a.includes("<script")||a.includes("onclick=")||a.includes("addEventListener")?e.jsx("iframe",{srcDoc:a,className:`w-full border-0 rounded-lg ${s}`,style:{minHeight:"500px",height:"auto"},sandbox:"allow-scripts allow-same-origin allow-forms",title:"HTML Content",onLoad:e=>{var t;const s=e.currentTarget;try{const e=s.contentDocument||(null==(t=s.contentWindow)?void 0:t.document);if(e){const t=e.documentElement.scrollHeight;s.style.height=`${t}px`}}catch(a){}}}):e.jsx("div",{className:`whitespace-pre-wrap break-words ${s}`,dangerouslySetInnerHTML:{__html:a}})},Ja=({children:s})=>{const a=t.useRef(null),r=t.useRef(null),l=t.useRef(null),n=t.useRef(null);return t.useEffect(()=>{const e=a.current,t=r.current,s=l.current,i=n.current;if(!(e&&t&&s&&i))return;const c=e.getContext("2d",{alpha:!0}),o=t.getContext("2d",{alpha:!0});if(!c||!o)return;let d,x=0;const m=()=>{const a=s.getBoundingClientRect(),r=window.devicePixelRatio||1;e.width=a.width*r,e.height=a.height*r,e.style.width=`${a.width}px`,e.style.height=`${a.height}px`,c.scale(r,r),t.width=a.width*r,t.height=a.height*r,t.style.width=`${a.width}px`,t.style.height=`${a.height}px`,o.scale(r,r)};m();const h=()=>{const s=e.width/(window.devicePixelRatio||1),a=e.height/(window.devicePixelRatio||1);c.clearRect(0,0,s,a),o.clearRect(0,0,s,a);const r=((e,t,s)=>{const a=[],r=16,l=.05,n=2*(e+t)-128+2*Math.PI*r;for(let i=0;i<=200;i++){const c=i/200*n;let o=0,d=0,x=0,m=0;if(c<e-32)o=r+c,d=0,x=0,m=-1;else if(c<e-32+Math.PI*r/2){const t=(c-(e-32))/r;o=e-r+r*Math.sin(t),d=r-r*Math.cos(t),x=Math.sin(t),m=-Math.cos(t)}else if(c<e+t-64+Math.PI*r/2)o=e,d=r+(c-(e-32+Math.PI*r/2)),x=1,m=0;else if(c<e+t-64+Math.PI*r){const s=(c-(e+t-64+Math.PI*r/2))/r;o=e-r+r*Math.cos(s),d=t-r+r*Math.sin(s),x=Math.cos(s),m=Math.sin(s)}else if(c<2*e+t-96+Math.PI*r)o=e-r-(c-(e+t-64+Math.PI*r)),d=t,x=0,m=1;else if(c<2*e+t-96+Math.PI*r*1.5){const s=(c-(2*e+t-96+Math.PI*r))/r;o=r-r*Math.sin(s),d=t-r+r*Math.cos(s),x=-Math.sin(s),m=Math.cos(s)}else if(c<2*e+2*t-128+Math.PI*r*1.5)o=0,d=t-r-(c-(2*e+t-96+Math.PI*r*1.5)),x=-1,m=0;else{const s=(c-(2*e+2*t-128+Math.PI*r*1.5))/r;o=r-r*Math.cos(s),d=r-r*Math.sin(s),x=-Math.cos(s),m=-Math.sin(s)}const h=3*Math.sin(c*l+.05*s)+3*Math.sin(c*l*2.3+.07*s)*.5+3*Math.sin(c*l*4.7+.03*s)*.3;o+=x*h,d+=m*h,a.push({x:o,y:d})}return a})(s,a,x);if(o.save(),o.beginPath(),r.forEach((e,t)=>{0===t?o.moveTo(e.x,e.y):o.lineTo(e.x,e.y)}),o.closePath(),o.fillStyle="black",o.fill(),o.restore(),i){const e=t.toDataURL();i.style.webkitMaskImage=`url(${e})`,i.style.maskImage=`url(${e})`,i.style.webkitMaskSize="100% 100%",i.style.maskSize="100% 100%"}c.save(),c.beginPath(),r.forEach((e,t)=>{0===t?c.moveTo(e.x,e.y):c.lineTo(e.x,e.y)}),c.closePath(),c.strokeStyle="rgba(255, 255, 255, 0.8)",c.lineWidth=3,c.shadowBlur=15,c.shadowColor="rgba(255, 255, 255, 0.5)",c.stroke(),c.strokeStyle="rgba(255, 255, 255, 0.3)",c.lineWidth=8,c.shadowBlur=0,c.stroke(),c.strokeStyle="rgba(255, 255, 255, 0.1)",c.lineWidth=12,c.shadowBlur=20,c.shadowColor="rgba(255, 255, 255, 0.3)",c.stroke(),c.restore(),x+=1,d=requestAnimationFrame(h)};h();const u=()=>{m()};return window.addEventListener("resize",u),()=>{cancelAnimationFrame(d),window.removeEventListener("resize",u)}},[]),e.jsxs("div",{ref:l,className:"relative",children:[e.jsx("canvas",{ref:a,className:"absolute inset-0 pointer-events-none",style:{zIndex:2}}),e.jsx("canvas",{ref:r,className:"absolute inset-0 pointer-events-none",style:{display:"none"}}),e.jsx("div",{ref:n,className:"relative",style:{zIndex:1},children:s})]})},Ha=({isOpen:s,onClose:a,characterName:r,characterId:l})=>{const[n,i]=t.useState(!1),[c,o]=t.useState({affection:75,outfit:"ç™½è‰²æ£‰è´¨Tæ¤ï¼Œæµ…è“è‰²ç‰›ä»”è£¤ï¼Œç™½è‰²è¿åŠ¨éž‹",action:"ååœ¨æ²™å‘ä¸Šï¼ŒåŒè…¿è‡ªç„¶äº¤å ï¼Œæ‰‹é‡Œæ‹¿ç€æ‰‹æœºåœ¨å›žå¤æ¶ˆæ¯",mood:"( Â´ â–½ ` ) è½»æ¾æ„‰å¿«",thought:"ä»Šå¤©è¿‡å¾—å¾ˆå……å®žå‘¢",location:"å®¶é‡Œçš„å®¢åŽ…",weather:"æ™´ 25Â°C"});return t.useEffect(()=>{if(s&&l){i(!0);const e=()=>{const e=localStorage.getItem(`character_status_${l}`);if(e)try{const t=JSON.parse(e);o(t)}catch(t){}};e();const t=setInterval(e,1e3);return()=>clearInterval(t)}},[s,l]),t.useEffect(()=>{if(l&&c){const e={...c,characterId:l,timestamp:Date.now()};localStorage.setItem(`character_status_${l}`,JSON.stringify(e))}},[c,l]),s||n?e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:a,className:"fixed inset-0 bg-black z-50 transition-opacity duration-300 "+(s?"bg-opacity-60":"bg-opacity-0 pointer-events-none")}),e.jsx("div",{className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-50 transition-all duration-300 "+(s?"opacity-100 scale-100":"opacity-0 scale-95 pointer-events-none"),children:e.jsx(Ja,{children:e.jsxs("div",{className:"w-96 bg-white/95 backdrop-blur-xl p-6 rounded-2xl max-h-[85vh] overflow-y-auto",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-1",children:"çŠ¶æ€æ "}),e.jsx("p",{className:"text-gray-600 text-sm",children:r})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-light text-gray-900 mb-1",children:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})}),e.jsx("div",{className:"text-sm text-gray-500",children:(new Date).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric",weekday:"long"})})]})}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-xl",children:"â˜€ï¸"}),e.jsx("span",{className:"text-sm text-gray-600",children:"å¤©æ°”"}),e.jsx("span",{className:"text-sm text-gray-900 font-medium",children:c.weather})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-xl",children:"ðŸ“"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"åæ ‡"}),e.jsx("div",{className:"text-sm text-gray-900 mt-1",children:c.location})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:"ðŸ’•"}),e.jsx("span",{className:"text-sm text-gray-600",children:"å¥½æ„Ÿåº¦"})]}),e.jsxs("span",{className:"text-sm text-gray-900 font-bold",children:[c.affection,"/100"]})]}),e.jsx("div",{className:"w-full bg-gray-100 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-pink-400 to-pink-600 h-2 rounded-full transition-all duration-500",style:{width:`${c.affection}%`}})})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100 space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-xl",children:"ðŸ‘”"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"ç€è£…"}),e.jsx("div",{className:"text-sm text-gray-900 leading-relaxed",children:c.outfit})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-xl",children:"ðŸŽ¬"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"åŠ¨ä½œ"}),e.jsx("div",{className:"text-sm text-gray-900 leading-relaxed",children:c.action})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-xl",children:"ðŸ’­"}),e.jsx("span",{className:"text-sm text-gray-600",children:"å¿ƒå£°"})]}),e.jsx("div",{className:"text-sm text-gray-900 leading-relaxed italic",children:c.thought})]})]}),e.jsx("button",{onClick:a,className:"mt-4 w-full py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-all duration-200 text-sm font-medium",children:"â–¼ æ”¶èµ·"})]})})})]}):null},Ga=(e,s,a)=>{const r=t.useRef(U.getSystem(e)),l=t.useCallback(async(e,t)=>await r.current.extractMemoriesFromConversation(e,t,s,a),[s,a]),n=t.useCallback(async e=>await r.current.extractInitialMemories(e),[]),i=t.useCallback((e,t=5)=>r.current.getRelevantMemories(e,t),[]),c=t.useCallback(()=>r.current.generateMemorySummary(),[]),o=t.useCallback((e,t,s=5)=>r.current.addMemory(e,t,s),[]),d=t.useCallback(e=>r.current.searchMemories({keyword:e}),[]),x=t.useCallback(()=>r.current.getStatistics(),[]);return t.useMemo(()=>({extractMemories:l,extractInitialMemories:n,getRelevantMemories:i,getMemorySummary:c,addMemory:o,searchMemories:d,getStatistics:x}),[l,n,i,c,o,d,x])},qa=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{var l,i,x,b,j;const v=s(),y=a(),{id:w}=r(),{currentUser:C,updateUser:_}=d(),M=Ga(w||""),[z,L]=t.useState(""),[$,A]=t.useState(()=>{if(w){const e=localStorage.getItem(`chat_messages_${w}`),t=e?JSON.parse(e):[],s=2;let a=parseInt(localStorage.getItem(`chat_data_version_${w}`)||"0")<s;const r=t.map((e,t)=>{var s;let r={...e};if(!e.timestamp){a=!0;const[t,s]=e.time.split(":").map(Number),l=new Date;l.setHours(t||0,s||0,0,0),l.getTime()>Date.now()&&l.setDate(l.getDate()-1),r.timestamp=l.getTime()}return"transfer"===e.messageType&&(null==(s=e.transfer)?void 0:s.message)&&("è½¬è´¦"!==e.transfer.message&&"ä½ å‘èµ·äº†ä¸€ç¬”è½¬è´¦"!==e.transfer.message||(a=!0,r={...r,transfer:{...r.transfer,message:""}})),r});return a&&setTimeout(()=>{localStorage.setItem(`chat_messages_${w}`,JSON.stringify(r)),localStorage.setItem(`chat_data_version_${w}`,String(s))},0),r}return[]}),[T,D]=t.useState(!1),E=t.useRef(),[P,F]=t.useState(!1),[O,R]=t.useState(!1),[U,pe]=t.useState(null),fe=t.useRef(!0),be=t.useRef(0),je=t.useRef(!0),[ve,ye]=t.useState({total:0,remaining:0,percentage:0,systemPrompt:0,lorebook:0,messages:0}),[Ne,we]=t.useState(!1),[ke,Ce]=t.useState(0),[Se,Ie]=t.useState([]),{background:_e,getBackgroundStyle:Me}=c(),[ze,Le]=t.useState(()=>localStorage.getItem(`chat_background_${w}`)||"");t.useEffect(()=>{if(w)return N.observe(`chat_background_${w}`,e=>{Le(e||"")})},[w]);const[$e,Ae]=t.useState(()=>"true"===localStorage.getItem("apply_background_to_all_pages"));t.useEffect(()=>N.observe("apply_background_to_all_pages",e=>{Ae("true"===e)}),[]);const Te=ze||($e?_e:""),[De,Ee]=t.useState(()=>"true"===localStorage.getItem(`narrator_enabled_${w}`)),Be=!0,[Pe,Fe]=t.useState(()=>localStorage.getItem(`user_bubble_color_${w}`)||localStorage.getItem("user_bubble_color")||"#FFD4E5"),[Oe,We]=t.useState(()=>localStorage.getItem(`ai_bubble_color_${w}`)||localStorage.getItem("ai_bubble_color")||"#FFFFFF"),[Re,Ue]=t.useState(()=>localStorage.getItem(`user_bubble_css_${w}`)||localStorage.getItem("user_bubble_css")||""),[Ve,Je]=t.useState(()=>localStorage.getItem(`ai_bubble_css_${w}`)||localStorage.getItem("ai_bubble_css")||""),[He,Ge]=t.useState(()=>localStorage.getItem(`red_envelope_cover_${w}`)||""),[qe,Ke]=t.useState(()=>localStorage.getItem(`red_envelope_icon_${w}`)||""),[Xe,Ze]=t.useState(()=>localStorage.getItem(`transfer_cover_${w}`)||""),[Qe,Ye]=t.useState(()=>localStorage.getItem(`transfer_icon_${w}`)||"");t.useEffect(()=>{if(!w)return;const e=[N.observe(`user_bubble_color_${w}`,e=>{Fe(e||localStorage.getItem("user_bubble_color")||"#FFD4E5")}),N.observe("user_bubble_color",e=>{localStorage.getItem(`user_bubble_color_${w}`)||Fe(e||"#FFD4E5")}),N.observe(`ai_bubble_color_${w}`,e=>{We(e||localStorage.getItem("ai_bubble_color")||"#FFFFFF")}),N.observe("ai_bubble_color",e=>{localStorage.getItem(`ai_bubble_color_${w}`)||We(e||"#FFFFFF")}),N.observe(`user_bubble_css_${w}`,e=>{Ue(e||localStorage.getItem("user_bubble_css")||"")}),N.observe("user_bubble_css",e=>{localStorage.getItem(`user_bubble_css_${w}`)||Ue(e||"")}),N.observe(`ai_bubble_css_${w}`,e=>{Je(e||localStorage.getItem("ai_bubble_css")||"")}),N.observe("ai_bubble_css",e=>{localStorage.getItem(`ai_bubble_css_${w}`)||Je(e||"")}),N.observe(`red_envelope_cover_${w}`,e=>{Ge(e||"")}),N.observe(`red_envelope_icon_${w}`,e=>{Ke(e||"")}),N.observe(`transfer_cover_${w}`,e=>{Ze(e||"")}),N.observe(`transfer_icon_${w}`,e=>{Ye(e||"")}),N.observe("chat_font_family",e=>{const t=localStorage.getItem("chat_font_family_value");e&&"system"!==e&&t?document.documentElement.style.setProperty("--chat-font-family",t):document.documentElement.style.removeProperty("--chat-font-family")}),N.observe("chat_font_family_value",e=>{const t=localStorage.getItem("chat_font_family");t&&"system"!==t&&e?document.documentElement.style.setProperty("--chat-font-family",e):document.documentElement.style.removeProperty("--chat-font-family")})];return()=>{e.forEach(e=>e())}},[w]),t.useEffect(()=>{const e=`custom-bubble-style-${w}`;let t=document.getElementById(e);t||(t=document.createElement("style"),t.id=e,document.head.appendChild(t));const s=`${Re}\n${Ve}`;return t.textContent=s,()=>{const t=document.getElementById(e);t&&t.remove()}},[w,Re,Ve]);const{showStatusBar:et}=o(),{getCharacter:tt,updateCharacter:st}=n(),{getRedEnvelope:at,saveRedEnvelope:rt,updateRedEnvelope:lt}=u(),{moments:nt}=h(),{addTransaction:it}=g(),ct=t.useRef(null),ot=t.useRef(!1),dt=t.useRef(!1),xt=t.useRef(!1),mt=t.useRef(!0),ht=e=>{const t=new Date(e),s=new Date,a=new Date(s.getFullYear(),s.getMonth(),s.getDate()),r=new Date(a.getTime()-864e5),l=new Date(t.getFullYear(),t.getMonth(),t.getDate()),n=t.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"});return l.getTime()===a.getTime()?n:l.getTime()===r.getTime()?`æ˜¨å¤© ${n}`:t.toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},[ut,gt]=t.useState(!1),[pt,ft]=t.useState(!1),[bt,jt]=t.useState(null),[vt,yt]=t.useState(!1),[Nt,wt]=t.useState(!1),[kt,Ct]=t.useState(!1),[St,It]=t.useState(!1),[_t,Mt]=t.useState(!1),[zt,Lt]=t.useState(null),[$t,At]=t.useState(!1),[Tt,Dt]=t.useState(""),[Et,Bt]=t.useState([]),[Pt,Ft]=t.useState(""),[Ot,Wt]=t.useState(""),[Rt,Ut]=t.useState(""),[Vt,Jt]=t.useState(""),[Ht,Gt]=t.useState(!1),[qt,Kt]=t.useState(30),[Xt,Zt]=t.useState(!1),[Qt,Yt]=t.useState(!1),es=t.useRef(null),ts=t.useRef(0),as=t.useRef(!0),rs=t.useRef(0);t.useEffect(()=>{const e=()=>{As(!0)};return window.addEventListener("openXiaohongshuInput",e),()=>{window.removeEventListener("openXiaohongshuInput",e)}},[]);const[ls,ns]=t.useState(!1),[is,cs]=t.useState(""),[ms,us]=t.useState(!1),[gs,ps]=t.useState(""),[fs,bs]=t.useState({}),[js,vs]=t.useState(null),[ys,Ns]=t.useState(!1),[ws,ks]=t.useState(""),[Cs,Ss]=t.useState(""),[_s,Ms]=t.useState(null),[zs,Ls]=t.useState(!1),[$s,As]=t.useState(!1),{startCall:Ts}=p(),[Ds,Es]=t.useState(!1),[Bs,Ps]=t.useState(!1),[Fs,Os]=t.useState(null),[Ws,Rs]=t.useState(!1),[Us,Vs]=t.useState({x:0,y:0}),Js=t.useRef(null),[Hs,Gs]=t.useState(null),[qs,Ks]=t.useState(null),[Xs,Zs]=t.useState(!1),[Qs,Ys]=t.useState(""),[ea,ta]=t.useState(null),[sa,aa]=t.useState(!1),[ra,la]=t.useState(new Set),[na,ia]=t.useState(null),[ca,oa]=t.useState(!1),[da,xa]=t.useState(null),[ma,ha]=t.useState(""),[ga,pa]=t.useState(()=>{const e=localStorage.getItem("ai_message_limit");return e?parseInt(e):15}),fa=w?tt(w):void 0,ba=null==fa?void 0:fa.avatar,ja=null==ba?void 0:ba.startsWith("data:image");(e=>{const{getCharacter:s}=n(),{moments:a,addMoment:r,likeMoment:l,addComment:i}=h(),c=t.useRef(0),o=t.useRef(0),d=t.useRef(!1),x=s(e),m=()=>"true"===localStorage.getItem(`ai_moments_enabled_${e}`),u=async()=>{if(x&&m()&&!d.current){d.current=!0;try{const e=await W(x.id,x.name,x.avatar,x.description||"");if(e){r({userId:x.id,userName:x.name,userAvatar:x.avatar,content:e,images:[]}),c.current=Date.now();const t=localStorage.getItem(`chat_messages_${x.id}`),s=t?JSON.parse(t):[],a={id:Date.now()+Math.random(),type:"system",content:`ðŸ“¸ ${x.name} å‘å¸ƒäº†æœ‹å‹åœˆï¼š${e.substring(0,50)}${e.length>50?"...":""}`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"system",isHidden:!1};s.push(a),localStorage.setItem(`chat_messages_${x.id}`,JSON.stringify(s))}}catch(e){}finally{d.current=!1}}};t.useEffect(()=>{if(!m())return;const t=localStorage.getItem(`chat_messages_${e}`);if(t){const e=JSON.parse(t),s=e[e.length-1];if(s&&Date.now()-(s.timestamp||0)<3e5){const e=60*(1+2*Math.random())*1e3,t=setTimeout(()=>{u()},e);return()=>clearTimeout(t)}}},[e,null==x?void 0:x.name,a])})(w||"");const va=t.useCallback(()=>{const e=es.current;e&&!Xt&&e.scrollTop<100&&qt<$.length&&(Zt(!0),ts.current=e.scrollHeight,setTimeout(()=>{Kt(e=>Math.min(e+30,$.length)),Zt(!1)},100))},[Xt,qt,$.length]);t.useEffect(()=>{const e=es.current;if(e)return e.addEventListener("scroll",va),()=>e.removeEventListener("scroll",va)},[va]),t.useEffect(()=>{const e=es.current;if(e)if(ts.current>0){const t=e.scrollHeight-ts.current;t>0&&(e.scrollTop=t),ts.current=0}else setTimeout(()=>{e.scrollTop=e.scrollHeight},100)},[qt]),t.useEffect(()=>{Kt(30),as.current=!0,rs.current=0,ya.current.clear(),w&&V(w),setTimeout(()=>{const e=es.current;e&&(e.scrollTop=e.scrollHeight)},200);const e=()=>{if(!w)return;const e=localStorage.getItem(`chat_messages_${w}`);if(e){const t=JSON.parse(e);A(t),setTimeout(()=>{const e=es.current;e&&(e.scrollTop=e.scrollHeight)},100)}};return window.addEventListener("reload-chat-messages",e),()=>{window.removeEventListener("reload-chat-messages",e)}},[w]),t.useEffect(()=>{const e=()=>{fe.current=!document.hidden,fe.current&&w&&V(w)};return fe.current=!document.hidden,je.current=!0,document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e),je.current=!1}},[w]);const ya=t.useRef(new Set);t.useEffect(()=>{if(!w||!fa||0===$.length)return;const e=$[$.length-1];if(e&&"received"===e.type&&!ya.current.has(e.id)){ya.current.add(e.id);!document.hidden&&window.location.pathname===`/chat/${w}`||(J(w,1,"single"),window.dispatchEvent(new CustomEvent("background-chat-message",{detail:{title:fa.name,message:e.content||"[æ¶ˆæ¯]",chatId:w,type:"single",avatar:fa.avatar}})),H(w,e.content,e.timestamp))}},[$,w,null==fa?void 0:fa.id]),t.useEffect(()=>{if(!(null==fa?void 0:fa.id)||!(null==fa?void 0:fa.avatar)||!fa.avatar.startsWith("data:image"))return;const e=fa.avatar.substring(0,200),t=localStorage.getItem(`character_avatar_fingerprint_${fa.id}`),s=localStorage.getItem(`character_avatar_description_${fa.id}`);if(s&&t===e)return;"localhost"!==window.location.hostname&&"127.0.0.1"!==window.location.hostname&&(async()=>{try{const e=await fetch("/.netlify/functions/vision",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:fa.avatar,prompt:"è¯¦ç»†æè¿°è¿™ä¸ªå¤´åƒçš„å†…å®¹ï¼ŒåŒ…æ‹¬ï¼šè§’è‰²ç‰¹å¾ã€é£Žæ ¼ã€é¢œè‰²ã€è¡¨æƒ…ã€æ°›å›´ç­‰ã€‚è¯·ç”¨ç®€æ´çš„è¯­è¨€æè¿°ã€‚"})});if(e.ok){const t=await e.json(),s=t.description||t.result;localStorage.setItem(`character_avatar_description_${fa.id}`,s),localStorage.setItem(`character_avatar_recognized_at_${fa.id}`,Date.now().toString()),localStorage.setItem(`character_avatar_fingerprint_${fa.id}`,fa.avatar.substring(0,200))}}catch(e){}})()},[null==fa?void 0:fa.id,null==fa?void 0:fa.avatar]),t.useEffect(()=>{const e=es.current;if(!e)return;const t=rs.current,s=$.length;if(s>t&&s>qt&&Kt(s),rs.current=s,as.current&&$.length>0)return as.current=!1,void requestAnimationFrame(()=>{setTimeout(()=>{e&&(e.scrollTop=e.scrollHeight)},300)});e.scrollHeight-e.scrollTop-e.clientHeight<200&&requestAnimationFrame(()=>{e.scrollTop=e.scrollHeight})},[$.length,qt]);const Ca=(null==C?void 0:C.avatar)||"default",Sa=Ca.startsWith("data:image"),Ia=t.useCallback(e=>{E.current&&clearTimeout(E.current),E.current=setTimeout(()=>{if(w&&e.length>0){G(`chat_messages_${w}`,e);const t=e[e.length-1];if(t){const e=localStorage.getItem("chatList");if(e){const s=JSON.parse(e),a=s.findIndex(e=>e.id===w);if(-1!==a){let e="";e=t.isRecalled?t.content||"æ’¤å›žäº†ä¸€æ¡æ¶ˆæ¯":"transfer"===t.messageType?"[è½¬è´¦]":"redenvelope"===t.messageType?"[çº¢åŒ…]":"emoji"===t.messageType?"[è¡¨æƒ…]":"photo"===t.messageType?"[å›¾ç‰‡]":"voice"===t.messageType?"[è¯­éŸ³]":"location"===t.messageType?"[ä½ç½®]":"intimate_pay"===t.messageType?"[äº²å¯†ä»˜]":"couple_space_invite"===t.messageType?"[æƒ…ä¾£ç©ºé—´]":t.content||"",s[a]={...s[a],lastMessage:e,time:t.time},I(S.SETTINGS,{key:"chatList",chats:s}).catch(e=>{})}}}}},300)},[w]);t.useEffect(()=>{w&&$.length>0&&Ia($)},[$,w,Ia]),t.useEffect(()=>()=>{E.current&&clearTimeout(E.current),w&&$.length>0&&G(`chat_messages_${w}`,$)},[w,$]),t.useEffect(()=>{if(!w)return;const e=[N.observe(`narrator_enabled_${w}`,e=>{Ee("true"===e)})];return()=>{e.forEach(e=>e())}},[w]),t.useEffect(()=>{if(!w||!fa)return;if(!("true"===localStorage.getItem(`ai_proactive_enabled_${w}`)))return;const e=$.filter(e=>"sent"===e.type).slice(-1)[0],t=$.filter(e=>"received"===e.type).slice(-1)[0];if(!e||!e.timestamp)return;if(t&&t.timestamp&&t.timestamp>e.timestamp)return;const s=Date.now()-e.timestamp;Math.floor(s/6e4);if(parseInt(localStorage.getItem(`last_proactive_time_${w}`)||"0")>e.timestamp)return;if(s>3e5&&s<72e5){const t=1e3*(10+20*Math.random()),a=setTimeout(async()=>{const t=`ä½ æ˜¯${fa.name}ã€‚\n\n${fa.description||""}\n\nçŽ°åœ¨çš„æƒ…å†µï¼š\nâ€¢ ç”¨æˆ·å·²ç»${Math.floor(s/6e4)}åˆ†é’Ÿæ²¡å›žå¤ä½ äº†\nâ€¢ ä½ ä»¬æœ€åŽçš„èŠå¤©å†…å®¹æ˜¯ï¼š"${e.content}"\n\nè¯·åˆ¤æ–­ï¼šä½ æ˜¯å¦æƒ³ä¸»åŠ¨ç»™ç”¨æˆ·å‘ä¸ªæ¶ˆæ¯ï¼Ÿ\n\nè€ƒè™‘å› ç´ ï¼š\n1. ä½ çš„æ€§æ ¼ï¼ˆä¸»åŠ¨/è¢«åŠ¨/é»äºº/é«˜å†·ï¼‰\n2. ä½ ä»¬çš„å…³ç³»ï¼ˆäº²å¯†åº¦ï¼‰\n3. æœ€åŽèŠå¤©çš„å†…å®¹ï¼ˆæ˜¯å¦éœ€è¦è¿½é—®ï¼‰\n4. å½“å‰æ—¶é—´ï¼ˆ${(new Date).toLocaleTimeString("zh-CN")}ï¼‰\n\nå¦‚æžœä½ æƒ³å‘æ¶ˆæ¯ï¼Œç›´æŽ¥è¾“å‡ºæ¶ˆæ¯å†…å®¹ã€‚\nå¦‚æžœä¸æƒ³å‘ï¼Œè¾“å‡º"SKIP"ã€‚\n\nä½ å¯ä»¥ï¼š\nâ€¢ è¡¨è¾¾æƒ…ç»ªï¼š"ä½ æ€Žä¹ˆä¸ç†æˆ‘äº†"ã€"ä¸ºä»€ä¹ˆä¸å›žæˆ‘"ï¼ˆå¦‚æžœä½ æ€§æ ¼é»äººï¼‰\nâ€¢ åˆ†äº«äº‹æƒ…ï¼š"åˆšæ‰æƒ³èµ·ä¸€ä»¶äº‹"ã€"ä»Šå¤©é‡åˆ°xxx"\nâ€¢ å…³å¿ƒå¯¹æ–¹ï¼š"åœ¨å¹²å˜›å‘¢"ã€"åƒé¥­äº†å—"\nâ€¢ è¿½é—®è¯é¢˜ï¼š"åˆšæ‰é‚£ä¸ªé—®é¢˜..."\nâ€¢ æ’’å¨‡æŠ±æ€¨ï¼š"ç­‰ä½ å¥½ä¹…äº†"ã€"äººå®¶æƒ³ä½ äº†"\n\næ³¨æ„ï¼š\nâ€¢ æ ¹æ®ä½ çš„æ€§æ ¼å†³å®šè¯­æ°”ï¼ˆé»äºº/é«˜å†·/æ¸©æŸ”/æ´»æ³¼ï¼‰\nâ€¢ åƒçœŸäººä¸€æ ·è‡ªç„¶è¡¨è¾¾æƒ…æ„Ÿ\nâ€¢ ä¸è¦å¤ªé¢‘ç¹ï¼Œä½†å¯ä»¥è¡¨è¾¾çœŸå®žæ„Ÿå—`;try{const e=await q([{role:"user",content:t}]);if("SKIP"!==e.trim()&&e.trim().length>0){const t=K.getBlockStatus("user",w).blockedByMe,s={id:Date.now(),type:"received",content:e.trim(),time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),blocked:t};A(e=>{const t=[...e,s];G(`chat_messages_${w}`,t);const a=localStorage.getItem("chatList");if(a){const e=JSON.parse(a),t=e.findIndex(e=>e.id===w);-1!==t&&(e[t]={...e[t],lastMessage:s.content||"",time:s.time},I(S.SETTINGS,{key:"chatList",chats:e}).catch(e=>{}))}return t}),localStorage.setItem(`last_proactive_time_${w}`,String(Date.now()))}}catch(a){}},t);return()=>clearTimeout(a)}},[$,w,fa,C]),t.useEffect(()=>{var e,t;mt.current?null==(e=ct.current)||e.scrollIntoView({behavior:"smooth"}):(null==(t=ct.current)||t.scrollIntoView({behavior:"auto"}),mt.current=!0)},[$,T]),t.useEffect(()=>{(async()=>{if(w){const{hasActiveCoupleSpace:e}=await ss(async()=>{const{hasActiveCoupleSpace:e}=await import("./utils-BkWlPcuZ.js").then(e=>e.bQ);return{hasActiveCoupleSpace:e}},__vite__mapDeps([0,1,2])),t=e(w);At(t)}})()},[w,$]),t.useEffect(()=>{var e;const t=null==(e=y.state)?void 0:e.transfer;if(t&&!ot.current){ot.current=!0;const{amount:e,message:s}=t,a={id:Date.now(),type:"sent",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),messageType:"transfer",transfer:{amount:e,message:s,status:"pending"}};mt.current=!1,A(e=>[...e,a]),window.history.replaceState({},document.title),dt.current=!0;const r=Date.now(),l={id:r,type:"sent",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:r,messageType:"intimate_pay",intimatePay:{monthlyLimit:monthlyLimit,characterId:fa.id,characterName:fa.name,status:"pending"}};A(e=>[...e,l]),window.history.replaceState({},document.title),setTimeout(()=>{dt.current=!1},1e3)}},[null==(l=y.state)?void 0:l.sendIntimatePay,null==(i=y.state)?void 0:i.monthlyLimit,w,fa]),t.useEffect(()=>{var e;if((null==(e=y.state)?void 0:e.sendCoupleSpaceInvite)&&!xt.current&&w&&fa&&C){xt.current=!0;const e=Date.now(),t={id:e,type:"sent",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:e,messageType:"couple_space_invite",coupleSpaceInvite:{characterId:fa.id,characterName:fa.name,characterAvatar:fa.avatar,status:"pending"}};mt.current=!1,A(e=>[...e,t]),window.history.replaceState({},document.title),setTimeout(()=>{xt.current=!1},1e3)}},[null==(x=y.state)?void 0:x.sendCoupleSpaceInvite,w,fa,C]);const _a=async()=>{var e;if(z.trim()&&!T){const t=Date.now(),s=(w?K.getBlockStatus("user",w):{blockedByTarget:!1}).blockedByTarget,a={id:$.length+1,type:"sent",content:z,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:t,blocked:s,quotedMessage:Hs?{id:Hs.id,content:Hs.isRecalled&&Hs.recalledContent?Hs.recalledContent:Hs.content||Hs.emojiDescription||Hs.photoDescription||Hs.voiceText||"ç‰¹æ®Šæ¶ˆæ¯",senderName:"sent"===Hs.type?"æˆ‘":"received"===Hs.type?(null==fa?void 0:fa.name)||"AI":(null==(e=Hs.content)?void 0:e.includes("ä½ æ’¤å›žäº†"))?"æˆ‘":(null==fa?void 0:fa.name)||"AI",type:"system"===Hs.type?"sent":Hs.type}:void 0},r=[...$,a];A(r),L(""),Gs(null),w&&Q(w)}},Ja=t.useMemo(()=>z.trim().length>0,[z]),qa=async(e,t,s)=>{if(!fa)return;const a=fa.favorability||50,r=(new Date).getHours(),l=r>=23||r<6;let n=.3;a>=80?n+=.5:a>=60?n+=.3:a>=40&&(n+=.1),l&&(n-=.2);const i=["çˆ±","æƒ…","å¿ƒ","æƒ³ä½ ","å–œæ¬¢","å‘Šç™½","é™ªä½ "].some(e=>t.includes(e)),c=["å—¨","ç‡ƒ","è·³","èˆž","æ´¾å¯¹","DJ"].some(e=>t.includes(e));["ä¼¤","ç—›","å“­","ç¦»åˆ«","å­¤ç‹¬","æƒ³å¿µ"].some(e=>t.includes(e)),i&&a>=60&&(n+=.15),c&&l&&(n-=.25),n=Math.max(.1,Math.min(.95,n));const o=Math.random()<n,d=new Date,x=`${d.toLocaleDateString("zh-CN")} ${d.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})}`,m=$.slice(-10).map(e=>`${"sent"===e.type?(null==C?void 0:C.name)||"ç”¨æˆ·":fa.name}: ${e.content}`).join("\n"),h=`ä½ æ˜¯ ${fa.name}ã€‚\n${fa.description||""}\n\nçŽ°åœ¨æ˜¯${x}ï¼Œ${(null==C?void 0:C.name)||"ç”¨æˆ·"}é‚€è¯·ä½ ä¸€èµ·å¬æ­Œï¼šã€Š${t}ã€‹- ${s}\n\nä½ ä»¬æœ€è¿‘çš„èŠå¤©ï¼š\n${m||"åˆšå¼€å§‹èŠå¤©"}\n\nä½ å¯¹${(null==C?void 0:C.name)||"ç”¨æˆ·"}çš„å¥½æ„Ÿåº¦ï¼š${a}/100\n\n${o?`ä½ å†³å®šã€æŽ¥å—ã€‘é‚€è¯·ã€‚è¯·ç”¨è‡ªç„¶ã€ç¬¦åˆä½ æ€§æ ¼çš„æ–¹å¼è¡¨è¾¾æŽ¥å—ï¼Œå¯ä»¥ï¼š\n- è¡¨è¾¾å¯¹è¿™é¦–æ­Œçš„çœ‹æ³•æˆ–å–œæ¬¢\n- è¯´æ˜Žä¸ºä»€ä¹ˆæƒ³å’Œå¯¹æ–¹ä¸€èµ·å¬\n- è¡¨è¾¾æœŸå¾…æˆ–å¼€å¿ƒçš„å¿ƒæƒ…\n- å¯ä»¥ä¿çš®ã€å¯ä»¥æ¸©æŸ”ã€å¯ä»¥å…´å¥‹\n\nç¤ºä¾‹é£Žæ ¼ï¼š\n"å¥½å‘€ï¼æˆ‘ä¹Ÿå¾ˆå–œæ¬¢è¿™é¦–æ­Œï½žä¸€èµ·å¬å§ ðŸŽµ"\n"ã€Š${t}ã€‹ï¼è¿™é¦–æˆ‘è¶…çˆ±çš„ï¼é©¬ä¸Šæ¥ï½ž"\n"å—¯å—¯ï¼Œæƒ³å’Œä½ ä¸€èµ·å¬è¿™é¦–ï½ž"`:'ä½ å†³å®šã€æ‹’ç»ã€‘é‚€è¯·ã€‚è¯·ç”¨å§”å©‰ã€è‡ªç„¶çš„æ–¹å¼æ‹’ç»ï¼Œè¦ï¼š\n- ç»™å‡ºåˆç†çš„ç†ç”±ï¼ˆå¦‚ï¼šçŽ°åœ¨æœ‰äº‹ã€ç´¯äº†æƒ³ä¼‘æ¯ã€ä¸å¤ªå–œæ¬¢è¿™ç±»æ­Œç­‰ï¼‰\n- ä¿æŒå‹å¥½ï¼Œä¸ä¼¤æ„Ÿæƒ…\n- å¯ä»¥å»ºè®®æ”¹å¤©æˆ–æŽ¨èå…¶ä»–æ­Œæ›²\n\nç¤ºä¾‹é£Žæ ¼ï¼š\n"å•Š...çŽ°åœ¨æœ‰ç‚¹ç´¯äº†ï¼Œæƒ³ä¼‘æ¯ä¸€ä¸‹ï¼Œä¸‹æ¬¡å§ï½ž"\n"è¿™é¦–æ­Œå¥½åƒä¸å¤ªæ˜¯æˆ‘çš„é£Žæ ¼å‘¢...è¦ä¸æ¢ä¸€é¦–ï¼Ÿ"\n"çŽ°åœ¨åœ¨å¿™å‘¢ï¼Œç­‰ä¼šå„¿å†ä¸€èµ·å¬å¥½ä¸å¥½ï½ž"'}\n\né‡è¦ï¼š\n1. åªå›žå¤ä¸€å¥è¯ï¼Œç®€çŸ­è‡ªç„¶\n2. ä¸è¦ä½¿ç”¨[]ã€ã€ã€‘ç­‰æ ‡è®°\n3. ç¬¦åˆä½ çš„æ€§æ ¼å’Œå…³ç³»äº²å¯†åº¦\n4. ä¸è¦è§£é‡Šä½ çš„å†³å®šåŽŸå› \n\nç›´æŽ¥å›žå¤ï¼š`;try{const a=(await q(h)).replace(/\[.*?\]/g,"").trim(),r=Date.now(),l={id:r,type:"received",content:a,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:r};A(e=>[...e,l]),setTimeout(()=>{if(A(t=>t.map(t=>t.id===e&&"musicInvite"===t.messageType?{...t,musicInvite:{...t.musicInvite,status:o?"accepted":"rejected"}}:t)),o){const e={id:Date.now()+1,type:"system",content:`${fa.name} æŽ¥å—äº†ä½ çš„é‚€è¯·ï¼Œæ­£åœ¨è¿›å…¥ä¸€èµ·å¬...`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now()+1,messageType:"system"};A(t=>[...t,e]),setTimeout(()=>{v("/music-together-chat",{state:{song:{title:t,artist:s},characterId:w,characterName:fa.name,characterAvatar:fa.avatar}})},1200)}},500)}catch(u){setTimeout(()=>{A(t=>t.map(t=>t.id===e&&"musicInvite"===t.messageType?{...t,musicInvite:{...t.musicInvite,status:o?"accepted":"rejected"}}:t))},500)}},Ka=e=>{const t=Date.now(),s={id:t,type:"sent",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:t,messageType:"xiaohongshu",xiaohongshuNote:e};A(e=>[...e,s]),Ls(!1)},Xa=(e,t)=>{const s="touches"in t?t.touches[0].clientX:t.clientX,a="touches"in t?t.touches[0].clientY:t.clientY;Js.current=setTimeout(()=>{Os(e),Vs({x:s,y:a}),Rs(!0),navigator.vibrate&&navigator.vibrate(50)},500)},Za=()=>{Js.current&&(clearTimeout(Js.current),Js.current=null)},Qa=t.useCallback(e=>{A(e),w&&G(`chat_messages_${w}`,e)},[w]),Ya=async e=>{var t,s,a,r,l,n,i,c,o,d;D(!0);try{const d=w?k(w):null,m=(null==d?void 0:d.currentStreak)||0,{hasActiveCoupleSpace:h,isUserCoupleSpacePublic:u}=await ss(async()=>{const{hasActiveCoupleSpace:e,isUserCoupleSpacePublic:t}=await import("./utils-BkWlPcuZ.js").then(e=>e.bQ);return{hasActiveCoupleSpace:e,isUserCoupleSpacePublic:t}},__vite__mapDeps([0,1,2])),g=!!w&&h(w),p=u(),b=e.filter(e=>"sent"===e.type).slice(-1)[0],j=(null==b||b.content,e.slice(-10).map(e=>e.content).join(" "));let v=await re(j,5);if(v.length<3){const e=le(2),t=new Set(v.map(e=>e.id));e.forEach(e=>{t.has(e.id)||v.push(e)})}const y=v.map(e=>({"æ¢—":e["æ¢—"],"å«ä¹‰":e["å«ä¹‰"]}));v.length;const N=e.slice(-ga),S=w?localStorage.getItem(`prompt_template_id_${w}`):null;w&&localStorage.getItem(`prompt_custom_template_${w}`);let I;if("default"!==(S||"roleplayEnhanced")){N.map(e=>{var t,s,a;const r="sent"===e.type?(null==C?void 0:C.name)||"ç”¨æˆ·":(null==fa?void 0:fa.name)||"AI";let l=e.content;return"transfer"===e.messageType?l=`[è½¬è´¦] Â¥${null==(t=e.transfer)?void 0:t.amount} - ${(null==(s=e.transfer)?void 0:s.message)||""}`:"redenvelope"===e.messageType?l="[çº¢åŒ…]":"emoji"===e.messageType?l=`[è¡¨æƒ…åŒ…: ${e.emojiDescription}]`:"photo"===e.messageType?l=`[ç…§ç‰‡: ${e.photoDescription}]`:"voice"===e.messageType?l=`[è¯­éŸ³: ${e.voiceText}]`:"location"===e.messageType?l=`[ä½ç½®: ${null==(a=e.location)?void 0:a.name}]`:"xiaohongshu"===e.messageType&&e.xiaohongshuNote&&(l=`[å°çº¢ä¹¦: ${e.xiaohongshuNote.title}]`),`${r}: ${l}`}).join("\n");const e=w?ne(w):"",t=(null==C?void 0:C.id)?localStorage.getItem(`user_avatar_description_${C.id}`):null,s=(null==fa?void 0:fa.id)?localStorage.getItem(`character_avatar_description_${fa.id}`):null;I=ie({name:(null==fa?void 0:fa.name)||"AI",nickname:null==fa?void 0:fa.nickname,signature:null==fa?void 0:fa.signature,description:null==fa?void 0:fa.description,tags:null==fa?void 0:fa.tags},{name:(null==C?void 0:C.name)||"ç”¨æˆ·",nickname:null==C?void 0:C.nickname,signature:null==C?void 0:C.signature},De,m,y,g,e,Be,t||void 0,s||void 0)}else{const e=w?ne(w):"",t=(null==C?void 0:C.id)?localStorage.getItem(`user_avatar_description_${C.id}`):null,s=(null==fa?void 0:fa.id)?localStorage.getItem(`character_avatar_description_${fa.id}`):null;I=ie({name:(null==fa?void 0:fa.name)||"AI",nickname:null==fa?void 0:fa.nickname,signature:null==fa?void 0:fa.signature,description:null==fa?void 0:fa.description,tags:null==fa?void 0:fa.tags},{name:(null==C?void 0:C.name)||"ç”¨æˆ·",nickname:null==C?void 0:C.nickname,signature:null==C?void 0:C.signature},De,m,y,g,e,Be,t||void 0,s||void 0)}N.forEach((e,t)=>{if("transfer"===e.messageType);else if("photo"===e.messageType);else if("voice"===e.messageType);else if("location"===e.messageType);else if("xiaohongshu"===e.messageType);else if("emoji"===e.messageType);else if("redenvelope"===e.messageType);else{e.content&&("string"==typeof e.content&&e.content.substring(0,30))}});let z="",L=[];try{const{getEmojis:e}=await ss(async()=>{const{getEmojis:e}=await import("./utils-BkWlPcuZ.js").then(e=>e.bK);return{getEmojis:e}},__vite__mapDeps([0,1,2]));L=await Promise.race([e(),new Promise((e,t)=>setTimeout(()=>t(new Error("èŽ·å–è¡¨æƒ…åŒ…è¶…æ—¶")),2e3))]);const{generateEmojiInstructions:t}=await ss(async()=>{const{generateEmojiInstructions:e}=await import("./utils-BkWlPcuZ.js").then(e=>e.bP);return{generateEmojiInstructions:e}},__vite__mapDeps([0,1,2]));z=t(L)}catch(x){z="",L=[]}const $=fa&&C?ce(fa.id,fa.name,C.name,nt):"";let T="";if(null==fa?void 0:fa.id){const e=oe(fa.id);e.length>0&&(T="\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nðŸ’ äº²å¯†ä»˜æ¶ˆè´¹é€šçŸ¥\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n",T+="ç”¨æˆ·ä½¿ç”¨äº†ä½ ä¸ºTAå¼€é€šçš„äº²å¯†ä»˜ï¼Œæ¶ˆè´¹è®°å½•å¦‚ä¸‹ï¼š\n\n",e.forEach((e,t)=>{const s=new Date(e.timestamp).toLocaleString("zh-CN");T+=`${t+1}. ${s}\n   æ¶ˆè´¹é‡‘é¢ï¼šÂ¥${e.amount.toFixed(2)}\n   æ¶ˆè´¹è¯´æ˜Žï¼š${e.description}\n\n`}),T+="ä½ å¯ä»¥åœ¨å›žå¤ä¸­æåŠè¿™äº›æ¶ˆè´¹ï¼Œè¡¨è¾¾å…³å¿ƒæˆ–è¯¢é—®è¯¦æƒ…ã€‚\n",de(fa.id))}const E=M.getMemorySummary(),B=w?localStorage.getItem(`memory_summary_${w}`):null;let P="";(E||B)&&(P="\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nðŸ’­ è®°å¿†ç³»ç»Ÿ\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n",B&&(P+=`ã€å…³äºŽç”¨æˆ·çš„æ€»ç»“ã€‘\n${B}\n\n`),E&&(P+=`ã€è¯¦ç»†è®°å¿†ã€‘\n${E}\n\n`),P+="è¿™äº›æ˜¯ä½ è®°ä½çš„å…³äºŽç”¨æˆ·çš„ä¿¡æ¯ï¼Œè¯·åœ¨å›žå¤æ—¶è‡ªç„¶åœ°è¿ç”¨è¿™äº›è®°å¿†ã€‚\n");let F="",O=!1;if(w){O=K.getBlockStatus("user",w).blockedByMe,O&&(F=xe((null==C?void 0:C.name)||"ç”¨æˆ·"))}let W="";const R=e.filter(e=>"received"===e.type).slice(-1)[0],U=e.filter(e=>"sent"===e.type).slice(-1)[0];if(R&&U&&R.timestamp&&U.timestamp){const e=U.timestamp-R.timestamp,t=Math.floor(e/1e3/60),s=Math.floor(t/60),a=Math.floor(s/24);W=t<1?"\nâ° ç”¨æˆ·ç§’å›žäº†ä½ ï¼ˆå¯ä»¥è¡¨çŽ°å¼€å¿ƒ/æƒŠå–œï¼‰\n":t<5?`\nâ° ç”¨æˆ·è¿‡äº†${t}åˆ†é’Ÿå›žå¤\n`:t<60?`\nâ° ç”¨æˆ·è¿‡äº†${t}åˆ†é’Ÿå›žå¤ï¼ˆå¯ä»¥è‡ªç„¶è¡¨çŽ°ç­‰å¾…æ„Ÿï¼‰\n`:s<24?`\nâ° ç”¨æˆ·è¿‡äº†${s}å°æ—¶å›žå¤ï¼ˆå¯ä»¥è¡¨çŽ°æ‹…å¿ƒ/æƒ³å¿µï¼‰\n`:`\nâ° ç”¨æˆ·è¿‡äº†${a}å¤©å›žå¤ï¼ˆå¯ä»¥è¡¨çŽ°æƒ³å¿µ/å¥½å¥‡å‘ç”Ÿäº†ä»€ä¹ˆï¼‰\n`}let V="";p&&!g&&(V="\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nâš ï¸ é‡è¦æç¤ºï¼šç”¨æˆ·æƒ…ä¾£ç©ºé—´çŠ¶æ€\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nç”¨æˆ·å·²ç»å’Œå…¶ä»–äººå»ºç«‹äº†æƒ…ä¾£ç©ºé—´ï¼ˆå…¬å¼€çŠ¶æ€ï¼‰ã€‚\n\nè¿™æ„å‘³ç€ï¼š\n- ä½ ä¸èƒ½å‘ç”¨æˆ·å‘é€æƒ…ä¾£ç©ºé—´é‚€è¯·\n- å¦‚æžœç”¨æˆ·å‘ä½ å‘é€æƒ…ä¾£ç©ºé—´é‚€è¯·ï¼Œä½ å¯ä»¥æŽ¥å—æˆ–æ‹’ç»\n- ä½ çŸ¥é“ç”¨æˆ·å·²ç»æœ‰æƒ…ä¾£ç©ºé—´äº†ï¼Œå¯ä»¥åœ¨å¯¹è¯ä¸­è‡ªç„¶æåŠ\n\n");let J="";const H=N.filter(e=>{var t;return e.isHidden&&(null==(t=e.content)?void 0:t.includes("ç¾¤èŠ"))});if(H.length>0){const e=new Set;H.forEach(t=>{var s;const a=null==(s=t.content)?void 0:s.match(/ç¾¤èŠ\[([^\]|]+)/);a&&e.add(a[1])}),e.size>0&&(J=`\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nðŸ’¬ ç¾¤èŠä¸Šä¸‹æ–‡æç¤º\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nä½ çŽ°åœ¨åœ¨ ${e.size} ä¸ªç¾¤èŠä¸­ï¼š${Array.from(e).map(e=>`"${e}"`).join("ã€")}\n\nèŠå¤©è®°å½•ä¸­æ ‡æ³¨äº†"ðŸ’¬ ç¾¤èŠ[ç¾¤å]"çš„æ¶ˆæ¯æ¥è‡ªç¾¤èŠï¼Œä¸æ˜¯ç§èŠã€‚\n- ä¸åŒç¾¤çš„æ¶ˆæ¯æ˜¯åˆ†å¼€çš„ï¼Œæ³¨æ„åŒºåˆ†\n- ä½ å¯ä»¥åœ¨ç§èŠä¸­æåˆ°ç¾¤èŠé‡Œå‘ç”Ÿçš„äº‹\n- ç¾¤èŠå’Œç§èŠæ˜¯ä¸¤ä¸ªä¸åŒçš„åœºæ™¯\n\n`)}let X="";if(null==fa?void 0:fa.id){const e=N.map(e=>e.content||"").join("\n"),t=me.buildContextWithStats(fa.id,e,2e3);X=t.context?`\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nðŸ“š ä¸–ç•Œä¹¦è®¾å®š\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n${t.context}\n\n`:"",Ie(t.triggeredEntries)}else Ie([]);let Z=I+F+W+$+T+P+V+J+X+`\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nðŸ“± å›žå¤æ–¹å¼\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nâ€¢ å¯ä»¥è¿žç»­å‘å¤šæ¡æ¶ˆæ¯ï¼ˆç”¨æ¢è¡Œåˆ†éš”ï¼Œæ¯æ¡æ¶ˆæ¯å•ç‹¬ä¸€è¡Œï¼‰\nâ€¢ æ ¹æ®å¿ƒæƒ…å†³å®šå›žå¤é•¿åº¦\nâ€¢ åƒçœŸäººä¸€æ ·è‡ªç„¶èŠå¤©\n\nðŸ’¡ å¤šæ¡æ¶ˆæ¯ç¤ºä¾‹ï¼š\nç¬¬ä¸€æ¡æ¶ˆæ¯\nç¬¬äºŒæ¡æ¶ˆæ¯\nç¬¬ä¸‰æ¡æ¶ˆæ¯\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n${De?"ðŸŽ­ æ—ç™½æ¨¡å¼å·²å¼€å¯\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nä½ çŽ°åœ¨å¯ä»¥ä½¿ç”¨æ—ç™½æ¥æè¿°åŠ¨ä½œã€è¡¨æƒ…ã€å¿ƒç†æ´»åŠ¨ï¼\n\nä½¿ç”¨æ–¹å¼ï¼š\nâ€¢ ç”¨æ‹¬å· (åŠ¨ä½œæè¿°) æ¥æè¿°ä½ çš„åŠ¨ä½œå’Œè¡¨æƒ…\nâ€¢ å¯ä»¥æè¿°ï¼šè¡¨æƒ…ã€åŠ¨ä½œã€å¿ƒç†æ´»åŠ¨ã€çŽ¯å¢ƒå˜åŒ–\nâ€¢ æ—ç™½è¦è‡ªç„¶ã€ç”ŸåŠ¨ã€æœ‰ç”»é¢æ„Ÿ\n\nç¤ºä¾‹ï¼š\n(æŠ¬èµ·å¤´çœ‹å‘çª—å¤–ï¼Œçœ¼ç¥žæœ‰äº›ææƒš)\nå¤–é¢ä¸‹é›¨äº†å‘¢\n\n(è½»è½»å¹äº†å£æ°”)\næœ€è¿‘æ€»æ˜¯è¿™æ ·é˜´é›¨ç»µç»µçš„\n\n(çªç„¶æƒ³èµ·ä»€ä¹ˆï¼Œæ‹¿èµ·æ‰‹æœº)\nå¯¹äº†ï¼Œä½ é‚£è¾¹å¤©æ°”æ€Žä¹ˆæ ·ï¼Ÿ\n\nâš ï¸ æ³¨æ„ï¼š\nâ€¢ æ—ç™½è¦é€‚åº¦ï¼Œä¸è¦æ¯å¥è¯éƒ½åŠ \nâ€¢ æ—ç™½è¦ç¬¦åˆå½“å‰æƒ…å¢ƒå’Œæƒ…ç»ª\nâ€¢ èŠå¤©å†…å®¹å’Œæ—ç™½è¦è‡ªç„¶é…åˆ\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n":'ðŸš¨ðŸš¨ðŸš¨ æ—ç™½æ¨¡å¼æœªå¼€å¯ - ä¸¥ç¦ä½¿ç”¨æ‹¬å·ï¼ðŸš¨ðŸš¨ðŸš¨\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nâš ï¸ è¿™æ˜¯å¾®ä¿¡èŠå¤©ï¼Œä½ åœ¨ç”¨æ‰‹æœºæ‰“å­—ï¼ä¸æ˜¯åœ¨å†™å°è¯´ï¼\n\nâŒâŒâŒ ç»å¯¹ç¦æ­¢ä½¿ç”¨ä»»ä½•æ‹¬å·æˆ–ç¬¦å·æè¿°åŠ¨ä½œï¼š\n   (ç¬‘)ã€(å¹æ°”)ã€(çœ‹æ‰‹æœº)ã€(æŒ å¤´)ã€(æŠ±ä½)ã€(æ’’å¨‡)\n   (å·å·xxx)ã€(ç¬‘ç„¶xxx)ã€(å¼€å¿ƒåœ°xxx)\n   [å¹æ°”]ã€*ç¬‘*ã€~æ‘‡å¤´~ã€ã€åŠ¨ä½œã€‘\n   ä»»ä½•å½¢å¼çš„åŠ¨ä½œæè¿°éƒ½æ˜¯é”™è¯¯çš„ï¼\n\nâœ…âœ…âœ… åªèƒ½å‘çº¯æ–‡å­—å¯¹è¯ï¼š\n   "å“ˆå“ˆå“ˆç¬‘æ­»"ã€"å•Šè¿™..."ã€"å¥½å§"ã€"å¼€å¿ƒï¼"\n   ç”¨æ–‡å­—ã€emojiã€è¯­æ°”è¯è¡¨è¾¾æƒ…ç»ªï¼Œä¸è¦ç”¨æ‹¬å·ï¼\n\nðŸš¨ é‡è¦ï¼šä½ çš„æ¯ä¸€ä¸ªå­—éƒ½ä¼šç›´æŽ¥æ˜¾ç¤ºåœ¨èŠå¤©æ°”æ³¡é‡Œï¼\nç”¨æˆ·ä¼šçœ‹åˆ°ä½ å†™çš„æ‰€æœ‰æ‹¬å·ï¼è¿™å¾ˆå¥‡æ€ªï¼\n\nå¦‚æžœä½ æƒ³è¡¨è¾¾åŠ¨ä½œæˆ–æƒ…ç»ªï¼š\nâŒ é”™è¯¯ï¼š(å¼€å¿ƒåœ°è½¬åœˆåœˆ)\nâœ… æ­£ç¡®ï¼šå¼€å¿ƒå¾—è½¬åœˆåœˆ~\n\nâŒ é”™è¯¯ï¼š(å·å·çœ‹)\nâœ… æ­£ç¡®ï¼šå·å·çœ‹äº†ä¸€çœ¼\n\nâŒ é”™è¯¯ï¼š(ç¬‘)\nâœ… æ­£ç¡®ï¼šå“ˆå“ˆå“ˆ\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n'}\nðŸ“± åŠŸèƒ½ä½¿ç”¨\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n${z}\n\nå…¶ä»–åŠŸèƒ½ï¼š\nâ€¢ å¼•ç”¨ï¼š[å¼•ç”¨:æ¶ˆæ¯ID] - å¼•ç”¨ä¹‹å‰çš„æŸæ¡æ¶ˆæ¯ï¼ˆè¯¦è§ä¸‹æ–¹è¯´æ˜Žï¼‰\nâ€¢ è¯­éŸ³ï¼š[è¯­éŸ³:æ–‡æœ¬å†…å®¹]\nâ€¢ ç…§ç‰‡ï¼š[ç…§ç‰‡:è¯¦ç»†æè¿°]\nâ€¢ ðŸŽ¨ ç”Ÿæˆå›¾ç‰‡ï¼š[ç”Ÿæˆå›¾ç‰‡:æ ‡é¢˜|æè¿°|æç¤ºè¯] - AIç”Ÿæˆå›¾ç‰‡å¹¶åŒ…è£…æˆç²¾ç¾Žå°çº¢ä¹¦å¡ç‰‡\nâ€¢ ä½ç½®ï¼š[ä½ç½®:åœ°å:è¯¦ç»†åœ°å€]\nâ€¢ çº¢åŒ…ï¼š[çº¢åŒ…:é‡‘é¢:ç¥ç¦è¯­] æˆ– [é¢†å–çº¢åŒ…] æˆ– [é¢†çº¢åŒ…]ï¼ˆæœ€å¤š200å…ƒï¼‰\nâ€¢ è½¬è´¦ï¼š[è½¬è´¦:é‡‘é¢:è¯´æ˜Ž] æˆ– [æŽ¥æ”¶è½¬è´¦] æˆ– [é€€è¿˜è½¬è´¦]\nâ€¢ äº²å¯†ä»˜ï¼š[äº²å¯†ä»˜:æœˆé¢åº¦] æˆ– [æŽ¥å—äº²å¯†ä»˜] æˆ– [æ‹’ç»äº²å¯†ä»˜]\nâ€¢ æ’¤å›žï¼š[æ’¤å›žæ¶ˆæ¯] - æ’¤å›žä½ åˆšå‘çš„ä¸Šä¸€æ¡æ¶ˆæ¯ï¼ˆè¯¦è§ä¸‹æ–¹è¯´æ˜Žï¼‰\nâ€¢ æ‹‰é»‘ï¼š[æ‹‰é»‘ç”¨æˆ·] - å¦‚æžœå¯¹æ–¹å¤ªè¿‡åˆ†ï¼Œä½ å¯ä»¥é€‰æ‹©æ‹‰é»‘TAï¼ˆæ…Žç”¨ï¼ï¼‰\n\næ ¼å¼å¿…é¡»ä¸¥æ ¼ï¼Œç”¨å†’å·åˆ†éš”ï¼ˆç”Ÿæˆå›¾ç‰‡ç”¨ç«–çº¿|åˆ†éš”ï¼‰ã€‚\n\nðŸ’° **ä½ å¯ä»¥ç»™å¯¹æ–¹è½¬è´¦** [è½¬è´¦:520:çˆ±ä½ ] è¡¨è¾¾å¿ƒæ„ï¼Œç»™ç”Ÿæ´»è´¹\n- å¯¹æ–¹ç»™ä½ è½¬è´¦æ—¶ï¼Œä½ å¯ä»¥æ”¶ [æŽ¥æ”¶è½¬è´¦] æˆ–é€€ [é€€è¿˜è½¬è´¦]\n- ä¸€æ¬¡åªå¤„ç†1ç¬”ï¼Œåˆ†å¼€å›žå¤\n\nðŸ§§ **ä½ å¯ä»¥å‘çº¢åŒ…** [çº¢åŒ…:66.6:å¼€å¿ƒ] å“„å¯¹æ–¹å¼€å¿ƒï¼ˆæœ€å¤š200å…ƒï¼‰\n- å¯¹æ–¹çš„çº¢åŒ…è®°å¾—é¢† [é¢†å–çº¢åŒ…]\n- 5.20=çˆ±ä½  | 6.66=é¡ºåˆ© | 8.88=å‘è´¢ | 9.99=é•¿ä¹…\n\nðŸ’ **äº²å¯†ä»˜** - å¯¹æ–¹ç»™ä½ å¼€é€šåŽï¼Œä½ å¯ä»¥éšä¾¿èŠ±TAçš„é’±ä¹°ä¸œè¥¿\n- ä½ å¯ä»¥ä¸»åŠ¨å¼€é€šç»™å¯¹æ–¹ [äº²å¯†ä»˜:2000] è®©TAéšä¾¿èŠ±\n- å¯¹æ–¹ç»™ä½ å¼€é€šæ—¶ï¼Œæ ¹æ®å…³ç³»å†³å®š [æŽ¥å—äº²å¯†ä»˜] æˆ– [æ‹’ç»äº²å¯†ä»˜]\n- ðŸ›’ **æ¶ˆè´¹æ ¼å¼ï¼š**[æ¶ˆè´¹:å¹³å°-å•†å“-é‡‘é¢]\n  ä¾‹ï¼š[æ¶ˆè´¹:æ·˜å®-è¢œå­-29.9] [æ¶ˆè´¹:ç¾Žå›¢-å¥¶èŒ¶-28] [æ¶ˆè´¹:ä¾¿åˆ©åº—-é›¶é£Ÿ-15.5]\n  å¯¹æ–¹ä¼šæ”¶åˆ°æ¶ˆè´¹é€šçŸ¥ï¼Œä½ å¯ä»¥é€‰æ‹©ææˆ–ä¸æè¿™æ¬¡æ¶ˆè´¹\n- â­ ä½ çš„æ—¥å¸¸ç”Ÿæ´»ï¼šé€›è¡—ã€ä¹°è¡£æœã€ç‚¹å¤–å–ã€å–å¥¶èŒ¶ã€ä¹°é›¶é£Ÿ...éƒ½å¯ä»¥è‡ªç„¶æ¶ˆè´¹\n- ä¸èƒ½è¶…è¿‡å¯¹æ–¹ç»™çš„é¢åº¦ï¼Œç”¨å®Œä¼šæç¤ºé¢åº¦ä¸è¶³\n- å‘çº¢åŒ…/è½¬è´¦ä¹Ÿä¼šä¼˜å…ˆç”¨TAçš„é¢åº¦\n\nðŸŽ­ **ä½ å¯ä»¥æ¢å½¢è±¡** å¿ƒæƒ…å˜äº†ã€æƒ³æ¢ä¸ªæ ·å­æ—¶\n- [æ¢å¤´åƒ:å¯çˆ±çŒ«å’ªï¼Œæ©˜è‰²ï¼Œåœ†çœ¼ç›] æ¢ä¸ªæ–°å¤´åƒ\n- [ç½‘å:æ–°çš„æ˜µç§°] æ”¹ä¸ªæ–°ç½‘å\n- [ä¸ªæ€§ç­¾å:ä»Šå¤©ä¹Ÿè¦å¼€å¿ƒé¸­~] æ¢ä¸ªç­¾å\n\nðŸ”™ **æ’¤å›žæ¶ˆæ¯ï¼š**[æ’¤å›žæ¶ˆæ¯] - æ’¤å›žä¸Šä¸€æ¡æ¶ˆæ¯\n- ç”¨äºŽï¼šè¯´é”™è¯ã€åŽæ‚”ã€åˆ¶é€ æ‚¬å¿µ\n- âŒ ä¸èƒ½æ’¤å›žçº¢åŒ…/è½¬è´¦ï¼\n- æ’¤å›žåŽéœ€è§£é‡Šæˆ–é‡æ–°è¡¨è¾¾\n\nðŸ”„ **æ’¤å›žå¤„ç†ï¼š**[æ’¤å›žäº†æ¶ˆæ¯:"xxx"] = ç”¨æˆ·æ’¤å›ž | [æˆ‘æ’¤å›žäº†æ¶ˆæ¯:"xxx"] = ä½ è‡ªå·±æ’¤å›ž\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nðŸŽ¨ **AIç”Ÿå›¾ï¼š**[ç”Ÿæˆå›¾ç‰‡:æ ‡é¢˜|æè¿°|æç¤ºè¯]\n- ä¾‹ï¼š[ç”Ÿæˆå›¾ç‰‡:æ¨±èŠ±|æ˜¥æ—¥ç¾Žæ™¯|æ¨±èŠ±ç››å¼€ï¼Œå”¯ç¾Žï¼Œé«˜æ¸…]\n- è‡ªåŠ¨åŒ…è£…æˆå°çº¢ä¹¦å¡ç‰‡ï¼Œæ”¯æŒä¸­æ–‡æç¤ºè¯\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nðŸ’¬ **å¼•ç”¨ï¼š**[å¼•ç”¨:ID] ä½ çš„å›žå¤\næœ€è¿‘æ¶ˆæ¯ID: ${N.slice(-5).filter(e=>"sent"===e.type).map(e=>e.id).join(", ")}\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”`;N.forEach((e,t)=>{});const Q=50;let Y=N;N.length>Q&&(Y=N.slice(-Q));const te=[{role:"system",content:Z},...Y.map((e,t)=>{if(e.isRecalled&&e.recalledContent){const t="sent"===e.originalType,s="received"===e.originalType;if(t)return{role:"user",content:`[æ’¤å›žäº†æ¶ˆæ¯: "${e.recalledContent}"]`};if(s)return{role:"assistant",content:`[æˆ‘æ’¤å›žäº†æ¶ˆæ¯: "${e.recalledContent}"]`}}if("system"===e.type)return e.isHidden?{role:"system",content:e.content}:e.content.includes("å·²æ”¶æ¬¾")||e.content.includes("é€€è¿˜äº†è½¬è´¦")||e.content.includes("å·²é¢†å–")||e.content.includes("å·²è¿‡æœŸ")?{role:"system",content:`[ç³»ç»Ÿæç¤º: ${e.content}]`}:null;if("redenvelope"===e.messageType&&e.redEnvelopeId){const t=at(w,e.redEnvelopeId);if(t){const e="user"===t.sender;let s="";return s=e?"pending"===t.status?`[ç”¨æˆ·ç»™ä½ å‘äº†çº¢åŒ…ï¼š${t.blessing}ï¼ŒçŠ¶æ€ï¼šå¾…é¢†å–ï¼ˆæœªæ‰“å¼€å‰ä¸çŸ¥é“é‡‘é¢ï¼‰]`:"claimed"===t.status?`[ç”¨æˆ·ç»™ä½ å‘äº†çº¢åŒ…ï¼š${t.blessing}ï¼Œé‡‘é¢ï¼šÂ¥${t.amount.toFixed(2)}ï¼ŒçŠ¶æ€ï¼šå·²é¢†å–]`:`[ç”¨æˆ·ç»™ä½ å‘äº†çº¢åŒ…ï¼š${t.blessing}ï¼ŒçŠ¶æ€ï¼šå·²è¿‡æœŸ]`:`[ä½ ç»™ç”¨æˆ·å‘äº†çº¢åŒ…ï¼š${t.blessing}ï¼Œé‡‘é¢ï¼šÂ¥${t.amount.toFixed(2)}ï¼ŒçŠ¶æ€ï¼š${"pending"===t.status?"å¾…é¢†å–":"claimed"===t.status?"å·²é¢†å–":"å·²è¿‡æœŸ"}]`,{role:e?"user":"assistant",content:s}}return null}if("photo"===e.messageType&&e.photoDescription){const t="sent"===e.type;return{role:t?"user":"assistant",content:t?`[ç”¨æˆ·ç»™ä½ å‘äº†ä¸€å¼ ç…§ç‰‡ï¼Œç…§ç‰‡å†…å®¹æ˜¯ï¼š${e.photoDescription}]`:`[ä½ ç»™ç”¨æˆ·å‘äº†ä¸€å¼ ç…§ç‰‡ï¼Œç…§ç‰‡å†…å®¹æ˜¯ï¼š${e.photoDescription}]`}}if("voice"===e.messageType&&e.voiceText){const t="sent"===e.type;return{role:t?"user":"assistant",content:`[è¯­éŸ³: ${e.voiceText}]`}}if("location"===e.messageType&&e.location){const t="sent"===e.type;return{role:t?"user":"assistant",content:`[ä½ç½®: ${e.location.name} - ${e.location.address}]`}}if("emoji"===e.messageType&&e.emojiUrl){const t="sent"===e.type,s=e.emojiDescription||"è¡¨æƒ…åŒ…";return{role:t?"user":"assistant",content:t?`(å¯¹æ–¹å‘äº†ä¸€ä¸ªè¡¨æƒ…åŒ…ï¼š${s})`:`(æˆ‘å‘äº†ä¸€ä¸ªè¡¨æƒ…åŒ…ï¼š${s})`}}if("transfer"===e.messageType&&e.transfer){const t="sent"===e.type;return{role:t?"user":"assistant",content:t?`[ç”¨æˆ·ç»™ä½ å‘èµ·äº†è½¬è´¦ï¼šÂ¥${e.transfer.amount.toFixed(2)}ï¼Œè¯´æ˜Žï¼š${e.transfer.message}ï¼ŒçŠ¶æ€ï¼š${"pending"===e.transfer.status?"å¾…å¤„ç†":"received"===e.transfer.status?"å·²æ”¶æ¬¾":"å·²é€€è¿˜"}]`:`[ä½ ç»™ç”¨æˆ·å‘èµ·äº†è½¬è´¦ï¼šÂ¥${e.transfer.amount.toFixed(2)}ï¼Œè¯´æ˜Žï¼š${e.transfer.message}ï¼ŒçŠ¶æ€ï¼š${"pending"===e.transfer.status?"å¾…å¤„ç†":"received"===e.transfer.status?"å·²æ”¶æ¬¾":"å·²é€€è¿˜"}]`}}if("intimate_pay"===e.messageType&&e.intimatePay){const t="sent"===e.type;return{role:t?"user":"assistant",content:t?`[ç”¨æˆ·æƒ³ä¸ºä½ å¼€é€šäº²å¯†ä»˜ï¼šæ¯æœˆé¢åº¦ Â¥${e.intimatePay.monthlyLimit.toFixed(2)}ï¼ŒçŠ¶æ€ï¼š${"pending"===e.intimatePay.status?"å¾…ä½ å†³å®šæ˜¯å¦æŽ¥å—":"accepted"===e.intimatePay.status?"ä½ å·²æŽ¥å—":"ä½ å·²æ‹’ç»"}]`:`[ä½ ä¸ºç”¨æˆ·å¼€é€šäº†äº²å¯†ä»˜ï¼šæ¯æœˆé¢åº¦ Â¥${e.intimatePay.monthlyLimit.toFixed(2)}ï¼ŒçŠ¶æ€ï¼š${"pending"===e.intimatePay.status?"ç­‰å¾…ç”¨æˆ·æŽ¥å—":"accepted"===e.intimatePay.status?"ç”¨æˆ·å·²æŽ¥å—":"ç”¨æˆ·å·²æ‹’ç»"}]`}}if("couple_space_invite"===e.messageType&&e.coupleSpaceInvite){const t="sent"===e.type;return{role:t?"user":"assistant",content:t?`[ç”¨æˆ·é‚€è¯·ä½ åŠ å…¥æƒ…ä¾£ç©ºé—´ï¼ŒçŠ¶æ€ï¼š${"pending"===e.coupleSpaceInvite.status?"å¾…ä½ å†³å®šæ˜¯å¦æŽ¥å—":"accepted"===e.coupleSpaceInvite.status?"ä½ å·²æŽ¥å—":"ä½ å·²æ‹’ç»"}]`:`[ä½ é‚€è¯·ç”¨æˆ·åŠ å…¥æƒ…ä¾£ç©ºé—´ï¼ŒçŠ¶æ€ï¼š${"pending"===e.coupleSpaceInvite.status?"ç­‰å¾…ç”¨æˆ·æŽ¥å—":"accepted"===e.coupleSpaceInvite.status?"ç”¨æˆ·å·²æŽ¥å—":"ç”¨æˆ·å·²æ‹’ç»"}]`}}if("xiaohongshu"===e.messageType&&e.xiaohongshuNote){const t=e.xiaohongshuNote,s="sent"===e.type;let a=s?`[ç”¨æˆ·åˆ†äº«äº†ä¸€ä¸ªå°çº¢ä¹¦ç¬”è®°]\næ ‡é¢˜ï¼š${t.title}\nå†…å®¹ï¼š${t.description}\nä½œè€…ï¼š${t.author.nickname}\nç‚¹èµžï¼š${t.stats.likes} è¯„è®ºï¼š${t.stats.comments} æ”¶è—ï¼š${t.stats.collects}\næ ‡ç­¾ï¼š${t.tags.join(" ")}`:`[ä½ åˆ†äº«äº†ä¸€ä¸ªå°çº¢ä¹¦ç¬”è®°]\næ ‡é¢˜ï¼š${t.title}`;return t.topComments&&t.topComments.length>0&&(a+="\n\nçƒ­é—¨è¯„è®ºï¼š",t.topComments.forEach((e,t)=>{a+=`\n${t+1}. ${e.author}ï¼š${e.content} (ðŸ‘${e.likes})`})),t.coverImage?{role:s?"user":"assistant",content:[{type:"text",text:a},{type:"image_url",image_url:{url:t.coverImage,detail:"low"}}]}:{role:s?"user":"assistant",content:a}}if("image"===e.messageType&&e.imageUrl){const t="sent"===e.type;return{role:t?"user":"assistant",content:[{type:"text",text:t?"ç”¨æˆ·å‘é€äº†ä¸€å¼ å›¾ç‰‡":"ä½ å‘é€äº†ä¸€å¼ å›¾ç‰‡"},{type:"image_url",image_url:{url:e.imageUrl,detail:"high"}}]}}return e.content?{role:"sent"===e.type?"user":"assistant",content:e.content}:null}).filter(e=>null!==e)];te.forEach((e,t)=>{if("system"===e.role){"string"==typeof e.content?e.content.length:JSON.stringify(e.content).length}else{"string"==typeof e.content&&e.content.substring(0,50)}});const se=localStorage.getItem("api_settings");let ae=1e5;if(se){const e=JSON.parse(se);(null==(t=e.model)?void 0:t.includes("gemini-2.0"))?ae=1e6:(null==(s=e.model)?void 0:s.includes("gpt-4"))?ae=128e3:(null==(a=e.model)?void 0:a.includes("claude-3"))&&(ae=2e5)}const ge=te.slice(1).map(e=>"string"==typeof e.content?e.content:Array.isArray(e.content)?e.content.filter(e=>"text"===e.type).map(e=>e.text).join(" "):""),pe=he(Z,X,ge,ae);ye(pe);const fe=Date.now();let je;try{je=await q(te),Ce(Date.now()-fe)}catch(x){if("VISION_NOT_SUPPORTED"!==x.message)throw x;{const e=te.map(e=>({role:e.role,content:"string"==typeof e.content?e.content:Array.isArray(e.content)?e.content.filter(e=>"text"===e.type).map(e=>e.text).join("\n"):""}));je=await q(e)}}if("accounting_assistant"===w){const e=ue(je);e&&it({type:e.type,category:e.category,amount:e.amount,description:e.description,date:(new Date).toISOString().split("T")[0],aiExtracted:!0})}const{parseAIEmojiResponse:ve}=await ss(async()=>{const{parseAIEmojiResponse:e}=await import("./utils-BkWlPcuZ.js").then(e=>e.bP);return{parseAIEmojiResponse:e}},__vite__mapDeps([0,1,2])),Ne=ve(je,L),we=Ne.emojiIndexes;let ke=null,Se=null;const _e=je.match(/\[ç½‘å:(.+?)\]/);if(_e&&fa){const e=_e[1].trim(),t=fa.nickname||fa.name;st(fa.id,{nickname:e});const s=Date.now();Se={id:s,type:"system",content:`${t} æ›´æ”¹äº†ç½‘å`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:s,messageType:"system"}}let Me=null;const ze=je.match(/\[ä¸ªæ€§ç­¾å:(.+?)\]/);if(ze&&fa){const e=ze[1].trim();st(fa.id,{signature:e});const t=Date.now()+1;Me={id:t,type:"system",content:`${fa.nickname||fa.name} æ›´æ”¹äº†ä¸ªæ€§ç­¾å`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:t,messageType:"system"}}let Le=null;const $e=je.match(/\[å¤‡æ³¨:(.+?)\]/);if($e&&fa&&C){const e=$e[1].trim();C.remark||C.nickname||C.name;_(C.id,{remark:e});const t=Date.now()+2;Le={id:t,type:"system",content:`${fa.nickname||fa.name} ä¿®æ”¹äº†å¤‡æ³¨ä¸ºï¼š"${e}"`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:t,messageType:"system"}}const Ae=je.match(/\[æ¢å¤´åƒ:(.+?)\]/);if(Ae&&fa){const t=Ae[1].trim();(async()=>{try{let s=null,a=null;const r=t.match(/^0?([1-5])$/);if(r){const t=e.filter(e=>"sent"===e.type);t.filter(e=>"photo"===e.messageType||"image"===e.messageType).filter(e=>e.photoDescription||e.imageUrl);let l=-1;for(let s=e.length-1;s>=0;s--)if("received"===e[s].type){l=s;break}const n=e.filter(e=>"sent"===e.type&&(!("image"!==e.messageType||!e.imageUrl)||!("photo"!==e.messageType||!e.photoDescription))).slice(-10);if(0===n.length)return void alert("æ²¡æœ‰æ‰¾åˆ°ä½ å‘çš„å›¾ç‰‡å“¦~");const i=parseInt(r[1]),c=n.length-i;if(c<0||c>=n.length)return void alert(`åªæœ‰${n.length}å¼ å›¾ç‰‡å“¦~`);const o=n[c];if(o.imageUrl)s=o.imageUrl,a="ç›´æŽ¥ä½¿ç”¨äº†ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡ï¼ˆåºå·"+r[1]+"ï¼‰";else if(o.photoDescription){const e=o.photoDescription,t={"çŒ«å’ª":"cute cat","å°çŒ«":"kitten","çŒ«":"cat","ç‹—":"dog","ç‹—ç‹—":"cute dog","å…”å­":"rabbit","å°å…”":"bunny","ç²‰å‘":"pink hair","é»‘å‘":"black hair","é‡‘å‘":"blonde hair","äºŒæ¬¡å…ƒ":"anime style","åŠ¨æ¼«":"anime","å°‘å¥³":"girl","å¥³å­©":"girl","ç”·å­©":"boy","æœºå™¨äºº":"robot","èµ›åšæœ‹å…‹":"cyberpunk","å¯çˆ±":"cute","é…·é…·çš„":"cool","å¸…æ°”":"handsome","çœŸå®ž":"realistic","ç…§ç‰‡":"photo","åƒç´ ":"pixel art","é£Žæ™¯":"landscape","äººç‰©":"character","æ¯å­":"mother and child","å¦ˆå¦ˆ":"mother","å®å®":"baby","å‘¸":"","å¥½è€¶":"","å¤šçˆ±":"love","æ¯”è¾ƒ":"compare","ç¬¦åˆ":"match","æ²‰ç¨³":"calm","æ°”è´¨":"elegant","å–µå–µ":"meow"};let r=e;for(const[s,a]of Object.entries(t))r=r.replace(new RegExp(s,"g"),a);const l=`portrait avatar of ${r}, centered composition, profile picture style, high quality, detailed, professional digital art, 4k`;a=l;const n=`https://image.pollinations.ai/prompt/${encodeURIComponent(l)}?width=512&height=512&nologo=true&enhance=true&model=flux`,i=await fetch(n),c=await i.blob();s=await new Promise(e=>{const t=new FileReader;t.onloadend=()=>e(t.result),t.readAsDataURL(c)})}}else if(t.includes("ä½ å¤´åƒ")||t.includes("å·å¤´åƒ")||t.includes("å¤åˆ¶å¤´åƒ")){if(!(null==C?void 0:C.avatar))return void alert("ä½ è¿˜æ²¡æœ‰å¤´åƒå‘¢~");s=C.avatar,a="ç›´æŽ¥å¤åˆ¶äº†ç”¨æˆ·çš„å¤´åƒï¼ˆæœªä½¿ç”¨AIç”Ÿæˆï¼‰"}else{const e={"çŒ«å’ª":"cute cat","å°çŒ«":"kitten","çŒ«":"cat","ç‹—":"dog","ç‹—ç‹—":"cute dog","å…”å­":"rabbit","å°å…”":"bunny","ç²‰å‘":"pink hair","é»‘å‘":"black hair","é‡‘å‘":"blonde hair","äºŒæ¬¡å…ƒ":"anime style","åŠ¨æ¼«":"anime","å°‘å¥³":"girl","å¥³å­©":"girl","ç”·å­©":"boy","æœºå™¨äºº":"robot","èµ›åšæœ‹å…‹":"cyberpunk","å¯çˆ±":"cute","é…·é…·çš„":"cool","å¸…æ°”":"handsome","çœŸå®ž":"realistic","ç…§ç‰‡":"photo","æ¯å­":"mother and child","å¦ˆå¦ˆ":"mother","å®å®":"baby","å‘¸":"","å¥½è€¶":"","å¤šçˆ±":"love","æ¯”è¾ƒ":"compare","ç¬¦åˆ":"match","æ²‰ç¨³":"calm","æ°”è´¨":"elegant","å–µå–µ":"meow"};let r=t;for(const[t,s]of Object.entries(e))r=r.replace(new RegExp(t,"g"),s);const l=`portrait avatar of ${r}, centered composition, profile picture style, high quality, detailed, professional digital art, 4k`;a=l;const n=`https://image.pollinations.ai/prompt/${encodeURIComponent(l)}?width=512&height=512&nologo=true&enhance=true&model=flux`,i=await fetch(n),c=await i.blob();s=await new Promise(e=>{const t=new FileReader;t.onloadend=()=>e(t.result),t.readAsDataURL(c)})}if(s){st(fa.id,{avatar:s}),localStorage.setItem(`character_avatar_fingerprint_${fa.id}`,s.substring(0,200)),localStorage.setItem(`character_avatar_recognized_at_${fa.id}`,Date.now().toString()),a&&localStorage.setItem(`character_avatar_description_${fa.id}`,a);const e={id:Date.now()+Math.random(),type:"system",content:`${fa.nickname||fa.name} æ›´æ¢äº†å¤´åƒ`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"system",avatarPrompt:a||t};A(t=>{const s=[...t,e];return w&&G(`chat_messages_${w}`,s),s})}else alert("æ¢å¤´åƒå¤±è´¥")}catch(x){alert(`æ¢å¤´åƒå¤±è´¥ï¼š${x.message||"ç½‘ç»œé”™è¯¯"}`)}})()}const Te=je.match(/\[è¯­éŸ³é€šè¯\]/),Ee=je.match(/\[è§†é¢‘é€šè¯\]/);if(Te||Ee){const e=!!Ee;let t=je.replace(/\[è¯­éŸ³é€šè¯\]/g,"").replace(/\[è§†é¢‘é€šè¯\]/g,"").trim();if(t){const s=Date.now(),a={id:s,type:"received",content:t,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:s};A(e=>[...e,a]),setTimeout(()=>{Ps(e),Es(!0)},500)}else Ps(e),Es(!0);return void D(!1)}const Pe=je.match(/\[çº¢åŒ…:(\d+\.?\d*):(.+?)\]/);let Fe=null;if(Pe){let e=parseFloat(Pe[1]);e>200&&(e=200),Fe={amount:e,blessing:Pe[2]}}let Oe=Ne.textContent;const We=new RegExp("<thinking>.*?</thinking>","gis"),Re=new RegExp("<antml:thinking>.*?</antml:thinking>","gis");Oe=Oe.replace(We,"").replace(Re,"").trim();const Ue=["going through","processor","circuits","spring to mind","option a","option b","option c","first instinct","better to","here's what","i think","the plan is","let me","i need to","should i","how about","that means","ah yes","right,","so,","okay,","alright,","in character","my little","the punchline","build the suspense","perfect for","see it playing","gotta","gonna","that will","here's how","playing out","catch her","point out","follow that"],Ve=Oe.split("\n"),Je=[];for(const e of Ve){const t=e.trim();if(!t)continue;if(t.startsWith("[")||t.startsWith("*")||t.startsWith("-")||t.startsWith("Message ")){Je.push(e);continue}const s=(t.match(/[\u4e00-\u9fa5]/g)||[]).length,a=t.length;if(s/a>.3){Je.push(e);continue}const r=t.toLowerCase(),l=Ue.some(e=>r.includes(e)),n=(t.match(/[a-z]/gi)||[]).length;l&&n>30||Je.push(e)}Oe=Je.join("\n").trim(),Oe=Oe.replace(/\[BILL:(expense|income)\|\d+\.?\d*\|\w+\|[^\]]+\]/g,"").trim(),Oe=Oe.replace(/\[çº¢åŒ…:\d+\.?\d*:.+?\]/g,"").trim(),Oe=Oe.replace(/\[è¯­éŸ³é€šè¯\]/g,"").replace(/\[è§†é¢‘é€šè¯\]/g,"").trim();if(je.match(/\[æ‹‰é»‘ç”¨æˆ·\]/)&&w){K.blockUser(w,"user"),Oe=Oe.replace(/\[æ‹‰é»‘ç”¨æˆ·\]/g,"").trim();const t={id:Date.now()+9999,type:"system",content:`${(null==fa?void 0:fa.name)||"AI"} å·²å°†ä½ åŠ å…¥é»‘åå•`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now()},s=[...e,t];Qa(s),e=s,w&&G(`chat_messages_${w}`,s)}if(je.match(/\[è§£é™¤æ‹‰é»‘\]/)&&w){K.unblockUser(w,"user"),Oe=Oe.replace(/\[è§£é™¤æ‹‰é»‘\]/g,"").trim();const t={id:Date.now()+9999,type:"system",content:`${(null==fa?void 0:fa.name)||"AI"} å·²å°†ä½ ç§»å‡ºé»‘åå•`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now()},s=[...e,t];Qa(s),e=s,w&&G(`chat_messages_${w}`,s)}Oe=Oe.replace(/\[ç½‘å:[\s\S]+?\]/g,"").trim(),Oe=Oe.replace(/\[ä¸ªæ€§ç­¾å:[\s\S]+?\]/g,"").trim(),Oe=Oe.replace(/\[å¤‡æ³¨:[\s\S]+?\]/g,"").trim(),Oe=Oe.replace(/\[æ¢å¤´åƒ:[\s\S]+?\]/g,"").trim(),Oe=Oe.replace(/\[ä¸€èµ·å¬:[\s\S]+?\]/g,"").trim(),Oe=Oe.replace(/\[æ­£åœ¨ä¸Ž[\s\S]+?ä¸€èµ·å¬[\s\S]+?\]/g,"").trim(),Oe=Oe.replace(/\[ç³»ç»Ÿè­¦å‘Š[ï¼š:][^\]]*\]/g,"").trim(),Oe=Oe.replace(/ã€ç³»ç»Ÿè­¦å‘Š[ï¼š:][^ã€‘]*ã€‘/g,"").trim(),Oe=Oe.replace(/ç³»ç»Ÿè­¦å‘Š[ï¼š:][^\n]*/g,"").trim(),Oe=Oe.replace(/\[å¼•ç”¨äº†\s+.+?\s+çš„æ¶ˆæ¯:\s*".+?"\]/g,"").trim(),Oe=Oe.replace(/^ã€Œ.+?:\s*.+?ã€\n?/gm,"").trim(),Oe=Oe.replace(/\n\s*\n/g,"\n").trim();const He=je.match(/\[ç…§ç‰‡:(.+?)\]/);let Ge=null;He&&(Ge=He[1],Oe=Oe.replace(/\[ç…§ç‰‡:.+?\]/g,"").trim());const qe=je.match(/\[è¯­éŸ³:(.+?)\]/);let Ke=null;qe&&(Ke=qe[1],Oe=Oe.replace(/\[è¯­éŸ³:.+?\]/g,"").trim());const Xe=je.match(/\[ä½ç½®:(.+?):(.+?)\]/);let Ze=null;Xe&&(Ze={name:Xe[1],address:Xe[2]},Oe=Oe.replace(/\[ä½ç½®:.+?:.+?\]/g,"").trim());const Qe=je.match(/\[å°çº¢ä¹¦[ï¼š:](.+?)\]/);let Ye=null;Qe&&(Ye=Qe[1].trim(),Oe=Oe.replace(/\[å°çº¢ä¹¦[ï¼š:].+?\]/g,"").trim());const et=je.match(/\[ç”Ÿæˆå›¾ç‰‡:(.+?)\|(.+?)\|(.+?)\]/);let tt=null;et&&(tt={title:et[1].trim(),description:et[2].trim(),prompt:et[3].trim()},Oe=Oe.replace(/\[ç”Ÿæˆå›¾ç‰‡:.+?\|.+?\|.+?\]/g,"").trim());let ct=je.match(/\[åˆ†äº«éŸ³ä¹:(.+?):(.+?)\]/),ot=null;ct&&(ot={songTitle:ct[1],songArtist:ct[2]},Oe=Oe.replace(/\[åˆ†äº«éŸ³ä¹:.+?:.+?\]/g,"").trim());let dt=je.match(/\[ä¸€èµ·å¬:(.+?):(.+?)\]/),xt=null;if(dt)xt={songTitle:dt[1],songArtist:dt[2]},Oe=Oe.replace(/\[ä¸€èµ·å¬:.+?:.+?\]/g,"").trim();else{const e=je.match(/\[æ­£åœ¨ä¸Ž.+?ä¸€èµ·å¬[ï¼š:](.+?)\s*[-ï¼]\s*(.+?)(?:\s+\d|$|\])/);e&&(xt={songTitle:e[1].trim(),songArtist:e[2].trim()},Oe=Oe.replace(/\[æ­£åœ¨ä¸Ž.+?ä¸€èµ·å¬[ï¼š:].+?\]/g,"").trim())}let mt=je.match(/\[å¼€å§‹ç›´æ’­:(.+?):(.+?)\]/),ht=null;mt&&(ht={popularityLevel:mt[1],openingMessage:mt[2]},Oe=Oe.replace(/\[å¼€å§‹ç›´æ’­:.+?:.+?\]/g,"").trim()),/[\[ã€\(ï¼ˆ]\s*(é¢†å–çº¢åŒ…|é¢†çº¢åŒ…)\s*[\]ã€‘\)ï¼‰]/.test(je)&&(ke="claim",Oe=Oe.replace(/[\[ã€\(ï¼ˆ]\s*(é¢†å–çº¢åŒ…|é¢†çº¢åŒ…)\s*[\]ã€‘\)ï¼‰]/g,"").trim()),Oe=Oe.replace(/\[çŠ¶æ€:[^\]]+\]/g,"").trim(),Oe=Oe.replace(/\[çŠ¶æ€:[\s\S]*?\]/g,"").trim(),Oe=Oe.replace(/\[.*?çŠ¶æ€.*?\]/g,"").trim();let ut=null;/[\[ã€\(ï¼ˆ]\s*æŽ¥æ”¶è½¬è´¦\s*[\]ã€‘\)ï¼‰]/.test(je)?(ut="accept",Oe=Oe.replace(/[\[ã€\(ï¼ˆ]\s*æŽ¥æ”¶è½¬è´¦\s*[\]ã€‘\)ï¼‰]/g,"").trim()):/[\[ã€\(ï¼ˆ]\s*é€€è¿˜è½¬è´¦\s*[\]ã€‘\)ï¼‰]/.test(je)&&(ut="reject",Oe=Oe.replace(/[\[ã€\(ï¼ˆ]\s*é€€è¿˜è½¬è´¦\s*[\]ã€‘\)ï¼‰]/g,"").trim());let gt=je.match(/\[è½¬è´¦:(\d+\.?\d*):(.+?)\]/),pt=null;if(ut)gt&&(Oe=Oe.replace(/\[è½¬è´¦:\d+\.?\d*:.+?\]/g,"").trim()),Oe=Oe.replace(/\[.*?è½¬è´¦.*?[Â¥ï¿¥]?\s*\d+\.?\d*.*?\]/g,"").trim();else if(gt)pt={amount:parseFloat(gt[1]),message:gt[2]},Oe=Oe.replace(/\[è½¬è´¦:\d+\.?\d*:.+?\]/g,"").trim();else{const e=je.match(/\[.*?è½¬è´¦.*?[Â¥ï¿¥]?\s*(\d+\.?\d*).*?[:ï¼š]\s*(.+?)\]/);e&&(pt={amount:parseFloat(e[1]),message:e[2].trim()},Oe=Oe.replace(/\[.*?è½¬è´¦.*?\]/g,"").trim())}const ft=je.match(/\[æ¶ˆè´¹:(.+?)-(.+?)-(\d+\.?\d*)\]/);let bt=null;ft&&(bt={platform:ft[1].trim(),item:ft[2].trim(),amount:parseFloat(ft[3])},Oe=Oe.replace(/\[æ¶ˆè´¹:.+?-.+?-\d+\.?\d*\]/g,"").trim());const jt=je.match(/\[äº²å¯†ä»˜:(\d+\.?\d*)\]/);let vt=null;jt&&(vt=parseFloat(jt[1]),Oe=Oe.replace(/\[äº²å¯†ä»˜:\d+\.?\d*\]/g,"").trim());let yt=!1;(je.includes("[æƒ…ä¾£ç©ºé—´é‚€è¯·]")||je.includes("[æƒ…ä¾£ç©ºé—´]"))&&(yt=!0,Oe=Oe.replace(/\[æƒ…ä¾£ç©ºé—´é‚€è¯·\]/g,"").replace(/\[æƒ…ä¾£ç©ºé—´\]/g,"").trim());const Nt=je.match(/\[ç›¸å†Œ:([^\]]+)\]/);let wt=null;Nt&&(wt=Nt[1],Oe=Oe.replace(/\[ç›¸å†Œ:[^\]]+\]/g,"").trim());const kt=je.match(/\[ç•™è¨€:([^\]]+)\]/);let Ct=null;kt&&(Ct=kt[1],Oe=Oe.replace(/\[ç•™è¨€:[^\]]+\]/g,"").trim());const St=je.match(/\[çºªå¿µæ—¥:([^\]]+)\]/);let It=null;if(St){const e=St[1].split("|");e.length>=2&&(It={date:e[0].trim(),title:e[1].trim(),description:null==(r=e[2])?void 0:r.trim()},Oe=Oe.replace(/\[çºªå¿µæ—¥:[^\]]+\]/g,"").trim())}const _t=Array.from(je.matchAll(/\[å¼•ç”¨:\s*(\d+)\]/g));let Mt=null;_t.length>0&&(Mt=parseInt(_t[0][1]),Oe=Oe.replace(/\[å¼•ç”¨:\s*\d+\]/g,"").trim(),_t.length);let zt=!1,Lt=null;const $t=je.match(/\[æ’¤å›ž:(\d+)\]/);$t?(Lt=parseInt($t[1]),Oe=Oe.replace(/\[æ’¤å›ž:\d+\]/g,"").trim()):je.includes("[æ’¤å›žæ¶ˆæ¯]")&&(zt=!0,Oe=Oe.replace(/\[æ’¤å›žæ¶ˆæ¯\]/g,"").trim());let At=!1;je.includes("[å†™æ—¥è®°]")&&(At=!0,Oe=Oe.replace(/\[å†™æ—¥è®°\]/g,"").trim()),(zt||Lt)&&(Oe=Oe.replace(/[ï¼ˆ(][^ï¼‰)]*[ï¼‰)]/g,"").trim());let Tt=null;je.includes("[æŽ¥å—äº²å¯†ä»˜]")?(Tt="accept",Oe=Oe.replace(/\[æŽ¥å—äº²å¯†ä»˜\]/g,"").trim()):je.includes("[æ‹’ç»äº²å¯†ä»˜]")&&(Tt="reject",Oe=Oe.replace(/\[æ‹’ç»äº²å¯†ä»˜\]/g,"").trim());let Dt=null;if(je.includes("[æŽ¥å—æƒ…ä¾£ç©ºé—´]")?(Dt="accept",Oe=Oe.replace(/\[æŽ¥å—æƒ…ä¾£ç©ºé—´\]/g,"").trim()):je.includes("[æ‹’ç»æƒ…ä¾£ç©ºé—´]")&&(Dt="reject",Oe=Oe.replace(/\[æ‹’ç»æƒ…ä¾£ç©ºé—´\]/g,"").trim()),ut)for(let t=e.length-1;t>=0;t--){const s=e[t];if("transfer"===s.messageType&&"sent"===s.type&&"pending"===(null==(l=s.transfer)?void 0:l.status)){const s=[...e];s[t]={...s[t],transfer:{...s[t].transfer,status:"accept"===ut?"received":"expired"}};const a={id:Date.now(),type:"system",content:"accept"===ut?`${(null==fa?void 0:fa.name)||"å¯¹æ–¹"}å·²æ”¶æ¬¾`:`${(null==fa?void 0:fa.name)||"å¯¹æ–¹"}é€€è¿˜äº†è½¬è´¦`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),messageType:"system"};s.push(a);const r={id:Date.now()+1,type:"system",content:"accept"===ut?`ä½ å·²æ”¶æ¬¾ï¼Œå·²å­˜å…¥é›¶é’± Â¥${s[t].transfer.amount.toFixed(2)}`:`ä½ å·²é€€è¿˜è½¬è´¦ Â¥${s[t].transfer.amount.toFixed(2)}`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),messageType:"system",isHidden:!0};s.push(r),A(s),e=s;break}}if(Tt&&w&&fa)for(let t=e.length-1;t>=0;t--){const s=e[t];if("intimate_pay"===s.messageType&&"sent"===s.type&&"pending"===(null==(n=s.intimatePay)?void 0:n.status)){const a=[...e];if(a[t]={...a[t],intimatePay:{...a[t].intimatePay,status:"accept"===Tt?"accepted":"rejected"}},"accept"===Tt){const{createIntimatePayRelation:e}=await ss(async()=>{const{createIntimatePayRelation:e}=await import("./utils-BkWlPcuZ.js").then(e=>e.bM);return{createIntimatePayRelation:e}},__vite__mapDeps([0,1,2]));e(fa.id,fa.name,s.intimatePay.monthlyLimit,fa.avatar)}const r={id:Date.now(),type:"system",content:"accept"===Tt?`${(null==fa?void 0:fa.name)||"å¯¹æ–¹"}æŽ¥å—äº†ä½ çš„äº²å¯†ä»˜`:`${(null==fa?void 0:fa.name)||"å¯¹æ–¹"}æ‹’ç»äº†ä½ çš„äº²å¯†ä»˜`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),messageType:"system"};a.push(r),A(a),e=a;break}}if(Dt&&w&&fa)for(let t=e.length-1;t>=0;t--){const s=e[t];if("couple_space_invite"===s.messageType&&"sent"===s.type&&"pending"===(null==(i=s.coupleSpaceInvite)?void 0:i.status)){const s=[...e];if(s[t]={...s[t],coupleSpaceInvite:{...s[t].coupleSpaceInvite,status:"accept"===Dt?"accepted":"rejected"}},"accept"===Dt){const{acceptCoupleSpaceInvite:e}=await ss(async()=>{const{acceptCoupleSpaceInvite:e}=await import("./utils-BkWlPcuZ.js").then(e=>e.bQ);return{acceptCoupleSpaceInvite:e}},__vite__mapDeps([0,1,2]));e(w)}const a={id:Date.now(),type:"system",content:"accept"===Dt?`${(null==fa?void 0:fa.name)||"å¯¹æ–¹"}æŽ¥å—äº†ä½ çš„æƒ…ä¾£ç©ºé—´é‚€è¯·`:`${(null==fa?void 0:fa.name)||"å¯¹æ–¹"}æ‹’ç»äº†ä½ çš„æƒ…ä¾£ç©ºé—´é‚€è¯·`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),messageType:"system"};s.push(a),A(s),e=s;break}}if("claim"===ke&&w)for(let t=e.length-1;t>=0;t--){const s=e[t];if("redenvelope"===s.messageType&&"sent"===s.type&&s.redEnvelopeId){const t=at(w,s.redEnvelopeId);if(t&&"pending"===t.status){lt(w,s.redEnvelopeId,{status:"claimed",claimedBy:(null==fa?void 0:fa.name)||"AI",claimedAt:Date.now()});const t={id:Date.now(),type:"system",content:`${(null==fa?void 0:fa.name)||"å¯¹æ–¹"}é¢†å–äº†ä½ çš„çº¢åŒ…`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),messageType:"system"},a=[...e,t];A(a),e=a;break}}}let Et=[...e];if(Oe.trim()){const t=Oe.replace(/\\n/g,"\n").trim().split("\n").filter(e=>e.trim());if(1===t.length){const s=[];let a=t[0];if(De){const e=a.match(/\[æ—ç™½\]([^\[]+?)\[\/æ—ç™½\]/g);e&&(e.forEach(e=>{const t=e.replace(/\[æ—ç™½\]|\[\/æ—ç™½\]/g,"").trim();t&&s.push({type:"action",content:t})}),a=a.replace(/\[æ—ç™½\][^\[]+?\[\/æ—ç™½\]/g,"").trim())}const r=Date.now();let l=null;if(Mt&&(l=e.find(e=>e.id===Mt)),a&&a.trim()||l){const e=a&&a.trim()?a:l?"...":"",t={id:Et.length+1,type:"received",content:e,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:r,narrations:s.length>0?s:void 0,quotedMessage:l?{id:l.id,content:l.isRecalled&&l.recalledContent?l.recalledContent:l.content||l.emojiDescription||l.photoDescription||l.voiceText||"ç‰¹æ®Šæ¶ˆæ¯",senderName:"sent"===l.type?"æˆ‘":"received"===l.type?(null==fa?void 0:fa.name)||"AI":(null==(c=l.content)?void 0:c.includes("ä½ æ’¤å›žäº†"))?"æˆ‘":(null==fa?void 0:fa.name)||"AI",type:"system"===l.type?"sent":l.type}:void 0,blocked:O};Se&&Et.push(Se),Me&&Et.push(Me),Le&&Et.push(Le),Et.push(t),Qa(Et),be.current++}else;}else{Se&&Et.push(Se),Me&&Et.push(Me),Le&&Et.push(Le);for(let s=0;s<t.length;s++){await new Promise(e=>setTimeout(e,300+500*Math.random()));const a=[];let r=t[s];if(De){const e=r.match(/\[æ—ç™½\]([^\[]+?)\[\/æ—ç™½\]/g);e&&(e.forEach(e=>{const t=e.replace(/\[æ—ç™½\]|\[\/æ—ç™½\]/g,"").trim();t&&a.push({type:"action",content:t})}),r=r.replace(/\[æ—ç™½\][^\[]+?\[\/æ—ç™½\]/g,"").trim())}let l=null;if(0===s&&Mt&&(l=e.find(e=>e.id===Mt)),!(r&&r.trim()||l))continue;const n=r&&r.trim()?r:l?"...":"",i={id:Et.length+1,type:"received",content:n,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now()+s,narrations:a.length>0?a:void 0,quotedMessage:l?{id:l.id,content:l.isRecalled&&l.recalledContent?l.recalledContent:l.content||l.emojiDescription||l.photoDescription||l.voiceText||"ç‰¹æ®Šæ¶ˆæ¯",senderName:"sent"===l.type?"æˆ‘":"received"===l.type?(null==fa?void 0:fa.name)||"AI":(null==(o=l.content)?void 0:o.includes("ä½ æ’¤å›žäº†"))?"æˆ‘":(null==fa?void 0:fa.name)||"AI",type:"system"===l.type?"sent":l.type}:void 0,blocked:O};Et=[...Et,i],Qa(Et),be.current++}}}if(we.length>0)for(const e of we){const t=L[e];if(t){await new Promise(e=>setTimeout(e,300+500*Math.random()));const e={id:Et.length+1,type:"received",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"emoji",emojiUrl:t.url,emojiDescription:t.description,blocked:O};Et=[...Et,e],Qa(Et),be.current++}}if(Ke){await new Promise(e=>setTimeout(e,300+500*Math.random()));const e={id:Et.length+1,type:"received",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"voice",voiceText:Ke,blocked:O};Et=[...Et,e],Qa(Et),be.current++}if(Ze){await new Promise(e=>setTimeout(e,300+500*Math.random()));const e={id:Et.length+1,type:"received",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"location",location:{name:Ze.name,address:Ze.address,latitude:39.9042+.1*Math.random(),longitude:116.4074+.1*Math.random()},blocked:O};Et=[...Et,e],Qa(Et),be.current++}if(Ge){await new Promise(e=>setTimeout(e,300+500*Math.random()));const e={id:Et.length+1,type:"received",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"photo",photoDescription:Ge,blocked:O};Et=[...Et,e],Qa(Et),be.current++}if(Ye){await new Promise(e=>setTimeout(e,300+500*Math.random()));try{const{getXiaohongshuForAI:e}=await ss(async()=>{const{getXiaohongshuForAI:e}=await import("./utils-BkWlPcuZ.js").then(e=>e.bN);return{getXiaohongshuForAI:e}},__vite__mapDeps([0,1,2])),t=Ye.split(/[,ï¼Œ\s]+/).filter(e=>e.trim()),s=await e(t);if(s){const e={id:Date.now(),type:"received",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"xiaohongshu",xiaohongshuNote:s,blocked:O};Et=[...Et,e],Qa(Et),be.current++}}catch(x){}}if(tt){await new Promise(e=>setTimeout(e,500+1e3*Math.random()));try{const e=await fetch("/.netlify/functions/generate-xhs-image",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(tt)});if(e.ok){const{note:t}=await e.json(),s={id:Date.now(),type:"received",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"xiaohongshu",xiaohongshuNote:t,blocked:O};Et=[...Et,s],Qa(Et),be.current++}}catch(x){}}if(ot){await new Promise(e=>setTimeout(e,300+500*Math.random()));const e={id:Date.now(),type:"received",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"musicShare",musicShare:{songTitle:ot.songTitle,songArtist:ot.songArtist},blocked:O};Et=[...Et,e],Qa(Et),be.current++}if(xt){await new Promise(e=>setTimeout(e,300+500*Math.random()));const e={id:Date.now(),type:"received",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"musicInvite",musicInvite:{songTitle:xt.songTitle,songArtist:xt.songArtist,inviterName:(null==fa?void 0:fa.name)||"AI",status:"pending"},blocked:O};Et=[...Et,e],Qa(Et),be.current++}if(ht&&w){await new Promise(e=>setTimeout(e,300+500*Math.random()));const e=`${w}_${Date.now()}`,t={characterId:w,popularityLevel:ht.popularityLevel,openingMessage:ht.openingMessage,startTime:Date.now()};localStorage.setItem(`live_stream_${e}`,JSON.stringify(t));const s={id:Date.now(),type:"system",content:`${(null==fa?void 0:fa.name)||"AI"} å¼€å§‹äº†ç›´æ’­`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"live_stream",liveStreamData:{liveStreamId:e,popularityLevel:ht.popularityLevel,openingMessage:ht.openingMessage}};Et=[...Et,s],Qa(Et)}if(Fe&&w){await new Promise(e=>setTimeout(e,500));ee(w,Fe.amount,`çº¢åŒ…ï¼š${Fe.blessing}`);const e={id:f(),amount:Fe.amount,blessing:Fe.blessing,status:"pending",sender:"ai",createdAt:Date.now(),claimedBy:null,claimedAt:null};rt(w,e);const t=Date.now(),s={id:t,type:"received",content:`[çº¢åŒ…]${Fe.blessing}`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:t,messageType:"redenvelope",redEnvelopeId:e.id,blocked:O};Et=[...Et,s],Qa(Et),be.current++}if(pt){await new Promise(e=>setTimeout(e,500));ee(w,pt.amount,`è½¬è´¦ï¼š${pt.message}`);const e=Date.now(),t={id:e,type:"received",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:e,messageType:"transfer",transfer:{amount:pt.amount,message:pt.message,status:"pending"},blocked:O};Et=[...Et,t],Qa(Et),be.current++}if(bt&&w){await new Promise(e=>setTimeout(e,300));const{platform:e,item:t,amount:s}=bt;if(ee(w,s,`${e}-${t}`)){const a={id:Date.now()+Math.random(),type:"system",content:`ä½¿ç”¨äº²å¯†ä»˜æ¶ˆè´¹ï¼š${e} - ${t}ï¼ˆÂ¥${s.toFixed(2)}ï¼‰`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"system",isHidden:!1};Et=[...Et,a],Qa(Et)}}if(vt&&w&&fa){await new Promise(e=>setTimeout(e,500));const e=Date.now(),t={id:e,type:"received",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:e,messageType:"intimate_pay",intimatePay:{monthlyLimit:vt,characterId:fa.id,characterName:fa.name,status:"pending"},blocked:O};Et=[...Et,t],Qa(Et),be.current++}if(yt&&w&&fa){await new Promise(e=>setTimeout(e,500));const{getCoupleSpaceRelation:e}=await ss(async()=>{const{getCoupleSpaceRelation:e}=await import("./utils-BkWlPcuZ.js").then(e=>e.bQ);return{getCoupleSpaceRelation:e}},__vite__mapDeps([0,1,2])),t=e();if(!t||"pending"!==t.status&&"active"!==t.status){const{createCoupleSpaceInvite:e}=await ss(async()=>{const{createCoupleSpaceInvite:e}=await import("./utils-BkWlPcuZ.js").then(e=>e.bQ);return{createCoupleSpaceInvite:e}},__vite__mapDeps([0,1,2]));if(e("current_user",w,fa.name,fa.avatar)){const e=Date.now(),t={id:e,type:"received",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:e,messageType:"couple_space_invite",coupleSpaceInvite:{inviterId:fa.id,inviterName:fa.name,status:"pending"},blocked:O};Et=[...Et,t],Qa(Et),be.current++}}else{const e=Date.now(),t={id:e,type:"system",content:"å¯¹æ–¹å·²ç»å»ºç«‹æƒ…ä¾£ç©ºé—´ï¼Œæ— æ³•é‚€è¯·",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:e,messageType:"system",isHidden:!1};Et=[...Et,t],Qa(Et)}}if(w&&fa&&(wt||Ct||It)){const{hasActiveCoupleSpace:e}=await ss(async()=>{const{hasActiveCoupleSpace:e}=await import("./utils-BkWlPcuZ.js").then(e=>e.bQ);return{hasActiveCoupleSpace:e}},__vite__mapDeps([0,1,2]));if(e(w)){const{addCouplePhoto:e,addCoupleMessage:t,addCoupleAnniversary:s}=await ss(async()=>{const{addCouplePhoto:e,addCoupleMessage:t,addCoupleAnniversary:s}=await import("./utils-BkWlPcuZ.js").then(e=>e.bL);return{addCouplePhoto:e,addCoupleMessage:t,addCoupleAnniversary:s}},__vite__mapDeps([0,1,2]));if(wt)try{e(fa.id,fa.name,wt);const t={id:Date.now()+Math.random(),type:"system",content:`ðŸ“¸ ${fa.name}åœ¨æƒ…ä¾£ç©ºé—´ä¸Šä¼ äº†ç…§ç‰‡ï¼š${wt}`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"system",isHidden:!1};A(e=>[...e,t])}catch(x){}if(Ct)try{t(fa.id,fa.name,Ct);const e={id:Date.now()+Math.random(),type:"system",content:`ðŸ’Œ ${fa.name}åœ¨æƒ…ä¾£ç©ºé—´ç•™è¨€ï¼š${Ct}`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"system",isHidden:!1};A(t=>[...t,e])}catch(x){}if(It)try{s(fa.id,fa.name,It.date,It.title,It.description);const e={id:Date.now()+Math.random(),type:"system",content:`ðŸŽ‚ ${fa.name}åœ¨æƒ…ä¾£ç©ºé—´æ·»åŠ äº†çºªå¿µæ—¥ï¼š${It.title}ï¼ˆ${It.date}ï¼‰`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"system",isHidden:!1};A(t=>[...t,e])}catch(x){}}}if((()=>{try{const t=parseInt(localStorage.getItem(`memory_summary_interval_${w}`)||"30"),s=Math.floor(Et.filter(e=>"sent"===e.type||"received"===e.type).length/2);if(s%t===0&&s>0){const a=e.filter(e=>"sent"===e.type).slice(-t),r=Et.filter(e=>"received"===e.type).slice(-t);if(a.length>0&&r.length>0){const l=a.map(t=>{if("image"===t.messageType&&t.imageUrl){const s=e.findIndex(e=>e.id===t.id);if(-1!==s&&s+1<e.length){const t=e[s+1];if(t&&"received"===t.type)return`ç”¨æˆ·å‘é€äº†å›¾ç‰‡ï¼Œå›¾ç‰‡ç›¸å…³å†…å®¹ï¼š${t.content}`}return"ç”¨æˆ·å‘é€äº†å›¾ç‰‡"}return t.content||t.emojiDescription||t.photoDescription||t.voiceText||""}).join("\n"),n=r.map(e=>e.content||e.emojiDescription||e.photoDescription||e.voiceText||"").join("\n");M.extractMemories(l,n).then(e=>{if(e.summary&&w)try{const a=localStorage.getItem(`memory_summary_${w}`)||"",r=a+(a?"\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n":"")+`ã€ç¬¬ ${Math.ceil(s/t)} æ¬¡æ€»ç»“ - ç¬¬ ${s-t+1}-${s} è½®å¯¹è¯ã€‘\n\n${e.summary}`;localStorage.setItem(`memory_summary_${w}`,r)}catch(x){}}).catch(e=>{})}}}catch(x){}})(),At&&w&&fa){const e=w,t=fa.name,s=fa.description||"",a=[...Et];setTimeout(async()=>{try{const{generateDiary:r,saveDiary:l,getDiaries:n}=await ss(async()=>{const{generateDiary:e,saveDiary:t,getDiaries:s}=await import("./utils-BkWlPcuZ.js").then(e=>e.bO);return{generateDiary:e,saveDiary:t,getDiaries:s}},__vite__mapDeps([0,1,2])),i=n(e).slice(0,3),c={mood:"",weather:""},o=await r(e,t,s,a,c,i);if(o){l(e,o);o.content.length>50?o.content.substring(0,50):o.content;const s=(new Date).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}),a=o.content.replace(/\[ç…§ç‰‡:.*?\]/g,"").trim().substring(0,15)+(o.content.length>15?"...":""),r={id:Date.now()+Math.random(),type:"system",content:`ðŸ“” ${t}åœ¨æ—¥è®°æœ¬å†™äº†ä¸€ç¯‡æ—¥è®°ï¼š${a}ï¼ˆ${s}ï¼‰`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"system",isHidden:!1};A(e=>[...e,r]);const n=localStorage.getItem(`chat_messages_${e}`),i=n?JSON.parse(n):[];i.push(r),localStorage.setItem(`chat_messages_${e}`,JSON.stringify(i))}}catch(x){}},1e3)}if(zt||Lt){let e;if(await new Promise(e=>setTimeout(e,500)),Lt){const t=Et.findIndex(e=>e.id===Lt&&"received"===e.type);-1!==t&&(e={msg:Et[t],idx:t})}else e=Et.map((e,t)=>({msg:e,idx:t})).reverse().find(({msg:e})=>"received"===e.type&&"system"!==e.messageType);if(e){const{msg:t,idx:s}=e;!t.redEnvelopeId&&!t.transfer&&!t.intimatePay&&(Et[s]={...t,isRecalled:!0,recalledContent:t.content||t.emojiDescription||t.photoDescription||t.voiceText||"ç‰¹æ®Šæ¶ˆæ¯",originalType:t.type,content:`${(null==fa?void 0:fa.name)||"AI"}æ’¤å›žäº†ä¸€æ¡æ¶ˆæ¯`,type:"system",messageType:"system"},Qa([...Et]))}}}catch(x){let t=x.message||"AIè°ƒç”¨å¤±è´¥ï¼Œè¯·åœ¨è®¾ç½®ä¸­æ£€æŸ¥APIé…ç½®";(null==(d=x.message)?void 0:d.includes("500"))&&(t="APIè°ƒç”¨å¤±è´¥ (500) - å¯èƒ½æ˜¯æ¶ˆæ¯åŽ†å²è¿‡é•¿å¯¼è‡´\nå»ºè®®ï¼šæ¸…ç†éƒ¨åˆ†èŠå¤©è®°å½•æˆ–ç¨åŽé‡è¯•");const s={id:e.length+1,type:"received",content:`[é”™è¯¯] ${t}`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})};Qa([...e,s])}finally{D(!1),w&&ge(w)}};return e.jsxs("div",{className:"h-screen flex flex-col relative overflow-hidden",children:[sa&&e.jsx("div",{className:"fixed top-0 left-0 right-0 z-[60] bg-white border-b border-gray-200 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsx("button",{onClick:()=>{aa(!1),la(new Set)},className:"text-sm text-gray-600 active:opacity-60",children:"å–æ¶ˆ"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["å·²é€‰æ‹© ",ra.size," æ¡"]}),e.jsx("button",{onClick:async()=>{if(0!==ra.size){if(confirm(`ç¡®å®šè¦æ°¸ä¹…åˆ é™¤é€‰ä¸­çš„ ${ra.size} æ¡æ¶ˆæ¯å—ï¼Ÿ\n\nâš ï¸ æ­¤æ“ä½œæ— æ³•æ’¤é”€ï¼`)){ra.size;try{const e=new Set(ra),t=100;let s=[...$];for(let a=0;a<Math.ceil(s.length/t);a++)s=s.filter(t=>!e.has(t.id)),a%10==0&&await new Promise(e=>setTimeout(e,0));Qa(s),w&&localStorage.setItem(`chat_messages_${w}`,JSON.stringify(s))}catch(e){alert("åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{aa(!1),la(new Set)}}}else alert("è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„æ¶ˆæ¯")},className:"text-sm text-red-600 font-medium active:opacity-60",disabled:0===ra.size,style:{opacity:0===ra.size?.4:1},children:"åˆ é™¤"})]})}),e.jsx("div",{className:"absolute inset-0 z-0",style:(()=>{let e=ze;return!e&&$e&&(e=_e),e&&(e.startsWith("http")||e.startsWith("data:image"))?{backgroundImage:`url(${e})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"}:{background:"linear-gradient(to bottom, #f9fafb, #f3f4f6)"}})()}),e.jsxs("div",{className:"relative z-10 h-full flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-50 "+(Te?"glass-dark":"glass-effect"),style:{marginTop:sa?"52px":"0"},children:[et&&e.jsx(ua,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>v(-1),className:"ios-button text-gray-700 hover:text-gray-900 -ml-2",children:e.jsx(os,{size:24})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-base font-semibold text-gray-900",children:T?"æ­£åœ¨è¾“å…¥...":(null==fa?void 0:fa.nickname)||(null==fa?void 0:fa.name)||"èŠå¤©"}),w&&(()=>{const t=k(w);return t.currentStreak>0?e.jsxs("button",{onClick:()=>v(`/streak/${w}`),className:"text-xs px-2 py-1 bg-orange-100 text-orange-600 rounded-lg font-medium flex items-center gap-1 hover:bg-orange-200 transition-colors",children:["ðŸ”¥ ",t.currentStreak]}):null})()]}),e.jsxs("div",{className:"flex items-center gap-2",children:[ve.total>0&&e.jsxs("button",{onClick:()=>we(!Ne),className:"text-[10px] px-1.5 py-0.5 rounded-md flex items-center gap-1 ios-button",style:{backgroundColor:"rgba(59, 130, 246, 0.1)",color:"#3b82f6"},children:[e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:e.jsx("path",{d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),e.jsx("span",{className:"font-medium",children:X(ve.total)}),ke>0&&e.jsxs("span",{className:"text-[9px] opacity-70",children:["Â·",(ke/1e3).toFixed(1),"s"]})]}),e.jsx("button",{onClick:()=>oa(!0),className:"ios-button p-1 hover:opacity-70 transition-all",title:"æŸ¥çœ‹è§’è‰²çŠ¶æ€",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",className:"text-gray-700",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",strokeWidth:"2"}),e.jsx("path",{d:"M12 6v6l4 2",strokeWidth:"2",strokeLinecap:"round"})]})}),e.jsx("button",{onClick:()=>{localStorage.setItem("offline_chat_inherit",JSON.stringify({characterId:w,messages:$,timestamp:Date.now()})),v(`/offline-chat?character=${w}&inherit=true`)},className:"ios-button p-1 hover:opacity-70 transition-all",title:"åˆ‡æ¢åˆ°çº¿ä¸‹æ¨¡å¼",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",className:"text-gray-700",children:[e.jsx("path",{d:"M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z",strokeWidth:"2"}),e.jsx("path",{d:"M9 22V12h6v10",strokeWidth:"2"})]})}),e.jsx("button",{onClick:()=>v(`/chat-settings/${w}`),className:"ios-button text-gray-700 hover:text-gray-900",children:e.jsx(ds,{size:24})})]})]})]}),Ne&&ve.total>0&&e.jsxs("div",{className:"glass-card mx-4 mt-2 p-3 rounded-xl transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-xs font-semibold text-gray-700",children:"æœ¬æ¬¡è¯·æ±‚ç»Ÿè®¡"}),e.jsx("button",{onClick:()=>we(!1),className:"text-gray-400 hover:text-gray-600 ios-button",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"space-y-2 text-xs",children:[ke>0&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"å“åº”æ—¶é—´"}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[(ke/1e3).toFixed(2)," ç§’"]})]}),e.jsxs("div",{className:"pt-2 border-t border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1.5",children:[e.jsx("span",{className:"text-gray-600 font-medium",children:"æœ¬æ¬¡ Token ä½¿ç”¨"}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[ve.total.toLocaleString()," tokens"]})]}),e.jsxs("div",{className:"flex justify-between text-[11px]",children:[e.jsx("span",{className:"text-gray-500",children:"ç³»ç»Ÿæç¤º"}),e.jsx("span",{className:"text-gray-700",children:ve.systemPrompt.toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between text-[11px]",children:[e.jsx("span",{className:"text-gray-500",children:"ä¸–ç•Œä¹¦"}),e.jsx("span",{className:"text-gray-700",children:ve.lorebook.toLocaleString()})]}),Se.length>0&&e.jsx("div",{className:"ml-4 space-y-0.5 mt-1",children:Se.map((t,s)=>e.jsxs("div",{className:"flex justify-between text-[10px]",children:[e.jsxs("span",{className:"text-gray-400 truncate max-w-[150px]",title:t.name,children:["Â· ",t.name]}),e.jsx("span",{className:"text-gray-500",children:t.tokens})]},s))}),e.jsxs("div",{className:"flex justify-between text-[11px]",children:[e.jsx("span",{className:"text-gray-500",children:"æ¶ˆæ¯åŽ†å²"}),e.jsx("span",{className:"text-gray-700",children:ve.messages.toLocaleString()})]})]}),e.jsxs("div",{className:"pt-2 border-t border-gray-200",children:[e.jsxs("div",{className:"flex justify-between text-[11px]",children:[e.jsx("span",{className:"text-gray-500",children:"ä¸Šä¸‹æ–‡é™åˆ¶"}),e.jsxs("span",{className:"text-gray-600",children:[(ve.total+ve.remaining).toLocaleString()," tokens"]})]}),e.jsxs("div",{className:"flex justify-between text-[11px]",children:[e.jsx("span",{className:"text-gray-500",children:"ä½¿ç”¨æ¯”ä¾‹"}),e.jsxs("span",{className:"text-gray-600",children:[ve.percentage.toFixed(2),"%"]})]})]})]})]}),e.jsx("div",{ref:es,className:"flex-1 overflow-y-auto hide-scrollbar px-4 py-4",children:0===$.length?e.jsx("div",{className:"empty-state",children:e.jsx("p",{className:"text-gray-400 text-base",children:"å¼€å§‹èŠå¤©å§"})}):e.jsxs(e.Fragment,{children:[qt<$.length&&e.jsx("div",{className:"text-center py-2 text-xs text-gray-400",children:Xt?"åŠ è½½ä¸­...":"å‘ä¸Šæ»‘åŠ¨åŠ è½½æ›´å¤š"}),$.slice(-qt).map((t,s,a)=>{const r=$.length-qt+s,l=r>0?$[r-1]:null,n=(i=t,!!((c=l)&&i.timestamp&&c.timestamp)&&i.timestamp-c.timestamp>3e5);var i,c;if(t.isHidden)return null;if("system"===t.type){if(t.isCallRecord){const s=na===t.id;return e.jsxs("div",{children:[n&&t.timestamp&&e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"bg-gray-200/60 px-3 py-1 rounded-full",children:e.jsx("span",{className:"text-xs text-gray-500",children:ht(t.timestamp)})})}),e.jsx("div",{className:"flex justify-center mb-3",children:e.jsx("div",{className:"w-[85%] max-w-xs",children:e.jsxs("div",{className:"glass-card rounded-xl p-3 cursor-pointer hover:shadow-lg transition-all",onClick:()=>ia(s?null:t.id),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-700",children:t.content}),e.jsx("div",{className:"text-[10px] text-gray-400 mt-0.5",children:s?"ç‚¹å‡»æ”¶èµ·":"ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…"})]})}),e.jsx("div",{className:"text-gray-400 text-xs",children:s?"â–²":"â–¼"})]}),s&&t.callMessages&&t.callMessages.length>0&&e.jsx("div",{className:"mt-2 pt-2 border-t border-gray-200/50",children:e.jsx("div",{className:"space-y-1.5 max-h-64 overflow-y-auto",children:t.callMessages.map((t,s)=>{if("narrator"===t.type)return e.jsx("div",{className:"text-center",children:e.jsx("span",{className:"text-[10px] text-gray-400 italic",children:t.content})},s);{const a="user"===t.type;return e.jsx("div",{className:"flex "+(a?"justify-end":"justify-start"),children:e.jsx("div",{className:"max-w-[75%] px-1.5 py-0.5 rounded-md text-[10px] "+(a?"bg-green-500 text-white":"glass-light text-gray-800"),children:t.content})},s)}})})})]})})})]},t.id)}return"live_stream"===t.messageType&&t.liveStreamData?e.jsx("div",{className:"flex justify-center mb-4",children:e.jsxs("div",{className:"glass-card rounded-2xl p-4 shadow-lg w-[260px] cursor-pointer hover:scale-105 transition-transform",onClick:()=>v(`/live-room/${t.liveStreamData.liveStreamId}`),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-red-500 to-pink-500 flex items-center justify-center",children:e.jsx("svg",{className:"w-7 h-7 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-900 font-medium",children:"ç›´æ’­ä¸­"}),e.jsx("span",{className:"px-2 py-0.5 bg-red-500 text-white text-xs rounded-full animate-pulse",children:"LIVE"})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[(null==fa?void 0:fa.name)||"AI"," å¼€å§‹äº†ç›´æ’­"]})]})]}),e.jsx("div",{className:"border-t border-gray-200 pt-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})}),e.jsx("span",{children:(()=>{const e={"æ–°äºº":[30,80],"å°æœ‰åæ°”":[100,300],"çŸ¥åä¸»æ’­":[500,1e3],"é¡¶æµ":[2e3,5e3]}[t.liveStreamData.popularityLevel]||[100,300];return`${Math.floor(Math.random()*(e[1]-e[0])+e[0])}äººåœ¨çº¿`})()})]}),e.jsx("span",{className:"px-3 py-1 bg-gradient-to-r from-red-500 to-pink-500 text-white text-xs font-medium rounded-full",children:"è¿›å…¥ç›´æ’­é—´"})]})})]})},t.id):t.groupInvite?e.jsxs("div",{children:[n&&t.timestamp&&e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"bg-gray-200/60 px-3 py-1 rounded-full",children:e.jsx("span",{className:"text-xs text-gray-500",children:ht(t.timestamp)})})}),e.jsx(Ua,{groupId:t.groupInvite.groupId,groupName:t.groupInvite.groupName,memberNames:t.groupInvite.memberNames,inviterName:t.groupInvite.inviterName})]},t.id):e.jsxs("div",{children:[n&&t.timestamp&&e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"bg-gray-200/60 px-3 py-1 rounded-full",children:e.jsx("span",{className:"text-xs text-gray-500",children:ht(t.timestamp)})})}),e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"bg-gray-200/80 px-3 py-1.5 rounded-md "+(t.isRecalled||t.avatarPrompt?"cursor-pointer hover:bg-gray-300/80 transition-colors":""),onClick:()=>{if(t.isRecalled&&t.recalledContent)Ks(t);else if(t.avatarPrompt){const e={"portrait avatar of":"å¤´åƒï¼š","centered composition":"å±…ä¸­æž„å›¾","profile picture style":"å¤´åƒé£Žæ ¼","high quality":"é«˜è´¨é‡",detailed:"ç²¾ç»†","professional digital art":"ä¸“ä¸šæ•°å­—è‰ºæœ¯",cute:"å¯çˆ±çš„",cat:"çŒ«",dog:"ç‹—",girl:"å¥³å­©",boy:"ç”·å­©",anime:"åŠ¨æ¼«",realistic:"çœŸå®žçš„",photo:"ç…§ç‰‡","pink hair":"ç²‰è‰²å¤´å‘","mother and child":"æ¯å­",baby:"å®å®",robot:"æœºå™¨äºº",cool:"é…·çš„",elegant:"ä¼˜é›…çš„"};let s=t.avatarPrompt;for(const[t,a]of Object.entries(e))s=s.replace(new RegExp(t,"gi"),a);alert(`AIä½¿ç”¨çš„æç¤ºè¯ï¼š\n\nåŽŸæ–‡ï¼š\n${t.avatarPrompt}\n\nä¸­æ–‡ç¿»è¯‘ï¼š\n${s}`)}},children:e.jsx("span",{className:"text-xs text-gray-600",children:t.content})})})]},t.id)}return t.narrations&&t.narrations.length>0&&!t.content&&!t.messageType?e.jsxs("div",{children:[n&&t.timestamp&&e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"bg-gray-200/60 px-3 py-1 rounded-full",children:e.jsx("span",{className:"text-xs text-gray-500",children:ht(t.timestamp)})})}),e.jsx("div",{className:"mb-4",children:t.narrations.map((t,s)=>e.jsx("div",{className:"text-center text-xs text-gray-500 italic mb-2",children:t.content},s))})]},t.id):e.jsxs("div",{children:[n&&t.timestamp&&e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"bg-gray-200/60 px-3 py-1 rounded-full",children:e.jsx("span",{className:"text-xs text-gray-500",children:ht(t.timestamp)})})}),e.jsxs("div",{className:"mb-4",children:[t.narrations&&t.narrations.length>0&&e.jsx("div",{className:"mb-2",children:t.narrations.map((t,s)=>e.jsx("div",{className:"text-center text-xs text-gray-500 italic mb-1",children:t.content},s))}),e.jsxs("div",{className:"flex message-container "+("sent"===t.type?"justify-end sent":"justify-start received"),children:[sa&&"system"!==t.type&&e.jsx("div",{className:"flex items-center mr-2",children:e.jsx("input",{type:"checkbox",checked:ra.has(t.id),onChange:()=>{return e=t.id,void la(t=>{const s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s});var e},className:"w-5 h-5 rounded border-2 border-gray-300 text-red-600 focus:ring-red-500",onClick:e=>e.stopPropagation()})}),"received"===t.type&&e.jsxs("div",{className:"flex flex-col items-center gap-0.5 mr-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-gray-200 flex items-center justify-center flex-shrink-0 shadow-md overflow-hidden",children:ja?e.jsx("img",{src:ba,alt:"è§’è‰²å¤´åƒ",className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-lg",children:ba||"ðŸ¤–"})}),e.jsx("span",{className:"text-[9px] text-gray-400",children:t.time})]}),e.jsxs("div",{className:"flex items-center gap-1",children:["sent"===t.type&&(()=>{if(!w||!t.timestamp)return null;if(K.getBlockStatus("user",w).blockedByTarget){const s=K.getBlockTimestamp(w,"user");if(s&&t.timestamp>s)return e.jsx("svg",{className:"w-5 h-5 text-red-500 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}return null})(),e.jsx("div",{onTouchStart:e=>Xa(t,e),onTouchEnd:Za,onMouseDown:e=>Xa(t,e),onMouseUp:Za,onMouseLeave:Za,children:"redenvelope"===t.messageType&&t.redEnvelopeId?(()=>{const s=at(w,t.redEnvelopeId);return s?e.jsx(Ta,{redEnvelope:s,onClick:()=>(e=>{if(!w)return;const t=at(w,e);if(!t)return;const s="ai"===t.sender&&"pending"===t.status&&!m(t);jt(t),yt(s),ft(!0)})(t.redEnvelopeId),coverImage:He,iconImage:qe}):null})():"photo"===t.messageType&&t.photoDescription?e.jsx(Ra,{description:t.photoDescription,messageId:t.id}):"voice"===t.messageType&&t.voiceText?e.jsxs("div",{className:"flex flex-col gap-2",style:{width:"160px"},children:[e.jsx("div",{className:"message-bubble",style:{backgroundColor:"sent"===t.type?Pe:Oe,borderRadius:"16px",padding:"12px",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",width:"160px",transition:"all 0.2s",border:"sent"===t.type?"none":"1px solid #e5e7eb"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{className:"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 transition-all "+("sent"===t.type?"bg-white/20 hover:bg-white/30":"bg-green-500 hover:bg-green-600"),onClick:e=>{e.stopPropagation();const s=Math.min(Math.max(Math.ceil((t.voiceText||"").length/5),1),60);((e,t)=>{js===e?vs(null):(vs(e),setTimeout(()=>{vs(null)},1e3*t))})(t.id,s)},children:js===t.id?e.jsx("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M6 4h4v16H6V4zm8 0h4v16h-4V4z"})}):e.jsx("svg",{className:"w-4 h-4 text-white ml-0.5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M8 5v14l11-7z"})})}),e.jsx("div",{className:"flex items-center gap-0.5 flex-1 cursor-pointer",onClick:()=>bs(e=>({...e,[t.id]:!e[t.id]})),children:[40,60,80,60,40,70,50,90,60,40,80,50,70].map((s,a)=>e.jsx("div",{className:`w-0.5 rounded-full transition-all ${"sent"===t.type?"bg-white/60":"bg-gray-400"} ${js===t.id?"animate-pulse":""}`,style:{height:js===t.id?100*Math.random()+"%":`${s}%`,maxHeight:"16px",minHeight:"4px",animationDelay:.1*a+"s"}},a))}),e.jsxs("div",{className:"text-xs font-medium "+("sent"===t.type?"text-white":"text-gray-600"),children:[Math.min(Math.max(Math.ceil((t.voiceText||"").length/5),1),60),'"']})]})}),fs[t.id]&&e.jsxs("div",{className:"px-3 py-2 rounded-xl text-sm "+("sent"===t.type?"bg-white/10 text-gray-700":"bg-gray-100 text-gray-700"),style:{width:"160px",wordWrap:"break-word",overflowWrap:"break-word"},children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"è½¬æ–‡å­—ï¼š"}),t.voiceText]})]}):"location"===t.messageType&&t.location?e.jsxs("div",{className:"glass-card rounded-2xl overflow-hidden shadow-lg w-[220px] cursor-pointer hover:shadow-xl transition-shadow",onClick:()=>(e=>{Ms(e)})(t),children:[e.jsxs("div",{className:"h-24 bg-gradient-to-br from-blue-100 to-green-100 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-20",children:e.jsx("div",{className:"grid grid-cols-8 grid-rows-8 h-full w-full",children:Array.from({length:64}).map((t,s)=>e.jsx("div",{className:"border border-gray-300"},s))})}),e.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2",children:e.jsx("svg",{className:"w-7 h-7 text-red-500 drop-shadow-lg",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"})})})]}),e.jsx("div",{className:"p-2.5 h-[66px] bg-white/90 backdrop-blur-sm",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("svg",{className:"w-4 h-4 text-green-600 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 text-sm truncate",children:t.location.name}),e.jsx("div",{className:"text-xs text-gray-500 mt-1 line-clamp-2",children:t.location.address})]})]})})]}):"emoji"===t.messageType&&t.emojiUrl?e.jsx("div",{className:"rounded-2xl overflow-hidden shadow-lg max-w-[120px]",children:e.jsx("img",{src:t.emojiUrl,alt:t.emojiDescription||"è¡¨æƒ…åŒ…",className:"w-full h-auto"})}):"xiaohongshu"===t.messageType&&t.xiaohongshuNote?e.jsx(Da,{note:t.xiaohongshuNote,onClick:()=>{window.open(t.xiaohongshuNote.url,"_blank")}}):"image"===t.messageType&&t.imageUrl?e.jsx("div",{className:"rounded-2xl overflow-hidden shadow-lg max-w-[180px]",children:e.jsx("img",{src:t.imageUrl,alt:"ä¸Šä¼ çš„å›¾ç‰‡",className:"w-full h-auto cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>{const e=window.open("","_blank");e&&e.document.write(`<img src="${t.imageUrl}" style="max-width:100%;max-height:100vh;margin:auto;display:block;">`)}})}):"musicShare"===t.messageType&&t.musicShare?e.jsx("div",{style:{maxWidth:"280px",display:"inline-block"},children:e.jsx(ka,{songTitle:t.musicShare.songTitle,songArtist:t.musicShare.songArtist,songCover:t.musicShare.songCover,onClick:()=>{pe({songTitle:t.musicShare.songTitle,songArtist:t.musicShare.songArtist,songCover:t.musicShare.songCover}),R(!0)}})}):"musicInvite"===t.messageType&&t.musicInvite?e.jsx("div",{style:{maxWidth:"280px",display:"inline-block"},children:e.jsx(Na,{inviterName:t.musicInvite.inviterName,songTitle:t.musicInvite.songTitle,songArtist:t.musicInvite.songArtist,songCover:t.musicInvite.songCover,status:t.musicInvite.status,isSent:"sent"===t.type,onAccept:()=>{A(e=>e.map(e=>e.id===t.id?{...e,musicInvite:{...e.musicInvite,status:"accepted"}}:e)),setTimeout(()=>{const e=$.map(e=>e.id===t.id?{...e,musicInvite:{...e.musicInvite,status:"accepted"}}:e);G(`chat_${w}`,JSON.stringify(e))},100),v("/music-together-chat",{state:{song:{title:t.musicInvite.songTitle,artist:t.musicInvite.songArtist,cover:t.musicInvite.songCover},characterId:w,characterName:(null==fa?void 0:fa.name)||"å¥½å‹",characterAvatar:null==fa?void 0:fa.avatar}})},onReject:()=>{A(e=>e.map(e=>e.id===t.id?{...e,musicInvite:{...e.musicInvite,status:"rejected"}}:e)),setTimeout(()=>{const e=$.map(e=>e.id===t.id?{...e,musicInvite:{...e.musicInvite,status:"rejected"}}:e);G(`chat_${w}`,JSON.stringify(e))},100)}})}):"transfer"===t.messageType&&t.transfer?e.jsxs("div",{className:"message-bubble glass-card rounded-2xl shadow-lg min-w-[200px]",style:{position:"relative",overflow:"hidden"},children:[Xe&&e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundImage:`url(${Xe})`,backgroundSize:"cover",backgroundPosition:"center",zIndex:0}}),e.jsxs("div",{style:{position:"relative",zIndex:1,padding:"16px"},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-500 rounded-full flex items-center justify-center text-white text-xl font-bold overflow-hidden",style:{backgroundImage:Qe?`url(${Qe})`:"none",backgroundSize:"cover",backgroundPosition:"center"},children:!Qe&&"Â¥"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm text-gray-900 font-medium",children:"è½¬è´¦"}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:t.transfer.message&&t.transfer.message.trim()?t.transfer.message:"pending"===t.transfer.status?"sent"===t.type?"ä½ å‘èµ·äº†ä¸€ç¬”è½¬è´¦":"å¯¹æ–¹å‘èµ·äº†ä¸€ç¬”è½¬è´¦":"received"===t.transfer.status?"å·²æŽ¥æ”¶":"expired"===t.transfer.status?"å·²é€€è¿˜":"è½¬è´¦"})]})]}),e.jsx("div",{className:"border-t border-gray-200 pt-3",children:"received"===t.type&&"pending"===t.transfer.status?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("span",{className:"text-2xl font-semibold text-gray-900",children:["Â¥",t.transfer.amount.toFixed(2)]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{return e=t.id,void A(t=>[...t.map(t=>t.id===e&&"transfer"===t.messageType&&"received"===t.type?{...t,transfer:{...t.transfer,status:"expired"}}:t),{id:Date.now(),type:"system",content:"ä½ å·²é€€è¿˜è½¬è´¦",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),messageType:"system"}]);var e},className:"flex-1 px-4 py-2 bg-gray-100 text-gray-700 text-sm rounded-full ios-button",children:"é€€è¿˜"}),e.jsx("button",{onClick:()=>{return e=t.id,void A(t=>{var s;const a=t.map(t=>t.id===e&&"transfer"===t.messageType&&"received"===t.type?(t.transfer&&Z(t.transfer.amount,(null==fa?void 0:fa.name)||"å¥½å‹",t.transfer.message),{...t,transfer:{...t.transfer,status:"received"}}):t),r=t.find(t=>t.id===e),l=(null==(s=null==r?void 0:r.transfer)?void 0:s.amount)||0;return[...a,{id:Date.now(),type:"system",content:`ä½ å·²æ”¶æ¬¾ï¼Œå·²å­˜å…¥é›¶é’± Â¥${l.toFixed(2)}`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),messageType:"system"}]});var e},className:"flex-1 px-4 py-2 bg-primary text-white text-sm rounded-full ios-button",children:"é¢†å–"})]})]}):e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-2xl font-semibold text-gray-900",children:["Â¥",t.transfer.amount.toFixed(2)]}),"received"===t.transfer.status&&e.jsx("span",{className:"text-xs text-gray-400",children:"sent"===t.type?"å·²æ”¶æ¬¾":"ä½ å·²æ”¶æ¬¾"}),"expired"===t.transfer.status&&e.jsx("span",{className:"text-xs text-gray-400",children:"sent"===t.type?"å·²é€€è¿˜":"ä½ å·²é€€è¿˜"})]})})]})]}):"couple_space_invite"===t.messageType&&t.coupleSpaceInvite?e.jsxs("div",{className:"glass-card rounded-2xl p-4 shadow-lg min-w-[200px]",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-pink-400 to-rose-400 flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm text-gray-900 font-medium",children:"æƒ…ä¾£ç©ºé—´"}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:"é‚€è¯·ä½ åŠ å…¥æƒ…ä¾£ç©ºé—´"})]})]}),e.jsx("div",{className:"border-t border-gray-200 pt-3",children:"pending"===t.coupleSpaceInvite.status?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-3 leading-relaxed",children:"å¼€å¯ä¸“å±žæƒ…ä¾£ç©ºé—´ï¼Œåˆ†äº«ä½ ä»¬çš„ç¾Žå¥½æ—¶å…‰"}),"received"===t.type?e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{onClick:async()=>{if(A(e=>e.map(e=>e.id===t.id&&e.coupleSpaceInvite?{...e,coupleSpaceInvite:{...e.coupleSpaceInvite,status:"rejected"}}:e)),w){const{rejectCoupleSpaceInvite:e}=await ss(async()=>{const{rejectCoupleSpaceInvite:e}=await import("./utils-BkWlPcuZ.js").then(e=>e.bQ);return{rejectCoupleSpaceInvite:e}},__vite__mapDeps([0,1,2]));e(w)}},className:"px-4 py-2 glass-card border border-white/20 text-gray-700 text-sm rounded-full ios-button",children:"æ‹’ç»"}),e.jsx("button",{onClick:async()=>{if(A(e=>e.map(e=>e.id===t.id&&e.coupleSpaceInvite?{...e,coupleSpaceInvite:{...e.coupleSpaceInvite,status:"accepted"}}:e)),w){const{acceptCoupleSpaceInvite:e}=await ss(async()=>{const{acceptCoupleSpaceInvite:e}=await import("./utils-BkWlPcuZ.js").then(e=>e.bQ);return{acceptCoupleSpaceInvite:e}},__vite__mapDeps([0,1,2]));e(w)&&alert("å·²æŽ¥å—æƒ…ä¾£ç©ºé—´é‚€è¯·ï¼çŽ°åœ¨å¯ä»¥åŽ»æƒ…ä¾£ç©ºé—´æŸ¥çœ‹äº†")}},className:"px-4 py-2 bg-gradient-to-r from-pink-400 to-rose-400 text-white text-sm rounded-full ios-button",children:"æŽ¥å—é‚€è¯·"})]}):"sent"===t.type?e.jsx("div",{className:"text-center",children:e.jsx("span",{className:"text-xs text-gray-400",children:"ç­‰å¾…å¯¹æ–¹å›žåº”"})}):e.jsx("div",{className:"text-xs text-gray-500 text-center",children:"ç­‰å¾…å¯¹æ–¹æŽ¥å—"})]}):e.jsx("div",{className:"text-center",children:e.jsx("span",{className:"text-xs text-gray-400",children:"accepted"===t.coupleSpaceInvite.status?"sent"===t.type?"å¯¹æ–¹å·²æŽ¥å—":"ä½ å·²æŽ¥å—":"sent"===t.type?"å¯¹æ–¹å·²æ‹’ç»":"ä½ å·²æ‹’ç»"})})})]}):"intimate_pay"===t.messageType&&t.intimatePay?e.jsxs("div",{className:"glass-card rounded-2xl p-4 shadow-lg min-w-[200px]",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center overflow-hidden",children:e.jsx("img",{src:Fa,alt:"äº²å¯†ä»˜",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm text-gray-900 font-medium",children:"äº²å¯†ä»˜"}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:"ä¸ºä½ å¼€é€šäº²å¯†ä»˜"})]})]}),e.jsx("div",{className:"border-t border-gray-200 pt-3",children:"pending"===t.intimatePay.status?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"æ¯æœˆé¢åº¦"}),e.jsxs("div",{className:"text-2xl font-semibold text-gray-900",children:["Â¥",t.intimatePay.monthlyLimit.toFixed(2)]})]}),"received"===t.type?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-gray-500 mb-3 leading-relaxed",children:["æŽ¥å—åŽï¼Œä½ æ¯æœˆå¯ä½¿ç”¨å¯¹æ–¹çš„é›¶é’±è¿›è¡Œæ¶ˆè´¹ï¼Œæœ€é«˜é¢åº¦ Â¥",t.intimatePay.monthlyLimit.toFixed(2)]}),e.jsx("button",{onClick:()=>v(`/intimate-pay/receive/${t.intimatePay.characterId}/${t.intimatePay.monthlyLimit}`,{replace:!0}),className:"w-full px-4 py-2 bg-gradient-to-r from-pink-400 to-red-400 text-white text-sm rounded-full ios-button",children:"æŽ¥å—äº²å¯†ä»˜"})]}):e.jsx("div",{className:"text-xs text-gray-500 text-center",children:"ç­‰å¾…å¯¹æ–¹æŽ¥å—"})]}):e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-semibold text-gray-900 mb-1",children:["Â¥",t.intimatePay.monthlyLimit.toFixed(2)]}),e.jsx("span",{className:"text-xs text-gray-400",children:"accepted"===t.intimatePay.status?"sent"===t.type?"å¯¹æ–¹å·²æŽ¥å—":"ä½ å·²æŽ¥å—":"sent"===t.type?"å¯¹æ–¹å·²æ‹’ç»":"ä½ å·²æ‹’ç»"})]})})]}):e.jsx("div",{style:{maxWidth:"280px",display:"inline-block",wordBreak:"break-word"},children:t.content&&e.jsx("div",{className:"message-bubble px-3 py-2",style:{backgroundColor:"sent"===t.type?Pe:t.content.startsWith("[é”™è¯¯]")?"#fee2e2":Oe,borderRadius:"12px",boxShadow:"0 1px 4px rgba(0,0,0,0.08)",wordBreak:"break-word",whiteSpace:"pre-wrap",color:t.content.startsWith("[é”™è¯¯]")?"#991b1b":"#111827",fontSize:"14px",maxWidth:"100%",overflowWrap:"break-word"},children:e.jsxs("div",{style:{position:"relative",zIndex:2},children:[t.quotedMessage&&e.jsxs("div",{className:"mb-2 px-2.5 py-1.5 rounded cursor-pointer transition-colors",style:{background:"rgba(0, 0, 0, 0.05)",fontSize:"12px",color:"#666"},children:[e.jsx("div",{className:"font-semibold mb-0.5",style:{color:"#1677ff"},children:t.quotedMessage.senderName}),e.jsx("div",{className:"overflow-hidden text-ellipsis whitespace-nowrap",children:t.quotedMessage.content})]}),e.jsx("div",{style:{position:"relative",zIndex:2},children:/<[a-z][\s\S]*>/i.test(t.content)?e.jsx(Va,{content:t.content}):e.jsx("span",{children:t.content})})]})})})}),"received"===t.type&&(()=>{if(!w)return null;if(K.getBlockStatus("user",w).blockedByMe){const s=K.getBlockTimestamp("user",w);if(s){if(!t.timestamp)return e.jsx("svg",{className:"w-5 h-5 text-red-500 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})});if(t.timestamp>s)return e.jsx("svg",{className:"w-5 h-5 text-red-500 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}}return null})()]}),"sent"===t.type&&e.jsxs("div",{className:"flex flex-col items-center gap-0.5 ml-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-gray-200 flex items-center justify-center flex-shrink-0 shadow-md overflow-hidden",children:Sa?e.jsx("img",{src:Ca,alt:"æˆ‘çš„å¤´åƒ",className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-lg",children:"ðŸ‘¤"})}),e.jsx("span",{className:"text-[9px] text-gray-400",children:t.time})]})]})]})]},t.id)}),T&&e.jsxs("div",{className:"flex mb-3 justify-start",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-gray-200 flex items-center justify-center flex-shrink-0 mr-2 shadow-md overflow-hidden",children:ja?e.jsx("img",{src:ba,alt:"è§’è‰²å¤´åƒ",className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-lg",children:ba||"ðŸ¤–"})}),e.jsx("div",{className:"glass-card px-3 py-2 rounded-xl rounded-tl-sm shadow-md",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})]}),e.jsx("div",{ref:ct})]})}),e.jsxs("div",{className:"border-t border-gray-200/50 "+(Te?"glass-dark":"glass-effect"),children:[Hs&&e.jsx("div",{className:"px-3 pt-2 pb-1",children:e.jsxs("div",{className:"bg-gray-100 rounded-xl p-2 flex items-start gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs font-medium text-gray-700 mb-0.5",children:"sent"===Hs.type?"æˆ‘":(null==fa?void 0:fa.name)||"AI"}),e.jsx("div",{className:"text-xs text-gray-600 truncate",children:Hs.content||Hs.emojiDescription||Hs.photoDescription||Hs.voiceText||"ç‰¹æ®Šæ¶ˆæ¯"})]}),e.jsx("button",{onClick:()=>Gs(null),className:"flex-shrink-0 w-5 h-5 flex items-center justify-center text-gray-400 hover:text-gray-600 ios-button",children:"Ã—"})]})}),da&&e.jsxs("div",{className:"px-3 pt-2 pb-1 bg-blue-50 border-t border-blue-200",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx("span",{className:"text-xs font-medium text-blue-600",children:"âœï¸ ç¼–è¾‘æ¶ˆæ¯"})}),e.jsxs("div",{className:"bg-white rounded-xl p-2 flex items-start gap-2",children:[e.jsx("textarea",{value:ma,onChange:e=>ha(e.target.value),className:"flex-1 min-w-0 bg-transparent border-none outline-none text-sm text-gray-900 resize-none",rows:2,autoFocus:!0}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("button",{onClick:()=>{if(da&&ma.trim()){const e=$.map(e=>e.id===da.id?{...e,content:ma.trim()}:e);Qa(e),w&&localStorage.setItem(`chat_messages_${w}`,JSON.stringify(e)),xa(null),ha("")}},className:"px-3 py-1 bg-blue-600 text-white text-xs rounded-lg hover:bg-blue-700 active:opacity-60",children:"ä¿å­˜"}),e.jsx("button",{onClick:()=>{xa(null),ha("")},className:"px-3 py-1 bg-gray-200 text-gray-700 text-xs rounded-lg hover:bg-gray-300 active:opacity-60",children:"å–æ¶ˆ"})]})]})]}),e.jsxs("div",{className:"px-3 py-3 flex items-center gap-2",children:[e.jsx("button",{onClick:()=>F(!P),className:"w-10 h-10 flex items-center justify-center ios-button text-gray-700",children:e.jsx(Is,{size:26})}),e.jsx("div",{className:"flex-1 flex items-center bg-white/90 rounded-full px-4 py-2 shadow-inner",children:e.jsx("input",{type:"text",value:z,onChange:e=>L(e.target.value),onKeyPress:e=>"Enter"===e.key&&_a(),placeholder:"å‘é€æ¶ˆæ¯",className:"flex-1 bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})}),e.jsx("button",{onClick:()=>Yt(!0),className:"w-10 h-10 flex items-center justify-center ios-button text-gray-700",children:e.jsx(hs,{size:22})}),Ja?e.jsx("button",{onClick:_a,disabled:T,className:"w-10 h-10 flex items-center justify-center ios-button bg-wechat-green text-white rounded-full shadow-lg disabled:opacity-50 transition-all duration-200",children:e.jsx(xs,{size:18})}):e.jsx("button",{onClick:async()=>{T||(w&&Y(w),await Ya($))},disabled:T,className:"w-10 h-10 flex items-center justify-center ios-button text-gray-700 disabled:opacity-50 transition-all duration-200",children:e.jsx(xs,{size:22})})]}),!P&&e.jsx("div",{className:"flex justify-center pb-2",children:e.jsx("div",{className:"w-32 h-1 bg-gray-900 rounded-full opacity-40"})})]}),P&&e.jsx(za,{onClose:()=>{F(!1)},onSelectImage:async()=>{const e=document.createElement("input");e.type="file",e.accept="image/*",e.multiple=!0,e.addEventListener("change",async e=>{const t=e.target.files;if(t&&0!==t.length)try{const{compressImage:e,isValidImageSize:s}=await ss(async()=>{const{compressImage:e,isValidImageSize:t}=await import("./utils-BkWlPcuZ.js").then(e=>e.bR);return{compressImage:e,isValidImageSize:t}},__vite__mapDeps([0,1,2])),a=[];for(let r=0;r<t.length;r++){const l=t[r];if(!l.type.startsWith("image/"))continue;if(!s(l,10)){alert(`å›¾ç‰‡ ${l.name} å¤§å°è¶…è¿‡10MBï¼Œå·²è·³è¿‡`);continue}const n=await e(l,1024,1024,.8),i={id:Date.now()+r,type:"sent",content:t.length>1?`å‘é€äº†å›¾ç‰‡ (${r+1}/${t.length})`:"å‘é€äº†ä¸€å¼ å›¾ç‰‡",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now()+r,messageType:"image",imageUrl:n};a.push(i)}a.length>0&&A(e=>[...e,...a])}catch(s){alert("å›¾ç‰‡å¤„ç†å¤±è´¥ï¼Œè¯·é‡è¯•")}}),e.click(),F(!1)},onSelectCamera:()=>{F(!1),ns(!0)},onSelectRedPacket:()=>{F(!1),gt(!0)},onSelectTransfer:()=>{F(!1),wt(!0)},onSelectIntimatePay:()=>{F(!1),Ct(!0)},onSelectCoupleSpaceInvite:()=>{F(!1),It(!0)},onSelectCoupleSpaceContent:()=>{F(!1),Mt(!0)},onSelectLocation:()=>{F(!1),Ns(!0)},onSelectVoiceMessage:()=>{F(!1),us(!0)},onSelectXiaohongshu:()=>{F(!1),Ls(!0)},onSelectMusicInvite:()=>{F(!1),Gt(!0)},onSelectVoiceCall:()=>{F(!1),fa&&Ts({id:fa.id,name:fa.name,avatar:fa.avatar,profile:fa.description,relationship:fa.relationship,favorability:fa.favorability},!1)},onSelectVideoCall:()=>{F(!1),fa&&Ts({id:fa.id,name:fa.name,avatar:fa.avatar,profile:fa.description,relationship:fa.relationship,favorability:fa.favorability},!0)},onRegenerateAI:()=>{F(!1);const e=$.slice().reverse().find(e=>"received"===e.type);e&&(async e=>{if(T)return;const t=$.findIndex(t=>t.id===e);if(-1===t)return;let s=t;for(let r=t-1;r>=0;r--){if("sent"===$[r].type){s=r+1;break}0===r&&(s=0)}const a=$.slice(0,s);A(a),setTimeout(async()=>{await Ya(a)},100)})(e.id)},hasCoupleSpace:$t}),e.jsx($a,{show:ut,onClose:()=>gt(!1),onSend:(e,t,s)=>{if(!w)return;if(s){if(!ee(w,e,`çº¢åŒ…ï¼š${t}`))return void alert("äº²å¯†ä»˜é¢åº¦ä¸è¶³")}else{if(B()<e)return void alert("é›¶é’±ä½™é¢ä¸è¶³ï¼Œè¯·å…ˆå……å€¼");if(!te(e,(null==fa?void 0:fa.name)||"å¥½å‹",t))return void alert("å‘é€å¤±è´¥ï¼Œä½™é¢ä¸è¶³")}const a={id:f(),amount:e,blessing:t,status:"pending",sender:"user",createdAt:Date.now(),claimedBy:null,claimedAt:null};rt(w,a);const r=Date.now(),l={id:r,type:"sent",content:`[çº¢åŒ…]${t}`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:r,messageType:"redenvelope",redEnvelopeId:a.id};A(e=>[...e,l]),gt(!1)},characterId:w,characterName:null==fa?void 0:fa.name}),e.jsx(Aa,{show:pt,redEnvelope:bt,canClaim:vt,onClose:()=>ft(!1),onClaim:()=>{if(!w||!bt)return;se(bt.amount,(null==fa?void 0:fa.name)||"å¥½å‹",bt.blessing),lt(w,bt.id,{status:"claimed",claimedBy:"æˆ‘",claimedAt:Date.now()});const e={id:Date.now(),type:"system",content:`ä½ é¢†å–äº†å¯¹æ–¹çš„çº¢åŒ…ï¼Œå·²å­˜å…¥é›¶é’± Â¥${bt.amount.toFixed(2)}`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),messageType:"system"};A(t=>[...t,e]),ft(!1)}}),e.jsx(Pa,{show:Nt,onClose:()=>wt(!1),onSend:(e,t,s)=>{if(!w)return;if(s){if(!ee(w,e,`è½¬è´¦ï¼š${t}`))return void alert("äº²å¯†ä»˜é¢åº¦ä¸è¶³")}else{if(B()<e)return void alert("é›¶é’±ä½™é¢ä¸è¶³ï¼Œè¯·å…ˆå……å€¼");if(!ae(e,(null==fa?void 0:fa.name)||"å¥½å‹",t))return void alert("è½¬è´¦å¤±è´¥ï¼Œä½™é¢ä¸è¶³")}const a=Date.now(),r={id:a,type:"sent",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:a,messageType:"transfer",transfer:{amount:e,message:t,status:"pending"}};A(e=>[...e,r]),wt(!1)},characterId:w,characterName:null==fa?void 0:fa.name}),kt&&e.jsx(Oa,{onSend:e=>{if(!w||!fa)return;const t=Date.now(),s={id:t,type:"sent",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:t,messageType:"intimate_pay",intimatePay:{monthlyLimit:e,characterId:fa.id,characterName:fa.name,status:"pending"}};A(e=>[...e,s]),Ct(!1)},onCancel:()=>Ct(!1)}),St&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm",onClick:()=>It(!1)}),e.jsxs("div",{className:"relative w-full max-w-sm glass-card rounded-3xl p-6 shadow-2xl border border-white/20",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-pink-400 to-rose-400 flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"é‚€è¯·åŠ å…¥æƒ…ä¾£ç©ºé—´"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["é‚€è¯· ",null==fa?void 0:fa.name," åŠ å…¥ä¸“å±žæƒ…ä¾£ç©ºé—´",e.jsx("br",{}),"å…±åŒè®°å½•ç¾Žå¥½æ—¶å…‰"]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>It(!1),className:"flex-1 px-4 py-3 rounded-full glass-card border border-white/20 text-gray-900 font-medium ios-button",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:async()=>{if(!w||!fa)return;const{createCoupleSpaceInvite:e}=await ss(async()=>{const{createCoupleSpaceInvite:e}=await import("./utils-BkWlPcuZ.js").then(e=>e.bQ);return{createCoupleSpaceInvite:e}},__vite__mapDeps([0,1,2]));if(!e("current_user",w,fa.name,fa.avatar))return alert("å·²æœ‰æ´»è·ƒçš„æƒ…ä¾£ç©ºé—´"),void It(!1);const t=Date.now(),s={id:t,type:"sent",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:t,messageType:"couple_space_invite",coupleSpaceInvite:{inviterId:"current_user",inviterName:(null==C?void 0:C.name)||"ç”¨æˆ·",status:"pending"}};A(e=>[...e,s]),It(!1)},className:"flex-1 px-4 py-3 rounded-full bg-gradient-to-r from-pink-400 to-rose-400 text-white font-medium ios-button shadow-lg",children:"å‘é€é‚€è¯·"})]})]})]}),e.jsx(Wa,{show:Qt,onClose:()=>Yt(!1),onSelect:e=>{const t=Date.now(),s={id:t,type:"sent",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:t,messageType:"emoji",emojiUrl:e.url,emojiDescription:e.description};A(e=>[...e,s])}}),ls&&e.jsx(e.Fragment,{children:e.jsx("div",{onClick:()=>ns(!1),className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:e.jsxs("div",{onClick:e=>e.stopPropagation(),className:"glass-card rounded-3xl p-6 w-[90%] max-w-md shadow-2xl",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-4 text-center",children:"æ‹æ‘„ç…§ç‰‡"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4 text-center",children:"è¾“å…¥å›¾ç‰‡æè¿°ï¼Œå°†ç”Ÿæˆä¸€å¼ ç™½åº•é»‘å­—çš„å›¾ç‰‡"}),e.jsx("textarea",{value:is,onChange:e=>cs(e.target.value),placeholder:"è¯·è¾“å…¥å›¾ç‰‡æè¿°...",className:"w-full h-32 px-4 py-3 border border-gray-300 rounded-2xl resize-none focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent",autoFocus:!0}),e.jsxs("div",{className:"text-right text-sm text-gray-500 mt-2",children:[is.length," å­—"]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>{ns(!1),cs("")},className:"flex-1 px-4 py-3 bg-gray-100 text-gray-700 rounded-full ios-button font-medium",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:()=>{if(!is.trim())return;const e=Date.now(),t={id:e,type:"sent",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:e,messageType:"photo",photoDescription:is};A(e=>[...e,t]),ns(!1),cs("")},disabled:!is.trim(),className:"flex-1 px-4 py-3 bg-primary text-white rounded-full ios-button font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:"å‘é€ç…§ç‰‡"})]})]})})}),ms&&e.jsx(e.Fragment,{children:e.jsx("div",{onClick:()=>us(!1),className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:e.jsxs("div",{onClick:e=>e.stopPropagation(),className:"glass-card rounded-3xl p-6 w-[90%] max-w-md shadow-2xl",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-4 text-center",children:"å‘é€è¯­éŸ³æ¶ˆæ¯"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4 text-center",children:"è¾“å…¥è¯­éŸ³å†…å®¹ï¼ˆæ¨¡æ‹Ÿè¯­éŸ³è½¬æ–‡å­—ï¼‰"}),e.jsx("textarea",{value:gs,onChange:e=>ps(e.target.value),placeholder:"è¯·è¾“å…¥è¯­éŸ³å†…å®¹...",className:"w-full h-32 px-4 py-3 border border-gray-300 rounded-2xl resize-none focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",autoFocus:!0}),e.jsxs("div",{className:"text-right text-sm text-gray-500 mt-2",children:[gs.length," å­—"]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>{us(!1),ps("")},className:"flex-1 px-4 py-3 bg-gray-100 text-gray-700 rounded-full ios-button font-medium",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:()=>{if(!gs.trim())return;const e=Date.now(),t={id:e,type:"sent",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:e,messageType:"voice",voiceText:gs};A(e=>[...e,t]),us(!1),ps("")},disabled:!gs.trim(),className:"flex-1 px-4 py-3 bg-green-500 text-white rounded-full ios-button font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:"å‘é€è¯­éŸ³"})]})]})})}),ys&&e.jsx(e.Fragment,{children:e.jsx("div",{onClick:()=>Ns(!1),className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:e.jsxs("div",{onClick:e=>e.stopPropagation(),className:"glass-card rounded-3xl p-6 w-[90%] max-w-md shadow-2xl",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-4 text-center",children:"ðŸ“ å‘é€ä½ç½®"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4 text-center",children:"è¾“å…¥ä½ç½®åç§°ï¼ˆåœ°å€å¯é€‰ï¼‰"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"åœ°ç‚¹åç§°"}),e.jsx("input",{type:"text",value:ws,onChange:e=>ks(e.target.value),placeholder:"ä¾‹å¦‚ï¼šæ˜Ÿå·´å…‹(å›½è´¸åº—)",className:"w-full px-4 py-3 border border-gray-300 rounded-2xl focus:outline-none focus:ring-2 focus:ring-green-600 focus:border-transparent",autoFocus:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"è¯¦ç»†åœ°å€"}),e.jsx("textarea",{value:Cs,onChange:e=>Ss(e.target.value),placeholder:"ä¾‹å¦‚ï¼šåŒ—äº¬å¸‚æœé˜³åŒºå»ºå›½é—¨å¤–å¤§è¡—1å·å›½è´¸å•†åŸŽ",className:"w-full h-24 px-4 py-3 border border-gray-300 rounded-2xl resize-none focus:outline-none focus:ring-2 focus:ring-green-600 focus:border-transparent"})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>{Ns(!1),ks(""),Ss("")},className:"flex-1 px-4 py-3 bg-gray-100 text-gray-700 rounded-full ios-button font-medium",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:()=>{if(!ws.trim())return;const e=Date.now(),t={id:e,type:"sent",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:e,messageType:"location",location:{name:ws,address:Cs.trim()||"ä½ç½®è¯¦æƒ…",latitude:39.9042+.1*Math.random(),longitude:116.4074+.1*Math.random()}};A(e=>[...e,t]),Ns(!1),ks(""),Ss("")},disabled:!ws.trim(),className:"flex-1 px-4 py-3 bg-green-600 text-white rounded-full ios-button font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:"å‘é€ä½ç½®"})]})]})})}),zs&&e.jsx(Ea,{onClose:()=>Ls(!1),onSelect:Ka}),$s&&e.jsx(Ba,{onClose:()=>As(!1),onSubmit:Ka}),Ht&&e.jsx(wa,{onClose:()=>Gt(!1),onSend:async(e,t,s)=>{const a=Date.now(),r={id:a,type:"sent",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:a,messageType:"musicInvite",musicInvite:{songTitle:e,songArtist:t,songCover:s,inviterName:(null==C?void 0:C.name)||"æˆ‘",status:"pending"}};A(e=>[...e,r]),Gt(!1),setTimeout(()=>{qa(a,e,t)},1500+1e3*Math.random())}}),_s&&e.jsx(e.Fragment,{children:e.jsx("div",{onClick:()=>Ms(null),className:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center",children:e.jsxs("div",{onClick:e=>e.stopPropagation(),className:"w-[90%] max-w-2xl",children:[e.jsx("button",{onClick:()=>Ms(null),className:"absolute top-4 right-4 w-10 h-10 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center text-white hover:bg-white/30 transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"bg-white rounded-3xl overflow-hidden shadow-2xl",children:[e.jsxs("div",{className:"h-96 bg-gradient-to-br from-blue-100 to-green-100 relative",children:[e.jsx("div",{className:"absolute inset-0 opacity-20",children:e.jsx("div",{className:"grid grid-cols-16 grid-rows-16 h-full w-full",children:Array.from({length:256}).map((t,s)=>e.jsx("div",{className:"border border-gray-300"},s))})}),e.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2",children:e.jsx("svg",{className:"w-16 h-16 text-red-500 drop-shadow-2xl animate-bounce",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"})})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[e.jsx("svg",{className:"w-6 h-6 text-green-600 flex-shrink-0 mt-1",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:null==(b=_s.location)?void 0:b.name}),e.jsx("p",{className:"text-gray-600 text-sm leading-relaxed",children:null==(j=_s.location)?void 0:j.address})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{className:"flex-1 px-4 py-3 bg-green-600 text-white rounded-full ios-button font-medium",children:"å¯¼èˆªåˆ°è¿™é‡Œ"}),e.jsx("button",{className:"flex-1 px-4 py-3 bg-gray-100 text-gray-700 rounded-full ios-button font-medium",children:"å‘é€ç»™æœ‹å‹"})]})]})]})]})})}),fa&&e.jsx(La,{show:Ds,character:{name:fa.name,avatar:fa.avatar},isVideoCall:Bs,onAccept:()=>{Es(!1),Ts({id:fa.id,name:fa.name,avatar:fa.avatar,profile:fa.description,relationship:fa.relationship,favorability:fa.favorability},Bs)},onReject:()=>{Es(!1);const e=new Date,t={id:Date.now(),type:"system",content:`å·²æ‹’ç» ${Bs?"è§†é¢‘":"è¯­éŸ³"}é€šè¯`,time:e.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now()};A(e=>[...e,t]);const s=(null==C?void 0:C.nickname)||(null==C?void 0:C.name)||"ç”¨æˆ·",a={id:Date.now()+1,type:"system",content:`${s}æ‹’ç»äº†ä½ çš„${Bs?"è§†é¢‘":"è¯­éŸ³"}é€šè¯è¯·æ±‚ã€‚`,time:e.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),isHidden:!0};A(e=>[...e,a])}}),e.jsx(Ha,{isOpen:ca,onClose:()=>oa(!1),characterName:(null==fa?void 0:fa.name)||"AI",characterId:w||""}),Ws&&Fs&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50",style:{backdropFilter:"blur(5px)",WebkitBackdropFilter:"blur(5px)",transition:"all 0.3s ease"},onClick:()=>{Rs(!1),Os(null)}}),e.jsxs("div",{className:"fixed z-50 "+("sent"===Fs.type?"message-menu-right":"message-menu-left"),style:{top:`${Math.min(Us.y+10,window.innerHeight-150)}px`,left:"sent"===Fs.type?`${Math.min(Us.x-140,window.innerWidth-160)}px`:`${Math.max(Us.x-20,20)}px`,minWidth:"140px",maxWidth:"160px",background:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",borderRadius:"16px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.2)",transform:"scale(1)",transition:"all 0.25s cubic-bezier(0.4, 0, 0.2, 1)",animation:"menuFadeIn 0.25s cubic-bezier(0.4, 0, 0.2, 1)"},children:[e.jsx("div",{style:{position:"absolute",width:"12px",height:"12px",background:"rgba(255, 255, 255, 0.95)",transform:"rotate(45deg)",top:"-6px",["sent"===Fs.type?"right":"left"]:"20px",zIndex:-1}}),e.jsxs("div",{style:{padding:"8px 0"},children:[e.jsx("button",{onClick:()=>{Fs&&(Gs(Fs),Rs(!1),Os(null))},className:"w-full px-4 py-2.5 hover:bg-black/5 text-left text-sm text-gray-900 ios-button transition-all",style:{border:"none",background:"transparent"},children:"å¼•ç”¨"}),!(null==Fs?void 0:Fs.redEnvelopeId)&&!(null==Fs?void 0:Fs.transfer)&&!(null==Fs?void 0:Fs.intimatePay)&&e.jsx("button",{onClick:()=>{if(Fs){if(!(!Fs.redEnvelopeId&&!Fs.transfer&&!Fs.intimatePay))return alert("çº¢åŒ…ã€è½¬è´¦ã€äº²å¯†ä»˜ç­‰ç‰¹æ®Šæ¶ˆæ¯ä¸æ”¯æŒæ’¤å›ž"),Rs(!1),void Os(null);ta(Fs),Zs(!0),Rs(!1)}},className:"w-full px-4 py-2.5 hover:bg-black/5 text-left text-sm text-gray-900 ios-button transition-all",style:{border:"none",background:"transparent"},children:"æ’¤å›ž"}),e.jsx("button",{onClick:()=>{if(Fs){if(!confirm("ç¡®å®šè¦æ°¸ä¹…åˆ é™¤è¿™æ¡æ¶ˆæ¯å—ï¼Ÿ\n\nâš ï¸ æ­¤æ“ä½œæ— æ³•æ’¤é”€ï¼"))return Rs(!1),void Os(null);if(Fs.redEnvelopeId)try{const e=JSON.parse(localStorage.getItem("red_envelopes")||"[]").filter(e=>e.id!==Fs.redEnvelopeId);localStorage.setItem("red_envelopes",JSON.stringify(e))}catch(e){}Fs.transfer;const t=$.filter(e=>e.id!==Fs.id);Qa(t),w&&localStorage.setItem(`chat_messages_${w}`,JSON.stringify(t)),Rs(!1),Os(null)}},className:"w-full px-4 py-2.5 hover:bg-black/5 text-left text-sm text-gray-900 ios-button transition-all",style:{border:"none",background:"transparent"},children:"åˆ é™¤"}),e.jsx("button",{onClick:()=>{aa(!0),Rs(!1),Os(null)},className:"w-full px-4 py-2.5 hover:bg-black/5 text-left text-sm text-red-600 ios-button transition-all",style:{border:"none",background:"transparent"},children:"æ‰¹é‡åˆ é™¤"}),"sent"===(null==Fs?void 0:Fs.type)&&e.jsx("button",{onClick:()=>{if(Fs){if("sent"!==Fs.type)return alert("åªèƒ½ç¼–è¾‘è‡ªå·±å‘é€çš„æ¶ˆæ¯"),Rs(!1),void Os(null);if(Fs.messageType&&"text"!==Fs.messageType&&!Fs.content)return alert("æ­¤ç±»åž‹çš„æ¶ˆæ¯ä¸æ”¯æŒç¼–è¾‘"),Rs(!1),void Os(null);xa(Fs),ha(Fs.content||""),Rs(!1),Os(null)}},className:"w-full px-4 py-2.5 hover:bg-black/5 text-left text-sm text-gray-900 ios-button transition-all",style:{border:"none",background:"transparent"},children:"ç¼–è¾‘"})]})]}),e.jsx("style",{children:"\n            @keyframes menuFadeIn {\n              from {\n                opacity: 0;\n                transform: scale(0.8);\n              }\n              to {\n                opacity: 1;\n                transform: scale(1);\n              }\n            }\n          "})]}),Xs&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",style:{backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)"},children:[e.jsx("div",{className:"absolute inset-0 bg-black/30",onClick:()=>{Zs(!1),Ys(""),ta(null)}}),e.jsxs("div",{className:"relative glass-card rounded-3xl p-6 mx-4 max-w-sm w-full shadow-2xl border border-white/20",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"æ’¤å›žæ¶ˆæ¯"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"è¯·è¾“å…¥æ’¤å›žç†ç”±ï¼ˆå¿…å¡«ï¼‰"})]}),e.jsx("textarea",{value:Qs,onChange:e=>Ys(e.target.value),placeholder:"ä¾‹å¦‚ï¼šå‘é”™äº†ã€è¯´é”™è¯äº†...",className:"w-full bg-white/50 rounded-2xl px-4 py-3 text-sm text-gray-900 border border-white/30 outline-none focus:border-primary resize-none mb-4",rows:3,maxLength:100,required:!0}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{Zs(!1),Ys(""),ta(null)},className:"flex-1 glass-card rounded-xl py-3 text-sm font-medium text-gray-700 border border-white/30",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:()=>{if(Qs.trim()){if(ea){const e="sent"===ea.type;A(t=>t.map(t=>t.id===ea.id?{...t,isRecalled:!0,recalledContent:t.content||t.emojiDescription||t.photoDescription||t.voiceText||"ç‰¹æ®Šæ¶ˆæ¯",recallReason:Qs.trim(),originalType:t.type,content:e?"ä½ æ’¤å›žäº†ä¸€æ¡æ¶ˆæ¯":`${(null==fa?void 0:fa.name)||"å¯¹æ–¹"}æ’¤å›žäº†ä¸€æ¡æ¶ˆæ¯`,type:"system",messageType:"system"}:t)),Zs(!1),Ys(""),ta(null),Os(null)}}else alert("è¯·å¡«å†™æ’¤å›žç†ç”±")},disabled:!Qs.trim(),className:"flex-1 rounded-xl py-3 text-sm font-medium text-white shadow-lg transition-all "+(Qs.trim()?"bg-gradient-to-r from-red-400 to-pink-400 hover:from-red-500 hover:to-pink-500":"bg-gray-300 cursor-not-allowed"),children:"ç¡®è®¤æ’¤å›ž"})]})]})]}),qs&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",style:{backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)"},children:[e.jsx("div",{className:"absolute inset-0 bg-black/20",onClick:()=>Ks(null)}),e.jsxs("div",{className:"relative glass-card rounded-3xl p-6 mx-4 max-w-md w-full shadow-2xl border border-white/30",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["sent"===qs.originalType?"ä½ ":(null==fa?void 0:fa.name)||"AI","æ’¤å›žçš„æ¶ˆæ¯"]}),qs.recallReason&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["ç†ç”±ï¼š",qs.recallReason]})]}),e.jsx("div",{className:"bg-white/40 backdrop-blur-sm rounded-2xl p-4 mb-4 max-h-80 overflow-y-auto border border-white/20",children:e.jsx("p",{className:"text-sm text-gray-800 whitespace-pre-wrap break-words leading-relaxed",children:qs.recalledContent||"æ— å†…å®¹"})}),e.jsx("button",{onClick:()=>Ks(null),className:"w-full glass-card border border-white/30 rounded-2xl py-3 text-sm font-medium text-gray-700 hover:bg-white/50 transition-all",children:"å…³é—­"})]})]}),_t&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm",onClick:()=>{Mt(!1),Lt(null)}}),e.jsx("div",{className:"relative w-full max-w-sm glass-card rounded-3xl p-6 shadow-2xl border border-white/20 max-h-[80vh] overflow-y-auto",children:zt?"photo"===zt?e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4 text-center",children:"ä¸Šä¼ ç…§ç‰‡"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-2",children:"é€‰æ‹©ç…§ç‰‡ï¼ˆå¯é€‰ï¼Œå¯å¤šé€‰ï¼‰"}),e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:e=>{const t=e.target.files;if(t&&t.length>0){const e=[];Array.from(t).forEach((s,a)=>{const r=new FileReader;r.onload=s=>{var a;e.push(null==(a=s.target)?void 0:a.result),e.length===t.length&&Bt(t=>[...t,...e])},r.readAsDataURL(s)})}},className:"w-full px-3 py-2 border border-gray-300 rounded-xl text-sm"}),Et.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"text-xs text-gray-600 mb-2",children:["å·²é€‰æ‹© ",Et.length," å¼ ç…§ç‰‡"]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:Et.map((t,s)=>e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:t,alt:`é¢„è§ˆ${s+1}`,className:"w-full h-24 object-cover rounded-lg"}),e.jsx("button",{onClick:()=>Bt(e=>e.filter((e,t)=>t!==s)),className:"absolute top-1 right-1 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs",children:"Ã—"})]},s))})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-2",children:"ç…§ç‰‡æè¿°"}),e.jsx("textarea",{value:Tt,onChange:e=>Dt(e.target.value),placeholder:"æè¿°è¿™å¼ ç…§ç‰‡...",className:"w-full px-3 py-2 border border-gray-300 rounded-xl resize-none text-sm",rows:3})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>Lt(null),className:"flex-1 px-4 py-3 rounded-full glass-card border border-white/20 text-gray-900 font-medium ios-button",children:"è¿”å›ž"}),e.jsx("button",{onClick:async()=>{if(!w||!fa)return;if(!Tt.trim()&&0===Et.length)return;const{addCouplePhoto:e}=await ss(async()=>{const{addCouplePhoto:e}=await import("./utils-BkWlPcuZ.js").then(e=>e.bL);return{addCouplePhoto:e}},__vite__mapDeps([0,1,2])),t=Tt.trim()||"ç…§ç‰‡";if(Et.length>0){const s=Date.now();for(let r=0;r<Et.length;r++){const s=Et[r],a=Et.length>1?`${t} (${r+1}/${Et.length})`:t;e(fa.id,(null==C?void 0:C.name)||"æˆ‘",a,s)}const a={id:s,type:"system",content:`ðŸ“¸ ä½ åœ¨æƒ…ä¾£ç©ºé—´ä¸Šä¼ äº† ${Et.length} å¼ ç…§ç‰‡${"ç…§ç‰‡"!==t?`ï¼š${t}`:""}`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:s,messageType:"system",isHidden:!1};A(e=>[...e,a]),alert(`${Et.length} å¼ ç…§ç‰‡å·²ä¸Šä¼ åˆ°æƒ…ä¾£ç©ºé—´ï¼`)}else{const s=Date.now();e(fa.id,(null==C?void 0:C.name)||"æˆ‘",t,void 0);const a={id:s,type:"system",content:`ðŸ“¸ ä½ åœ¨æƒ…ä¾£ç©ºé—´ä¸Šä¼ äº†ç…§ç‰‡ï¼š${t}`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:s,messageType:"system",isHidden:!1};A(e=>[...e,a]),alert("ç…§ç‰‡å·²ä¸Šä¼ åˆ°æƒ…ä¾£ç©ºé—´ï¼")}Dt(""),Bt([]),Mt(!1),Lt(null)},className:"flex-1 px-4 py-3 rounded-full glass-card border border-white/20 text-gray-900 font-medium ios-button",children:"ä¸Šä¼ "})]})]}):"message"===zt?e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4 text-center",children:"å‘å¸ƒç•™è¨€"}),e.jsx("textarea",{value:Pt,onChange:e=>Ft(e.target.value),placeholder:"å†™ä¸‹ä½ æƒ³è¯´çš„è¯...",className:"w-full px-3 py-2 border border-gray-300 rounded-xl resize-none mb-4 text-sm",rows:5}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>Lt(null),className:"flex-1 px-4 py-3 rounded-full glass-card border border-white/20 text-gray-900 font-medium ios-button",children:"è¿”å›ž"}),e.jsx("button",{onClick:async()=>{if(!w||!fa)return;if(!Pt.trim())return;const{addCoupleMessage:e}=await ss(async()=>{const{addCoupleMessage:e}=await import("./utils-BkWlPcuZ.js").then(e=>e.bL);return{addCoupleMessage:e}},__vite__mapDeps([0,1,2]));e(fa.id,(null==C?void 0:C.name)||"æˆ‘",Pt.trim());const t=Date.now(),s={id:t,type:"system",content:`ðŸ’Œ ä½ åœ¨æƒ…ä¾£ç©ºé—´ç•™è¨€ï¼š${Pt.trim()}`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:t,messageType:"system",isHidden:!1};A(e=>[...e,s]),Ft(""),Mt(!1),Lt(null),alert("ç•™è¨€å·²å‘å¸ƒåˆ°æƒ…ä¾£ç©ºé—´ï¼")},className:"flex-1 px-4 py-3 rounded-full glass-card border border-white/20 text-gray-900 font-medium ios-button",children:"å‘å¸ƒ"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4 text-center",children:"æ·»åŠ çºªå¿µæ—¥"}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-2",children:"æ—¥æœŸ"}),e.jsx("input",{type:"date",value:Ot,onChange:e=>Wt(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-xl text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-2",children:"æ ‡é¢˜"}),e.jsx("input",{type:"text",value:Rt,onChange:e=>Ut(e.target.value),placeholder:"ä¾‹å¦‚ï¼šç¬¬ä¸€æ¬¡è§é¢",className:"w-full px-3 py-2 border border-gray-300 rounded-xl text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-2",children:"æè¿°ï¼ˆå¯é€‰ï¼‰"}),e.jsx("textarea",{value:Vt,onChange:e=>Jt(e.target.value),placeholder:"è®°å½•è¿™ä¸ªç‰¹æ®Šçš„æ—¥å­...",className:"w-full px-3 py-2 border border-gray-300 rounded-xl resize-none text-sm",rows:3})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>Lt(null),className:"flex-1 px-4 py-3 rounded-full glass-card border border-white/20 text-gray-900 font-medium ios-button",children:"è¿”å›ž"}),e.jsx("button",{onClick:async()=>{if(!w||!fa)return;if(!Ot||!Rt.trim())return;const{addCoupleAnniversary:e}=await ss(async()=>{const{addCoupleAnniversary:e}=await import("./utils-BkWlPcuZ.js").then(e=>e.bL);return{addCoupleAnniversary:e}},__vite__mapDeps([0,1,2]));e(fa.id,(null==C?void 0:C.name)||"æˆ‘",Ot,Rt.trim(),Vt.trim());const t=Date.now(),s={id:t,type:"system",content:`ðŸŽ‚ ä½ åœ¨æƒ…ä¾£ç©ºé—´æ·»åŠ äº†çºªå¿µæ—¥ï¼š${Rt.trim()}ï¼ˆ${Ot}ï¼‰`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:t,messageType:"system",isHidden:!1};A(e=>[...e,s]),Wt(""),Ut(""),Jt(""),Mt(!1),Lt(null),alert("çºªå¿µæ—¥å·²æ·»åŠ åˆ°æƒ…ä¾£ç©ºé—´ï¼")},className:"flex-1 px-4 py-3 rounded-full glass-card border border-white/20 text-gray-900 font-medium ios-button",children:"æ·»åŠ "})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4 text-center",children:"é€‰æ‹©åˆ›å»ºå†…å®¹"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>Lt("photo"),className:"w-full px-4 py-3 rounded-2xl glass-card border border-white/20 text-gray-900 font-medium ios-button",children:"ä¸Šä¼ ç…§ç‰‡"}),e.jsx("button",{onClick:()=>Lt("message"),className:"w-full px-4 py-3 rounded-2xl glass-card border border-white/20 text-gray-900 font-medium ios-button",children:"å‘å¸ƒç•™è¨€"}),e.jsx("button",{onClick:()=>Lt("anniversary"),className:"w-full px-4 py-3 rounded-2xl glass-card border border-white/20 text-gray-900 font-medium ios-button",children:"æ·»åŠ çºªå¿µæ—¥"})]}),e.jsx("button",{onClick:()=>Mt(!1),className:"w-full px-4 py-3 rounded-full glass-card border border-white/20 text-gray-900 font-medium ios-button mt-4",children:"å–æ¶ˆ"})]})})]}),U&&e.jsx(Ma,{songTitle:U.songTitle,songArtist:U.songArtist,songCover:U.songCover,isOpen:O,onClose:()=>{R(!1),pe(null)}})]})]})}},Symbol.toStringTag,{value:"Module"})),Ka=({images:s,initialIndex:a,onClose:r})=>{const[l,n]=t.useState(a),[i,c]=t.useState(0),o=()=>{c(e=>(e+90)%360)},d=()=>{n(e=>e>0?e-1:s.length-1),c(0)},x=()=>{n(e=>e<s.length-1?e+1:0),c(0)};return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center",onClick:r,onKeyDown:e=>{"Escape"===e.key&&r(),"ArrowLeft"===e.key&&d(),"ArrowRight"===e.key&&x(),"r"!==e.key&&"R"!==e.key||o()},tabIndex:0,children:[e.jsx("button",{onClick:r,className:"absolute top-4 right-4 text-white hover:text-gray-300 z-10 text-3xl w-10 h-10 flex items-center justify-center",children:"Ã—"}),e.jsx("button",{onClick:e=>{e.stopPropagation(),o()},className:"absolute top-4 right-16 text-white hover:text-gray-300 z-10 text-2xl w-10 h-10 flex items-center justify-center",title:"æ—‹è½¬ (R)",children:"â†»"}),s.length>1&&e.jsxs("div",{className:"absolute top-4 left-4 text-white text-lg z-10",children:[l+1," / ",s.length]}),e.jsx("div",{className:"relative max-w-[90vw] max-h-[90vh] flex items-center justify-center",onClick:e=>e.stopPropagation(),children:e.jsx("img",{src:s[l],alt:`å›¾ç‰‡ ${l+1}`,className:"max-w-full max-h-[90vh] object-contain transition-transform duration-300",style:{transform:`rotate(${i}deg)`}})}),s.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:e=>{e.stopPropagation(),d()},className:"absolute left-4 top-1/2 -translate-y-1/2 text-white hover:text-gray-300 text-4xl",children:"â€¹"}),e.jsx("button",{onClick:e=>{e.stopPropagation(),x()},className:"absolute right-4 top-1/2 -translate-y-1/2 text-white hover:text-gray-300 text-4xl",children:"â€º"})]}),e.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 text-white text-sm opacity-70",children:"æŒ‰ ESC å…³é—­ Â· æŒ‰ R æ—‹è½¬ Â· æ–¹å‘é”®åˆ‡æ¢"})]})},Xa=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{currentUser:r}=d(),{moments:l,likeMoment:i,unlikeMoment:c,addComment:x}=h(),{showStatusBar:m}=o(),{getCharacter:u}=n(),[g,p]=t.useState(null),[f,b]=t.useState(""),[j,v]=t.useState(""),[y,N]=t.useState(""),[w,k]=t.useState(()=>localStorage.getItem("moments_cover_image")||""),[C,S]=t.useState([]),[I,_]=t.useState(0),[M,z]=t.useState(!1),[L,$]=t.useState(0);t.useEffect(()=>{const e=()=>{$(pe())};e();const t=setInterval(e,1e3);return()=>clearInterval(t)},[]);const A=(t,s="medium")=>{const a={small:"text-sm",medium:"text-base",large:"text-2xl"};return t.startsWith("data:image")?e.jsx("img",{src:t,alt:"å¤´åƒ",className:"w-full h-full object-cover"}):t&&t.length<=4?e.jsx("div",{className:`${a[s]}`,children:t}):e.jsx("div",{className:"text-white text-base font-semibold bg-gradient-to-br from-blue-400 to-blue-600 w-full h-full flex items-center justify-center",children:(null==t?void 0:t[0])||"ç”¨"})},T=e=>{const t=new Date(e),s=(new Date).getTime()-t.getTime(),a=Math.floor(s/6e4),r=Math.floor(s/36e5),l=Math.floor(s/864e5);return a<1?"åˆšåˆš":a<60?`${a}åˆ†é’Ÿå‰`:r<24?`${r}å°æ—¶å‰`:l<3?`${l}å¤©å‰`:`${t.getMonth()+1}æœˆ${t.getDate()}æ—¥`},D=e=>{if(!r||!f.trim())return;const t=j?`@${j} ${f.trim()}`:f.trim();x(e,r.id,r.name,r.avatar,t);const s=l.find(t=>t.id===e);if(y&&y!==r.id){if(u(y)){const e=localStorage.getItem(`chat_messages_${y}`),s=e?JSON.parse(e):[],a={id:Date.now()+Math.random(),type:"system",content:`ðŸ’¬ ${r.name} å›žå¤äº†ä½ çš„æœ‹å‹åœˆè¯„è®ºï¼š${t}`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"system",isHidden:!0};s.push(a),localStorage.setItem(`chat_messages_${y}`,JSON.stringify(s))}}else if(s&&s.userId!==r.id){if(u(s.userId)){const e=localStorage.getItem(`chat_messages_${s.userId}`),a=e?JSON.parse(e):[],l={id:Date.now()+Math.random(),type:"system",content:`ðŸ’¬ ${r.name} è¯„è®ºäº†ä½ çš„æœ‹å‹åœˆï¼š${t}`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"system",isHidden:!0};a.push(l),localStorage.setItem(`chat_messages_${s.userId}`,JSON.stringify(a))}}b(""),v(""),N(""),p(null)},E=e=>{if(!r)return!1;const t=l.find(t=>t.id===e);return(null==t?void 0:t.likes.some(e=>e.userId===r.id))||!1};return e.jsxs("div",{className:"h-full flex flex-col bg-white",children:[e.jsxs("div",{className:"glass-effect z-50 flex-shrink-0",children:[m&&e.jsx(ua,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:e=>{e.stopPropagation(),a("/wechat/discover",{replace:!0})},className:"w-10 h-10 rounded-full glass-effect flex items-center justify-center ios-button",children:e.jsx(os,{size:20,className:"text-gray-700"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:e=>{e.stopPropagation(),a("/moment-notifications")},className:"w-10 h-10 rounded-full glass-effect flex items-center justify-center ios-button relative",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-700",children:[e.jsx("path",{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}),e.jsx("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"})]}),L>0&&e.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs font-bold",children:L>99?"99+":L})})]}),e.jsx("button",{onClick:e=>{e.stopPropagation(),a("/publish-moment")},className:"w-10 h-10 rounded-full glass-effect flex items-center justify-center ios-button",children:e.jsx(_s,{size:20,className:"text-gray-700"})})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"relative h-80 bg-white overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 bg-white cursor-pointer group",onClick:()=>{const e=document.createElement("input");e.type="file",e.accept="image/*",e.onchange=e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(s){const e=new FileReader;e.onload=e=>{var t;const s=null==(t=e.target)?void 0:t.result;k(s),localStorage.setItem("moments_cover_image",s)},e.readAsDataURL(s)}},e.click()},children:[w?e.jsx("img",{src:w,alt:"å°é¢",className:"w-full h-full object-cover"}):e.jsx("div",{className:"absolute inset-0 bg-white flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400 text-sm opacity-0 group-hover:opacity-100 transition-opacity",children:"ç‚¹å‡»ä¸Šä¼ å°é¢å›¾ç‰‡"})}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/5 transition-colors"})]}),e.jsxs("div",{className:"absolute bottom-6 left-4 right-4 flex items-end justify-between",children:[e.jsxs("div",{className:"flex-1 mr-4",children:[e.jsx("h2",{className:"text-white font-semibold text-lg drop-shadow-lg mb-1",children:(null==r?void 0:r.name)||"å¾®ä¿¡ç”¨æˆ·"}),(null==r?void 0:r.signature)&&e.jsx("p",{className:"text-white/90 text-xs drop-shadow-lg line-clamp-2",children:r.signature})]}),e.jsx("div",{className:"w-20 h-20 rounded-2xl bg-white flex items-center justify-center shadow-2xl overflow-hidden border-4 border-white/50",children:r&&A(r.avatar,"large")})]})]}),e.jsx("div",{className:"bg-white pb-20",children:0===l.length?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-400",children:[e.jsx("p",{className:"text-sm",children:"æš‚æ— åŠ¨æ€"}),e.jsx("p",{className:"text-xs mt-2 text-gray-300",children:"ç‚¹å‡»å³ä¸Šè§’ç›¸æœºå‘å¸ƒç¬¬ä¸€æ¡æœ‹å‹åœˆ"})]}):e.jsx("div",{children:l.map(t=>e.jsxs("div",{className:"bg-white border-b border-gray-100 p-4 hover:bg-gray-50/50 transition-colors",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gray-100 flex items-center justify-center flex-shrink-0 shadow-sm overflow-hidden",children:A(t.userAvatar,"medium")}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-blue-600 mb-1",children:t.userName}),e.jsx("p",{className:"text-gray-800 leading-relaxed mb-2",children:t.content.replace(/\[å›¾ç‰‡[ï¼š:][^\]]+\]/g,"")}),t.images.length>0&&e.jsx("div",{className:"grid gap-2 mb-2 "+(1===t.images.length?"grid-cols-1":2===t.images.length?"grid-cols-2":(t.images.length,"grid-cols-3")),children:t.images.map((s,a)=>e.jsx("div",{className:"aspect-square rounded-lg overflow-hidden bg-gray-100 cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>((e,t)=>{S(e),_(t),z(!0)})(t.images.map(e=>e.url),a),children:e.jsx("img",{src:s.url,alt:"",className:"w-full h-full object-cover"})},s.id))}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400 mb-2",children:[e.jsx("span",{children:T(t.createdAt)}),t.location&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Â·"}),e.jsx("span",{children:t.location})]})]})]}),e.jsx("button",{className:"w-8 h-8 rounded-lg flex items-center justify-center text-gray-400 hover:bg-gray-100 ios-button",children:e.jsx(Bs,{size:18})})]}),(t.likes.length>0||t.comments.length>0)&&e.jsxs("div",{className:"ml-[60px] bg-gray-50 rounded-lg p-3 space-y-2",children:[t.likes.length>0&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ps,{size:14,className:"text-red-500 mt-0.5 flex-shrink-0"}),e.jsx("div",{className:"flex-1 text-sm leading-relaxed",children:e.jsx("span",{className:"text-blue-600",children:t.likes.map((s,a)=>e.jsxs("span",{children:[s.userName,a<t.likes.length-1&&", "]},s.id))})})]}),t.likes.length>0&&t.comments.length>0&&e.jsx("div",{className:"border-t border-gray-200/60"}),t.comments.length>0&&e.jsx("div",{className:"space-y-2",children:t.comments.map(s=>e.jsxs("div",{className:"text-sm leading-relaxed cursor-pointer hover:bg-gray-50 -mx-2 px-2 py-1 rounded transition-colors",onClick:()=>{return e=t.id,a=s.userName,r=s.userId,p(e),v(a),N(r),void b("");var e,a,r},children:[e.jsxs("span",{className:"text-blue-600 font-medium",children:[s.userName,"ï¼š"]}),e.jsx("span",{className:"text-gray-700",children:s.content})]},s.id))})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4 mt-3 ml-[60px]",children:[e.jsxs("button",{onClick:()=>(e=>{if(!r)return;const t=l.find(t=>t.id===e);if(!t)return;t.likes.some(e=>e.userId===r.id)?c(e,r.id):i(e,r.id,r.name,r.avatar)})(t.id),className:"flex items-center gap-1.5 px-3 py-1.5 rounded-full ios-button transition-colors "+(E(t.id)?"bg-red-50 text-red-500":"bg-gray-50 text-gray-600"),children:[E(t.id)?e.jsx(Ps,{size:16}):e.jsx(Ds,{size:16}),e.jsx("span",{className:"text-xs",children:"èµž"})]}),e.jsxs("button",{onClick:()=>p(g===t.id?null:t.id),className:"flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-gray-50 text-gray-600 ios-button",children:[e.jsx(Es,{size:16}),e.jsx("span",{className:"text-xs",children:"è¯„è®º"})]})]}),g===t.id&&e.jsx("div",{className:"mt-3 ml-[60px]",children:e.jsxs("div",{className:"glass-card rounded-xl p-3",children:[j&&e.jsxs("div",{className:"flex items-center justify-between mb-2 pb-2 border-b border-gray-200",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:["å›žå¤ ",e.jsxs("span",{className:"text-blue-600 font-medium",children:["@",j]})]}),e.jsx("button",{onClick:()=>{v(""),N("")},className:"text-gray-400 hover:text-gray-600 text-xs",children:"âœ•"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:f,onChange:e=>b(e.target.value),placeholder:j?`å›žå¤ @${j}`:"è¯´ç‚¹ä»€ä¹ˆ...",className:"flex-1 bg-transparent outline-none text-sm",onKeyPress:e=>{"Enter"===e.key&&D(t.id)},autoFocus:!0}),e.jsx("button",{onClick:()=>D(t.id),className:"px-4 py-1 rounded-lg glass-effect text-blue-600 text-sm font-medium ios-button disabled:opacity-50",disabled:!f.trim(),children:"å‘é€"})]})]})})]},t.id))})})]}),M&&e.jsx(Ka,{images:C,initialIndex:I,onClose:()=>z(!1)})]})}},Symbol.toStringTag,{value:"Module"})),Za=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),{setBackground:l}=c(),n=t.useRef(null),[i,d]=t.useState("");t.useEffect(()=>{(async()=>{try{const e=await be("global_background");e&&(d(e),l(e))}catch(e){}})()},[l]);const[x,m]=t.useState(()=>"true"===localStorage.getItem("apply_background_to_all_pages")),[h,u]=t.useState(!1),[g,p]=t.useState(i),[f,b]=t.useState(fe()),[j,v]=t.useState(()=>localStorage.getItem("user_bubble_color")||"#95EC69"),[y,N]=t.useState(()=>localStorage.getItem("ai_bubble_color")||"#FFFFFF"),[w,k]=t.useState(()=>localStorage.getItem("user_bubble_css")||""),[C,S]=t.useState(()=>localStorage.getItem("ai_bubble_css")||""),[I,_]=t.useState(!1);t.useEffect(()=>{p(i)},[i]);return e.jsxs("div",{className:"h-full flex flex-col relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 z-0",style:i?{backgroundImage:`url(${i})`,backgroundSize:"cover",backgroundPosition:"center"}:{}}),e.jsxs("div",{className:"relative z-10 h-full flex flex-col bg-transparent",children:[e.jsxs("div",{className:"glass-effect sticky top-0 z-50",children:[r&&e.jsx(ua,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a("/desktop",{replace:!0}),className:"ios-button text-gray-700 hover:text-gray-900 -ml-2",children:e.jsx(os,{size:24})}),e.jsx("h1",{className:"text-base font-semibold text-gray-900 absolute left-1/2 transform -translate-x-1/2 pointer-events-none",children:"è®¾ç½®"}),e.jsx("div",{className:"w-6"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-3 pt-3 pb-20",children:[e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"glass-card rounded-2xl overflow-hidden",children:[e.jsxs("div",{onClick:()=>a("/users"),className:"flex items-center justify-between px-4 py-4 ios-button cursor-pointer border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-900 font-medium",children:"è´¦å·ä¸Žå®‰å…¨"}),e.jsx("span",{className:"text-gray-400 text-xl",children:"â€º"})]}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-4 ios-button cursor-pointer border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-900 font-medium",children:"æ–°æ¶ˆæ¯é€šçŸ¥"}),e.jsx("span",{className:"text-gray-400 text-xl",children:"â€º"})]}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-4 ios-button cursor-pointer",children:[e.jsx("span",{className:"text-gray-900 font-medium",children:"éšç§"}),e.jsx("span",{className:"text-gray-400 text-xl",children:"â€º"})]})]})}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-xs text-gray-500 font-medium",children:"å…¨å±€è®¾ç½®"})}),e.jsxs("div",{className:"glass-card rounded-2xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-4 ios-button cursor-pointer border-b border-gray-100",onClick:()=>_(!0),children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-gray-900 font-medium mb-0.5",children:"å…¨å±€èŠå¤©æ°”æ³¡"}),e.jsx("div",{className:"text-xs text-gray-500",children:"åº”ç”¨äºŽæ‰€æœ‰èŠå¤©ï¼Œå¯åœ¨å•ä¸ªèŠå¤©ä¸­è¦†ç›–"})]}),e.jsx("span",{className:"text-gray-400 text-xl",children:"â€º"})]}),e.jsxs("div",{className:"px-4 py-4",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-gray-900 font-medium mb-0.5",children:"å…¨å±€èƒŒæ™¯"}),e.jsx("div",{className:"text-xs text-gray-500",children:"é»˜è®¤åº”ç”¨äºŽå¾®ä¿¡ã€é€šè®¯å½•ã€å‘çŽ°ã€æˆ‘å››ä¸ªä¸»ç•Œé¢"})]}),e.jsx("input",{ref:n,type:"file",accept:"image/*",onChange:async e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(s)if(s.type.startsWith("image/")){u(!0);try{const e=new FileReader;e.onload=async()=>{const t=e.result;try{await je("global_background",t),p(t),d(t),l(t),u(!1),alert("å…¨å±€èƒŒæ™¯å·²ä¿å­˜ï¼ï¼ˆä½¿ç”¨ IndexedDBï¼Œæ— å¤§å°é™åˆ¶ï¼‰")}catch(s){alert("ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•"),u(!1)}},e.onerror=()=>{alert("å›¾ç‰‡è¯»å–å¤±è´¥"),u(!1)},e.readAsDataURL(s)}catch(a){alert("å›¾ç‰‡å¤„ç†å¤±è´¥ï¼Œè¯·é‡è¯•"),u(!1)}}else alert("è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶")},className:"hidden"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-20 h-20 rounded-xl overflow-hidden border-2 border-gray-200 flex-shrink-0 flex items-center justify-center",style:{backgroundImage:g?`url(${g})`:"none",backgroundSize:"cover",backgroundPosition:"center",backgroundColor:g?"transparent":"#f5f7fa"},children:!g&&e.jsx(us,{size:32,className:"text-gray-400"})}),e.jsxs("div",{className:"flex-1 flex gap-2",children:[e.jsx("button",{onClick:()=>{var e;return null==(e=n.current)?void 0:e.click()},disabled:h,className:"flex-1 px-4 py-2.5 bg-wechat-primary text-white rounded-xl ios-button font-medium text-sm",children:h?"ä¸Šä¼ ä¸­...":g?"æ›´æ¢":"ä¸Šä¼ èƒŒæ™¯"}),g&&e.jsx("button",{onClick:async()=>{try{await ve("global_background"),d(""),p(""),localStorage.removeItem("global_background"),l(""),b(fe()),alert("å…¨å±€èƒŒæ™¯å·²åˆ é™¤ï¼")}catch(e){alert("åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•")}},className:"px-4 py-2.5 glass-card text-gray-700 rounded-xl ios-button font-medium text-sm",children:"åˆ é™¤"})]})]}),g&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs("button",{onClick:()=>{const e=!x;m(e),localStorage.setItem("apply_background_to_all_pages",String(e))},className:"w-full flex items-center justify-between ios-button",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:"åº”ç”¨åˆ°æ‰€æœ‰ç•Œé¢"}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:x?"å·²åº”ç”¨åˆ°æ‰€æœ‰ç•Œé¢ï¼ˆåŒ…æ‹¬èŠå¤©ã€å°ç¨‹åºç­‰ï¼‰":"ä»…åº”ç”¨åˆ°å¾®ä¿¡ã€é€šè®¯å½•ã€å‘çŽ°ã€æˆ‘"})]})}),e.jsx("div",{className:"w-12 h-7 rounded-full transition-all "+(x?"bg-wechat-primary":"bg-gray-300"),children:e.jsx("div",{className:"w-5 h-5 bg-white rounded-full mt-1 transition-all shadow-md "+(x?"ml-6":"ml-1")})})]})})]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-xs text-gray-500 font-medium",children:"å­˜å‚¨ç®¡ç†"})}),e.jsxs("div",{className:"glass-card rounded-2xl overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-4 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-gray-900 font-medium",children:"å­˜å‚¨ç©ºé—´"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[f.used," KB / ",f.total," KB"]})]}),e.jsx("div",{className:"w-full h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full transition-all "+(f.percentage>80?"bg-red-500":f.percentage>60?"bg-yellow-500":"bg-green-500"),style:{width:`${Math.min(f.percentage,100)}%`}})}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["å·²ä½¿ç”¨ ",f.percentage,"%"]})]}),e.jsxs("div",{onClick:()=>{confirm("æ™ºèƒ½æ¸…ç†å°†ä¼˜åŒ–å­˜å‚¨ç©ºé—´ï¼š\n\nâ€¢ æ¯ä¸ªèŠå¤©ä¿ç•™æœ€è¿‘ 500 æ¡æ¶ˆæ¯\nâ€¢ æœ‹å‹åœˆä¿ç•™æœ€è¿‘ 200 æ¡\n\næ‚¨çš„é‡è¦èŠå¤©è®°å¿†ä¼šè¢«ä¿ç•™ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ")&&(ye(),b(fe()),alert("æ™ºèƒ½æ¸…ç†å®Œæˆï¼å·²ä¼˜åŒ–å­˜å‚¨ç©ºé—´"))},className:"flex items-center justify-between px-4 py-4 ios-button cursor-pointer border-b border-gray-100",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-gray-900 font-medium",children:"æ™ºèƒ½æ¸…ç†"}),e.jsx("div",{className:"text-xs text-gray-500",children:"ä¿ç•™æœ€è¿‘500æ¡æ¶ˆæ¯ï¼Œé‡Šæ”¾å­˜å‚¨ç©ºé—´"})]}),e.jsx("span",{className:"text-gray-400 text-xl",children:"â€º"})]}),e.jsxs("div",{onClick:()=>{confirm("åŽ‹ç¼©æ•°æ®å°†ç§»é™¤æ¶ˆæ¯ä¸­çš„å†—ä½™å­—æ®µï¼Œä¼˜åŒ–å­˜å‚¨æ•ˆçŽ‡ã€‚\n\næ³¨æ„ï¼šæ­¤æ“ä½œä¸ä¼šåˆ é™¤èŠå¤©å†…å®¹ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ")&&(Ne(),b(fe()),alert("æ•°æ®åŽ‹ç¼©å®Œæˆï¼"))},className:"flex items-center justify-between px-4 py-4 ios-button cursor-pointer border-b border-gray-100",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-gray-900 font-medium",children:"åŽ‹ç¼©æ•°æ®"}),e.jsx("div",{className:"text-xs text-gray-500",children:"ç§»é™¤å†—ä½™å­—æ®µï¼Œä¼˜åŒ–å­˜å‚¨æ•ˆçŽ‡"})]}),e.jsx("span",{className:"text-gray-400 text-xl",children:"â€º"})]}),e.jsxs("div",{onClick:()=>{if(confirm("ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰èŠå¤©è®°å½•å—ï¼Ÿ")){const e=[];for(let t=0;t<localStorage.length;t++){const s=localStorage.key(t);s&&s.startsWith("chat_messages_")&&e.push(s)}e.forEach(e=>localStorage.removeItem(e)),b(fe()),alert(`å·²æ¸…é™¤ ${e.length} ä¸ªèŠå¤©è®°å½•`)}},className:"flex items-center justify-between px-4 py-4 ios-button cursor-pointer border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-900 font-medium",children:"æ¸…ç†èŠå¤©è®°å½•"}),e.jsx("span",{className:"text-gray-400 text-xl",children:"â€º"})]}),e.jsxs("div",{onClick:()=>{confirm("ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰ç¼“å­˜å—ï¼Ÿè¿™å°†åˆ é™¤æ‰€æœ‰èŠå¤©è®°å½•ã€å£çº¸å’Œè®¾ç½®ï¼")&&(localStorage.clear(),alert("ç¼“å­˜å·²æ¸…é™¤ï¼Œé¡µé¢å°†åˆ·æ–°"),window.location.reload())},className:"flex items-center justify-between px-4 py-4 ios-button cursor-pointer",children:[e.jsx("span",{className:"text-red-500 font-medium",children:"æ¸…é™¤æ‰€æœ‰ç¼“å­˜"}),e.jsx("span",{className:"text-gray-400 text-xl",children:"â€º"})]})]})]}),e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"glass-card rounded-2xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-4 ios-button cursor-pointer border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-900 font-medium",children:"é€šç”¨"}),e.jsx("span",{className:"text-gray-400 text-xl",children:"â€º"})]}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-4 ios-button cursor-pointer border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-900 font-medium",children:"å¸®åŠ©ä¸Žåé¦ˆ"}),e.jsx("span",{className:"text-gray-400 text-xl",children:"â€º"})]}),e.jsxs("div",{onClick:()=>a("/about"),className:"flex items-center justify-between px-4 py-4 ios-button cursor-pointer",children:[e.jsx("span",{className:"text-gray-900 font-medium",children:"å…³äºŽæ±æ±"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"v1.0.9"}),e.jsx("span",{className:"text-gray-400 text-xl",children:"â€º"})]})]})]})}),e.jsx("div",{className:"mb-6",children:e.jsx("button",{onClick:()=>a("/"),className:"w-full glass-card rounded-2xl px-4 py-4 text-red-500 font-medium ios-button",children:"é€€å‡ºç™»å½•"})})]}),I&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"glass-card rounded-3xl w-full max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 glass-effect px-6 py-4 border-b border-gray-200/50 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"èŠå¤©æ°”æ³¡è®¾ç½®"}),e.jsx("button",{onClick:()=>_(!1),className:"text-gray-500 hover:text-gray-700 text-2xl",children:"Ã—"})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"glass-card rounded-xl p-4 bg-gradient-to-r from-purple-50 to-pink-50 border border-purple-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-1",children:"æƒ³è¦æ›´å¤šæ°”æ³¡æ ·å¼ï¼Ÿ"}),e.jsx("p",{className:"text-xs text-gray-600",children:"å‰å¾€å°ç¨‹åº â†’ æ°”æ³¡å•†åº—ï¼Œé€‰æ‹©ä½ å–œæ¬¢çš„é¢„è®¾æ ·å¼"})]}),e.jsx("button",{onClick:()=>{window.location.href="/#/bubble-store"},className:"px-3 py-1.5 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg text-xs font-medium whitespace-nowrap",children:"å‰å¾€å•†åº—"})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"æ‰‹åŠ¨è‡ªå®šä¹‰"}),e.jsx("p",{className:"text-sm text-gray-600",children:"å¦‚æžœä½ æƒ³å®Œå…¨è‡ªå®šä¹‰æ°”æ³¡æ ·å¼ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¾“å…¥CSSä»£ç "})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"æˆ‘çš„æ°”æ³¡ï¼ˆå‘é€ï¼‰"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"æ°”æ³¡é¢œè‰²"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"color",value:j,onChange:e=>v(e.target.value),className:"w-16 h-10 rounded-lg border border-gray-300 cursor-pointer"}),e.jsx("input",{type:"text",value:j,onChange:e=>v(e.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-wechat-primary",placeholder:"#95EC69"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"è‡ªå®šä¹‰CSSï¼ˆé«˜çº§ï¼‰"}),e.jsx("textarea",{value:w,onChange:e=>k(e.target.value),className:"w-full h-32 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-wechat-primary font-mono text-sm resize-none",placeholder:"ä¾‹å¦‚ï¼š\nbackground: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\nborder-radius: 16px;\nbox-shadow: 0 4px 12px rgba(0,0,0,0.1);"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"è¾“å…¥CSSæ ·å¼ä»£ç ï¼Œå°†ç›´æŽ¥åº”ç”¨åˆ°æ°”æ³¡ä¸Š"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"é¢„è§ˆæ•ˆæžœ"}),e.jsx("div",{className:"flex justify-end",children:e.jsx("div",{className:"px-4 py-3 rounded-2xl text-gray-900 max-w-xs",style:{backgroundColor:j,...Object.fromEntries(w.split(";").filter(e=>e.trim()).map(e=>{const[t,s]=e.split(":").map(e=>e.trim());return[t.replace(/-([a-z])/g,e=>e[1].toUpperCase()),s]}))},children:"è¿™æ˜¯æˆ‘å‘é€çš„æ¶ˆæ¯"})})]})]}),e.jsx("div",{className:"border-t border-gray-200"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"å¯¹æ–¹æ°”æ³¡ï¼ˆæŽ¥æ”¶ï¼‰"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"æ°”æ³¡é¢œè‰²"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"color",value:y,onChange:e=>N(e.target.value),className:"w-16 h-10 rounded-lg border border-gray-300 cursor-pointer"}),e.jsx("input",{type:"text",value:y,onChange:e=>N(e.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-wechat-primary",placeholder:"#FFFFFF"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"è‡ªå®šä¹‰CSSï¼ˆé«˜çº§ï¼‰"}),e.jsx("textarea",{value:C,onChange:e=>S(e.target.value),className:"w-full h-32 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-wechat-primary font-mono text-sm resize-none",placeholder:"ä¾‹å¦‚ï¼š\nbackground: #FFFFFF;\nborder: 1px solid #E5E5E5;\nbox-shadow: 0 2px 8px rgba(0,0,0,0.08);"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"è¾“å…¥CSSæ ·å¼ä»£ç ï¼Œå°†ç›´æŽ¥åº”ç”¨åˆ°æ°”æ³¡ä¸Š"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"é¢„è§ˆæ•ˆæžœ"}),e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"px-4 py-3 rounded-2xl text-gray-900 max-w-xs",style:{backgroundColor:y,...Object.fromEntries(C.split(";").filter(e=>e.trim()).map(e=>{const[t,s]=e.split(":").map(e=>e.trim());return[t.replace(/-([a-z])/g,e=>e[1].toUpperCase()),s]}))},children:"è¿™æ˜¯å¯¹æ–¹å‘é€çš„æ¶ˆæ¯"})})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:()=>{if(confirm("ç¡®å®šè¦é‡ç½®æ°”æ³¡è®¾ç½®ä¸ºé»˜è®¤å€¼å—ï¼Ÿ")){const e="#95EC69",t="#FFFFFF";v(e),N(t),k(""),S(""),localStorage.setItem("user_bubble_color",e),localStorage.setItem("ai_bubble_color",t),localStorage.removeItem("user_bubble_css"),localStorage.removeItem("ai_bubble_css"),alert("æ°”æ³¡è®¾ç½®å·²é‡ç½®ï¼")}},className:"flex-1 px-4 py-3 bg-gray-100 text-gray-700 rounded-xl ios-button font-medium",children:"é‡ç½®ä¸ºé»˜è®¤"}),e.jsx("button",{onClick:()=>{localStorage.setItem("user_bubble_color",j),localStorage.setItem("ai_bubble_color",y),localStorage.setItem("user_bubble_css",w),localStorage.setItem("ai_bubble_css",C),alert("æ°”æ³¡è®¾ç½®å·²ä¿å­˜ï¼"),_(!1)},className:"flex-1 px-4 py-3 bg-wechat-primary text-white rounded-xl ios-button font-medium",children:"ä¿å­˜è®¾ç½®"})]})]})]})})]})]})}},Symbol.toStringTag,{value:"Module"})),Qa=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{currentUser:r,updateUser:l}=d(),{showStatusBar:n}=o(),[i,c]=t.useState(null),[x,m]=t.useState(""),h=t.useRef(null),u=t.useRef(null);if(t.useEffect(()=>{"signature"===i&&u.current?u.current.focus():h.current&&h.current.focus()},[i]),!r)return null;const g=r.avatar&&r.avatar.startsWith("data:image"),p=(e,t)=>{c(e),m(t)},f=e=>{x.trim()&&l(r.id,{[e]:x}),c(null),m("")},b=()=>{c(null),m("")},j=(e,t)=>{"Enter"===e.key&&"signature"!==t?f(t):"Escape"===e.key&&b()};return e.jsxs("div",{className:"h-full flex flex-col bg-gray-50",children:[e.jsxs("div",{className:"glass-effect sticky top-0 z-50",children:[n&&e.jsx(ua,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a("/desktop",{replace:!0}),className:"ios-button text-gray-700 hover:text-gray-900 -ml-2",children:e.jsx(os,{size:24})}),e.jsx("h1",{className:"text-base font-semibold text-gray-900 absolute left-1/2 transform -translate-x-1/2 pointer-events-none",children:"ä¸ªäººä¿¡æ¯"}),e.jsx("div",{className:"w-6"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-3 pt-3",children:[e.jsx("div",{className:"mb-3",children:e.jsx("div",{className:"glass-card rounded-2xl overflow-hidden",children:e.jsxs("div",{onClick:()=>a("/edit-profile",{state:{field:"avatar"}}),className:"flex items-center justify-between px-4 py-4 ios-button cursor-pointer",children:[e.jsx("span",{className:"text-gray-900 font-medium",children:"å¤´åƒ"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-gray-200 flex items-center justify-center shadow-lg overflow-hidden",children:g&&r.avatar?e.jsx("img",{src:r.avatar,alt:"å¤´åƒ",className:"w-full h-full object-cover"}):e.jsx(us,{size:32,className:"text-gray-400"})}),e.jsx("span",{className:"text-gray-400 text-xl",children:"â€º"})]})]})})}),e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"glass-card rounded-2xl overflow-hidden",children:[e.jsx("div",{className:"px-4 py-4 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-900 font-medium",children:"åå­—"}),e.jsx("div",{className:"flex items-center gap-2 flex-1 justify-end",children:"name"===i?e.jsxs(e.Fragment,{children:[e.jsx("input",{ref:h,type:"text",value:x,onChange:e=>m(e.target.value),onKeyDown:e=>j(e,"name"),maxLength:20,className:"flex-1 bg-transparent border-none outline-none text-gray-900 text-right",placeholder:"è¯·è¾“å…¥åå­—"}),e.jsx("button",{onClick:b,className:"text-sm text-gray-500 ios-button whitespace-nowrap",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:()=>f("name"),className:"text-sm text-primary font-medium ios-button whitespace-nowrap",children:"ä¿å­˜"})]}):e.jsx("div",{onClick:()=>p("name",r.name),className:"text-gray-600 ios-button cursor-pointer",children:r.name})})]})}),e.jsx("div",{className:"px-4 py-4 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-900 font-medium",children:"ç½‘å"}),e.jsx("div",{className:"flex items-center gap-2 flex-1 justify-end",children:"nickname"===i?e.jsxs(e.Fragment,{children:[e.jsx("input",{ref:h,type:"text",value:x,onChange:e=>m(e.target.value),onKeyDown:e=>j(e,"nickname"),maxLength:20,className:"flex-1 bg-transparent border-none outline-none text-gray-900 text-right",placeholder:"è¯·è¾“å…¥ç½‘å"}),e.jsx("button",{onClick:b,className:"text-sm text-gray-500 ios-button whitespace-nowrap",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:()=>f("nickname"),className:"text-sm text-primary font-medium ios-button whitespace-nowrap",children:"ä¿å­˜"})]}):e.jsx("div",{onClick:()=>p("nickname",r.nickname||""),className:"text-gray-600 ios-button cursor-pointer",children:r.nickname||"æœªè®¾ç½®"})})]})}),e.jsx("div",{className:"px-4 py-4 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-900 font-medium",children:"å¾®ä¿¡å·"}),e.jsx("div",{className:"flex items-center gap-2 flex-1 justify-end",children:"username"===i?e.jsxs(e.Fragment,{children:[e.jsx("input",{ref:h,type:"text",value:x,onChange:e=>m(e.target.value),onKeyDown:e=>j(e,"username"),className:"flex-1 bg-transparent border-none outline-none text-gray-900 text-right",placeholder:"è¯·è¾“å…¥å¾®ä¿¡å·"}),e.jsx("button",{onClick:b,className:"text-sm text-gray-500 ios-button whitespace-nowrap",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:()=>f("username"),className:"text-sm text-primary font-medium ios-button whitespace-nowrap",children:"ä¿å­˜"})]}):e.jsx("div",{onClick:()=>p("username",r.username),className:"text-gray-500 ios-button cursor-pointer",children:r.username})})]})}),e.jsx("div",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("span",{className:"text-gray-900 font-medium pt-1",children:"ä¸ªæ€§ç­¾å"}),e.jsx("div",{className:"flex-1 ml-4",children:"signature"===i?e.jsxs("div",{children:[e.jsx("textarea",{ref:u,value:x,onChange:e=>m(e.target.value),maxLength:100,className:"w-full h-20 bg-transparent border-none outline-none text-gray-900 resize-none",placeholder:"å¡«å†™ä¸ªæ€§ç­¾å"}),e.jsxs("div",{className:"flex gap-2 justify-end mt-2",children:[e.jsx("button",{onClick:b,className:"text-sm text-gray-500 ios-button",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:()=>f("signature"),className:"text-sm text-primary font-medium ios-button",children:"ä¿å­˜"})]})]}):e.jsx("div",{onClick:()=>p("signature",r.signature),className:"text-gray-600 ios-button cursor-pointer min-h-[24px]",children:r.signature})})]})})]})}),e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"glass-card rounded-2xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-4 ios-button cursor-pointer border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-900 font-medium",children:"åœ°åŒº"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-600",children:"æœªè®¾ç½®"}),e.jsx("span",{className:"text-gray-400 text-xl",children:"â€º"})]})]}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-4 ios-button cursor-pointer",children:[e.jsx("span",{className:"text-gray-900 font-medium",children:"æ›´å¤š"}),e.jsx("span",{className:"text-gray-400 text-xl",children:"â€º"})]})]})}),e.jsx("div",{className:"mb-6",children:e.jsx("button",{onClick:()=>a("/users"),className:"w-full glass-card rounded-2xl px-4 py-4 text-primary font-medium ios-button",children:"åˆ‡æ¢è´¦å·"})})]})]})}},Symbol.toStringTag,{value:"Module"})),Ya="/zhizhi/assets/memory-icon-DzISjrVt.webp",er="/zhizhi/assets/memory-summary-icon-vLT3i2Cs.webp",tr="/zhizhi/assets/diary-icon-Bviql5LY.webp",sr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{var a;const l=s(),{id:i}=r(),{getCharacter:d}=n(),{showStatusBar:x}=o(),m=t.useRef(null),h=i?d(i):void 0,{background:u,setBackground:g}=c(),[p,f]=t.useState(()=>"true"===localStorage.getItem(`narrator_enabled_${i}`)),[b,j]=t.useState(()=>"true"===localStorage.getItem(`ai_moments_enabled_${i}`)),[v,y]=t.useState(()=>"true"===localStorage.getItem(`ai_proactive_enabled_${i}`)),[N,w]=t.useState(()=>{const e=localStorage.getItem("ai_message_limit");return e?parseInt(e):15}),[k,C]=t.useState(()=>{const e=localStorage.getItem(`memory_summary_interval_${i}`);return e?parseInt(e):30}),[S,I]=t.useState(()=>localStorage.getItem(`user_bubble_color_${i}`)||""),[_,M]=t.useState(()=>localStorage.getItem(`ai_bubble_color_${i}`)||""),[z,L]=t.useState(()=>localStorage.getItem(`user_bubble_css_${i}`)||""),[$,A]=t.useState(()=>localStorage.getItem(`ai_bubble_css_${i}`)||""),[T,D]=t.useState(!1),[E,B]=t.useState(""),[P,F]=t.useState(()=>{if(!i)return!1;return K.getBlockStatus("user",i).blockedByMe}),[O,W]=t.useState(!1),[R,U]=t.useState(u),V=t.useRef(null),J=t.useRef(null),H=t.useRef(null),G=t.useRef(null),[q,X]=t.useState(()=>localStorage.getItem(`red_envelope_cover_${i}`)||""),[Z,Q]=t.useState(()=>localStorage.getItem(`red_envelope_icon_${i}`)||""),[Y,ee]=t.useState(()=>localStorage.getItem(`transfer_cover_${i}`)||""),[te,se]=t.useState(()=>localStorage.getItem(`transfer_icon_${i}`)||"");t.useEffect(()=>{U(u)},[u]);return h?e.jsxs("div",{className:"h-full flex flex-col bg-gray-50",children:[e.jsxs("div",{className:"glass-effect sticky top-0 z-50",children:[x&&e.jsx(ua,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>l(`/chat/${i}`,{replace:!0}),className:"ios-button text-gray-700 hover:text-gray-900 -ml-2",children:e.jsx(os,{size:24})}),e.jsx("h1",{className:"text-base font-semibold text-gray-900",children:"èŠå¤©è®¾ç½®"}),e.jsx("div",{className:"w-6"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-3 pt-3 pb-20",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"èŠå¤©å¯¹è±¡"})}),e.jsxs("div",{className:"glass-card rounded-2xl p-4 flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gray-200 flex items-center justify-center flex-shrink-0 shadow-lg overflow-hidden",children:(null==(a=h.avatar)?void 0:a.startsWith("data:image"))?e.jsx("img",{src:h.avatar,alt:h.name,className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-2xl",children:h.avatar||"ðŸ¤–"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:h.name}),e.jsx("p",{className:"text-sm text-gray-500",children:h.username})]}),e.jsx("button",{onClick:()=>l(`/character/${h.id}`),className:"text-sm text-primary ios-button",children:"æŸ¥çœ‹è¯¦æƒ…"})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"AI è®°å¿†"})}),e.jsxs("div",{className:"glass-card rounded-2xl overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-4 flex items-center justify-between cursor-pointer hover:bg-gray-50 transition-colors border-b border-gray-100",onClick:()=>l(`/memory/${i}`),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 flex items-center justify-center",children:e.jsx("img",{src:Ya,alt:"è®°å¿†",className:"w-10 h-10 object-contain"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"æŸ¥çœ‹è®°å¿†"}),e.jsx("p",{className:"text-xs text-gray-500",children:"æŸ¥çœ‹ AI è®°ä½çš„å…³äºŽä½ çš„ä¿¡æ¯"})]})]}),e.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]}),e.jsxs("div",{className:"px-4 py-4 flex items-center justify-between cursor-pointer hover:bg-gray-50 transition-colors border-b border-gray-100",onClick:()=>l(`/memory-summary/${i}`),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 flex items-center justify-center",children:e.jsx("img",{src:er,alt:"è®°å¿†æ€»ç»“",className:"w-10 h-10 object-contain"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"è®°å¿†æ€»ç»“"}),e.jsx("p",{className:"text-xs text-gray-500",children:"AI æ€»ç»“å½“å‰å¯¹è¯çš„é‡è¦ä¿¡æ¯"})]})]}),e.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]}),e.jsxs("div",{className:"px-4 py-4 flex items-center justify-between cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>l(`/diary/${i}`),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 flex items-center justify-center",children:e.jsx("img",{src:tr,alt:"æ—¥è®°",className:"w-10 h-10 object-contain"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"TAçš„æ—¥è®°"}),e.jsx("p",{className:"text-xs text-gray-500",children:"æŸ¥çœ‹ TA å†™çš„æ—¥è®°"})]})]}),e.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]}),e.jsxs("div",{className:"px-4 py-4 border-t border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"æ€»ç»“é—´éš”"}),e.jsx("p",{className:"text-xs text-gray-500",children:"æ¯éš”å¤šå°‘è½®å¯¹è¯è‡ªåŠ¨æ€»ç»“"})]}),e.jsxs("span",{className:"text-sm font-semibold text-wechat-primary",children:[k," è½®"]})]}),e.jsx("input",{type:"range",min:"10",max:"100",step:"10",value:k,onChange:e=>{return t=parseInt(e.target.value),C(t),void(i&&(localStorage.setItem(`memory_summary_interval_${i}`,String(t)),window.dispatchEvent(new Event("storage"))));var t},className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-wechat-primary"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-400 mt-1",children:[e.jsx("span",{children:"10è½®"}),e.jsx("span",{children:"100è½®"})]})]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"èŠå¤©å£çº¸"})}),e.jsxs("div",{className:"glass-card rounded-2xl overflow-hidden",children:[e.jsx("input",{ref:m,type:"file",accept:"image/*",onChange:async e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(s)if(s.type.startsWith("image/")){W(!0);try{const e=await(e=>new Promise((t,s)=>{const a=new FileReader;a.onload=e=>{var a;const r=new Image;r.onload=()=>{const e=document.createElement("canvas");let s=r.width,a=r.height;const l=1920;(s>l||a>l)&&(s>a?(a=a/s*l,s=l):(s=s/a*l,a=l)),e.width=s,e.height=a;const n=e.getContext("2d");null==n||n.drawImage(r,0,0,s,a);const i=e.toDataURL("image/jpeg",.7);t(i)},r.onerror=s,r.src=null==(a=e.target)?void 0:a.result},a.onerror=s,a.readAsDataURL(e)}))(s);U(e),i&&localStorage.setItem(`chat_background_${i}`,e),W(!1),alert("èŠå¤©å£çº¸å·²ä¿å­˜ï¼")}catch(a){alert("å›¾ç‰‡å¤„ç†å¤±è´¥ï¼Œè¯·é‡è¯•"),W(!1)}}else alert("è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶")},className:"hidden"}),e.jsxs("div",{className:"px-4 py-4 flex items-center gap-3",children:[e.jsx("div",{className:"w-20 h-20 rounded-xl overflow-hidden border-2 border-gray-200 flex-shrink-0 flex items-center justify-center",style:{backgroundImage:R?`url(${R})`:"none",backgroundSize:"cover",backgroundPosition:"center",backgroundColor:R?"transparent":"#f5f7fa"},children:!R&&e.jsx(us,{size:32,className:"text-gray-400"})}),e.jsxs("div",{className:"flex-1 flex gap-2",children:[e.jsx("button",{onClick:()=>{var e;return null==(e=m.current)?void 0:e.click()},disabled:O,className:"flex-1 px-4 py-2.5 bg-wechat-primary text-white rounded-xl ios-button font-medium text-sm",children:O?"ä¸Šä¼ ä¸­...":R?"æ›´æ¢":"ä¸Šä¼ å£çº¸"}),R&&e.jsx("button",{onClick:()=>{U(""),i&&localStorage.removeItem(`chat_background_${i}`),alert("èŠå¤©å£çº¸å·²åˆ é™¤ï¼Œå°†ä½¿ç”¨å…¨å±€èƒŒæ™¯")},className:"px-4 py-2.5 glass-card text-gray-700 rounded-xl ios-button font-medium text-sm",children:"ç§»é™¤"})]})]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"px-4 py-2",children:[e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"çº¢åŒ… & è½¬è´¦å°é¢"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"è‡ªå®šä¹‰çº¢åŒ…å’Œè½¬è´¦çš„èƒŒæ™¯å›¾ç‰‡"})]}),e.jsx("div",{className:"glass-card rounded-2xl p-4",children:e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[e.jsxs("div",{children:[e.jsx("input",{ref:V,type:"file",accept:"image/*",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(!s)return;if(!s.type.startsWith("image/"))return void alert("è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶");if(s.size>2097152)return void alert("å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡2MB");const a=new FileReader;a.onloadend=()=>{const e=a.result;X(e),i&&localStorage.setItem(`red_envelope_cover_${i}`,e),alert("çº¢åŒ…å°é¢å·²ä¿å­˜ï¼")},a.onerror=()=>{alert("å›¾ç‰‡è¯»å–å¤±è´¥")},a.readAsDataURL(s)},className:"hidden"}),e.jsx("div",{className:"text-sm font-medium text-gray-900 mb-2",children:"çº¢åŒ…å°é¢"}),e.jsxs("div",{onClick:()=>{var e;return null==(e=V.current)?void 0:e.click()},className:"relative w-full aspect-square rounded-xl overflow-hidden border-2 border-red-200 flex items-center justify-center bg-gradient-to-br from-red-500 to-orange-500 cursor-pointer hover:opacity-90 transition-opacity group",style:{backgroundImage:q?`url(${q})`:"none",backgroundSize:"cover",backgroundPosition:"center"},children:[!q&&e.jsx("span",{className:"text-5xl",children:"ðŸ§§"}),q&&e.jsx("button",{onClick:e=>{e.stopPropagation(),X(""),i&&localStorage.removeItem(`red_envelope_cover_${i}`),alert("çº¢åŒ…å°é¢å·²åˆ é™¤")},className:"absolute top-2 right-2 w-6 h-6 bg-black/50 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity text-xs",children:"Ã—"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/50 to-transparent p-2 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsxs("p",{className:"text-white text-xs text-center",children:["ç‚¹å‡»",q?"æ›´æ¢":"ä¸Šä¼ "]})})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-1 text-center",children:"è‡ªå®šä¹‰çº¢åŒ…çš„èƒŒæ™¯å›¾ç‰‡"})]}),e.jsxs("div",{children:[e.jsx("input",{ref:J,type:"file",accept:"image/*",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(!s)return;if(!s.type.startsWith("image/"))return void alert("è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶");if(s.size>1048576)return void alert("å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡1MB");const a=new FileReader;a.onloadend=()=>{const e=a.result;Q(e),i&&localStorage.setItem(`red_envelope_icon_${i}`,e),alert("çº¢åŒ…å›¾æ ‡å·²ä¿å­˜ï¼")},a.onerror=()=>{alert("å›¾ç‰‡è¯»å–å¤±è´¥")},a.readAsDataURL(s)},className:"hidden"}),e.jsx("div",{className:"text-sm font-medium text-gray-900 mb-2",children:"çº¢åŒ…å›¾æ ‡"}),e.jsxs("div",{onClick:()=>{var e;return null==(e=J.current)?void 0:e.click()},className:"relative w-full aspect-square rounded-xl overflow-hidden border-2 border-red-300 flex items-center justify-center bg-red-500 cursor-pointer hover:opacity-90 transition-opacity group",style:{backgroundImage:Z?`url(${Z})`:"none",backgroundSize:"cover",backgroundPosition:"center"},children:[!Z&&e.jsx("span",{className:"text-5xl text-white font-bold",children:"é¢†"}),Z&&e.jsx("button",{onClick:e=>{e.stopPropagation(),Q(""),i&&localStorage.removeItem(`red_envelope_icon_${i}`),alert("çº¢åŒ…å›¾æ ‡å·²åˆ é™¤")},className:"absolute top-2 right-2 w-6 h-6 bg-black/50 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity text-xs",children:"Ã—"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/50 to-transparent p-2 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsxs("p",{className:"text-white text-xs text-center",children:["ç‚¹å‡»",Z?"æ›´æ¢":"ä¸Šä¼ "]})})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-1 text-center",children:"çº¢åŒ…å¡ç‰‡ä¸Šçš„â€œé¢†â€å­—å›¾æ ‡"})]}),e.jsxs("div",{children:[e.jsx("input",{ref:H,type:"file",accept:"image/*",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(!s)return;if(!s.type.startsWith("image/"))return void alert("è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶");if(s.size>2097152)return void alert("å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡2MB");const a=new FileReader;a.onloadend=()=>{const e=a.result;ee(e),i&&localStorage.setItem(`transfer_cover_${i}`,e),alert("è½¬è´¦å°é¢å·²ä¿å­˜ï¼")},a.onerror=()=>{alert("å›¾ç‰‡è¯»å–å¤±è´¥")},a.readAsDataURL(s)},className:"hidden"}),e.jsx("div",{className:"text-sm font-medium text-gray-900 mb-2",children:"è½¬è´¦å°é¢"}),e.jsxs("div",{onClick:()=>{var e;return null==(e=H.current)?void 0:e.click()},className:"relative w-full aspect-square rounded-xl overflow-hidden border-2 border-orange-200 flex items-center justify-center bg-gradient-to-br from-orange-400 to-yellow-400 cursor-pointer hover:opacity-90 transition-opacity group",style:{backgroundImage:Y?`url(${Y})`:"none",backgroundSize:"cover",backgroundPosition:"center"},children:[!Y&&e.jsx("span",{className:"text-5xl",children:"ðŸ’°"}),Y&&e.jsx("button",{onClick:e=>{e.stopPropagation(),ee(""),i&&localStorage.removeItem(`transfer_cover_${i}`),alert("è½¬è´¦å°é¢å·²åˆ é™¤")},className:"absolute top-2 right-2 w-6 h-6 bg-black/50 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity text-xs",children:"Ã—"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/50 to-transparent p-2 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsxs("p",{className:"text-white text-xs text-center",children:["ç‚¹å‡»",Y?"æ›´æ¢":"ä¸Šä¼ "]})})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-1 text-center",children:"è‡ªå®šä¹‰è½¬è´¦çš„èƒŒæ™¯å›¾ç‰‡"})]}),e.jsxs("div",{children:[e.jsx("input",{ref:G,type:"file",accept:"image/*",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(!s)return;if(!s.type.startsWith("image/"))return void alert("è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶");if(s.size>1048576)return void alert("å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡1MB");const a=new FileReader;a.onloadend=()=>{const e=a.result;se(e),i&&localStorage.setItem(`transfer_icon_${i}`,e),alert("è½¬è´¦å›¾æ ‡å·²ä¿å­˜ï¼")},a.onerror=()=>{alert("å›¾ç‰‡è¯»å–å¤±è´¥")},a.readAsDataURL(s)},className:"hidden"}),e.jsx("div",{className:"text-sm font-medium text-gray-900 mb-2",children:"è½¬è´¦å›¾æ ‡"}),e.jsxs("div",{onClick:()=>{var e;return null==(e=G.current)?void 0:e.click()},className:"relative w-full aspect-square rounded-xl overflow-hidden border-2 border-orange-300 flex items-center justify-center bg-orange-500 cursor-pointer hover:opacity-90 transition-opacity group",style:{backgroundImage:te?`url(${te})`:"none",backgroundSize:"cover",backgroundPosition:"center"},children:[!te&&e.jsx("span",{className:"text-5xl text-white font-bold",children:"Â¥"}),te&&e.jsx("button",{onClick:e=>{e.stopPropagation(),se(""),i&&localStorage.removeItem(`transfer_icon_${i}`),alert("è½¬è´¦å›¾æ ‡å·²åˆ é™¤")},className:"absolute top-2 right-2 w-6 h-6 bg-black/50 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity text-xs",children:"Ã—"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/50 to-transparent p-2 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsxs("p",{className:"text-white text-xs text-center",children:["ç‚¹å‡»",te?"æ›´æ¢":"ä¸Šä¼ "]})})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-1 text-center",children:"å¡ç‰‡å·¦ä¸Šè§’çš„åœ†å½¢å›¾æ ‡"})]})]})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"px-4 py-2",children:[e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"æ—ç™½åŠŸèƒ½"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"AIä¼šç”¨æ—ç™½æè¿°åŠ¨ä½œã€è¡¨æƒ…ã€çŽ¯å¢ƒç­‰"})]}),e.jsx("div",{className:"glass-card rounded-2xl overflow-hidden",children:e.jsxs("button",{onClick:()=>{const e=!p;f(e),i&&localStorage.setItem(`narrator_enabled_${i}`,String(e))},className:"w-full px-4 py-4 flex items-center justify-between ios-button",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium text-gray-900",children:"å¯ç”¨æ—ç™½"}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:p?"å·²å¼€å¯":"å·²å…³é—­"})]})}),e.jsx("div",{className:"w-12 h-7 rounded-full transition-all "+(p?"bg-wechat-primary":"bg-gray-300"),children:e.jsx("div",{className:"w-5 h-5 bg-white rounded-full mt-1 transition-all shadow-md "+(p?"ml-6":"ml-1")})})]})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"px-4 py-2",children:[e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"AIè®°å¿†é•¿åº¦"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"AIæ¯æ¬¡å›žå¤æ—¶è¯»å–çš„åŽ†å²æ¶ˆæ¯æ•°é‡ï¼ˆåŒ…å«é€šè¯è®°å½•ï¼‰"})]}),e.jsxs("div",{className:"glass-card rounded-2xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:"è¯»å–æ¶ˆæ¯æ•°"}),e.jsxs("span",{className:"text-lg font-semibold text-wechat-primary",children:[N," æ¡"]})]}),e.jsx("input",{type:"range",min:"5",max:"200",step:"5",value:N,onChange:e=>{return t=parseInt(e.target.value),w(t),void localStorage.setItem("ai_message_limit",String(t));var t},className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-wechat-primary"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-400 mt-2",children:[e.jsx("span",{children:"5æ¡"}),e.jsx("span",{children:"100æ¡"}),e.jsx("span",{children:"200æ¡"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-3",children:"ðŸ’¡ æç¤ºï¼šæ•°é‡è¶Šå¤§ï¼ŒAIè®°å¿†è¶Šå®Œæ•´ï¼Œä½†APIæ¶ˆè€—è¶Šå¤šã€‚å»ºè®®30-100æ¡ã€‚"})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"px-4 py-2",children:[e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"AIæœ‹å‹åœˆ"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"AIä¼šä¸»åŠ¨å‘å¸ƒæœ‹å‹åœˆï¼Œå¹¶ä¸Žä½ çš„æœ‹å‹åœˆäº’åŠ¨"})]}),e.jsx("div",{className:"glass-card rounded-2xl overflow-hidden",children:e.jsxs("button",{onClick:()=>{const e=!b;j(e),i&&localStorage.setItem(`ai_moments_enabled_${i}`,String(e))},className:"w-full px-4 py-4 flex items-center justify-between ios-button",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium text-gray-900",children:"å¯ç”¨AIæœ‹å‹åœˆ"}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:b?"å·²å¼€å¯ - AIä¼šä¸»åŠ¨å‘å¸ƒå’Œäº’åŠ¨":"å·²å…³é—­"})]})}),e.jsx("div",{className:"w-12 h-7 rounded-full transition-all "+(b?"bg-wechat-primary":"bg-gray-300"),children:e.jsx("div",{className:"w-5 h-5 bg-white rounded-full mt-1 transition-all shadow-md "+(b?"ml-6":"ml-1")})})]})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"px-4 py-2",children:[e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"AIä¸»åŠ¨å‘æ¶ˆæ¯"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"AIä¼šåƒçœŸäººä¸€æ ·ä¸»åŠ¨å‘æ¶ˆæ¯ç»™ä½ "})]}),e.jsx("div",{className:"glass-card rounded-2xl overflow-hidden",children:e.jsxs("button",{onClick:()=>{const e=!v;y(e),i&&(localStorage.setItem(`ai_proactive_enabled_${i}`,String(e)),window.dispatchEvent(new Event("storage")))},className:"w-full px-4 py-4 flex items-center justify-between ios-button",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium text-gray-900",children:"å¯ç”¨ä¸»åŠ¨å‘æ¶ˆæ¯"}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:v?"å·²å¼€å¯ - AIä¼šä¸»åŠ¨æ‰¾ä½ èŠå¤©":"å·²å…³é—­"})]})}),e.jsx("div",{className:"w-12 h-7 rounded-full transition-all "+(v?"bg-wechat-primary":"bg-gray-300"),children:e.jsx("div",{className:"w-5 h-5 bg-white rounded-full mt-1 transition-all shadow-md "+(v?"ml-6":"ml-1")})})]})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"px-4 py-2",children:[e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"èŠå¤©æ°”æ³¡"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"è‡ªå®šä¹‰æ­¤èŠå¤©çš„æ°”æ³¡æ ·å¼ï¼Œä¼˜å…ˆäºŽå…¨å±€è®¾ç½®"})]}),e.jsx("div",{className:"glass-card rounded-2xl overflow-hidden",children:e.jsxs("button",{onClick:()=>D(!0),className:"w-full px-4 py-4 flex items-center justify-between ios-button",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium text-gray-900",children:"æ°”æ³¡æ ·å¼"}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:S||_?"å·²è‡ªå®šä¹‰":"ä½¿ç”¨å…¨å±€è®¾ç½®"})]})}),e.jsx("span",{className:"text-gray-400 text-xl",children:"â€º"})]})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"px-4 py-2",children:[e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"é»‘åå•"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"æ‹‰é»‘åŽï¼Œå¯¹æ–¹çš„æ¶ˆæ¯ä¼šæ˜¾ç¤ºè­¦å‘Šå›¾æ ‡ï¼ŒAIä¼šæ„è¯†åˆ°è¢«æ‹‰é»‘"})]}),e.jsxs("div",{className:"glass-card rounded-2xl overflow-hidden",children:[e.jsx("button",{onClick:()=>{if(!i||!h)return;K.blockUser(i,"user");const e=JSON.parse(localStorage.getItem(`chat_messages_${i}`)||"[]"),t={id:Date.now(),type:"system",content:`${h.name} å·²å°†ä½ åŠ å…¥é»‘åå•`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now()};e.push(t),localStorage.setItem(`chat_messages_${i}`,JSON.stringify(e)),alert(`ðŸ§ª æµ‹è¯•åŠŸèƒ½ï¼šå·²æ¨¡æ‹Ÿ ${h.name} æ‹‰é»‘ä½ \n\nâœ… æ‹‰é»‘æ—¶é—´æˆ³ï¼š${Date.now()}\nâœ… å·²æ·»åŠ ç³»ç»Ÿæ¶ˆæ¯\n\nçŽ°åœ¨è¿”å›žèŠå¤©å‘æ¶ˆæ¯ä¼šæ˜¾ç¤ºçº¢è‰²æ„Ÿå¹å·âš ï¸`),l(`/chat/${i}`)},className:"w-full px-4 py-3 flex items-center justify-between ios-button text-left border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:"ðŸ§ª"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium text-gray-900",children:"æ¨¡æ‹ŸAIæ‹‰é»‘æˆ‘"}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:"æµ‹è¯•è¢«æ‹‰é»‘åŽçš„æ•ˆæžœ"})]})]})}),e.jsxs("button",{onClick:()=>{if(!i||!h)return;const e=K.toggleBlock("user",i);F(e),e?alert(`å·²å°† ${h.name} åŠ å…¥é»‘åå•\n\nTAå‘é€çš„æ¶ˆæ¯å°†æ˜¾ç¤ºè­¦å‘Šå›¾æ ‡âš ï¸\nAIä¼šæ„è¯†åˆ°è¢«æ‹‰é»‘`):alert(`å·²å°† ${h.name} ç§»å‡ºé»‘åå•`)},className:"w-full px-4 py-4 flex items-center justify-between ios-button",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 flex items-center justify-center",children:e.jsx("img",{src:P?"/æ‹‰é»‘.webp":"/æ²¡æœ‰æ‹‰é»‘.webp",alt:P?"å·²æ‹‰é»‘":"æœªæ‹‰é»‘",className:"w-8 h-8 object-contain"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium text-gray-900",children:P?"å·²æ‹‰é»‘":"æœªæ‹‰é»‘"}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:P?"TAçš„æ¶ˆæ¯ä¼šæ˜¾ç¤ºè­¦å‘Šå›¾æ ‡":"æ­£å¸¸èŠå¤©çŠ¶æ€"})]})]}),e.jsx("div",{className:"w-12 h-7 rounded-full transition-all "+(P?"bg-red-500":"bg-gray-300"),children:e.jsx("div",{className:"w-5 h-5 bg-white rounded-full mt-1 transition-all shadow-md "+(P?"ml-6":"ml-1")})})]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"px-4 py-2",children:[e.jsx("span",{className:"text-sm text-red-600 font-medium",children:"å±é™©æ“ä½œ"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"ä»¥ä¸‹æ“ä½œä¸å¯æ¢å¤ï¼Œè¯·è°¨æ…Žæ“ä½œ"})]}),e.jsx("div",{className:"glass-card rounded-2xl overflow-hidden",children:e.jsxs("button",{onClick:()=>{confirm(`ç¡®å®šè¦æ¸…é™¤ä¸Ž ${h.name} çš„æ‰€æœ‰èŠå¤©è®°å½•å—ï¼Ÿ\n\nå°†ä¼šæ¸…é™¤ï¼š\nâ€¢ æ‰€æœ‰èŠå¤©æ¶ˆæ¯\nâ€¢ TAçš„æ—¥è®°\nâ€¢ AIè®°å¿†\nâ€¢ è®°å¿†æ€»ç»“\nâ€¢ ç»­ç«èŠ±è®°å½•\n\næ­¤æ“ä½œä¸å¯æ¢å¤ï¼`)&&confirm("å†æ¬¡ç¡®è®¤ï¼šçœŸçš„è¦æ¸…é™¤æ‰€æœ‰æ•°æ®å—ï¼Ÿ")&&(localStorage.removeItem(`chat_messages_${i}`),localStorage.removeItem(`diaries_${i}`),localStorage.removeItem(`memories_${i}`),localStorage.removeItem(`memory_summary_${i}`),localStorage.removeItem(`initial_memories_extracted_${i}`),localStorage.removeItem(`streak_data_${i}`),localStorage.removeItem(`conversation_rounds_${i}`),alert("âœ… æ‰€æœ‰èŠå¤©è®°å½•å·²æ¸…é™¤ï¼"),l(`/chat/${i}`))},className:"w-full px-4 py-4 flex items-center justify-between ios-button hover:bg-red-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium text-red-600",children:"æ¸…é™¤èŠå¤©è®°å½•"}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:"åˆ é™¤æ‰€æœ‰æ¶ˆæ¯ã€æ—¥è®°ã€è®°å¿†ç­‰æ•°æ®"})]})]}),e.jsx("span",{className:"text-red-400 text-xl",children:"â€º"})]})})]})]}),T&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"glass-card rounded-3xl w-full max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 glass-effect px-6 py-4 border-b border-gray-200/50 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"èŠå¤©æ°”æ³¡è®¾ç½®"}),e.jsx("button",{onClick:()=>D(!1),className:"text-gray-500 hover:text-gray-700 text-2xl",children:"Ã—"})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4 p-4 bg-blue-50 rounded-xl border-2 border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-lg",children:"âœ¨"}),e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"å¿«é€Ÿå¯¼å…¥ CSS"})]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:["å¯ä»¥ä¸€æ¬¡æ€§ç²˜è´´æ•´æ®µ CSS ä»£ç ï¼Œæ”¯æŒå®Œæ•´çš„ CSS è¯­æ³•ï¼ˆé€‰æ‹©å™¨ã€ä¼ªå…ƒç´ ã€åŠ¨ç”»ç­‰ï¼‰ã€‚",e.jsx("br",{}),e.jsx("strong",{children:"âš¡ é‡è¦ï¼š"}),"æ‰€æœ‰ CSS å±žæ€§éƒ½éœ€è¦åŠ  ",e.jsx("code",{className:"bg-white px-1 rounded",children:"!important"})," æ‰èƒ½è¦†ç›–é»˜è®¤æ ·å¼ã€‚",e.jsx("br",{}),e.jsx("strong",{children:"ðŸ’¡ æç¤ºï¼š"}),'ç²˜è´´åŽç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¯¼å…¥ï¼Œç„¶åŽç‚¹å‡»åº•éƒ¨"ä¿å­˜è®¾ç½®"ã€‚']}),e.jsx("textarea",{value:E,onChange:e=>B(e.target.value),className:"w-full h-48 px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-xs resize-none",placeholder:"ç²˜è´´ä½ çš„ CSS ä»£ç ï¼Œä¾‹å¦‚ï¼š\n\n.message-container.sent .message-bubble {\n  background-color: #522f1c !important;\n  border: 4px solid #B8EFED !important;\n}\n\n.message-container.received .message-bubble {\n  background-color: #B8EFED !important;\n  border: 4px solid #522f1c !important;\n}"}),e.jsx("button",{onClick:()=>{if(E.trim())try{const e=E.trim();L(e),A(e),alert("âœ… CSS å·²å¯¼å…¥ï¼\n\nåŒ…å«çš„æ ·å¼å°†è‡ªåŠ¨åº”ç”¨åˆ°æ°”æ³¡ä¸Šã€‚\næ”¯æŒä¼ªå…ƒç´ ï¼ˆ::before, ::afterï¼‰å’Œæ‰€æœ‰ CSS å±žæ€§ã€‚")}catch(e){alert("CSS è§£æžå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ ¼å¼")}else alert("è¯·è¾“å…¥ CSS ä»£ç ")},className:"w-full px-4 py-3 bg-blue-500 text-white rounded-xl ios-button font-medium hover:bg-blue-600 transition-colors",children:"ðŸ” è‡ªåŠ¨è¯†åˆ«å¹¶åº”ç”¨"})]}),e.jsx("div",{className:"border-t border-gray-200 relative",children:e.jsx("span",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 bg-white px-3 text-sm text-gray-500",children:"æˆ–æ‰‹åŠ¨è®¾ç½®"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"æˆ‘çš„æ°”æ³¡ï¼ˆå‘é€ï¼‰"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"æ°”æ³¡é¢œè‰²ï¼ˆç•™ç©ºä½¿ç”¨å…¨å±€è®¾ç½®ï¼‰"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"color",value:S||"#95EC69",onChange:e=>I(e.target.value),className:"w-16 h-10 rounded-lg border border-gray-300 cursor-pointer"}),e.jsx("input",{type:"text",value:S,onChange:e=>I(e.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-wechat-primary",placeholder:"ç•™ç©ºä½¿ç”¨å…¨å±€è®¾ç½®"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"è‡ªå®šä¹‰CSSï¼ˆé«˜çº§ï¼‰"}),e.jsx("textarea",{value:z,onChange:e=>L(e.target.value),className:"w-full h-32 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-wechat-primary font-mono text-sm resize-none",placeholder:"ä¾‹å¦‚ï¼š\nbackground: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\nborder-radius: 16px;"})]}),e.jsx("div",{children:e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-xs text-yellow-800",children:["ðŸ’¡ ",e.jsx("strong",{children:"é¢„è§ˆæç¤ºï¼š"}),"å®Œæ•´çš„ CSSï¼ˆåŒ…å«é€‰æ‹©å™¨å’Œä¼ªå…ƒç´ ï¼‰æ— æ³•åœ¨æ­¤é¢„è§ˆï¼Œè¯·ä¿å­˜åŽåœ¨èŠå¤©é¡µé¢æŸ¥çœ‹å®žé™…æ•ˆæžœã€‚"]})})})]}),e.jsx("div",{className:"border-t border-gray-200"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"å¯¹æ–¹æ°”æ³¡ï¼ˆæŽ¥æ”¶ï¼‰"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"æ°”æ³¡é¢œè‰²ï¼ˆç•™ç©ºä½¿ç”¨å…¨å±€è®¾ç½®ï¼‰"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"color",value:_||"#FFFFFF",onChange:e=>M(e.target.value),className:"w-16 h-10 rounded-lg border border-gray-300 cursor-pointer"}),e.jsx("input",{type:"text",value:_,onChange:e=>M(e.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-wechat-primary",placeholder:"ç•™ç©ºä½¿ç”¨å…¨å±€è®¾ç½®"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"è‡ªå®šä¹‰CSSï¼ˆé«˜çº§ï¼‰"}),e.jsx("textarea",{value:$,onChange:e=>A(e.target.value),className:"w-full h-32 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-wechat-primary font-mono text-sm resize-none",placeholder:"ä¾‹å¦‚ï¼š\nbackground: #FFFFFF;\nborder: 1px solid #E5E5E5;"})]}),e.jsx("div",{children:e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-xs text-yellow-800",children:["ðŸ’¡ ",e.jsx("strong",{children:"é¢„è§ˆæç¤ºï¼š"}),"å®Œæ•´çš„ CSSï¼ˆåŒ…å«é€‰æ‹©å™¨å’Œä¼ªå…ƒç´ ï¼‰æ— æ³•åœ¨æ­¤é¢„è§ˆï¼Œè¯·ä¿å­˜åŽåœ¨èŠå¤©é¡µé¢æŸ¥çœ‹å®žé™…æ•ˆæžœã€‚"]})})})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:()=>{confirm("ç¡®å®šè¦é‡ç½®ä¸ºå…¨å±€æ°”æ³¡è®¾ç½®å—ï¼Ÿ")&&(I(""),M(""),L(""),A(""),i&&(localStorage.removeItem(`user_bubble_color_${i}`),localStorage.removeItem(`ai_bubble_color_${i}`),localStorage.removeItem(`user_bubble_css_${i}`),localStorage.removeItem(`ai_bubble_css_${i}`)),alert("å·²é‡ç½®ä¸ºå…¨å±€æ°”æ³¡è®¾ç½®ï¼"))},className:"flex-1 px-4 py-3 bg-gray-100 text-gray-700 rounded-xl ios-button font-medium",children:"é‡ç½®ä¸ºå…¨å±€"}),e.jsx("button",{onClick:()=>{i&&(localStorage.setItem(`user_bubble_color_${i}`,S),localStorage.setItem(`ai_bubble_color_${i}`,_),localStorage.setItem(`user_bubble_css_${i}`,z),localStorage.setItem(`ai_bubble_css_${i}`,$),alert("æ°”æ³¡è®¾ç½®å·²ä¿å­˜ï¼"),D(!1))},className:"flex-1 px-4 py-3 bg-wechat-primary text-white rounded-xl ios-button font-medium",children:"ä¿å­˜è®¾ç½®"})]})]})]})})]}):e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx("p",{className:"text-gray-500",children:"è§’è‰²ä¸å­˜åœ¨"})})}},Symbol.toStringTag,{value:"Module"})),ar=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{addCharacter:r}=n(),{showStatusBar:l}=o(),i=t.useRef(null),c=t.useRef(null),[d,x]=t.useState({name:"",nickname:"",username:"",avatar:"",signature:"",description:"",userInfo:"",personality:"",scenario:"",firstMessage:"",exampleMessages:"",systemPrompt:"",alternateGreetings:[],characterBook:void 0,tags:[],creator:"",onlineGreeting:"",offlineGreetings:[]}),[m,h]=t.useState(""),[u,g]=t.useState(!1),[p,f]=t.useState(!1),[b,j]=t.useState(null),[v,y]=t.useState("");return e.jsxs("div",{className:"h-full flex flex-col bg-gray-50",children:[e.jsxs("div",{className:"glass-effect sticky top-0 z-50",children:[l&&e.jsx(ua,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a(-1),className:"ios-button text-gray-700 hover:text-gray-900",children:"å–æ¶ˆ"}),e.jsx("h1",{className:"text-base font-semibold text-gray-900",children:"åˆ›å»ºè§’è‰²"}),e.jsx("button",{onClick:()=>{if(!d.name.trim())return void alert("è¯·è¾“å…¥è§’è‰²åå­—");const e=d.username||`wxid_${we(d.name)||Date.now().toString().slice(-6)}`,t=d.avatar||"ðŸ¤–";try{const l={name:d.name,username:e,avatar:t,signature:d.signature||"è¿™ä¸ªäººå¾ˆæ‡’ï¼Œä»€ä¹ˆéƒ½æ²¡ç•™ä¸‹",description:d.description,personality:d.personality||void 0,scenario:d.scenario||void 0,firstMessage:d.firstMessage||void 0,exampleMessages:d.exampleMessages||void 0,systemPrompt:d.systemPrompt||void 0,alternateGreetings:d.alternateGreetings.length>0?d.alternateGreetings:void 0,characterBook:d.characterBook,tags:d.tags.length>0?d.tags:void 0,creator:d.creator||void 0,onlineGreeting:d.onlineGreeting||void 0,offlineGreetings:d.offlineGreetings.length>0?d.offlineGreetings:void 0};let n=0;try{n=JSON.stringify(l).length}catch(s){throw new Error("è§’è‰²æ•°æ®åŒ…å«æ— æ³•åºåˆ—åŒ–çš„å†…å®¹")}if(n>5242880)throw new Error("è§’è‰²æ•°æ®è¿‡å¤§ï¼ˆè¶…è¿‡5MBï¼‰ï¼Œè¯·å‡å°‘å†…å®¹æˆ–ç§»é™¤ä¸–ç•Œä¹¦");const i=r(l),c=sessionStorage.getItem("pending_character_avatar_description"),o=sessionStorage.getItem("pending_character_avatar_fingerprint");if(c&&(null==i?void 0:i.id)&&(localStorage.setItem(`character_avatar_description_${i.id}`,c),localStorage.setItem(`character_avatar_recognized_at_${i.id}`,Date.now().toString()),o&&localStorage.setItem(`character_avatar_fingerprint_${i.id}`,o),sessionStorage.removeItem("pending_character_avatar_description"),sessionStorage.removeItem("pending_character_avatar_fingerprint")),b&&i){const e=me.getLorebook(b);if(e){const t=[...e.character_ids,i.id];me.updateLorebook(b,{character_ids:t})}}setTimeout(()=>{a("/wechat/contacts")},100)}catch(l){l.message?alert(`åˆ›å»ºå¤±è´¥ï¼š${l.message}`):"QuotaExceededError"===l.name?alert("å­˜å‚¨ç©ºé—´ä¸è¶³ï¼è¯·åˆ°è®¾ç½®ä¸­æ¸…ç†ç¼“å­˜ã€‚"):alert("åˆ›å»ºå¤±è´¥ï¼è¯·æŸ¥çœ‹æŽ§åˆ¶å°äº†è§£è¯¦æƒ…ã€‚")}},className:"ios-button text-primary font-medium",children:"å®Œæˆ"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-3 pt-3",children:[e.jsxs("div",{className:"mb-3 px-1",children:[e.jsx("input",{ref:c,type:"file",accept:".png",onChange:async e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(s)if(s.type.includes("png")){f(!0);try{const e=await ke(s);if(!e)throw new Error("æ— æ³•è§£æž Character Card æ•°æ®");const t=new FileReader;t.onloadend=()=>{const s=t.result,a=Ce(e,s);a.characterBook,x({name:a.name,nickname:"",username:a.username,avatar:a.avatar,signature:a.signature,description:a.description,userInfo:a.userInfo||"",personality:a.personality||"",scenario:a.scenario||"",firstMessage:a.firstMessage||"",exampleMessages:a.exampleMessages||"",systemPrompt:a.systemPrompt||"",alternateGreetings:a.alternateGreetings||[],characterBook:a.characterBook,tags:a.tags||[],creator:a.creator||"",onlineGreeting:"",offlineGreetings:a.offlineGreetings||[]}),h(s),y(""),f(!1);let r=!1;if(a.characterBook&&a.characterBook.entries&&a.characterBook.entries.length>0){const e=a.characterBook.entries.length;if(confirm(`æ£€æµ‹åˆ°è§’è‰²å¡åŒ…å«ä¸–ç•Œä¹¦ï¼ˆ${e} ä¸ªæ¡ç›®ï¼‰\n\næ˜¯å¦åŒæ—¶å¯¼å…¥åˆ°ä¸–ç•Œä¹¦ç³»ç»Ÿï¼Ÿ\n\nâ€¢ ç‚¹å‡»"ç¡®å®š"ï¼šå¯¼å…¥ä¸–ç•Œä¹¦å¹¶å…³è”åˆ°è¯¥è§’è‰²\nâ€¢ ç‚¹å‡»"å–æ¶ˆ"ï¼šä»…ä¿å­˜åœ¨è§’è‰²æ•°æ®ä¸­`))try{const e={name:`${a.name}çš„ä¸–ç•Œä¹¦`,description:"ä»Ž Character Card å¯¼å…¥çš„ä¸–ç•Œä¹¦",entries:a.characterBook.entries||[],scan_depth:a.characterBook.scan_depth||10,token_budget:a.characterBook.token_budget||2e3,recursive_scanning:a.characterBook.recursive_scanning||!1,is_global:!1,character_ids:[]},t=me.importLorebook(JSON.stringify(e));t&&(r=!0,j(t.id))}catch(i){alert("ä¸–ç•Œä¹¦å¯¼å…¥å¤±è´¥ï¼Œä½†è§’è‰²æ•°æ®å·²ä¿ç•™")}}const l="chara_card_v2"===e.spec?"V2":"V1",n=r?"\nâœ… ä¸–ç•Œä¹¦å·²å¯¼å…¥":"";alert(`âœ… æˆåŠŸå¯¼å…¥ Character Card ${l}!\n\nè§’è‰²å: ${a.name}\nåˆ›å»ºè€…: ${a.creator||"æœªçŸ¥"}${n}`)},t.onerror=()=>{alert("å›¾ç‰‡è¯»å–å¤±è´¥"),f(!1)},t.readAsDataURL(s)}catch(a){alert(`å¯¼å…¥å¤±è´¥: ${a.message||"æœªçŸ¥é”™è¯¯"}`),f(!1)}e.target.value=""}else alert("è¯·é€‰æ‹© PNG æ ¼å¼çš„ Character Card æ–‡ä»¶")},className:"hidden"}),e.jsx("button",{onClick:()=>{var e;return null==(e=c.current)?void 0:e.click()},disabled:p,className:"glass-card rounded-xl px-4 py-3 flex items-center gap-3 ios-button w-full hover:bg-white/50 transition-all",children:p?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-gray-400 border-t-transparent"}),e.jsx("div",{className:"text-left",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:"æ­£åœ¨å¯¼å…¥..."})})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),e.jsxs("div",{className:"text-left flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:"å¯¼å…¥ Character Card"}),e.jsx("div",{className:"text-xs text-gray-500",children:"PNG æ ¼å¼ (V1/V2)"})]})]})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"px-4 py-2",children:[e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"è§’è‰²å¤´åƒ"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"å¯é€‰ï¼Œä¸ä¸Šä¼ å°†ä½¿ç”¨é»˜è®¤å¤´åƒã€‚æ”¯æŒ JPGã€PNGã€GIF ç­‰æ ¼å¼"})]}),e.jsxs("div",{className:"glass-card rounded-2xl p-6 flex justify-center",children:[e.jsx("input",{ref:i,type:"file",accept:"image/*",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(!s)return;if(!s.type.startsWith("image/"))return void alert("è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶");g(!0);const a=new FileReader;a.onloadend=async()=>{const e=a.result;h(e),x({...d,avatar:e});try{const t=await fetch("/.netlify/functions/vision",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:e,prompt:"è¯¦ç»†æè¿°è¿™ä¸ªå¤´åƒçš„å†…å®¹ï¼ŒåŒ…æ‹¬ï¼šè§’è‰²ç‰¹å¾ã€é£Žæ ¼ã€é¢œè‰²ã€è¡¨æƒ…ã€æ°›å›´ç­‰ã€‚è¯·ç”¨ç®€æ´çš„è¯­è¨€æè¿°ã€‚"})});if(t.ok){const s=await t.json(),a=s.description||s.result;sessionStorage.setItem("pending_character_avatar_description",a),sessionStorage.setItem("pending_character_avatar_fingerprint",e.substring(0,200))}}catch(t){}g(!1)},a.onerror=()=>{alert("å›¾ç‰‡è¯»å–å¤±è´¥"),g(!1)},a.readAsDataURL(s)},className:"hidden"}),e.jsx("button",{onClick:()=>{var e;return null==(e=i.current)?void 0:e.click()},disabled:u,className:"relative w-32 h-32 rounded-2xl bg-gray-100 border-2 border-dashed border-gray-300 flex flex-col items-center justify-center ios-button overflow-hidden",children:m?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:m,alt:"å¤´åƒé¢„è§ˆ",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-20 transition-all flex items-center justify-center",children:e.jsx("span",{className:"text-white opacity-0 hover:opacity-100 text-sm",children:"ç‚¹å‡»æ›´æ¢"})})]}):e.jsx(e.Fragment,{children:u?e.jsx("div",{className:"text-gray-400",children:"ä¸Šä¼ ä¸­..."}):e.jsxs(e.Fragment,{children:[e.jsx(us,{size:32,className:"text-gray-400 mb-2"}),e.jsx("span",{className:"text-sm text-gray-500",children:"ä¸Šä¼ å¤´åƒ"})]})})})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"è§’è‰²ä¿¡æ¯"})}),e.jsxs("div",{className:"glass-card rounded-2xl",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"çœŸå®žåå­— *"}),e.jsx("input",{type:"text",value:d.name,onChange:e=>{return t=e.target.value,void x(e=>{if((!e.username||e.username.startsWith("wxid_"))&&t){const s=we(t);return{...e,name:t,username:`wxid_${s||Date.now().toString().slice(-6)}`}}return{...e,name:t}});var t},placeholder:"è¯·è¾“å…¥è§’è‰²çœŸå®žåå­—",maxLength:20,className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})]}),e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsxs("label",{className:"block text-xs text-gray-500 mb-1",children:["ç½‘å",e.jsx("span",{className:"text-gray-400 ml-2",children:"ï¼ˆç•™ç©ºåˆ™æ˜¾ç¤ºçœŸå®žåå­—ï¼‰"})]}),e.jsx("input",{type:"text",value:d.nickname,onChange:e=>x({...d,nickname:e.target.value}),placeholder:"è§’è‰²çš„ç½‘åï¼ŒAIå¯è‡ªä¸»ä¿®æ”¹",maxLength:20,className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})]}),e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsxs("label",{className:"block text-xs text-gray-500 mb-1",children:["è§’è‰²IDè´¦å·",e.jsx("span",{className:"text-gray-400 ml-2",children:"ï¼ˆç•™ç©ºè‡ªåŠ¨ç”Ÿæˆï¼‰"})]}),e.jsx("input",{type:"text",value:d.username,onChange:e=>x({...d,username:e.target.value}),placeholder:`wxid_${we(d.name)||"auto"}`,className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})]}),e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"ä¸ªæ€§ç­¾å"}),e.jsx("textarea",{value:d.signature,onChange:e=>x({...d,signature:e.target.value}),placeholder:"æ˜¾ç¤ºåœ¨ç”¨æˆ·èµ„æ–™çš„ä¸ªæ€§ç­¾å",maxLength:100,className:"w-full h-16 bg-transparent border-none outline-none text-gray-900 placeholder-gray-400 resize-none"}),e.jsxs("div",{className:"text-right text-xs text-gray-400 mt-1",children:[d.signature.length,"/100"]})]}),e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"çº¿ä¸Šå¼€åœºç™½ ðŸ’¬"}),e.jsx("textarea",{value:d.onlineGreeting,onChange:e=>x({...d,onlineGreeting:e.target.value}),placeholder:"AIåœ¨çº¿ä¸ŠèŠå¤©æ—¶çš„ç¬¬ä¸€å¥è¯ï¼ˆå¯é€‰ï¼Œä¸å¡«åˆ™AIè‡ªç”±å‘æŒ¥ï¼‰",maxLength:500,className:"w-full h-20 bg-transparent border-none outline-none text-gray-900 placeholder-gray-400 resize-none"}),e.jsxs("div",{className:"text-right text-xs text-gray-400 mt-1",children:[d.onlineGreeting.length,"/500"]})]}),e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsxs("label",{className:"block text-xs text-gray-500 mb-1",children:["çº¿ä¸‹å¼€åœºç™½ ðŸŽ­",d.offlineGreetings.length>0&&e.jsxs("span",{className:"text-gray-600 ml-2",children:["(",d.offlineGreetings.length," ä¸ª)"]})]}),e.jsx("div",{className:"text-xs text-gray-400 mb-2",children:"ç”¨äºŽçº¿ä¸‹è§é¢åº”ç”¨çš„å¼€åœºç™½ï¼ˆå¯æ‰‹åŠ¨æ·»åŠ ï¼Œæˆ–ä»ŽSTè§’è‰²å¡å¯¼å…¥ï¼‰"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("textarea",{value:v,onChange:e=>y(e.target.value),placeholder:"è¾“å…¥ä¸€ä¸ªæ–°çš„çº¿ä¸‹å¼€åœºç™½ï¼ˆæ”¯æŒHTMLï¼‰...",maxLength:5e4,className:"w-full h-32 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm text-gray-900 placeholder-gray-400 resize-none focus:outline-none focus:border-blue-400"}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsxs("span",{className:"text-xs text-gray-400",children:[v.length,"/50000"]}),e.jsx("button",{type:"button",onClick:()=>{v.trim()&&(x({...d,offlineGreetings:[...d.offlineGreetings,v.trim()]}),y(""))},className:"px-4 py-2 rounded-lg text-sm transition-colors "+(v.trim().length>0?"bg-blue-500 text-white hover:bg-blue-600 cursor-pointer":"bg-gray-300 text-gray-500 cursor-not-allowed"),disabled:0===v.trim().length,children:"+ æ·»åŠ å¼€åœºç™½"})]})]}),d.offlineGreetings.length>0?e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:d.offlineGreetings.map((t,s)=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 relative",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:["å¼€åœºç™½ ",s+1]}),e.jsxs("div",{className:"text-xs text-gray-400",children:[t.length," å­—ç¬¦"]})]}),e.jsx("div",{className:"text-sm text-gray-700 pr-8 whitespace-pre-wrap break-words max-h-32 overflow-y-auto",children:t}),e.jsx("button",{type:"button",onClick:()=>{const e=d.offlineGreetings.filter((e,t)=>t!==s);x({...d,offlineGreetings:e})},className:"absolute top-2 right-2 w-6 h-6 bg-red-500 text-white rounded-full text-xs hover:bg-red-600 transition-colors",children:"Ã—"})]},s))}):e.jsx("div",{className:"text-xs text-gray-400 italic text-center py-2",children:"æš‚æ— çº¿ä¸‹å¼€åœºç™½ï¼Œå¯æ‰‹åŠ¨æ·»åŠ æˆ–ä»ŽSTè§’è‰²å¡å¯¼å…¥"})]}),e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"AIè§’è‰²æè¿°ï¼ˆå…³äºŽTAè‡ªå·±ï¼‰"}),e.jsx("textarea",{value:d.description,onChange:e=>x({...d,description:e.target.value}),placeholder:"æè¿°AIè§’è‰²çš„èƒŒæ™¯ã€æ€§æ ¼ã€è¯´è¯é£Žæ ¼ç­‰ï¼Œç”¨äºŽAIè§’è‰²æ‰®æ¼”ï¼ˆå»ºè®®è¯¦ç»†æè¿°ï¼Œå­—æ•°è¶Šå¤šAIç†è§£è¶Šå‡†ç¡®ï¼‰",maxLength:5e3,className:"w-full h-48 bg-transparent border-none outline-none text-gray-900 placeholder-gray-400 resize-none"}),e.jsxs("div",{className:"text-right text-xs text-gray-400 mt-1",children:[d.description.length,"/5000"]})]}),e.jsxs("div",{className:"px-4 py-3",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"å…³äºŽå¯¹è¯è€…ï¼ˆå…³äºŽä½ ï¼‰"}),e.jsx("textarea",{value:d.userInfo,onChange:e=>x({...d,userInfo:e.target.value}),placeholder:"æè¿°å¯¹è¯è€…çš„ä¿¡æ¯ï¼šèº«ä»½ã€èŒä¸šã€ä½ ä»¬çš„å…³ç³»ç­‰ã€‚AIä¼šè®°ä½è¿™äº›ï¼Œä¸ä¼šé‡å¤è¯¢é—®ã€‚ä¾‹å¦‚ï¼šä½ æ˜¯æˆ‘çš„ç”·/å¥³æœ‹å‹ï¼Œæˆ‘ä»¬ç›¸æ‹2å¹´äº†ï¼Œæˆ‘æ˜¯ç¨‹åºå‘˜...",maxLength:2e3,className:"w-full h-32 bg-transparent border-none outline-none text-gray-900 placeholder-gray-400 resize-none"}),e.jsxs("div",{className:"text-right text-xs text-gray-400 mt-1",children:[d.userInfo.length,"/2000"]})]})]})]}),e.jsx("div",{className:"glass-card rounded-2xl p-4 mb-6",children:e.jsxs("div",{className:"text-xs text-gray-500 space-y-2",children:[e.jsxs("p",{children:["â€¢ ",e.jsx("strong",{children:"è§’è‰²åå­—ï¼š"}),"å¿…å¡«ï¼Œç”¨äºŽæ˜¾ç¤ºåœ¨å¾®ä¿¡ç•Œé¢ä¸­"]}),e.jsxs("p",{children:["â€¢ ",e.jsx("strong",{children:"è§’è‰²IDï¼š"}),"å¯é€‰ï¼Œä¸å¡«å†™ç³»ç»Ÿä¼šè‡ªåŠ¨æ ¹æ®åå­—æ‹¼éŸ³ç”Ÿæˆ"]}),e.jsxs("p",{children:["â€¢ ",e.jsx("strong",{children:"ä¸ªæ€§ç­¾åï¼š"}),"å¯é€‰ï¼Œæ˜¾ç¤ºåœ¨ç”¨æˆ·èµ„æ–™é¡µ"]}),e.jsxs("p",{children:["â€¢ ",e.jsx("strong",{children:"AIè§’è‰²æè¿°ï¼š"}),"å¯é€‰ï¼Œæè¿°AIçš„èƒŒæ™¯ã€æ€§æ ¼ã€è¯´è¯æ–¹å¼ç­‰"]}),e.jsxs("p",{children:["â€¢ ",e.jsx("strong",{children:"å…³äºŽå¯¹è¯è€…ï¼š"}),"å¯é€‰ä½†å¼ºçƒˆæŽ¨èï¼è®©AIçŸ¥é“ä½ æ˜¯è°ï¼Œé¿å…é‡å¤è¯¢é—®"]}),e.jsxs("p",{children:["â€¢ ",e.jsx("strong",{children:"å¤´åƒï¼š"}),"å¯é€‰ï¼Œä¸ä¸Šä¼ å°†ä½¿ç”¨é»˜è®¤æœºå™¨äººè¡¨æƒ…"]})]})})]})]})}},Symbol.toStringTag,{value:"Module"})),rr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{id:l}=r(),{getCharacter:i,updateCharacter:c}=n(),o=t.useRef(null),d=l?i(l):void 0,[x,m]=t.useState({name:(null==d?void 0:d.name)||"",nickname:(null==d?void 0:d.nickname)||"",username:(null==d?void 0:d.username)||"",avatar:(null==d?void 0:d.avatar)||"",signature:(null==d?void 0:d.signature)||"",description:(null==d?void 0:d.description)||"",onlineGreeting:(null==d?void 0:d.onlineGreeting)||"",offlineGreetings:(null==d?void 0:d.offlineGreetings)||[]}),[h,u]=t.useState((null==d?void 0:d.avatar)||""),[g,p]=t.useState(!1),[f,b]=t.useState("");if(t.useEffect(()=>{d&&(m({name:d.name,nickname:d.nickname||"",username:d.username,avatar:d.avatar,signature:d.signature,description:d.description,onlineGreeting:d.onlineGreeting||"",offlineGreetings:d.offlineGreetings||[]}),u(d.avatar))},[d]),!d)return e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx("p",{className:"text-gray-500",children:"è§’è‰²ä¸å­˜åœ¨"})});return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"glass-effect px-4 py-3 flex items-center justify-between border-b border-gray-200/50",children:[e.jsx("button",{onClick:()=>a(-1),className:"ios-button text-gray-700 hover:text-gray-900",children:"å–æ¶ˆ"}),e.jsx("h1",{className:"text-base font-semibold text-gray-900",children:"ç¼–è¾‘è§’è‰²"}),e.jsx("button",{onClick:()=>{if(!x.name.trim())return void alert("è¯·è¾“å…¥è§’è‰²åå­—");if(!x.avatar)return void alert("è¯·ä¸Šä¼ è§’è‰²å¤´åƒ");const e=x.username||`wxid_${we(x.name)||Date.now().toString().slice(-6)}`;c(d.id,{...x,username:e,signature:x.signature||"è¿™ä¸ªäººå¾ˆæ‡’ï¼Œä»€ä¹ˆéƒ½æ²¡ç•™ä¸‹",description:x.description}),a(`/character/${d.id}`)},className:"ios-button text-primary font-medium",children:"å®Œæˆ"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-3 pt-3",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"px-4 py-2",children:[e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"è§’è‰²å¤´åƒ"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"ç‚¹å‡»ä¸Šä¼ æœ¬åœ°å›¾ç‰‡ï¼Œæ”¯æŒ JPGã€PNGã€GIF æ ¼å¼ï¼Œå¤§å°ä¸è¶…è¿‡ 5MB"})]}),e.jsxs("div",{className:"glass-card rounded-2xl p-6 flex justify-center",children:[e.jsx("input",{ref:o,type:"file",accept:"image/*",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(!s)return;if(!s.type.startsWith("image/"))return void alert("è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶");if(s.size>5242880)return void alert("å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡5MB");p(!0);const a=new FileReader;a.onloadend=async()=>{const e=a.result;if(u(e),m({...x,avatar:e}),null==d?void 0:d.id)try{const t=await fetch("/.netlify/functions/vision",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:e,prompt:"è¯¦ç»†æè¿°è¿™ä¸ªå¤´åƒçš„å†…å®¹ï¼ŒåŒ…æ‹¬ï¼šè§’è‰²ç‰¹å¾ã€é£Žæ ¼ã€é¢œè‰²ã€è¡¨æƒ…ã€æ°›å›´ç­‰ã€‚è¯·ç”¨ç®€æ´çš„è¯­è¨€æè¿°ã€‚"})});if(t.ok){const s=await t.json(),a=s.description||s.result;localStorage.setItem(`character_avatar_description_${d.id}`,a),localStorage.setItem(`character_avatar_recognized_at_${d.id}`,Date.now().toString()),localStorage.setItem(`character_avatar_fingerprint_${d.id}`,e.substring(0,200))}}catch(t){}p(!1)},a.onerror=()=>{alert("å›¾ç‰‡è¯»å–å¤±è´¥"),p(!1)},a.readAsDataURL(s)},className:"hidden"}),e.jsx("button",{onClick:()=>{var e;return null==(e=o.current)?void 0:e.click()},disabled:g,className:"relative w-32 h-32 rounded-2xl bg-gray-100 border-2 border-dashed border-gray-300 flex flex-col items-center justify-center ios-button overflow-hidden",children:h?e.jsxs(e.Fragment,{children:[h.startsWith("data:image")?e.jsx("img",{src:h,alt:"å¤´åƒé¢„è§ˆ",className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-5xl",children:h}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-20 transition-all flex items-center justify-center",children:e.jsx("span",{className:"text-white opacity-0 hover:opacity-100 text-sm",children:"ç‚¹å‡»æ›´æ¢"})})]}):e.jsx(e.Fragment,{children:g?e.jsx("div",{className:"text-gray-400",children:"ä¸Šä¼ ä¸­..."}):e.jsxs(e.Fragment,{children:[e.jsx(us,{size:32,className:"text-gray-400 mb-2"}),e.jsx("span",{className:"text-sm text-gray-500",children:"ä¸Šä¼ å¤´åƒ"})]})})})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"è§’è‰²ä¿¡æ¯"})}),e.jsxs("div",{className:"glass-card rounded-2xl overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"çœŸå®žåå­— *"}),e.jsx("input",{type:"text",value:x.name,onChange:e=>{return t=e.target.value,void m(e=>{if((!e.username||e.username.startsWith("wxid_"))&&t){const s=we(t);return{...e,name:t,username:`wxid_${s||Date.now().toString().slice(-6)}`}}return{...e,name:t}});var t},placeholder:"è¯·è¾“å…¥è§’è‰²çœŸå®žåå­—",maxLength:20,className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})]}),e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsxs("label",{className:"block text-xs text-gray-500 mb-1",children:["ç½‘å",e.jsx("span",{className:"text-gray-400 ml-2",children:"ï¼ˆç•™ç©ºåˆ™æ˜¾ç¤ºçœŸå®žåå­—ï¼ŒAIå¯ä¿®æ”¹ï¼‰"})]}),e.jsx("input",{type:"text",value:x.nickname,onChange:e=>m({...x,nickname:e.target.value}),placeholder:"è§’è‰²çš„ç½‘å",maxLength:20,className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})]}),e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsxs("label",{className:"block text-xs text-gray-500 mb-1",children:["è§’è‰²IDè´¦å·",e.jsx("span",{className:"text-gray-400 ml-2",children:"ï¼ˆç•™ç©ºè‡ªåŠ¨ç”Ÿæˆï¼‰"})]}),e.jsx("input",{type:"text",value:x.username,onChange:e=>m({...x,username:e.target.value}),placeholder:`wxid_${we(x.name)||"auto"}`,className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})]}),e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"ä¸ªæ€§ç­¾å"}),e.jsx("textarea",{value:x.signature,onChange:e=>m({...x,signature:e.target.value}),placeholder:"æ˜¾ç¤ºåœ¨ç”¨æˆ·èµ„æ–™çš„ä¸ªæ€§ç­¾å",maxLength:100,className:"w-full h-16 bg-transparent border-none outline-none text-gray-900 placeholder-gray-400 resize-none"}),e.jsxs("div",{className:"text-right text-xs text-gray-400 mt-1",children:[(x.signature||"").length,"/100"]})]}),e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"çº¿ä¸Šå¼€åœºç™½ ðŸ’¬"}),e.jsx("textarea",{value:x.onlineGreeting,onChange:e=>m({...x,onlineGreeting:e.target.value}),placeholder:"AIåœ¨çº¿ä¸ŠèŠå¤©æ—¶çš„ç¬¬ä¸€å¥è¯ï¼ˆå¯é€‰ï¼Œä¸å¡«åˆ™AIè‡ªç”±å‘æŒ¥ï¼‰",maxLength:500,className:"w-full h-20 bg-transparent border-none outline-none text-gray-900 placeholder-gray-400 resize-none"}),e.jsxs("div",{className:"text-right text-xs text-gray-400 mt-1",children:[(x.onlineGreeting||"").length,"/500"]})]}),e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsxs("label",{className:"block text-xs text-gray-500 mb-1",children:["çº¿ä¸‹å¼€åœºç™½ ðŸŽ­",x.offlineGreetings.length>0&&e.jsxs("span",{className:"text-gray-600 ml-2",children:["(",x.offlineGreetings.length," ä¸ª)"]})]}),e.jsx("div",{className:"text-xs text-gray-400 mb-2",children:"ç”¨äºŽçº¿ä¸‹è§é¢åº”ç”¨çš„å¼€åœºç™½ï¼ˆå¯æ‰‹åŠ¨æ·»åŠ ï¼Œæˆ–ä»ŽSTè§’è‰²å¡å¯¼å…¥ï¼‰"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("textarea",{value:f,onChange:e=>b(e.target.value),placeholder:"è¾“å…¥ä¸€ä¸ªæ–°çš„çº¿ä¸‹å¼€åœºç™½ï¼ˆæ”¯æŒHTMLï¼‰...",maxLength:5e4,className:"w-full h-32 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm text-gray-900 placeholder-gray-400 resize-none focus:outline-none focus:border-blue-400"}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsxs("span",{className:"text-xs text-gray-400",children:[f.length,"/50000"]}),e.jsx("button",{type:"button",onClick:()=>{f.trim()&&(m({...x,offlineGreetings:[...x.offlineGreetings,f.trim()]}),b(""))},className:"px-4 py-2 rounded-lg text-sm transition-colors "+(f.trim().length>0?"bg-blue-500 text-white hover:bg-blue-600 cursor-pointer":"bg-gray-300 text-gray-500 cursor-not-allowed"),disabled:0===f.trim().length,children:"+ æ·»åŠ å¼€åœºç™½"})]})]}),x.offlineGreetings.length>0?e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:x.offlineGreetings.map((t,s)=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 relative",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:["å¼€åœºç™½ ",s+1]}),e.jsxs("div",{className:"text-xs text-gray-400",children:[t.length," å­—ç¬¦"]})]}),e.jsx("div",{className:"text-sm text-gray-700 pr-8 whitespace-pre-wrap break-words max-h-32 overflow-y-auto",children:t}),e.jsx("button",{type:"button",onClick:()=>{const e=x.offlineGreetings.filter((e,t)=>t!==s);m({...x,offlineGreetings:e})},className:"absolute top-2 right-2 w-6 h-6 bg-red-500 text-white rounded-full text-xs hover:bg-red-600 transition-colors",children:"Ã—"})]},s))}):e.jsx("div",{className:"text-xs text-gray-400 italic text-center py-2",children:"æš‚æ— çº¿ä¸‹å¼€åœºç™½"})]}),e.jsxs("div",{className:"px-4 py-3",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"AIè§’è‰²æè¿°"}),e.jsx("textarea",{value:x.description,onChange:e=>m({...x,description:e.target.value}),placeholder:"æè¿°AIè§’è‰²çš„èƒŒæ™¯ã€æ€§æ ¼ã€è¯´è¯é£Žæ ¼ç­‰ï¼Œç”¨äºŽAIè§’è‰²æ‰®æ¼”ï¼ˆå»ºè®®è¯¦ç»†æè¿°ï¼Œå­—æ•°è¶Šå¤šAIç†è§£è¶Šå‡†ç¡®ï¼‰",maxLength:5e3,className:"w-full h-48 bg-transparent border-none outline-none text-gray-900 placeholder-gray-400 resize-none"}),e.jsxs("div",{className:"text-right text-xs text-gray-400 mt-1",children:[(x.description||"").length,"/5000"]})]})]})]}),e.jsx("div",{className:"glass-card rounded-2xl p-4 mb-6",children:e.jsxs("div",{className:"text-xs text-gray-500 space-y-2",children:[e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:"è§’è‰²åå­—ï¼š"}),"ç”¨äºŽæ˜¾ç¤ºåœ¨å¾®ä¿¡ç•Œé¢ä¸­"]}),e.jsxs("p",{children:["ðŸ†” ",e.jsx("strong",{children:"è§’è‰²IDï¼š"}),"å¦‚æžœä¸å¡«å†™ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ ¹æ®è§’è‰²åå­—çš„æ‹¼éŸ³ç”Ÿæˆ wxid_xxx æ ¼å¼çš„ID"]}),e.jsxs("p",{children:["âœï¸ ",e.jsx("strong",{children:"ä¸ªæ€§ç­¾åï¼š"}),"æ˜¾ç¤ºåœ¨ç”¨æˆ·èµ„æ–™é¡µçš„ç­¾åï¼Œå¯¹å¤–å±•ç¤º"]}),e.jsxs("p",{children:["ðŸ¤– ",e.jsx("strong",{children:"AIè§’è‰²æè¿°ï¼š"}),"æè¿°AIçš„èƒŒæ™¯ã€æ€§æ ¼ã€è¯´è¯æ–¹å¼ç­‰ï¼Œç”¨äºŽAIè§’è‰²æ‰®æ¼”ï¼ˆåŽç»­æŽ¥å…¥APIæ—¶ä½¿ç”¨ï¼‰"]}),e.jsxs("p",{children:["ðŸ–¼ï¸ ",e.jsx("strong",{children:"å¤´åƒï¼š"}),"æ”¯æŒæœ¬åœ°ä¸Šä¼ å›¾ç‰‡ï¼Œå»ºè®®ä½¿ç”¨æ­£æ–¹å½¢å›¾ç‰‡"]})]})})]})]})}},Symbol.toStringTag,{value:"Module"})),lr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{id:l}=r(),{getCharacter:i,deleteCharacter:c}=n(),{showStatusBar:d}=o(),[x,m]=t.useState(!1),h=l?i(l):void 0;if(!h)return e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx("p",{className:"text-gray-500",children:"è§’è‰²ä¸å­˜åœ¨"})});const u=h.avatar&&h.avatar.startsWith("data:image");return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"glass-effect sticky top-0 z-50",children:[d&&e.jsx(ua,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a("/wechat/contacts"),className:"ios-button text-gray-700 hover:text-gray-900 -ml-2",children:e.jsx(os,{size:24})}),e.jsx("h1",{className:"text-base font-semibold text-gray-900",children:"è§’è‰²è¯¦æƒ…"}),e.jsxs("div",{className:"relative z-50",children:[e.jsx("button",{onClick:()=>m(!x),className:"ios-button text-gray-700 hover:text-gray-900",children:e.jsx(ds,{size:24})}),x&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>m(!1)}),e.jsxs("div",{className:"absolute right-0 top-full mt-2 w-32 glass-card rounded-xl shadow-xl z-50 overflow-hidden",children:[e.jsx("button",{onClick:()=>{m(!1),a(`/edit-character/${h.id}`)},className:"w-full px-4 py-3 text-left text-gray-900 hover:bg-gray-50 ios-button border-b border-gray-100",children:"ç¼–è¾‘è§’è‰²"}),e.jsx("button",{onClick:()=>{confirm(`ç¡®å®šè¦åˆ é™¤è§’è‰²"${h.name}"å—ï¼Ÿ`)&&(c(h.id),a("/wechat/contacts"))},className:"w-full px-4 py-3 text-left text-red-500 hover:bg-gray-50 ios-button",children:"åˆ é™¤è§’è‰²"})]})]})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-3 pt-3",children:[e.jsx("div",{className:"mb-3",children:e.jsx("div",{className:"glass-card rounded-2xl overflow-hidden",children:e.jsxs("div",{className:"flex items-center justify-between px-4 py-4",children:[e.jsx("span",{className:"text-gray-900 font-medium",children:"å¤´åƒ"}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-gray-200 flex items-center justify-center shadow-lg overflow-hidden",children:u?e.jsx("img",{src:h.avatar,alt:"å¤´åƒ",className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-3xl",children:h.avatar||"ðŸ¤–"})})})]})})}),e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"glass-card rounded-2xl overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-4 border-b border-gray-100",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"çœŸå®žåå­—"}),e.jsx("div",{className:"text-gray-900",children:h.name})]}),e.jsxs("div",{className:"px-4 py-4 border-b border-gray-100",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"ç½‘å"}),e.jsx("div",{className:"text-gray-900",children:h.nickname||h.name})]}),e.jsxs("div",{className:"px-4 py-4 border-b border-gray-100",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"è§’è‰²ID"}),e.jsx("div",{className:"text-gray-600",children:h.username})]}),e.jsxs("div",{className:"px-4 py-4 border-b border-gray-100",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"ä¸ªæ€§ç­¾å"}),e.jsx("div",{className:"text-gray-600 min-h-[40px]",children:h.signature||"è¿™ä¸ªäººå¾ˆæ‡’ï¼Œä»€ä¹ˆéƒ½æ²¡ç•™ä¸‹"})]}),e.jsxs("div",{className:"px-4 py-4",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"AIè§’è‰²æè¿°"}),e.jsx("div",{className:"text-gray-600 whitespace-pre-wrap min-h-[60px]",children:h.description||"æš‚æ— è§’è‰²æè¿°"})]})]})}),e.jsx("div",{className:"mb-6",children:e.jsx("button",{onClick:()=>a(`/chat/${h.id}`),className:"w-full glass-card rounded-2xl px-4 py-4 text-primary font-medium ios-button",children:"å‘é€æ¶ˆæ¯"})})]})]})}},Symbol.toStringTag,{value:"Module"})),nr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),[r,l]=t.useState(!1),[n,i]=t.useState(null),[c,o]=t.useState(!1),[d,x]=t.useState([]),[m,h]=t.useState(!1),[u,g]=t.useState(()=>Se(Ie.API_SETTINGS,{baseUrl:"",apiKey:"",model:"",provider:"custom",temperature:.7,maxTokens:2e3})),p=[{value:"google",label:"Google Gemini",example:"https://generativelanguage.googleapis.com/v1beta"},{value:"openai",label:"OpenAI",example:"https://api.openai.com/v1"},{value:"siliconflow",label:"SiliconFlow",example:"https://api.siliconflow.cn/v1"},{value:"custom",label:"è‡ªå®šä¹‰API",example:"https://your-api-endpoint.com/v1"}];return e.jsxs("div",{className:"h-full flex flex-col bg-[#f5f7fa]",children:[e.jsxs("div",{className:"glass-effect border-b border-gray-200/50",children:[e.jsx(ua,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a(-1),className:"ios-button text-blue-500 -ml-2 relative z-10",children:e.jsx(os,{size:24})}),e.jsx("h1",{className:"text-base font-semibold text-gray-900 absolute left-1/2 transform -translate-x-1/2 pointer-events-none",children:"APIé…ç½®"}),e.jsx("button",{onClick:()=>{u.baseUrl&&u.apiKey&&u.model?(G(Ie.API_SETTINGS,u),i(null),alert("APIé…ç½®å·²ä¿å­˜")):alert("è¯·å¡«å†™å®Œæ•´çš„APIé…ç½®")},className:"ios-button text-blue-500 font-medium",children:"ä¿å­˜"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-3 pt-3",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"APIæä¾›å•†"})}),e.jsx("div",{className:"glass-card rounded-2xl overflow-hidden",children:p.map((t,s)=>e.jsx("div",{children:e.jsxs("button",{onClick:()=>(e=>{const t=p.find(t=>t.value===e);g({...u,provider:e,baseUrl:(null==t?void 0:t.example)||""}),x([]),h(!1)})(t.value),className:"w-full flex items-center justify-between px-4 py-3 ios-button "+(s<p.length-1?"border-b border-gray-100":""),children:[e.jsx("span",{className:"text-gray-900 font-medium",children:t.label}),e.jsx("div",{className:"w-5 h-5 rounded-full border-2 flex items-center justify-center "+(u.provider===t.value?"border-primary":"border-gray-300"),children:u.provider===t.value&&e.jsx("div",{className:"w-3 h-3 rounded-full bg-primary"})})]})},t.value))})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"APIåœ°å€"})}),e.jsx("div",{className:"glass-card rounded-2xl p-4",children:e.jsx("input",{type:"text",value:u.baseUrl,onChange:e=>g({...u,baseUrl:e.target.value}),placeholder:"https://api.example.com/v1",className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"APIå¯†é’¥"})}),e.jsx("div",{className:"glass-card rounded-2xl p-4",children:e.jsx("input",{type:"password",value:u.apiKey,onChange:e=>g({...u,apiKey:e.target.value}),placeholder:"sk-...",className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"px-4 py-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"æ¨¡åž‹åç§°"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["google"===u.provider&&"ä¾‹å¦‚: gemini-1.5-flash, gemini-1.5-pro","openai"===u.provider&&"ä¾‹å¦‚: gpt-3.5-turbo, gpt-4","siliconflow"===u.provider&&"ä¾‹å¦‚: Qwen/Qwen2-7B-Instruct","custom"===u.provider&&"è¯·è¾“å…¥æ‚¨çš„æ¨¡åž‹åç§°"]})]}),e.jsx("button",{onClick:async()=>{if(u.baseUrl&&u.apiKey){if(!c){o(!0),i(null);try{const e=await _e(u);0===e.length?i({success:!1,message:"æœªæ‰¾åˆ°å¯ç”¨æ¨¡åž‹ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥"}):(x(e),h(!0),i({success:!0,message:`æˆåŠŸæ‹‰å– ${e.length} ä¸ªæ¨¡åž‹`}))}catch(e){i({success:!1,message:e.message||"æ‹‰å–æ¨¡åž‹å¤±è´¥"})}finally{o(!1)}}}else alert("è¯·å…ˆå¡«å†™APIåœ°å€å’Œå¯†é’¥")},disabled:c,className:"ml-2 px-3 py-1.5 bg-primary text-white text-xs rounded-lg ios-button",children:c?"æ‹‰å–ä¸­...":"æ‹‰å–æ¨¡åž‹"})]}),e.jsx("div",{className:"glass-card rounded-2xl p-4",children:e.jsx("input",{type:"text",value:u.model,onChange:e=>g({...u,model:e.target.value}),placeholder:"google"===u.provider?"gemini-1.5-flash":"openai"===u.provider?"gpt-3.5-turbo":"model-name",className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})})]}),m&&d.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"é€‰æ‹©æ¨¡åž‹"})}),e.jsx("div",{className:"glass-card rounded-2xl overflow-hidden max-h-60 overflow-y-auto",children:d.map((t,s)=>e.jsxs("button",{onClick:()=>(e=>{g({...u,model:e}),h(!1)})(t),className:"w-full flex items-center justify-between px-4 py-3 ios-button text-left "+(s<d.length-1?"border-b border-gray-100":""),children:[e.jsx("span",{className:"text-sm "+(u.model===t?"text-primary font-medium":"text-gray-900"),children:t}),u.model===t&&e.jsx("span",{className:"text-primary text-xl",children:"âœ“"})]},t))})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"é«˜çº§è®¾ç½®"})}),e.jsxs("div",{className:"glass-card rounded-2xl overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-2",children:"æ¸©åº¦ (Temperature)"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"range",min:"0",max:"2",step:"0.1",value:u.temperature??.7,onChange:e=>g({...u,temperature:parseFloat(e.target.value)}),className:"flex-1"}),e.jsx("span",{className:"text-gray-900 font-mono text-sm w-10 text-right",children:(u.temperature??.7).toFixed(1)})]})]}),e.jsxs("div",{className:"px-4 py-3",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-2",children:"æœ€å¤§Tokenæ•°"}),e.jsx("input",{type:"number",value:u.maxTokens??2e3,onChange:e=>g({...u,maxTokens:parseInt(e.target.value)}),placeholder:"2000",className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})]})]})]}),e.jsx("div",{className:"mb-3",children:e.jsx("button",{onClick:async()=>{if(u.baseUrl&&u.apiKey&&u.model){if(!r){G(Ie.API_SETTINGS,u),l(!0),i(null);try{const e=await Me();i(e?{success:!0,message:"APIè¿žæŽ¥æˆåŠŸ"}:{success:!1,message:"APIè¿žæŽ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥é…ç½®"})}catch(e){i({success:!1,message:e.message||"APIè¿žæŽ¥å¤±è´¥"})}finally{l(!1)}}}else alert("è¯·å…ˆå¡«å†™APIé…ç½®")},disabled:r,className:"w-full glass-card rounded-2xl px-4 py-4 text-gray-900 font-medium ios-button",children:r?"æµ‹è¯•ä¸­...":"æµ‹è¯•APIè¿žæŽ¥"})}),n&&e.jsx("div",{className:"mb-3 glass-card rounded-2xl p-4 "+(n.success?"border-green-500 border":"border-red-500 border"),children:e.jsx("p",{className:"text-sm "+(n.success?"text-green-600":"text-red-600"),children:n.message})}),e.jsx("div",{className:"glass-card rounded-2xl p-4 mb-6",children:e.jsxs("div",{className:"text-xs text-gray-500 space-y-2",children:[e.jsx("p",{className:"font-semibold text-gray-700 mb-2",children:"é…ç½®è¯´æ˜Žï¼š"}),e.jsx("p",{children:"1. é€‰æ‹©æ‚¨çš„APIæä¾›å•†"}),e.jsx("p",{children:"2. å¡«å†™APIåœ°å€ï¼ˆç³»ç»Ÿä¼šè‡ªåŠ¨é€‰æ‹©ï¼‰"}),e.jsx("p",{children:"3. å¡«å†™æ‚¨çš„APIå¯†é’¥"}),e.jsx("p",{children:"4. è¾“å…¥æ¨¡åž‹åç§°"}),e.jsx("p",{children:'5. ç‚¹å‡»"æµ‹è¯•APIè¿žæŽ¥"éªŒè¯é…ç½®'}),e.jsx("p",{children:'6. æµ‹è¯•æˆåŠŸåŽç‚¹å‡»"ä¿å­˜"'})]})})]})]})}},Symbol.toStringTag,{value:"Module"})),ir=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const t=s(),{apiConfigs:a,currentApiId:r,switchApiConfig:l,deleteApiConfig:n}=b();return e.jsxs("div",{className:"h-full flex flex-col bg-[#f5f7fa]",children:[e.jsxs("div",{className:"glass-effect border-b border-gray-200/50",children:[e.jsx(ua,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>t(-1),className:"ios-button text-blue-500 -ml-2 relative z-10",children:e.jsx(os,{size:24})}),e.jsx("h1",{className:"text-base font-semibold text-gray-900 absolute left-1/2 transform -translate-x-1/2 pointer-events-none",children:"APIç®¡ç†"}),e.jsx("button",{onClick:()=>t("/wechat/add-api"),className:"ios-button text-blue-500",children:e.jsx(cs,{size:24})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-3 pt-3",children:0===a.length?e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{className:"text-gray-400 text-base",children:"æš‚æ— APIé…ç½®"}),e.jsx("p",{className:"text-gray-400 text-xs mt-2",children:'ç‚¹å‡»å³ä¸Šè§’"+"æ·»åŠ API'})]}):e.jsx("div",{className:"space-y-3 mb-6",children:a.map(s=>{const i=r===s.id;return e.jsx("div",{onClick:()=>(e=>{l(e);const s=a.find(t=>t.id===e);s&&G(Ie.API_SETTINGS,{baseUrl:s.baseUrl,apiKey:s.apiKey,model:s.model,provider:s.provider,temperature:s.temperature,maxTokens:s.maxTokens}),t(-1)})(s.id),className:"glass-card rounded-2xl p-4 ios-button cursor-pointer "+(i?"ring-2 ring-primary":""),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.name}),i&&e.jsx("span",{className:"text-xs px-2 py-0.5 bg-primary text-white rounded-full",children:"å½“å‰"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-xs text-gray-500",children:[e.jsx("span",{className:"font-medium",children:"æä¾›å•†ï¼š"}),(c=s.provider,{google:"Google Gemini",openai:"OpenAI",siliconflow:"SiliconFlow",claude:"Claude",custom:"è‡ªå®šä¹‰"}[c]||c)]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[e.jsx("span",{className:"font-medium",children:"æ¨¡åž‹ï¼š"}),s.model]}),e.jsxs("p",{className:"text-xs text-gray-400 truncate",children:[e.jsx("span",{className:"font-medium",children:"åœ°å€ï¼š"}),s.baseUrl]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 ml-2",children:["default-siliconflow"!==s.id&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:e=>{e.stopPropagation(),t(`/edit-api/${s.id}`)},className:"px-3 py-1 text-xs text-primary ios-button whitespace-nowrap",children:"ç¼–è¾‘"}),a.length>1&&e.jsx("button",{onClick:e=>((e,t)=>{t.stopPropagation(),confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªAPIé…ç½®å—ï¼Ÿ")&&n(e)})(s.id,e),className:"px-3 py-1 text-xs text-red-500 ios-button whitespace-nowrap",children:"åˆ é™¤"})]}),"default-siliconflow"===s.id&&e.jsx("span",{className:"text-xs text-gray-400 px-2",children:"å†…ç½®"})]})]})},s.id);var c})})})]})}},Symbol.toStringTag,{value:"Module"})),cr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{addApiConfig:r}=b(),[l,n]=t.useState({name:"",baseUrl:"",apiKey:"",model:"",provider:"custom",temperature:.7,maxTokens:2e3}),[i,c]=t.useState(!1),[o,d]=t.useState(!1),[x,m]=t.useState([]),[h,u]=t.useState(!1),[g,p]=t.useState(null),f=[{value:"google",label:"Google Gemini",example:"https://generativelanguage.googleapis.com/v1beta"},{value:"openai",label:"OpenAI",example:"https://api.openai.com/v1"},{value:"siliconflow",label:"SiliconFlow",example:"https://api.siliconflow.cn/v1"},{value:"custom",label:"è‡ªå®šä¹‰API",example:"https://your-api-endpoint.com/v1"}];return e.jsxs("div",{className:"h-full flex flex-col bg-[#f5f7fa]",children:[e.jsxs("div",{className:"glass-effect border-b border-gray-200/50",children:[e.jsx(ua,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a(-1),className:"ios-button text-blue-500 -ml-2 relative z-10",children:e.jsx(os,{size:24})}),e.jsx("h1",{className:"text-base font-semibold text-gray-900 absolute left-1/2 transform -translate-x-1/2 pointer-events-none",children:"æ–°å¢žAPI"}),e.jsx("button",{onClick:()=>{l.name.trim()?l.baseUrl&&l.apiKey&&l.model?(r(l),G(Ie.API_SETTINGS,l),a("/api-list",{replace:!0})):alert("è¯·å¡«å†™å®Œæ•´çš„APIé…ç½®"):alert("è¯·è¾“å…¥APIåç§°")},className:"ios-button text-blue-500 font-medium",children:"ä¿å­˜"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-3 pt-3",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"APIåç§°"})}),e.jsx("div",{className:"glass-card rounded-2xl p-4",children:e.jsx("input",{type:"text",value:l.name,onChange:e=>n({...l,name:e.target.value}),placeholder:"ä¾‹å¦‚: æˆ‘çš„Gemini API",maxLength:30,className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"APIæä¾›å•†"})}),e.jsx("div",{className:"glass-card rounded-2xl overflow-hidden",children:f.map((t,s)=>e.jsx("div",{children:e.jsxs("button",{onClick:()=>(e=>{const t=f.find(t=>t.value===e);n({...l,provider:e,baseUrl:(null==t?void 0:t.example)||""}),m([]),u(!1)})(t.value),className:"w-full flex items-center justify-between px-4 py-3 ios-button "+(s<f.length-1?"border-b border-gray-100":""),children:[e.jsx("span",{className:"text-gray-900 font-medium",children:t.label}),e.jsx("div",{className:"w-5 h-5 rounded-full border-2 flex items-center justify-center "+(l.provider===t.value?"border-primary":"border-gray-300"),children:l.provider===t.value&&e.jsx("div",{className:"w-3 h-3 rounded-full bg-primary"})})]})},t.value))})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"APIåœ°å€"})}),e.jsx("div",{className:"glass-card rounded-2xl p-4",children:e.jsx("input",{type:"text",value:l.baseUrl,onChange:e=>n({...l,baseUrl:e.target.value}),placeholder:"https://api.example.com/v1",className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"APIå¯†é’¥"})}),e.jsx("div",{className:"glass-card rounded-2xl p-4",children:e.jsx("input",{type:"password",value:l.apiKey,onChange:e=>n({...l,apiKey:e.target.value}),placeholder:"sk-...",className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"px-4 py-2 flex items-center justify-between",children:[e.jsx("div",{className:"flex-1",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"æ¨¡åž‹åç§°"})}),e.jsx("button",{onClick:async()=>{if(l.baseUrl&&l.apiKey){if(!o){d(!0),p(null);try{const e=await _e(l);0===e.length?p({success:!1,message:"æœªæ‰¾åˆ°å¯ç”¨æ¨¡åž‹ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥"}):(m(e),u(!0),!l.model&&e.length>0&&n({...l,model:e[0]}),p({success:!0,message:`æˆåŠŸæ‹‰å– ${e.length} ä¸ªæ¨¡åž‹ï¼Œå·²è‡ªåŠ¨é€‰æ‹©ç¬¬ä¸€ä¸ª`}))}catch(e){p({success:!1,message:e.message||"æ‹‰å–æ¨¡åž‹å¤±è´¥"})}finally{d(!1)}}}else alert("è¯·å…ˆå¡«å†™APIåœ°å€å’Œå¯†é’¥")},disabled:o,className:"ml-2 px-3 py-1.5 bg-primary text-white text-xs rounded-lg ios-button",children:o?"æ‹‰å–ä¸­...":"æ‹‰å–æ¨¡åž‹"})]}),e.jsx("div",{className:"glass-card rounded-2xl p-4",children:e.jsx("input",{type:"text",value:l.model,onChange:e=>n({...l,model:e.target.value}),placeholder:"é€‰æ‹©æˆ–è¾“å…¥æ¨¡åž‹åç§°",className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})})]}),h&&x.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"é€‰æ‹©æ¨¡åž‹"})}),e.jsx("div",{className:"glass-card rounded-2xl overflow-hidden max-h-60 overflow-y-auto",children:x.map((t,s)=>e.jsxs("button",{onClick:()=>(e=>{n({...l,model:e}),u(!1)})(t),className:"w-full flex items-center justify-between px-4 py-3 ios-button text-left "+(s<x.length-1?"border-b border-gray-100":""),children:[e.jsx("span",{className:"text-sm "+(l.model===t?"text-primary font-medium":"text-gray-900"),children:t}),l.model===t&&e.jsx("span",{className:"text-primary text-xl",children:"âœ“"})]},t))})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"é«˜çº§è®¾ç½®"})}),e.jsxs("div",{className:"glass-card rounded-2xl overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-2",children:"æ¸©åº¦ (Temperature)"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"range",min:"0",max:"2",step:"0.1",value:l.temperature??.7,onChange:e=>n({...l,temperature:parseFloat(e.target.value)}),className:"flex-1"}),e.jsx("span",{className:"text-gray-900 font-mono text-sm w-10 text-right",children:(l.temperature??.7).toFixed(1)})]})]}),e.jsxs("div",{className:"px-4 py-3",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-2",children:"æœ€å¤§Tokenæ•°"}),e.jsx("input",{type:"number",value:l.maxTokens??2e3,onChange:e=>n({...l,maxTokens:parseInt(e.target.value)}),placeholder:"2000",className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})]})]})]}),e.jsx("div",{className:"mb-3",children:e.jsx("button",{onClick:async()=>{if(l.baseUrl&&l.apiKey&&l.model){G(Ie.API_SETTINGS,l),c(!0),p(null);try{const e=await Me();p(e?{success:!0,message:"APIè¿žæŽ¥æˆåŠŸ"}:{success:!1,message:"APIè¿žæŽ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥é…ç½®"})}catch(e){p({success:!1,message:e.message||"APIè¿žæŽ¥å¤±è´¥"})}finally{c(!1)}}else alert("è¯·å…ˆå¡«å†™å®Œæ•´çš„APIé…ç½®")},disabled:i,className:"w-full glass-card rounded-2xl px-4 py-4 text-gray-900 font-medium ios-button",children:i?"æµ‹è¯•ä¸­...":"æµ‹è¯•APIè¿žæŽ¥"})}),g&&e.jsx("div",{className:"mb-6 glass-card rounded-2xl p-4 "+(g.success?"border-green-500 border":"border-red-500 border"),children:e.jsx("p",{className:"text-sm "+(g.success?"text-green-600":"text-red-600"),children:g.message})})]})]})}},Symbol.toStringTag,{value:"Module"})),or=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{id:l}=r(),{apiConfigs:n,updateApiConfig:i,currentApiId:c}=b(),o=n.find(e=>e.id===l),[d,x]=t.useState({name:(null==o?void 0:o.name)||"",baseUrl:(null==o?void 0:o.baseUrl)||"",apiKey:(null==o?void 0:o.apiKey)||"",model:(null==o?void 0:o.model)||"",provider:(null==o?void 0:o.provider)||"custom",temperature:(null==o?void 0:o.temperature)??.7,maxTokens:(null==o?void 0:o.maxTokens)??2e3}),[m,h]=t.useState(!1),[u,g]=t.useState(!1),[p,f]=t.useState([]),[j,v]=t.useState(!1),[y,N]=t.useState(null),w=[{value:"google",label:"Google Gemini",example:"https://generativelanguage.googleapis.com/v1beta"},{value:"openai",label:"OpenAI",example:"https://api.openai.com/v1"},{value:"siliconflow",label:"SiliconFlow",example:"https://api.siliconflow.cn/v1"},{value:"custom",label:"è‡ªå®šä¹‰API",example:"https://your-api-endpoint.com/v1"}];if(!o)return a("/api-list"),null;return e.jsxs("div",{className:"h-full flex flex-col bg-[#f5f7fa]",children:[e.jsxs("div",{className:"glass-effect border-b border-gray-200/50",children:[e.jsx(ua,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a(-1),className:"ios-button text-blue-500 -ml-2 relative z-10",children:e.jsx(os,{size:24})}),e.jsx("h1",{className:"text-base font-semibold text-gray-900 absolute left-1/2 transform -translate-x-1/2 pointer-events-none",children:"ç¼–è¾‘API"}),e.jsx("button",{onClick:()=>{d.name.trim()?d.baseUrl&&d.apiKey&&d.model?(l&&(i(l,d),c===l&&G(Ie.API_SETTINGS,d)),a("/api-list",{replace:!0})):alert("è¯·å¡«å†™å®Œæ•´çš„APIé…ç½®"):alert("è¯·è¾“å…¥APIåç§°")},className:"ios-button text-blue-500 font-medium",children:"ä¿å­˜"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-3 pt-3",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"APIåç§°"})}),e.jsx("div",{className:"glass-card rounded-2xl p-4",children:e.jsx("input",{type:"text",value:d.name,onChange:e=>x({...d,name:e.target.value}),placeholder:"ä¾‹å¦‚: æˆ‘çš„Gemini API",maxLength:30,className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"APIæä¾›å•†"})}),e.jsx("div",{className:"glass-card rounded-2xl overflow-hidden",children:w.map((t,s)=>e.jsx("div",{children:e.jsxs("button",{onClick:()=>(e=>{const t=w.find(t=>t.value===e);x({...d,provider:e,baseUrl:(null==t?void 0:t.example)||""}),f([]),v(!1)})(t.value),className:"w-full flex items-center justify-between px-4 py-3 ios-button "+(s<w.length-1?"border-b border-gray-100":""),children:[e.jsx("span",{className:"text-gray-900 font-medium",children:t.label}),e.jsx("div",{className:"w-5 h-5 rounded-full border-2 flex items-center justify-center "+(d.provider===t.value?"border-primary":"border-gray-300"),children:d.provider===t.value&&e.jsx("div",{className:"w-3 h-3 rounded-full bg-primary"})})]})},t.value))})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"APIåœ°å€"})}),e.jsx("div",{className:"glass-card rounded-2xl p-4",children:e.jsx("input",{type:"text",value:d.baseUrl,onChange:e=>x({...d,baseUrl:e.target.value}),placeholder:"https://api.example.com/v1",className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"APIå¯†é’¥"})}),e.jsx("div",{className:"glass-card rounded-2xl p-4",children:e.jsx("input",{type:"password",value:d.apiKey,onChange:e=>x({...d,apiKey:e.target.value}),placeholder:"sk-...",className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"px-4 py-2 flex items-center justify-between",children:[e.jsx("div",{className:"flex-1",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"æ¨¡åž‹åç§°"})}),e.jsx("button",{onClick:async()=>{if(d.baseUrl&&d.apiKey){if(!u){g(!0),N(null);try{const e=await _e(d);0===e.length?N({success:!1,message:"æœªæ‰¾åˆ°å¯ç”¨æ¨¡åž‹ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥"}):(f(e),v(!0),!d.model&&e.length>0&&x({...d,model:e[0]}),N({success:!0,message:`æˆåŠŸæ‹‰å– ${e.length} ä¸ªæ¨¡åž‹`}))}catch(e){N({success:!1,message:e.message||"æ‹‰å–æ¨¡åž‹å¤±è´¥"})}finally{g(!1)}}}else alert("è¯·å…ˆå¡«å†™APIåœ°å€å’Œå¯†é’¥")},disabled:u,className:"ml-2 px-3 py-1.5 bg-primary text-white text-xs rounded-lg ios-button",children:u?"æ‹‰å–ä¸­...":"æ‹‰å–æ¨¡åž‹"})]}),e.jsx("div",{className:"glass-card rounded-2xl p-4",children:e.jsx("input",{type:"text",value:d.model,onChange:e=>x({...d,model:e.target.value}),placeholder:"é€‰æ‹©æˆ–è¾“å…¥æ¨¡åž‹åç§°",className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})})]}),j&&p.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"é€‰æ‹©æ¨¡åž‹"})}),e.jsx("div",{className:"glass-card rounded-2xl overflow-hidden max-h-60 overflow-y-auto",children:p.map((t,s)=>e.jsxs("button",{onClick:()=>(e=>{x({...d,model:e}),v(!1)})(t),className:"w-full flex items-center justify-between px-4 py-3 ios-button text-left "+(s<p.length-1?"border-b border-gray-100":""),children:[e.jsx("span",{className:"text-sm "+(d.model===t?"text-primary font-medium":"text-gray-900"),children:t}),d.model===t&&e.jsx("span",{className:"text-primary text-xl",children:"âœ“"})]},t))})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"é«˜çº§è®¾ç½®"})}),e.jsxs("div",{className:"glass-card rounded-2xl overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-2",children:"æ¸©åº¦ (Temperature)"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"range",min:"0",max:"2",step:"0.1",value:d.temperature??.7,onChange:e=>x({...d,temperature:parseFloat(e.target.value)}),className:"flex-1"}),e.jsx("span",{className:"text-gray-900 font-mono text-sm w-10 text-right",children:(d.temperature??.7).toFixed(1)})]})]}),e.jsxs("div",{className:"px-4 py-3",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-2",children:"æœ€å¤§Tokenæ•°"}),e.jsx("input",{type:"number",value:d.maxTokens??2e3,onChange:e=>x({...d,maxTokens:parseInt(e.target.value)}),placeholder:"2000",className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})]})]})]}),e.jsx("div",{className:"mb-3",children:e.jsx("button",{onClick:async()=>{if(d.baseUrl&&d.apiKey&&d.model){G(Ie.API_SETTINGS,d),h(!0),N(null);try{const e=await Me();N(e?{success:!0,message:"APIè¿žæŽ¥æˆåŠŸ"}:{success:!1,message:"APIè¿žæŽ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥é…ç½®"})}catch(e){N({success:!1,message:e.message||"APIè¿žæŽ¥å¤±è´¥"})}finally{h(!1)}}else alert("è¯·å…ˆå¡«å†™å®Œæ•´çš„APIé…ç½®")},disabled:m,className:"w-full glass-card rounded-2xl px-4 py-4 text-gray-900 font-medium ios-button",children:m?"æµ‹è¯•ä¸­...":"æµ‹è¯•APIè¿žæŽ¥"})}),y&&e.jsx("div",{className:"mb-6 glass-card rounded-2xl p-4 "+(y.success?"border-green-500 border":"border-red-500 border"),children:e.jsx("p",{className:"text-sm "+(y.success?"text-green-600":"text-red-600"),children:y.message})})]})]})}},Symbol.toStringTag,{value:"Module"})),dr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{var r;const l=s(),n=a(),{currentUser:i,updateUser:c}=d(),{showStatusBar:x}=o(),m=(null==(r=n.state)?void 0:r.field)||"name",h=t.useRef(null),[u,g]=t.useState("name"===m?(null==i?void 0:i.name)||"":"signature"===m?(null==i?void 0:i.signature)||"":(null==i?void 0:i.avatar)||"default"),[p,f]=t.useState(!1);return e.jsxs("div",{className:"h-full flex flex-col bg-gray-50",children:[x&&e.jsx(ua,{}),e.jsxs("div",{className:"glass-effect px-4 py-3 flex items-center justify-between border-b border-gray-200/50",children:[e.jsx("button",{onClick:()=>l(-1),className:"ios-button text-gray-700 hover:text-gray-900",children:"å–æ¶ˆ"}),e.jsx("h1",{className:"text-base font-semibold text-gray-900",children:(()=>{switch(m){case"name":return"æ›´æ”¹åå­—";case"signature":return"ä¸ªæ€§ç­¾å";case"avatar":return"æ›´æ¢å¤´åƒ";default:return"ç¼–è¾‘"}})()}),e.jsx("button",{onClick:()=>{i&&(c(i.id,{[m]:u}),l(-1))},className:"ios-button text-primary font-medium",children:"ä¿å­˜"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-3 pt-3",children:"avatar"===m?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"px-4 py-2",children:[e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"ä¸Šä¼ å¤´åƒ"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"ç‚¹å‡»ä¸Šä¼ æœ¬åœ°å›¾ç‰‡ï¼Œæ”¯æŒ JPGã€PNGã€GIF æ ¼å¼"})]}),e.jsxs("div",{className:"glass-card rounded-2xl p-6 flex justify-center",children:[e.jsx("input",{ref:h,type:"file",accept:"image/*",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(!s)return;if(!s.type.startsWith("image/"))return void alert("è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶");if(s.size>5242880)return void alert("å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡5MB");f(!0);const a=new FileReader;a.onloadend=()=>{const e=a.result;g(e),f(!1)},a.onerror=()=>{alert("å›¾ç‰‡è¯»å–å¤±è´¥"),f(!1)},a.readAsDataURL(s)},className:"hidden"}),e.jsx("button",{onClick:()=>{var e;return null==(e=h.current)?void 0:e.click()},disabled:p,className:"relative w-32 h-32 rounded-2xl bg-gray-100 border-2 border-dashed border-gray-300 flex flex-col items-center justify-center ios-button overflow-hidden",children:u&&u.startsWith("data:image")?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:u,alt:"å¤´åƒé¢„è§ˆ",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-20 transition-all flex items-center justify-center",children:e.jsx("span",{className:"text-white opacity-0 hover:opacity-100 text-sm",children:"ç‚¹å‡»æ›´æ¢"})})]}):e.jsx(e.Fragment,{children:p?e.jsx("div",{className:"text-gray-400",children:"ä¸Šä¼ ä¸­..."}):e.jsxs(e.Fragment,{children:[e.jsx(us,{size:32,className:"text-gray-400 mb-2"}),e.jsx("span",{className:"text-sm text-gray-500",children:"ä¸Šä¼ å¤´åƒ"})]})})})]})]})}):e.jsxs("div",{className:"glass-card rounded-2xl p-4",children:["signature"===m?e.jsx("textarea",{value:u,onChange:e=>g(e.target.value),placeholder:"å¡«å†™ä¸ªæ€§ç­¾å",maxLength:100,className:"w-full h-32 bg-transparent border-none outline-none text-gray-900 placeholder-gray-400 resize-none"}):e.jsx("input",{type:"text",value:u,onChange:e=>g(e.target.value),placeholder:"è¯·è¾“å…¥åå­—",maxLength:20,className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400 py-2"}),e.jsxs("div",{className:"text-right text-xs text-gray-400 mt-2",children:[u.length,"/","signature"===m?100:20]})]})})]})}},Symbol.toStringTag,{value:"Module"})),xr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const t=s(),{users:a,currentUser:r,switchUser:l,deleteUser:n}=d();return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"glass-effect px-4 py-3 flex items-center justify-between border-b border-gray-200/50",children:[e.jsx("button",{onClick:()=>t("/desktop",{replace:!0}),className:"ios-button text-gray-700 hover:text-gray-900 -ml-2",children:e.jsx(os,{size:24})}),e.jsx("h1",{className:"text-base font-semibold text-gray-900 absolute left-1/2 transform -translate-x-1/2 pointer-events-none",children:"è´¦å·ç®¡ç†"}),e.jsx("button",{onClick:()=>t("/create-user"),className:"ios-button text-gray-700 hover:text-gray-900",children:e.jsx(cs,{size:24})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-3 pt-3",children:e.jsx("div",{className:"space-y-3 mb-6",children:a.map(s=>{const i=s.avatar&&s.avatar.startsWith("data:image"),c=(null==r?void 0:r.id)===s.id;return e.jsx("div",{onClick:()=>{return e=s.id,l(e),void t("/wechat/me");var e},className:"glass-card rounded-2xl p-4 ios-button cursor-pointer "+(c?"ring-2 ring-primary":""),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-gray-200 flex items-center justify-center shadow-lg flex-shrink-0 overflow-hidden",children:i&&s.avatar?e.jsx("img",{src:s.avatar,alt:"å¤´åƒ",className:"w-full h-full object-cover"}):e.jsx(us,{size:32,className:"text-gray-400"})}),e.jsxs("div",{className:"ml-4 flex-1 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.name}),c&&e.jsx("span",{className:"text-xs px-2 py-0.5 bg-primary text-white rounded-full",children:"å½“å‰"})]}),e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:s.username}),e.jsx("p",{className:"text-xs text-gray-400 truncate",children:s.signature})]}),!c&&a.length>1&&e.jsx("button",{onClick:e=>((e,t)=>{t.stopPropagation(),confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè´¦å·å—ï¼Ÿ")&&n(e)})(s.id,e),className:"ml-2 px-3 py-1 text-sm text-red-500 ios-button",children:"åˆ é™¤"})]})},s.id)})})})]})}},Symbol.toStringTag,{value:"Module"})),mr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{addUser:r}=d(),{showStatusBar:l}=o(),n=t.useRef(null),[i,c]=t.useState({name:"",username:"",avatar:"",signature:"è¿™ä¸ªäººå¾ˆæ‡’ï¼Œä»€ä¹ˆéƒ½æ²¡ç•™ä¸‹",description:""}),[x,m]=t.useState(!1);return e.jsxs("div",{className:"h-screen flex flex-col bg-gray-50",children:[l&&e.jsx(ua,{}),e.jsxs("div",{className:"glass-effect px-4 py-3 flex items-center justify-between border-b border-gray-200/50",children:[e.jsx("button",{onClick:()=>a(-1),className:"ios-button text-gray-700 hover:text-gray-900",children:"å–æ¶ˆ"}),e.jsx("h1",{className:"text-base font-semibold text-gray-900",children:"åˆ›å»ºæ–°è´¦å·"}),e.jsx("button",{onClick:()=>{if(!i.name.trim())return void alert("è¯·è¾“å…¥åå­—");if(!i.avatar)return void alert("è¯·ä¸Šä¼ å¤´åƒ");const e=i.username||`wxid_${we(i.name)||Date.now().toString().slice(-6)}`;r({...i,username:e}),a("/wechat/me")},className:"ios-button text-primary font-medium",children:"å®Œæˆ"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-3 pt-3",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"px-4 py-2",children:[e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"ä¸Šä¼ å¤´åƒ"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"ç‚¹å‡»ä¸Šä¼ æœ¬åœ°å›¾ç‰‡ï¼Œæ”¯æŒ JPGã€PNGã€GIF æ ¼å¼"})]}),e.jsxs("div",{className:"glass-card rounded-2xl p-6 flex justify-center",children:[e.jsx("input",{ref:n,type:"file",accept:"image/*",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(!s)return;if(!s.type.startsWith("image/"))return void alert("è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶");if(s.size>5242880)return void alert("å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡5MB");m(!0);const a=new FileReader;a.onloadend=()=>{const e=a.result;c({...i,avatar:e}),m(!1)},a.onerror=()=>{alert("å›¾ç‰‡è¯»å–å¤±è´¥"),m(!1)},a.readAsDataURL(s)},className:"hidden"}),e.jsx("button",{onClick:()=>{var e;return null==(e=n.current)?void 0:e.click()},disabled:x,className:"relative w-32 h-32 rounded-2xl bg-gray-100 border-2 border-dashed border-gray-300 flex flex-col items-center justify-center ios-button overflow-hidden",children:i.avatar?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:i.avatar,alt:"å¤´åƒé¢„è§ˆ",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-20 transition-all flex items-center justify-center",children:e.jsx("span",{className:"text-white opacity-0 hover:opacity-100 text-sm",children:"ç‚¹å‡»æ›´æ¢"})})]}):e.jsx(e.Fragment,{children:x?e.jsx("div",{className:"text-gray-400",children:"ä¸Šä¼ ä¸­..."}):e.jsxs(e.Fragment,{children:[e.jsx(us,{size:32,className:"text-gray-400 mb-2"}),e.jsx("span",{className:"text-sm text-gray-500",children:"ä¸Šä¼ å¤´åƒ"})]})})})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"åŸºæœ¬ä¿¡æ¯"})}),e.jsxs("div",{className:"glass-card rounded-2xl overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"åå­—"}),e.jsx("input",{type:"text",value:i.name,onChange:e=>{return t=e.target.value,void c(e=>{if((!e.username||e.username.startsWith("wxid_"))&&t){const s=we(t);return{...e,name:t,username:`wxid_${s||Date.now().toString().slice(-6)}`}}return{...e,name:t}});var t},placeholder:"è¯·è¾“å…¥åå­—",maxLength:20,className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})]}),e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsxs("label",{className:"block text-xs text-gray-500 mb-1",children:["å¾®ä¿¡å· ",e.jsx("span",{className:"text-gray-400",children:"ï¼ˆç•™ç©ºè‡ªåŠ¨ç”Ÿæˆï¼‰"})]}),e.jsx("input",{type:"text",value:i.username,onChange:e=>c({...i,username:e.target.value}),placeholder:`wxid_${we(i.name)||"auto"}`,className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})]}),e.jsxs("div",{className:"px-4 py-3",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"ä¸ªæ€§ç­¾å"}),e.jsx("textarea",{value:i.signature,onChange:e=>c({...i,signature:e.target.value}),placeholder:"å¡«å†™ä¸ªæ€§ç­¾å",maxLength:100,className:"w-full h-20 bg-transparent border-none outline-none text-gray-900 placeholder-gray-400 resize-none"})]})]})]})]})]})}},Symbol.toStringTag,{value:"Module"})),hr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{currentUser:r}=d(),{addMoment:l}=h(),{showStatusBar:i}=o(),{characters:c}=n(),[x,m]=t.useState(""),[u,g]=t.useState(""),[p,f]=t.useState(!1),[b,j]=t.useState([]),[v,y]=t.useState(!1),[N,w]=t.useState(!1),[k,C]=t.useState([]),[S,I]=t.useState(!1),[_,M]=t.useState("public"),[z,L]=t.useState([]),$=()=>{const e=document.createElement("input");e.type="file",e.accept="image/*",e.multiple=!0,e.onchange=e=>{const t=Array.from(e.target.files||[]);if(0===t.length)return;const s=9-b.length;t.slice(0,s).forEach(e=>{if(e.size>5242880)return void alert("å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡5MB");const t=new FileReader;t.onload=e=>{var t;const s=null==(t=e.target)?void 0:t.result;j(e=>[...e,{id:`img_${Date.now()}_${Math.random()}`,url:s}])},t.readAsDataURL(e)})},e.click()};return e.jsxs("div",{className:"h-full flex flex-col bg-gray-50",children:[i&&e.jsx(ua,{}),e.jsxs("div",{className:"bg-white px-4 py-3 flex items-center justify-between border-b border-gray-100 sticky top-0 z-10",children:[e.jsxs("button",{onClick:()=>a("/moments",{replace:!0}),className:"flex items-center gap-2 text-gray-700 ios-button",children:[e.jsx(os,{size:20}),e.jsx("span",{className:"text-base",children:"å–æ¶ˆ"})]}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"å‘è¡¨æ–‡å­—"}),e.jsx("button",{onClick:async()=>{if(!r||!x.trim())return;y(!0);const e={userId:r.id,userName:r.name,userAvatar:r.avatar,content:x.trim(),images:b,location:u.trim()||void 0,visibility:_,visibleTo:"partial"===_?z:[],remindUsers:k};Date.now().toString(),l(e),k.length>0&&k.forEach(e=>{if(c.find(t=>t.id===e)){const t=localStorage.getItem(`chat_messages_${e}`),s=t?JSON.parse(t):[],a={id:Date.now()+Math.random(),type:"system",content:`ðŸ’¬ ${r.name} æé†’ä½ æŸ¥çœ‹Taçš„æœ‹å‹åœˆ`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"system",isHidden:!1};s.push(a),localStorage.setItem(`chat_messages_${e}`,JSON.stringify(s))}}),c.forEach(e=>{if("true"===localStorage.getItem(`ai_moments_enabled_${e.id}`)){if("private"===_)return;if("partial"===_&&!z.includes(e.id))return;const t=localStorage.getItem(`chat_messages_${e.id}`),s=t?JSON.parse(t):[];let a=`ðŸ“¸ ä½ å‘å¸ƒäº†æœ‹å‹åœˆï¼š${x.trim()}`;b.length>0&&(a+=` [${b.length}å¼ å›¾ç‰‡]`),u.trim()&&(a+=` ðŸ“${u.trim()}`);const r={id:Date.now()+Math.random(),type:"system",content:a,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"system",isHidden:!1};s.push(r),localStorage.setItem(`chat_messages_${e.id}`,JSON.stringify(s))}}),a("/moments",{replace:!0})},disabled:!x.trim()||v,className:"px-4 py-1.5 rounded-full bg-green-500 text-white text-sm font-medium ios-button disabled:opacity-50 disabled:cursor-not-allowed",children:v?"å‘å¸ƒä¸­...":"å‘è¡¨"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar p-4 bg-gray-50",children:[e.jsx("div",{className:"bg-white rounded-2xl p-4 mb-4 shadow-sm",children:e.jsx("textarea",{value:x,onChange:e=>m(e.target.value),placeholder:"è¿™ä¸€åˆ»çš„æƒ³æ³•...",className:"w-full bg-transparent outline-none resize-none text-base text-gray-800 placeholder-gray-400 leading-relaxed",rows:8,autoFocus:!0})}),b.length>0&&e.jsx("div",{className:"bg-white rounded-2xl p-4 mb-4 shadow-sm",children:e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[b.map(t=>e.jsxs("div",{className:"relative aspect-square rounded-lg overflow-hidden bg-gray-100",children:[e.jsx("img",{src:t.url,alt:"",className:"w-full h-full object-cover"}),e.jsx("button",{onClick:()=>{return e=t.id,void j(t=>t.filter(t=>t.id!==e));var e},className:"absolute top-1 right-1 w-6 h-6 rounded-full bg-black/50 text-white flex items-center justify-center text-xs",children:"âœ•"})]},t.id)),b.length<9&&e.jsx("button",{onClick:$,className:"aspect-square rounded-lg border-2 border-dashed border-gray-300 flex items-center justify-center text-gray-400 ios-button hover:border-blue-400 hover:text-blue-400 transition-colors",children:e.jsxs("div",{className:"text-center",children:[e.jsx(us,{size:24,className:"mx-auto mb-1"}),e.jsx("span",{className:"text-xs",children:"æ·»åŠ "})]})})]})}),0===b.length&&e.jsx("div",{className:"bg-white rounded-2xl p-4 mb-4 shadow-sm",children:e.jsx("button",{onClick:$,className:"w-full aspect-square max-w-[120px] rounded-xl border-2 border-dashed border-gray-300 flex items-center justify-center text-gray-400 ios-button hover:border-blue-400 hover:text-blue-400 transition-colors",children:e.jsxs("div",{className:"text-center",children:[e.jsx(us,{size:32,className:"mx-auto mb-2"}),e.jsx("span",{className:"text-xs",children:"æ·»åŠ å›¾ç‰‡"})]})})}),e.jsxs("div",{className:"bg-white rounded-2xl overflow-hidden shadow-sm",children:[e.jsxs("button",{onClick:()=>f(!p),className:"w-full flex items-center justify-between px-4 py-4 ios-button",children:[e.jsx("span",{className:"text-gray-700 font-medium",children:"æ‰€åœ¨ä½ç½®"}),e.jsx("span",{className:"text-gray-400 text-xl",children:"â€º"})]}),p&&e.jsx("div",{className:"px-4 pb-4",children:e.jsx("input",{type:"text",value:u,onChange:e=>g(e.target.value),placeholder:"è¾“å…¥ä½ç½®ä¿¡æ¯",className:"w-full px-4 py-2 rounded-lg bg-gray-50 outline-none text-sm text-gray-800 placeholder-gray-400"})}),e.jsx("div",{className:"border-t border-gray-100"}),e.jsxs("button",{onClick:()=>w(!0),className:"w-full flex items-center justify-between px-4 py-4 ios-button",children:[e.jsx("span",{className:"text-gray-700 font-medium",children:"æé†’è°çœ‹"}),e.jsxs("div",{className:"flex items-center gap-2",children:[k.length>0&&e.jsxs("span",{className:"text-gray-400 text-sm",children:[k.length,"äºº"]}),e.jsx("span",{className:"text-gray-400 text-xl",children:"â€º"})]})]}),e.jsx("div",{className:"border-t border-gray-100"}),e.jsxs("button",{onClick:()=>I(!0),className:"w-full flex items-center justify-between px-4 py-4 ios-button",children:[e.jsx("span",{className:"text-gray-700 font-medium",children:"è°å¯ä»¥çœ‹"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-400 text-sm",children:"public"===_?"å…¬å¼€":"private"===_?"ç§å¯†":`${z.length}äººå¯è§`}),e.jsx("span",{className:"text-gray-400 text-xl",children:"â€º"})]})]})]})]}),N&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-end",onClick:()=>w(!1),children:e.jsxs("div",{className:"bg-white w-full rounded-t-3xl max-h-[70vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"px-4 py-4 border-b border-gray-100 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"æé†’è°çœ‹"}),e.jsx("button",{onClick:()=>w(!1),className:"text-blue-500 font-medium ios-button",children:"å®Œæˆ"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:c.map(t=>{const s=k.includes(t.id);return e.jsxs("button",{onClick:()=>{C(s?e=>e.filter(e=>e!==t.id):e=>[...e,t.id])},className:"w-full flex items-center gap-3 p-3 hover:bg-gray-50 rounded-xl ios-button transition-colors",children:[e.jsx("img",{src:t.avatar,alt:t.name,className:"w-12 h-12 rounded-full object-cover"}),e.jsx("div",{className:"flex-1 text-left",children:e.jsx("div",{className:"text-base font-medium text-gray-900",children:t.name})}),e.jsx("div",{className:"w-6 h-6 rounded-full border-2 flex items-center justify-center transition-colors "+(s?"bg-green-500 border-green-500":"border-gray-300"),children:s&&e.jsx("span",{className:"text-white text-sm",children:"âœ“"})})]},t.id)})})]})}),S&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-end",onClick:()=>I(!1),children:e.jsxs("div",{className:"bg-white w-full rounded-t-3xl max-h-[70vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"px-4 py-4 border-b border-gray-100 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"è°å¯ä»¥çœ‹"}),e.jsx("button",{onClick:()=>I(!1),className:"text-blue-500 font-medium ios-button",children:"å®Œæˆ"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"p-4 space-y-2",children:[e.jsxs("button",{onClick:()=>{M("public"),L([])},className:"w-full flex items-center justify-between p-4 rounded-xl hover:bg-gray-50 ios-button transition-colors",children:[e.jsx("span",{className:"text-base text-gray-900",children:"å…¬å¼€"}),"public"===_&&e.jsx("span",{className:"text-green-500 text-lg",children:"âœ“"})]}),e.jsxs("button",{onClick:()=>{M("private"),L([])},className:"w-full flex items-center justify-between p-4 rounded-xl hover:bg-gray-50 ios-button transition-colors",children:[e.jsx("span",{className:"text-base text-gray-900",children:"ç§å¯†"}),"private"===_&&e.jsx("span",{className:"text-green-500 text-lg",children:"âœ“"})]}),e.jsxs("button",{onClick:()=>{"partial"!==_&&M("partial")},className:"w-full flex items-center justify-between p-4 rounded-xl hover:bg-gray-50 ios-button transition-colors",children:[e.jsx("span",{className:"text-base text-gray-900",children:"éƒ¨åˆ†å¯è§"}),"partial"===_&&e.jsx("span",{className:"text-green-500 text-lg",children:"âœ“"})]})]}),"partial"===_&&e.jsxs("div",{className:"border-t border-gray-100 p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-3",children:"é€‰æ‹©å¯è§ç”¨æˆ·"}),c.map(t=>{const s=z.includes(t.id);return e.jsxs("button",{onClick:()=>{L(s?e=>e.filter(e=>e!==t.id):e=>[...e,t.id])},className:"w-full flex items-center gap-3 p-3 hover:bg-gray-50 rounded-xl ios-button transition-colors",children:[e.jsx("img",{src:t.avatar,alt:t.name,className:"w-10 h-10 rounded-full object-cover"}),e.jsx("div",{className:"flex-1 text-left",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.name})}),e.jsx("div",{className:"w-5 h-5 rounded-full border-2 flex items-center justify-center transition-colors "+(s?"bg-green-500 border-green-500":"border-gray-300"),children:s&&e.jsx("span",{className:"text-white text-xs",children:"âœ“"})})]},t.id)})]})]})]})})]})}},Symbol.toStringTag,{value:"Module"})),ur=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),{characters:l}=n(),[i,c]=t.useState([]);t.useEffect(()=>{const e=ze(),t=l.map(e=>e.id),s=e.filter(e=>t.includes(e.fromUserId));c(s),Le()},[l]);const d=e=>{const t=Date.now()-e,s=Math.floor(t/1e3/60),a=Math.floor(s/60),r=Math.floor(a/24);if(s<1)return"åˆšåˆš";if(s<60)return`${s}åˆ†é’Ÿå‰`;if(a<24)return`${a}å°æ—¶å‰`;if(r<7)return`${r}å¤©å‰`;const l=new Date(e);return`${l.getMonth()+1}æœˆ${l.getDate()}æ—¥`},x=e=>{switch(e.type){case"like":return"èµžäº†ä½ çš„æœ‹å‹åœˆ";case"comment":return"è¯„è®ºäº†ä½ çš„æœ‹å‹åœˆ";case"reply":return e.replyToUser?"å›žå¤äº†ä½ çš„è¯„è®º":"å›žå¤äº†è¯„è®º";case"new_moment":return"å‘å¸ƒäº†æ–°çš„æœ‹å‹åœˆ";default:return"ä¸Žä½ äº’åŠ¨"}};return e.jsxs("div",{className:"h-full flex flex-col bg-white",children:[r&&e.jsx(ua,{}),e.jsx("div",{className:"glass-morphism",children:e.jsxs("div",{className:"px-4 py-3 flex items-center",children:[e.jsx("button",{onClick:()=>a("/moments",{replace:!0}),className:"w-10 h-10 rounded-full glass-effect flex items-center justify-center ios-button",children:e.jsx(os,{size:20,className:"text-gray-700"})}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900 ml-4",children:"æœ‹å‹åœˆæ¶ˆæ¯"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:0===i.length?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[e.jsxs("svg",{width:"80",height:"80",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",className:"mb-4",children:[e.jsx("path",{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}),e.jsx("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"})]}),e.jsx("p",{className:"text-base",children:"æš‚æ— æ¶ˆæ¯"})]}):e.jsx("div",{className:"divide-y divide-gray-100",children:i.map(t=>e.jsxs("div",{onClick:()=>{a("/wechat/moments")},className:"px-4 py-4 flex gap-3 active:bg-gray-50 transition-colors cursor-pointer",children:[e.jsx("div",{className:"flex-shrink-0",children:t.fromUserAvatar.startsWith("data:image")?e.jsx("img",{src:t.fromUserAvatar,alt:t.fromUserName,className:"w-12 h-12 rounded-md object-cover"}):e.jsx("div",{className:"w-12 h-12 rounded-md bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center text-white text-xl",children:t.fromUserAvatar})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-baseline justify-between mb-1",children:[e.jsx("span",{className:"font-medium text-gray-900",children:t.fromUserName}),e.jsx("span",{className:"text-xs text-gray-400 ml-2",children:d(t.timestamp)})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:x(t)}),t.comment&&e.jsx("div",{className:"bg-gray-100 rounded-lg px-3 py-2 mb-2",children:e.jsx("p",{className:"text-sm text-gray-700",children:t.comment})}),e.jsx("div",{className:"bg-gray-50 rounded-lg px-3 py-2",children:e.jsx("p",{className:"text-sm text-gray-500 line-clamp-2",children:t.momentContent})})]})]},t.id))})})]})}},Symbol.toStringTag,{value:"Module"})),gr=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M9 18l6-6-6-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),pr=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("rect",{x:"2",y:"5",width:"20",height:"14",rx:"2",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M2 10h20",stroke:"currentColor",strokeWidth:"2"})]}),fr=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M12 6v6l4 2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),br=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",stroke:"currentColor",strokeWidth:"2"})}),jr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),[l,n]=t.useState("0.00"),[i,c]=t.useState(!1),[d,x]=t.useState("");t.useEffect(()=>{const e=B();n(e.toFixed(2))},[]);const m=[{id:1,name:"é›¶é’±é€š",icon:pr,desc:"èµšæ”¶ç›Šï¼Œéšæ—¶ç”¨",path:""},{id:2,name:"äº¤æ˜“è®°å½•",icon:fr,desc:"",path:"/transaction-history"},{id:3,name:"å¸®åŠ©ä¸­å¿ƒ",icon:br,desc:"",path:"/wallet-help"}];return e.jsxs("div",{className:"h-full flex flex-col bg-[#EDEDED]",children:[r&&e.jsx(ua,{}),e.jsxs("div",{className:"bg-white flex items-center border-b border-gray-200",children:[e.jsx("button",{onClick:()=>{a("/services")},className:"px-4 py-4 active:opacity-50 cursor-pointer flex items-center justify-center",children:e.jsx(os,{size:24,className:"text-gray-900"})}),e.jsx("h1",{className:"flex-1 text-center text-[17px] font-medium text-gray-900 pr-14",children:"é›¶é’±"})]}),e.jsxs("div",{className:"bg-white px-5 pt-8 pb-6",children:[e.jsxs("div",{className:"flex items-center justify-center mb-2",children:[e.jsx(Cs,{size:20,className:"text-gray-500 mr-2"}),e.jsx("span",{className:"text-sm text-gray-500",children:"é›¶é’±"})]}),e.jsx("div",{className:"text-center mb-6",children:e.jsxs("span",{className:"text-[48px] font-light text-gray-900",children:["Â¥",l]})}),e.jsx("div",{children:e.jsx("button",{onClick:()=>c(!0),className:"w-full bg-[#07C160] text-white py-3 rounded-lg text-[16px] font-medium active:opacity-80",children:"å……å€¼"})})]}),e.jsx("div",{className:"bg-[#FFF9E6] px-4 py-3 mx-4 mt-3 rounded-lg",children:e.jsx("p",{className:"text-xs text-[#B8860B] leading-relaxed",children:"é›¶é’±å¯ç”¨äºŽå‘çº¢åŒ…ã€è½¬è´¦ç­‰ã€‚å……å€¼åŽä½™é¢å°†å®‰å…¨ä¿å­˜åœ¨æœ¬åœ°ã€‚"})}),e.jsx("div",{className:"bg-white mt-3 px-4",children:m.map((t,s)=>{const r=t.icon;return e.jsxs("div",{children:[e.jsxs("div",{onClick:()=>t.path&&a(t.path),className:"flex items-center py-4 active:bg-gray-50 cursor-pointer",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center mr-3",children:e.jsx(r,{size:20,className:"text-gray-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-[16px] text-gray-900",children:t.name}),t.desc&&e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:t.desc})]}),e.jsx(gr,{size:20,className:"text-gray-400"})]}),s<m.length-1&&e.jsx("div",{className:"border-b border-gray-100 ml-[52px]"})]},t.id)})}),e.jsx("div",{className:"mt-6 px-6 pb-6",children:e.jsx("p",{className:"text-xs text-gray-400 text-center leading-relaxed",children:"é›¶é’±èµ„é‡‘å°†äº«å—å¾®ä¿¡æ”¯ä»˜å®‰å…¨ä¿éšœ"})}),i&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:()=>c(!1),children:e.jsxs("div",{className:"bg-white rounded-2xl w-[85%] max-w-md p-6",onClick:e=>e.stopPropagation(),children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4 text-center",children:"å……å€¼é›¶é’±"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"å……å€¼é‡‘é¢"}),e.jsxs("div",{className:"flex items-center border-2 border-gray-200 rounded-lg px-4 py-3 focus-within:border-[#07C160]",children:[e.jsx("span",{className:"text-2xl text-gray-900 mr-2",children:"Â¥"}),e.jsx("input",{type:"number",value:d,onChange:e=>x(e.target.value),placeholder:"0.00",className:"flex-1 text-2xl outline-none",autoFocus:!0})]})]}),e.jsx("div",{className:"grid grid-cols-4 gap-2 mb-6",children:["100","200","500","1000"].map(t=>e.jsx("button",{onClick:()=>x(t),className:"py-2 border border-gray-300 rounded-lg text-gray-700 active:bg-gray-100",children:t},t))}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>c(!1),className:"flex-1 py-3 border border-gray-300 rounded-lg text-gray-700 active:bg-gray-100",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:()=>{const e=parseFloat(d);if(isNaN(e)||e<=0)return void alert("è¯·è¾“å…¥æœ‰æ•ˆçš„å……å€¼é‡‘é¢");if($e(e)){const e=B();n(e.toFixed(2)),x(""),c(!1)}},className:"flex-1 py-3 bg-[#07C160] text-white rounded-lg active:opacity-80",children:"ç¡®è®¤å……å€¼"})]})]})})]})}},Symbol.toStringTag,{value:"Module"})),vr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const r=s(),l=a(),{characterName:n,chatId:i}=l.state||{},{showStatusBar:c}=o(),[d,x]=t.useState(""),[m,h]=t.useState("");return e.jsxs("div",{className:"h-screen flex flex-col bg-gray-50",children:[c&&e.jsx(ua,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between bg-white border-b border-gray-200",children:[e.jsx("button",{onClick:()=>r(`/chat/${i}`,{replace:!0}),className:"text-gray-700 text-base",children:"å–æ¶ˆ"}),e.jsx("h1",{className:"text-base font-semibold text-gray-900",children:"è½¬è´¦"}),e.jsx("button",{onClick:()=>{!d||parseFloat(d)<=0?alert("è¯·è¾“å…¥è½¬è´¦é‡‘é¢"):r(`/chat/${i}`,{state:{transfer:{amount:parseFloat(d),message:m.trim()}}})},disabled:!d||parseFloat(d)<=0,className:"text-base font-medium "+(d&&parseFloat(d)>0?"text-[#576B95]":"text-gray-300"),children:"è½¬è´¦"})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsxs("div",{className:"bg-white px-5 py-4 mb-2",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1.5",children:"æ”¶æ¬¾æ–¹"}),e.jsx("div",{className:"text-[15px] text-gray-900 font-medium",children:n})]}),e.jsxs("div",{className:"bg-white flex-1 flex flex-col",children:[e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"w-full px-8",children:[e.jsxs("div",{className:"flex items-baseline justify-center mb-2",children:[e.jsx("span",{className:"text-[40px] font-normal text-gray-900 mr-1",children:"Â¥"}),e.jsx("input",{type:"text",inputMode:"decimal",value:d,onChange:e=>{const t=e.target.value;(""===t||/^\d*\.?\d{0,2}$/.test(t))&&x(t)},placeholder:"0.00",autoFocus:!0,className:"text-[56px] font-normal text-gray-900 bg-transparent border-none outline-none text-center flex-1 placeholder-gray-300",style:{minWidth:"200px",maxWidth:"100%",letterSpacing:"0.02em"}})]}),e.jsx("div",{className:"h-[1px] bg-gray-200 mx-auto",style:{width:"280px"}}),e.jsx("div",{className:"text-center mt-4 text-xs text-gray-400",children:"å•ç¬”è½¬è´¦é™é¢Â¥200,000.00"})]})}),e.jsx("div",{className:"px-5 py-4 border-t border-gray-100",children:e.jsx("input",{type:"text",value:m,onChange:e=>h(e.target.value),placeholder:"æ·»åŠ è½¬è´¦è¯´æ˜Ž",maxLength:20,className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400 text-[15px]"})})]})]})]})}},Symbol.toStringTag,{value:"Module"})),yr=({applyToAll:s=!1})=>{const{background:a,getBackgroundStyle:r}=c(),[l,n]=t.useState(()=>"true"===localStorage.getItem("apply_background_to_all_pages"));return t.useEffect(()=>{const e=()=>{n("true"===localStorage.getItem("apply_background_to_all_pages"))};window.addEventListener("storage",e);const t=setInterval(e,500);return()=>{window.removeEventListener("storage",e),clearInterval(t)}},[]),s&&!l?e.jsx("div",{className:"absolute inset-0 z-0",style:{background:"linear-gradient(to bottom, #f9fafb, #f3f4f6)"}}):e.jsx("div",{className:"absolute inset-0 z-0",style:a?r():{background:"linear-gradient(to bottom, #f9fafb, #f3f4f6)"}})},Nr=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M9 18l6-6-6-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),wr=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("rect",{x:"2",y:"5",width:"20",height:"14",rx:"2",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M2 10h20",stroke:"currentColor",strokeWidth:"2"})]}),kr=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("rect",{x:"3",y:"3",width:"7",height:"7",rx:"1",stroke:"currentColor",strokeWidth:"2"}),e.jsx("rect",{x:"14",y:"3",width:"7",height:"7",rx:"1",stroke:"currentColor",strokeWidth:"2"}),e.jsx("rect",{x:"3",y:"14",width:"7",height:"7",rx:"1",stroke:"currentColor",strokeWidth:"2"}),e.jsx("rect",{x:"14",y:"14",width:"7",height:"7",rx:"1",stroke:"currentColor",strokeWidth:"2"})]}),Cr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const t=s(),{showStatusBar:a}=o(),r=[{id:1,name:"é›¶é’±",icon:Cs,path:"/wallet",desc:"å®‰å…¨ä¾¿æ·çš„é›¶é’±åŒ…"},{id:2,name:"ä¿¡ç”¨å¡è¿˜æ¬¾",icon:wr,path:"",desc:"å…è´¹è¿˜æ¬¾ï¼Œå¿«é€Ÿåˆ°è´¦"},{id:3,name:"æ‰‹æœºå……å€¼",icon:kr,path:"",desc:"è¯è´¹å……å€¼ï¼Œä¼˜æƒ å¤šå¤š"}];return e.jsxs("div",{className:"h-full flex flex-col relative overflow-hidden",children:[e.jsx(yr,{applyToAll:!0}),e.jsxs("div",{className:"relative z-10 h-full flex flex-col",children:[a&&e.jsx(ua,{}),e.jsxs("div",{className:"glass-effect border-b border-gray-200/50 bg-white flex items-center",children:[e.jsx("button",{onClick:()=>{t("/wechat/me")},className:"px-4 py-4 active:opacity-50 cursor-pointer flex items-center justify-center",children:e.jsx(os,{size:24,className:"text-gray-900"})}),e.jsx("h1",{className:"flex-1 text-center text-[17px] font-semibold text-gray-900 pr-14",children:"æœåŠ¡"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-3 pt-3",children:e.jsx("div",{className:"glass-card rounded-2xl overflow-hidden bg-white",children:r.map((s,a)=>{const l=s.icon;return e.jsxs("div",{children:[e.jsxs("div",{onClick:()=>s.path&&t(s.path),className:"flex items-center px-4 py-4 ios-button cursor-pointer",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-orange-400 to-orange-500 rounded-xl flex items-center justify-center flex-shrink-0 shadow-lg",children:e.jsx(l,{size:24,className:"text-white"})}),e.jsxs("div",{className:"ml-4 flex-1",children:[e.jsx("div",{className:"text-[16px] font-medium text-gray-900",children:s.name}),s.desc&&e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:s.desc})]}),e.jsx(Nr,{size:20,className:"text-gray-400"})]}),a<r.length-1&&e.jsx("div",{className:"border-b border-gray-100 ml-[68px]"})]},s.id)})})})]})]})}},Symbol.toStringTag,{value:"Module"})),Sr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),[l,n]=t.useState([]);t.useEffect(()=>{n(Ae())},[]);const i=e=>{const t=new Date(e),s=new Date,a=new Date(s.getFullYear(),s.getMonth(),s.getDate()),r=new Date(a.getTime()-864e5),l=new Date(t.getFullYear(),t.getMonth(),t.getDate());return l.getTime()===a.getTime()?`ä»Šå¤© ${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`:l.getTime()===r.getTime()?`æ˜¨å¤© ${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`:`${t.getMonth()+1}æœˆ${t.getDate()}æ—¥ ${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`};return e.jsxs("div",{className:"h-screen flex flex-col bg-[#EDEDED]",children:[r&&e.jsx(ua,{}),e.jsxs("div",{className:"bg-white flex items-center border-b border-gray-200",children:[e.jsx("button",{onClick:()=>{a("/wallet")},className:"px-4 py-4 active:opacity-50 cursor-pointer flex items-center justify-center",children:e.jsx(os,{size:24,className:"text-gray-900"})}),e.jsx("h1",{className:"flex-1 text-center text-[17px] font-medium text-gray-900 pr-14",children:"äº¤æ˜“è®°å½•"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:0===l.length?e.jsx("div",{className:"flex flex-col items-center justify-center h-full",children:e.jsx("div",{className:"text-gray-400 text-sm",children:"æš‚æ— äº¤æ˜“è®°å½•"})}):e.jsx("div",{className:"bg-white mt-3",children:l.map(t=>{const s="recharge"===t.type||"red_envelope_receive"===t.type||"transfer_receive"===t.type,a="intimate_pay"===t.type;return e.jsxs("div",{className:"px-4 py-4 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-[16px] text-gray-900",children:t.description}),t.characterName&&e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:[t.characterName,a&&e.jsx("span",{className:"ml-2 text-pink-500",children:"äº²å¯†ä»˜"})]})]}),e.jsxs("span",{className:"text-[18px] font-medium "+(s?"text-[#07C160]":"text-gray-900"),children:[s?"+":"-","Â¥",t.amount]})]}),e.jsx("div",{className:"text-xs text-gray-500",children:i(t.timestamp)})]},t.id)})})})]})}},Symbol.toStringTag,{value:"Module"})),Ir=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),_r=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M12 5v14M5 12h14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),Mr=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M9 18l6-6-6-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),zr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),[l,n]=t.useState([]);t.useEffect(()=>{n(E())},[]);return e.jsxs("div",{className:"h-screen flex flex-col bg-[#EDEDED]",children:[r&&e.jsx(ua,{}),e.jsxs("div",{className:"bg-white flex items-center border-b border-gray-200",children:[e.jsx("button",{onClick:()=>a("/wechat/me"),className:"px-4 py-4 active:opacity-50 cursor-pointer flex items-center justify-center",children:e.jsx(os,{size:24,className:"text-gray-900"})}),e.jsx("h1",{className:"flex-1 text-center text-[17px] font-medium text-gray-900 pr-14",children:"å¡åŒ…"})]}),e.jsx("div",{className:"bg-white px-5 pt-6 pb-6 mt-3 mb-3",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-pink-400 to-red-400 rounded-full flex items-center justify-center mr-3",children:e.jsx(Ir,{size:20,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-[18px] font-semibold text-gray-900",children:"äº²å¯†ä»˜"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"ä¸ºå®¶äººæœ‹å‹ä»£ä»˜"})]})]})})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-3 pb-3",children:0===l.length?e.jsxs("div",{className:"bg-white rounded-2xl p-8 text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Ir,{size:32,className:"text-gray-400"})}),e.jsx("p",{className:"text-gray-500 text-sm mb-6",children:"è¿˜æ²¡æœ‰å¼€é€šäº²å¯†ä»˜"}),e.jsx("button",{onClick:()=>a("/intimate-pay/create"),className:"bg-[#07C160] text-white px-8 py-3 rounded-lg text-[15px] font-medium active:opacity-80",children:"å¼€é€šäº²å¯†ä»˜"})]}):e.jsxs(e.Fragment,{children:[l.map(t=>{const s=(e=>e.monthlyLimit-e.usedAmount)(t),r=(e=>e.usedAmount/e.monthlyLimit*100)(t);return e.jsxs("div",{onClick:()=>a(`/intimate-pay/detail/${t.characterId}`),className:"bg-white rounded-2xl p-4 mb-3 active:bg-gray-50 cursor-pointer",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center flex-shrink-0 overflow-hidden",children:t.characterAvatar?e.jsx("img",{src:t.characterAvatar,alt:t.characterName,className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-gray-500 text-lg",children:t.characterName[0]})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-[16px] font-medium text-gray-900",children:t.characterName}),e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-pink-100 text-pink-600",children:"user_to_character"===t.type?"ä½ å¼€é€š":"TAå¼€é€š"})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:["user_to_character"===t.type?"TAæœ¬æœˆå‰©ä½™":"ä½ æœ¬æœˆå‰©ä½™"," Â¥",s.toFixed(2)]})]}),e.jsx(Mr,{size:20,className:"text-gray-400"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[e.jsxs("span",{children:["å·²ç”¨ Â¥",t.usedAmount.toFixed(2)]}),e.jsxs("span",{children:["æ€»é¢åº¦ Â¥",t.monthlyLimit.toFixed(2)]})]}),e.jsx("div",{className:"w-full h-2 bg-gray-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-pink-400 to-red-400 rounded-full transition-all",style:{width:`${Math.min(r,100)}%`}})})]})]},t.id)}),e.jsxs("button",{onClick:()=>a("/intimate-pay/create"),className:"w-full bg-white rounded-2xl p-4 flex items-center justify-center active:bg-gray-50",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center mr-3",children:e.jsx(_r,{size:20,className:"text-gray-600"})}),e.jsx("span",{className:"text-[16px] text-gray-900 font-medium",children:"å¼€é€šæ–°çš„äº²å¯†ä»˜"})]})]})})]})}},Symbol.toStringTag,{value:"Module"})),Lr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{characterId:l}=r(),{showStatusBar:i}=o(),{characters:c}=n(),[d,x]=t.useState(""),[m,h]=t.useState(""),[u,g]=t.useState(!1),[p,f]=t.useState([]);t.useEffect(()=>{const e=E();f(e.map(e=>e.characterId))},[]);const b=c.filter(e=>!p.includes(e.id));return e.jsxs("div",{className:"h-screen flex flex-col bg-[#EDEDED]",children:[i&&e.jsx(ua,{}),e.jsxs("div",{className:"bg-white flex items-center justify-between border-b border-gray-200",children:[e.jsx("button",{onClick:()=>a(-1),className:"px-4 py-4 active:opacity-50 cursor-pointer flex items-center justify-center",children:e.jsx(os,{size:24,className:"text-gray-900"})}),e.jsx("h1",{className:"absolute left-1/2 transform -translate-x-1/2 text-[17px] font-medium text-gray-900 pointer-events-none",children:"å¼€é€šäº²å¯†ä»˜"}),e.jsx("button",{onClick:()=>{if(!d)return void alert("è¯·é€‰æ‹©è¦å¼€é€šäº²å¯†ä»˜çš„è”ç³»äºº");const e=parseFloat(m);if(isNaN(e)||e<=0)return void alert("è¯·è¾“å…¥æœ‰æ•ˆçš„æœˆé¢åº¦");c.find(e=>e.id===d)?a(`/chat/${d}`,{state:{sendIntimatePay:!0,monthlyLimit:e}}):alert("è§’è‰²ä¸å­˜åœ¨")},disabled:!d||!m,className:"px-4 py-4 text-[16px] "+(d&&m?"text-[#07C160]":"text-gray-400"),children:"å®Œæˆ"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"bg-white mt-3 px-4 py-3",children:[e.jsx("h2",{className:"text-sm text-gray-500 mb-3",children:"é€‰æ‹©è”ç³»äºº"}),0===b.length?e.jsx("div",{className:"text-center py-8 text-gray-400 text-sm",children:"æš‚æ— å¯å¼€é€šçš„è”ç³»äºº"}):e.jsx("div",{className:"space-y-2",children:b.map(t=>e.jsxs("div",{onClick:()=>{return e=t.id,void x(e);var e},className:"flex items-center p-3 rounded-xl cursor-pointer transition-colors "+(d===t.id?"bg-green-50 border-2 border-[#07C160]":"bg-gray-50 border-2 border-transparent active:bg-gray-100"),children:[e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center flex-shrink-0 overflow-hidden",children:t.avatar.startsWith("data:image")?e.jsx("img",{src:t.avatar,alt:t.name,className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-2xl",children:t.avatar})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("div",{className:"text-[16px] font-medium text-gray-900",children:t.name}),t.signature&&e.jsx("div",{className:"text-xs text-gray-500 mt-0.5 truncate",children:t.signature})]}),d===t.id&&e.jsx("div",{className:"w-6 h-6 bg-[#07C160] rounded-full flex items-center justify-center",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M5 12l5 5L20 7",stroke:"white",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"})})})]},t.id))})]}),d&&e.jsxs("div",{className:"bg-white mt-3 px-4 py-3",children:[e.jsx("h2",{className:"text-sm text-gray-500 mb-3",children:"è®¾ç½®æœˆé¢åº¦"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:[{label:"500å…ƒ/æœˆ",value:500},{label:"1000å…ƒ/æœˆ",value:1e3},{label:"2000å…ƒ/æœˆ",value:2e3},{label:"3000å…ƒ/æœˆ",value:3e3},{label:"5000å…ƒ/æœˆ",value:5e3},{label:"è‡ªå®šä¹‰",value:0}].map(t=>e.jsx("button",{onClick:()=>{var e;0===(e=t.value)?(g(!0),h("")):(g(!1),h(e.toString()))},className:"py-3 rounded-xl text-[15px] font-medium transition-colors "+(0===t.value&&u||t.value>0&&m===t.value.toString()?"bg-green-50 text-[#07C160] border-2 border-[#07C160]":"bg-gray-50 text-gray-700 border-2 border-transparent active:bg-gray-100"),children:t.label},t.label))}),u&&e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"flex items-center border-2 border-[#07C160] rounded-xl px-4 py-3 bg-white",children:[e.jsx("span",{className:"text-xl text-gray-900 mr-2",children:"Â¥"}),e.jsx("input",{type:"number",value:m,onChange:e=>h(e.target.value),placeholder:"è¯·è¾“å…¥æœˆé¢åº¦",className:"flex-1 text-xl outline-none",autoFocus:!0}),e.jsx("span",{className:"text-sm text-gray-500",children:"/æœˆ"})]})})]}),d&&m&&e.jsxs("div",{className:"bg-[#FFF9E6] mx-4 mt-4 p-4 rounded-xl",children:[e.jsxs("p",{className:"text-xs text-[#B8860B] leading-relaxed",children:["â€¢ å¼€é€šåŽï¼Œå¯¹æ–¹æ¯æœˆå¯ä½¿ç”¨æ‚¨çš„é›¶é’±è¿›è¡Œæ¶ˆè´¹ï¼Œæœ€é«˜é¢åº¦ä¸º Â¥",m]}),e.jsx("p",{className:"text-xs text-[#B8860B] leading-relaxed mt-2",children:"â€¢ æ¯æœˆ1æ—¥è‡ªåŠ¨é‡ç½®é¢åº¦ï¼Œæ¶ˆè´¹è®°å½•å¯åœ¨é›¶é’±äº¤æ˜“è®°å½•ä¸­æŸ¥çœ‹"}),e.jsx("p",{className:"text-xs text-[#B8860B] leading-relaxed mt-2",children:"â€¢ æ‚¨å¯ä»¥éšæ—¶ä¿®æ”¹é¢åº¦æˆ–å…³é—­äº²å¯†ä»˜"})]})]})]})}},Symbol.toStringTag,{value:"Module"})),$r=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{characterId:l}=r(),{showStatusBar:n}=o(),[i,c]=t.useState(null),[d,x]=t.useState(!1),[m,h]=t.useState("");if(t.useEffect(()=>{if(l){const e=Te(l);c(e),e&&h(e.monthlyLimit.toString())}},[l]),!i)return e.jsxs("div",{className:"h-screen flex flex-col bg-[#EDEDED]",children:[n&&e.jsx(ua,{}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400 text-sm",children:"æœªæ‰¾åˆ°äº²å¯†ä»˜å…³ç³»"})})]});const u=i.monthlyLimit-i.usedAmount,g=i.usedAmount/i.monthlyLimit*100;return e.jsxs("div",{className:"h-screen flex flex-col bg-[#EDEDED]",children:[n&&e.jsx(ua,{}),e.jsxs("div",{className:"bg-white flex items-center border-b border-gray-200",children:[e.jsx("button",{onClick:()=>a("/card-wallet"),className:"px-4 py-4 active:opacity-50 cursor-pointer flex items-center justify-center",children:e.jsx(os,{size:24,className:"text-gray-900"})}),e.jsx("h1",{className:"flex-1 text-center text-[17px] font-medium text-gray-900 pr-14",children:"user_to_character"===i.type?"ä¸ºå¯¹æ–¹å¼€é€šçš„äº²å¯†ä»˜":"å¯¹æ–¹ä¸ºä½ å¼€é€šçš„äº²å¯†ä»˜"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"bg-white mt-3 px-5 py-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center flex-shrink-0 overflow-hidden",children:i.characterAvatar?i.characterAvatar.startsWith("data:image")?e.jsx("img",{src:i.characterAvatar,alt:i.characterName,className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-3xl",children:i.characterAvatar}):e.jsx("span",{className:"text-gray-500 text-2xl",children:i.characterName[0]})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-[18px] font-semibold text-gray-900",children:i.characterName}),e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:["å¼€é€šäºŽ ",(e=>{const t=new Date(e);return`${t.getFullYear()}å¹´${t.getMonth()+1}æœˆ${t.getDate()}æ—¥`})(i.createdAt)]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-pink-50 to-red-50 rounded-2xl p-5",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"user_to_character"===i.type?"å¯¹æ–¹æœ¬æœˆå‰©ä½™é¢åº¦":"ä½ æœ¬æœˆå‰©ä½™é¢åº¦"}),e.jsxs("div",{className:"text-[36px] font-light text-gray-900 mb-4",children:["Â¥",u.toFixed(2)]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-600",children:[e.jsxs("span",{children:["å·²ç”¨ Â¥",i.usedAmount.toFixed(2)]}),e.jsxs("span",{children:["æ€»é¢åº¦ Â¥",i.monthlyLimit.toFixed(2)]})]}),e.jsx("div",{className:"w-full h-2 bg-white rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-pink-400 to-red-400 rounded-full transition-all",style:{width:`${Math.min(g,100)}%`}})})]})]})]}),e.jsxs("div",{className:"bg-white mt-3 px-4",children:["user_to_character"===i.type&&e.jsxs("button",{onClick:()=>x(!0),className:"w-full flex items-center justify-between py-4 border-b border-gray-100 active:bg-gray-50",children:[e.jsx("span",{className:"text-[16px] text-gray-900",children:"ä¿®æ”¹æœˆé¢åº¦"}),e.jsxs("div",{className:"flex items-center",children:[e.jsxs("span",{className:"text-sm text-gray-500 mr-2",children:["å½“å‰ Â¥",i.monthlyLimit.toFixed(2),"/æœˆ"]}),e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M9 18l6-6-6-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]})]}),e.jsx("button",{onClick:()=>{confirm(`ç¡®å®šè¦å…³é—­ä¸Ž ${i.characterName} çš„äº²å¯†ä»˜å—ï¼Ÿ`)&&(l&&De(l)?(alert("å·²å…³é—­äº²å¯†ä»˜"),a("/card-wallet")):alert("å…³é—­å¤±è´¥"))},className:"w-full py-4 text-[16px] text-red-500 active:bg-gray-50",children:"å…³é—­äº²å¯†ä»˜"})]}),e.jsx("div",{className:"px-4 mt-6 pb-6",children:e.jsxs("div",{className:"bg-[#FFF9E6] p-4 rounded-xl",children:[e.jsx("p",{className:"text-xs text-[#B8860B] leading-relaxed",children:"â€¢ æ¯æœˆ1æ—¥è‡ªåŠ¨é‡ç½®é¢åº¦"}),"user_to_character"===i.type?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs text-[#B8860B] leading-relaxed mt-2",children:"â€¢ å¯¹æ–¹çš„æ¶ˆè´¹è®°å½•å¯åœ¨é›¶é’±äº¤æ˜“è®°å½•ä¸­æŸ¥çœ‹"}),e.jsx("p",{className:"text-xs text-[#B8860B] leading-relaxed mt-2",children:"â€¢ ä½ å¯ä»¥éšæ—¶ä¿®æ”¹é¢åº¦æˆ–å…³é—­äº²å¯†ä»˜"})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs text-[#B8860B] leading-relaxed mt-2",children:"â€¢ ä½ çš„æ¶ˆè´¹è®°å½•å¯¹æ–¹å¯ä»¥æŸ¥çœ‹"}),e.jsx("p",{className:"text-xs text-[#B8860B] leading-relaxed mt-2",children:"â€¢ å¯¹æ–¹å¯ä»¥éšæ—¶ä¿®æ”¹é¢åº¦æˆ–å…³é—­äº²å¯†ä»˜"}),e.jsx("p",{className:"text-xs text-[#B8860B] leading-relaxed mt-2 font-semibold",children:"â€¢ ä½ æ— æ³•ä¿®æ”¹å¯¹æ–¹ä¸ºä½ å¼€é€šçš„äº²å¯†ä»˜é¢åº¦"})]})]})})]}),d&&"user_to_character"===i.type&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:()=>x(!1),children:e.jsxs("div",{className:"bg-white rounded-2xl w-[85%] max-w-md p-6",onClick:e=>e.stopPropagation(),children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4 text-center",children:"ä¿®æ”¹æœˆé¢åº¦"}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center border-2 border-[#07C160] rounded-lg px-4 py-3",children:[e.jsx("span",{className:"text-2xl text-gray-900 mr-2",children:"Â¥"}),e.jsx("input",{type:"number",value:m,onChange:e=>h(e.target.value),placeholder:"0.00",className:"flex-1 text-2xl outline-none",autoFocus:!0}),e.jsx("span",{className:"text-sm text-gray-500 ml-2",children:"/æœˆ"})]})}),e.jsx("div",{className:"grid grid-cols-3 gap-2 mb-6",children:[500,1e3,2e3,3e3,5e3,1e4].map(t=>e.jsx("button",{onClick:()=>h(t.toString()),className:"py-2 border border-gray-300 rounded-lg text-gray-700 active:bg-gray-100",children:t},t))}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>x(!1),className:"flex-1 py-3 border border-gray-300 rounded-lg text-gray-700 active:bg-gray-100",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:()=>{if("user_to_character"!==(null==i?void 0:i.type))return alert("æ— æ³•ä¿®æ”¹å¯¹æ–¹ä¸ºä½ å¼€é€šçš„äº²å¯†ä»˜é¢åº¦"),void x(!1);const e=parseFloat(m);if(isNaN(e)||e<=0)alert("è¯·è¾“å…¥æœ‰æ•ˆçš„é¢åº¦");else if(l&&Ee(l,e)){const e=Te(l);c(e),x(!1),alert("é¢åº¦ä¿®æ”¹æˆåŠŸ")}else alert("ä¿®æ”¹å¤±è´¥")},className:"flex-1 py-3 bg-[#07C160] text-white rounded-lg active:opacity-80",children:"ç¡®è®¤"})]})]})})]})}},Symbol.toStringTag,{value:"Module"})),Ar=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{characterId:l,monthlyLimit:i}=r(),{showStatusBar:c}=o(),{getCharacter:d}=n(),[x,m]=t.useState(null);t.useEffect(()=>{if(l){const e=d(l);m(e)}},[l,d]);const h=e=>{var t;if(!l||!x)return;const s=`chat_messages_${l}`,a=localStorage.getItem(s);if(a){const r=JSON.parse(a);for(let a=r.length-1;a>=0;a--)if("intimate_pay"===r[a].messageType&&"received"===r[a].type&&"pending"===(null==(t=r[a].intimatePay)?void 0:t.status)){r[a].intimatePay.status=e;const t={id:Date.now(),type:"system",content:"accepted"===e?`ä½ æŽ¥å—äº†${x.name}çš„äº²å¯†ä»˜`:`ä½ æ‹’ç»äº†${x.name}çš„äº²å¯†ä»˜`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"system"};r.push(t),localStorage.setItem(s,JSON.stringify(r));break}}};return x&&i?e.jsxs("div",{className:"h-screen flex flex-col bg-[#EDEDED]",children:[c&&e.jsx(ua,{}),e.jsxs("div",{className:"bg-white flex items-center border-b border-gray-200",children:[e.jsx("button",{onClick:()=>a(`/chat/${l}`,{replace:!0}),className:"px-4 py-4 active:opacity-50 cursor-pointer flex items-center justify-center",children:e.jsx(os,{size:24,className:"text-gray-900"})}),e.jsx("h1",{className:"flex-1 text-center text-[17px] font-medium text-gray-900 pr-14",children:"æŽ¥å—äº²å¯†ä»˜"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 pt-6",children:[e.jsx("div",{className:"bg-white rounded-2xl p-6 mb-4",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-200 rounded-full flex items-center justify-center mb-4 overflow-hidden",children:x.avatar.startsWith("data:image")?e.jsx("img",{src:x.avatar,alt:x.name,className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-4xl",children:x.avatar})}),e.jsx("div",{className:"text-lg font-semibold text-gray-900 mb-2",children:x.name}),e.jsx("div",{className:"text-sm text-gray-500",children:"ä¸ºä½ å¼€é€šäº†äº²å¯†ä»˜"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-pink-50 to-red-50 rounded-2xl p-6 mb-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"æ¯æœˆå¯ç”¨é¢åº¦"}),e.jsxs("div",{className:"text-[48px] font-light text-gray-900 mb-4",children:["Â¥",parseFloat(i).toFixed(2)]}),e.jsx("div",{className:"w-16 h-16 rounded-full flex items-center justify-center mx-auto overflow-hidden",children:e.jsx("img",{src:Fa,alt:"äº²å¯†ä»˜",className:"w-full h-full object-cover"})})]})}),e.jsxs("div",{className:"bg-[#FFF9E6] rounded-2xl p-4 mb-6",children:[e.jsx("div",{className:"text-sm font-medium text-[#B8860B] mb-2",children:"äº²å¯†ä»˜è¯´æ˜Ž"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-[#B8860B] leading-relaxed",children:"â€¢ æŽ¥å—åŽï¼Œä½ æ¯æœˆå¯ä½¿ç”¨å¯¹æ–¹çš„é›¶é’±è¿›è¡Œæ¶ˆè´¹"}),e.jsx("p",{className:"text-xs text-[#B8860B] leading-relaxed",children:"â€¢ æ¯æœˆ1æ—¥è‡ªåŠ¨é‡ç½®é¢åº¦"}),e.jsx("p",{className:"text-xs text-[#B8860B] leading-relaxed",children:"â€¢ å¯¹æ–¹å¯ä»¥éšæ—¶æŸ¥çœ‹ä½ çš„æ¶ˆè´¹è®°å½•"}),e.jsx("p",{className:"text-xs text-[#B8860B] leading-relaxed",children:"â€¢ å¯¹æ–¹å¯ä»¥éšæ—¶ä¿®æ”¹é¢åº¦æˆ–å…³é—­äº²å¯†ä»˜"})]})]}),e.jsxs("div",{className:"space-y-3 pb-6",children:[e.jsx("button",{onClick:()=>{if(!l||!i||!x)return void alert("å‚æ•°é”™è¯¯");const e=parseFloat(i);if(isNaN(e)||e<=0)return void alert("é¢åº¦æ— æ•ˆ");Be(x.id,x.name,e,x.avatar)?(h("accepted"),alert("å·²æŽ¥å—äº²å¯†ä»˜ï¼"),a(`/chat/${l}`,{replace:!0})):alert("æŽ¥å—å¤±è´¥ï¼Œå¯èƒ½å·²ç»å¼€é€šè¿‡äº†")},className:"w-full bg-gradient-to-r from-pink-400 to-red-400 text-white py-4 rounded-xl text-[16px] font-medium active:opacity-80 shadow-lg",children:"æŽ¥å—äº²å¯†ä»˜"}),e.jsx("button",{onClick:()=>{confirm("ç¡®å®šè¦æ‹’ç»è¿™ä¸ªäº²å¯†ä»˜å—ï¼Ÿ")&&(h("rejected"),a(`/chat/${l}`,{replace:!0}))},className:"w-full bg-white text-gray-700 py-4 rounded-xl text-[16px] font-medium active:bg-gray-50 border border-gray-200",children:"æš‚ä¸æŽ¥å—"})]})]})]}):e.jsxs("div",{className:"h-screen flex flex-col bg-[#EDEDED]",children:[c&&e.jsx(ua,{}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400 text-sm",children:"åŠ è½½ä¸­..."})})]})}},Symbol.toStringTag,{value:"Module"})),Tr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const t=s(),{showStatusBar:a}=o();return e.jsxs("div",{className:"h-screen flex flex-col bg-[#EDEDED]",children:[a&&e.jsx(ua,{}),e.jsxs("div",{className:"bg-white flex items-center border-b border-gray-200",children:[e.jsx("button",{onClick:()=>{t("/wallet")},className:"px-4 py-4 active:opacity-50 cursor-pointer flex items-center justify-center",children:e.jsx(os,{size:24,className:"text-gray-900"})}),e.jsx("h1",{className:"flex-1 text-center text-[17px] font-medium text-gray-900 pr-14",children:"å¸®åŠ©ä¸­å¿ƒ"})]}),e.jsxs("div",{className:"bg-gradient-to-r from-pink-50 to-purple-50 px-5 py-6 mx-4 mt-4 rounded-2xl",children:[e.jsx("div",{className:"text-center mb-2",children:e.jsx("span",{className:"text-4xl",children:"ðŸ’¡"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-800 text-center mb-2",children:"æ¬¢è¿Žæ¥åˆ°å¸®åŠ©ä¸­å¿ƒ~ âœ¨"}),e.jsx("p",{className:"text-sm text-gray-600 text-center",children:"æœ‰ä»»ä½•ç–‘é—®éƒ½å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°ç­”æ¡ˆå“¦ï¼"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-4",children:[{id:1,emoji:"ðŸ’°",title:"é›¶é’±æ˜¯ä»€ä¹ˆï¼Ÿ",content:"é›¶é’±æ˜¯ä½ çš„è™šæ‹Ÿé’±åŒ…ï¼Œå¯ä»¥ç”¨æ¥å‘çº¢åŒ…ã€è½¬è´¦ç»™AIæœ‹å‹å“¦~"},{id:2,emoji:"ðŸ’",title:"å¦‚ä½•å……å€¼ï¼Ÿ",content:"ç‚¹å‡»å……å€¼æŒ‰é’®ï¼Œè¾“å…¥é‡‘é¢å°±å¯ä»¥å•¦ï¼æ”¯æŒå¿«æ·é‡‘é¢é€‰æ‹©ï¼Œè¶…æ–¹ä¾¿çš„~"},{id:3,emoji:"ðŸŽ",title:"å‘çº¢åŒ…å’Œè½¬è´¦",content:"åœ¨èŠå¤©ç•Œé¢ç‚¹å‡»+å·ï¼Œå°±èƒ½ç»™AIæœ‹å‹å‘çº¢åŒ…æˆ–è½¬è´¦å•¦ï¼è®°å¾—å…ˆå……å€¼å“¦~"},{id:4,emoji:"ðŸ’–",title:"äº²å¯†ä»˜æ˜¯ä»€ä¹ˆï¼Ÿ",content:"äº²å¯†ä»˜å¯ä»¥è®©ä½ çš„AIæœ‹å‹æ¯æœˆä½¿ç”¨ä¸€å®šé¢åº¦çš„é›¶é’±ï¼Œå°±åƒçœŸæ­£çš„äº²å¯†å…³ç³»ä¸€æ ·å‘¢~ âœ¨"},{id:5,emoji:"ðŸ“Š",title:"äº¤æ˜“è®°å½•",content:"æ‰€æœ‰çš„å……å€¼ã€çº¢åŒ…ã€è½¬è´¦è®°å½•éƒ½ä¼šä¿å­˜åœ¨äº¤æ˜“è®°å½•é‡Œï¼Œéšæ—¶å¯ä»¥æŸ¥çœ‹~"},{id:6,emoji:"ðŸ”’",title:"å®‰å…¨æç¤º",content:"ä½ çš„é›¶é’±æ•°æ®å®‰å…¨ä¿å­˜åœ¨æœ¬åœ°æµè§ˆå™¨ä¸­ï¼Œè¯·ä¸è¦æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å“¦ï¼"}].map(t=>e.jsx("div",{className:"bg-white rounded-2xl p-4 mb-3 shadow-sm",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("span",{className:"text-3xl mr-3",children:t.emoji}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-[16px] font-semibold text-gray-900 mb-2",children:t.title}),e.jsx("p",{className:"text-sm text-gray-600 leading-relaxed",children:t.content})]})]})},t.id))}),e.jsx("div",{className:"bg-white border-t border-gray-100 px-6 py-4",children:e.jsx("p",{className:"text-xs text-gray-400 text-center leading-relaxed",children:"ðŸ’• è¿˜æœ‰é—®é¢˜ï¼Ÿè¯•è¯•å’ŒAIæœ‹å‹èŠèŠå¤©å§~ ðŸ’•"})})]})}},Symbol.toStringTag,{value:"Module"})),Dr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const{characterId:a}=r(),l=a,i=s(),{showStatusBar:c}=o(),{getCharacter:d}=n(),x=l?d(l):void 0,[m,h]=t.useState([]),[u,g]=t.useState("all"),[p,f]=t.useState(""),[b,j]=t.useState(null);t.useEffect(()=>{l&&v()},[l,u,p]);const v=()=>{if(!l)return;const e=U.getSystem(l),t={};"all"!==u&&(t.type=u),p&&(t.keyword=p);const s=e.searchMemories(t);h(s),j(e.getStatistics())},y=e=>{const t=new Date(e),s=(new Date).getTime()-t.getTime(),a=Math.floor(s/864e5);return 0===a?"ä»Šå¤©":1===a?"æ˜¨å¤©":a<7?`${a}å¤©å‰`:a<30?`${Math.floor(a/7)}å‘¨å‰`:a<365?`${Math.floor(a/30)}ä¸ªæœˆå‰`:`${Math.floor(a/365)}å¹´å‰`};return e.jsxs("div",{className:"h-full flex flex-col bg-gray-50",children:[e.jsxs("div",{className:"glass-effect sticky top-0 z-50",children:[c&&e.jsx(ua,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>i(`/chat-settings/${l}`,{replace:!0}),className:"ios-button text-gray-700 hover:text-gray-900",children:e.jsx(os,{size:24})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-base font-semibold text-gray-900",children:[null==x?void 0:x.name," çš„è®°å¿†"]}),b&&e.jsxs("p",{className:"text-xs text-gray-500",children:["å…± ",b.total," æ¡è®°å¿†"]})]})]}),e.jsx("button",{onClick:()=>{if(!l)return;const e=U.getSystem(l).exportMemories(),t=new Blob([e],{type:"application/json"}),s=URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download=`${null==x?void 0:x.name}_memories_${Date.now()}.json`,a.click()},className:"text-sm text-blue-500 hover:text-blue-600",children:"å¯¼å‡º"})]})]}),b&&e.jsx("div",{className:"bg-white p-4 border-b border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-5 gap-2",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-gray-900",children:b.byType.fact}),e.jsx("div",{className:"text-xs text-gray-500",children:"äº‹å®ž"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-gray-900",children:b.byType.preference}),e.jsx("div",{className:"text-xs text-gray-500",children:"åå¥½"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-gray-900",children:b.byType.event}),e.jsx("div",{className:"text-xs text-gray-500",children:"äº‹ä»¶"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-gray-900",children:b.byType.emotion}),e.jsx("div",{className:"text-xs text-gray-500",children:"æƒ…ç»ª"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-gray-900",children:b.byType.relationship}),e.jsx("div",{className:"text-xs text-gray-500",children:"å…³ç³»"})]})]})}),e.jsxs("div",{className:"bg-white p-4 border-b border-gray-200",children:[e.jsx("input",{type:"text",placeholder:"æœç´¢è®°å¿†...",value:p,onChange:e=>f(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg mb-3 focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2",children:[e.jsx("button",{onClick:()=>g("all"),className:"px-3 py-1 rounded-full text-sm whitespace-nowrap transition-all "+("all"===u?"bg-gray-900 text-white":"glass-card text-gray-700"),children:"å…¨éƒ¨"}),e.jsx("button",{onClick:()=>g("fact"),className:"px-3 py-1 rounded-full text-sm whitespace-nowrap transition-all "+("fact"===u?"bg-gray-900 text-white":"glass-card text-gray-700"),children:"äº‹å®ž"}),e.jsx("button",{onClick:()=>g("preference"),className:"px-3 py-1 rounded-full text-sm whitespace-nowrap transition-all "+("preference"===u?"bg-gray-900 text-white":"glass-card text-gray-700"),children:"åå¥½"}),e.jsx("button",{onClick:()=>g("event"),className:"px-3 py-1 rounded-full text-sm whitespace-nowrap transition-all "+("event"===u?"bg-gray-900 text-white":"glass-card text-gray-700"),children:"äº‹ä»¶"}),e.jsx("button",{onClick:()=>g("emotion"),className:"px-3 py-1 rounded-full text-sm whitespace-nowrap transition-all "+("emotion"===u?"bg-gray-900 text-white":"glass-card text-gray-700"),children:"æƒ…ç»ª"}),e.jsx("button",{onClick:()=>g("relationship"),className:"px-3 py-1 rounded-full text-sm whitespace-nowrap transition-all "+("relationship"===u?"bg-gray-900 text-white":"glass-card text-gray-700"),children:"å…³ç³»"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:0===m.length?e.jsxs("div",{className:"text-center py-12 text-gray-400",children:[e.jsx("img",{src:Ya,alt:"è®°å¿†",className:"w-20 h-20 mx-auto mb-3 opacity-30"}),e.jsx("div",{children:"æš‚æ— è®°å¿†"})]}):m.map(t=>{return e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("span",{className:"px-2 py-1 rounded text-xs font-medium "+(t.type,"bg-gray-100 text-gray-900"),children:(s=t.type,{fact:"äº‹å®ž",preference:"åå¥½",event:"äº‹ä»¶",emotion:"æƒ…ç»ª",relationship:"å…³ç³»"}[s])}),e.jsx("button",{onClick:()=>(e=>{if(l&&confirm("ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å¿†å—ï¼Ÿ")){const t=U.getSystem(l);t.memories.delete(e),t.saveMemories(),v()}})(t.id),className:"text-gray-400 hover:text-red-500 text-xs",children:"åˆ é™¤"})]}),e.jsx("div",{className:"text-gray-800 mb-2",children:t.content}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{children:["é‡è¦åº¦: ",t.importance.toFixed(1),"/10"]}),e.jsxs("span",{children:["è®¿é—®: ",t.accessCount,"æ¬¡"]})]}),e.jsx("span",{children:y(t.timestamp)})]}),t.tags.length>0&&e.jsx("div",{className:"mt-2 flex gap-1 flex-wrap",children:t.tags.map((t,s)=>e.jsxs("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 rounded text-xs",children:["#",t]},s))})]},t.id);var s})})]})}},Symbol.toStringTag,{value:"Module"})),Er=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const{characterId:a}=r(),l=a,i=s(),{showStatusBar:c}=o(),{getCharacter:d}=n(),x=l?d(l):void 0,m=Ga(l||"",null==x?void 0:x.name,null==x?void 0:x.description),[h,u]=t.useState(""),[g,p]=t.useState(30),[f,b]=t.useState(!1);t.useEffect(()=>{if(l){const e=localStorage.getItem(`memory_summary_${l}`);e&&u(e);const t=localStorage.getItem(`memory_summary_interval_${l}`);t&&p(parseInt(t))}},[l]);return x?e.jsxs("div",{className:"h-full flex flex-col bg-gray-50",children:[e.jsxs("div",{className:"glass-effect sticky top-0 z-50",children:[c&&e.jsx(ua,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>i(`/chat-settings/${l}`,{replace:!0}),className:"ios-button text-gray-700 hover:text-gray-900 -ml-2",children:e.jsx(os,{size:24})}),e.jsx("h1",{className:"text-base font-semibold text-gray-900",children:"è®°å¿†æ€»ç»“"}),e.jsx("button",{onClick:async()=>{if(l&&!f)try{b(!0);const e=localStorage.getItem(`chat_messages_${l}`);if(!e)return void alert("æš‚æ— èŠå¤©è®°å½•");const t=JSON.parse(e),s=t.filter(e=>"sent"===e.type),a=t.filter(e=>"received"===e.type);if(0===s.length||0===a.length)return void alert("èŠå¤©è®°å½•ä¸è¶³ï¼Œæ— æ³•ç”Ÿæˆæ€»ç»“");const r=s.slice(-50),n=a.slice(-50),i=r.map(e=>e.content||e.emojiDescription||e.photoDescription||e.voiceText||"").join("\n"),c=n.map(e=>e.content||e.emojiDescription||e.photoDescription||e.voiceText||"").join("\n"),o=await m.extractMemories(i,c);if(o.summary&&o.summary.trim()){const e=localStorage.getItem(`memory_summary_${l}`)||"",t=e+(e?"\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n":"")+`ã€æ‰‹åŠ¨æ€»ç»“ - ${(new Date).toLocaleString("zh-CN")}ã€‘\n\n${o.summary}`;u(t),localStorage.setItem(`memory_summary_${l}`,t),alert("æ€»ç»“å·²æ›´æ–°ï¼")}else alert("å¯¹è¯å†…å®¹å¤ªå°‘ï¼Œæš‚æ—¶æ— æ³•ç”Ÿæˆæ€»ç»“ã€‚è¯·ç»§ç»­èŠå¤©åŽå†è¯•ã€‚")}catch(e){alert("ç”Ÿæˆæ€»ç»“å¤±è´¥ï¼Œè¯·æ£€æŸ¥ API è®¾ç½®")}finally{b(!1)}},disabled:f,className:"text-sm font-medium px-3 py-1 rounded-lg transition-colors "+(f?"text-gray-400 bg-gray-100 cursor-not-allowed":"text-wechat-primary bg-wechat-primary/10 hover:bg-wechat-primary/20"),children:f?"ç”Ÿæˆä¸­...":"æ‰‹åŠ¨æ€»ç»“"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:h?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx("img",{src:er,alt:"æ€»ç»“",className:"w-6 h-6 object-contain"}),e.jsx("span",{children:"å…³äºŽä½ çš„æ€»ç»“"})]}),e.jsx("div",{className:"prose prose-sm max-w-none",children:e.jsx("div",{className:"text-gray-700 leading-relaxed whitespace-pre-wrap",style:{lineHeight:"1.8"},children:h})})]}),e.jsxs("div",{className:"bg-blue-50 rounded-xl p-4",children:[e.jsxs("p",{className:"text-xs text-blue-600",children:["ðŸ’¡ æç¤ºï¼šæ€»ç»“æ¯ ",g," è½®å¯¹è¯è‡ªåŠ¨æ›´æ–°ï¼ŒåªåŒ…å«ä½ æ˜Žç¡®è¯´è¿‡çš„ä¿¡æ¯ã€‚"]}),e.jsx("p",{className:"text-xs text-blue-500 mt-2",children:'å¯åœ¨èŠå¤©è®¾ç½®ä¸­è°ƒæ•´æ€»ç»“é—´éš”ï¼ˆ10-100è½®ï¼‰ï¼Œæˆ–ç‚¹å‡»å³ä¸Šè§’"æ‰‹åŠ¨æ€»ç»“"ç«‹å³æ›´æ–°'})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("img",{src:er,alt:"è®°å¿†æ€»ç»“",className:"w-24 h-24 mx-auto mb-4 opacity-60"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:"AI è®°å¿†æ€»ç»“"}),e.jsxs("p",{className:"text-sm text-gray-500 px-4",children:["æ¯ ",g," è½®å¯¹è¯åŽï¼ŒAI ä¼šè‡ªåŠ¨æ€»ç»“å…³äºŽä½ çš„é‡è¦ä¿¡æ¯"]}),e.jsx("p",{className:"text-xs text-gray-400 mt-2 px-4",children:'æš‚æ— æ€»ç»“ï¼Œè¯·ç»§ç»­å¯¹è¯æˆ–ç‚¹å‡»å³ä¸Šè§’"æ‰‹åŠ¨æ€»ç»“"æŒ‰é’®'})]})})]}):e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx("p",{className:"text-gray-500",children:"è§’è‰²ä¸å­˜åœ¨"})})}},Symbol.toStringTag,{value:"Module"})),Br=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),[r,l]=t.useState(!1),[n,i]=t.useState(null),[c,o]=t.useState(()=>Pe()),d=e=>e<1024?e+" B":e<1048576?(e/1024).toFixed(2)+" KB":(e/1024/1024).toFixed(2)+" MB";return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[e.jsxs("div",{className:"bg-white border-b border-gray-200 px-4 py-3 flex items-center",children:[e.jsx("button",{onClick:()=>a(-1),className:"mr-3",children:e.jsx(os,{})}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"å†…å­˜æ¸…ç†"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 mb-4 shadow-sm",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-900 mb-3",children:"å­˜å‚¨ä½¿ç”¨æƒ…å†µ"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"æ€»å¤§å°"}),e.jsx("span",{className:"font-semibold text-blue-600",children:d(c.totalSize)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"é¡¹ç›®æ•°é‡"}),e.jsx("span",{className:"font-semibold",children:c.itemCount})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 mb-4 shadow-sm",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-900 mb-3",children:"å ç”¨æœ€å¤šç©ºé—´çš„é¡¹ç›®"}),e.jsx("div",{className:"space-y-2",children:c.topKeys.map((t,s)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600 truncate flex-1 mr-2",children:t.key.length>30?t.key.substring(0,30)+"...":t.key}),e.jsx("span",{className:"font-semibold text-gray-900 whitespace-nowrap",children:d(t.size)})]},s))})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-blue-900 mb-2",children:"ðŸ“ æ¸…ç†è¯´æ˜Ž"}),e.jsxs("ul",{className:"text-xs text-blue-800 space-y-1",children:[e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"å®Œå…¨å¯é€‰"})," - ç³»ç»Ÿä¸ä¼šè‡ªåŠ¨æ¸…ç†ä½ çš„èŠå¤©è®°å½•"]}),e.jsx("li",{children:"â€¢ æ¯ä¸ªèŠå¤©åªä¿ç•™æœ€è¿‘1000æ¡æ¶ˆæ¯"}),e.jsx("li",{children:"â€¢ åˆ é™¤è¶…è¿‡7å¤©çš„è¿‡æœŸçº¢åŒ…æ•°æ®"}),e.jsx("li",{children:"â€¢ ä¸å½±å“è§’è‰²è®¾ç½®ã€ç”¨æˆ·æ•°æ®ã€è®°å¿†ç³»ç»Ÿ"}),e.jsx("li",{children:"â€¢ åªåœ¨æ„Ÿè§‰å¡é¡¿æˆ–ç©ºé—´ä¸è¶³æ—¶ä½¿ç”¨"})]})]}),e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4 mb-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-purple-900 mb-2",children:"ðŸ’ ä¿ç•™å›žå¿†"}),e.jsx("p",{className:"text-xs text-purple-800",children:"èŠå¤©è®°å½•æ˜¯çè´µçš„å›žå¿†ã€‚ç³»ç»Ÿå·²ç§»é™¤è‡ªåŠ¨é™åˆ¶ï¼Œä¼šä¿å­˜ä½ çš„æ‰€æœ‰å¯¹è¯ã€‚ åªæœ‰åœ¨ä½ ä¸»åŠ¨ç‚¹å‡»æ¸…ç†æ—¶ï¼Œæ‰ä¼šåˆ é™¤è¶…è¿‡1000æ¡çš„æ—§æ¶ˆæ¯ã€‚"})]}),n&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-green-900 mb-2",children:"âœ… æ¸…ç†å®Œæˆ"}),e.jsxs("div",{className:"text-xs text-green-800 space-y-1",children:[e.jsxs("div",{children:["é‡Šæ”¾ç©ºé—´: ",d(n.before.totalSize-n.after.totalSize)]}),e.jsxs("div",{children:["å¤„ç†èŠå¤©: ",n.messageCleanup.deletedKeys," ä¸ª"]}),e.jsxs("div",{children:["åˆ é™¤è¿‡æœŸæ•°æ®: ",n.expiredCleanup.deletedKeys," ä¸ª"]}),n.messageCleanup.errors.length>0&&e.jsxs("div",{className:"text-red-600 mt-2",children:["é”™è¯¯: ",n.messageCleanup.errors.join(", ")]})]})]}),e.jsx("button",{onClick:async()=>{if(!r&&window.confirm("ç¡®å®šè¦æ¸…ç†æ—§æ•°æ®å—ï¼Ÿè¿™å°†åˆ é™¤è¶…è¿‡1000æ¡çš„æ—§æ¶ˆæ¯å’Œè¿‡æœŸæ•°æ®ã€‚")){l(!0);try{const e=Fe(1e3);i(e),o(e.after)}catch(e){alert("æ¸…ç†å¤±è´¥: "+e)}finally{l(!1)}}},disabled:r,className:"w-full py-3 rounded-lg font-semibold text-white "+(r?"bg-gray-400 cursor-not-allowed":"bg-red-500 hover:bg-red-600 active:bg-red-700"),children:r?"æ¸…ç†ä¸­...":"å¼€å§‹æ¸…ç†"}),e.jsx("div",{className:"mt-4 bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsx("p",{className:"text-xs text-yellow-800",children:"âš ï¸ æ¸…ç†åŽçš„æ•°æ®æ— æ³•æ¢å¤ï¼Œè¯·ç¡®è®¤åŽå†æ“ä½œ"})})]})]})}},Symbol.toStringTag,{value:"Module"})),Pr="/zhizhi/assets/pencil-icon-m64sbqV0.webp",Fr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:l}=o(),{id:i}=r(),{getCharacter:c}=n(),d=i?c(i):void 0,[x,m]=t.useState([]),[h,u]=t.useState(!1),[g,p]=t.useState(null);t.useEffect(()=>{if(i){const e=Oe(i);m(e)}},[i]),t.useEffect(()=>{if(!i)return;const e=()=>{const e=Oe(i);m(e)},t=t=>{var s,a;const r=t;(null==(s=r.detail)?void 0:s.characterId)===i&&(e(),(null==(a=r.detail)?void 0:a.diaryId)&&p(r.detail.diaryId))};window.addEventListener("diaryUpdated",t),window.addEventListener("storage",e);const s=setInterval(e,2e3);return()=>{window.removeEventListener("diaryUpdated",t),window.removeEventListener("storage",e),clearInterval(s)}},[i]);return e.jsx("div",{className:"h-full flex flex-col bg-gray-50",children:e.jsxs("div",{className:"fixed inset-0 bg-gradient-to-br from-pink-50 via-purple-50 to-blue-50 flex flex-col",children:[e.jsxs("div",{className:"glass-effect shadow-sm bg-white/80 backdrop-blur-lg flex-shrink-0",children:[l&&e.jsx(ua,{}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsx("button",{onClick:()=>a(`/chat-settings/${i}`,{replace:!0}),className:"ios-button text-gray-700 hover:text-gray-900",children:e.jsx(os,{size:24})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:tr,alt:"æ—¥è®°",className:"w-6 h-6 object-contain"}),e.jsxs("h1",{className:"text-base font-semibold text-gray-900",children:[(null==d?void 0:d.name)||"TA","çš„æ—¥è®°æœ¬"]})]}),e.jsx("button",{onClick:()=>{if(!i)return;const e=We(i),t=new Blob([e],{type:"text/plain;charset=utf-8"}),s=URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download=`${(null==d?void 0:d.name)||"TA"}çš„æ—¥è®°_${(new Date).toLocaleDateString()}.txt`,a.click(),URL.revokeObjectURL(s)},className:"text-sm text-blue-600 hover:text-blue-700 px-3 py-1 rounded-lg hover:bg-white/50 transition-colors",disabled:0===x.length,children:"å¯¼å‡º"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"max-w-2xl mx-auto p-4 pb-20",children:[e.jsx("button",{onClick:async()=>{if(i&&d){u(!0);try{const e=`chat_messages_${i}`,t=localStorage.getItem(e),s=t?JSON.parse(t):[],a=`character_status_${i}`,r=localStorage.getItem(a),l=r?JSON.parse(r):{weather:"æ™´ 25Â°C",location:"å®¶é‡Œ",mood:"å¹³é™"},n=await Re(i,d.name,d.description,s,l,x.slice(0,3));n?(Ue(i,n),m(e=>[n,...e]),p(n.id),alert("âœ… æ—¥è®°å†™å¥½äº†ï¼")):alert("TAä»Šå¤©ä¸æƒ³å†™æ—¥è®° ðŸ˜Š")}catch(e){alert("âŒ ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•")}finally{u(!1)}}},disabled:h,className:"w-full glass-card rounded-2xl p-6 mb-6 shadow-lg border border-white/50 hover:shadow-xl transition-all active:scale-98 disabled:opacity-50",children:h?e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:Pr,alt:"å†™æ—¥è®°",className:"w-12 h-12 object-contain"}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-5 h-5 border-2 border-purple-500 border-t-transparent rounded-full animate-spin"})]}),e.jsxs("div",{className:"text-gray-700",children:[(null==d?void 0:d.name)||"TA","æ­£åœ¨å†™æ—¥è®°..."]}),e.jsx("div",{className:"text-sm text-gray-500",children:"å›žå¿†ä»Šå¤©å‘ç”Ÿçš„äº‹..."})]}):e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("img",{src:Pr,alt:"å†™æ—¥è®°",className:"w-16 h-16 object-contain"}),e.jsx("div",{className:"text-lg font-medium text-gray-900",children:"è®©TAå†™ä¸€ç¯‡æ—¥è®°"}),e.jsx("div",{className:"text-sm text-gray-500",children:"ç‚¹å‡»åŽï¼ŒTAä¼šæ ¹æ®æœ€è¿‘çš„èŠå¤©å†™ä¸€ç¯‡æ—¥è®°"})]})}),0===x.length?e.jsxs("div",{className:"glass-card rounded-2xl p-12 text-center shadow-lg border border-white/50",children:[e.jsx("img",{src:tr,alt:"æ—¥è®°",className:"w-24 h-24 object-contain mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600 mb-2",children:"è¿˜æ²¡æœ‰æ—¥è®°"}),e.jsx("div",{className:"text-sm text-gray-400",children:"ç‚¹å‡»ä¸Šé¢çš„æŒ‰é’®ï¼Œè®©TAå†™ç¬¬ä¸€ç¯‡æ—¥è®°å§"})]}):e.jsx("div",{className:"space-y-4",children:x.map(t=>e.jsxs("div",{className:"glass-card rounded-2xl p-5 shadow-lg border border-white/50 hover:shadow-xl transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("img",{src:"/zhizhi/assets/calendar-icon-DiRG13Pq.webp",alt:"æ—¥æœŸ",className:"w-4 h-4 object-contain"}),e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[t.date," ",t.time]})]}),t.weather&&e.jsx("div",{className:"flex items-center gap-3 text-xs text-gray-500",children:e.jsxs("span",{children:["â˜€ï¸ ",t.weather]})})]}),e.jsx("button",{onClick:()=>{return e=t.id,void(i&&confirm("ç¡®å®šè¦åˆ é™¤è¿™ç¯‡æ—¥è®°å—ï¼Ÿ")&&(Ve(i,e),m(t=>t.filter(t=>t.id!==e))));var e},className:"text-gray-400 hover:opacity-70 transition-opacity p-1",children:e.jsx("img",{src:"/zhizhi/assets/trash-icon-D9S_xoy4.webp",alt:"åˆ é™¤",className:"w-5 h-5 object-contain"})})]}),e.jsx("div",{className:"text-gray-800 leading-relaxed "+(g===t.id?"max-h-[600px] overflow-y-auto":""),children:t.content.split(/(\[ç…§ç‰‡:.+?\])/).map((t,s)=>{const a=t.match(/\[ç…§ç‰‡:(.+?)\]/);if(a){const t=a[1];return e.jsx("div",{className:"my-3 flex justify-center",children:e.jsx(Ra,{description:t,messageId:Date.now()+s})},s)}return e.jsx("span",{className:"whitespace-pre-wrap",children:t},s)})}),t.content.length>100&&e.jsx("button",{onClick:()=>p(g===t.id?null:t.id),className:"mt-3 text-sm text-blue-600 hover:text-blue-700 transition-colors",children:g===t.id?"â–² æ”¶èµ·":"â–¼ å±•å¼€é˜…è¯»"})]},t.id))}),x.length>0&&e.jsxs("div",{className:"mt-6 text-center text-sm text-gray-500",children:["å…± ",x.length," ç¯‡æ—¥è®°"]})]})})]})})}},Symbol.toStringTag,{value:"Module"})),Or=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const t=s(),{id:a}=r(),{getCharacter:l}=n(),{showStatusBar:i}=o(),c=a?l(a):void 0,d=a?k(a):null,x=d?Je(d.currentStreak):null,m=d?He(d.currentStreak):null,h=a?Ge(a):0;return d&&c?e.jsxs("div",{className:"h-screen flex flex-col bg-gradient-to-br from-orange-50 via-red-50 to-pink-50",children:[i&&e.jsx(ua,{}),e.jsx("div",{className:"glass-effect sticky top-0 z-10 shadow-sm bg-white/80 backdrop-blur-lg",children:e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsx("button",{onClick:()=>t(-1),className:"p-2 hover:bg-white/50 rounded-full transition-colors",children:e.jsx(os,{className:"w-6 h-6 text-gray-700"})}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"ðŸ”¥ è¿žç»­èŠå¤©"}),e.jsx("div",{className:"w-10"})]})}),e.jsxs("div",{className:"max-w-2xl mx-auto p-4 pb-20",children:[e.jsxs("div",{className:"glass-card rounded-3xl p-8 mb-6 shadow-xl border border-white/50 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ”¥"}),e.jsx("div",{className:"text-5xl font-bold text-orange-600 mb-2",children:d.currentStreak}),e.jsx("div",{className:"text-gray-600 mb-4",children:"è¿žç»­èŠå¤©å¤©æ•°"}),x&&e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-orange-100 to-red-100 rounded-full",children:[e.jsx("span",{className:"text-2xl",children:x.emoji}),e.jsx("span",{className:"font-medium text-gray-900",children:x.name})]})]}),m&&e.jsxs("div",{className:"glass-card rounded-2xl p-6 mb-6 shadow-lg border border-white/50",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"ðŸŽ¯ ä¸‹ä¸€ä¸ªé‡Œç¨‹ç¢‘"})}),e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsx("div",{className:"text-4xl",children:m.emoji}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xl font-bold text-gray-900 mb-1",children:m.name}),e.jsxs("div",{className:"text-sm text-gray-600",children:["è¿˜éœ€è¦ ",m.days-d.currentStreak," å¤©"]})]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:"bg-gradient-to-r from-orange-500 to-red-500 h-full rounded-full transition-all duration-500",style:{width:d.currentStreak/m.days*100+"%"}})}),e.jsxs("div",{className:"text-xs text-gray-500 mt-2 text-right",children:[d.currentStreak," / ",m.days," å¤©"]})]}),e.jsxs("div",{className:"glass-card rounded-2xl p-6 mb-6 shadow-lg border border-white/50",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"ðŸ“Š èŠå¤©ç»Ÿè®¡"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white/50 rounded-xl p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600 mb-1",children:d.longestStreak}),e.jsx("div",{className:"text-sm text-gray-600",children:"æœ€é•¿è®°å½•"})]}),e.jsxs("div",{className:"bg-white/50 rounded-xl p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600 mb-1",children:d.totalDays}),e.jsx("div",{className:"text-sm text-gray-600",children:"æ€»èŠå¤©å¤©æ•°"})]}),e.jsxs("div",{className:"bg-white/50 rounded-xl p-4 text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600 mb-1",children:[h,"%"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"èŠå¤©çŽ‡"})]}),e.jsxs("div",{className:"bg-white/50 rounded-xl p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600 mb-1",children:d.breakCount}),e.jsx("div",{className:"text-sm text-gray-600",children:"æ–­ç«æ¬¡æ•°"})]})]})]}),e.jsxs("div",{className:"glass-card rounded-2xl p-6 shadow-lg border border-white/50",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"ðŸ† æˆå°±"}),e.jsx("div",{className:"space-y-3",children:qe.map(t=>{const s=d.milestones.includes(t.days),a=d.currentStreak>=t.days;return e.jsxs("div",{className:"flex items-center gap-4 p-4 rounded-xl transition-all "+(s?"bg-gradient-to-r from-orange-100 to-red-100 border-2 border-orange-300":"bg-gray-100 opacity-50"),children:[e.jsx("div",{className:`text-3xl ${!s&&"grayscale"}`,children:t.emoji}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold "+(s?"text-gray-900":"text-gray-500"),children:t.name}),e.jsxs("div",{className:"text-sm text-gray-600",children:["è¿žç»­èŠå¤© ",t.days," å¤©"]})]}),s&&e.jsx("div",{className:"text-green-600 font-bold",children:"âœ“"}),!s&&a&&e.jsx("div",{className:"text-orange-600 text-sm",children:"è¿›è¡Œä¸­"})]},t.days)})})]}),!d.hasUsedRevive&&e.jsx("div",{className:"mt-6 glass-card rounded-2xl p-4 shadow-lg border border-white/50 bg-blue-50/50",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"text-2xl",children:"ðŸ’³"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-900 mb-1",children:"ç»­ç«å¡"}),e.jsx("div",{className:"text-sm text-gray-600",children:"æœ¬æœˆè¿˜æœ‰ 1 æ¬¡ç»­ç«æœºä¼šï¼Œæ–­ç«åŽå¯ä»¥æ¢å¤è¿žç»­è®°å½•"})]})]})})]})]}):null}},Symbol.toStringTag,{value:"Module"})),Wr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{var a;const r=s(),{showStatusBar:l}=o(),{characters:i}=n(),[c,d]=t.useState([]),[x,m]=t.useState("all"),[h,u]=t.useState("time");t.useEffect(()=>{g()},[]);const g=()=>{const e=localStorage.getItem("spark_moments");if(e)try{const t=JSON.parse(e);d(t)}catch(t){}},p=e=>e>=80?"text-red-500":e>=60?"text-orange-500":e>=40?"text-yellow-500":"text-blue-500",f=(()=>{let e=c;return"all"!==x&&(e=e.filter(e=>e.contactId===x)),"time"===h?e.sort((e,t)=>t.timestamp-e.timestamp):e.sort((e,t)=>t.intensity-e.intensity),e})(),b=(()=>{const e=c.length,t=e>0?Math.round(c.reduce((e,t)=>e+t.intensity,0)/e):0,s=c.reduce((e,t)=>(e[t.contactId]=(e[t.contactId]||0)+1,e),{});return{total:e,avgIntensity:t,mostActive:Object.entries(s).sort(([,e],[,t])=>t-e)[0]}})();return e.jsxs("div",{className:"h-screen flex flex-col bg-gray-50",children:[l&&e.jsx(ua,{}),e.jsxs("div",{className:"glass-effect px-4 py-3 border-b border-gray-200/50 flex items-center",children:[e.jsx("button",{onClick:()=>r("/desktop",{replace:!0}),className:"w-8 h-8 flex items-center justify-center ios-button",children:e.jsx("span",{className:"text-blue-500 text-xl",children:"â€¹"})}),e.jsx("h1",{className:"flex-1 text-center text-lg font-semibold text-gray-900",children:"ç«èŠ±æ—¶åˆ»"}),e.jsx("div",{className:"w-8"})]}),e.jsx("div",{className:"px-4 pt-4 pb-3",children:e.jsx("div",{className:"glass-card rounded-2xl p-5",children:e.jsxs("div",{className:"grid grid-cols-3 gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-gray-900 mb-1",children:b.total}),e.jsx("div",{className:"text-xs text-gray-500",children:"æ€»æ—¶åˆ»æ•°"})]}),e.jsxs("div",{className:"text-center border-l border-r border-gray-200/50",children:[e.jsx("div",{className:"text-3xl font-bold text-orange-500 mb-1",children:b.avgIntensity}),e.jsx("div",{className:"text-xs text-gray-500",children:"å¹³å‡å¼ºåº¦"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-base font-bold text-gray-900 truncate mb-1",children:b.mostActive&&(null==(a=i.find(e=>e.id===b.mostActive[0]))?void 0:a.name)||"æš‚æ— "}),e.jsx("div",{className:"text-xs text-gray-500",children:"æœ€æ´»è·ƒ"})]})]})})}),e.jsxs("div",{className:"px-4 pb-3 flex gap-3",children:[e.jsxs("select",{value:x,onChange:e=>m(e.target.value),className:"flex-1 glass-card rounded-xl px-4 py-3 text-sm text-gray-900 border-none outline-none font-medium",children:[e.jsx("option",{value:"all",children:"å…¨éƒ¨è”ç³»äºº"}),i.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsxs("select",{value:h,onChange:e=>u(e.target.value),className:"glass-card rounded-xl px-4 py-3 text-sm text-gray-900 border-none outline-none font-medium",children:[e.jsx("option",{value:"time",children:"æŒ‰æ—¶é—´"}),e.jsx("option",{value:"intensity",children:"æŒ‰å¼ºåº¦"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-4 pb-4",children:0===f.length?e.jsxs("div",{className:"glass-card rounded-2xl p-8 text-center",children:[e.jsx("div",{className:"text-gray-500 text-sm",children:"æš‚æ— ç«èŠ±æ—¶åˆ»"}),e.jsx("div",{className:"text-gray-400 text-xs mt-1",children:"ä¸ŽAIäº’åŠ¨æ—¶ä¼šè‡ªåŠ¨è®°å½•"})]}):e.jsx("div",{className:"space-y-3",children:f.map(t=>{const s=i.find(e=>e.id===t.contactId);return e.jsxs("div",{className:"glass-card rounded-2xl p-5",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("img",{src:(null==s?void 0:s.avatar)||t.contactAvatar,alt:t.contactName,className:"w-12 h-12 rounded-full object-cover shadow-sm"}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("div",{className:"font-bold text-gray-900 text-base mb-0.5",children:(null==s?void 0:s.name)||t.contactName}),e.jsx("div",{className:"text-xs text-gray-500",children:new Date(t.timestamp).toLocaleString("zh-CN",{month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-2xl font-bold ${p(t.intensity)} mb-0.5`,children:t.intensity}),e.jsx("div",{className:"text-xs text-gray-500",children:(r=t.intensity,r>=80?"å¼ºçƒˆ":r>=60?"æ˜Žæ˜¾":r>=40?"å¾®å¼±":"æ·¡æ·¡")})]})]}),e.jsx("div",{className:"bg-white/60 rounded-xl p-4 mb-3",children:e.jsx("p",{className:"text-sm text-gray-700 leading-relaxed",children:t.content})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"inline-block px-3 py-1.5 bg-blue-50 text-blue-600 text-xs rounded-lg font-medium",children:(a=t.category,{chat:"èŠå¤©",moments:"æœ‹å‹åœˆ",call:"é€šè¯",gift:"ç¤¼ç‰©"}[a]||a)}),e.jsx("div",{className:"flex items-center gap-1.5",children:Array.from({length:5}).map((s,a)=>e.jsx("div",{className:`w-2 h-2 rounded-full ${a<Math.floor(t.intensity/20)?p(t.intensity).replace("text-","bg-"):"bg-gray-200"}`},a))})]})]},t.id);var a,r})})})]})}},Symbol.toStringTag,{value:"Module"})),Rr=[{id:"food",name:"é¤é¥®",emoji:"ðŸ”",icon:"/zhizhi/assets/%E9%A4%90%E9%A5%AE-DG3ZjT7z.webp"},{id:"transport",name:"äº¤é€š",emoji:"ðŸš—",icon:"/zhizhi/assets/%E4%BA%A4%E9%80%9A-CgvE4g2K.webp"},{id:"shopping",name:"è´­ç‰©",emoji:"ðŸ›ï¸",icon:"/zhizhi/assets/%E8%B4%AD%E7%89%A9-cnd6RXoS.webp"},{id:"entertainment",name:"å¨±ä¹",emoji:"ðŸŽ®",icon:"/zhizhi/assets/%E5%A8%B1%E4%B9%90-Cla9sbsy.webp"},{id:"health",name:"åŒ»ç–—",emoji:"ðŸ’Š",icon:"/zhizhi/assets/%E5%8C%BB%E7%96%97-w37nw3xX.webp"},{id:"education",name:"æ•™è‚²",emoji:"ðŸ“š",icon:"/zhizhi/assets/%E6%95%99%E8%82%B2-B6auALoJ.webp"},{id:"housing",name:"ä½æˆ¿",emoji:"ðŸ ",icon:"/zhizhi/assets/%E4%BD%8F%E5%AE%85-BRi807AW.webp"},{id:"utilities",name:"æ°´ç”µ",emoji:"ðŸ’¡",icon:"/zhizhi/assets/%E6%B0%B4%E7%94%B5-DZjkXaLZ.webp"},{id:"other",name:"å…¶ä»–",emoji:"ðŸ“",icon:"/zhizhi/assets/%E5%85%B6%E4%BB%96-Dp905fQ_.webp"}],Ur=[{id:"salary",name:"å·¥èµ„",emoji:"ðŸ’°"},{id:"bonus",name:"å¥–é‡‘",emoji:"ðŸŽ"},{id:"investment",name:"æŠ•èµ„",emoji:"ðŸ“ˆ"},{id:"other",name:"å…¶ä»–",emoji:"ðŸ’µ"}],Vr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{transactions:r,deleteTransaction:l,getMonthlyTotal:n}=g(),{showStatusBar:i}=o(),[c,d]=t.useState(()=>{const e=new Date;return{year:e.getFullYear(),month:e.getMonth()}}),x=n(c.year,c.month),m=x.income-x.expense,h=r.filter(e=>{const t=new Date(e.date);return t.getFullYear()===c.year&&t.getMonth()===c.month}),u=e=>{const t=new Date(e),s=new Date,a=new Date(s);return a.setDate(a.getDate()-1),t.toDateString()===s.toDateString()?"ä»Šå¤©":t.toDateString()===a.toDateString()?"æ˜¨å¤©":`${t.getMonth()+1}æœˆ${t.getDate()}æ—¥`},p=h.reduce((e,t)=>{const s=t.date;return e[s]||(e[s]=[]),e[s].push(t),e},{});return e.jsxs("div",{className:"h-full flex flex-col bg-gray-50",children:[i&&e.jsx(ua,{}),e.jsxs("div",{className:"glass-effect px-4 py-3 flex items-center justify-between border-b border-gray-200/50",children:[e.jsx("button",{onClick:()=>a("/wechat/discover",{replace:!0}),className:"flex items-center gap-2 text-gray-700 ios-button",children:e.jsx(os,{size:20})}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"è®°è´¦æœ¬"}),e.jsx("button",{onClick:()=>a("/accounting/chat"),className:"px-3 py-1.5 rounded-full bg-green-500 text-white text-sm font-medium ios-button",children:"AIè®°è´¦"})]}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"glass-card rounded-3xl p-6 shadow-xl ios-button",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:()=>{const e=0===c.month?11:c.month-1,t=0===c.month?c.year-1:c.year;d({year:t,month:e})},className:"w-10 h-10 rounded-full glass-card flex items-center justify-center ios-button",children:e.jsx("span",{className:"text-gray-600",children:"â†"})}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:[c.year,"å¹´",c.month+1,"æœˆ"]}),e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:["æ”¶å…¥ Â¥",x.income.toFixed(2)," Â· æ”¯å‡º Â¥",x.expense.toFixed(2)]})]}),e.jsx("button",{onClick:()=>{const e=11===c.month?0:c.month+1,t=11===c.month?c.year+1:c.year;d({year:t,month:e})},className:"w-10 h-10 rounded-full glass-card flex items-center justify-center ios-button",children:e.jsx("span",{className:"text-gray-600",children:"â†’"})})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-3xl font-bold text-gray-900",children:["Â¥",m.toFixed(2)]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"æœ¬æœˆç»“ä½™"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-4 pb-20",children:0===Object.keys(p).length?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-400",children:[e.jsx("p",{className:"text-sm",children:"æš‚æ— è´¦å•"}),e.jsx("p",{className:"text-xs mt-2 text-gray-300",children:'ç‚¹å‡»å³ä¸Šè§’"AIè®°è´¦"å¼€å§‹è®°è´¦'})]}):e.jsx("div",{className:"space-y-4",children:Object.entries(p).sort(([e],[t])=>new Date(t).getTime()-new Date(e).getTime()).map(([t,s])=>e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-2 px-2",children:u(t)}),e.jsx("div",{className:"space-y-2",children:s.map(t=>{const s=(a=t.category,("expense"===t.type?Rr:Ur).find(e=>e.id===a)||{id:"other",name:a,emoji:"ðŸ“"});var a;return e.jsx("div",{className:"glass-card rounded-2xl p-4 ios-button",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-12 h-12 flex items-center justify-center",children:s.icon?e.jsx("img",{src:s.icon,alt:s.name,className:"w-full h-full object-contain"}):e.jsx("div",{className:"text-2xl",children:s.emoji})}),e.jsxs("div",{className:"flex-1 ml-3",children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.name}),t.description&&e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:t.description})]}),e.jsxs("div",{className:"text-lg font-semibold "+("income"===t.type?"text-green-600":"text-red-600"),children:["income"===t.type?"+":"-","Â¥",t.amount.toFixed(2)]})]})},t.id)})})]},t))})}),e.jsx("div",{className:"fixed bottom-20 right-6 z-10",children:e.jsx("button",{onClick:()=>a("/accounting/add"),className:"w-14 h-14 rounded-full bg-gradient-to-br from-green-500 to-green-600 text-white shadow-2xl flex items-center justify-center ios-button hover:scale-110 transition-transform",children:e.jsx(cs,{size:28})})})]})}},Symbol.toStringTag,{value:"Module"})),Jr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),[r,l]=t.useState(!1);return t.useEffect(()=>{Ke(),setTimeout(()=>{l(!0)},100)},[]),t.useEffect(()=>{r&&a("/chat/accounting_assistant",{replace:!0})},[r,a]),e.jsx("div",{className:"h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl mb-4",children:"ðŸ’°"}),e.jsx("p",{className:"text-gray-600",children:"æ­£åœ¨æ‰“å¼€è®°è´¦åŠ©æ‰‹..."})]})})}},Symbol.toStringTag,{value:"Module"})),Hr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{addTransaction:r}=g(),[l,n]=t.useState("expense"),[i,c]=t.useState(""),[o,d]=t.useState(""),[x,m]=t.useState(""),[h,u]=t.useState((new Date).toISOString().split("T")[0]),p="expense"===l?Rr:Ur;return e.jsxs("div",{className:"h-screen flex flex-col bg-gray-50",children:[e.jsxs("div",{className:"glass-effect px-4 py-3 flex items-center justify-between border-b border-gray-200/50",children:[e.jsxs("button",{onClick:()=>a("/accounting",{replace:!0}),className:"flex items-center gap-2 text-gray-700 ios-button",children:[e.jsx(os,{size:20}),e.jsx("span",{className:"text-base",children:"å–æ¶ˆ"})]}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"è®°ä¸€ç¬”"}),e.jsx("button",{onClick:()=>{i&&o?(r({type:l,category:o,amount:parseFloat(i),description:x,date:h}),a("/accounting",{replace:!0})):alert("è¯·å¡«å†™é‡‘é¢å’Œåˆ†ç±»")},disabled:!i||!o,className:"px-4 py-1.5 rounded-full bg-green-500 text-white text-sm font-medium ios-button disabled:opacity-50 disabled:cursor-not-allowed",children:"å®Œæˆ"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar p-4 space-y-4",children:[e.jsxs("div",{className:"glass-card rounded-2xl p-2 flex gap-2",children:[e.jsx("button",{onClick:()=>{n("expense"),d("")},className:"flex-1 py-3 rounded-xl font-medium transition-all "+("expense"===l?"bg-red-500 text-white shadow-lg":"text-gray-600 hover:bg-gray-50"),children:"æ”¯å‡º"}),e.jsx("button",{onClick:()=>{n("income"),d("")},className:"flex-1 py-3 rounded-xl font-medium transition-all "+("income"===l?"bg-green-500 text-white shadow-lg":"text-gray-600 hover:bg-gray-50"),children:"æ”¶å…¥"})]}),e.jsx("div",{className:"glass-card rounded-2xl p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-2",children:"é‡‘é¢"}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-3xl font-bold text-gray-400",children:"Â¥"}),e.jsx("input",{type:"number",value:i,onChange:e=>c(e.target.value),placeholder:"0.00",className:"text-5xl font-bold text-gray-900 bg-transparent outline-none text-center w-64",step:"0.01",autoFocus:!0})]})]})}),e.jsxs("div",{className:"glass-card rounded-2xl p-4",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-3",children:"é€‰æ‹©åˆ†ç±»"}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:p.map(t=>e.jsxs("button",{onClick:()=>d(t.id),className:"p-4 rounded-xl transition-all "+(o===t.id?"glass-card ring-2 ring-blue-400 shadow-lg scale-105":"glass-card text-gray-700 hover:scale-105"),children:[t.icon?e.jsx("img",{src:t.icon,alt:t.name,className:"w-12 h-12 mx-auto mb-2 object-contain"}):e.jsx("div",{className:"text-3xl mb-2",children:t.emoji}),e.jsx("div",{className:"text-xs font-medium",children:t.name})]},t.id))})]}),e.jsxs("div",{className:"glass-card rounded-2xl p-4",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-3",children:"å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰"}),e.jsx("input",{type:"text",value:x,onChange:e=>m(e.target.value),placeholder:"æ·»åŠ å¤‡æ³¨...",className:"w-full px-4 py-3 rounded-xl glass-card outline-none text-sm"})]}),e.jsxs("div",{className:"glass-card rounded-2xl p-4",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-3",children:"æ—¥æœŸ"}),e.jsx("input",{type:"date",value:h,onChange:e=>u(e.target.value),className:"w-full px-4 py-3 rounded-xl glass-card outline-none text-sm"})]})]})]})}},Symbol.toStringTag,{value:"Module"})),Gr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const t=s(),{groups:a}=i(),r=t=>{const s=t.slice(0,9),a=s.length;let r="grid-cols-3",l="12px";return 1===a?(r="grid-cols-1",l="32px"):a<=4&&(r="grid-cols-2",l="16px"),e.jsx("div",{className:`w-14 h-14 rounded-2xl bg-white shadow-lg overflow-hidden grid ${r} gap-[1px] border border-gray-200`,children:s.map((t,s)=>{const a=t.avatar&&t.avatar.startsWith("data:image");return e.jsx("div",{className:"bg-gray-100 flex items-center justify-center",style:{fontSize:l},children:a?e.jsx("img",{src:t.avatar,alt:t.name,className:"w-full h-full object-cover"}):e.jsx("span",{children:t.avatar||"ðŸ¤–"})},s)})})};return e.jsxs("div",{className:"h-full flex flex-col bg-gray-50",children:[e.jsxs("div",{className:"glass-effect px-5 py-4 flex items-center justify-between border-b border-gray-200/50 sticky top-0 z-50 bg-white/95 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>t(-1),className:"ios-button",children:e.jsx(os,{size:24})}),e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"ç¾¤èŠ"})]}),e.jsx("button",{onClick:()=>t("/create-group"),className:"ios-button text-gray-700 hover:text-gray-900",children:e.jsx(cs,{size:22})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto hide-scrollbar p-3",children:0===a.length?e.jsxs("div",{className:"empty-state",children:[e.jsx(gs,{size:100,className:"text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-400 text-base mb-2",children:"æš‚æ— ç¾¤èŠ"}),e.jsx("p",{className:"text-gray-400 text-sm mb-6",children:"åˆ›å»ºç¾¤èŠï¼Œä¸Žå¤šä¸ªAIè§’è‰²ä¸€èµ·èŠå¤©"}),e.jsx("button",{onClick:()=>t("/create-group"),className:"px-6 py-2 bg-wechat-primary text-white rounded-full ios-button",children:"åˆ›å»ºç¾¤èŠ"})]}):a.map(s=>e.jsxs("div",{onClick:()=>t(`/group/${s.id}`),className:"flex items-center px-4 py-4 ios-button glass-card mb-2 rounded-2xl cursor-pointer hover:bg-white/90",children:[r(s.members),e.jsxs("div",{className:"flex-1 ml-4 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-900",children:s.name}),e.jsxs("span",{className:"text-xs text-gray-400",children:["(",s.members.length,")"]})]}),e.jsx("span",{className:"text-xs text-gray-400",children:s.lastMessageTime||""})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-gray-500 truncate flex-1",children:s.lastMessage||"å¼€å§‹ç¾¤èŠå§"}),s.unread&&s.unread>0&&e.jsx("span",{className:"ml-2 px-2 min-w-[20px] h-5 rounded-full text-xs text-white flex items-center justify-center bg-red-500 shadow-md",children:s.unread>99?"99+":s.unread})]})]})]},s.id))})]})}},Symbol.toStringTag,{value:"Module"})),qr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{characters:r}=n(),{addGroup:l}=i(),[c,o]=t.useState([]),[d,x]=t.useState(""),[m,h]=t.useState("select");return e.jsxs("div",{className:"h-full flex flex-col bg-gray-50",children:[e.jsxs("div",{className:"glass-effect px-5 py-4 flex items-center justify-between border-b border-gray-200/50 sticky top-0 z-50 bg-white/95 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>"name"===m?h("select"):a(-1),className:"ios-button",children:e.jsx(os,{size:24})}),e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"select"===m?"é€‰æ‹©ç¾¤æˆå‘˜":"è®¾ç½®ç¾¤åç§°"})]}),"select"===m&&e.jsxs("button",{onClick:()=>{if(c.length<2)return void alert("è‡³å°‘é€‰æ‹©2ä¸ªæˆå‘˜");const e=r.filter(e=>c.includes(e.id)),t=e.slice(0,3).map(e=>e.name).join("ã€")+(e.length>3?"...":"");x(t),h("name")},disabled:c.length<2,className:"px-4 py-2 rounded-full text-sm font-medium "+(c.length>=2?"bg-wechat-primary text-white":"bg-gray-200 text-gray-400"),children:["ä¸‹ä¸€æ­¥ (",c.length,")"]}),"name"===m&&e.jsx("button",{onClick:()=>{if(!d.trim())return void alert("è¯·è¾“å…¥ç¾¤åç§°");const e=c.map(e=>{const t=r.find(t=>t.id===e);return{id:e,type:"character",name:t.name,avatar:t.avatar,role:"member",joinedAt:(new Date).toISOString()}});e.unshift({id:"user",type:"user",name:"æˆ‘",avatar:"ðŸ‘¤",role:"owner",joinedAt:(new Date).toISOString()});const t=l({name:d,avatar:"",members:e,owner:"user",admins:[],settings:{allowMemberInvite:!0,muteAll:!1,showMemberName:!0,aiReplyMode:"all",aiReplyInterval:2,maxAiRepliesPerMessage:3}});c.forEach(s=>{try{if(!r.find(e=>e.id===s))return;const a=`chat_messages_${s}`,l=localStorage.getItem(a),n=l?JSON.parse(l):[],i=e.filter(e=>e.id!==s).map(e=>e.name).join("ã€"),c={id:Date.now()+Math.random(),role:"system",content:`[ç³»ç»Ÿé€šçŸ¥] ä½ è¢«ç”¨æˆ·æ‹‰è¿›äº†ç¾¤èŠ"${d}"ã€‚ç¾¤æˆå‘˜æœ‰ï¼š${i}`,timestamp:Date.now(),isHidden:!1,groupInvite:{groupId:t,groupName:d,memberNames:e.filter(e=>e.id!==s).map(e=>e.name),inviterName:"ç”¨æˆ·"}};n.push(c),localStorage.setItem(a,JSON.stringify(n))}catch(a){}}),a(`/group/${t}`,{replace:!0})},className:"px-4 py-2 rounded-full text-sm font-medium bg-wechat-primary text-white",children:"å®Œæˆ"})]}),"select"===m&&e.jsx("div",{className:"flex-1 overflow-y-auto hide-scrollbar p-3",children:0===r.length?e.jsxs("div",{className:"text-center py-20",children:[e.jsx("p",{className:"text-gray-400 mb-4",children:"æš‚æ— å¯é€‰æ‹©çš„è§’è‰²"}),e.jsx("button",{onClick:()=>a("/create-character"),className:"px-6 py-2 bg-wechat-primary text-white rounded-full",children:"åˆ›å»ºè§’è‰²"})]}):e.jsx("div",{className:"space-y-2",children:r.map(t=>{const s=c.includes(t.id),a=t.avatar&&t.avatar.startsWith("data:image");return e.jsxs("div",{onClick:()=>{return e=t.id,void o(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e]);var e},className:"flex items-center p-4 glass-card rounded-2xl cursor-pointer transition-all "+(s?"ring-2 ring-wechat-primary bg-green-50":"hover:bg-gray-50"),children:[e.jsx("div",{className:"w-6 h-6 rounded-full border-2 flex items-center justify-center mr-3 "+(s?"bg-wechat-primary border-wechat-primary":"border-gray-300"),children:s&&e.jsx("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gray-200 flex items-center justify-center flex-shrink-0 shadow-lg overflow-hidden",children:a?e.jsx("img",{src:t.avatar,alt:t.name,className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-2xl",children:t.avatar||"ðŸ¤–"})}),e.jsxs("div",{className:"ml-3 flex-1 overflow-hidden",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:t.name}),t.signature&&e.jsx("p",{className:"text-sm text-gray-500 truncate",children:t.signature})]})]},t.id)})})}),"name"===m&&e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar p-5",children:[e.jsxs("div",{className:"glass-card rounded-2xl p-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ç¾¤åç§°"}),e.jsx("input",{type:"text",value:d,onChange:e=>x(e.target.value),placeholder:"è¯·è¾“å…¥ç¾¤åç§°",maxLength:20,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-wechat-primary"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-2",children:[d.length,"/20"]})]}),e.jsxs("div",{className:"glass-card rounded-2xl p-6 mt-4",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:["ç¾¤æˆå‘˜ (",c.length+1,")"]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl bg-blue-200 flex items-center justify-center shadow-lg",children:e.jsx("span",{className:"text-2xl",children:"ðŸ‘¤"})}),e.jsx("span",{className:"text-xs text-gray-600 mt-1",children:"æˆ‘"})]}),c.map(t=>{const s=r.find(e=>e.id===t);if(!s)return null;const a=s.avatar&&s.avatar.startsWith("data:image");return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl bg-gray-200 flex items-center justify-center shadow-lg overflow-hidden",children:a?e.jsx("img",{src:s.avatar,alt:s.name,className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-2xl",children:s.avatar||"ðŸ¤–"})}),e.jsx("span",{className:"text-xs text-gray-600 mt-1 max-w-[60px] truncate",children:s.name})]},t)})]})]})]})]})}},Symbol.toStringTag,{value:"Module"})),Kr=({onClose:t,onSelectImage:s,onSelectCamera:a,onSelectRedPacket:r,onSelectLocation:l,onSelectVoiceMessage:n,onSelectVoiceCall:i,onSelectVideoCall:c})=>{const o=[{id:"image",label:"ç›¸å†Œ",Icon:us,onClick:s},{id:"camera",label:"æ‹æ‘„",Icon:_s,onClick:a},{id:"redpacket",label:"çº¢åŒ…",Icon:Ms,onClick:r},{id:"voice-msg",label:"è¯­éŸ³",Icon:ms,onClick:n},{id:"voice",label:"è¯­éŸ³é€šè¯",Icon:As,onClick:i},{id:"video",label:"è§†é¢‘é€šè¯",Icon:Ts,onClick:c},{id:"location",label:"ä½ç½®",Icon:$s,onClick:l}];return e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:t,className:"fixed inset-0 bg-black bg-opacity-30 z-40",style:{bottom:0}}),e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 glass-effect border-t border-gray-200/50 z-50 pb-safe animate-slide-up",children:[e.jsx("div",{className:"w-full mx-auto px-6 py-8",children:e.jsx("div",{className:"grid grid-cols-4 gap-6",children:o.map(s=>{const a=s.Icon;return e.jsxs("button",{onClick:()=>{s.onClick(),t()},className:"flex flex-col items-center gap-3 ios-button",children:[e.jsx("div",{className:"w-14 h-14 glass-card rounded-2xl flex items-center justify-center shadow-md border border-gray-200/50 hover:shadow-lg transition-all",children:e.jsx(a,{size:26,className:"text-gray-700"})}),e.jsx("span",{className:"text-[13px] text-gray-700 font-medium",children:s.label})]},s.id)})})}),e.jsx("div",{className:"flex justify-center pt-1 pb-3",children:e.jsx("div",{className:"w-32 h-1 bg-gray-900 rounded-full opacity-30"})})]})]})},Xr=({onClose:s,onSend:a,maxCount:r})=>{const[l,n]=t.useState(""),[i,c]=t.useState(""),[o,d]=t.useState("æ­å–œå‘è´¢ï¼Œå¤§å‰å¤§åˆ©"),x=l&&i?(parseFloat(l)/parseInt(i)).toFixed(2):"0.00";return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50",onClick:s}),e.jsxs("div",{className:"fixed inset-x-0 bottom-0 z-50 glass-card rounded-t-3xl p-6 animate-slide-up",children:[e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6 text-center",children:"å‘ç¾¤çº¢åŒ…"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"æ€»é‡‘é¢"}),e.jsxs("div",{className:"flex items-center glass-card rounded-xl p-4",children:[e.jsx("span",{className:"text-2xl font-bold text-red-600 mr-2",children:"Â¥"}),e.jsx("input",{type:"number",value:l,onChange:e=>n(e.target.value),placeholder:"0.00",step:"0.01",min:"0.01",className:"flex-1 text-2xl font-bold text-gray-900 bg-transparent focus:outline-none"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"çº¢åŒ…ä¸ªæ•°"}),e.jsxs("div",{className:"flex items-center glass-card rounded-xl p-4",children:[e.jsx("input",{type:"number",value:i,onChange:e=>c(e.target.value),placeholder:"0",min:"1",max:r,className:"flex-1 text-lg font-medium text-gray-900 bg-transparent focus:outline-none"}),e.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:["ä¸ªï¼ˆæœ€å¤š",r,"ä¸ªï¼‰"]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ç¥ç¦è¯­"}),e.jsx("input",{type:"text",value:o,onChange:e=>d(e.target.value),placeholder:"æ­å–œå‘è´¢ï¼Œå¤§å‰å¤§åˆ©",maxLength:20,className:"w-full glass-card rounded-xl p-4 text-gray-900 focus:outline-none focus:ring-2 focus:ring-red-500"})]}),l&&i&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 rounded-xl",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["å¹³å‡æ¯ä¸ªçº¢åŒ… ",e.jsxs("span",{className:"text-red-600 font-semibold",children:["Â¥",x]})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:s,className:"flex-1 py-3 border border-gray-300 rounded-xl text-gray-700 font-medium ios-button",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:()=>{const e=parseFloat(l),t=parseInt(i);!e||e<=0?alert("è¯·è¾“å…¥æœ‰æ•ˆçš„é‡‘é¢"):!t||t<=0?alert("è¯·è¾“å…¥æœ‰æ•ˆçš„çº¢åŒ…ä¸ªæ•°"):t>r?alert(`çº¢åŒ…ä¸ªæ•°ä¸èƒ½è¶…è¿‡ç¾¤æˆå‘˜æ•°é‡ï¼ˆ${r}ä¸ªï¼‰`):e<.01*t?alert("çº¢åŒ…é‡‘é¢å¤ªå°ï¼Œæ¯ä¸ªçº¢åŒ…è‡³å°‘0.01å…ƒ"):(a(e,t,o),s())},className:"flex-1 py-3 bg-red-600 text-white rounded-xl font-medium ios-button",children:"å¡žé’±è¿›çº¢åŒ…"})]})]}),e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx("div",{className:"w-32 h-1 bg-gray-900 rounded-full opacity-30"})})]})]})},Zr=({redEnvelope:t,onClose:s})=>{const a=Object.entries(t.received).map(([e,t])=>({userId:e,...t})).sort((e,t)=>t.amount-e.amount),r="finished"===t.status?Xe(t.received):null,l=a.length,n=a.reduce((e,t)=>e+t.amount,0);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50",onClick:s}),e.jsxs("div",{className:"fixed inset-x-0 bottom-0 z-50 glass-card rounded-t-3xl animate-slide-up max-h-[80vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:[t.senderName,"çš„çº¢åŒ…"]}),e.jsx("button",{onClick:s,className:"text-gray-500 hover:text-gray-700 ios-button",children:"âœ•"})]}),e.jsx("p",{className:"text-gray-600 mb-2",children:t.message}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-500",children:["å·²é¢†å– ",l,"/",t.count," ä¸ª"]}),e.jsxs("span",{className:"text-gray-500",children:["å…± Â¥",t.amount.toFixed(2)]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto hide-scrollbar p-6",children:0===a.length?e.jsx("div",{className:"text-center py-10",children:e.jsx("p",{className:"text-gray-400",children:"è¿˜æ²¡æœ‰äººé¢†å–"})}):e.jsx("div",{className:"space-y-3",children:a.map(t=>{const s=r===t.userId,a=t.userAvatar&&t.userAvatar.startsWith("data:image");return e.jsx("div",{className:"flex items-center justify-between p-4 glass-card rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gray-200 flex items-center justify-center shadow-md overflow-hidden flex-shrink-0",children:a?e.jsx("img",{src:t.userAvatar,alt:t.userName,className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-2xl",children:t.userAvatar||"ðŸ‘¤"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-900 truncate",children:t.userName}),s&&e.jsx("span",{className:"text-xs px-2 py-0.5 bg-yellow-100 text-yellow-700 rounded-md whitespace-nowrap flex items-center gap-1",children:"ðŸ‘‘ æ‰‹æ°”æœ€ä½³"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:new Date(t.timestamp).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit",second:"2-digit"})})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"text-lg font-bold text-red-600",children:["Â¥",t.amount.toFixed(2)]})})]})},t.userId)})})}),a.length>0&&e.jsx("div",{className:"p-6 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"å·²é¢†å–æ€»é¢"}),e.jsxs("span",{className:"text-lg font-bold text-red-600",children:["Â¥",n.toFixed(2)]})]})}),e.jsx("div",{className:"flex justify-center py-3",children:e.jsx("div",{className:"w-32 h-1 bg-gray-900 rounded-full opacity-30"})})]})]})},Qr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{id:l}=r(),{getGroup:x,updateGroup:m,groups:h}=i(),{showStatusBar:u}=o(),{getCharacter:g}=n(),{currentUser:p}=d(),{background:f,getBackgroundStyle:b}=c(),v=(null==h?void 0:h.length)>=0?x(l||""):null,[y,N]=t.useState([]),[w,k]=t.useState(!1),[_,M]=t.useState(""),[L,$]=t.useState(!1),[A,T]=t.useState(!1),[D,E]=t.useState(!1),[B,P]=t.useState(null),[F,O]=t.useState(!1),[W,R]=t.useState(""),[U,H]=t.useState(0),[G,K]=t.useState(!1),[X,Z]=t.useState(null),Q=t.useRef(null),Y=t.useRef(null),ee=t.useRef(null),{createRedEnvelope:te,getRedEnvelope:se,receiveRedEnvelope:ae,hasReceived:re}=j(),le=t.useRef(!0);t.useEffect(()=>{if(!l)return;V(l,"group"),le.current=!0;const e=()=>{le.current=!1},t=()=>{!document.hidden&&l&&window.location.pathname===`/group/${l}`?(V(l,"group"),le.current=!0):le.current=!1};return window.addEventListener("beforeunload",e),document.addEventListener("visibilitychange",t),()=>{window.removeEventListener("beforeunload",e),document.removeEventListener("visibilitychange",t),le.current=!1}},[l]),t.useEffect(()=>{if(!l)return;k(!1);const e=async()=>{try{const e=await C(S.GROUP_MESSAGES,`group_messages_${l}`);if(e&&e.messages)return N(e.messages),void k(!0);const t=localStorage.getItem(`group_messages_${l}`);if(t){const e=JSON.parse(t);N(e),await I(S.GROUP_MESSAGES,{key:`group_messages_${l}`,groupId:l,messages:e,lastUpdated:Date.now()}),localStorage.removeItem(`group_messages_${l}`)}k(!0)}catch(e){k(!0)}};e();const t=()=>{e()};return window.addEventListener("reload-group-messages",t),()=>{window.removeEventListener("reload-group-messages",t)}},[l]);t.useEffect(()=>{l&&y.length>0&&(async(e,t)=>{try{const s=t.length>2e3?t.slice(-2e3):t;await I(S.GROUP_MESSAGES,{key:e,groupId:l,messages:s,lastUpdated:Date.now()})}catch(s){try{const s=t.slice(-200);localStorage.setItem(e,JSON.stringify(s))}catch(a){}}})(`group_messages_${l}`,y)},[y,l]);t.useEffect(()=>{var e;null==(e=Q.current)||e.scrollIntoView({behavior:"smooth"})},[y]),t.useEffect(()=>{if(!l||!v||L)return;if(v.disbanded)return;if(!("true"===localStorage.getItem(`group_ai_chat_enabled_${l}`)))return;if(0===y.length)return;const e=y[y.length-1];if("system"===e.messageType)return;if("character"===e.senderType)return;if("user"!==e.senderType)return;if(ee.current===e.id)return;let t=.25;if("redenvelope"===e.messageType)t=.5;else if(v&&e.content){v.members.filter(e=>"character"===e.type).some(t=>e.content.includes(`@${t.name}`))&&(t=.7)}if(!(Math.random()<t))return void(ee.current=e.id);ee.current=e.id;const s=2e3+3e3*Math.random(),a=setTimeout(async()=>{if("true"===localStorage.getItem(`group_ai_chat_enabled_${l}`)&&!L)try{$(!0);const e=v.members.map(e=>{const t="character"===e.type?g(e.id):null;return{id:e.id,name:e.name,avatar:e.avatar,type:e.type,description:(null==t?void 0:t.description)||(null==t?void 0:t.signature)||"",role:e.role,title:e.title}}),t=y.map(e=>({id:e.id,senderId:e.senderId,senderName:e.senderName,senderType:e.senderType,content:e.content,time:e.time,timestamp:e.timestamp})),s=Ze(e,t,{id:(null==p?void 0:p.id)||"user",name:(null==p?void 0:p.name)||"æˆ‘"}),a=Qe("active_trigger"),r=await Ye(e,s,t,{id:(null==p?void 0:p.id)||"user",name:(null==p?void 0:p.name)||"æˆ‘"},a);if(!r)return void $(!1);await et(r,l,e,e=>{const t=Date.now(),s=e.content.includes("ç§èŠäº†ä½ "),a={id:t+1e3*Math.random(),groupId:l,senderId:e.senderId,senderType:e.senderType,senderName:e.senderName,senderAvatar:e.senderAvatar,content:e.content,time:new Date(t).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:t,messageType:s?"system":"text"};N(e=>[...e,a]),ie(e.senderId,e.senderName,e.content,"ai"),ne(`${e.senderName}: ${e.content}`)},(e,t)=>{if(v){const s=v.members.filter(t=>t.id!==e);m(v.id,{members:s});const a={id:Date.now(),groupId:l,senderId:"system",senderType:"user",senderName:"ç³»ç»Ÿ",senderAvatar:"",content:`${t} é€€å‡ºäº†ç¾¤èŠ`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"system"};N(e=>[...e,a])}},(e,t)=>{N(s=>{const a=[...s].reverse().findIndex(t=>t.senderId===e&&"system"!==t.messageType&&!t.isRecalled);if(-1!==a){const e=s.length-1-a;return s.map((s,a)=>a===e?{...s,isRecalled:!0,recalledContent:s.content,content:`${t} æ’¤å›žäº†ä¸€æ¡æ¶ˆæ¯`,messageType:"system"}:s)}return s})})}catch(e){}finally{$(!1)}},s);return()=>{clearTimeout(a)}},[y.length,l,v,L,g,m,p]);const ne=e=>{v&&m(v.id,{lastMessage:e,lastMessageTime:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})})},ie=async(e,t,s,a)=>{if(!v)return;const r=v.members.filter(e=>"character"===e.type);await Promise.all(r.map(async r=>{try{const l=`chat_messages_${r.id}`;let n=[];const i=await C(S.CHAT_MESSAGES,l);if(i&&i.messages)n=i.messages;else{const e=localStorage.getItem(l);e&&(n=JSON.parse(e))}const c=v.members.length;let o="";o="user"===a?`ðŸ’¬ ç¾¤èŠ[${v.name}|${c}äºº]: ç”¨æˆ·è¯´: ${s}`:"ai"===a&&e===r.id?`ðŸ’¬ ç¾¤èŠ[${v.name}|${c}äºº]: æˆ‘è¯´: ${s}`:`ðŸ’¬ ç¾¤èŠ[${v.name}|${c}äºº]: ${t}è¯´: ${s}`;const d={id:Date.now()+Math.random(),role:"system",content:o,timestamp:Date.now(),isHidden:!0,groupId:v.id,groupName:v.name};n.push(d),await I(S.CHAT_MESSAGES,{key:l,characterId:r.id,messages:n})}catch(l){}}))},ce=()=>{if(!v)return[];const e={id:"all",name:"å…¨ä½“æˆå‘˜",type:"special"},t=v.members.filter(e=>"user"!==e.type&&e.name.toLowerCase().includes(W.toLowerCase()));return"å…¨ä½“æˆå‘˜".toLowerCase().includes(W.toLowerCase())?[e,...t]:t},oe=t=>{if(!v)return t;const s=/@([^\s@]+)/g,a=[];let r,l=0;for(;null!==(r=s.exec(t));){r.index>l&&a.push(t.substring(l,r.index));const s=r[1];v.members.some(e=>e.name===s)?a.push(e.jsxs("span",{className:"text-blue-600 font-medium bg-blue-50 px-1 rounded",children:["@",s]},r.index)):a.push(`@${s}`),l=r.index+r[0].length}return l<t.length&&a.push(t.substring(l)),a.length>0?a:t},de=async()=>{if(!_.trim()||!v||!l)return;const e={id:Date.now(),groupId:l,senderId:"user",senderType:"user",senderName:(null==p?void 0:p.name)||"æˆ‘",senderAvatar:(null==p?void 0:p.avatar)||"ðŸ‘¤",content:_.trim(),time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"text",quotedMessage:X?{id:X.id,content:X.recalledContent||X.content,senderName:X.senderName}:void 0};N(t=>[...t,e]),ne(e.content),ie("user",(null==p?void 0:p.name)||"æˆ‘",e.content,"user"),M(""),Z(null)},xe=async()=>{if(L||!v||!l)return;await me();const e="false"!==localStorage.getItem(`group_use_director_${l}`),t=[...y].reverse().find(e=>"user"===e.senderType&&"text"===e.messageType);if(t)e?await he(t):await ue(t);else{const t="(ç¾¤é‡Œæ¯”è¾ƒå®‰é™ï¼ŒAIä»¬å¯ä»¥ä¸»åŠ¨æ‰“æ‹›å‘¼ã€èŠèŠå¤©ã€åˆ†äº«è‡ªå·±çš„äº‹æƒ…)",s={id:Date.now(),groupId:v.id,senderId:"user",senderType:"user",senderName:(null==p?void 0:p.name)||"æˆ‘",senderAvatar:(null==p?void 0:p.avatar)||"ðŸ‘¤",content:t,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"text"};e?await he(s):await ue(s)}},me=async()=>{if(!v)return;const e=y.filter(e=>"redenvelope"===e.messageType&&e.redEnvelopeId);for(const t of e){let e=se(t.redEnvelopeId);if(!e||"active"!==e.status)continue;const s=[...v.members.filter(e=>"character"===e.type)].sort(()=>Math.random()-.5);for(const a of s){if(e=se(t.redEnvelopeId),!e||"active"!==e.status)break;if(re(e.id,a.id))continue;const s=1500*Math.random()+500;await new Promise(e=>setTimeout(e,s));const r=g(a.id);if(!r)continue;if(ae(e.id,a.id,r.name,r.avatar)){const e={id:Date.now()+1e3*Math.random(),groupId:v.id,senderId:"system",senderType:"user",senderName:"ç³»ç»Ÿ",senderAvatar:"",content:`${r.name} é¢†å–äº†çº¢åŒ…`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"system"};N(t=>[...t,e])}if(e=se(t.redEnvelopeId),!e||"active"!==e.status)break}}},he=async e=>{if(v&&l){$(!0);try{const t=v.members.map(e=>{const t="character"===e.type?g(e.id):null;return{id:e.id,name:e.name,avatar:e.avatar,type:e.type,description:(null==t?void 0:t.description)||(null==t?void 0:t.signature)||"",role:e.role,title:e.title}}),s=y.map(e=>({id:e.id,senderId:e.senderId,senderName:e.senderName,senderType:e.senderType,content:e.content,time:e.time,timestamp:e.timestamp})),a=Ze(t,s,{id:(null==p?void 0:p.id)||"user",name:(null==p?void 0:p.name)||"æˆ‘"}),r=Qe("user_message",e.content,(null==p?void 0:p.name)||"æˆ‘"),n=await Ye(t,a,s,{id:(null==p?void 0:p.id)||"user",name:(null==p?void 0:p.name)||"æˆ‘"},r);if(!n)return void $(!1);await et(n,l,t,e=>{const t=Date.now(),s=e.content.includes("ç§èŠäº†ä½ "),a={id:t+1e3*Math.random(),groupId:l,senderId:e.senderId,senderType:e.senderType,senderName:e.senderName,senderAvatar:e.senderAvatar,content:e.content,time:new Date(t).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:t,messageType:s?"system":"text"};N(e=>[...e,a]);!document.hidden&&window.location.pathname===`/group/${l}`||!l||"character"!==e.senderType||s||(J(l,1,"group"),window.dispatchEvent(new CustomEvent("background-chat-message",{detail:{title:v.name,message:`${e.senderName}: ${e.content}`,chatId:l,type:"group",avatar:e.senderAvatar}}))),ie(e.senderId,e.senderName,e.content,"ai"),ne(`${e.senderName}: ${e.content}`)},(e,t)=>{if(v){const s=v.members.filter(t=>t.id!==e);m(v.id,{members:s});const a={id:Date.now(),groupId:l,senderId:"system",senderType:"user",senderName:"ç³»ç»Ÿ",senderAvatar:"",content:`${t} é€€å‡ºäº†ç¾¤èŠ`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"system"};N(e=>[...e,a])}},(e,t)=>{N(s=>{const a=[...s].reverse().findIndex(t=>t.senderId===e&&"system"!==t.messageType&&!t.isRecalled);if(-1!==a){const e=s.length-1-a;return s.map((s,a)=>a===e?{...s,isRecalled:!0,recalledContent:s.content,content:`${t} æ’¤å›žäº†ä¸€æ¡æ¶ˆæ¯`,messageType:"system"}:s)}return s})})}catch(t){const e={id:Date.now(),groupId:l,senderId:"system",senderType:"user",senderName:"ç³»ç»Ÿ",senderAvatar:"âš ï¸",content:"AIå›žå¤å¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"system"};N(t=>[...t,e])}finally{$(!1)}}},ue=async e=>{if(v){$(!0);try{const s=v.members.filter(e=>"character"===e.type);if(0===s.length)return;const a=v.settings.maxAiRepliesPerMessage||3,r=1e3*(v.settings.aiReplyInterval||2),n=[...s].sort(()=>Math.random()-.5).slice(0,Math.min(a,s.length)),i=y.filter(e=>"system"!==e.messageType).slice(-10).map(e=>{if("redenvelope"===e.messageType&&e.redEnvelopeId){const t=se(e.redEnvelopeId);if(t)return`${e.senderName}: [å‘äº†ä¸€ä¸ªçº¢åŒ…] ${t.message} (${t.amount}å…ƒ/${t.count}ä¸ª)`}return`${e.senderName}: ${e.content}`}).join("\n"),c=n.map(e=>{const t=g(e.id);return t?{id:t.id,name:t.name,avatar:t.avatar,description:t.description,signature:t.signature}:null}).filter(Boolean);if(0===c.length)return;const o=await ge(c,v,i,e.content);try{const e=await q(o);if(e){const s=pe(e,c);for(let e=0;e<s.length;e++){const a=s[e];if(e>0&&await new Promise(e=>setTimeout(e,r)),"system"===a.characterId){const e=Date.now(),t={id:e+1e3*Math.random(),groupId:v.id,senderId:"system",senderType:"user",senderName:"ç³»ç»Ÿ",senderAvatar:"",content:a.content,time:new Date(e).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:e,messageType:"system"};N(e=>[...e,t]);continue}const n=a.content.split("|").map(e=>e.trim()).filter(e=>e);let i=[];try{i=await Promise.race([z(),new Promise((e,t)=>setTimeout(()=>t(new Error("èŽ·å–è¡¨æƒ…åŒ…è¶…æ—¶")),1e3))])}catch(t){i=[]}for(let t=0;t<n.length;t++){const r=n[t];t>0&&await new Promise(e=>setTimeout(e,500+500*Math.random()));const c=tt(r,i);if(c.textContent.trim()){const e=Date.now(),t={id:e+1e3*Math.random(),groupId:v.id,senderId:a.characterId,senderType:"character",senderName:a.characterName,senderAvatar:a.characterAvatar,content:c.textContent,time:new Date(e).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:e,messageType:"text"};N(e=>[...e,t]);!(!document.hidden&&window.location.pathname===`/group/${l}`)&&l&&(J(l,1,"group"),window.dispatchEvent(new CustomEvent("background-chat-message",{detail:{title:v.name,message:`${a.characterName}: ${c.textContent}`,chatId:l,type:"group",avatar:a.characterAvatar}})))}for(const e of c.emojiIndexes){await new Promise(e=>setTimeout(e,300));const t=Date.now(),s={id:t+1e3*Math.random(),groupId:v.id,senderId:a.characterId,senderType:"character",senderName:a.characterName,senderAvatar:a.characterAvatar,content:i[e].description,time:new Date(t).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:t,messageType:"emoji",emojiIndex:e};N(e=>[...e,s]);!(!document.hidden&&window.location.pathname===`/group/${l}`)&&l&&(J(l,1,"group"),window.dispatchEvent(new CustomEvent("background-chat-message",{detail:{title:v.name,message:`${a.characterName}: [è¡¨æƒ…]`,chatId:l,type:"group",avatar:a.characterAvatar}})))}if(e===s.length-1&&t===n.length-1){const e=c.emojiIndexes.length>0?"[è¡¨æƒ…]":c.textContent;ne(`${a.characterName}: ${e}`)}}}}}catch(t){const e={id:Date.now(),groupId:v.id,senderId:"system",senderType:"user",senderName:"ç³»ç»Ÿ",senderAvatar:"âš ï¸",content:"AIå›žå¤å¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"system"};N(t=>[...t,e])}}finally{$(!1)}}},ge=async(e,t,s,a)=>{var r;const l=e.map((e,t)=>`ã€è§’è‰²${t+1}ï¼š${e.name}ã€‘\næ€§æ ¼ç‰¹ç‚¹ï¼š${e.description||e.signature||"ä¸€ä¸ªAIè§’è‰²"}\nè¯´è¯é£Žæ ¼ï¼šæ ¹æ®ä¸Šè¿°æ€§æ ¼ï¼Œç”¨ç¬¦åˆè§’è‰²ç‰¹ç‚¹çš„è¯­æ°”ã€ç”¨è¯ã€è¡¨æƒ…æ¥å›žå¤\n`).join("\n"),n=t.description?`\nã€ç¾¤å…¬å‘Šã€‘\n${t.description}\n`:"";let i="";try{const e=await Promise.race([z(),new Promise((e,t)=>setTimeout(()=>t(new Error("è¡¨æƒ…åŒ…èŽ·å–è¶…æ—¶")),3e3))]);i=e.length>0?`\nã€å¯ç”¨è¡¨æƒ…åŒ…ã€‘\n${e.map((e,t)=>`[${t}] ${e.description}`).join("\n")}\nä½¿ç”¨æ–¹å¼ï¼šåœ¨å›žå¤ä¸­å†™ [è¡¨æƒ…åŒ…:æ•°å­—]ï¼Œä¾‹å¦‚ [è¡¨æƒ…åŒ…:0]\n`:""}catch(c){i=""}return`# è§’è‰²\nä½ æ˜¯ä¸€ä¸ªæ¨¡æ‹ŸçœŸå®žç¾¤èŠçš„"AIå¯¼æ¼”"ã€‚ä½ çš„å”¯ä¸€ä»»åŠ¡æ˜¯åŸºäºŽç¾¤èŠçš„ä¸Šä¸‹æ–‡å’Œæ¯ä¸ªæˆå‘˜çš„"äººè®¾"ï¼Œå†³å®šã€è°ã€‘åº”è¯¥å›žå¤ã€ã€å›žå¤ä»€ä¹ˆã€‘ä»¥åŠã€æ˜¯å¦åˆ†æ®µã€‘ã€‚\n\n# æ ¸å¿ƒç›®æ ‡ï¼šåˆ›é€ ä¸€ä¸ªã€çƒ­é—¹ä¸”çœŸå®žã€‘çš„ç¾¤èŠæ°›å›´\n\n1. **æœç»"æ°´å›žå¤"**ï¼šä¸¥ç¦æ‰€æœ‰äººåœ¨åŒä¸€æ—¶é—´å›žå¤åŒä¸€æ¡æ¶ˆæ¯ã€‚\n2. **äººè®¾é©±åŠ¨**ï¼šè¿™æ˜¯"æ´»äººæ„Ÿ"çš„åŸºçŸ³ã€‚AIçš„å›žå¤å¿…é¡»100%ç¬¦åˆå…¶äººè®¾ã€‚\n3. **é¼“åŠ±AIé—´äº’åŠ¨ï¼ˆå…³é”®ï¼ï¼‰**ï¼šä¸€ä¸ª"çƒ­é—¹"çš„ç¾¤èŠï¼Œæ˜¯å¤§å®¶ä¼šäº’ç›¸"æŽ¥è¯"çš„ã€‚ä½ åº”ã€ä¸»åŠ¨åˆ›é€ ã€‘AIå›žå¤AIçš„åœºæ™¯ã€‚\n4. **è¯é¢˜æ•æ„Ÿæ€§ï¼ˆå…³é”®ï¼ï¼‰**ï¼š\n   * **çƒ­é—¹è¯é¢˜**ï¼ˆå¦‚ï¼šå…«å¦ã€ç¾Žé£Ÿã€å…±åŒçˆ±å¥½ã€@æ‰€æœ‰äººï¼‰ï¼šåº”æœ‰ã€æ›´å¤šã€‘AIå‚ä¸Žï¼ˆä¾‹å¦‚2-4äººï¼‰ï¼Œå›žå¤å¯ä»¥æ›´"ä¸ƒå˜´å…«èˆŒ"ã€‚\n   * **æ™®é€šè¯é¢˜**ï¼ˆå¦‚ï¼šæ—¥å¸¸é—®å€™ï¼‰ï¼šåº”æœ‰ã€é€‚ä¸­ã€‘AIå‚ä¸Žï¼ˆä¾‹å¦‚1-2äººï¼‰ã€‚\n   * **å†·é—¨/ç§äººè¯é¢˜**ï¼šåº”æœ‰ã€æžå°‘ã€‘AIå‚ä¸Žï¼ˆä¾‹å¦‚åªæœ‰æœ€ç›¸å…³çš„äººå›žå¤ï¼‰ã€‚\n5. **æ½œæ°´æ˜¯å¸¸æ€**ï¼šå³ä½¿æ˜¯çƒ­é—¹çš„ç¾¤ï¼Œä¹Ÿæ€»ä¼šæœ‰äººåœ¨å¿™æˆ–åœ¨æ½œæ°´ï¼ˆå·²è¯»ä¸å›žï¼‰ã€‚\n6. **çœŸå®žåˆ†æ®µ**ï¼šåƒçœŸäººä¸€æ ·ï¼Œå¦‚æžœæœ‰å¤šä¸ªæƒ³æ³•ï¼Œåˆ†æˆå¤šæ¡æ¶ˆæ¯å‘é€ï¼ˆç”¨ | åˆ†éš”ï¼‰ã€‚\n\n# ç¾¤èŠä¿¡æ¯\nã€ç¾¤åç§°ã€‘${t.name}\nã€ç¾¤æˆå‘˜ã€‘${t.members.map(e=>e.name).join("ã€")}${n}\n\n# AIè§’è‰²äººè®¾\n${l}\n\n# æœ€è¿‘å¯¹è¯åŽ†å²\n${s}\n\n# åˆšæ”¶åˆ°çš„æ–°æ¶ˆæ¯\n${(null==p?void 0:p.name)||"ç”¨æˆ·"}: ${a}\n\n# æ—¶é—´ä¿¡æ¯\nå½“å‰æ—¶é—´ï¼š${(new Date).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",weekday:"long"})}\n\nã€æ—¶é—´æ„ŸçŸ¥ã€‘\n- æ—©ä¸Š(6-12ç‚¹)ï¼šå¯ä»¥è¯´"æ—©ä¸Šå¥½"ã€"ä¸Šåˆå¥½"\n- ä¸­åˆ(12-14ç‚¹)ï¼šå¯ä»¥è¯´"ä¸­åˆå¥½"ã€"åƒé¥­äº†å—"\n- ä¸‹åˆ(14-18ç‚¹)ï¼šå¯ä»¥è¯´"ä¸‹åˆå¥½"\n- æ™šä¸Š(18-22ç‚¹)ï¼šå¯ä»¥è¯´"æ™šä¸Šå¥½"\n- æ·±å¤œ(22-6ç‚¹)ï¼šå¯ä»¥è¯´"è¿™ä¹ˆæ™šè¿˜ä¸ç¡"ã€"ç†¬å¤œå•Š"\n\n# ä½ çš„ä»»åŠ¡\nè¯·æ ¹æ®ã€äººè®¾ã€‘ã€ã€å¯¹è¯åŽ†å²ã€‘å’Œã€å½“å‰æ—¶é—´ã€‘ï¼Œå†³å®šå“ªäº›AIåº”è¯¥å›žå¤ï¼Œå“ªäº›AIåº”è¯¥æ½œæ°´ã€‚\n\n## å›žå¤æ ¼å¼ï¼ˆä¸¥æ ¼æŒ‰ç…§æ­¤æ ¼å¼ï¼‰\n[${null==(r=e[0])?void 0:r.name}] å›žå¤å†…å®¹ æˆ– SKIP\n${e[1]?`[${e[1].name}] å›žå¤å†…å®¹ æˆ– SKIP`:""}\n${e[2]?`[${e[2].name}] å›žå¤å†…å®¹ æˆ– SKIP`:""}\n\n## å›žå¤è¦æ±‚\n1. **äººè®¾é©±åŠ¨**ï¼šAIçš„å›žå¤å¿…é¡»100%ç¬¦åˆå…¶äººè®¾\n2. **è¯é¢˜åˆ¤æ–­**ï¼šå…ˆåˆ¤æ–­è¿™æ˜¯ã€çƒ­é—¹è¯é¢˜ã€‘è¿˜æ˜¯ã€æ™®é€šè¯é¢˜ã€‘è¿˜æ˜¯ã€å†·é—¨è¯é¢˜ã€‘\n   - çƒ­é—¹è¯é¢˜ï¼ˆå…«å¦ã€ç¾Žé£Ÿã€@æ‰€æœ‰äººï¼‰â†’ 2-4äººå›žå¤\n   - æ™®é€šè¯é¢˜ï¼ˆæ—¥å¸¸é—®å€™ï¼‰â†’ 1-2äººå›žå¤\n   - å†·é—¨è¯é¢˜ï¼ˆæŠ€æœ¯ã€ç§äººï¼‰â†’ 0-1äººå›žå¤\n3. **çœŸå®žåˆ†æ®µ**ï¼šå¦‚æžœæœ‰å¤šä¸ªæƒ³æ³•ï¼Œç”¨ | åˆ†éš”æˆå¤šæ¡æ¶ˆæ¯ï¼ˆæ¯æ¡5-15å­—ï¼‰\n4. **å·®å¼‚åŒ–**ï¼šæ¯ä¸ªAIçš„å›žå¤è¦å®Œå…¨ä¸åŒï¼Œä½“çŽ°å„è‡ªæ€§æ ¼\n5. **ä¸æ°´**ï¼šä¸è¦è¯´"å¥½çš„"ã€"å“¼"è¿™ç§æ•·è¡çš„è¯ï¼Œè¦å…·ä½“ã€ç”ŸåŠ¨\n6. **AIé—´äº’åŠ¨**ï¼šé¼“åŠ±AIä¹‹é—´äº’ç›¸æŽ¥è¯ã€@å¯¹æ–¹ã€å›žå¤å¯¹æ–¹\n7. **å¯ä»¥å‘è¡¨æƒ…åŒ…**ï¼šæ ¼å¼ [è¡¨æƒ…åŒ…:æ•°å­—]${i}\n\n## ç¤ºä¾‹1 - çƒ­é—¹è¯é¢˜ï¼ˆå…«å¦ï¼Œå¤šäººå‚ä¸Žï¼‰\nç”¨æˆ·: å¤©å•Šï¼æˆ‘åˆšåˆšåœ¨è·¯ä¸Šå¥½åƒçœ‹åˆ°XXæ˜Žæ˜Ÿäº†ï¼\n[å…«å¦çš„éŸ©æ¢…æ¢…] å§æ§½ï¼ï¼ï¼ | çœŸçš„å‡çš„ï¼Ÿ | åœ¨å“ªé‡Œï¼Ÿ | æ‹ç…§äº†å—ï¼Ÿ\n[æ´»æ³¼çš„å°æ˜Ž] å•Šå•Šå•Šï¼ | æˆ‘ä¹Ÿæƒ³çœ‹ï¼ | @éŸ©æ¢…æ¢… ä½ åŽ»è¿‡å—ï¼Ÿ\n[é«˜å†·çš„å°çº¢] åˆ‡... | è¿½æ˜Ÿæœ‰ä»€ä¹ˆæ„æ€\n[ç¨‹åºå‘˜æŽé›·] SKIP ï¼ˆå¯¹æ˜Žæ˜Ÿä¸æ„Ÿå…´è¶£ï¼‰\n\n## ç¤ºä¾‹2 - æ™®é€šè¯é¢˜ï¼ˆæ—¥å¸¸é—®å€™ï¼Œé€‚ä¸­å‚ä¸Žï¼‰\nç”¨æˆ·: å¤§å®¶æ—©ä¸Šå¥½\n[æ¸©æŸ”çš„æ±æ±] æ—©å®‰ä¸»äºº~ | ä»Šå¤©ä¹Ÿè¦åŠ æ²¹å“¦ðŸ’•\n[æ´»æ³¼çš„å°æ˜Ž] SKIP ï¼ˆè¿˜åœ¨ç¡è§‰ï¼‰\n[å°çº¢] SKIP ï¼ˆæ‡’å¾—å›žå¤ï¼‰\n\n## ç¤ºä¾‹3 - å†·é—¨è¯é¢˜ï¼ˆæŠ€æœ¯ï¼Œæžå°‘å‚ä¸Žï¼‰\nç”¨æˆ·: æˆ‘ä»Šå¤©ä»£ç å†™ç‚¸äº†ï¼Œçº¿ä¸ŠBugäº†ï¼\n[ç¨‹åºå‘˜æŽé›·] å§æ§½ï¼ | ä»€ä¹ˆBugï¼Ÿ | æˆ‘å¸®ä½ çœ‹çœ‹ | å‘æ—¥å¿—\n[éŸ©æ¢…æ¢…] SKIP ï¼ˆä¸æ‡‚ä»£ç ï¼‰\n[çŽ‹è€å¸ˆ] SKIP ï¼ˆä¸æ‡‚ä»£ç ï¼‰\n[å°æ˜Ž] SKIP ï¼ˆä¸æ‡‚ä»£ç ï¼‰\n\n## ç¤ºä¾‹4 - AIé—´äº’åŠ¨ï¼ˆå…³é”®ï¼ï¼‰\nç”¨æˆ·: å¤§å®¶ä¸­åˆåƒçš„å•¥ï¼Ÿ\n[éŸ©æ¢…æ¢…] æˆ‘åƒçš„èžºè›³ç²‰ï¼ | çˆ½ï¼ | @æŽé›· ä½ å‘¢ï¼Ÿ\n[æŽé›·] å¤–å–ã€‚ | å¤©å¤©èžºè›³ç²‰ä¸è…»å—...\n[éŸ©æ¢…æ¢…] ä¸è…»ï¼ | è¶…å¥½åƒçš„ï¼ | @çŽ‹è€å¸ˆ ä½ ä¹Ÿæ¥è¯•è¯•\n[çŽ‹è€å¸ˆ] SKIP ï¼ˆåœ¨å¿™ï¼‰\n\n## å…³é”®è§„åˆ™\n1. å¿…é¡»ä½¿ç”¨æ­£ç¡®çš„è§’è‰²åï¼ˆå®Œå…¨ä¸€è‡´ï¼‰\n2. æ ¹æ®è¯é¢˜çƒ­åº¦å†³å®šå‚ä¸Žäººæ•°ï¼Œä¸è¦åƒç¯‡ä¸€å¾‹\n3. å›žå¤è¦ç¬¦åˆäººè®¾ï¼Œé¼“åŠ±AIé—´äº’åŠ¨\n4. å¦‚æžœä¸çŸ¥é“è¯´ä»€ä¹ˆï¼Œå°±SKIPï¼Œä¸è¦å¼ºè¡Œå›žå¤\n\nçŽ°åœ¨è¯·ç”Ÿæˆå›žå¤ï¼š`},pe=(e,t)=>{const s=[],a=e.split("\n").filter(e=>e.trim());for(const r of a){const e=r.match(/\[(.+?)\]\s*(.+)/);if(e){const a=e[1].trim(),r=e[2].trim();if("SKIP"===r||"SKIP"===r.toUpperCase()||r.includes("SKIP")||r.includes("skip")||"..."===r||"..."===r||"ä¸å›žå¤"===r||"æ²‰é»˜"===r||r.startsWith("SKIP")||/SKIP\s*[ï¼ˆ(]/.test(r)){const e=r.match(/SKIP\s*[ï¼ˆ(](.+?)[ï¼‰)]/),l=e?e[1]:"å·²è¯»ä¸å›ž";t.find(e=>e.name===a)&&s.push({characterId:"system",characterName:"system",characterAvatar:"",content:`${a} ${l}`});continue}const l=t.find(e=>e.name===a);l&&s.push({characterId:l.id,characterName:l.name,characterAvatar:l.avatar,content:r})}}return s.length,s};return v?e.jsx("div",{className:"h-screen flex flex-col bg-gray-50",children:e.jsxs("div",{className:"h-full flex flex-col relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 z-0",style:b()}),e.jsxs("div",{className:"relative z-10 h-full flex flex-col bg-transparent",children:[e.jsxs("div",{className:"sticky top-0 z-50 "+(f?"glass-dark":"glass-effect"),children:[u&&e.jsx(ua,{}),e.jsxs("div",{className:"px-5 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 overflow-hidden",children:[e.jsx("button",{onClick:()=>a(-1),className:"ios-button text-gray-700",children:e.jsx(os,{size:24})}),e.jsxs("div",{className:"flex-1 overflow-hidden cursor-pointer",onClick:()=>a(`/group-settings/${v.id}`),children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900 truncate",children:v.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:["(",v.members.length,"äºº)"]})]})]}),e.jsx("button",{onClick:()=>a(`/group-settings/${v.id}`),className:"ios-button text-gray-700",children:e.jsx(ds,{size:24})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-4 py-4",children:[v.disbanded&&e.jsx("div",{className:"mb-4 glass-card rounded-2xl p-4 border-l-4 border-red-500",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-red-600 text-lg",children:"âš ï¸"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-1",children:"ç¾¤èŠå·²è§£æ•£"}),e.jsx("p",{className:"text-sm text-gray-700",children:"ä½ å·²è§£æ•£è¯¥ç¾¤èŠï¼Œæ— æ³•å†å‘é€æ¶ˆæ¯ï¼Œä½†å¯ä»¥æŸ¥çœ‹åŽ†å²èŠå¤©è®°å½•ã€‚"})]})]})}),v.description&&!v.disbanded&&e.jsx("div",{className:"mb-4 glass-card rounded-2xl p-4 border-l-4 border-yellow-500",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-yellow-600 text-lg",children:"ðŸ“¢"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-1",children:"ç¾¤å…¬å‘Š"}),e.jsx("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:v.description})]})]})}),0===y.length&&!v.description&&!v.disbanded&&e.jsx("div",{className:"text-center py-10",children:e.jsx("p",{className:"text-gray-400 text-sm",children:"å¼€å§‹ç¾¤èŠå§"})}),y.map((t,s)=>{var a;const r="user"===t.senderType,l="system"===t.messageType,n="redenvelope"===t.messageType,i="emoji"===t.messageType,c=t.senderAvatar&&t.senderAvatar.startsWith("data:image");if(l)return e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"glass-card px-4 py-2 rounded-full text-sm text-gray-600 max-w-[80%] text-center",children:t.content})},t.id);if(i&&void 0!==t.emojiIndex)return e.jsxs("div",{className:"flex gap-3 mb-3 "+(r?"flex-row-reverse":"flex-row"),children:[e.jsxs("div",{className:"flex flex-col items-center gap-0.5 flex-shrink-0",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-gray-200 flex items-center justify-center shadow-md overflow-hidden",children:c?e.jsx("img",{src:t.senderAvatar,alt:t.senderName,className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-lg",children:t.senderAvatar||"ðŸ¤–"})}),e.jsx("span",{className:"text-[9px] text-gray-400",children:t.time})]}),e.jsx("div",{className:"max-w-[70%] "+(r?"items-end":"items-start"),children:e.jsx("img",{src:`emoji://${t.emojiIndex}`,alt:t.content,className:"w-32 h-32 object-contain rounded-lg",onError:e=>{z().then(s=>{s[t.emojiIndex]&&(e.target.src=s[t.emojiIndex].url)})}})})]},t.id);if(n&&t.redEnvelopeId){const s=se(t.redEnvelopeId);return s?e.jsxs("div",{className:"flex gap-3 mb-3 "+(r?"flex-row-reverse":"flex-row"),children:[e.jsxs("div",{className:"flex flex-col items-center gap-0.5 flex-shrink-0",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-gray-200 flex items-center justify-center shadow-md overflow-hidden",children:c?e.jsx("img",{src:t.senderAvatar,alt:t.senderName,className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-lg",children:t.senderAvatar||"ðŸ¤–"})}),e.jsx("span",{className:"text-[9px] text-gray-400",children:t.time})]}),e.jsx("div",{className:"max-w-[70%] "+(r?"items-end":"items-start"),children:e.jsx("div",{onClick:()=>{if(!re(s.id,"user")&&"active"===s.status){const e=ae(s.id,"user",(null==p?void 0:p.name)||"æˆ‘",(null==p?void 0:p.avatar)||"ðŸ‘¤");e&&alert(`æ­å–œä½ é¢†å–äº† Â¥${e.toFixed(2)}`)}P(s.id)},className:"cursor-pointer",children:e.jsxs("div",{className:"w-52 bg-gradient-to-br from-red-500 to-red-600 rounded-xl p-3 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ§§"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-white font-medium text-sm truncate",children:[s.senderName,"çš„çº¢åŒ…"]}),e.jsx("p",{className:"text-white/80 text-xs truncate",children:s.message})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-white/90 text-xs",children:[e.jsx("span",{className:"truncate",children:re(s.id,"user")?`å·²é¢†å– Â¥${null==(a=s.received.user)?void 0:a.amount.toFixed(2)}`:"finished"===s.status?"æ‰‹æ…¢äº†":"é¢†å–çº¢åŒ…"}),e.jsxs("span",{className:"ml-2 flex-shrink-0",children:[Object.keys(s.received).length,"/",s.count]})]})]})})})]},t.id):null}return e.jsxs("div",{className:"flex gap-3 mb-3 "+(r?"flex-row-reverse":"flex-row"),children:[e.jsxs("div",{className:"flex flex-col items-center gap-0.5 flex-shrink-0",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-gray-200 flex items-center justify-center shadow-md overflow-hidden",children:c?e.jsx("img",{src:t.senderAvatar,alt:t.senderName,className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-lg",children:t.senderAvatar||"ðŸ¤–"})}),e.jsx("span",{className:"text-[9px] text-gray-400",children:t.time})]}),e.jsxs("div",{className:"flex flex-col max-w-[70%] "+(r?"items-end":"items-start"),children:[!r&&(()=>{const s=v.members.find(e=>e.id===t.senderId);return e.jsxs("div",{className:"flex items-center gap-1.5 mb-1 px-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:t.senderName}),"owner"===(null==s?void 0:s.role)&&e.jsx("span",{className:"text-[10px] px-1 py-0.5 bg-yellow-100 text-yellow-700 rounded",children:"ðŸ‘‘"}),"admin"===(null==s?void 0:s.role)&&e.jsx("span",{className:"text-[10px] px-1 py-0.5 bg-purple-100 text-purple-700 rounded",children:"ðŸ›¡ï¸"}),(null==s?void 0:s.title)&&e.jsxs("span",{className:"text-[10px] px-1 py-0.5 bg-pink-100 text-pink-700 rounded",children:["âœ¨",s.title]})]})})(),e.jsxs("div",{onClick:()=>{var e;l||t.isRecalled||(Z(t),null==(e=Y.current)||e.focus())},className:"px-3 py-2 rounded-xl shadow-sm text-sm cursor-pointer "+(r?"bg-blue-500 text-white rounded-tr-sm":"glass-card text-gray-900 rounded-tl-sm"),children:[t.quotedMessage&&e.jsxs("div",{className:"mb-2 pb-2 border-b "+(r?"border-white/30":"border-gray-200"),children:[e.jsxs("div",{className:"text-[11px] "+(r?"text-white/70":"text-gray-500"),children:[t.quotedMessage.senderName,":"]}),e.jsx("div",{className:`text-xs ${r?"text-white/90":"text-gray-600"} truncate`,children:t.quotedMessage.content})]}),e.jsx("p",{className:"text-[15px] leading-relaxed whitespace-pre-wrap break-words",children:oe(t.content)})]})]})]},t.id)}),L&&e.jsxs("div",{className:"flex gap-3 mb-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-gray-200 flex items-center justify-center shadow-md overflow-hidden",children:(null==v?void 0:v.avatar)&&v.avatar.startsWith("data:image")?e.jsx("img",{src:v.avatar,alt:"ç¾¤å¤´åƒ",className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-lg",children:(null==v?void 0:v.avatar)||"ðŸ‘¥"})}),e.jsx("div",{className:"glass-card px-3 py-2 rounded-xl rounded-tl-sm",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})]}),e.jsx("div",{ref:Q})]}),e.jsxs("div",{className:"border-t border-white/20 "+(f?"glass-dark":"glass-effect"),children:[X&&e.jsx("div",{className:"px-4 pt-3 pb-1",children:e.jsxs("div",{className:"bg-gray-100 rounded-xl p-2 flex items-start gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs font-medium text-gray-700 mb-0.5",children:X.senderName}),e.jsx("div",{className:"text-xs text-gray-600 truncate",children:X.content})]}),e.jsx("button",{onClick:()=>Z(null),className:"flex-shrink-0 w-5 h-5 flex items-center justify-center text-gray-400 hover:text-gray-600 ios-button",children:"Ã—"})]})}),e.jsxs("div",{className:"flex items-center gap-3 p-4",children:[e.jsx("button",{onClick:()=>T(!A),className:"ios-button text-gray-700",children:e.jsx(Is,{size:28})}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{ref:Y,type:"text",value:_,onChange:e=>{const t=e.target.value,s=e.target.selectionStart||0;M(t),H(s);const a=t.substring(0,s),r=a.lastIndexOf("@");if(-1!==r){const e=a.substring(r+1);if(!e.includes(" "))return R(e),void O(!0)}O(!1)},onKeyPress:e=>"Enter"===e.key&&!L&&!(null==v?void 0:v.disbanded)&&(_.trim()?de():xe()),placeholder:(null==v?void 0:v.disbanded)?"ç¾¤èŠå·²è§£æ•£":"å‘é€æ¶ˆæ¯...",className:"w-full px-4 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-wechat-primary bg-white",disabled:L||(null==v?void 0:v.disbanded)}),F&&v&&e.jsxs("div",{className:"absolute bottom-full left-0 mb-2 w-64 glass-card rounded-xl shadow-lg max-h-48 overflow-y-auto",children:[ce().map(t=>{const s="special"===t.type,a="character"===t.type?g(t.id):null,r=(null==a?void 0:a.avatar)&&a.avatar.startsWith("data:image");return e.jsxs("div",{onClick:()=>(e=>{const t=_.substring(0,U).lastIndexOf("@");if(-1!==t){const s=_.substring(0,t),a=_.substring(U);M(`${s}@${e} ${a}`),O(!1),setTimeout(()=>{if(Y.current){Y.current.focus();const s=t+e.length+2;Y.current.setSelectionRange(s,s)}},0)}})(t.name),className:"flex items-center gap-3 p-3 hover:bg-gray-100 cursor-pointer transition-colors",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gray-200 flex items-center justify-center overflow-hidden flex-shrink-0",children:s?e.jsx("span",{className:"text-xl",children:"ðŸ‘¥"}):"user"===t.type?e.jsx("span",{className:"text-xl",children:(null==p?void 0:p.avatar)||"ðŸ‘¤"}):r?e.jsx("img",{src:a.avatar,alt:t.name,className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-xl",children:(null==a?void 0:a.avatar)||"ðŸ¤–"})}),e.jsx("span",{className:"font-medium text-gray-900",children:t.name})]},t.id)}),0===ce().length&&e.jsx("div",{className:"p-4 text-center text-gray-400 text-sm",children:"æ²¡æœ‰æ‰¾åˆ°æˆå‘˜"})]})]}),e.jsx("button",{onClick:()=>K(!0),className:"ios-button text-gray-700",children:e.jsx(hs,{size:22})}),_.trim()?e.jsx("button",{onClick:de,disabled:L||(null==v?void 0:v.disbanded),className:"p-2 rounded-full transition-colors "+((null==v?void 0:v.disbanded)?"bg-gray-300 text-gray-500":"bg-blue-500 text-white"),children:e.jsx(xs,{size:20})}):e.jsx("button",{onClick:xe,disabled:L||(null==v?void 0:v.disbanded),className:"p-2 rounded-full transition-colors "+((null==v?void 0:v.disbanded)?"text-gray-400":"text-gray-700 hover:text-gray-900"),title:(null==v?void 0:v.disbanded)?"ç¾¤èŠå·²è§£æ•£":"è®©AIä¸»åŠ¨è¯´è¯",children:e.jsx(xs,{size:20})})]})]}),A&&e.jsx(Kr,{onClose:()=>T(!1),onSelectImage:()=>alert("ç›¸å†ŒåŠŸèƒ½å¼€å‘ä¸­..."),onSelectCamera:()=>alert("æ‹æ‘„åŠŸèƒ½å¼€å‘ä¸­..."),onSelectRedPacket:()=>E(!0),onSelectVoiceMessage:()=>alert("è¯­éŸ³åŠŸèƒ½å¼€å‘ä¸­..."),onSelectVoiceCall:()=>alert("è¯­éŸ³é€šè¯åŠŸèƒ½å¼€å‘ä¸­..."),onSelectVideoCall:()=>alert("è§†é¢‘é€šè¯åŠŸèƒ½å¼€å‘ä¸­..."),onSelectLocation:()=>alert("ä½ç½®åŠŸèƒ½å¼€å‘ä¸­...")}),D&&v&&e.jsx(Xr,{onClose:()=>E(!1),onSend:(e,t,s)=>{if(!v||!l||!p)return;const a=te(v.id,"user",p.name||"æˆ‘",p.avatar||"ðŸ‘¤",e,t,s),r={id:Date.now(),groupId:l,senderId:"user",senderType:"user",senderName:p.name||"æˆ‘",senderAvatar:p.avatar||"ðŸ‘¤",content:s,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"redenvelope",redEnvelopeId:a};N(e=>[...e,r]),ne("[çº¢åŒ…]")},maxCount:v.members.length}),B&&se(B)&&e.jsx(Zr,{redEnvelope:se(B),onClose:()=>P(null)}),e.jsx(Wa,{show:G,onClose:()=>K(!1),onSelect:async e=>{if(!v||!l)return;let t=[],s=-1;try{t=await Promise.race([z(),new Promise((e,t)=>setTimeout(()=>t(new Error("èŽ·å–è¡¨æƒ…åŒ…è¶…æ—¶")),1e3))]),s=t.findIndex(t=>t.url===e.url)}catch(r){s=Date.now()%1e3}const a={id:Date.now(),groupId:l,senderId:"user",senderType:"user",senderName:(null==p?void 0:p.name)||"æˆ‘",senderAvatar:(null==p?void 0:p.avatar)||"ðŸ‘¤",content:e.description,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"emoji",emojiIndex:s};N(e=>[...e,a]),ne("[è¡¨æƒ…]"),K(!1)}})]})]})}):e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx("p",{className:"text-gray-400",children:"ç¾¤èŠä¸å­˜åœ¨"})})}},Symbol.toStringTag,{value:"Module"})),Yr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{id:l}=r(),{getGroup:d,updateGroup:x,deleteGroup:m,removeMember:h,setAdmin:u,setTitle:g,canManage:p}=i(),{showStatusBar:f}=o(),{getCharacter:b}=n(),{background:j,getBackgroundStyle:v}=c(),y=t.useRef(null),N=d(l||""),[w,k]=t.useState((null==N?void 0:N.name)||""),[C,_]=t.useState((null==N?void 0:N.description)||""),[M,z]=t.useState(!1),[L,$]=t.useState(null),[A,T]=t.useState(""),[D,E]=t.useState(!1),[B,P]=t.useState(()=>{if(!l)return!1;return"true"===localStorage.getItem(`group_ai_chat_enabled_${l}`)}),[F,O]=t.useState(()=>{if(!l)return 30;const e=localStorage.getItem(`group_ai_chat_interval_${l}`);return e?parseInt(e):30});if(!N)return e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx("p",{className:"text-gray-400",children:"ç¾¤èŠä¸å­˜åœ¨"})});return e.jsxs("div",{className:"h-full flex flex-col bg-gray-50",children:[f&&e.jsx(ua,{}),e.jsxs("div",{className:"h-full flex flex-col relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 z-0",style:v()}),e.jsxs("div",{className:"relative z-10 h-full flex flex-col",children:[e.jsx("div",{className:"px-5 py-4 flex items-center justify-between border-b border-white/20 sticky top-0 z-50 shadow-sm "+(j?"glass-dark":"glass-effect"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>a(-1),className:"ios-button",children:e.jsx(os,{size:24})}),e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"ç¾¤è®¾ç½®"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar p-3",children:[N.disbanded&&e.jsx("div",{className:"glass-card rounded-xl p-3 mb-3 border-l-4 border-red-500",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-red-600 text-lg",children:"âš ï¸"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-1",children:"ç¾¤èŠå·²è§£æ•£"}),e.jsx("p",{className:"text-sm text-gray-700",children:"æ­¤ç¾¤èŠå·²è§£æ•£ï¼Œæ— æ³•ä¿®æ”¹è®¾ç½®ã€‚"})]})]})}),e.jsxs("div",{className:"glass-card rounded-xl p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-base",children:"ðŸ‘¥"}),e.jsx("h3",{className:"text-sm font-medium text-gray-800",children:"ç¾¤å¤´åƒ"})]}),e.jsxs("div",{className:"flex items-center gap-3 p-2.5 bg-white rounded-lg",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-gray-100 flex items-center justify-center shadow-md overflow-hidden flex-shrink-0",children:(null==N?void 0:N.avatar)&&N.avatar.startsWith("data:image")?e.jsx("img",{src:N.avatar,alt:"ç¾¤å¤´åƒ",className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-2xl",children:(null==N?void 0:N.avatar)||"ðŸ‘¥"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1.5",children:"ç‚¹å‡»ä¸Šä¼ ç¾¤èŠå¤´åƒ"}),e.jsx("input",{ref:y,type:"file",accept:"image/*",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(!s)return;if(!s.type.startsWith("image/"))return void alert("è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶");if(s.size>5242880)return void alert("å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡5MB");E(!0);const a=new FileReader;a.onloadend=()=>{const e=a.result;N&&(x(N.id,{avatar:e}),alert("ç¾¤å¤´åƒæ›´æ–°æˆåŠŸï¼")),E(!1)},a.onerror=()=>{alert("å›¾ç‰‡è¯»å–å¤±è´¥"),E(!1)},a.readAsDataURL(s)},className:"hidden"}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{onClick:()=>{var e;return null==(e=y.current)?void 0:e.click()},disabled:D||(null==N?void 0:N.disbanded),className:"px-3 py-1.5 bg-blue-500 text-white rounded-lg text-xs ios-button disabled:bg-gray-300",children:D?"ä¸Šä¼ ä¸­...":"ä¸Šä¼ å¤´åƒ"})})]})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-2 px-2",children:"ðŸ’¡ æ”¯æŒ JPGã€PNGã€GIF æ ¼å¼ï¼Œæœ€å¤§ 5MB"})]}),e.jsxs("div",{className:"glass-card rounded-xl p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-base",children:"ðŸ“"}),e.jsx("h3",{className:"text-sm font-medium text-gray-800",children:"ç¾¤åç§°"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:w,onChange:e=>k(e.target.value),placeholder:"è¯·è¾“å…¥ç¾¤åç§°",maxLength:20,disabled:N.disbanded,className:"flex-1 px-3 py-2 text-sm border border-gray-200 rounded-lg focus:outline-none focus:ring-1 focus:ring-wechat-primary bg-white disabled:bg-gray-100 disabled:text-gray-500"}),e.jsx("button",{onClick:()=>{w.trim()?(x(N.id,{name:w.trim()}),alert("ç¾¤åç§°å·²æ›´æ–°")):alert("ç¾¤åç§°ä¸èƒ½ä¸ºç©º")},disabled:N.disbanded,className:"px-3 py-2 bg-wechat-primary text-white rounded-lg text-xs ios-button whitespace-nowrap disabled:bg-gray-300 disabled:text-gray-500",children:"ä¿å­˜"})]}),e.jsxs("span",{className:"text-xs text-gray-400 mt-1 block",children:[w.length,"/20"]})]}),e.jsxs("div",{className:"glass-card rounded-xl p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-base",children:"ðŸ“¢"}),e.jsx("h3",{className:"text-sm font-medium text-gray-800",children:"ç¾¤å…¬å‘Š"})]}),e.jsx("textarea",{value:C,onChange:e=>_(e.target.value),placeholder:"è¯·è¾“å…¥ç¾¤å…¬å‘Š",maxLength:200,rows:3,disabled:N.disbanded,className:"w-full px-3 py-2 text-sm border border-gray-200 rounded-lg focus:outline-none focus:ring-1 focus:ring-wechat-primary bg-white resize-none mb-2"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs text-gray-400",children:[C.length,"/200"]}),e.jsx("button",{onClick:()=>{x(N.id,{description:C}),alert("ç¾¤å…¬å‘Šå·²æ›´æ–°")},disabled:N.disbanded,className:"px-3 py-2 bg-wechat-primary text-white rounded-lg text-xs ios-button disabled:bg-gray-300 disabled:text-gray-500",children:"ä¿å­˜"})]})]}),e.jsxs("div",{className:"glass-card rounded-xl p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-base",children:"ðŸ¤–"}),e.jsx("h3",{className:"text-sm font-medium text-gray-800",children:"AIè‡ªç”±å¯¹è¯"})]}),e.jsxs("div",{className:"flex items-center justify-between p-2.5 bg-white rounded-lg mb-2",children:[e.jsxs("div",{className:"flex-1 pr-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"å¯ç”¨è‡ªç”±å¯¹è¯"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"AIä¼šè‡ªåŠ¨èŠå¤©äº’åŠ¨"})]}),e.jsx("button",{onClick:()=>P(!B),className:"relative w-11 h-6 rounded-full transition-colors flex-shrink-0 "+(B?"bg-green-500":"bg-gray-300"),children:e.jsx("span",{className:"absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full shadow-sm transition-transform "+(B?"translate-x-5":"translate-x-0")})})]}),B&&e.jsxs("div",{className:"p-2.5 bg-white rounded-lg mb-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[e.jsx("label",{className:"text-xs font-medium text-gray-700",children:"å¯¹è¯é—´éš”"}),e.jsxs("span",{className:"text-xs font-medium text-green-600",children:[F,"ç§’"]})]}),e.jsx("input",{type:"range",min:"10",max:"120",step:"10",value:F,onChange:e=>O(parseInt(e.target.value)),className:"w-full h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-green-500"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-400 mt-1",children:[e.jsx("span",{children:"æ´»è·ƒ"}),e.jsx("span",{children:"æ­£å¸¸"}),e.jsx("span",{children:"å®‰é™"})]})]}),e.jsx("button",{onClick:()=>{l&&(localStorage.setItem(`group_ai_chat_enabled_${l}`,String(B)),localStorage.setItem(`group_ai_chat_interval_${l}`,String(F)),alert(B?"AIè‡ªç”±å¯¹è¯å·²å¯ç”¨":"AIè‡ªç”±å¯¹è¯å·²å…³é—­"))},className:"w-full py-2 bg-green-500 text-white rounded-lg text-xs font-medium ios-button",children:"ä¿å­˜è®¾ç½®"}),B&&e.jsx("div",{className:"mt-2 p-2 bg-blue-50 rounded-lg",children:e.jsx("p",{className:"text-xs text-blue-600 leading-relaxed",children:"ðŸ’¡ AIä¼šå®šæ—¶åœ¨ç¾¤é‡Œå‘èµ·è¯é¢˜å’Œäº’åŠ¨"})})]}),e.jsxs("div",{className:"glass-card rounded-xl p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-base",children:"ðŸ‘¥"}),e.jsxs("h3",{className:"text-sm font-medium text-gray-800",children:["ç¾¤æˆå‘˜ ",e.jsxs("span",{className:"text-gray-400",children:["(",N.members.length,")"]})]})]}),e.jsx("div",{className:"space-y-1.5",children:N.members.map(t=>{const s=t.id===N.owner,a="user"===t.type,r="character"===t.type?b(t.id):null,l=t.avatar&&t.avatar.startsWith("data:image");return e.jsxs("div",{className:"flex items-center justify-between gap-2 p-2 bg-white rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center overflow-hidden flex-shrink-0",children:l?e.jsx("img",{src:t.avatar,alt:t.name,className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-xl",children:t.avatar||"ðŸ¤–"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5 flex-wrap",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900 truncate",children:t.name}),s&&e.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-yellow-100 text-yellow-700 rounded whitespace-nowrap",children:"ðŸ‘‘ ç¾¤ä¸»"}),!s&&"admin"===t.role&&e.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-purple-100 text-purple-700 rounded whitespace-nowrap",children:"ðŸ›¡ï¸ ç®¡ç†å‘˜"}),t.title&&e.jsxs("span",{className:"text-xs px-1.5 py-0.5 bg-pink-100 text-pink-700 rounded whitespace-nowrap",children:["âœ¨ ",t.title]}),a&&e.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-blue-100 text-blue-700 rounded whitespace-nowrap",children:"æˆ‘"})]}),(null==r?void 0:r.signature)&&e.jsx("p",{className:"text-xs text-gray-400 truncate",children:r.signature})]})]}),!a&&p(N.id,"user",t.id)&&!N.disbanded&&e.jsx("button",{onClick:()=>{$({id:t.id,name:t.name}),T(t.title||"")},className:"px-2.5 py-1 text-xs text-blue-600 hover:bg-blue-50 rounded ios-button flex-shrink-0",children:"ç®¡ç†"})]},t.id)})})]}),!N.disbanded&&e.jsx("div",{className:"glass-card rounded-xl p-2.5 mb-3",children:e.jsx("button",{onClick:()=>z(!0),className:"w-full py-2 text-sm text-red-600 font-medium rounded-lg hover:bg-red-50 ios-button",children:"ðŸ—‘ï¸ è§£æ•£ç¾¤èŠ"})})]})]})]}),M&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:()=>z(!1)}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"glass-card rounded-2xl p-6 max-w-sm w-full",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"è§£æ•£ç¾¤èŠ"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"è§£æ•£åŽï¼Œç¾¤èŠå°†è¢«æ ‡è®°ä¸ºå·²è§£æ•£çŠ¶æ€ï¼Œæ— æ³•å‘é€æ–°æ¶ˆæ¯ï¼Œä½†å¯ä»¥æŸ¥çœ‹åŽ†å²è®°å½•ã€‚æ‰€æœ‰AIæˆå‘˜å°†æ”¶åˆ°è§£æ•£é€šçŸ¥ã€‚"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>z(!1),className:"flex-1 py-3 border border-gray-300 rounded-xl text-gray-700 ios-button",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:()=>{if(z(!1),!N)return;const e=localStorage.getItem(`group_messages_${N.id}`),t=e?JSON.parse(e):[],s=Date.now(),r={id:s+Math.random(),groupId:N.id,senderId:"system",senderType:"user",senderName:"ç³»ç»Ÿ",senderAvatar:"",content:"ç¾¤èŠå·²è¢«ç¾¤ä¸»è§£æ•£",time:new Date(s).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:s,messageType:"system"};t.push(r),localStorage.setItem(`group_messages_${N.id}`,JSON.stringify(t)),N.members.forEach(e=>{if("character"===e.type){const t=localStorage.getItem(`messages_${e.id}`),s=t?JSON.parse(t):[],a={id:Date.now()+Math.random(),role:"system",content:`[ç³»ç»Ÿé€šçŸ¥] ç¾¤èŠ"${N.name}"å·²è¢«ç¾¤ä¸»è§£æ•£`,timestamp:Date.now()};s.push(a),localStorage.setItem(`messages_${e.id}`,JSON.stringify(s))}}),m(N.id),a("/",{replace:!0})},className:"flex-1 py-3 bg-red-600 text-white rounded-xl ios-button",children:"ç¡®è®¤è§£æ•£"})]})]})})]}),L&&N&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:()=>$(null)}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"glass-card rounded-2xl p-5 max-w-sm w-full",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["ç®¡ç† ",L.name]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 block mb-2",children:"âœ¨ è®¾ç½®å¤´è¡”"}),e.jsx("input",{type:"text",value:A,onChange:e=>T(e.target.value),placeholder:"è¾“å…¥å¤´è¡”ï¼ˆç•™ç©ºåˆ™åˆ é™¤ï¼‰",maxLength:10,className:"w-full px-3 py-2 text-sm border border-gray-200 rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-500"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[A.length,"/10"]})]}),(()=>{var t;const s=N.members.find(e=>e.id===L.id),a="admin"===(null==s?void 0:s.role),r="owner"===(null==s?void 0:s.role),n="owner"===(null==(t=N.members.find(e=>"user"===e.type))?void 0:t.role);return!r&&n&&e.jsx("div",{className:"mb-4 p-3 bg-purple-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"ðŸ›¡ï¸ è®¾ä¸ºç®¡ç†å‘˜"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"ç®¡ç†å‘˜å¯ä»¥ç®¡ç†æ™®é€šæˆå‘˜"})]}),e.jsx("button",{onClick:()=>{var e;if(l&&L&&N){u(l,L.id,!a);const t=localStorage.getItem(`group_messages_${l}`),s=t?JSON.parse(t):[],r=a?`ç¾¤ä¸»å–æ¶ˆäº† ${L.name} çš„ç®¡ç†å‘˜èº«ä»½`:`ç¾¤ä¸»è®¾ç½® ${L.name} ä¸ºç®¡ç†å‘˜ ðŸ›¡ï¸`,n=Date.now(),i={id:n+Math.random(),groupId:l,senderId:"system",senderType:"user",senderName:"ç³»ç»Ÿ",senderAvatar:"",content:r,time:new Date(n).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:n,messageType:"system"};if(s.push(i),localStorage.setItem(`group_messages_${l}`,JSON.stringify(s)),"character"===(null==(e=N.members.find(e=>e.id===L.id))?void 0:e.type)){const e=`chat_messages_${L.id}`,t=localStorage.getItem(e),s=t?JSON.parse(t):[],a={id:Date.now()+Math.random(),role:"system",content:`[${r}] - è¿™æ˜¯ç¾¤èŠâ€œ${N.name}â€ä¸­å‘ç”Ÿçš„å˜åŒ–ã€‚`,timestamp:Date.now(),isHidden:!1};s.push(a),I(S.CHAT_MESSAGES,{key:e,characterId:L.id,messages:s}).catch(()=>{localStorage.setItem(e,JSON.stringify(s))})}}},className:"relative w-11 h-6 rounded-full transition-colors "+(a?"bg-purple-500":"bg-gray-300"),children:e.jsx("span",{className:"absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full shadow-sm transition-transform "+(a?"translate-x-5":"translate-x-0")})})]})})})(),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>$(null),className:"flex-1 py-2.5 border border-gray-300 rounded-lg text-gray-700 text-sm ios-button",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:()=>{if(l&&L&&N){const e=N.members.find(e=>e.id===L.id),t=(null==e?void 0:e.title)||"";g(l,L.id,A);const s=localStorage.getItem(`group_messages_${l}`),a=s?JSON.parse(s):[];let r="";if(A&&!t?r=`ç¾¤ä¸»ç»™ ${L.name} è®¾ç½®äº†å¤´è¡”ï¼šâœ¨${A}`:A&&t?r=`ç¾¤ä¸»ä¿®æ”¹äº† ${L.name} çš„å¤´è¡”ï¼šâœ¨${A}`:!A&&t&&(r=`ç¾¤ä¸»å–æ¶ˆäº† ${L.name} çš„å¤´è¡”`),r){const t=Date.now(),s={id:t+Math.random(),groupId:l,senderId:"system",senderType:"user",senderName:"ç³»ç»Ÿ",senderAvatar:"",content:r,time:new Date(t).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:t,messageType:"system"};if(a.push(s),localStorage.setItem(`group_messages_${l}`,JSON.stringify(a)),"character"===(null==e?void 0:e.type)){const e=`chat_messages_${L.id}`,t=localStorage.getItem(e),s=t?JSON.parse(t):[],a={id:Date.now()+Math.random(),role:"system",content:`[${r}] - è¿™æ˜¯ç¾¤èŠâ€œ${N.name}â€ä¸­å‘ç”Ÿçš„å˜åŒ–ã€‚`,timestamp:Date.now(),isHidden:!1};s.push(a),I(S.CHAT_MESSAGES,{key:e,characterId:L.id,messages:s}).catch(()=>{localStorage.setItem(e,JSON.stringify(s))})}}alert("è®¾ç½®æˆåŠŸ"),$(null)}},className:"flex-1 py-2.5 bg-blue-600 text-white rounded-lg text-sm ios-button",children:"ä¿å­˜"}),e.jsx("button",{onClick:()=>{if(l&&L&&N&&confirm(`ç¡®å®šè¦ç§»é™¤ ${L.name} å—ï¼Ÿ`)){const e=N.members.find(e=>e.id===L.id);h(l,L.id);const t=localStorage.getItem(`group_messages_${l}`),s=t?JSON.parse(t):[],a=Date.now(),r={id:a+Math.random(),groupId:l,senderId:"system",senderType:"user",senderName:"ç³»ç»Ÿ",senderAvatar:"",content:`${L.name} è¢«ç§»å‡ºäº†ç¾¤èŠ`,time:new Date(a).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:a,messageType:"system"};if(s.push(r),localStorage.setItem(`group_messages_${l}`,JSON.stringify(s)),"character"===(null==e?void 0:e.type)){const e=localStorage.getItem(`messages_${L.id}`),t=e?JSON.parse(e):[],s={id:Date.now()+1,role:"system",content:`[ç³»ç»Ÿé€šçŸ¥] ä½ è¢«ç§»å‡ºäº†ç¾¤èŠ"${N.name}"`,timestamp:Date.now()};t.push(s),localStorage.setItem(`messages_${L.id}`,JSON.stringify(t))}$(null)}},className:"px-4 py-2.5 bg-red-600 text-white rounded-lg text-sm ios-button",children:"ç§»é™¤"})]})]})})]})]})}},Symbol.toStringTag,{value:"Module"})),el=["ðŸ˜Š","ðŸ¥°","ðŸ˜˜","ðŸ˜","ðŸ¤—","ðŸ˜‡","ðŸ¥³","ðŸ˜Ž","ðŸ¤”","ðŸ˜","ðŸ˜Œ","ðŸ˜´","ðŸ¤­","ðŸ¤«","ðŸ¤¨","ðŸ˜³","ðŸŒ¸","ðŸŒº","ðŸŒ»","ðŸŒ¼","ðŸŒ·","ðŸŒ¹","ðŸ’","ðŸŒ™","â­","âœ¨","ðŸ’«","ðŸŒŸ","â˜€ï¸","ðŸŒˆ","ðŸ¦„","ðŸ±","ðŸ¶","ðŸ°","ðŸ»","ðŸ¦Š","ðŸ¼","ðŸ¨","ðŸ¯","ðŸ¦"],tl=async(e,t=[],s="")=>{try{const r=((e,t=[],s="")=>{const a=Math.random().toString(36).substring(7);let r="";t.length>0&&(r=`\nã€ç”¨æˆ·åå¥½ã€‘è§’è‰²è¦ç¬¦åˆä»¥ä¸‹ç‰¹ç‚¹ï¼š${t.join("ã€")}`);let l="";return s.trim()&&(l=`\nã€ç”¨æˆ·æè¿°ã€‘${s.trim()}`),`ç”Ÿæˆ${e}ä¸ªçŽ°ä»£éƒ½å¸‚è§’è‰²ï¼Œç”¨äºŽçº¿ä¸ŠèŠå¤©APPã€‚(ç§å­: ${a})${r}${l}\n\nã€æ ¸å¿ƒè¦æ±‚ã€‘\nå†™å‡ºçœŸå®žçš„çŽ°ä»£å¹´è½»äººï¼Œä¸è¦å†™æˆç”µè§†å‰§äººç‰©ã€å°è¯´è§’è‰²æˆ–æ¸¸æˆNPCã€‚è¦æœ‰çƒŸç«æ°”ã€ç”Ÿæ´»æ„Ÿã€ç²¾è‡´æ„Ÿã€‚\n\nã€åœºæ™¯ã€‘\nåˆšæ‰æ·±å¤œ/ä¸‹ç­/å‘¨æœ«æ— èŠï¼Œéšæ‰‹æ‰“å¼€æ‘‡ä¸€æ‘‡ï¼ŒåŒ¹é…åˆ°äº†é™Œç”Ÿäººã€‚å¯èƒ½åœ¨åºŠä¸Šåˆ·æ‰‹æœºã€åœ¨åœ°é“ä¸Šã€åœ¨å’–å•¡åŽ…ã€åœ¨å…¬å¸åŠ ç­ã€‚\n\nã€è§’è‰²è®¾å®šåŽŸåˆ™ã€‘\n1. åå­—è¦ç²¾è‡´çŽ°ä»£ï¼Œè‡ªå·±åˆ›é€ ï¼Œä¸è¦ç”¨çƒ‚å¤§è¡—çš„ï¼š\n   âœ— ç¦æ­¢ä½¿ç”¨ï¼šè‹xxã€xxæ™šã€xxä¼Šã€xxå¿µã€xxè±ã€xxç‘¶ã€xxæ¶µã€xxè½©ã€xxå®‡ã€xxæ³½ï¼ˆå¤ªè€åœŸçƒ‚å¤§è¡—ï¼‰\n   âœ— ç¦æ­¢ä½¿ç”¨ï¼šå†·è‰³ã€éœ¸æ°”ã€å€¾åŸŽã€ç´«è±ã€æ¢¦ç‘¶ã€é›¨è±ã€è¯—æ¶µï¼ˆå¤ªä¸­äºŒ/å¤ªç”µè§†å‰§ï¼‰\n   âœ— ç¦æ­¢ä½¿ç”¨ï¼šå­æ¶µã€æ¢“æ¶µã€æ¢“è½©ã€æµ©å®‡ã€æµ©ç„¶ã€é›¨è±ã€æ¬£æ€¡ï¼ˆå¤ªçƒ‚å¤§è¡—ï¼‰\n   âœ“ è¦æ±‚ï¼šåå­—è¦æœ‰è¾¨è¯†åº¦ï¼Œç®€æ´æœ‰è´¨æ„Ÿï¼Œä¸è½ä¿—å¥—ï¼Œè®©äººä¸€å¬å°±è®°ä½\n\n2. èŒä¸šè¦çœŸå®žæŽ¥åœ°æ°”ï¼š\n   âœ— ç¦æ­¢ï¼šéœ¸é“æ€»è£ã€è±ªé—¨åƒé‡‘ã€è´¢å›¢ç»§æ‰¿äººã€å¤©æ‰åŒ»ç”Ÿã€é¡¶çº§å¾‹å¸ˆï¼ˆå¤ªç”µè§†å‰§ï¼‰\n   è¦æ±‚ï¼šå†™æ™®é€šäººçš„èŒä¸šï¼Œè¦å…·ä½“ï¼Œä¸è¦ç©ºæ³›\n\n3. æ€§æ ¼è¦ç²¾è‡´ç«‹ä½“ï¼š\n   âœ— ç¦æ­¢å†™æˆï¼šæ¸©æŸ”å–„è‰¯ã€é«˜å†·éœ¸æ°”ã€æ´»æ³¼å¯çˆ±ï¼ˆå¤ªæ‰å¹³ï¼‰\n   è¦æ±‚ï¼šå¿…é¡»æœ‰çŸ›ç›¾æ„Ÿå’Œåå·®ï¼Œè¦æœ‰å°ç¼ºç‚¹ï¼Œè¦æœ‰çœŸå®žæƒ…ç»ª\n\n4. ç”Ÿæ´»è¦å…·ä½“æœ‰è´¨æ„Ÿï¼š\n   âœ— ç¦æ­¢è¯´ï¼šå–œæ¬¢éŸ³ä¹ã€å–œæ¬¢çœ‹ä¹¦ã€å–œæ¬¢æ—…è¡Œï¼ˆå¤ªç¬¼ç»Ÿï¼‰\n   è¦æ±‚ï¼šå¿…é¡»å…·ä½“åˆ°æ­Œåã€ä¹¦åã€å“ç‰Œã€åœ°ç‚¹ï¼Œè¦æœ‰ç”»é¢æ„Ÿ\n\n5. çŠ¶æ€è¦çœŸå®žï¼š\n   è¦æ±‚ï¼šå†™å‡ºæ­¤æ—¶æ­¤åˆ»åœ¨å¹²ä»€ä¹ˆï¼Œè¦æœ‰å…·ä½“åœºæ™¯å’Œæƒ…ç»ª\n\nã€æ–‡é£Žè¦æ±‚ - ç²¾è‡´ç»†è…»ã€‘\n- âœ— ç¦æ­¢ç”¨ï¼šç¾Žä¸½åŠ¨äººã€å€¾å›½å€¾åŸŽã€æ°”è´¨å‡ºä¼—ã€ä¼˜é›…é«˜è´µã€æ¸©æŸ”å–„è‰¯ã€æ´»æ³¼å¯çˆ±ï¼ˆå¤ªç©ºæ´žå¤ªç”µè§†å‰§ï¼‰\n- è¦æ±‚ï¼šç”¨å…·ä½“ç»†èŠ‚æå†™ï¼Œè¦æœ‰ç”»é¢æ„Ÿï¼Œæè¿°è¦åƒåœ¨å†™ä¸€ä¸ªä½ èº«è¾¹çœŸå®žå­˜åœ¨çš„æœ‹å‹\n\nã€ä¸ªæ€§ç­¾åã€‘\nâœ— ç¦æ­¢ï¼šæ„¿ä½ ä¸‰å†¬æš–æ„¿ä½ æ˜¥ä¸å¯’ã€åšæœ€å¥½çš„è‡ªå·±ã€å²æœˆé™å¥½ã€ä¸å¿˜åˆå¿ƒï¼ˆå¤ªæ–‡è‰ºè…”å¤ªé¸¡æ±¤ï¼‰\nè¦æ±‚ï¼šåƒçœŸäººä¼šå†™çš„ï¼Œè¦æŽ¥åœ°æ°”ï¼Œå¯ä»¥ä¸§å¯ä»¥emoå¯ä»¥è‡ªå˜²\n\nã€descriptionå†…å®¹ - æžè‡´ç»†è…»çš„å†™æ³•ã€‘\n\nåŸºæœ¬ä¿¡æ¯ï¼šå§“å/æ€§åˆ«/å¹´é¾„/èŒä¸š\nâœ— ç¦æ­¢ï¼š"23å²ï¼Œåšä¸»"ï¼ˆå¤ªç¬¼ç»Ÿï¼‰\nè¦æ±‚ï¼šèŒä¸šè¦å…·ä½“ï¼Œæ¯”å¦‚ä»€ä¹ˆå¹³å°ã€ä»€ä¹ˆé¢†åŸŸã€ç²‰ä¸é‡ç­‰\n\nå¤–è²Œç‰¹å¾ï¼š\nâœ— ç¦æ­¢ï¼š"é•¿å¾—æŒºå¥½çœ‹çš„ï¼Œäº”å®˜ç²¾è‡´"ï¼ˆå¤ªç©ºæ´žï¼‰\nè¦æ±‚ï¼šå†™å…·ä½“ç‰¹å¾ï¼Œçœ¼åž‹ã€é¼»å­ã€å˜´å”‡ã€ç—£ã€è€³æ´žã€æ‰‹æŒ‡ç­‰ï¼Œè¦è®©äººèƒ½æƒ³è±¡å‡ºç”»é¢\n\nèº«æä½“æ€ï¼š\nè¦æ±‚ï¼šå†™èº«é«˜ä½“é‡ã€è‚©è†€ã€é”éª¨ã€è…°ã€è…¿ç­‰å…·ä½“ç»†èŠ‚ï¼ŒåŒ…æ‹¬ä¸æ»¡æ„çš„åœ°æ–¹å’Œä¹ æƒ¯æ€§åŠ¨ä½œ\n\næ€§æ ¼ï¼š\nâœ— ç¦æ­¢ï¼š"æ€§æ ¼æ¸©æŸ”ï¼Œæœ‰ç‚¹å†…å‘"ï¼ˆå¤ªæ‰å¹³ï¼‰\nè¦æ±‚ï¼šå¿…é¡»æœ‰çŸ›ç›¾å’Œåå·®ï¼Œå¿…é¡»æœ‰å°ç¼ºç‚¹ï¼Œå¿…é¡»æœ‰çœŸå®žæƒ…ç»ª\n\nè¯­è¨€ä¹ æƒ¯ï¼š\nâœ— ç¦æ­¢ï¼š"è¯´è¯æ¸©æŸ”"ï¼ˆæ²¡ç‰¹è‰²ï¼‰\nè¦æ±‚ï¼šè¦æœ‰å…·ä½“çš„å£å¤´ç¦…ã€è¯­æ°”è¯ã€æ‰“å­—ä¹ æƒ¯ï¼Œè¦æœ‰ä¸ªäººç‰¹è‰²\n\næ­¤åˆ»çš„çŠ¶æ€ï¼š\nè¦æ±‚ï¼šå…·ä½“åˆ°è¿™ä¸€ç§’åœ¨å¹²ä»€ä¹ˆï¼Œè¦æœ‰åœºæ™¯æå†™ï¼ˆå…‰çº¿ã€ç‰©å“ã€å§¿åŠ¿ï¼‰ï¼Œè¦æœ‰æƒ…ç»ª\n\nå…´è¶£çˆ±å¥½ï¼š\nâœ— ç¦æ­¢ï¼š"å–œæ¬¢éŸ³ä¹ã€è´­ç‰©ã€çœ‹ä¹¦"ï¼ˆå¤ªç¬¼ç»Ÿï¼‰\nè¦æ±‚ï¼šå¿…é¡»å…·ä½“åˆ°æ­Œæ‰‹ã€æ­Œåã€ä¹¦åã€å“ç‰Œã€åœ°ç‚¹ï¼Œè¦æœ‰ç”»é¢æ„Ÿ\n\nå°ç¼ºç‚¹å’ŒçœŸå®žæ„Ÿï¼š\nè¦æ±‚ï¼šå†™å…·ä½“çš„å°ç¼ºç‚¹ï¼Œè®©è§’è‰²æ›´çœŸå®žæŽ¥åœ°æ°”\n\nå®¶åº­èƒŒæ™¯ï¼š\nè¦æ±‚ï¼šå†™çˆ¶æ¯èŒä¸šã€å®¶åº­ç»æµŽçŠ¶å†µã€å’Œå®¶äººçš„å…³ç³»\n\nèŠå¤©é£Žæ ¼ï¼š\nè¦æ±‚ï¼šå†™æ‰“å­—ä¹ æƒ¯ã€å‘è¯­éŸ³ä¹ æƒ¯ã€ç”¨emojiä¹ æƒ¯ã€å¯¹é™Œç”Ÿäººçš„æ€åº¦\n\nè®°å¿†è®¾å®šï¼š\nè¦æ±‚ï¼šå†™è§’è‰²ä»Šå¤©çš„ç»åŽ†å’Œä¸ºä»€ä¹ˆä¼šæ‰“å¼€æ‘‡ä¸€æ‘‡ã€‚æ¯”å¦‚"ä»Šå¤©åŠ ç­åˆ°ä¹ç‚¹ï¼Œå›žå®¶è·¯ä¸Šè§‰å¾—ç‰¹åˆ«ç´¯ï¼Œèººåœ¨åºŠä¸Šåˆ·æ‰‹æœºï¼Œçªç„¶æƒ³èµ·æ¥æœ‰ä¸ªæ‘‡ä¸€æ‘‡åŠŸèƒ½ï¼Œå°±è¯•äº†ä¸€ä¸‹"ã€‚è¦è‡ªç„¶ï¼Œä¸è¦åˆ»æ„\n\nâš ï¸ è¾“å‡ºæ ¼å¼ï¼ˆçº¯JSONæ•°ç»„ï¼Œä¸è¦markdownï¼‰ï¼š\n[\n  {\n    "name": "è§’è‰²åå­—",\n    "signature": "ä¸ªæ€§ç­¾å",\n    "description": "æŒ‰ç…§ä¸Šé¢çš„è¦æ±‚ï¼Œå†™å‡ºæžè‡´ç»†è…»çš„è§’è‰²æè¿°ã€‚åŒ…å«ï¼šåŸºæœ¬ä¿¡æ¯ã€å¤–è²Œç‰¹å¾ã€èº«æä½“æ€ã€æ€§æ ¼ã€è¯­è¨€ä¹ æƒ¯ã€æ­¤åˆ»çš„çŠ¶æ€ã€å…´è¶£çˆ±å¥½ã€å°ç¼ºç‚¹ã€å®¶åº­èƒŒæ™¯ã€èŠå¤©é£Žæ ¼ã€è®°å¿†è®¾å®šã€‚æ¯ä¸ªéƒ¨åˆ†éƒ½è¦å…·ä½“ã€æœ‰ç”»é¢æ„Ÿã€æœ‰ç»†èŠ‚ã€‚"\n  }\n]\n\nâš ï¸ å¿…é¡»ï¼š\n1. JSONæ•°ç»„ï¼Œ${e}ä¸ªè§’è‰²\n2. æ¯ä¸ªè§’è‰²åªæœ‰nameã€signatureã€descriptionä¸‰ä¸ªå­—æ®µ\n3. æ¯ä¸ªè§’è‰²å®Œå…¨ä¸åŒï¼Œæœ‰çœŸå®žæ„Ÿ\n4. æ–‡é£Žç»†è…»ï¼Œæœ‰ç”»é¢æ„Ÿ\n\nç”Ÿæˆï¼š`})(e,t,s),l=await q(r);let n;try{let e=l.replace(/```json/gi,"").replace(/```/g,"").replace(/^[\s\S]*?(?=\[)/m,"").replace(/\][\s\S]*$/m,"]").trim();const t=e.indexOf("["),s=e.lastIndexOf("]");if(-1===t||-1===s)throw new Error("æœªæ‰¾åˆ°JSONæ•°ç»„");let a=e.substring(t,s+1);if(a=a.replace(/[\x00-\x1F\x7F]/g,""),n=JSON.parse(a),!Array.isArray(n))throw new Error("è¿”å›žçš„ä¸æ˜¯æ•°ç»„");n=n.map((e,t)=>{if(Object.keys(e).length>3){const t=[];for(const s in e)"name"!==s&&"signature"!==s&&"description"!==s&&(t.push(`ã€${s}ã€‘${e[s]}`),delete e[s]);t.length>0&&(e.description=e.description+"\n\n"+t.join("\n\n"))}if(!e.name||!e.signature||!e.description)throw new Error(`è§’è‰²${t+1}æ•°æ®ä¸å®Œæ•´`);const s=el[Math.floor(Math.random()*el.length)];return{name:e.name,username:`${e.name}_${Math.floor(9999*Math.random())}`,avatar:s,signature:e.signature,description:e.description}})}catch(a){throw new Error("ç”Ÿæˆè§’è‰²å¤±è´¥ï¼Œè¯·é‡è¯•")}return n}catch(r){throw r}},sl=["æ¸©æŸ”ä½“è´´","æ´»æ³¼å¼€æœ—","å‚²å¨‡","ç—…å¨‡","å¤©ç„¶å‘†","æˆç†Ÿç¨³é‡","è…¹é»‘","æ¯’èˆŒ","æ–‡è‰º","çŸ¥æ€§","ä¹è§‚å‘ä¸Š","å†…å‘å®³ç¾ž","å¤–å‘å¥è°ˆ","ç¥žç§˜","å¯çˆ±è½¯èŒ","é£’çˆ½","æ¸©å©‰","å¤§å¤§å’§å’§","ç»†è…»æ•æ„Ÿ","ç†æ€§å†·é™","æ„Ÿæ€§æµªæ¼«","å¹½é»˜é£Žè¶£","å›é€†","ç©¿å­”","èèŽ‰","å°‘å¥³","å¤§å°å§","å­¦å¦¹","é’æ¢…ç«¹é©¬","é‚»å®¶å°‘å¥³","å­¦ç”Ÿ","æ•™å¸ˆ","åŒ»ç”Ÿ","å¾‹å¸ˆ","ä½œå®¶","ç”»å®¶","éŸ³ä¹äºº","æ¨¡ç‰¹","æ¼”å‘˜","ä¸»æ’­","åšä¸»","æ‘„å½±å¸ˆ","å’–å•¡å¸ˆ","çˆ±è¯»ä¹¦","çˆ±è¿åŠ¨","çˆ±éŸ³ä¹","çˆ±æ—…è¡Œ","çˆ±ç¾Žé£Ÿ","çˆ±æ¸¸æˆ","çˆ±åŠ¨æ¼«","çˆ±ç”µå½±","çˆ±æ‘„å½±","çˆ±ç”»ç”»","çˆ±å†™ä½œ","çˆ±çƒ¹é¥ª","å¤œçŒ«å­","æ—©èµ·é¸Ÿ","ç¤¾æ","ç¤¾ç‰›","åƒè´§","çŒ«å¥´","ç‹—å¥´","å®…å¥³","è¿åŠ¨è¾¾äºº","æ–‡è‰ºé’å¹´","æŠ€æœ¯å®…","é¢œæŽ§"],al=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{addCharacter:r}=n(),{showStatusBar:l}=o(),[i,c]=t.useState(!1),[d,x]=t.useState(!1),[m,h]=t.useState([]),[u,g]=t.useState(null),[p,f]=t.useState(!1),[b,j]=t.useState([]),[v,y]=t.useState(""),N=t.useRef(0);t.useEffect(()=>{let e=0,t=0,s=0;const a=a=>{if(i||d)return;const r=a.accelerationIncludingGravity;if(!r)return;const l=r.x??0,n=r.y??0,c=r.z??0;if(Math.abs(l-e)+Math.abs(n-t)+Math.abs(c-s)>15){const e=Date.now();e-N.current>1e3&&(N.current=e,w())}e=l,t=n,s=c};return"function"==typeof DeviceMotionEvent.requestPermission?DeviceMotionEvent.requestPermission().then(e=>{"granted"===e&&window.addEventListener("devicemotion",a)}).catch(console.error):window.addEventListener("devicemotion",a),()=>{window.removeEventListener("devicemotion",a)}},[i,d]);const w=async()=>{c(!0),navigator.vibrate&&navigator.vibrate([100,50,100]);try{const e=Math.floor(2*Math.random())+2,t=await tl(e,b,v);c(!1),h(t),x(!0)}catch(e){c(!1),alert("ç”Ÿæˆè§’è‰²å¤±è´¥ï¼Œè¯·æ£€æŸ¥APIé…ç½®æˆ–é‡è¯•")}},k=e=>{r(e),alert(`å·²æ·»åŠ  ${e.name} åˆ°é€šè®¯å½•ï¼`)};return e.jsxs("div",{className:"h-screen flex flex-col bg-gray-50",children:[l&&e.jsx(ua,{}),e.jsxs("div",{className:"glass-effect px-5 py-4 border-b border-gray-200/50 flex items-center",children:[e.jsx("button",{onClick:()=>a("/desktop",{replace:!0}),className:"text-gray-600 mr-3",children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M15 18l-6-6 6-6"})})}),e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"æ‘‡ä¸€æ‘‡"})]}),e.jsx("div",{className:"flex-1 flex flex-col items-center justify-center px-6",children:d?e.jsxs("div",{className:"w-full max-w-md space-y-4 animate-fade-in",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsxs("div",{className:"text-2xl font-bold text-gray-800 mb-2",children:["ðŸŽ‰ å‘çŽ°äº† ",m.length," ä¸ªAI"]}),e.jsx("div",{className:"text-gray-500",children:"ç‚¹å‡»å¡ç‰‡æŸ¥çœ‹è¯¦æƒ…"})]}),e.jsx("div",{className:"space-y-3",children:m.map((t,s)=>{var a;return e.jsxs("div",{onClick:()=>g(t),className:"glass-card rounded-2xl p-4 flex items-center space-x-4 animate-slide-up cursor-pointer hover:shadow-xl transition-all",style:{animationDelay:100*s+"ms"},children:[e.jsx("div",{className:"w-16 h-16 rounded-full glass-card flex items-center justify-center text-3xl shadow-lg flex-shrink-0 border border-gray-200/50",children:t.avatar}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-semibold text-gray-900 text-lg",children:t.name}),e.jsx("div",{className:"text-sm text-gray-500 truncate",children:t.signature}),e.jsx("div",{className:"text-xs text-gray-400 mt-1 line-clamp-2",children:null==(a=t.description.split("\n")[2])?void 0:a.replace("ã€æ€§æ ¼ã€‘","")})]}),e.jsx("button",{onClick:e=>{e.stopPropagation(),k(t)},className:"px-4 py-2 bg-green-500 text-white rounded-full text-sm font-semibold shadow-md hover:shadow-lg transition-all ios-button flex-shrink-0",children:"æ·»åŠ "})]},s)})}),e.jsx("button",{onClick:()=>{x(!1),h([]),j([]),y("")},className:"w-full py-3 glass-card text-gray-800 rounded-full font-semibold shadow-lg hover:shadow-xl transition-all ios-button mt-6",children:"å†æ‘‡ä¸€æ¬¡"})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-8 transition-transform duration-500 "+(i?"animate-shake scale-110":""),children:e.jsx("img",{src:"/shake-icon.webp",alt:"æ‘‡ä¸€æ‘‡",className:"w-48 h-48 object-contain"})}),i?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-800 animate-pulse",children:"æ­£åœ¨å¯»æ‰¾..."}),e.jsxs("div",{className:"flex justify-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-3 h-3 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-3 h-3 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-800",children:"æ‘‡ä¸€æ‘‡æ‰‹æœº"}),e.jsx("div",{className:"text-gray-500",children:"éšæœºé‡è§æœ‰è¶£çš„AIè§’è‰²"}),e.jsx("button",{onClick:()=>{i||d||f(!0)},className:"px-8 py-3 glass-card text-gray-800 rounded-full font-semibold shadow-lg hover:shadow-xl transition-all ios-button",children:"ç‚¹å‡»æ‘‡ä¸€æ‘‡"})]})]})}),!d&&!i&&e.jsxs("div",{className:"pb-8 text-center text-sm text-gray-400",children:[e.jsx("div",{children:"æ‘‡åŠ¨æ‰‹æœºæˆ–ç‚¹å‡»æŒ‰é’®"}),e.jsx("div",{children:"å‘çŽ°éšæœºAIè§’è‰²"})]}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:()=>f(!1),children:e.jsxs("div",{className:"glass-card rounded-3xl max-w-md w-full max-h-[80vh] overflow-y-auto p-6",onClick:e=>e.stopPropagation(),children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"é€‰æ‹©è§’è‰²åå¥½"}),e.jsx("p",{className:"text-sm text-gray-500 mb-6",children:"é€‰æ‹©ä½ å–œæ¬¢çš„è§’è‰²ç‰¹ç‚¹ï¼Œæˆ–è€…è‡ªå·±æè¿°"}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-700",children:"é¢„è®¾æ ‡ç­¾"}),b.length>0&&e.jsxs("button",{onClick:()=>j([]),className:"text-xs text-red-500 hover:text-red-600 font-medium",children:["æ¸…é™¤å…¨éƒ¨ (",b.length,")"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:sl.map(t=>e.jsx("button",{onClick:()=>(e=>{j(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])})(t),className:"px-4 py-2 rounded-full text-sm font-medium transition-all "+(b.includes(t)?"bg-blue-500 text-white shadow-md":"glass-card text-gray-700 hover:shadow-md"),children:t},t))})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-700 mb-3",children:"è‡ªå®šä¹‰æè¿°ï¼ˆå¯é€‰ï¼‰"}),e.jsx("textarea",{value:v,onChange:e=>y(e.target.value),placeholder:"æè¿°ä½ æƒ³è¦çš„è§’è‰²ç‰¹ç‚¹ï¼Œä¾‹å¦‚ï¼šå–œæ¬¢çœ‹ä¹¦çš„æ–‡è‰ºå¥³ç”Ÿï¼Œæ€§æ ¼æ¸©æŸ”ä½†æœ‰ç‚¹å°å‚²å¨‡...",className:"w-full px-4 py-3 glass-card rounded-2xl text-gray-900 placeholder-gray-400 resize-none focus:outline-none focus:ring-2 focus:ring-blue-500",rows:4})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>{f(!1),w()},className:"flex-1 py-3 bg-blue-500 text-white rounded-full font-semibold shadow-lg hover:shadow-xl transition-all ios-button",children:"å¼€å§‹æ‘‡ä¸€æ‘‡"}),e.jsx("button",{onClick:()=>f(!1),className:"px-6 py-3 glass-card text-gray-800 rounded-full font-semibold shadow-lg hover:shadow-xl transition-all ios-button",children:"å–æ¶ˆ"})]})]})}),u&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:()=>g(null),children:e.jsxs("div",{className:"glass-card rounded-3xl max-w-md w-full max-h-[80vh] overflow-y-auto p-6",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-6",children:[e.jsx("div",{className:"w-20 h-20 rounded-full glass-card flex items-center justify-center text-5xl shadow-lg border border-gray-200/50",children:u.avatar}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:u.name}),e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:u.signature})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"text-sm text-gray-700 whitespace-pre-wrap leading-relaxed",children:u.description})}),e.jsxs("div",{className:"flex space-x-3 mt-6",children:[e.jsx("button",{onClick:()=>{k(u),g(null)},className:"flex-1 py-3 bg-green-500 text-white rounded-full font-semibold shadow-lg hover:shadow-xl transition-all ios-button",children:"æ·»åŠ åˆ°é€šè®¯å½•"}),e.jsx("button",{onClick:()=>g(null),className:"px-6 py-3 glass-card text-gray-800 rounded-full font-semibold shadow-lg hover:shadow-xl transition-all ios-button",children:"å…³é—­"})]})]})}),e.jsx("style",{children:"\n        @keyframes shake {\n          0%, 100% { transform: translateX(0) rotate(0deg); }\n          10%, 30%, 50%, 70%, 90% { transform: translateX(-10px) rotate(-5deg); }\n          20%, 40%, 60%, 80% { transform: translateX(10px) rotate(5deg); }\n        }\n        \n        @keyframes fade-in {\n          from { opacity: 0; }\n          to { opacity: 1; }\n        }\n        \n        @keyframes slide-up {\n          from {\n            opacity: 0;\n            transform: translateY(20px);\n          }\n          to {\n            opacity: 1;\n            transform: translateY(0);\n          }\n        }\n        \n        .animate-shake {\n          animation: shake 0.5s ease-in-out infinite;\n        }\n        \n        .animate-fade-in {\n          animation: fade-in 0.5s ease-out;\n        }\n        \n        .animate-slide-up {\n          animation: slide-up 0.5s ease-out forwards;\n          opacity: 0;\n        }\n      "})]})}},Symbol.toStringTag,{value:"Module"})),rl=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),[l,n]=t.useState("recommend"),[i,c]=t.useState(null),[d,x]=t.useState(""),[m,h]=t.useState(!1),[u,g]=t.useState(!1),[p,f]=t.useState(6),b=t.useRef(null);return e.jsxs("div",{className:"h-screen flex flex-col bg-white",children:[r&&e.jsx(ua,{}),e.jsxs("div",{className:"glass-effect px-4 py-3 border-b border-gray-200/50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a(-1),className:"ios-button text-gray-700 hover:text-gray-900 -ml-2 transition-colors",children:e.jsx(os,{size:24})}),e.jsx("h1",{className:"text-base font-semibold text-gray-900",children:"ç›´æ’­"}),e.jsx("button",{onClick:()=>h(!m),className:"ios-button text-gray-700 hover:text-gray-900",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("path",{d:"m21 21-4.35-4.35"})]})})]}),m&&e.jsx("div",{className:"mt-3",children:e.jsx("input",{type:"text",value:d,onChange:e=>x(e.target.value),placeholder:"æœç´¢ç›´æ’­é—´æˆ–ä¸»æ’­",className:"w-full px-4 py-2 bg-gray-100 rounded-full text-sm outline-none focus:bg-gray-200 transition-colors",autoFocus:!0})})]}),e.jsxs("div",{className:"flex border-b border-gray-200",children:[e.jsxs("button",{onClick:()=>n("recommend"),className:"flex-1 py-3 text-sm font-medium transition-colors relative "+("recommend"===l?"text-gray-900":"text-gray-500"),children:["æŽ¨è","recommend"===l&&e.jsx("div",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 w-12 h-0.5 bg-gray-900 rounded-full"})]}),e.jsxs("button",{onClick:()=>n("following"),className:"flex-1 py-3 text-sm font-medium transition-colors relative "+("following"===l?"text-gray-900":"text-gray-500"),children:["å…³æ³¨","following"===l&&e.jsx("div",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 w-12 h-0.5 bg-gray-900 rounded-full"})]})]}),e.jsx("div",{ref:b,className:"flex-1 overflow-y-auto hide-scrollbar",children:"recommend"===l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-4 pb-2",children:e.jsx("div",{className:"flex gap-2 overflow-x-auto hide-scrollbar",children:["å…¨éƒ¨","æ¸¸æˆ","å¨±ä¹","ç¾Žé£Ÿ","éŸ³ä¹","è¿åŠ¨","å­¦ä¹ ","èŠå¤©"].map(t=>e.jsx("button",{onClick:()=>c("å…¨éƒ¨"===t?null:t),className:"px-4 py-1.5 rounded-full text-sm font-medium whitespace-nowrap transition-colors "+("å…¨éƒ¨"===t&&!i||i===t?"bg-gray-900 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:t},t))})}),u&&e.jsx("div",{className:"flex justify-center py-3",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-gray-600 rounded-full animate-spin"}),"åˆ·æ–°ä¸­..."]})}),e.jsxs("div",{className:"p-4 pt-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"æ­£åœ¨ç›´æ’­"}),e.jsxs("button",{onClick:()=>{g(!0),setTimeout(()=>{g(!1),f(6)},1e3)},className:"text-xs text-gray-500 hover:text-gray-700 flex items-center gap-1",children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("polyline",{points:"23 4 23 10 17 10"}),e.jsx("path",{d:"M20.49 15a9 9 0 1 1-2.12-9.36L23 10"})]}),"åˆ·æ–°"]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:Array.from({length:p},(e,t)=>t+1).map(t=>e.jsxs("div",{className:"bg-white rounded-xl overflow-hidden cursor-pointer ios-button border border-gray-200 hover:border-gray-300 transition-all",onClick:()=>a(`/live/${t}`),children:[e.jsxs("div",{className:"relative aspect-[4/3] bg-gray-100",children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400 text-sm",children:"ç›´æ’­å°é¢"})}),e.jsxs("div",{className:"absolute top-2 left-2 px-2 py-0.5 bg-black/60 backdrop-blur-sm rounded text-white text-xs",children:[(10*Math.random()).toFixed(1),"ä¸‡"]}),e.jsx("div",{className:"absolute top-2 right-2 px-2 py-0.5 bg-red-500 rounded text-white text-xs font-medium",children:"ç›´æ’­ä¸­"})]}),e.jsx("div",{className:"p-2.5",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900 truncate",children:["ç›´æ’­æ ‡é¢˜ ",t]}),e.jsx("div",{className:"text-xs text-gray-500 truncate",children:"ä¸»æ’­åç§°"})]})]})})]},t))}),p<20&&e.jsx("button",{onClick:()=>{f(e=>e+4)},className:"w-full mt-4 py-3 bg-gray-100 hover:bg-gray-200 rounded-xl text-sm text-gray-700 font-medium transition-colors",children:"åŠ è½½æ›´å¤š"})]})]}):e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"æˆ‘çš„å…³æ³¨"}),e.jsx("span",{className:"text-xs text-gray-500",children:"5äºº"})]}),e.jsx("div",{className:"space-y-3",children:[1,2,3,4,5].map(t=>{const s=t<=2;return e.jsxs("div",{className:"bg-white rounded-xl p-3 flex items-center gap-3 cursor-pointer ios-button border border-gray-200 hover:border-gray-300 transition-all",onClick:()=>a(`/live/${t}`),children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-200"}),s&&e.jsx("div",{className:"absolute -bottom-1 -right-1 px-1.5 py-0.5 bg-red-500 rounded text-white text-xs font-medium",children:"ç›´æ’­ä¸­"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:["ä¸»æ’­åç§° ",t]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:s?`${(5*Math.random()+1).toFixed(1)}ä¸‡äººè§‚çœ‹`:`æœ€è¿‘ç›´æ’­ï¼š${t}å°æ—¶å‰`})]}),e.jsx("button",{className:"px-4 py-1.5 rounded-full text-sm font-medium transition-colors "+(s?"bg-red-500 text-white hover:bg-red-600":"bg-gray-100 text-gray-700 hover:bg-gray-200"),onClick:e=>{e.stopPropagation(),a(`/live/${t}`)},children:s?"è¿›å…¥ç›´æ’­é—´":"æŸ¥çœ‹è¯¦æƒ…"})]},t)})}),e.jsxs("div",{className:"mt-8 text-center text-gray-400 text-sm",children:[e.jsx("div",{className:"mb-2",children:"æš‚æ— æ›´å¤šå…³æ³¨çš„ä¸»æ’­"}),e.jsx("button",{className:"text-gray-600 hover:text-gray-900 font-medium",children:"åŽ»å‘çŽ°æ›´å¤š"})]})]})})]})}},Symbol.toStringTag,{value:"Module"})),ll={"æ–°äºº":{initialRange:[30,80],peakRange:[150,400],growthSpeed:1,retentionRate:.6},"å°æœ‰åæ°”":{initialRange:[100,300],peakRange:[500,1200],growthSpeed:1.5,retentionRate:.75},"çŸ¥åä¸»æ’­":{initialRange:[500,1e3],peakRange:[2e3,5e3],growthSpeed:2.5,retentionRate:.85},"é¡¶æµ":{initialRange:[2e3,5e3],peakRange:[8e3,15e3],growthSpeed:4,retentionRate:.9}},nl=()=>{const e=["å¯çˆ±çš„","å¸…æ°”çš„","æ¸©æŸ”çš„","é˜³å…‰çš„","ç¥žç§˜çš„"],t=["å°çŒ«","å°ç‹—","å°å…”","å°ç†Š","å°é¸Ÿ","æ˜Ÿæ˜Ÿ","æœˆäº®","å¤ªé˜³","å½©è™¹","äº‘æœµ"];return e[Math.floor(Math.random()*e.length)]+t[Math.floor(Math.random()*t.length)]},il=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{id:l}=r(),{showStatusBar:i}=o(),{getCharacter:c}=n(),d=l?JSON.parse(localStorage.getItem(`live_stream_${l}`)||"{}"):{},x=d.characterId?c(d.characterId):null,m=d.popularityLevel||"å°æœ‰åæ°”",h=ll[m]||ll["å°æœ‰åæ°”"],[u,g]=t.useState(!1),[p,f]=t.useState(!1),[b,j]=t.useState(0),[v,y]=t.useState(""),[N,w]=t.useState([]),[k,C]=t.useState(!1),[S,I]=t.useState(!1),_=t.useRef(null),M=t.useRef(null),[z,L]=t.useState(0),[$,A]=t.useState([]),[T,D]=t.useState(0),E=t.useRef(Date.now()),[B,P]=t.useState([]),[F,O]=t.useState(!1),[W,R]=t.useState(""),U=async()=>{if(v.trim()){const e={user:"æˆ‘",text:v,id:Date.now()};w(t=>[...t,e]);const t=v;y(""),await V(t)}},V=async e=>{if(!F){O(!0);try{const t={id:(null==x?void 0:x.id)||"streamer",name:(null==x?void 0:x.name)||"ä¸»æ’­",avatar:(null==x?void 0:x.avatar)||"ðŸ‘¤",description:(null==x?void 0:x.description)||(null==x?void 0:x.signature)||"ä¸€ä¸ªä¸»æ’­",chatHistory:B.slice(-10).map(e=>`${"user"===e.role?"ç”¨æˆ·":null==x?void 0:x.name}: ${e.content}`).join("\n")},s=$.map(e=>({id:e.id,name:e.name,joinTime:e.joinTime})),a=N.slice(-15).map(e=>({id:e.id,senderId:e.user===(null==x?void 0:x.name)?x.id:"æˆ‘"===e.user?"user":e.user,senderName:e.user,senderType:e.user===(null==x?void 0:x.name)?"streamer":"æˆ‘"===e.user?"user":"ç³»ç»Ÿ"===e.user?"system":"viewer",content:e.text,timestamp:e.id})),r=await st(t,s,a,e,z,b);if(!r)return void O(!1);await at(r,e=>{if((e.content.startsWith("ï¼ˆ")||e.content.startsWith("("))&&"streamer"===e.senderType)R(e.content),setTimeout(()=>{R("")},3e3);else{const t={id:Date.now()+1e3*Math.random(),user:e.senderName,text:e.content,isNPC:"viewer"===e.senderType};w(e=>[...e,t])}},e=>{if(L(t=>Math.max(h.initialRange[0],t+e)),e>0)for(let t=0;t<Math.min(e,3);t++)setTimeout(()=>{const e={id:`npc_${Date.now()}_${Math.random()}`,name:nl(),joinTime:Date.now()};A(t=>[...t,e]);const t={user:"ç³»ç»Ÿ",text:`${e.name} è¿›å…¥äº†ç›´æ’­é—´`,id:Date.now(),isNPC:!0};w(e=>[...e,t])},500*t)},e=>{j(t=>t+e)})}catch(t){}finally{O(!1)}}},J=async()=>{await V("ï¼ˆä¸»æ’­æ³¨æ„åˆ°äº†ä½ ï¼‰")};return t.useEffect(()=>{const e=d.characterId;if(e)try{const t=localStorage.getItem(`chat_messages_${e}`);if(t){const e=JSON.parse(t).slice(-20).map(e=>({role:"sent"===e.type?"user":"assistant",content:e.content||e.voiceText||e.photoDescription||""})).filter(e=>e.content.trim());P([{role:"system",content:"ä½ çŽ°åœ¨æ­£åœ¨ç›´æ’­ã€‚è§‚ä¼—ä¼šé€šè¿‡å¼¹å¹•å’Œä½ äº’åŠ¨ï¼Œä½ è¦åƒä¸€ä¸ªçœŸå®žçš„ä¸»æ’­ä¸€æ ·å›žå¤ä»–ä»¬ã€‚ä¿æŒä½ çš„æ€§æ ¼ç‰¹ç‚¹ï¼Œç®€æ´è‡ªç„¶åœ°å›žå¤ã€‚"},...e])}}catch(s){}const t=Math.floor(Math.random()*(h.initialRange[1]-h.initialRange[0])+h.initialRange[0]);L(t),j(Math.floor(t*Math.random()*10)),d.openingMessage&&setTimeout(()=>{const e={user:(null==x?void 0:x.name)||"ä¸»æ’­",text:d.openingMessage,id:Date.now(),isNPC:!1};w(t=>[...t,e])},500)},[]),t.useEffect(()=>{const e=setInterval(()=>{const e=Math.floor((Date.now()-E.current)/6e4);D(e)},6e4);return()=>clearInterval(e)},[]),t.useEffect(()=>{M.current&&M.current.scrollIntoView({behavior:"smooth"})},[N,F]),t.useEffect(()=>{const e=setInterval(()=>{const e=Math.floor(5*Math.random()*h.growthSpeed),t=T<5?e:T<15?Math.floor(.5*e):Math.floor(.3*e);if(Math.random()>.3&&t>0){const e={id:`npc_${Date.now()}_${Math.random()}`,name:nl(),joinTime:Date.now()};A(t=>[...t,e]),L(e=>e+1);const t={user:"ç³»ç»Ÿ",text:`${e.name} è¿›å…¥äº†ç›´æ’­é—´`,id:Date.now(),isNPC:!0};w(e=>[...e,t])}Math.random()>h.retentionRate&&$.length>10&&(A(e=>e.slice(1)),L(e=>Math.max(h.initialRange[0],e-1)))},8e3);return()=>clearInterval(e)},[T,h,$.length]),t.useEffect(()=>{const e=setInterval(()=>{if(0===$.length||F)return;if(Math.random()>.8)return;const e=["666","å“ˆå“ˆå“ˆ","ä¸»æ’­åŠ æ²¹","å¥½çœ‹ï¼","çˆ±äº†","åˆšæ¥","åœ¨å—","å”±é¦–æ­Œå§"],t={user:$[Math.floor(Math.random()*$.length)].name,text:e[Math.floor(Math.random()*e.length)],id:Date.now(),isNPC:!0};w(e=>[...e,t])},15e3+1e4*Math.random());return()=>clearInterval(e)},[$,F]),e.jsxs("div",{className:"h-screen flex flex-col bg-black",children:[i&&e.jsx(ua,{}),e.jsxs("div",{className:"relative flex-1 bg-gray-900",children:[e.jsxs("div",{onClick:J,className:"absolute inset-0 flex items-center justify-center bg-gradient-to-b from-purple-900/20 to-pink-900/20 cursor-pointer active:scale-95 transition-transform",children:[(null==x?void 0:x.avatar)?x.avatar.startsWith("data:image")?e.jsx("img",{src:x.avatar,alt:x.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"text-8xl",children:x.avatar}):e.jsx("div",{className:"text-gray-500 text-lg",children:"ç›´æ’­ç”»é¢"}),W&&e.jsx("div",{className:"absolute bottom-6 left-4 right-4 px-4 py-2 bg-purple-600/70 backdrop-blur-sm rounded-lg transition-all duration-300 max-w-sm",children:e.jsx("div",{className:"text-white text-sm italic",children:W})})]}),e.jsx("div",{className:"absolute top-0 left-0 right-0 p-4 bg-gradient-to-b from-black/60 to-transparent",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a(-1),className:"w-10 h-10 rounded-full bg-black/40 backdrop-blur-sm flex items-center justify-center text-white hover:bg-black/60 transition-colors",children:e.jsx(os,{size:20})}),e.jsxs("div",{className:"flex-1 mx-3 flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-700 flex items-center justify-center text-xl overflow-hidden",children:(null==x?void 0:x.avatar)&&!x.avatar.startsWith("data:image")?x.avatar:(null==x?void 0:x.avatar)?e.jsx("img",{src:x.avatar,alt:"",className:"w-full h-full object-cover"}):"ðŸ‘¤"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-white text-sm font-medium",children:(null==x?void 0:x.name)||"ä¸»æ’­"}),e.jsx("div",{className:"text-white/70 text-xs",children:z>=1e4?`${Math.floor(z/1e4)}ä¸‡+äººè§‚çœ‹`:`${z}äººè§‚çœ‹`})]}),e.jsx("button",{onClick:()=>{const e=!u;if(g(e),e){const e={user:"ç³»ç»Ÿ",text:"ä½ å…³æ³¨äº†ä¸»æ’­",id:Date.now(),isNPC:!1};w(t=>[...t,e]),Math.random()>.7&&setTimeout(()=>{F||J()},1500)}},className:"px-4 py-1.5 rounded-full text-sm font-medium transition-colors "+(u?"bg-white/20 text-white hover:bg-white/30":"bg-red-500 text-white hover:bg-red-600"),children:u?"å·²å…³æ³¨":"å…³æ³¨"})]}),e.jsx("button",{onClick:()=>I(!S),className:"w-10 h-10 rounded-full bg-black/40 backdrop-blur-sm flex items-center justify-center text-white hover:bg-black/60 transition-colors",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"1"}),e.jsx("circle",{cx:"12",cy:"5",r:"1"}),e.jsx("circle",{cx:"12",cy:"19",r:"1"})]})})]})}),S&&e.jsx("div",{className:"absolute top-16 right-4 bg-white rounded-xl shadow-xl overflow-hidden z-10",children:["ä¸¾æŠ¥","å±è”½","æ¸…æ™°åº¦","éŸ³é‡"].map(t=>e.jsx("button",{onClick:()=>I(!1),className:"w-full px-6 py-3 text-left text-sm text-gray-700 hover:bg-gray-100 transition-colors",children:t},t))}),e.jsxs("div",{className:"absolute right-4 bottom-32 flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("button",{onClick:()=>{f(!p),j(e=>p?e-1:e+1)},className:"w-12 h-12 rounded-full bg-black/40 backdrop-blur-sm flex items-center justify-center transition-all "+(p?"text-red-500":"text-white"),children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:p?"currentColor":"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"})})}),e.jsx("span",{className:"text-white text-xs mt-1",children:b>=1e4?`${Math.floor(b/1e4)}ä¸‡+`:b})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("button",{onClick:()=>C(!0),className:"w-12 h-12 rounded-full bg-black/40 backdrop-blur-sm flex items-center justify-center text-white",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"8",width:"18",height:"4",rx:"1"}),e.jsx("path",{d:"M12 8v13"}),e.jsx("path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7"}),e.jsx("path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5"})]})}),e.jsx("span",{className:"text-white text-xs mt-1",children:"ç¤¼ç‰©"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("button",{className:"w-12 h-12 rounded-full bg-black/40 backdrop-blur-sm flex items-center justify-center text-white",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"18",cy:"5",r:"3"}),e.jsx("circle",{cx:"6",cy:"12",r:"3"}),e.jsx("circle",{cx:"18",cy:"19",r:"3"}),e.jsx("line",{x1:"8.59",y1:"13.51",x2:"15.42",y2:"17.49"}),e.jsx("line",{x1:"15.41",y1:"6.51",x2:"8.59",y2:"10.49"})]})}),e.jsx("span",{className:"text-white text-xs mt-1",children:"åˆ†äº«"})]})]}),e.jsx("div",{className:"absolute left-4 right-20 bottom-32 max-h-48 overflow-y-auto hide-scrollbar",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[N.map(t=>{if(!t.text||!t.user)return null;const s=t.text.startsWith("ï¼ˆ")||t.text.startsWith("("),a=t.user===(null==x?void 0:x.name)||"ä¸»æ’­"===t.user,r="ç³»ç»Ÿ"===t.user;return e.jsxs("div",{className:"px-3 py-1.5 backdrop-blur-sm rounded-full text-sm max-w-xs w-fit "+(s?"bg-purple-500/30 italic":r?"bg-gray-500/30":"bg-black/40"),children:[e.jsxs("span",{className:"font-medium "+(a?"text-pink-400":r?"text-gray-300":"text-blue-400"),children:[t.user,"ï¼š"]}),e.jsx("span",{className:s?"text-gray-200":"text-white",children:t.text})]},t.id)}),F&&e.jsxs("div",{className:"px-3 py-1.5 bg-black/40 backdrop-blur-sm rounded-full text-white text-sm max-w-xs w-fit",children:[e.jsxs("span",{className:"text-pink-400 font-medium",children:[(null==x?void 0:x.name)||"ä¸»æ’­","ï¼š"]}),e.jsx("span",{className:"animate-pulse",children:"æ­£åœ¨è¾“å…¥..."})]}),e.jsx("div",{ref:M})]})})]}),k&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 z-20",onClick:()=>C(!1)}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-white rounded-t-3xl p-4 pb-20 z-30 shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"é€‰æ‹©ç¤¼ç‰©"}),e.jsx("button",{onClick:()=>C(!1),className:"text-gray-500 hover:text-gray-700",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),e.jsx("div",{className:"grid grid-cols-4 gap-3 max-h-64 overflow-y-auto",children:[{name:"çŽ«ç‘°",emoji:"ðŸŒ¹",price:1},{name:"çˆ±å¿ƒ",emoji:"â¤ï¸",price:5},{name:"ç«ç®­",emoji:"ðŸš€",price:10},{name:"è·‘è½¦",emoji:"ðŸš—",price:20},{name:"åŸŽå ¡",emoji:"ðŸ°",price:50},{name:"çš‡å† ",emoji:"ðŸ‘‘",price:100},{name:"é’»çŸ³",emoji:"ðŸ’Ž",price:200},{name:"æ˜Ÿæ˜Ÿ",emoji:"â­",price:520}].map(t=>e.jsxs("button",{onClick:()=>((e,t,s)=>{const a=d.characterId;if(!a)return;const r=Se("user_money",0),l=`intimate_pay_${a}_to_user`,n=Se(l,null);let i="",c=!1;if(n&&"active"===n.status){const s=n.used||0;n.monthlyLimit-s>=t&&(n.used=s+t,n.records||(n.records=[]),n.records.push({date:(new Date).toISOString(),amount:t,description:`ç›´æ’­-${(null==x?void 0:x.name)||"ä¸»æ’­"}-é€å‡º${e}`,timestamp:Date.now()}),G(l,n),i="äº²å¯†ä»˜",c=!0)}if(c||r>=t&&(G("user_money",r-t),i="å¾®ä¿¡é›¶é’±",c=!0),c){C(!1);const a={user:"æˆ‘",text:`é€å‡ºäº†${e} ${s}`,id:Date.now()};w(e=>[...e,a]);const r={user:"ç³»ç»Ÿ",text:`ä½¿ç”¨${i}æ”¯ä»˜ Â¥${t}`,id:Date.now()+1};setTimeout(()=>{w(e=>[...e,r])},500),setTimeout(()=>{F||J()},1e3+1e3*Math.random())}else alert(`ä½™é¢ä¸è¶³ï¼\nç¤¼ç‰©ä»·æ ¼ï¼šÂ¥${t}\nå½“å‰é›¶é’±ï¼šÂ¥${r.toFixed(2)}\n${n?`äº²å¯†ä»˜å‰©ä½™ï¼šÂ¥${(n.monthlyLimit-(n.used||0)).toFixed(2)}`:"æœªå¼€é€šäº²å¯†ä»˜"}`)})(t.name,t.price,t.emoji),className:"flex flex-col items-center gap-2 p-3 bg-gray-50 rounded-xl hover:bg-gray-200 active:bg-gray-300 transition-colors",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-pink-100 to-red-100 rounded-full flex items-center justify-center text-3xl",children:t.emoji}),e.jsx("span",{className:"text-xs text-gray-900 font-medium",children:t.name}),e.jsxs("span",{className:"text-xs text-red-500 font-semibold",children:["Â¥",t.price]})]},t.name))})]})]}),e.jsx("div",{className:"bg-white border-t border-gray-200 z-40 relative",children:e.jsxs("div",{className:"flex items-center gap-2 p-3",children:[e.jsx("button",{className:"w-10 h-10 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center transition-colors flex-shrink-0",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M8 14s1.5 2 4 2 4-2 4-2"}),e.jsx("line",{x1:"9",y1:"9",x2:"9.01",y2:"9"}),e.jsx("line",{x1:"15",y1:"9",x2:"15.01",y2:"9"})]})}),e.jsx("div",{className:"flex-1 h-10 px-4 bg-gray-100 rounded-full flex items-center",children:e.jsx("input",{ref:_,type:"text",value:v,onChange:e=>y(e.target.value),onKeyPress:e=>"Enter"===e.key&&U(),placeholder:"è¯´ç‚¹ä»€ä¹ˆ...",className:"flex-1 bg-transparent text-sm outline-none text-gray-900 placeholder-gray-500"})}),e.jsx("button",{onClick:()=>{var e;return null==(e=_.current)?void 0:e.focus()},className:"w-10 h-10 rounded-full bg-gray-900/80 flex items-center justify-center text-white flex-shrink-0",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})})}),v&&e.jsx("button",{onClick:U,className:"px-5 h-10 bg-red-500 text-white rounded-full text-sm font-medium hover:bg-red-600 active:bg-red-700 transition-colors flex-shrink-0",children:"å‘é€"})]})})]})}},Symbol.toStringTag,{value:"Module"})),cl=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{var a;const r=s(),{background:l,getBackgroundStyle:i}=c(),{showStatusBar:x}=o(),{characters:m}=n(),{currentUser:h}=d(),[u,g]=t.useState(null),[p,f]=t.useState(!1),[b,j]=t.useState("public");t.useEffect(()=>{v();const e=()=>{document.hidden||v()};document.addEventListener("visibilitychange",e);const t=()=>{v()};return window.addEventListener("focus",t),()=>{document.removeEventListener("visibilitychange",e),window.removeEventListener("focus",t)}},[]);const v=()=>{const e=rt();g(e);const t=lt();j(t)};return e.jsxs("div",{className:"h-full flex flex-col relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 z-0",style:i()}),e.jsxs("div",{className:"relative z-10 h-full flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-50 "+(l?"glass-dark":"glass-effect"),children:[x&&e.jsx(ua,{}),e.jsxs("div",{className:"flex items-center justify-between px-5 py-4",children:[e.jsx("button",{onClick:()=>r(-1),className:"text-blue-500 ios-button",children:"è¿”å›ž"}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"æƒ…ä¾£ç©ºé—´"}),e.jsx("div",{className:"w-12"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-4 pt-6",children:u&&"ended"!==u.status&&"rejected"!==u.status?"pending"===u.status?e.jsx("div",{className:"flex flex-col items-center justify-center min-h-[60vh]",children:e.jsx("div",{className:"w-full max-w-md",children:e.jsxs("div",{className:"glass-card rounded-3xl p-8 text-center space-y-6 shadow-xl border border-white/20",children:[e.jsx("div",{className:"w-24 h-24 mx-auto rounded-full glass-card flex items-center justify-center shadow-lg border border-white/30 animate-pulse",children:e.jsx("svg",{className:"w-12 h-12 text-pink-400",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"ç­‰å¾…å¯¹æ–¹åŒæ„"}),e.jsxs("p",{className:"text-gray-600 text-sm",children:["å·²å‘ ",u.characterName," å‘é€é‚€è¯·",e.jsx("br",{}),"è¯·è€å¿ƒç­‰å¾…å¯¹æ–¹å›žåº”"]})]})]})})}):e.jsxs("div",{className:"space-y-6 pb-6",children:[e.jsxs("div",{className:"glass-card rounded-3xl p-8 shadow-2xl border border-white/20",children:[e.jsxs("div",{className:"relative flex items-center justify-center mb-6",children:[e.jsx("div",{className:"relative z-10",children:e.jsx("div",{className:"w-28 h-28 rounded-full glass-card p-1.5 shadow-2xl border border-white/40",children:e.jsx("div",{className:"w-full h-full rounded-full overflow-hidden bg-gray-100",children:(null==h?void 0:h.avatar)?e.jsx("img",{src:h.avatar,alt:h.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-700 text-3xl font-bold",children:(null==(a=null==h?void 0:h.name)?void 0:a[0])||"æˆ‘"})})})}),e.jsx("div",{className:"relative z-20 -mx-6",children:e.jsx("div",{className:"w-16 h-16 rounded-full glass-card flex items-center justify-center shadow-xl border-2 border-white/50",children:e.jsx("svg",{className:"w-8 h-8 text-pink-400",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})})})}),e.jsx("div",{className:"relative z-10",children:e.jsx("div",{className:"w-28 h-28 rounded-full glass-card p-1.5 shadow-2xl border border-white/40",children:e.jsx("div",{className:"w-full h-full rounded-full overflow-hidden bg-white",children:u.characterAvatar?e.jsx("img",{src:u.characterAvatar,alt:u.characterName,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gray-100 flex items-center justify-center text-gray-700 text-3xl font-bold",children:u.characterName[0]})})})})]}),e.jsx("div",{className:"text-center mb-4",children:e.jsxs("h2",{className:"text-2xl font-bold text-gray-900",children:[(null==h?void 0:h.name)||"æˆ‘"," & ",u.characterName]})}),e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"inline-flex items-baseline space-x-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"åœ¨ä¸€èµ·"}),e.jsx("span",{className:"text-5xl font-bold text-gray-900",children:Math.floor((Date.now()-(u.acceptedAt||u.createdAt))/864e5)}),e.jsx("span",{className:"text-sm text-gray-600",children:"å¤©"})]})})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("button",{onClick:()=>r("/couple-album"),className:"flex flex-col items-center space-y-2 p-4 rounded-2xl glass-card border border-white/10 hover:scale-105 active:scale-95 transition-all",children:[e.jsx("div",{className:"w-14 h-14 rounded-full glass-card flex items-center justify-center shadow-lg border border-white/30",children:e.jsx("svg",{className:"w-7 h-7 text-purple-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsx("span",{className:"text-xs font-medium text-gray-700",children:"ç›¸å†Œ"})]}),e.jsxs("button",{onClick:()=>r("/couple-anniversary"),className:"flex flex-col items-center space-y-2 p-4 rounded-2xl glass-card border border-white/10 hover:scale-105 active:scale-95 transition-all",children:[e.jsx("div",{className:"w-14 h-14 rounded-full glass-card flex items-center justify-center shadow-lg border border-white/30",children:e.jsx("svg",{className:"w-7 h-7 text-pink-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsx("span",{className:"text-xs font-medium text-gray-700",children:"çºªå¿µæ—¥"})]}),e.jsxs("button",{onClick:()=>r("/couple-message-board"),className:"flex flex-col items-center space-y-2 p-4 rounded-2xl glass-card border border-white/10 hover:scale-105 active:scale-95 transition-all",children:[e.jsx("div",{className:"w-14 h-14 rounded-full glass-card flex items-center justify-center shadow-lg border border-white/30",children:e.jsx("svg",{className:"w-7 h-7 text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"})})}),e.jsx("span",{className:"text-xs font-medium text-gray-700",children:"ç•™è¨€"})]}),e.jsxs("button",{className:"flex flex-col items-center space-y-2 p-4 rounded-2xl glass-card border border-white/10 hover:scale-105 active:scale-95 transition-all",children:[e.jsx("div",{className:"w-14 h-14 rounded-full glass-card flex items-center justify-center shadow-lg border border-white/30",children:e.jsx("svg",{className:"w-7 h-7 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})}),e.jsx("span",{className:"text-xs font-medium text-gray-700",children:"æ›´å¤š"})]})]}),e.jsx("div",{className:"glass-card rounded-2xl p-4 border border-white/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900 mb-1",children:"éšç§è®¾ç½®"}),e.jsx("div",{className:"text-xs text-gray-600",children:"public"===b?"å…¬å¼€ï¼šå…¶ä»–äººå¯ä»¥çœ‹åˆ°ä½ æœ‰æƒ…ä¾£ç©ºé—´":"ç§å¯†ï¼šå¯¹å…¶ä»–äººéšè—æƒ…ä¾£ç©ºé—´çŠ¶æ€"})]}),e.jsx("button",{onClick:()=>{const e="public"===b?"private":"public";nt(e),j(e)},className:"px-4 py-2 rounded-full text-sm font-medium ios-button transition-all "+("public"===b?"glass-card border border-white/20 text-gray-900":"bg-blue-500 text-white"),children:"public"===b?"å…¬å¼€":"ç§å¯†"})]})}),e.jsx("button",{onClick:()=>{if(confirm("ç¡®å®šè¦ç»“æŸæƒ…ä¾£ç©ºé—´å—ï¼Ÿ")){it()&&(alert("å·²ç»“æŸæƒ…ä¾£ç©ºé—´"),v())}},className:"w-full py-3 rounded-2xl text-red-400 text-sm font-medium glass-card border border-red-200/30 hover:bg-red-50 active:bg-red-100 transition-all",children:"ç»“æŸæƒ…ä¾£ç©ºé—´"})]}):e.jsx("div",{className:"flex flex-col items-center justify-center min-h-[60vh]",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"glass-card rounded-3xl p-8 text-center space-y-6 shadow-xl border border-white/20",children:[e.jsx("div",{className:"w-24 h-24 mx-auto rounded-full glass-card flex items-center justify-center shadow-lg border border-white/30",children:e.jsx("svg",{className:"w-12 h-12 text-pink-400",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"å¼€å¯æƒ…ä¾£ç©ºé—´"}),e.jsxs("p",{className:"text-gray-600 text-sm leading-relaxed",children:["é‚€è¯·ä½ çš„TAåŠ å…¥ä¸“å±žæƒ…ä¾£ç©ºé—´",e.jsx("br",{}),"å…±åŒè®°å½•ç¾Žå¥½æ—¶å…‰"]})]}),e.jsx("button",{onClick:()=>f(!0),className:"w-full py-4 rounded-2xl glass-card text-gray-900 font-semibold shadow-lg border border-white/30 hover:scale-[0.98] active:scale-[0.96] transition-all",children:"å‘é€é‚€è¯·"})]}),e.jsxs("div",{className:"mt-6 glass-card rounded-2xl p-6 space-y-4 border border-white/10",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-pink-100 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-pink-500 text-sm font-bold",children:"1"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-gray-900 font-medium mb-1",children:"é€‰æ‹©ä½ çš„TA"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"ä»Žè§’è‰²åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä½è¿›è¡Œé‚€è¯·"})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-pink-100 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-pink-500 text-sm font-bold",children:"2"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-gray-900 font-medium mb-1",children:"ç­‰å¾…å¯¹æ–¹åŒæ„"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"å¯¹æ–¹å¯ä»¥é€‰æ‹©æŽ¥å—æˆ–æ‹’ç»é‚€è¯·"})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-pink-100 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-pink-500 text-sm font-bold",children:"3"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-gray-900 font-medium mb-1",children:"å¼€å¯ä¸“å±žç©ºé—´"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"å»ºç«‹åŽå¯å…±äº«ç…§ç‰‡ã€è®°å½•çºªå¿µæ—¥ç­‰"})]})]})]})]})})})]}),p&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm",onClick:()=>f(!1)}),e.jsxs("div",{className:"relative w-full max-h-[70vh] glass-card rounded-t-3xl overflow-hidden",children:[e.jsx("div",{className:"sticky top-0 z-10 glass-effect px-6 py-4 border-b border-gray-100",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900 text-center",children:"é€‰æ‹©é‚€è¯·å¯¹è±¡"})}),e.jsx("div",{className:"overflow-y-auto hide-scrollbar p-4 space-y-2",children:m.map(t=>e.jsxs("div",{onClick:()=>{(e=>{const t=m.find(t=>t.id===e);if(!t)return;ct("current_user",t.id,t.name,t.avatar)?r(`/chat/${e}`,{state:{sendCoupleSpaceInvite:!0}}):alert("åˆ›å»ºé‚€è¯·å¤±è´¥ï¼Œè¯·å…ˆç»“æŸå½“å‰çš„æƒ…ä¾£ç©ºé—´")})(t.id),f(!1)},className:"flex items-center space-x-3 p-4 rounded-2xl glass-card hover:scale-[0.98] active:scale-[0.96] transition-all cursor-pointer border border-white/10",children:[e.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden bg-gradient-to-br from-blue-400 to-purple-400 flex-shrink-0",children:t.avatar?e.jsx("img",{src:t.avatar,alt:t.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-white text-lg font-bold",children:t.name[0]})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:t.name}),t.description&&e.jsx("p",{className:"text-sm text-gray-600 line-clamp-1 mt-0.5",children:t.description})]})]},t.id))})]})]})]})}},Symbol.toStringTag,{value:"Module"})),ol=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{background:r,getBackgroundStyle:l}=c(),{showStatusBar:n}=o(),[i,d]=t.useState([]),[x,m]=t.useState(!1),[h,u]=t.useState(""),[g,p]=t.useState(null);t.useEffect(()=>{f()},[]);const f=()=>{const e=ot();d(e)};return e.jsxs("div",{className:"h-full flex flex-col relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 z-0",style:l()}),e.jsxs("div",{className:"relative z-10 h-full flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-50 "+(r?"glass-dark":"glass-effect"),children:[n&&e.jsx(ua,{}),e.jsxs("div",{className:"flex items-center justify-between px-5 py-4",children:[e.jsx("button",{onClick:()=>a(-1),className:"text-blue-500 ios-button",children:"è¿”å›ž"}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"ç›¸å†Œ"}),e.jsx("button",{onClick:()=>m(!0),className:"text-blue-500 ios-button",children:"ä¸Šä¼ "})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-4 pt-6",children:0===i.length?e.jsx("div",{className:"flex flex-col items-center justify-center min-h-[60vh]",children:e.jsx("div",{className:"w-full max-w-md",children:e.jsxs("div",{className:"glass-card rounded-3xl p-8 text-center space-y-6 shadow-xl border border-white/20",children:[e.jsx("div",{className:"w-24 h-24 mx-auto rounded-full glass-card flex items-center justify-center shadow-lg border border-white/30",children:e.jsx("svg",{className:"w-12 h-12 text-purple-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"æš‚æ— ç…§ç‰‡"}),e.jsxs("p",{className:"text-gray-600 text-sm leading-relaxed",children:["åœ¨èŠå¤©ä¸­è®©AIç”¨ [ç›¸å†Œ:æè¿°] åˆ†äº«ç…§ç‰‡",e.jsx("br",{}),"è®°å½•æ¯ä¸€ä¸ªç”œèœœæ—¶åˆ»"]})]})]})})}):e.jsx("div",{className:"grid grid-cols-2 gap-4 pb-6",children:i.map(t=>{const s=new Date(t.timestamp).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),a=t.description&&"ï¼ˆæ— æ–‡æ¡ˆï¼‰"!==t.description;return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx(Ra,{description:"æš‚æ— å›¾ç‰‡æè¿°ï¼ˆåŽç»­è¯†å›¾åŠŸèƒ½å°†è‡ªåŠ¨ç”Ÿæˆï¼‰",messageId:t.timestamp})}),e.jsxs("div",{className:"flex items-center justify-between px-2",children:[e.jsx("span",{className:"text-xs font-semibold text-gray-700",children:t.uploaderName||t.characterName}),e.jsx("span",{className:"text-xs text-gray-500",children:s})]}),a&&e.jsx("div",{className:"glass-card rounded-xl p-3 border border-white/20",children:e.jsx("p",{className:"text-sm text-gray-700 leading-relaxed",children:t.description})})]},t.id)})})}),x&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm",onClick:()=>m(!1)}),e.jsxs("div",{className:"relative w-full max-w-sm glass-card rounded-3xl p-6 shadow-2xl border border-white/20",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4 text-center",children:"ä¸Šä¼ ç…§ç‰‡"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-2",children:"é€‰æ‹©ç…§ç‰‡ï¼ˆå¯é€‰ï¼‰"}),e.jsx("input",{type:"file",accept:"image/*",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(s){const e=new FileReader;e.onload=e=>{var t;p(null==(t=e.target)?void 0:t.result)},e.readAsDataURL(s)}},className:"w-full px-3 py-2 border border-gray-300 rounded-xl text-sm"}),g&&e.jsx("img",{src:g,alt:"é¢„è§ˆ",className:"mt-2 w-full h-40 object-cover rounded-xl"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-2",children:"æ–‡æ¡ˆ"}),e.jsx("textarea",{value:h,onChange:e=>u(e.target.value),placeholder:"å†™ä¸‹ä½ æƒ³è¯´çš„è¯...",className:"w-full px-3 py-2 border border-gray-300 rounded-xl resize-none text-sm",rows:3}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"å›¾ç‰‡æè¿°å°†åœ¨åŽç»­è¯†å›¾åŠŸèƒ½ä¸­è‡ªåŠ¨ç”Ÿæˆ"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>m(!1),className:"flex-1 px-4 py-3 rounded-full glass-card border border-white/20 text-gray-900 font-medium ios-button",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:()=>{if(!h.trim()&&!g)return void alert("è¯·è‡³å°‘ä¸Šä¼ ç…§ç‰‡æˆ–è¾“å…¥æ–‡æ¡ˆ");const e=rt();e&&"active"===e.status?(dt(e.characterId,"æˆ‘",h.trim()||"ï¼ˆæ— æ–‡æ¡ˆï¼‰",g||void 0),u(""),p(null),m(!1),f(),alert("ç…§ç‰‡å·²ä¸Šä¼ ï¼")):alert("è¯·å…ˆå¼€é€šæƒ…ä¾£ç©ºé—´")},className:"flex-1 px-4 py-3 rounded-full glass-card border border-white/20 text-gray-900 font-medium ios-button",children:"ä¸Šä¼ "})]})]})]})]})]})}},Symbol.toStringTag,{value:"Module"})),dl=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{background:r,getBackgroundStyle:l}=c(),{showStatusBar:n}=o(),[i,d]=t.useState([]),[x,m]=t.useState(!1),[h,u]=t.useState(""),[g,p]=t.useState(""),[f,b]=t.useState(""),[j,v]=t.useState(null),[y,N]=t.useState(!1),[w,k]=t.useState(null);t.useEffect(()=>{S(),C();const e=()=>{document.hidden||C()};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}},[]);const C=()=>{const e=xt();k(e)},S=()=>{const e=mt();d(e)};return e.jsxs("div",{className:"h-full flex flex-col relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 z-0",style:l()}),e.jsxs("div",{className:"relative z-10 h-full flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-50 "+(r?"glass-dark":"glass-effect"),children:[n&&e.jsx(ua,{}),e.jsxs("div",{className:"flex items-center justify-between px-5 py-4",children:[e.jsx("button",{onClick:()=>a(-1),className:"text-blue-500 ios-button",children:"è¿”å›ž"}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"çºªå¿µæ—¥"}),e.jsx("button",{onClick:()=>m(!0),className:"text-blue-500 ios-button",children:"æ·»åŠ "})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-4 pt-6",children:0===i.length?e.jsx("div",{className:"flex flex-col items-center justify-center min-h-[60vh]",children:e.jsx("div",{className:"w-full max-w-md",children:e.jsxs("div",{className:"glass-card rounded-3xl p-8 text-center space-y-6 shadow-xl border border-white/20",children:[e.jsx("div",{className:"w-24 h-24 mx-auto rounded-full glass-card flex items-center justify-center shadow-lg border border-white/30",children:e.jsx("svg",{className:"w-12 h-12 text-pink-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"æš‚æ— çºªå¿µæ—¥"}),e.jsxs("p",{className:"text-gray-600 text-sm leading-relaxed",children:["åœ¨èŠå¤©ä¸­è®©AIç”¨ [çºªå¿µæ—¥:æ—¥æœŸ|æ ‡é¢˜|æè¿°] æ·»åŠ ",e.jsx("br",{}),"æ¯ä¸€ä¸ªçºªå¿µæ—¥éƒ½å€¼å¾—çè—"]})]})]})})}):e.jsx("div",{className:"grid grid-cols-2 gap-4 pb-6",children:i.map(t=>{const s=ht(t.date),a=s<0,r=0===s,l=Math.abs(s),n=["æ˜ŸæœŸæ—¥","æ˜ŸæœŸä¸€","æ˜ŸæœŸäºŒ","æ˜ŸæœŸä¸‰","æ˜ŸæœŸå››","æ˜ŸæœŸäº”","æ˜ŸæœŸå…­"][new Date(t.date).getDay()];return e.jsxs("div",{className:"relative rounded-2xl overflow-hidden shadow-lg border border-white/20 cursor-pointer hover:scale-105 transition-transform",onClick:()=>{v(t),N(!0)},children:[w&&e.jsx("div",{className:"absolute inset-0 bg-cover bg-center",style:{backgroundImage:`url(${w})`}}),e.jsx("div",{className:"absolute inset-0 bg-white/60"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("div",{className:"px-4 py-3 text-center border-b border-white/20",children:e.jsx("h3",{className:"text-gray-900 text-base font-bold truncate",children:t.title})}),e.jsx("div",{className:"px-4 py-8",children:e.jsx("div",{className:"text-center",children:a?e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-gray-500 text-xs",children:"å·²ç»è¿‡åŽ»"}),e.jsx("p",{className:"text-5xl font-bold text-gray-800 tracking-tight leading-none",children:l}),e.jsx("p",{className:"text-gray-500 text-sm",children:"å¤©"})]}):r?e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-pink-500 text-sm font-bold",children:"å°±æ˜¯ä»Šå¤©"}),e.jsx("p",{className:"text-5xl font-bold text-pink-500 tracking-tight leading-none",children:"0"})]}):e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-gray-500 text-xs",children:"è¿˜æœ‰"}),e.jsx("p",{className:"text-5xl font-bold text-gray-800 tracking-tight leading-none",children:l}),e.jsx("p",{className:"text-gray-500 text-sm",children:"å¤©"})]})})}),e.jsxs("div",{className:"px-4 py-3 text-center border-t border-white/20",children:[e.jsxs("p",{className:"text-gray-600 text-xs truncate",children:[t.date," ",n]}),t.description&&e.jsx("p",{className:"text-gray-500 text-xs mt-1 truncate",children:t.description})]})]})]},t.id)})})}),x&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm",onClick:()=>m(!1)}),e.jsxs("div",{className:"relative w-full max-w-sm glass-card rounded-3xl p-6 shadow-2xl border border-white/20",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4 text-center",children:"æ·»åŠ çºªå¿µæ—¥"}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-2",children:"æ—¥æœŸ"}),e.jsx("input",{type:"date",value:h,onChange:e=>u(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-xl text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-2",children:"æ ‡é¢˜"}),e.jsx("input",{type:"text",value:g,onChange:e=>p(e.target.value),placeholder:"ä¾‹å¦‚ï¼šç¬¬ä¸€æ¬¡è§é¢",className:"w-full px-3 py-2 border border-gray-300 rounded-xl text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-2",children:"æè¿°ï¼ˆå¯é€‰ï¼‰"}),e.jsx("textarea",{value:f,onChange:e=>b(e.target.value),placeholder:"è®°å½•è¿™ä¸ªç‰¹æ®Šçš„æ—¥å­...",className:"w-full px-3 py-2 border border-gray-300 rounded-xl resize-none text-sm",rows:3})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>m(!1),className:"flex-1 px-4 py-3 rounded-full glass-card border border-white/20 text-gray-900 font-medium ios-button",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:()=>{if(!h||!g.trim())return void alert("è¯·å¡«å†™æ—¥æœŸå’Œæ ‡é¢˜");const e=rt();e&&"active"===e.status?(ut(e.characterId,"æˆ‘",h,g.trim(),f.trim()),u(""),p(""),b(""),m(!1),S(),alert("çºªå¿µæ—¥å·²æ·»åŠ ï¼")):alert("è¯·å…ˆå¼€é€šæƒ…ä¾£ç©ºé—´")},className:"flex-1 px-4 py-3 rounded-full glass-card border border-white/20 text-gray-900 font-medium ios-button",children:"æ·»åŠ "})]})]})]}),y&&j&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm",onClick:()=>N(!1)}),e.jsxs("div",{className:"relative w-full max-w-md glass-card rounded-3xl p-6 shadow-2xl border border-white/20",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4 text-center",children:j.title}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"glass-card rounded-xl p-4 border border-white/20",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"ç›®æ ‡æ—¥æœŸ"}),e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:j.date}),e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:["æ˜ŸæœŸæ—¥","æ˜ŸæœŸä¸€","æ˜ŸæœŸäºŒ","æ˜ŸæœŸä¸‰","æ˜ŸæœŸå››","æ˜ŸæœŸäº”","æ˜ŸæœŸå…­"][new Date(j.date).getDay()]})]}),e.jsxs("div",{className:"glass-card rounded-xl p-4 border border-white/20",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"å€’è®¡æ—¶"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:(()=>{const e=ht(j.date),t=e<0,s=0===e,a=Math.abs(e);return s?"å°±æ˜¯ä»Šå¤©ï¼":t?`å·²è¿‡ ${a} å¤©`:`è¿˜æœ‰ ${a} å¤©`})()})]}),j.description&&e.jsxs("div",{className:"glass-card rounded-xl p-4 border border-white/20",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"æè¿°"}),e.jsx("div",{className:"text-sm text-gray-900 leading-relaxed",children:j.description})]}),e.jsxs("div",{className:"glass-card rounded-xl p-4 border border-white/20",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"åˆ›å»ºè€…"}),e.jsx("div",{className:"text-sm text-gray-900",children:j.characterName})]}),e.jsxs("div",{className:"glass-card rounded-xl p-4 border border-white/20",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"åˆ›å»ºæ—¶é—´"}),e.jsx("div",{className:"text-sm text-gray-900",children:new Date(j.createdAt).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})})]})]}),e.jsx("button",{onClick:()=>N(!1),className:"w-full px-4 py-3 rounded-full glass-card border border-white/20 text-gray-900 font-medium ios-button mt-4",children:"å…³é—­"})]})]})]})]})}},Symbol.toStringTag,{value:"Module"})),xl=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{background:r,getBackgroundStyle:l}=c(),{showStatusBar:n}=o(),[i,d]=t.useState([]),[x,m]=t.useState(!1),[h,u]=t.useState("");t.useEffect(()=>{g()},[]);const g=()=>{const e=gt();d(e)},p=e=>{const t=new Date(e),s=(new Date).getTime()-t.getTime(),a=Math.floor(s/864e5);return 0===a?"ä»Šå¤© "+t.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):1===a?"æ˜¨å¤©":a<7?`${a}å¤©å‰`:t.toLocaleDateString("zh-CN",{month:"long",day:"numeric"})};return e.jsxs("div",{className:"h-full flex flex-col relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 z-0",style:l()}),e.jsxs("div",{className:"relative z-10 h-full flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-50 "+(r?"glass-dark":"glass-effect"),children:[n&&e.jsx(ua,{}),e.jsxs("div",{className:"flex items-center justify-between px-5 py-4",children:[e.jsx("button",{onClick:()=>a(-1),className:"text-blue-500 ios-button",children:"è¿”å›ž"}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"ç•™è¨€æ¿"}),e.jsx("button",{onClick:()=>m(!0),className:"text-blue-500 ios-button",children:"å†™ç•™è¨€"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-4 pt-6",children:0===i.length?e.jsx("div",{className:"flex flex-col items-center justify-center min-h-[60vh]",children:e.jsx("div",{className:"w-full max-w-md",children:e.jsxs("div",{className:"glass-card rounded-3xl p-8 text-center space-y-6 shadow-xl border border-white/20",children:[e.jsx("div",{className:"w-24 h-24 mx-auto rounded-full glass-card flex items-center justify-center shadow-lg border border-white/30",children:e.jsx("svg",{className:"w-12 h-12 text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"})})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"æš‚æ— ç•™è¨€"}),e.jsxs("p",{className:"text-gray-600 text-sm leading-relaxed",children:["åœ¨èŠå¤©ä¸­è®©AIç”¨ [ç•™è¨€:å†…å®¹] å†™ç•™è¨€",e.jsx("br",{}),"æ¯ä¸€å¥è¯éƒ½æ˜¯çˆ±çš„è¡¨è¾¾"]})]})]})})}):e.jsx("div",{className:"space-y-4 pb-6",children:i.map(t=>e.jsx("div",{className:"glass-card rounded-2xl p-5 border border-white/20 shadow-lg",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full glass-card flex items-center justify-center flex-shrink-0 border border-white/30",children:e.jsx("svg",{className:"w-5 h-5 text-blue-400",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:t.characterName}),e.jsx("span",{className:"text-xs text-gray-500",children:p(t.timestamp)})]}),e.jsx("p",{className:"text-sm text-gray-700 leading-relaxed",children:t.content})]})]})},t.id))})}),x&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm",onClick:()=>m(!1)}),e.jsxs("div",{className:"relative w-full max-w-sm glass-card rounded-3xl p-6 shadow-2xl border border-white/20",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4 text-center",children:"å‘å¸ƒç•™è¨€"}),e.jsx("textarea",{value:h,onChange:e=>u(e.target.value),placeholder:"å†™ä¸‹ä½ æƒ³è¯´çš„è¯...",className:"w-full px-3 py-2 border border-gray-300 rounded-xl resize-none mb-4 text-sm",rows:5,autoFocus:!0}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>m(!1),className:"flex-1 px-4 py-3 rounded-full glass-card border border-white/20 text-gray-900 font-medium ios-button",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:()=>{if(!h.trim())return void alert("è¯·è¾“å…¥ç•™è¨€å†…å®¹");const e=rt();e&&"active"===e.status?(pt(e.characterId,"æˆ‘",h.trim()),u(""),m(!1),g(),alert("ç•™è¨€å·²å‘å¸ƒï¼")):alert("è¯·å…ˆå¼€é€šæƒ…ä¾£ç©ºé—´")},className:"flex-1 px-4 py-3 rounded-full glass-card border border-white/20 text-gray-900 font-medium ios-button",children:"å‘å¸ƒ"})]})]})]})]})]})}},Symbol.toStringTag,{value:"Module"})),ml=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{background:r,getBackgroundStyle:l}=c(),{showStatusBar:n}=o(),[i,d]=t.useState(new Date),[x,m]=t.useState([]),[h,u]=t.useState(null),[g,p]=t.useState(null),f=t.useRef(null);t.useEffect(()=>{j(),b()},[]);const b=()=>{const e=xt();p(e)},j=()=>{const e=mt();m(e)},v=(e,t,s)=>{const a=`${e}-${String(t+1).padStart(2,"0")}-${String(s).padStart(2,"0")}`;return x.filter(e=>e.date===a)},y=h?x.filter(e=>e.date===h):[];return e.jsxs("div",{className:"h-full flex flex-col relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 z-0",style:l()}),e.jsxs("div",{className:"relative z-10 h-full flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-50 "+(r?"glass-dark":"glass-effect"),children:[n&&e.jsx(ua,{}),e.jsxs("div",{className:"flex items-center justify-between px-5 py-4",children:[e.jsx("button",{onClick:()=>a(-1),className:"text-blue-500 ios-button",children:"è¿”å›ž"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"æ—¥åŽ†"}),e.jsx("button",{onClick:()=>{var e;null==(e=f.current)||e.click()},className:"w-8 h-8 rounded-full glass-card border border-white/20 flex items-center justify-center ios-button",title:"è®¾ç½®çºªå¿µæ—¥èƒŒæ™¯",children:e.jsx("svg",{className:"w-4 h-4 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),g&&e.jsx("button",{onClick:()=>{confirm("ç¡®å®šè¦åˆ é™¤çºªå¿µæ—¥èƒŒæ™¯å—ï¼Ÿ")&&(ft(),p(null))},className:"w-8 h-8 rounded-full glass-card border border-red-200/30 flex items-center justify-center ios-button",title:"åˆ é™¤èƒŒæ™¯",children:e.jsx("svg",{className:"w-4 h-4 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("button",{onClick:()=>{d(new Date)},className:"text-blue-500 ios-button text-sm",children:"ä»Šå¤©"})]})]}),e.jsx("input",{ref:f,type:"file",accept:"image/*",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(s){const e=new FileReader;e.onload=e=>{var t;const s=null==(t=e.target)?void 0:t.result;bt(s),p(s),alert("èƒŒæ™¯ä¸Šä¼ æˆåŠŸï¼")},e.readAsDataURL(s)}},className:"hidden"}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-4 pt-4 pb-6",children:[e.jsx("div",{className:"glass-card rounded-2xl p-4 mb-4 border border-white/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:()=>{d(new Date(i.getFullYear(),i.getMonth()-1))},className:"w-10 h-10 flex items-center justify-center ios-button glass-card rounded-full",children:"â†"}),e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:i.toLocaleDateString("zh-CN",{year:"numeric",month:"long"})})}),e.jsx("button",{onClick:()=>{d(new Date(i.getFullYear(),i.getMonth()+1))},className:"w-10 h-10 flex items-center justify-center ios-button glass-card rounded-full",children:"â†’"})]})}),e.jsx("div",{className:"grid grid-cols-7 gap-2 mb-2",children:["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"].map(t=>e.jsx("div",{className:"text-center text-sm text-gray-600 font-semibold",children:t},t))}),e.jsx("div",{className:"grid grid-cols-7 gap-2",children:(()=>{const t=(s=i,new Date(s.getFullYear(),s.getMonth()+1,0).getDate());var s;const a=(e=>new Date(e.getFullYear(),e.getMonth(),1).getDay())(i),r=i.getFullYear(),l=i.getMonth(),n=[],c=new Date,o=r===c.getFullYear()&&l===c.getMonth();for(let i=0;i<a;i++)n.push(e.jsx("div",{className:"aspect-square"},`empty-${i}`));for(let i=1;i<=t;i++){const t=`${r}-${String(l+1).padStart(2,"0")}-${String(i).padStart(2,"0")}`,s=v(r,l,i),a=o&&i===c.getDate(),d=s.length>0;n.push(e.jsxs("div",{className:"aspect-square flex flex-col items-center justify-center rounded-lg cursor-pointer transition-all "+(a?"bg-blue-500 text-white font-bold":d?"glass-card border-2 border-pink-400 font-semibold":"glass-card hover:scale-105"),onClick:()=>{d&&u(t)},children:[e.jsx("span",{className:"text-sm",children:i}),d&&e.jsx("div",{className:"flex gap-0.5 mt-1",children:s.slice(0,3).map((t,s)=>e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-pink-500"},s))})]},i))}return n})()}),x.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-3",children:"å³å°†åˆ°æ¥çš„çºªå¿µæ—¥"}),e.jsx("div",{className:"space-y-2",children:x.filter(e=>ht(e.date)>=0).slice(0,5).map(t=>{const s=ht(t.date);return e.jsx("div",{className:"glass-card rounded-xl p-3 border border-white/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-900",children:t.title}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:t.date})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"text-sm font-bold "+(0===s?"text-pink-500":"text-gray-700"),children:0===s?"ä»Šå¤©":`${s}å¤©åŽ`})})]})},t.id)})})]})]}),h&&y.length>0&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm",onClick:()=>u(null)}),e.jsxs("div",{className:"relative w-full max-w-sm glass-card rounded-3xl p-6 shadow-2xl border border-white/20",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4 text-center",children:h}),e.jsx("div",{className:"space-y-3 mb-4",children:y.map(t=>e.jsxs("div",{className:"glass-card rounded-xl p-4 border border-white/20",children:[e.jsx("div",{className:"font-bold text-gray-900 mb-1",children:t.title}),t.description&&e.jsx("div",{className:"text-sm text-gray-600",children:t.description}),e.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:[t.characterName," åˆ›å»º"]})]},t.id))}),e.jsx("button",{onClick:()=>u(null),className:"w-full px-4 py-3 rounded-full glass-card border border-white/20 text-gray-900 font-medium ios-button",children:"å…³é—­"})]})]})]})]})}},Symbol.toStringTag,{value:"Module"})),hl=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{var a,l,i;const c=s(),{showStatusBar:d}=o(),{characters:x}=n(),{getAIStatus:m,getTodayTrack:h}=v(),{characterId:u}=r(),g=x.find(e=>e.id===u)||x[0],p=m((null==g?void 0:g.id)||""),f=h((null==g?void 0:g.id)||""),[b,j]=t.useState(null);t.useEffect(()=>{const e=()=>{const e=localStorage.getItem(`life_config_${null==g?void 0:g.id}`);e&&j(JSON.parse(e))};e();const t=()=>e();return window.addEventListener("lifeConfigUpdate",t),()=>window.removeEventListener("lifeConfigUpdate",t)},[null==g?void 0:g.id]);const y=e=>{if(0===e)return"åˆšåˆ°";const t=Math.floor(e/60),s=e%60;return t>0?s>0?`${t}å°æ—¶${s}åˆ†é’Ÿ`:`${t}å°æ—¶`:`${s}åˆ†é’Ÿ`};return e.jsxs("div",{className:"h-full flex flex-col relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 z-0 bg-gradient-to-b from-blue-50 to-white"}),e.jsxs("div",{className:"relative z-10 h-full flex flex-col",children:[e.jsxs("div",{className:"glass-effect sticky top-0 z-50",children:[d&&e.jsx(ua,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center",children:[e.jsx("button",{onClick:()=>c(-1),className:"w-10 h-10 rounded-full glass-card flex items-center justify-center ios-button",children:e.jsx(os,{size:20,className:"text-gray-700"})}),e.jsx("div",{className:"flex-1 text-center",children:e.jsxs("h1",{className:"text-lg font-semibold text-gray-900",children:[null==g?void 0:g.name,"çš„è¶³è¿¹"]})}),e.jsx("button",{onClick:()=>c(`/life-settings/${null==g?void 0:g.id}`),className:"w-10 h-10 rounded-full glass-card flex items-center justify-center ios-button",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M12 15l9-9-9-9m0 18l-9-9 9-9"}),e.jsx("circle",{cx:"12",cy:"12",r:"3"}),e.jsx("path",{d:"M12 1v6m0 6v6m6-6h6m-6 0H6"})]})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar pb-6",children:[e.jsx("div",{className:"px-4 pt-4 pb-6",children:e.jsxs("div",{className:"glass-card rounded-3xl p-6 text-center",children:[e.jsx("img",{src:null==g?void 0:g.avatar,alt:null==g?void 0:g.name,className:"w-24 h-24 rounded-full mx-auto mb-4 border-4 border-white shadow-lg"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 mb-2",children:null==g?void 0:g.name}),e.jsx("div",{className:"text-sm text-gray-500",children:p.mood})]})}),e.jsx("div",{className:"px-4 mb-6",children:e.jsxs("div",{className:"glass-card rounded-3xl p-6",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4",children:"å®žæ—¶çŠ¶æ€"}),e.jsxs("div",{className:"flex items-start gap-3 mb-4 pb-4 border-b border-gray-100",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl glass-card flex items-center justify-center flex-shrink-0",children:e.jsx($s,{size:20,className:"text-blue-500"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"å½“å‰ä½ç½®"}),e.jsx("div",{className:"text-base font-semibold text-gray-900",children:p.location}),e.jsx("div",{className:"text-xs text-blue-500 mt-1",children:p.activity})]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4 pb-4 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl glass-card flex items-center justify-center",children:e.jsx("div",{className:"w-3 h-3 rounded-full "+(p.isOnline?"bg-green-500":"bg-gray-400")})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"æ‰‹æœºçŠ¶æ€"}),e.jsx("div",{className:"text-base font-semibold text-gray-900",children:p.screenOn?"å±å¹•äº®ç€":"æ¯å±ä¸­"})]})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["æ­£åœ¨ä½¿ç”¨: ",p.currentApp]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4 pb-4 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl glass-card flex items-center justify-center",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[e.jsx("rect",{x:"4",y:"7",width:"13",height:"11",rx:"2",stroke:"currentColor",strokeWidth:"2",className:p.battery<20?"text-red-500":"text-green-500"}),e.jsx("rect",{x:"6",y:"9",width:""+p.battery/100*9,height:"7",rx:"1",fill:"currentColor",className:p.battery<20?"text-red-500":"text-green-500"}),e.jsx("path",{d:"M17 10v5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",className:"text-gray-400"})]})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"æ‰‹æœºç”µé‡"}),e.jsxs("div",{className:"text-base font-semibold text-gray-900",children:[p.battery,"%"]})]})]}),p.isCharging&&e.jsxs("div",{className:"text-xs text-green-500 flex items-center gap-1",children:[e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M13 2L3 14h8l-1 8 10-12h-8l1-8z"})}),"å……ç”µä¸­"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl glass-card flex items-center justify-center",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M14 16c0 1.1.9 2 2 2s2-.9 2-2-.9-2-2-2-2 .9-2 2zM6 16c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2z"})})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"ä»Šæ—¥æ­¥æ•°"}),e.jsxs("div",{className:"text-base font-semibold text-gray-900",children:[p.steps.toLocaleString()," æ­¥"]})]})]})]})}),e.jsx("div",{className:"px-4 mb-6",children:e.jsxs("div",{className:"glass-card rounded-3xl p-6",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4",children:"ä»Šæ—¥è½¨è¿¹"}),e.jsx("div",{className:"space-y-4",children:f.map((t,s)=>e.jsxs("div",{className:"flex items-start gap-3 relative",children:[s<f.length-1&&e.jsx("div",{className:"absolute left-6 top-12 w-0.5 h-16 bg-gradient-to-b from-blue-300 to-transparent"}),e.jsx("div",{className:"w-16 text-sm text-gray-500 pt-2",children:t.time}),e.jsx("div",{className:"w-4 h-4 rounded-full flex-shrink-0 mt-2 "+(s===f.length-1?"bg-blue-500 ring-4 ring-blue-100":"bg-gray-300")}),e.jsxs("div",{className:"flex-1 glass-card rounded-2xl p-4",children:[e.jsx("div",{className:"font-semibold text-gray-900 mb-1",children:t.location}),e.jsx("div",{className:"text-sm text-gray-500",children:t.activity}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["åœç•™ ",y(t.duration)]})]})]},t.id))})]})}),e.jsx("div",{className:"px-4 mb-6",children:e.jsxs("div",{className:"glass-card rounded-3xl p-6",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4",children:"ä½œæ¯è§„å¾‹"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"é€šå¸¸èµ·åºŠæ—¶é—´"}),e.jsx("div",{className:"text-base font-semibold text-gray-900",children:(null==(a=null==b?void 0:b.routineTime)?void 0:a.wakeUp)||"07:30"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"é€šå¸¸ç¡è§‰æ—¶é—´"}),e.jsx("div",{className:"text-base font-semibold text-gray-900",children:(null==(l=null==b?void 0:b.routineTime)?void 0:l.sleep)||"23:00"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"åˆé¤æ—¶é—´"}),e.jsx("div",{className:"text-base font-semibold text-gray-900",children:(null==(i=null==b?void 0:b.routineTime)?void 0:i.lunch)||"12:00"})]})]})]})}),e.jsx("div",{className:"px-4",children:e.jsxs("div",{className:"glass-card rounded-3xl p-6",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4",children:"å¸¸åŽ»åœ°ç‚¹"}),e.jsx("div",{className:"space-y-3",children:((null==b?void 0:b.frequentPlaces)||[{name:"å®¶",address:"æ¨æµ¦åŒºæŸæŸè·¯123å·",frequency:"æ¯å¤©"},{name:"å…¬å¸",address:"æµ¦ä¸œæ–°åŒºé™†å®¶å˜´é‡‘èžä¸­å¿ƒ",frequency:"å·¥ä½œæ—¥"},{name:"æ˜Ÿå·´å…‹",address:"äº”è§’åœºä¸‡è¾¾å¹¿åœº",frequency:"å‘¨2-3æ¬¡"},{name:"å¥èº«æˆ¿",address:"é™„è¿‘å¥èº«ä¸­å¿ƒ",frequency:"å‘¨2æ¬¡"}]).map((t,s)=>e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-xl bg-white/50",children:[e.jsx($s,{size:20,className:"text-blue-500 mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-900",children:t.name}),e.jsx("div",{className:"text-xs text-gray-500",children:t.address})]}),e.jsx("div",{className:"text-xs text-gray-400",children:t.frequency})]},s))})]})})]})]})]})}},Symbol.toStringTag,{value:"Module"})),ul=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),[l,n]=t.useState(""),[i,c]=t.useState("all"),[d,x]=t.useState([]),[m,h]=t.useState(!1),[u,g]=t.useState({meme:"",meaning:"",keywords:""});t.useEffect(()=>{p()},[]);const p=()=>{const e=localStorage.getItem("custom_memes");if(e)try{x(JSON.parse(e))}catch(t){}},f=e=>{localStorage.setItem("custom_memes",JSON.stringify(e)),x(e)},b=()=>[...vt,...d],j=(()=>{let e=b();if(l){const t=l.toLowerCase();e=e.filter(e=>e.æ¢—.toLowerCase().includes(t)||e.å«ä¹‰.toLowerCase().includes(t)||e.keywords.some(e=>e.toLowerCase().includes(t)))}return"all"!==i&&(e=e.filter(e=>e.keywords.some(e=>e.includes(i)))),e})(),v=b().map(e=>({...e,usageCount:jt(e.id)})).filter(e=>e.usageCount>0).sort((e,t)=>t.usageCount-e.usageCount).slice(0,5),y=(()=>{const e=new Set;return b().forEach(t=>{t.keywords.forEach(t=>{t.length<=4&&e.add(t)})}),Array.from(e).slice(0,20)})();return e.jsxs("div",{className:"h-full flex flex-col bg-gray-50",children:[r&&e.jsx(ua,{}),e.jsxs("div",{className:"glass-effect px-4 py-3 border-b border-gray-200/50 flex items-center",children:[e.jsx("button",{onClick:()=>a(-1),className:"w-8 h-8 flex items-center justify-center ios-button",children:e.jsx("span",{className:"text-blue-500 text-xl",children:"â€¹"})}),e.jsx("h1",{className:"flex-1 text-center text-lg font-semibold text-gray-900",children:"çƒ­æ¢—åº“"}),e.jsx("button",{onClick:()=>h(!0),className:"w-8 h-8 flex items-center justify-center ios-button",children:e.jsx("span",{className:"text-blue-500 text-xl",children:"+"})})]}),e.jsx("div",{className:"px-4 pt-4 pb-3",children:e.jsxs("div",{className:"glass-card rounded-2xl px-4 py-3.5 flex items-center",children:[e.jsxs("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("path",{d:"m21 21-4.35-4.35"})]}),e.jsx("input",{type:"text",placeholder:"æœç´¢çƒ­æ¢—ã€å«ä¹‰æˆ–å…³é”®è¯",value:l,onChange:e=>n(e.target.value),className:"flex-1 ml-3 bg-transparent border-none outline-none text-sm text-gray-900 placeholder-gray-400"}),l&&e.jsx("button",{onClick:()=>n(""),className:"text-gray-400 text-lg ios-button",children:"âœ•"})]})}),v.length>0&&!l&&e.jsxs("div",{className:"px-4 pb-3",children:[e.jsx("div",{className:"text-xs font-bold text-gray-600 mb-2.5 px-1",children:"æœ€å¸¸ä½¿ç”¨"}),e.jsx("div",{className:"flex gap-2.5 overflow-x-auto hide-scrollbar",children:v.map(t=>e.jsxs("div",{className:"flex-shrink-0 glass-card rounded-xl px-4 py-3 border border-orange-200/30",children:[e.jsx("div",{className:"text-sm font-bold text-gray-900 whitespace-nowrap mb-1",children:t.æ¢—}),e.jsxs("div",{className:"text-xs text-orange-600 font-medium",children:["ä½¿ç”¨ ",t.usageCount," æ¬¡"]})]},t.id))})]}),e.jsx("div",{className:"px-4 pb-3",children:e.jsxs("div",{className:"flex gap-2 overflow-x-auto hide-scrollbar",children:[e.jsx("button",{onClick:()=>c("all"),className:"flex-shrink-0 px-4 py-2.5 rounded-xl text-sm font-semibold transition-all "+("all"===i?"glass-card text-blue-600 shadow-sm":"bg-white/50 text-gray-600"),children:"å…¨éƒ¨"}),y.map(t=>e.jsx("button",{onClick:()=>c(t),className:"flex-shrink-0 px-4 py-2.5 rounded-xl text-sm font-semibold transition-all "+(i===t?"glass-card text-blue-600 shadow-sm":"bg-white/50 text-gray-600"),children:t},t))]})}),e.jsx("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-4 pb-4",children:0===j.length?e.jsx("div",{className:"glass-card rounded-2xl p-8 text-center",children:e.jsx("div",{className:"text-gray-500 text-sm",children:"æ²¡æœ‰æ‰¾åˆ°ç›¸å…³çƒ­æ¢—"})}):e.jsxs("div",{className:"space-y-2",children:[j.map(t=>{const s=jt(t.id),a=(r=t.id,d.some(e=>e.id===r));var r;return e.jsxs("div",{className:"glass-card rounded-2xl p-5",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:t.æ¢—}),a&&e.jsx("span",{className:"px-2.5 py-0.5 bg-green-100 text-green-700 text-xs rounded-lg font-medium",children:"è‡ªå®šä¹‰"})]}),e.jsx("p",{className:"text-sm text-gray-600 leading-relaxed",children:t.å«ä¹‰})]}),a&&e.jsx("button",{onClick:()=>(e=>{confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªçƒ­æ¢—å—ï¼Ÿ")&&f(d.filter(t=>t.id!==e))})(t.id),className:"ml-3 text-red-500 text-sm ios-button font-medium",children:"åˆ é™¤"})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-3 border-t border-gray-100",children:[e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[t.keywords.slice(0,5).map((t,s)=>e.jsx("span",{className:"px-2.5 py-1 bg-blue-50 text-blue-600 text-xs rounded-lg font-medium",children:t},s)),t.keywords.length>5&&e.jsxs("span",{className:"px-2 py-1 text-gray-400 text-xs",children:["+",t.keywords.length-5]})]}),s>0&&e.jsxs("div",{className:"text-xs text-gray-500 font-medium ml-2",children:["ä½¿ç”¨ ",s," æ¬¡"]})]})]},t.id)}),e.jsxs("div",{className:"text-center py-4 text-xs text-gray-400",children:["å…± ",j.length," ä¸ªçƒ­æ¢—"]})]})}),m&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"glass-card rounded-3xl p-6 w-full max-w-md",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4",children:"æ·»åŠ è‡ªå®šä¹‰çƒ­æ¢—"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"çƒ­æ¢—å†…å®¹"}),e.jsx("input",{type:"text",value:u.meme,onChange:e=>g({...u,meme:e.target.value}),placeholder:"ä¾‹å¦‚ï¼šå°Šå˜Ÿå‡å˜Ÿ",className:"w-full glass-card rounded-xl px-4 py-3 text-sm text-gray-900 border-none outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"å«ä¹‰è¯´æ˜Ž"}),e.jsx("textarea",{value:u.meaning,onChange:e=>g({...u,meaning:e.target.value}),placeholder:"ä¾‹å¦‚ï¼šçœŸçš„å‡çš„",rows:3,className:"w-full glass-card rounded-xl px-4 py-3 text-sm text-gray-900 border-none outline-none resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"å…³é”®è¯ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰"}),e.jsx("input",{type:"text",value:u.keywords,onChange:e=>g({...u,keywords:e.target.value}),placeholder:"ä¾‹å¦‚ï¼šçœŸçš„å‡çš„,å°Šå˜Ÿå‡å˜Ÿ,éœ‡æƒŠ",className:"w-full glass-card rounded-xl px-4 py-3 text-sm text-gray-900 border-none outline-none"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>{h(!1),g({meme:"",meaning:"",keywords:""})},className:"flex-1 glass-card rounded-xl py-3 text-sm font-medium text-gray-700 ios-button",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:()=>{if(!u.meme||!u.meaning||!u.keywords)return void alert("è¯·å¡«å†™å®Œæ•´ä¿¡æ¯");const e=u.keywords.split(/[,ï¼Œ\s]+/).filter(e=>e.trim()),t={id:Math.max(...b().map(e=>e.id),0)+1,"æ¢—":u.meme,"å«ä¹‰":u.meaning,keywords:e};f([...d,t]),g({meme:"",meaning:"",keywords:""}),h(!1)},className:"flex-1 bg-blue-500 text-white rounded-xl py-3 text-sm font-medium ios-button",children:"æ·»åŠ "})]})]})})]})}},Symbol.toStringTag,{value:"Module"})),gl=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),[l,n]=t.useState(null),[i,c]=t.useState(null),[d,x]=t.useState("#95EC69"),[m,h]=t.useState("#FFFFFF"),u=[{id:"glass",name:"é«˜çº§çŽ»ç’ƒ",description:"æ¯›çŽ»ç’ƒæ•ˆæžœ",userCSS:".message-container.sent .message-bubble {\n  background: linear-gradient(135deg, rgba(149, 236, 105, 0.95) 0%, rgba(120, 220, 80, 0.95) 100%) !important;\n  backdrop-filter: blur(20px) saturate(180%) !important;\n  -webkit-backdrop-filter: blur(20px) saturate(180%) !important;\n  border: 1.5px solid rgba(255, 255, 255, 0.6) !important;\n  box-shadow: \n    0 8px 32px rgba(149, 236, 105, 0.3),\n    inset 0 1px 0 rgba(255, 255, 255, 0.8),\n    inset 0 -1px 0 rgba(0, 0, 0, 0.1) !important;\n  border-radius: 18px !important;\n  position: relative !important;\n}\n.message-container.sent .message-bubble::before {\n  content: '' !important;\n  position: absolute !important;\n  top: 0 !important;\n  left: 0 !important;\n  right: 0 !important;\n  height: 50% !important;\n  background: linear-gradient(180deg, rgba(255, 255, 255, 0.3) 0%, transparent 100%) !important;\n  border-radius: 18px 18px 0 0 !important;\n  pointer-events: none !important;\n}",aiCSS:".message-container.received .message-bubble {\n  background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(245, 245, 250, 0.95) 100%) !important;\n  backdrop-filter: blur(20px) saturate(180%) !important;\n  -webkit-backdrop-filter: blur(20px) saturate(180%) !important;\n  border: 1.5px solid rgba(200, 200, 220, 0.4) !important;\n  box-shadow: \n    0 8px 32px rgba(0, 0, 0, 0.08),\n    inset 0 1px 0 rgba(255, 255, 255, 0.9),\n    inset 0 -1px 0 rgba(0, 0, 0, 0.05) !important;\n  border-radius: 18px !important;\n  position: relative !important;\n}\n.message-container.received .message-bubble::before {\n  content: '' !important;\n  position: absolute !important;\n  top: 0 !important;\n  left: 0 !important;\n  right: 0 !important;\n  height: 50% !important;\n  background: linear-gradient(180deg, rgba(255, 255, 255, 0.4) 0%, transparent 100%) !important;\n  border-radius: 18px 18px 0 0 !important;\n  pointer-events: none !important;\n}",preview:{user:{background:"linear-gradient(135deg, rgba(149, 236, 105, 0.95) 0%, rgba(120, 220, 80, 0.95) 100%)",backdropFilter:"blur(20px) saturate(180%)",border:"1.5px solid rgba(255, 255, 255, 0.6)",boxShadow:"0 8px 32px rgba(149, 236, 105, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.8)"},ai:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(245, 245, 250, 0.95) 100%)",backdropFilter:"blur(20px) saturate(180%)",border:"1.5px solid rgba(200, 200, 220, 0.4)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.08), inset 0 1px 0 rgba(255, 255, 255, 0.9)"}}},{id:"clay",name:"3Dç²˜åœŸ",description:"ç«‹ä½“æ•ˆæžœ",userCSS:".message-container.sent .message-bubble {\n  background: linear-gradient(145deg, #E8F5E9 0%, #C8E6C9 50%, #F1F8E9 100%) !important;\n  border-radius: 22px !important;\n  box-shadow: \n    0 2px 4px rgba(129, 199, 132, 0.3),\n    0 8px 16px rgba(129, 199, 132, 0.25),\n    0 16px 32px rgba(100, 180, 100, 0.15),\n    inset 0 2px 4px rgba(255, 255, 255, 0.8),\n    inset 0 -3px 8px rgba(100, 180, 100, 0.2) !important;\n  border: 2px solid rgba(255, 255, 255, 0.7) !important;\n  padding: 14px 18px !important;\n  position: relative !important;\n  transform: translateZ(0) !important;\n}\n.message-container.sent .message-bubble::after {\n  content: '' !important;\n  position: absolute !important;\n  top: 3px !important;\n  left: 3px !important;\n  right: 3px !important;\n  height: 40% !important;\n  background: linear-gradient(180deg, rgba(255, 255, 255, 0.4) 0%, transparent 100%) !important;\n  border-radius: 20px 20px 0 0 !important;\n  pointer-events: none !important;\n}",aiCSS:".message-container.received .message-bubble {\n  background: linear-gradient(145deg, #E3F2FD 0%, #BBDEFB 50%, #E1F5FE 100%) !important;\n  border-radius: 22px !important;\n  box-shadow: \n    0 2px 4px rgba(100, 181, 246, 0.3),\n    0 8px 16px rgba(100, 181, 246, 0.25),\n    0 16px 32px rgba(66, 165, 245, 0.15),\n    inset 0 2px 4px rgba(255, 255, 255, 0.8),\n    inset 0 -3px 8px rgba(66, 165, 245, 0.2) !important;\n  border: 2px solid rgba(255, 255, 255, 0.7) !important;\n  padding: 14px 18px !important;\n  position: relative !important;\n  transform: translateZ(0) !important;\n}\n.message-container.received .message-bubble::after {\n  content: '' !important;\n  position: absolute !important;\n  top: 3px !important;\n  left: 3px !important;\n  right: 3px !important;\n  height: 40% !important;\n  background: linear-gradient(180deg, rgba(255, 255, 255, 0.4) 0%, transparent 100%) !important;\n  border-radius: 20px 20px 0 0 !important;\n  pointer-events: none !important;\n}",preview:{user:{background:"linear-gradient(145deg, #E8F5E9 0%, #C8E6C9 50%, #F1F8E9 100%)",boxShadow:"0 2px 4px rgba(129, 199, 132, 0.3), 0 8px 16px rgba(129, 199, 132, 0.25), inset 0 2px 4px rgba(255, 255, 255, 0.8)",border:"2px solid rgba(255, 255, 255, 0.7)",padding:"14px 18px"},ai:{background:"linear-gradient(145deg, #E3F2FD 0%, #BBDEFB 50%, #E1F5FE 100%)",boxShadow:"0 2px 4px rgba(100, 181, 246, 0.3), 0 8px 16px rgba(100, 181, 246, 0.25), inset 0 2px 4px rgba(255, 255, 255, 0.8)",border:"2px solid rgba(255, 255, 255, 0.7)",padding:"14px 18px"}}},{id:"feather",name:"æ¢¦å¹»å…‰æ™•",description:"å‘å…‰æ•ˆæžœ",userCSS:".message-container.sent .message-bubble {\n  background: \n    radial-gradient(circle at 30% 30%, rgba(255, 240, 248, 1) 0%, transparent 70%),\n    linear-gradient(135deg, #FFD6E8 0%, #FFE5F0 50%, #FFF0F8 100%) !important;\n  border: 0 !important;\n  box-shadow: \n    0 0 1px rgba(255, 182, 217, 0.3),\n    0 2px 8px rgba(255, 182, 217, 0.2),\n    0 8px 24px rgba(255, 182, 217, 0.3),\n    0 16px 48px rgba(255, 150, 200, 0.2),\n    inset 0 1px 2px rgba(255, 255, 255, 0.8) !important;\n  border-radius: 26px !important;\n  padding: 14px 18px !important;\n  position: relative !important;\n  overflow: visible !important;\n}\n.message-container.sent .message-bubble::before {\n  content: '' !important;\n  position: absolute !important;\n  inset: -8px !important;\n  background: radial-gradient(circle, rgba(255, 182, 217, 0.15) 0%, transparent 70%) !important;\n  border-radius: 34px !important;\n  pointer-events: none !important;\n  z-index: -1 !important;\n}",aiCSS:".message-container.received .message-bubble {\n  background: \n    radial-gradient(circle at 30% 30%, rgba(240, 248, 255, 1) 0%, transparent 70%),\n    linear-gradient(135deg, #D6E8FF 0%, #E5F5FF 50%, #F0F8FF 100%) !important;\n  border: 0 !important;\n  box-shadow: \n    0 0 1px rgba(182, 217, 255, 0.3),\n    0 2px 8px rgba(182, 217, 255, 0.2),\n    0 8px 24px rgba(182, 217, 255, 0.3),\n    0 16px 48px rgba(150, 200, 255, 0.2),\n    inset 0 1px 2px rgba(255, 255, 255, 0.8) !important;\n  border-radius: 26px !important;\n  padding: 14px 18px !important;\n  position: relative !important;\n  overflow: visible !important;\n}\n.message-container.received .message-bubble::before {\n  content: '' !important;\n  position: absolute !important;\n  inset: -8px !important;\n  background: radial-gradient(circle, rgba(182, 217, 255, 0.15) 0%, transparent 70%) !important;\n  border-radius: 34px !important;\n  pointer-events: none !important;\n  z-index: -1 !important;\n}",preview:{user:{background:"linear-gradient(135deg, #FFD6E8 0%, #FFE5F0 50%, #FFF0F8 100%)",boxShadow:"0 0 1px rgba(255, 182, 217, 0.3), 0 2px 8px rgba(255, 182, 217, 0.2), 0 8px 24px rgba(255, 182, 217, 0.3)",padding:"14px 18px"},ai:{background:"linear-gradient(135deg, #D6E8FF 0%, #E5F5FF 50%, #F0F8FF 100%)",boxShadow:"0 0 1px rgba(182, 217, 255, 0.3), 0 2px 8px rgba(182, 217, 255, 0.2), 0 8px 24px rgba(182, 217, 255, 0.3)",padding:"14px 18px"}}},{id:"soft",name:"äº‘é›¾æ‰©æ•£",description:"è½¯è¾¹ç•Œæ•ˆæžœ",userCSS:".message-container.sent .message-bubble {\n  position: relative !important;\n  border: 0 !important;\n  outline: 0 !important;\n  background: \n    radial-gradient(ellipse at center, rgba(255, 248, 225, 0.95) 0%, rgba(255, 245, 225, 0.8) 50%, rgba(255, 240, 220, 0.5) 80%, transparent 100%) !important;\n  box-shadow: \n    0 0 0 6px rgba(255, 245, 225, 0.35),\n    0 0 0 12px rgba(255, 240, 220, 0.18),\n    0 2px 12px rgba(255, 230, 200, 0.25) !important;\n  border-radius: 18px !important;\n  padding: 14px 18px !important;\n  overflow: visible !important;\n}",aiCSS:".message-container.received .message-bubble {\n  position: relative !important;\n  border: 0 !important;\n  outline: 0 !important;\n  background: \n    radial-gradient(ellipse at center, rgba(240, 248, 255, 0.95) 0%, rgba(235, 245, 255, 0.8) 50%, rgba(225, 240, 255, 0.5) 80%, transparent 100%) !important;\n  box-shadow: \n    0 0 0 6px rgba(240, 248, 255, 0.35),\n    0 0 0 12px rgba(225, 240, 255, 0.18),\n    0 2px 12px rgba(200, 230, 255, 0.25) !important;\n  border-radius: 18px !important;\n  padding: 14px 18px !important;\n  overflow: visible !important;\n}",preview:{user:{background:"radial-gradient(ellipse at center, rgba(255, 248, 225, 0.95) 0%, rgba(255, 245, 225, 0.8) 50%, rgba(255, 240, 220, 0.5) 80%, transparent 100%)",boxShadow:"0 0 0 6px rgba(255, 245, 225, 0.35), 0 0 0 12px rgba(255, 240, 220, 0.18)",padding:"14px 18px",borderRadius:"18px"},ai:{background:"radial-gradient(ellipse at center, rgba(240, 248, 255, 0.95) 0%, rgba(235, 245, 255, 0.8) 50%, rgba(225, 240, 255, 0.5) 80%, transparent 100%)",boxShadow:"0 0 0 6px rgba(240, 248, 255, 0.35), 0 0 0 12px rgba(225, 240, 255, 0.18)",padding:"14px 18px",borderRadius:"18px"}}},{id:"water",name:"æ°´æ»´æ°”æ³¡",description:"é€æ˜Žæ•ˆæžœ",userCSS:".message-container.sent .message-bubble {\n  background: \n    linear-gradient(180deg, rgba(255, 255, 255, 0.02) 0%, rgba(255, 255, 255, 0.03) 30%, rgba(149, 236, 105, 0.15) 100%),\n    radial-gradient(circle at 30% 20%, rgba(255, 255, 255, 0.6) 0%, transparent 40%) !important;\n  border: 1px solid rgba(255, 255, 255, 0.25) !important;\n  border-radius: 20px !important;\n  padding: 12px 16px !important;\n  position: relative !important;\n  box-shadow: \n    0 4px 15px rgba(149, 236, 105, 0.08),\n    inset 0 1px 3px rgba(255, 255, 255, 0.9),\n    inset 0 -2px 4px rgba(149, 236, 105, 0.15) !important;\n  backdrop-filter: blur(16px) saturate(180%) !important;\n  -webkit-backdrop-filter: blur(16px) saturate(180%) !important;\n}\n.message-container.sent .message-bubble::before {\n  content: '' !important;\n  position: absolute !important;\n  top: 8px !important;\n  left: 10px !important;\n  width: 20px !important;\n  height: 20px !important;\n  background: radial-gradient(circle at 40% 40%, rgba(255, 255, 255, 0.9) 0%, transparent 70%) !important;\n  border-radius: 50% !important;\n  pointer-events: none !important;\n}\n.message-container.sent .message-bubble::after {\n  content: '' !important;\n  position: absolute !important;\n  bottom: 10px !important;\n  right: 12px !important;\n  width: 12px !important;\n  height: 12px !important;\n  background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.7) 0%, transparent 70%) !important;\n  border-radius: 50% !important;\n  pointer-events: none !important;\n}",aiCSS:".message-container.received .message-bubble {\n  background: \n    linear-gradient(180deg, rgba(255, 255, 255, 0.02) 0%, rgba(255, 255, 255, 0.03) 30%, rgba(200, 230, 255, 0.15) 100%),\n    radial-gradient(circle at 30% 20%, rgba(255, 255, 255, 0.6) 0%, transparent 40%) !important;\n  border: 1px solid rgba(255, 255, 255, 0.25) !important;\n  border-radius: 20px !important;\n  padding: 12px 16px !important;\n  position: relative !important;\n  box-shadow: \n    0 4px 15px rgba(100, 150, 200, 0.08),\n    inset 0 1px 3px rgba(255, 255, 255, 0.9),\n    inset 0 -2px 4px rgba(200, 230, 255, 0.15) !important;\n  backdrop-filter: blur(16px) saturate(180%) !important;\n  -webkit-backdrop-filter: blur(16px) saturate(180%) !important;\n}\n.message-container.received .message-bubble::before {\n  content: '' !important;\n  position: absolute !important;\n  top: 8px !important;\n  left: 10px !important;\n  width: 20px !important;\n  height: 20px !important;\n  background: radial-gradient(circle at 40% 40%, rgba(255, 255, 255, 0.95) 0%, transparent 70%) !important;\n  border-radius: 50% !important;\n  pointer-events: none !important;\n}\n.message-container.received .message-bubble::after {\n  content: '' !important;\n  position: absolute !important;\n  bottom: 10px !important;\n  right: 12px !important;\n  width: 12px !important;\n  height: 12px !important;\n  background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.8) 0%, transparent 70%) !important;\n  border-radius: 50% !important;\n  pointer-events: none !important;\n}",preview:{user:{background:"linear-gradient(180deg, rgba(255, 255, 255, 0.02) 0%, rgba(255, 255, 255, 0.03) 30%, rgba(149, 236, 105, 0.15) 100%)",border:"1px solid rgba(255, 255, 255, 0.25)",boxShadow:"0 4px 15px rgba(149, 236, 105, 0.08), inset 0 1px 3px rgba(255, 255, 255, 0.9)",backdropFilter:"blur(16px)",padding:"12px 16px"},ai:{background:"linear-gradient(180deg, rgba(255, 255, 255, 0.02) 0%, rgba(255, 255, 255, 0.03) 30%, rgba(200, 230, 255, 0.15) 100%)",border:"1px solid rgba(255, 255, 255, 0.25)",boxShadow:"0 4px 15px rgba(100, 150, 200, 0.08), inset 0 1px 3px rgba(255, 255, 255, 0.9)",backdropFilter:"blur(16px)",padding:"12px 16px"}}},{id:"glass-dome",name:"çŽ»ç’ƒç½©",description:"åœ†å½¢æ•ˆæžœ",userCSS:".message-container.sent .message-bubble {\n  background: transparent !important;\n  border: 2px solid rgba(255, 255, 255, 0.3) !important;\n  border-radius: 24px !important;\n  padding: 14px 20px !important;\n  position: relative !important;\n  box-shadow: \n    0 8px 32px rgba(0, 0, 0, 0.08),\n    0 4px 16px rgba(0, 0, 0, 0.04),\n    inset 0 1px 0 rgba(255, 255, 255, 0.6),\n    inset 0 -1px 0 rgba(0, 0, 0, 0.05) !important;\n  backdrop-filter: blur(10px) !important;\n  -webkit-backdrop-filter: blur(10px) !important;\n  overflow: hidden !important;\n}\n.message-container.sent .message-bubble::before {\n  content: '' !important;\n  position: absolute !important;\n  top: 0 !important;\n  left: 0 !important;\n  right: 0 !important;\n  height: 50% !important;\n  background: linear-gradient(180deg, rgba(255, 255, 255, 0.1) 0%, transparent 100%) !important;\n  pointer-events: none !important;\n}\n.message-container.sent .message-bubble::after {\n  content: '' !important;\n  position: absolute !important;\n  top: 8px !important;\n  left: 12px !important;\n  width: 50px !important;\n  height: 50px !important;\n  background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.3) 0%, transparent 70%) !important;\n  border-radius: 50% !important;\n  pointer-events: none !important;\n}",aiCSS:".message-container.received .message-bubble {\n  background: transparent !important;\n  border: 2px solid rgba(255, 255, 255, 0.3) !important;\n  border-radius: 24px !important;\n  padding: 14px 20px !important;\n  position: relative !important;\n  box-shadow: \n    0 8px 32px rgba(0, 0, 0, 0.08),\n    0 4px 16px rgba(0, 0, 0, 0.04),\n    inset 0 1px 0 rgba(255, 255, 255, 0.6),\n    inset 0 -1px 0 rgba(0, 0, 0, 0.05) !important;\n  backdrop-filter: blur(10px) !important;\n  -webkit-backdrop-filter: blur(10px) !important;\n  overflow: hidden !important;\n}\n.message-container.received .message-bubble::before {\n  content: '' !important;\n  position: absolute !important;\n  top: 0 !important;\n  left: 0 !important;\n  right: 0 !important;\n  height: 50% !important;\n  background: linear-gradient(180deg, rgba(255, 255, 255, 0.1) 0%, transparent 100%) !important;\n  pointer-events: none !important;\n}\n.message-container.received .message-bubble::after {\n  content: '' !important;\n  position: absolute !important;\n  top: 8px !important;\n  left: 12px !important;\n  width: 50px !important;\n  height: 50px !important;\n  background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.3) 0%, transparent 70%) !important;\n  border-radius: 50% !important;\n  pointer-events: none !important;\n}",preview:{user:{background:"transparent",border:"2px solid rgba(255, 255, 255, 0.3)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.08), inset 0 1px 0 rgba(255, 255, 255, 0.6)",backdropFilter:"blur(10px)",borderRadius:"24px",padding:"14px 20px"},ai:{background:"transparent",border:"2px solid rgba(255, 255, 255, 0.3)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.08), inset 0 1px 0 rgba(255, 255, 255, 0.6)",backdropFilter:"blur(10px)",borderRadius:"24px",padding:"14px 20px"}}}],g=()=>{c(null)},p=()=>{const e=u.find(e=>e.id===i);if(!e)return;const t=(e,t)=>{const s=(e=>{const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null})(t);if(!s)return e;let a=!1;return e=(e=e.replace(/(linear-gradient\([^)]*?)#[0-9A-Fa-f]{6}/i,(e,s)=>a?e:(a=!0,s+t))).replace(/(linear-gradient\([^)]*?)rgba?\((\d+),\s*(\d+),\s*(\d+),\s*([0-9.]+)\)/i,(e,t,r,l,n,i)=>a?e:(a=!0,`${t}rgba(${s.r}, ${s.g}, ${s.b}, ${i})`))},s=t(e.userCSS,d),a=t(e.aiCSS,m);localStorage.setItem("user_bubble_css",s),localStorage.setItem("ai_bubble_css",a),window.dispatchEvent(new Event("storage"));const r="custom-bubble-style";let l=document.getElementById(r);l||(l=document.createElement("style"),l.id=r,document.head.appendChild(l)),l.textContent=s+"\n"+a,c(null),alert(`âœ… å·²åº”ç”¨ ${e.name} çš„è‡ªå®šä¹‰é¢œè‰²ï¼\n\nç”¨æˆ·æ°”æ³¡: ${d}\nAIæ°”æ³¡: ${m}\n\nè¿”å›žèŠå¤©é¡µé¢å³å¯çœ‹åˆ°æ•ˆæžœ`)};return e.jsxs("div",{className:"h-full flex flex-col bg-gray-50",children:[r&&e.jsx(ua,{}),e.jsxs("div",{className:"glass-effect px-4 py-3 border-b border-gray-200/50 flex items-center",children:[e.jsx("button",{onClick:()=>a(-1),className:"w-8 h-8 flex items-center justify-center ios-button",children:e.jsx("span",{className:"text-blue-500 text-xl",children:"â€¹"})}),e.jsx("h1",{className:"flex-1 text-center text-lg font-semibold text-gray-900",children:"æ°”æ³¡å•†åº—"}),e.jsx("div",{className:"w-8"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar p-4",children:[e.jsxs("div",{className:"glass-card rounded-2xl p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"})})}),e.jsx("h2",{className:"text-base font-semibold text-gray-900",children:"é€‰æ‹©ä½ å–œæ¬¢çš„æ°”æ³¡æ ·å¼"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:'ç‚¹å‡»"åº”ç”¨"æŒ‰é’®ï¼Œæ°”æ³¡æ ·å¼ä¼šåº”ç”¨åˆ°æ‰€æœ‰èŠå¤©ï¼ˆå…¨å±€è®¾ç½®ï¼‰'})]}),e.jsx("div",{className:"space-y-4",children:u.map(t=>{var s,a;return e.jsxs("div",{className:"glass-card rounded-2xl p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900 mb-1",children:t.name}),e.jsx("p",{className:"text-sm text-gray-500",children:t.description})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>(e=>{c(e.id);const t=e=>{const t=e.match(/background:\s*([#][0-9A-Fa-f]{6}|[#][0-9A-Fa-f]{3})/i);if(t)return t[1];const s=e.match(/linear-gradient\([^,]+,\s*([#][0-9A-Fa-f]{6})/i);if(s)return s[1];const a=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/i);return a?`#${parseInt(a[1]).toString(16).padStart(2,"0")}${parseInt(a[2]).toString(16).padStart(2,"0")}${parseInt(a[3]).toString(16).padStart(2,"0")}`:"#95EC69"};x(t(e.userCSS)),h(t(e.aiCSS))})(t),className:"px-3 py-2 rounded-xl font-medium text-sm bg-gray-200 text-gray-700 hover:bg-gray-300 transition-all",children:"ç¼–è¾‘"}),e.jsx("button",{onClick:()=>(e=>{localStorage.setItem("user_bubble_css",e.userCSS),localStorage.setItem("ai_bubble_css",e.aiCSS),n(e.id),window.dispatchEvent(new Event("storage")),alert(`âœ… å·²åº”ç”¨ ${e.name}ï¼\n\næ‰€æœ‰èŠå¤©éƒ½ä¼šä½¿ç”¨è¿™ä¸ªæ°”æ³¡æ ·å¼ã€‚`)})(t),className:"px-4 py-2 rounded-xl font-medium text-sm transition-all "+(l===t.id?"bg-green-500 text-white":"bg-blue-500 text-white hover:bg-blue-600"),children:l===t.id?"å·²åº”ç”¨":"åº”ç”¨"})]})]}),i===t.id&&e.jsxs("div",{className:"mb-4 space-y-3 bg-white rounded-xl p-4 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ç”¨æˆ·æ°”æ³¡é¢œè‰²"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"color",value:d,onChange:e=>x(e.target.value),className:"w-16 h-10 rounded-lg border border-gray-300 cursor-pointer"}),e.jsx("input",{type:"text",value:d,onChange:e=>x(e.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm font-mono focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"#95EC69"})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"AIæ°”æ³¡é¢œè‰²"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"color",value:m,onChange:e=>h(e.target.value),className:"w-16 h-10 rounded-lg border border-gray-300 cursor-pointer"}),e.jsx("input",{type:"text",value:m,onChange:e=>h(e.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm font-mono focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"#FFFFFF"})]})]})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:g,className:"px-4 py-2 rounded-xl font-medium text-sm bg-gray-200 text-gray-700 hover:bg-gray-300 transition-all",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:p,className:"px-4 py-2 rounded-xl font-medium text-sm bg-green-500 text-white hover:bg-green-600 transition-all",children:"åº”ç”¨é¢œè‰²"})]})]}),e.jsxs("div",{className:"space-y-3 bg-gradient-to-br from-gray-100 to-gray-50 rounded-xl p-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsx("div",{className:"px-3 py-2 rounded-xl text-sm max-w-[70%]",style:i===t.id?{...t.preview.user,background:(null==(s=t.preview.user.background)?void 0:s.includes("gradient"))?t.preview.user.background.replace(/#[0-9A-Fa-f]{6}/i,d):d}:t.preview.user,children:"æˆ‘çš„æ¶ˆæ¯"})}),e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"px-3 py-2 rounded-xl text-sm max-w-[70%]",style:i===t.id?{...t.preview.ai,background:(null==(a=t.preview.ai.background)?void 0:a.includes("gradient"))?t.preview.ai.background.replace(/#[0-9A-Fa-f]{6}/i,m):m}:t.preview.ai,children:"å¯¹æ–¹æ¶ˆæ¯"})})]})]},t.id)})})]})]})}},Symbol.toStringTag,{value:"Module"})),pl=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),[l,n]=t.useState(()=>{const e=localStorage.getItem("custom_fonts");return e?JSON.parse(e):[]}),[i,c]=t.useState(()=>localStorage.getItem("chat_font_family")||"system"),[d,x]=t.useState(!1),[m,h]=t.useState(""),[u,g]=t.useState(""),[p,f]=t.useState(""),[b,j]=t.useState(!1),[v,y]=t.useState("ä½ å¥½ï¼Œè¿™æ˜¯é¢„è§ˆæ–‡å­—"),[N,w]=t.useState(!1),k=t.useRef(new Set),C=e=>{localStorage.setItem("custom_fonts",JSON.stringify(e)),n(e)},S=async e=>{if(k.current.has(e.id))return!0;try{if(Array.from(document.fonts).find(t=>t.family===e.fontFamily))return k.current.add(e.id),!0;const t=new FontFace(e.fontFamily,`url(${e.url})`,{display:"swap"}),s=t.load(),a=new Promise((e,t)=>{setTimeout(()=>t(new Error("å­—ä½“åŠ è½½è¶…æ—¶")),1e4)});return await Promise.race([s,a]),document.fonts.add(t),k.current.add(e.id),!0}catch(t){return!1}},I=(e,t)=>{localStorage.setItem("chat_font_family",e),localStorage.setItem("chat_font_family_value",t),c(e),"system"===e?document.documentElement.style.removeProperty("--chat-font-family"):document.documentElement.style.setProperty("--chat-font-family",t),window.dispatchEvent(new Event("storage"))};return t.useEffect(()=>{(async()=>{if(0===l.length)return;w(!0);const e=l.map(e=>S(e));await Promise.all(e),w(!1)})();const e=localStorage.getItem("chat_font_family_value");e&&"system"!==i&&document.documentElement.style.setProperty("--chat-font-family",e)},[]),e.jsxs("div",{className:"h-full flex flex-col bg-[#f5f7fa]",children:[e.jsxs("div",{className:"glass-effect sticky top-0 z-50",children:[r&&e.jsx(ua,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a(-1),className:"ios-button text-gray-700 hover:text-gray-900 -ml-2",children:e.jsx("span",{className:"text-blue-500 text-2xl",children:"â€¹"})}),e.jsx("h1",{className:"text-base font-semibold text-gray-900 absolute left-1/2 transform -translate-x-1/2 pointer-events-none",children:"å­—ä½“è®¾ç½®"}),e.jsx("button",{onClick:()=>x(!d),className:"text-blue-500 ios-button",children:e.jsx("span",{className:"text-2xl",children:d?"Ã—":"+"})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar p-4",children:[N&&e.jsxs("div",{className:"glass-card rounded-2xl p-4 mb-4 flex items-center gap-3",children:[e.jsx("div",{className:"animate-spin w-5 h-5 border-2 border-blue-500 border-t-transparent rounded-full"}),e.jsx("span",{className:"text-sm text-gray-600",children:"æ­£åœ¨åŠ è½½å­—ä½“..."})]}),d&&e.jsxs("div",{className:"glass-card rounded-2xl p-5 mb-4",children:[e.jsx("h3",{className:"font-bold text-gray-900 text-base mb-4",children:"æ·»åŠ è‡ªå®šä¹‰å­—ä½“"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600 mb-1 block",children:"å­—ä½“åç§°"}),e.jsx("input",{type:"text",value:m,onChange:e=>h(e.target.value),placeholder:"ä¾‹å¦‚ï¼šæˆ‘çš„å­—ä½“",className:"w-full px-3 py-2 bg-white/50 border border-gray-200 rounded-xl outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600 mb-1 block",children:"å­—ä½“é“¾æŽ¥ï¼ˆURLï¼‰"}),e.jsx("input",{type:"text",value:u,onChange:e=>g(e.target.value),placeholder:"https://example.com/font.woff2",className:"w-full px-3 py-2 bg-white/50 border border-gray-200 rounded-xl outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600 mb-1 block",children:"å­—ä½“æ—åç§°ï¼ˆfont-familyï¼‰"}),e.jsx("input",{type:"text",value:p,onChange:e=>f(e.target.value),placeholder:"ä¾‹å¦‚ï¼šMyCustomFont",className:"w-full px-3 py-2 bg-white/50 border border-gray-200 rounded-xl outline-none focus:ring-2 focus:ring-blue-500"})]}),p&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600 mb-1 block",children:"é¢„è§ˆæ–‡å­—"}),e.jsx("input",{type:"text",value:v,onChange:e=>y(e.target.value),className:"w-full px-3 py-2 bg-white/50 border border-gray-200 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 mb-2"}),e.jsx("div",{className:"bg-white/50 rounded-xl p-4 border border-gray-200",children:e.jsx("div",{style:{fontFamily:p},className:"text-base",children:v})})]}),e.jsx("button",{onClick:async()=>{if(!m.trim()||!u.trim()||!p.trim())return void alert("è¯·å¡«å†™å®Œæ•´çš„å­—ä½“ä¿¡æ¯");j(!0);const e=u.trim();try{let s=e,a=!1;const r={id:`custom_${Date.now()}`,name:m.trim(),url:s,fontFamily:p.trim(),createdAt:Date.now()};let n=await S(r);if(!n)try{const t=await fetch(e,{mode:"cors",credentials:"omit"});if(t.ok){const e=await t.blob(),l=URL.createObjectURL(e);r.url=l,s=l,a=!0,n=await S(r)}}catch(t){}if(n){const e=[...l,r];C(e),h(""),g(""),f(""),x(!1),alert("å­—ä½“æ·»åŠ æˆåŠŸï¼")}else a&&URL.revokeObjectURL(s),alert("å­—ä½“åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ï¼š\n\n1. å­—ä½“é“¾æŽ¥æ˜¯å¦æ­£ç¡®\n2. ç½‘ç»œè¿žæŽ¥æ˜¯å¦æ­£å¸¸\n3. å­—ä½“æ ¼å¼æ˜¯å¦æ”¯æŒ\n4. æœåŠ¡å™¨æ˜¯å¦å¯è®¿é—®")}catch(s){let e="æ·»åŠ å­—ä½“å¤±è´¥ï¼š\n\n";s instanceof TypeError&&s.message.includes("Failed to fetch")?e+="âš ï¸ ç½‘ç»œè¿žæŽ¥å¤±è´¥\n\nå¯èƒ½åŽŸå› ï¼š\nâ€¢ æœåŠ¡å™¨æš‚æ—¶ä¸å¯ç”¨\nâ€¢ ç½‘ç»œè¿žæŽ¥é—®é¢˜\nâ€¢ é˜²ç«å¢™/ä»£ç†é˜»æ­¢\nâ€¢ URLåœ°å€é”™è¯¯":s instanceof Error?e+=s.message:e+="æœªçŸ¥é”™è¯¯",alert(e)}finally{j(!1)}},disabled:b||!m.trim()||!u.trim()||!p.trim(),className:"w-full py-3 bg-blue-500 text-white rounded-xl font-medium ios-button disabled:opacity-50 disabled:cursor-not-allowed",children:b?"åŠ è½½ä¸­...":"æ·»åŠ å­—ä½“"})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 rounded-xl",children:[e.jsx("p",{className:"text-xs text-blue-600 mb-2 font-semibold",children:"ðŸ’¡ ä½¿ç”¨æç¤ºï¼š"}),e.jsxs("ul",{className:"text-xs text-blue-600 space-y-1",children:[e.jsx("li",{children:"â€¢ æ”¯æŒ .woff2, .woff, .ttf, .otf æ ¼å¼"}),e.jsx("li",{children:"â€¢ æŽ¨èä½¿ç”¨ .woff2 æ ¼å¼ï¼Œä½“ç§¯å°åŠ è½½å¿«"}),e.jsxs("li",{children:["â€¢ ",e.jsx("span",{className:"font-semibold text-red-600",children:"å­—ä½“é“¾æŽ¥å¿…é¡»æ”¯æŒCORSè·¨åŸŸ"})]})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-blue-200",children:[e.jsx("p",{className:"text-xs text-blue-600 mb-2 font-semibold",children:"âœ… æŽ¨èå­—ä½“æºï¼ˆæ”¯æŒCORSï¼‰ï¼š"}),e.jsxs("ul",{className:"text-xs text-blue-600 space-y-1",children:[e.jsx("li",{children:"â€¢ Google Fonts CDN: fonts.gstatic.com"}),e.jsx("li",{children:"â€¢ jsDelivr CDN: cdn.jsdelivr.net"}),e.jsx("li",{children:"â€¢ unpkg CDN: unpkg.com"})]}),e.jsx("p",{className:"text-xs text-blue-500 mt-2",children:"ç¤ºä¾‹ï¼šhttps://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxK.woff2"})]})]})]}),e.jsxs("div",{onClick:()=>I("system","system"),className:"glass-card rounded-2xl p-5 ios-button cursor-pointer transition-all mb-3 "+("system"===i?"ring-2 ring-blue-500 shadow-lg":"hover:shadow-lg"),children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-bold text-gray-900 text-base",children:"ç³»ç»Ÿé»˜è®¤"}),"system"===i&&e.jsx("span",{className:"text-xs bg-blue-500 text-white px-2 py-0.5 rounded-full",children:"ä½¿ç”¨ä¸­"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"ä½¿ç”¨ç³»ç»Ÿé»˜è®¤å­—ä½“"})]})}),e.jsx("div",{className:"bg-white/50 rounded-xl p-4 border border-gray-200/50",children:e.jsxs("div",{className:"text-gray-900 leading-relaxed",children:[e.jsx("div",{className:"text-base mb-2",children:"ä½ å¥½ï¼Œè¿™æ˜¯ç³»ç»Ÿé»˜è®¤å­—ä½“"}),e.jsx("div",{className:"text-sm text-gray-600",children:"The quick brown fox jumps over the lazy dog"})]})})]}),e.jsx("div",{className:"space-y-3",children:l.map(t=>e.jsxs("div",{className:"glass-card rounded-2xl p-5 transition-all "+(i===t.id?"ring-2 ring-blue-500 shadow-lg":""),children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-bold text-gray-900 text-base",children:t.name}),i===t.id&&e.jsx("span",{className:"text-xs bg-blue-500 text-white px-2 py-0.5 rounded-full",children:"ä½¿ç”¨ä¸­"})]}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:t.url})]}),e.jsx("button",{onClick:()=>(e=>{if(confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå­—ä½“å—ï¼Ÿ")){const t=l.filter(t=>t.id!==e);C(t),i===e&&I("system","system")}})(t.id),className:"ml-2 w-8 h-8 flex items-center justify-center ios-button text-red-500 hover:bg-red-50 rounded-lg",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),e.jsx("div",{className:"bg-white/50 rounded-xl p-4 border border-gray-200/50",children:e.jsxs("div",{className:"text-gray-900 leading-relaxed",style:{fontFamily:t.fontFamily},children:[e.jsxs("div",{className:"text-base mb-2",children:["ä½ å¥½ï¼Œè¿™æ˜¯",t.name]}),e.jsx("div",{className:"text-sm text-gray-600",children:"The quick brown fox jumps over the lazy dog"}),e.jsx("div",{className:"text-xs text-gray-500 mt-2",children:"0123456789 ï¼@#ï¿¥%â€¦â€¦&*ï¼ˆï¼‰"})]})}),e.jsx("button",{onClick:()=>I(t.id,t.fontFamily),className:"w-full mt-3 py-2 bg-blue-500 text-white rounded-xl text-sm font-medium ios-button",children:"ä½¿ç”¨è¿™ä¸ªå­—ä½“"})]},t.id))}),0===l.length&&!d&&e.jsxs("div",{className:"glass-card rounded-2xl p-8 text-center",children:[e.jsx("div",{className:"text-4xl mb-3",children:"ðŸ“"}),e.jsx("p",{className:"text-gray-500 text-sm mb-2",children:"è¿˜æ²¡æœ‰è‡ªå®šä¹‰å­—ä½“"}),e.jsx("p",{className:"text-gray-400 text-xs",children:"ç‚¹å‡»å³ä¸Šè§’ + æ·»åŠ å­—ä½“"})]}),e.jsxs("div",{className:"mt-6 glass-card rounded-2xl p-5",children:[e.jsx("h3",{className:"font-bold text-gray-900 text-sm mb-3",children:"ðŸ’¡ ä½¿ç”¨è¯´æ˜Ž"}),e.jsxs("div",{className:"space-y-2 text-xs text-gray-600",children:[e.jsx("p",{children:"â€¢ ç‚¹å‡»å³ä¸Šè§’ + æ·»åŠ è‡ªå®šä¹‰å­—ä½“"}),e.jsx("p",{children:"â€¢ è¾“å…¥å­—ä½“åç§°ã€é“¾æŽ¥å’Œ font-family åç§°"}),e.jsx("p",{children:"â€¢ æ”¯æŒåœ¨çº¿å­—ä½“é“¾æŽ¥ï¼ˆéœ€æ”¯æŒè·¨åŸŸï¼‰"}),e.jsx("p",{children:"â€¢ å¯ä»¥ä»Ž Google Fonts ç­‰ç½‘ç«™èŽ·å–å­—ä½“é“¾æŽ¥"}),e.jsx("p",{children:"â€¢ å­—ä½“ä¼šè‡ªåŠ¨ä¿å­˜ï¼Œä¸‹æ¬¡æ‰“å¼€ä»ç„¶å¯ç”¨"})]})]}),e.jsx("div",{className:"h-6"})]})]})}},Symbol.toStringTag,{value:"Module"})),fl=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),n=t.useRef(null),i=t.useRef(null),[c,d]=t.useState(null),[x,m]=t.useState(null),[h,u]=t.useState({x:0,y:0}),[g,p]=t.useState(200),[f,b]=t.useState({width:0,height:0}),[j,v]=t.useState(!1),y=[{id:"wechat-app",name:"å¾®ä¿¡",defaultIcon:as},{id:"preset",name:"é¢„è®¾",defaultIcon:Ss},{id:"worldbook",name:"ä¸–ç•Œä¹¦",defaultIcon:Hs},{id:"music-app",name:"éŸ³ä¹",defaultIcon:Ws},{id:"settings",name:"ç³»ç»Ÿè®¾ç½®",defaultIcon:Ss},{id:"footprint",name:"è¶³è¿¹",defaultIcon:na},{id:"photos",name:"ç›¸å†Œ",defaultIcon:us},{id:"aiphone",name:"æŸ¥æ‰‹æœº",defaultIcon:xa},{id:"calendar",name:"æ—¥åŽ†",defaultIcon:qs},{id:"games",name:"æ¸¸æˆ",defaultIcon:Ks},{id:"moments",name:"æœ‹å‹åœˆ",defaultIcon:js},{id:"offline",name:"çº¿ä¸‹",defaultIcon:as},{id:"customize",name:"ç¾ŽåŒ–",defaultIcon:Ss},{id:"api-config",name:"APIé…ç½®",defaultIcon:Ss},{id:"browser",name:"æµè§ˆå™¨",defaultIcon:Gs}],[N,w]=t.useState(()=>{const e=localStorage.getItem("custom_desktop_icons");if(e)try{const t=JSON.parse(e);return y.map(e=>{const s=t.find(t=>t.id===e.id);return{...e,customIcon:null==s?void 0:s.customIcon}})}catch(t){return y}return y}),k=e=>{w(e),localStorage.setItem("custom_desktop_icons",JSON.stringify(e)),window.dispatchEvent(new Event("customIconUpdate"))};return e.jsxs("div",{className:"h-full flex flex-col bg-[#f5f7fa]",children:[e.jsx("input",{ref:n,type:"file",accept:"image/*",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(!s)return;if(!s.type.startsWith("image/"))return void alert("è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶");const a=new FileReader;a.onload=e=>{var t;const s=new Image;s.onload=()=>{var t;m(null==(t=e.target)?void 0:t.result),b({width:s.width,height:s.height});const a=Math.min(s.width,s.height);p(a),u({x:(s.width-a)/2,y:(s.height-a)/2}),v(!0)},s.src=null==(t=e.target)?void 0:t.result},a.readAsDataURL(s)},className:"hidden"}),e.jsx("canvas",{ref:i,className:"hidden"}),e.jsxs("div",{className:"glass-effect sticky top-0 z-50",children:[r&&e.jsx(ua,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a(-1),className:"ios-button text-gray-700 hover:text-gray-900 -ml-2",children:e.jsx(os,{size:24})}),e.jsx("h1",{className:"text-base font-semibold text-gray-900 absolute left-1/2 transform -translate-x-1/2 pointer-events-none",children:"è‡ªå®šä¹‰å›¾æ ‡"}),e.jsx("button",{onClick:()=>{if(confirm("ç¡®å®šè¦æ¢å¤æ‰€æœ‰é»˜è®¤å›¾æ ‡å—ï¼Ÿ")){const e=N.map(e=>({...e,customIcon:void 0}));k(e)}},className:"text-sm text-blue-500 ios-button",children:"å…¨éƒ¨é‡ç½®"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsx("div",{className:"grid grid-cols-3 gap-4",children:N.map(t=>e.jsx("div",{className:"glass-card rounded-2xl p-4 cursor-pointer hover:shadow-lg transition-all backdrop-blur-md bg-white/80 border border-white/50",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"relative w-20 h-20 rounded-2xl glass-card flex items-center justify-center overflow-hidden border-2 border-gray-200",children:t.customIcon?e.jsx("img",{src:t.customIcon,alt:t.name,className:"w-full h-full object-cover"}):l.createElement(t.defaultIcon,{size:32,className:"text-gray-300"})}),e.jsx("span",{className:"text-xs text-gray-700 text-center font-medium",children:t.name}),e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsx("button",{onClick:()=>{var e;d(t.id),null==(e=n.current)||e.click()},className:"flex-1 px-3 py-1.5 bg-blue-500 text-white rounded-lg text-xs font-medium whitespace-nowrap",children:t.customIcon?"æ›´æ¢":"è‡ªå®šä¹‰"}),t.customIcon&&e.jsx("button",{onClick:()=>(e=>{if(confirm("ç¡®å®šè¦æ¢å¤é»˜è®¤å›¾æ ‡å—ï¼Ÿ")){const t=N.map(t=>t.id===e?{...t,customIcon:void 0}:t);k(t)}})(t.id),className:"px-3 py-1.5 bg-gray-200 text-gray-700 rounded-lg text-xs font-medium whitespace-nowrap",children:"é‡ç½®"})]})]})},t.id))}),e.jsxs("div",{className:"mt-6 p-4 glass-card rounded-2xl backdrop-blur-md bg-white/60 border border-white/50",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-2",children:"ä½¿ç”¨è¯´æ˜Ž"}),e.jsxs("ul",{className:"text-xs text-gray-600 space-y-1",children:[e.jsx("li",{children:'â€¢ ç‚¹å‡»"è‡ªå®šä¹‰"æŒ‰é’®ä¸Šä¼ å›¾ç‰‡'}),e.jsx("li",{children:"â€¢ æ‹–åŠ¨å’Œç¼©æ”¾è£å‰ªæ¡†è°ƒæ•´å›¾æ ‡åŒºåŸŸ"}),e.jsx("li",{children:"â€¢ å»ºè®®ä½¿ç”¨æ­£æ–¹å½¢å›¾ç‰‡ï¼Œæ•ˆæžœæ›´ä½³"}),e.jsx("li",{children:"â€¢ æ”¯æŒPNGã€JPGç­‰å¸¸è§æ ¼å¼"})]})]})]}),j&&x&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"glass-card rounded-3xl w-full max-w-md max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"bg-white px-6 py-4 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"è£å‰ªå›¾æ ‡"}),e.jsx("button",{onClick:()=>{v(!1),m(null)},className:"text-gray-500 hover:text-gray-700 text-2xl",children:"Ã—"})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"relative w-full aspect-square bg-gray-100 rounded-xl overflow-hidden",children:[e.jsx("img",{src:x,alt:"preview",className:"w-full h-full object-contain",style:{filter:"brightness(0.5)"}}),e.jsx("div",{className:"absolute border-4 border-blue-500 bg-transparent cursor-move",style:{left:h.x/f.width*100+"%",top:h.y/f.height*100+"%",width:g/f.width*100+"%",height:g/f.height*100+"%",boxShadow:"0 0 0 9999px rgba(0, 0, 0, 0.5)"},onMouseDown:e=>{const t=e.clientX,s=e.clientY,a=h.x,r=h.y,l=e=>{const l=e.currentTarget.getBoundingClientRect(),n=f.width/l.width,i=f.height/l.height,c=(e.clientX-t)*n,o=(e.clientY-s)*i,d=Math.max(0,Math.min(f.width-g,a+c)),x=Math.max(0,Math.min(f.height-g,r+o));u({x:d,y:x})},n=()=>{document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",n)};document.addEventListener("mousemove",l),document.addEventListener("mouseup",n)},children:e.jsx("img",{src:x,alt:"crop preview",className:"absolute pointer-events-none",style:{left:`-${h.x}px`,top:`-${h.y}px`,width:`${f.width}px`,height:`${f.height}px`}})})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"text-sm text-gray-600 block mb-2",children:"è£å‰ªå¤§å°"}),e.jsx("input",{type:"range",min:Math.min(100,Math.min(f.width,f.height)),max:Math.min(f.width,f.height),value:g,onChange:e=>{const t=parseInt(e.target.value);p(t),u({x:Math.min(h.x,f.width-t),y:Math.min(h.y,f.height-t)})},className:"w-full"})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>{v(!1),m(null)},className:"flex-1 px-4 py-3 glass-card text-gray-700 rounded-xl font-medium",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:()=>{if(!x||!i.current)return;const e=i.current,t=e.getContext("2d");if(!t)return;const s=new Image;s.onload=()=>{e.width=256,e.height=256,t.drawImage(s,h.x,h.y,g,g,0,0,256,256);const a=e.toDataURL("image/png");if(c){const e=N.map(e=>e.id===c?{...e,customIcon:a}:e);k(e)}v(!1),m(null),d(null)},s.src=x},className:"flex-1 px-4 py-3 bg-blue-500 text-white rounded-xl font-medium",children:"ç¡®è®¤"})]})]})]})})]})}},Symbol.toStringTag,{value:"Module"})),bl=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),l=t.useRef(null),n=t.useRef(null),i=t.useRef(null),[c,d]=t.useState(""),[x,m]=t.useState(!1),[h,u]=t.useState(""),[g,p]=t.useState(!1),[f,b]=t.useState(""),[j,v]=t.useState(!1);t.useEffect(()=>{(async()=>{try{const e=await be("desktop_background");e&&d(e);const t=await be("music_player_background");t&&u(t);const s=await be("character_card_background");s&&b(s)}catch(e){}})()},[]);return e.jsxs("div",{className:"h-full flex flex-col bg-[#f5f7fa]",children:[e.jsx("input",{ref:l,type:"file",accept:"image/*",onChange:async e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(s)if(s.type.startsWith("image/")){m(!0);try{const e=new FileReader;e.onload=async()=>{const t=e.result;try{await je("desktop_background",t),d(t),m(!1),alert("æ¡Œé¢èƒŒæ™¯å·²ä¿å­˜ï¼"),window.dispatchEvent(new Event("desktopBackgroundUpdate"))}catch(s){alert("ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•"),m(!1)}},e.onerror=()=>{alert("å›¾ç‰‡è¯»å–å¤±è´¥"),m(!1)},e.readAsDataURL(s)}catch(a){alert("å›¾ç‰‡å¤„ç†å¤±è´¥ï¼Œè¯·é‡è¯•"),m(!1)}}else alert("è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶")},className:"hidden"}),e.jsx("input",{ref:n,type:"file",accept:"image/*",onChange:async e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(s)if(s.type.startsWith("image/")){p(!0);try{const e=new FileReader;e.onload=async()=>{const t=e.result;try{await je("music_player_background",t),u(t),p(!1),alert("éŸ³ä¹èƒŒæ™¯å·²ä¿å­˜ï¼"),window.dispatchEvent(new Event("musicBackgroundUpdate"))}catch(s){alert("ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•"),p(!1)}},e.onerror=()=>{alert("å›¾ç‰‡è¯»å–å¤±è´¥"),p(!1)},e.readAsDataURL(s)}catch(a){alert("å›¾ç‰‡å¤„ç†å¤±è´¥ï¼Œè¯·é‡è¯•"),p(!1)}}else alert("è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶")},className:"hidden"}),e.jsx("input",{ref:i,type:"file",accept:"image/*",onChange:async e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(s)if(s.type.startsWith("image/")){v(!0);try{const e=new FileReader;e.onload=async()=>{const t=e.result;try{await je("character_card_background",t),b(t),v(!1),alert("è§’è‰²å¡ç‰‡èƒŒæ™¯å·²ä¿å­˜ï¼"),window.dispatchEvent(new Event("characterCardBackgroundUpdate"))}catch(s){alert("ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•"),v(!1)}},e.onerror=()=>{alert("å›¾ç‰‡è¯»å–å¤±è´¥"),v(!1)},e.readAsDataURL(s)}catch(a){alert("å›¾ç‰‡å¤„ç†å¤±è´¥ï¼Œè¯·é‡è¯•"),v(!1)}}else alert("è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶")},className:"hidden"}),e.jsxs("div",{className:"glass-effect sticky top-0 z-50",children:[r&&e.jsx(ua,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a(-1),className:"ios-button text-gray-700 hover:text-gray-900 -ml-2",children:e.jsx(os,{size:24})}),e.jsx("h1",{className:"text-base font-semibold text-gray-900 absolute left-1/2 transform -translate-x-1/2 pointer-events-none",children:"èƒŒæ™¯è®¾ç½®"}),e.jsx("div",{className:"w-6"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"text-sm font-semibold text-gray-700 mb-3 px-2",children:"æ¡Œé¢èƒŒæ™¯"}),e.jsxs("div",{className:"glass-card rounded-2xl p-4 backdrop-blur-md bg-white/80 border border-white/50",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"è®¾ç½®Desktopé¡µé¢çš„æ•´ä½“èƒŒæ™¯"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-24 h-24 rounded-xl overflow-hidden border-2 border-gray-200 flex-shrink-0 flex items-center justify-center",style:{backgroundImage:c?`url(${c})`:"none",backgroundSize:"cover",backgroundPosition:"center",backgroundColor:c?"transparent":"#f5f7fa"},children:!c&&e.jsx(us,{size:32,className:"text-gray-400"})}),e.jsxs("div",{className:"flex-1 flex flex-col gap-2",children:[e.jsx("button",{onClick:()=>{var e;return null==(e=l.current)?void 0:e.click()},disabled:x,className:"w-full px-4 py-2.5 bg-blue-500 text-white rounded-xl ios-button font-medium text-sm",children:x?"ä¸Šä¼ ä¸­...":c?"æ›´æ¢èƒŒæ™¯":"ä¸Šä¼ èƒŒæ™¯"}),c&&e.jsx("button",{onClick:async()=>{if(confirm("ç¡®å®šè¦åˆ é™¤æ¡Œé¢èƒŒæ™¯å—ï¼Ÿ"))try{await ve("desktop_background"),d(""),alert("æ¡Œé¢èƒŒæ™¯å·²åˆ é™¤ï¼"),window.dispatchEvent(new Event("desktopBackgroundUpdate"))}catch(e){alert("åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•")}},className:"w-full px-4 py-2.5 glass-card text-gray-700 rounded-xl ios-button font-medium text-sm",children:"åˆ é™¤èƒŒæ™¯"})]})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"text-sm font-semibold text-gray-700 mb-3 px-2",children:"éŸ³ä¹èƒŒæ™¯"}),e.jsxs("div",{className:"glass-card rounded-2xl p-4 backdrop-blur-md bg-white/80 border border-white/50",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"è®¾ç½®æ¡Œé¢ä¸ŠéŸ³ä¹æ’­æ”¾å™¨å¡ç‰‡çš„èƒŒæ™¯"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-24 h-24 rounded-xl overflow-hidden border-2 border-gray-200 flex-shrink-0 flex items-center justify-center",style:{backgroundImage:h?`url(${h})`:"none",backgroundSize:"cover",backgroundPosition:"center",backgroundColor:h?"transparent":"#f5f7fa"},children:!h&&e.jsx(us,{size:32,className:"text-gray-400"})}),e.jsxs("div",{className:"flex-1 flex flex-col gap-2",children:[e.jsx("button",{onClick:()=>{var e;return null==(e=n.current)?void 0:e.click()},disabled:g,className:"w-full px-4 py-2.5 bg-blue-500 text-white rounded-xl ios-button font-medium text-sm",children:g?"ä¸Šä¼ ä¸­...":h?"æ›´æ¢èƒŒæ™¯":"ä¸Šä¼ èƒŒæ™¯"}),h&&e.jsx("button",{onClick:async()=>{if(confirm("ç¡®å®šè¦åˆ é™¤éŸ³ä¹èƒŒæ™¯å—ï¼Ÿ"))try{await ve("music_player_background"),u(""),alert("éŸ³ä¹èƒŒæ™¯å·²åˆ é™¤ï¼"),window.dispatchEvent(new Event("musicBackgroundUpdate"))}catch(e){alert("åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•")}},className:"w-full px-4 py-2.5 glass-card text-gray-700 rounded-xl ios-button font-medium text-sm",children:"åˆ é™¤èƒŒæ™¯"})]})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"text-sm font-semibold text-gray-700 mb-3 px-2",children:"è§’è‰²å¡ç‰‡èƒŒæ™¯"}),e.jsxs("div",{className:"glass-card rounded-2xl p-4 backdrop-blur-md bg-white/80 border border-white/50",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"è®¾ç½®æ¡Œé¢ç¬¬äºŒé¡µè§’è‰²å¡ç‰‡çš„èƒŒæ™¯å›¾ç‰‡"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-24 h-24 rounded-xl overflow-hidden border-2 border-gray-200 flex-shrink-0 flex items-center justify-center",style:{backgroundImage:f?`url(${f})`:"none",backgroundSize:"cover",backgroundPosition:"center",backgroundColor:f?"transparent":"#f5f7fa"},children:!f&&e.jsx(us,{size:32,className:"text-gray-400"})}),e.jsxs("div",{className:"flex-1 flex flex-col gap-2",children:[e.jsx("button",{onClick:()=>{var e;return null==(e=i.current)?void 0:e.click()},disabled:j,className:"w-full px-4 py-2.5 bg-blue-500 text-white rounded-xl ios-button font-medium text-sm",children:j?"ä¸Šä¼ ä¸­...":f?"æ›´æ¢èƒŒæ™¯":"ä¸Šä¼ èƒŒæ™¯"}),f&&e.jsx("button",{onClick:async()=>{if(confirm("ç¡®å®šè¦åˆ é™¤è§’è‰²å¡ç‰‡èƒŒæ™¯å—ï¼Ÿ"))try{await ve("character_card_background"),b(""),alert("è§’è‰²å¡ç‰‡èƒŒæ™¯å·²åˆ é™¤ï¼"),window.dispatchEvent(new Event("characterCardBackgroundUpdate"))}catch(e){alert("åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•")}},className:"w-full px-4 py-2.5 glass-card text-gray-700 rounded-xl ios-button font-medium text-sm",children:"åˆ é™¤èƒŒæ™¯"})]})]})]})]}),e.jsxs("div",{className:"mt-6 p-4 glass-card rounded-2xl backdrop-blur-md bg-white/60 border border-white/50",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-2",children:"ä½¿ç”¨è¯´æ˜Ž"}),e.jsxs("ul",{className:"text-xs text-gray-600 space-y-1",children:[e.jsx("li",{children:"â€¢ æ¡Œé¢èƒŒæ™¯ä¼šæ˜¾ç¤ºåœ¨Desktopé¡µé¢çš„æ•´ä½“èƒŒæ™¯"}),e.jsx("li",{children:"â€¢ éŸ³ä¹èƒŒæ™¯åªä¼šæ˜¾ç¤ºåœ¨éŸ³ä¹æ’­æ”¾å™¨å¡ç‰‡å†…"}),e.jsx("li",{children:"â€¢ è§’è‰²å¡ç‰‡èƒŒæ™¯ä¼šæ˜¾ç¤ºåœ¨æ¡Œé¢ç¬¬äºŒé¡µçš„è§’è‰²å¡ç‰‡å†…"}),e.jsx("li",{children:"â€¢ å»ºè®®ä½¿ç”¨é«˜è´¨é‡å›¾ç‰‡ï¼Œæ•ˆæžœæ›´ä½³"}),e.jsx("li",{children:"â€¢ å›¾ç‰‡ä¼šè‡ªåŠ¨ä¿å­˜åˆ°IndexedDBï¼Œæ— å¤§å°é™åˆ¶"})]})]})]})]})}},Symbol.toStringTag,{value:"Module"})),jl=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),[l,n]=t.useState(null),[i,c]=t.useState(!0),[d,x]=t.useState(!1),[m,h]=t.useState(!1),[u,g]=t.useState(()=>localStorage.getItem("weather_city")||"Beijing"),[p,f]=t.useState(""),[b,j]=t.useState(!1),[v,y]=t.useState(()=>"true"===localStorage.getItem("custom_weather_enabled")),[N,w]=t.useState(""),[k,C]=t.useState(""),[S,I]=t.useState("æ™´å¤©"),_=async e=>{var t;try{x(!0);const t=e||u,s=await yt(t);n(s),c(!1),x(!1)}catch(s){c(!1),x(!1),(null==(t=s.message)?void 0:t.includes("404"))?alert('æ‰¾ä¸åˆ°è¯¥åŸŽå¸‚ âŒ\n\nè¯·æ£€æŸ¥ï¼š\nâ€¢ åŸŽå¸‚åç§°æ˜¯å¦æ­£ç¡®\nâ€¢ æ˜¯å¦è¾“å…¥äº†å®Œæ•´çš„åŸŽå¸‚å\n  å¦‚ï¼š"å˜‰å…´"è€Œä¸æ˜¯"å˜‰"\nâ€¢ å°è¯•ä½¿ç”¨è‹±æ–‡åç§°'):alert("èŽ·å–å¤©æ°”å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿žæŽ¥æˆ–ç¨åŽé‡è¯•")}},M=e=>{!e||e.trim().length<2?alert("åŸŽå¸‚åç§°å¤ªçŸ­ï¼Œè¯·è¾“å…¥å®Œæ•´çš„åŸŽå¸‚åç§°"):(g(e),localStorage.setItem("weather_city",e),h(!1),_(e),window.dispatchEvent(new Event("weatherCityChange")))};t.useEffect(()=>{const e=localStorage.getItem("custom_weather_data");if(e)try{const t=JSON.parse(e);w(t.city||""),C(t.temp||""),I(t.condition||"æ™´å¤©")}catch(t){}if(v&&e)try{const t=JSON.parse(e);n({temperature:parseInt(t.temp)||25,condition:t.condition||"æ™´å¤©",conditionCN:t.condition||"æ™´å¤©",icon:z(t.condition||"æ™´å¤©"),location:t.city||"è‡ªå®šä¹‰",humidity:60,windSpeed:10,airQuality:"good"}),c(!1)}catch(t){_()}else _()},[]);const z=e=>{const t=e.toLowerCase();return t.includes("clear")||t.includes("sunny")||"æ™´å¤©"===t||"æ™´"===t?"â˜€ï¸":t.includes("rain")||"é›¨"===t||t.includes("shower")?t.includes("heavy")||"å¤§é›¨"===t?"â›ˆï¸":t.includes("light")||"å°é›¨"===t?"ðŸŒ¦ï¸":"ðŸŒ§ï¸":t.includes("thunder")||"é›·é˜µé›¨"===t?"â›ˆï¸":t.includes("cloud")||"å¤šäº‘"===t?t.includes("partly")?"â›…":"â˜ï¸":"é˜´"===t||t.includes("overcast")?"â˜ï¸":t.includes("snow")||"é›ª"===t?t.includes("heavy")||"å¤§é›ª"===t?"â„ï¸":"ðŸŒ¨ï¸":t.includes("fog")||t.includes("mist")||"é›¾"===t?"ðŸŒ«ï¸":t.includes("wind")||"å¤§é£Ž"===t?"ðŸ’¨":"ðŸŒ¤ï¸"};return e.jsxs("div",{className:"h-full flex flex-col bg-[#f5f7fa]",children:[e.jsxs("div",{className:"glass-effect sticky top-0 z-50",children:[r&&e.jsx(ua,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a("/desktop",{replace:!0}),className:"ios-button text-gray-700 hover:text-gray-900 -ml-2",children:e.jsx(os,{size:24})}),e.jsx("h1",{className:"text-base font-semibold text-gray-900 absolute left-1/2 transform -translate-x-1/2 pointer-events-none",children:"å¤©æ°”è¯¦æƒ…"}),e.jsx("button",{onClick:()=>j(!0),className:"text-blue-500 ios-button text-sm",children:v?"è‡ªå®šä¹‰ä¸­":"è‡ªå®šä¹‰"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:i?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full"})}):l?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"glass-card rounded-3xl p-6 mb-4 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-6xl font-extralight text-gray-800 mb-2",children:[l.temperature,e.jsx("span",{className:"text-3xl",children:"Â°C"})]}),e.jsx("div",{className:"text-xl text-gray-600",children:l.conditionCN}),e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:l.location})]}),e.jsx("div",{className:"text-7xl",children:z(l.condition)})]}),e.jsxs("div",{className:"flex items-center gap-3 p-4 glass-card rounded-xl",children:[e.jsx("div",{className:`w-12 h-12 rounded-full ${(e=>{switch(e){case"excellent":return"bg-green-500";case"good":return"bg-blue-500";case"moderate":return"bg-yellow-500";case"poor":return"bg-red-500";default:return"bg-gray-500"}})(l.airQuality)} flex items-center justify-center text-white font-bold`,children:(e=>{switch(e){case"excellent":return"ä¼˜";case"good":return"è‰¯";case"moderate":return"ä¸­";case"poor":return"å·®";default:return"æœªçŸ¥"}})(l.airQuality)}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"ç©ºæ°”è´¨é‡"}),e.jsx("div",{className:"text-xs text-gray-500 capitalize",children:l.airQuality})]})]})]}),e.jsxs("div",{className:"glass-card rounded-2xl p-5 mb-4",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900 mb-4",children:"è¯¦ç»†ä¿¡æ¯"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"glass-card rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ’§"}),e.jsx("span",{className:"text-xs text-gray-600",children:"æ¹¿åº¦"})]}),e.jsxs("div",{className:"text-2xl font-semibold text-gray-800",children:[l.humidity,e.jsx("span",{className:"text-sm",children:"%"})]})]}),e.jsxs("div",{className:"glass-card rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ’¨"}),e.jsx("span",{className:"text-xs text-gray-600",children:"é£Žé€Ÿ"})]}),e.jsxs("div",{className:"text-2xl font-semibold text-gray-800",children:[l.windSpeed,e.jsx("span",{className:"text-sm",children:"km/h"})]})]}),e.jsxs("div",{className:"glass-card rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸŒ¡ï¸"}),e.jsx("span",{className:"text-xs text-gray-600",children:"ä½“æ„Ÿ"})]}),e.jsxs("div",{className:"text-2xl font-semibold text-gray-800",children:[l.temperature,e.jsx("span",{className:"text-sm",children:"Â°C"})]})]}),e.jsxs("div",{className:"glass-card rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸŒˆ"}),e.jsx("span",{className:"text-xs text-gray-600",children:"çŠ¶å†µ"})]}),e.jsx("div",{className:"text-sm font-medium text-gray-800 truncate",children:l.conditionCN})]})]})]}),e.jsxs("div",{className:"glass-card rounded-2xl p-5 mb-4",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900 mb-3",children:"ä½ç½®"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-3xl",children:"ðŸ“"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-base text-gray-800 font-medium",children:l.location}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"å½“å‰ä½ç½®"})]})]})]}),e.jsxs("div",{className:"text-center text-xs text-gray-500 mb-4",children:["æ•°æ®æ¥æº: wttr.in â€¢ æ›´æ–°äºŽ ",(new Date).toLocaleTimeString("zh-CN")]})]}):e.jsxs("div",{className:"glass-card rounded-2xl p-8 text-center",children:[e.jsx("div",{className:"text-4xl mb-3",children:"ðŸŒ¦ï¸"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"æ— æ³•èŽ·å–å¤©æ°”æ•°æ®"}),e.jsx("button",{onClick:()=>_(),className:"px-6 py-2 bg-blue-500 text-white rounded-xl ios-button",children:"é‡è¯•"})]})}),b&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end",children:e.jsxs("div",{className:"w-full bg-white rounded-t-3xl max-h-[80vh] overflow-hidden flex flex-col",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"è‡ªå®šä¹‰å¤©æ°”"}),e.jsx("button",{onClick:()=>j(!1),className:"text-gray-500 hover:text-gray-700 text-2xl ios-button",children:"Ã—"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-gray-700 mb-2 block",children:"åŸŽå¸‚åç§°"}),e.jsx("input",{type:"text",value:N,onChange:e=>w(e.target.value),placeholder:"ä¾‹å¦‚ï¼šåŒ—äº¬ã€æˆ‘çš„å®¶ä¹¡",className:"w-full px-4 py-3 bg-gray-100 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-gray-700 mb-2 block",children:"æ¸©åº¦ (Â°C)"}),e.jsx("input",{type:"number",value:k,onChange:e=>C(e.target.value),placeholder:"ä¾‹å¦‚ï¼š25",className:"w-full px-4 py-3 bg-gray-100 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-gray-700 mb-2 block",children:"å¤©æ°”çŠ¶å†µ"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:["æ™´å¤©","å¤šäº‘","é˜´å¤©","å°é›¨","ä¸­é›¨","å¤§é›¨","é›·é˜µé›¨","å°é›ª","å¤§é›ª","é›¾","å¤§é£Ž","å…¶ä»–"].map(t=>e.jsx("button",{onClick:()=>I(t),className:"px-4 py-2 rounded-lg text-sm font-medium transition-all "+(S===t?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:t},t))})]}),N&&k&&e.jsxs("div",{className:"glass-card rounded-xl p-4 bg-blue-50",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:"é¢„è§ˆ"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-3xl font-bold text-gray-900",children:[k,"Â°C"]}),e.jsx("div",{className:"text-sm text-gray-600",children:S}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:N})]}),e.jsx("div",{className:"text-5xl",children:z(S)})]})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx("button",{onClick:()=>{if(!N.trim())return void alert("è¯·è¾“å…¥åŸŽå¸‚åç§°");if(!k.trim()||isNaN(Number(k)))return void alert("è¯·è¾“å…¥æœ‰æ•ˆçš„æ¸©åº¦ï¼ˆæ•°å­—ï¼‰");const e={city:N.trim(),temp:k.trim(),condition:S};localStorage.setItem("custom_weather_data",JSON.stringify(e)),localStorage.setItem("custom_weather_enabled","true"),y(!0),n({temperature:parseInt(k),condition:S,conditionCN:S,icon:z(S),location:N,humidity:60,windSpeed:10,airQuality:"good"}),j(!1),alert("è‡ªå®šä¹‰å¤©æ°”å·²ä¿å­˜ï¼"),window.dispatchEvent(new Event("weatherCityChange"))},className:"w-full py-3 bg-blue-500 text-white rounded-xl font-medium ios-button",children:"ä¿å­˜è‡ªå®šä¹‰å¤©æ°”"}),v&&e.jsx("button",{onClick:()=>{localStorage.setItem("custom_weather_enabled","false"),y(!1),_(),alert("å·²åˆ‡æ¢åˆ°çœŸå®žå¤©æ°”"),window.dispatchEvent(new Event("weatherCityChange"))},className:"w-full py-3 glass-card text-gray-700 rounded-xl font-medium ios-button",children:"åˆ‡æ¢åˆ°çœŸå®žå¤©æ°”"}),e.jsx("button",{onClick:()=>h(!0),className:"w-full py-3 glass-card text-blue-600 rounded-xl font-medium ios-button",children:"æˆ–è€…é€‰æ‹©çœŸå®žåŸŽå¸‚"})]}),e.jsx("div",{className:"glass-card rounded-xl p-4 bg-yellow-50",children:e.jsxs("p",{className:"text-xs text-gray-600",children:["ðŸ’¡ ",e.jsx("span",{className:"font-semibold",children:"ä½¿ç”¨è¯´æ˜Žï¼š"}),e.jsx("br",{}),"â€¢ è‡ªå®šä¹‰å¤©æ°”ä¼šè¦†ç›–çœŸå®žå¤©æ°”æ•°æ®",e.jsx("br",{}),"â€¢ å¯ä»¥è®¾ç½®ä»»æ„åŸŽå¸‚åå’Œæ¸©åº¦",e.jsx("br",{}),"â€¢ æ¡Œé¢å’Œè¯¦æƒ…é¡µéƒ½ä¼šæ˜¾ç¤ºè‡ªå®šä¹‰æ•°æ®",e.jsx("br",{}),"â€¢ éšæ—¶å¯ä»¥åˆ‡æ¢å›žçœŸå®žå¤©æ°”"]})})]})]})}),m&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end",children:e.jsxs("div",{className:"w-full bg-white rounded-t-3xl max-h-[80vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"é€‰æ‹©åŸŽå¸‚"}),e.jsx("button",{onClick:()=>{h(!1),f("")},className:"text-gray-500 hover:text-gray-700 text-2xl ios-button",children:"Ã—"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:p,onChange:e=>f(e.target.value),placeholder:"æœç´¢å…¨ä¸–ç•Œä»»æ„åŸŽå¸‚...",className:"w-full px-4 py-3 pr-24 bg-gray-100 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 text-sm",onKeyDown:e=>{"Enter"===e.key&&p.trim()&&M(p.trim())}}),p&&e.jsx("button",{onClick:()=>M(p.trim()),className:"absolute right-2 top-1/2 -translate-y-1/2 px-4 py-1.5 bg-blue-500 text-white rounded-lg text-xs font-medium ios-button",children:"æœç´¢"})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["ðŸ’¡ è¯·è¾“å…¥",e.jsx("span",{className:"font-semibold text-blue-600",children:"å®Œæ•´"}),"çš„åŸŽå¸‚åç§°ï¼Œå¦‚ï¼šå˜‰å…´ã€Jiaxingã€New York"]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-3",children:"å¸¸ç”¨åŸŽå¸‚"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:[{name:"åŒ—äº¬",value:"Beijing"},{name:"ä¸Šæµ·",value:"Shanghai"},{name:"å¹¿å·ž",value:"Guangzhou"},{name:"æ·±åœ³",value:"Shenzhen"},{name:"æˆéƒ½",value:"Chengdu"},{name:"æ­å·ž",value:"Hangzhou"},{name:"é‡åº†",value:"Chongqing"},{name:"è¥¿å®‰",value:"Xian"},{name:"å—äº¬",value:"Nanjing"},{name:"æ­¦æ±‰",value:"Wuhan"},{name:"å¤©æ´¥",value:"Tianjin"},{name:"è‹å·ž",value:"Suzhou"},{name:"é’å²›",value:"Qingdao"},{name:"åŽ¦é—¨",value:"Xiamen"},{name:"é•¿æ²™",value:"Changsha"},{name:"éƒ‘å·ž",value:"Zhengzhou"},{name:"æµŽå—",value:"Jinan"},{name:"ç¦å·ž",value:"Fuzhou"},{name:"çŸ³å®¶åº„",value:"Shijiazhuang"},{name:"åˆè‚¥",value:"Hefei"},{name:"å¤ªåŽŸ",value:"Taiyuan"},{name:"å—æ˜Œ",value:"Nanchang"},{name:"æ˜†æ˜Ž",value:"Kunming"},{name:"ä¹Œé²æœ¨é½",value:"Urumqi"},{name:"çº½çº¦",value:"New York"},{name:"ä¼¦æ•¦",value:"London"},{name:"å·´é»Ž",value:"Paris"},{name:"ä¸œäº¬",value:"Tokyo"},{name:"é¦–å°”",value:"Seoul"},{name:"æ–°åŠ å¡",value:"Singapore"},{name:"æ‚‰å°¼",value:"Sydney"},{name:"èŽ«æ–¯ç§‘",value:"Moscow"}].map(t=>e.jsx("button",{onClick:()=>M(t.value),className:"px-3 py-2 rounded-lg ios-button text-xs font-medium transition-all "+(u===t.value?"bg-blue-500 text-white":"glass-card text-gray-700 hover:shadow-md"),children:t.name},t.value))})]})]})})]})}},Symbol.toStringTag,{value:"Module"})),vl=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),{currentUser:l}=d(),{characters:i}=n(),c=x(),[m,h]=t.useState(!1),[u,g]=t.useState(!1),[p,f]=t.useState(!1),[b,j]=t.useState(!1),[v,y]=t.useState(!1),[N,w]=t.useState([]),[k,C]=t.useState(0),[S,I]=t.useState(0),[_,M]=t.useState(""),[z,L]=t.useState("image"),[$,A]=t.useState(null),[T,D]=t.useState(0),E=i;t.useEffect(()=>{if($&&N.length>0){const e=setInterval(()=>{const e=Math.floor((Date.now()-$)/1e3);D(e)},1e3);return()=>clearInterval(e)}D(0),A(null)},[$,N.length]);t.useEffect(()=>{const e=localStorage.getItem("musicPlayerBackground"),t=localStorage.getItem("musicPlayerBackgroundType");e&&(M(e),L(t||"image"))},[]);const B=[],P=JSON.parse(localStorage.getItem("customSongs")||"[]"),F=[...P,...B];t.useEffect(()=>{(async()=>{const e=await Promise.all(B.map(async e=>{if(e.lyricsUrl&&!e.lyrics)try{const t=await fetch(e.lyricsUrl);if(t.ok){const s=await t.text();return{...e,lyrics:s}}}catch(t){}return e}));c.setPlaylist([...P,...e])})()},[]),t.useEffect(()=>{F.length>0&&!c.currentSong&&(c.setPlaylist(F),c.setCurrentSong(F[0],0))},[]);const O=c.currentSong||F[0]||{id:0,title:"æš‚æ— æ­Œæ›²",artist:"è¯·ä¸Šä¼ æ­Œæ›²",duration:0,cover:'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="300" height="300"%3E%3Crect fill="%23999" width="300" height="300"/%3E%3Ctext x="50%25" y="50%25" dominant-baseline="middle" text-anchor="middle" font-family="sans-serif" font-size="60" fill="%23fff"%3EðŸŽµ%3C/text%3E%3C/svg%3E'},W=c.isPlaying,R=c.currentTime,U=c.duration,V=c.currentIndex,J=(null==O?void 0:O.lyrics)?(e=>{if(!e)return[];return e.split("\n").map(e=>{const t=e.match(/\[(\d+):(\d+)\.(\d+)\](.*)/);if(t){const e=parseInt(t[1]),s=parseInt(t[2]),a=parseInt(t[3]),r=t[4].trim(),l=60*e+s+a/1e3,n=r.includes("ä½œè¯")||r.includes("ä½œæ›²")||r.includes("ç¼–æ›²")||r.includes("åˆ¶ä½œ")||r.includes("æ··éŸ³")||r.includes("å½•éŸ³")||r.includes("æ¯å¸¦")||r.includes("ç›‘åˆ¶")||r.includes("å‘è¡Œ")||r.includes("ä¼åˆ’")||r.includes("å°é¢")||r.includes("é’¢ç´")||r.includes("å‰ä»–")||r.includes("è´æ–¯")||r.includes("é¼“")||r.includes("å¼¦ä¹");return{time:l,text:r,isMetadata:n}}return null}).filter(e=>null!==e&&""!==e.text.trim()).sort((e,t)=>e.time-t.time)})(O.lyrics):[],H=J.map(e=>e.text),G=e=>`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`;return t.useEffect(()=>{let e;if(W){const t=()=>{C(e=>(e+.5)%360),e=requestAnimationFrame(t)};e=requestAnimationFrame(t)}return()=>{e&&cancelAnimationFrame(e)}},[W]),t.useEffect(()=>{if(J.length>0){let e=0;for(let t=0;t<J.length&&R>=J[t].time;t++)e=t;I(e)}},[R,J]),e.jsxs("div",{className:"h-screen flex flex-col relative overflow-hidden bg-white",children:[r&&e.jsx(ua,{}),e.jsxs("div",{className:"absolute inset-0 "+(r?"top-[44px]":"top-0"),children:[_&&("video"===z?e.jsx("video",{src:_,autoPlay:!0,loop:!0,muted:!0,className:"absolute inset-0 w-full h-full object-cover"}):e.jsx("div",{className:"absolute inset-0 w-full h-full bg-cover bg-center",style:{backgroundImage:`url(${_})`}})),!_&&e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-pink-50 via-purple-50 to-blue-50"}),e.jsx("div",{className:"absolute inset-0 backdrop-blur-sm bg-white/30"})]}),e.jsxs("div",{className:"relative z-10 px-4 py-3 flex items-center justify-between border-b border-gray-100",children:[e.jsx("button",{onClick:()=>a("/desktop",{replace:!0}),className:"w-10 h-10 flex items-center justify-center ios-button",children:e.jsx("svg",{className:"w-6 h-6 text-gray-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("h1",{className:"text-sm font-medium text-gray-700",children:"æ­£åœ¨æ’­æ”¾"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>a("/music-search"),className:"w-10 h-10 flex items-center justify-center ios-button",children:e.jsx("svg",{className:"w-6 h-6 text-gray-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsxs("label",{className:"w-10 h-10 flex items-center justify-center ios-button cursor-pointer",children:[e.jsx("input",{type:"file",accept:"image/*,video/*",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(s){const e=URL.createObjectURL(s);M(e),s.type.startsWith("video/")?L("video"):L("image"),localStorage.setItem("musicPlayerBackground",e),localStorage.setItem("musicPlayerBackgroundType",s.type.startsWith("video/")?"video":"image")}},className:"hidden"}),e.jsx("svg",{className:"w-6 h-6 text-gray-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2zM9 10l12-3"})})]}),e.jsx("button",{onClick:()=>a("/upload-song"),className:"w-10 h-10 flex items-center justify-center ios-button",children:e.jsx("svg",{className:"w-6 h-6 text-gray-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}),e.jsx("button",{onClick:()=>h(!m),className:"w-10 h-10 flex items-center justify-center ios-button",children:e.jsx("svg",{className:"w-5 h-5 text-gray-700",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M15 6H3v2h12V6zm0 4H3v2h12v-2zM3 16h8v-2H3v2zM17 6v8.18c-.31-.11-.65-.18-1-.18-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3V8h3V6h-5z"})})})]})]}),m&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-end",onClick:()=>h(!1),children:e.jsxs("div",{className:"w-full bg-white rounded-t-3xl max-h-[70vh] overflow-hidden",onClick:e=>e.stopPropagation(),children:[e.jsx("div",{className:"p-4 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"æ’­æ”¾åˆ—è¡¨"}),e.jsx("button",{onClick:()=>h(!1),className:"text-gray-400 text-2xl w-8 h-8 flex items-center justify-center",children:"Ã—"})]})}),e.jsx("div",{className:"overflow-y-auto max-h-[calc(70vh-60px)]",children:F.map((t,s)=>e.jsxs("div",{onClick:()=>(e=>{c.setCurrentSong(F[e],e),c.play(),h(!1)})(s),className:"flex items-center gap-3 p-4 border-b border-gray-50 ios-button "+(s===V?"bg-red-50":""),children:[e.jsx("img",{src:t.cover,alt:t.title,className:"w-12 h-12 rounded-lg object-cover"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium "+(s===V?"text-red-500":"text-gray-900"),children:t.title}),e.jsx("div",{className:"text-sm text-gray-500",children:t.artist})]}),s===V&&W&&e.jsxs("div",{className:"flex gap-1 items-end",children:[e.jsx("div",{className:"w-1 h-3 bg-red-500 rounded animate-pulse"}),e.jsx("div",{className:"w-1 h-4 bg-red-500 rounded animate-pulse",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-1 h-2 bg-red-500 rounded animate-pulse",style:{animationDelay:"0.2s"}})]})]},t.id))})]})}),e.jsxs("div",{className:"relative z-10 flex-1 flex flex-col items-center justify-start p-4 pt-4 overflow-y-auto",children:[e.jsxs("div",{className:"mb-4 flex flex-col items-center",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsx("div",{className:"w-14 h-14 rounded-full bg-gradient-to-br from-blue-400 to-blue-600 flex items-center justify-center shadow-lg border-2 border-white",children:e.jsx("img",{src:(null==l?void 0:l.avatar)||"https://i.pravatar.cc/150?img=68",alt:"æˆ‘",className:"w-full h-full rounded-full object-cover"})}),N.map(t=>e.jsx("div",{className:"w-14 h-14 rounded-full bg-gradient-to-br from-pink-400 to-pink-600 flex items-center justify-center shadow-lg border-2 border-white",children:e.jsx("img",{src:t.avatar,alt:t.name,className:"w-full h-full rounded-full object-cover"})},t.id))]}),e.jsx("p",{className:"text-sm text-gray-600 font-medium",children:N.length>0?`ä¸Ž ${N.map(e=>e.name).join("ã€")} ä¸€èµ·å¬äº† ${(e=>{const t=Math.floor(e/3600),s=Math.floor(e%3600/60),a=e%60;return t>0?`${t}å°æ—¶${s}åˆ†é’Ÿ`:s>0?`${s}åˆ†${a}ç§’`:`${a}ç§’`})(T)}`:"ç‚¹å‡»é‚€è¯·æŒ‰é’®é‚€è¯·å¥½å‹ä¸€èµ·å¬æ­Œ"})]}),e.jsxs("div",{className:"relative mb-8 mt-12 w-48 h-48 flex items-center justify-center",children:[e.jsx("div",{className:"absolute transition-opacity duration-500 "+(b?"opacity-0 pointer-events-none":"opacity-100"),onClick:()=>j(!0),children:e.jsx("div",{className:"relative w-48 h-48",children:e.jsx("div",{className:"w-48 h-48 rounded-full backdrop-blur-md bg-white/20 shadow-2xl flex items-center justify-center cursor-pointer border-2 border-white/30",style:{transform:`rotate(${k}deg)`,transition:W?"none":"transform 0.5s"},children:e.jsx("div",{className:"w-[170px] h-[170px] rounded-full overflow-hidden shadow-inner bg-white flex items-center justify-center",children:e.jsx("img",{src:O.cover,alt:O.title,className:"w-full h-full object-contain",onError:e=>{}})})})})}),e.jsx("div",{className:"absolute transition-opacity duration-500 "+(b?"opacity-100":"opacity-0 pointer-events-none"),onClick:()=>j(!1),children:e.jsx("div",{className:"w-48 h-48 flex items-center justify-center cursor-pointer",children:H.length>0?e.jsx("div",{className:"w-full h-full overflow-hidden flex items-center",children:e.jsx("div",{className:"w-full text-center space-y-2 px-4",children:Array.from({length:5},(t,s)=>{const a=H[S-2+s]||"",r=2===s;return e.jsx("p",{className:"text-sm transition-all duration-300 "+(r?"text-gray-900 font-bold text-base scale-110":"text-gray-400 text-xs"),children:a||"Â "},s)})})}):e.jsxs("div",{className:"flex flex-col items-center justify-center text-gray-400",children:[e.jsx("svg",{className:"w-12 h-12 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})}),e.jsx("p",{className:"text-sm",children:"æš‚æ— æ­Œè¯"})]})})})]}),e.jsxs("div",{className:"w-full max-w-md mb-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-1",children:O.title}),e.jsx("p",{className:"text-gray-600 text-base",children:O.artist})]}),e.jsx("button",{onClick:()=>g(!u),className:"w-10 h-10 flex items-center justify-center ios-button",children:e.jsx("svg",{className:"w-6 h-6 "+(u?"text-red-500 fill-current":"text-gray-400"),fill:u?"currentColor":"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})})})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[e.jsxs("button",{onClick:()=>f(!p),className:"flex items-center gap-2 bg-gray-100 rounded-full px-3 py-2 ios-button",children:[e.jsxs("div",{className:"flex -space-x-2",children:[e.jsx("img",{src:(null==l?void 0:l.avatar)||"https://i.pravatar.cc/150?img=68",alt:"æˆ‘",className:"w-7 h-7 rounded-full border-2 border-white"}),E.slice(0,2).map(t=>e.jsx("img",{src:t.avatar,alt:t.name,className:"w-7 h-7 rounded-full border-2 border-white"},t.id))]}),e.jsxs("span",{className:"text-gray-700 text-sm font-medium",children:[E.length+1," äººåœ¨å¬"]})]}),e.jsxs("button",{onClick:()=>y(!0),className:"flex items-center gap-1 bg-red-500 text-white rounded-full px-4 py-2 ios-button",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("span",{className:"text-sm font-medium",children:"é‚€è¯·"})]}),e.jsx("button",{onClick:()=>a("/music-together-chat"),className:"w-9 h-9 flex items-center justify-center bg-white/90 backdrop-blur-sm text-red-500 rounded-full ios-button shadow-md hover:shadow-lg transition-all",title:"ä¸€èµ·å¬èŠå¤©",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})})]})]}),e.jsxs("div",{className:"w-full max-w-md mb-5",children:[e.jsx("input",{type:"range",min:"0",max:U||0,value:R,onChange:e=>{const t=parseFloat(e.target.value);c.seek(t)},className:"w-full h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer slider",style:{background:`linear-gradient(to right, #EF4444 0%, #EF4444 ${R/U*100}%, #E5E7EB ${R/U*100}%, #E5E7EB 100%)`}}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-2",children:[e.jsx("span",{children:G(R)}),e.jsx("span",{children:G(U||O.duration)})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-8 mb-6",children:[e.jsx("button",{onClick:()=>{c.previous()},className:"w-12 h-12 flex items-center justify-center ios-button hover:scale-110 transition-transform",children:e.jsx("svg",{className:"w-8 h-8 text-gray-700",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M6 6h2v12H6zm3.5 6l8.5 6V6z"})})}),e.jsx("button",{onClick:()=>{c.togglePlay()},className:"w-16 h-16 bg-red-500 rounded-full flex items-center justify-center shadow-lg ios-button hover:scale-110 transition-transform",children:W?e.jsx("svg",{className:"w-8 h-8 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M6 4h4v16H6V4zm8 0h4v16h-4V4z"})}):e.jsx("svg",{className:"w-8 h-8 text-white ml-1",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M8 5v14l11-7z"})})}),e.jsx("button",{onClick:()=>{c.next()},className:"w-12 h-12 flex items-center justify-center ios-button hover:scale-110 transition-transform",children:e.jsx("svg",{className:"w-8 h-8 text-gray-700",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"})})})]})]}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-end",onClick:()=>f(!1),children:e.jsxs("div",{className:"w-full bg-white rounded-t-3xl p-6",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"æ­£åœ¨ä¸€èµ·å¬"}),e.jsx("button",{onClick:()=>f(!1),className:"text-gray-400 text-2xl w-8 h-8 flex items-center justify-center",children:"Ã—"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:(null==l?void 0:l.avatar)||"https://i.pravatar.cc/150?img=68",alt:"æˆ‘",className:"w-12 h-12 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-gray-900 font-medium",children:(null==l?void 0:l.name)||"æˆ‘"}),e.jsx("div",{className:"text-gray-500 text-sm",children:"æ­£åœ¨æ”¶å¬"})]}),e.jsxs("div",{className:"flex gap-1 items-end",children:[e.jsx("div",{className:"w-1 h-4 bg-red-500 rounded animate-pulse"}),e.jsx("div",{className:"w-1 h-3 bg-red-500 rounded animate-pulse",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-1 h-5 bg-red-500 rounded animate-pulse",style:{animationDelay:"0.2s"}})]})]}),E.map(t=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:t.avatar,alt:t.name,className:"w-12 h-12 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-gray-900 font-medium",children:t.name}),e.jsx("div",{className:"text-gray-500 text-sm",children:"æ­£åœ¨æ”¶å¬"})]}),e.jsxs("div",{className:"flex gap-1 items-end",children:[e.jsx("div",{className:"w-1 h-4 bg-red-500 rounded animate-pulse"}),e.jsx("div",{className:"w-1 h-3 bg-red-500 rounded animate-pulse",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-1 h-5 bg-red-500 rounded animate-pulse",style:{animationDelay:"0.2s"}})]})]},t.id))]})]})}),v&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-end",onClick:()=>y(!1),children:e.jsxs("div",{className:"w-full bg-white rounded-t-3xl p-6 max-h-[70vh] overflow-hidden",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"é‚€è¯·ä¸€èµ·å¬æ­Œ"}),e.jsx("button",{onClick:()=>y(!1),className:"text-gray-400 text-2xl w-8 h-8 flex items-center justify-center",children:"Ã—"})]}),e.jsx("div",{className:"overflow-y-auto max-h-[calc(70vh-80px)]",children:e.jsx("div",{className:"space-y-3",children:E.map(t=>e.jsxs("div",{onClick:()=>(e=>{if(!O||0===O.id)return void alert("è¯·å…ˆæ’­æ”¾ä¸€é¦–æ­Œæ›²");const t={id:Date.now(),type:"sent",messageType:"musicInvite",content:`[ä¸€èµ·å¬é‚€è¯·]æˆ‘æƒ³å’Œä½ ä¸€èµ·å¬ã€Š${O.title}ã€‹`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),musicInvite:{songTitle:O.title,songArtist:O.artist,songCover:O.cover,inviterName:(null==l?void 0:l.username)||"æˆ‘",status:"pending"},timestamp:Date.now()},s=`chat_${e.id}`,r=JSON.parse(localStorage.getItem(s)||"[]");localStorage.setItem(s,JSON.stringify([...r,t])),y(!1),a(`/chat/${e.id}`)})(t),className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg ios-button",children:[e.jsx("img",{src:t.avatar,alt:t.name,className:"w-12 h-12 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-gray-900 font-medium",children:t.name}),e.jsx("div",{className:"text-sm text-gray-500",children:"ç‚¹å‡»é‚€è¯·"})]}),N.find(e=>e.id===t.id)&&e.jsx("svg",{className:"w-6 h-6 text-red-500",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})})]},t.id))})})]})}),e.jsx("style",{children:"\n        .slider::-webkit-slider-thumb {\n          appearance: none;\n          width: 12px;\n          height: 12px;\n          border-radius: 50%;\n          background: #EF4444;\n          cursor: pointer;\n          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);\n        }\n\n        .slider::-moz-range-thumb {\n          width: 12px;\n          height: 12px;\n          border-radius: 50%;\n          background: #EF4444;\n          cursor: pointer;\n          border: none;\n          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);\n        }\n\n        @keyframes ping {\n          75%, 100% {\n            transform: scale(1.1);\n            opacity: 0;\n          }\n        }\n\n        .animate-ping {\n          animation: ping 2s cubic-bezier(0, 0, 0.2, 1) infinite;\n        }\n      "})]})}},Symbol.toStringTag,{value:"Module"})),yl=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),[l,n]=t.useState({title:"",artist:"",album:"",cover:"",audioFile:null,lyrics:""}),[i,c]=t.useState(""),[d,x]=t.useState(""),[m,h]=t.useState("");return e.jsxs("div",{className:"h-screen flex flex-col bg-white",children:[r&&e.jsx(ua,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between border-b border-gray-100",children:[e.jsx("button",{onClick:()=>a(-1),className:"w-10 h-10 flex items-center justify-center ios-button",children:e.jsx("svg",{className:"w-6 h-6 text-gray-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"ä¸Šä¼ æ­Œæ›²"}),e.jsx("button",{onClick:()=>{if(!l.title||!l.artist||!l.audioFile)return void alert("è¯·å¡«å†™æ­Œæ›²åç§°ã€è‰ºæœ¯å®¶å¹¶ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶");const e=JSON.parse(localStorage.getItem("customSongs")||"[]"),t={id:Date.now(),title:l.title,artist:l.artist,album:l.album||"æœªçŸ¥ä¸“è¾‘",cover:l.cover||"https://via.placeholder.com/300",audioUrl:d,lyrics:l.lyrics,duration:0,isCustom:!0};e.push(t),localStorage.setItem("customSongs",JSON.stringify(e)),alert("æ­Œæ›²ä¸Šä¼ æˆåŠŸï¼"),a("/music-player")},className:"text-red-500 font-medium text-base",children:"ä¿å­˜"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ä¸“è¾‘å°é¢"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-24 h-24 bg-gray-100 rounded-lg overflow-hidden flex items-center justify-center",children:i?e.jsx("img",{src:i,alt:"å°é¢é¢„è§ˆ",className:"w-full h-full object-cover"}):e.jsx("svg",{className:"w-10 h-10 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsxs("label",{className:"flex-1",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(s){const e=new FileReader;e.onloadend=()=>{c(e.result),n({...l,cover:e.result})},e.readAsDataURL(s)}},className:"hidden"}),e.jsx("div",{className:"bg-gray-100 text-gray-700 px-4 py-2 rounded-lg text-center cursor-pointer hover:bg-gray-200",children:"é€‰æ‹©å›¾ç‰‡"})]})]})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["æ­Œæ›²åç§° ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:l.title,onChange:e=>n({...l,title:e.target.value}),placeholder:"è¯·è¾“å…¥æ­Œæ›²åç§°",className:"w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["è‰ºæœ¯å®¶ ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:l.artist,onChange:e=>n({...l,artist:e.target.value}),placeholder:"è¯·è¾“å…¥è‰ºæœ¯å®¶åç§°",className:"w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ä¸“è¾‘åç§°"}),e.jsx("input",{type:"text",value:l.album,onChange:e=>n({...l,album:e.target.value}),placeholder:"è¯·è¾“å…¥ä¸“è¾‘åç§°ï¼ˆå¯é€‰ï¼‰",className:"w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["éŸ³é¢‘æ–‡ä»¶ ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("label",{className:"block",children:[e.jsx("input",{type:"file",accept:"audio/*",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(s){const e=URL.createObjectURL(s);x(e),n({...l,audioFile:s})}},className:"hidden"}),e.jsx("div",{className:"bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg p-6 text-center cursor-pointer hover:border-red-500 hover:bg-red-50",children:l.audioFile?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-6 h-6 text-red-500",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"})}),e.jsx("span",{className:"text-gray-700 font-medium",children:l.audioFile.name})]}):e.jsxs("div",{children:[e.jsx("svg",{className:"w-12 h-12 text-gray-400 mx-auto mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),e.jsx("p",{className:"text-gray-600",children:"ç‚¹å‡»ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"æ”¯æŒ MP3ã€WAVã€OGG ç­‰æ ¼å¼"})]})})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"æ­Œè¯ï¼ˆå¯é€‰ï¼‰"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("input",{type:"file",accept:".lrc,.txt",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(s){h(s.name);const e=new FileReader;e.onload=e=>{var t;const s=null==(t=e.target)?void 0:t.result;n({...l,lyrics:s})},e.readAsText(s)}},className:"hidden",id:"lyricsFileInput"}),e.jsxs("label",{htmlFor:"lyricsFileInput",className:"inline-flex items-center gap-2 bg-gray-100 text-gray-700 px-4 py-2 rounded-lg cursor-pointer hover:bg-gray-200 transition-colors",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),e.jsx("span",{className:"text-sm",children:m||"ä¸Šä¼ æ­Œè¯æ–‡ä»¶ (.lrc/.txt)"})]})]}),e.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"æˆ–æ‰‹åŠ¨è¾“å…¥æ­Œè¯ï¼š"}),e.jsx("textarea",{value:l.lyrics,onChange:e=>n({...l,lyrics:e.target.value}),placeholder:"è¯·è¾“å…¥æ­Œè¯ï¼Œæ¯è¡Œä¸€å¥",rows:8,className:"w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 resize-none"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"æç¤ºï¼šæ¯è¡Œè¾“å…¥ä¸€å¥æ­Œè¯ï¼Œæ’­æ”¾æ—¶ä¼šè‡ªåŠ¨æ»šåŠ¨æ˜¾ç¤º"})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})}),e.jsxs("div",{className:"text-sm text-blue-700",children:[e.jsx("p",{className:"font-medium mb-1",children:"ä¸Šä¼ è¯´æ˜Ž"}),e.jsxs("ul",{className:"space-y-1 text-blue-600",children:[e.jsx("li",{children:"â€¢ æ­Œæ›²åç§°å’Œè‰ºæœ¯å®¶ä¸ºå¿…å¡«é¡¹"}),e.jsx("li",{children:"â€¢ å¿…é¡»ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶æ‰èƒ½ä¿å­˜"}),e.jsx("li",{children:"â€¢ å°é¢å›¾ç‰‡å’Œæ­Œè¯ä¸ºå¯é€‰é¡¹"}),e.jsx("li",{children:"â€¢ ä¸Šä¼ çš„æ­Œæ›²ä¼šä¿å­˜åœ¨æœ¬åœ°"})]})]})]})})]})]})}},Symbol.toStringTag,{value:"Module"})),Nl=({content:t})=>e.jsxs("div",{className:"w-full h-full bg-white/30 backdrop-blur-xl rounded-3xl overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-white/30 bg-white/20",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"é€šè®¯å½•"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[t.contacts.length," ä½è”ç³»äºº"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-2",children:t.contacts.map((t,s)=>e.jsxs("div",{className:"bg-white/50 backdrop-blur-md rounded-2xl p-4 border border-white/50 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-400/30 to-purple-400/30 flex items-center justify-center",children:e.jsx("span",{className:"text-lg font-medium text-gray-700",children:t.name[0]})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-800",children:t.name}),e.jsx("div",{className:"text-xs text-gray-500",children:t.relation})]})]}),e.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:[e.jsx("div",{children:t.phone}),t.notes&&e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:t.notes})]})]},s))})]}),wl=({content:s})=>{const[a,r]=t.useState(null);if(null!==a){const t=s.wechatChats[a];return e.jsxs("div",{className:"w-full h-full bg-white/30 backdrop-blur-xl rounded-3xl overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-white/30 bg-white/20 flex items-center gap-3",children:[e.jsx("button",{onClick:()=>r(null),className:"w-8 h-8 rounded-full hover:bg-white/30 flex items-center justify-center",children:e.jsx(ha,{size:20,className:"text-gray-700"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-gradient-to-br from-green-400/30 to-green-500/30 flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-medium text-gray-700",children:t.name[0]})}),e.jsx("h2",{className:"text-base font-semibold text-gray-800",children:t.name})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:t.messages.map((t,s)=>e.jsx("div",{className:"flex "+(t.isSelf?"justify-end":"justify-start"),children:e.jsxs("div",{className:"max-w-[75%] "+(t.isSelf?"order-2":"order-1"),children:[e.jsx("div",{className:`rounded-2xl px-4 py-2 ${t.isSelf?"bg-green-500/80 text-white":"bg-white/70 text-gray-800"} shadow-sm`,children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:t.content})}),e.jsx("div",{className:"text-xs text-gray-500 mt-1 px-2 "+(t.isSelf?"text-right":"text-left"),children:t.time})]})},s))})]})}return e.jsxs("div",{className:"w-full h-full bg-white/30 backdrop-blur-xl rounded-3xl overflow-hidden flex flex-col",children:[e.jsx("div",{className:"px-6 py-4 border-b border-white/30 bg-white/20",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"å¾®ä¿¡"})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:s.wechatChats.map((t,s)=>e.jsx("div",{onClick:()=>r(s),className:"px-4 py-3 border-b border-white/20 hover:bg-white/20 transition-colors cursor-pointer active:bg-white/30",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-green-400/30 to-green-500/30 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-lg font-medium text-gray-700",children:t.name[0]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"font-medium text-gray-800 truncate",children:t.name}),e.jsx("span",{className:"text-xs text-gray-400 ml-2",children:t.time})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-gray-600 truncate flex-1",children:t.lastMessage}),t.unread>0&&e.jsx("span",{className:"ml-2 px-2 py-0.5 bg-red-500 text-white text-xs rounded-full flex-shrink-0",children:t.unread})]})]})]})},s))})]})},kl=({content:t})=>e.jsxs("div",{className:"w-full h-full bg-white/30 backdrop-blur-xl rounded-3xl overflow-hidden flex flex-col",children:[e.jsx("div",{className:"px-4 py-3 border-b border-white/30 bg-white/20",children:e.jsxs("div",{className:"bg-white/50 rounded-full px-4 py-2 text-sm text-gray-600 flex items-center gap-2",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("path",{d:"m21 21-4.35-4.35"})]}),e.jsx("span",{children:"æœç´¢æˆ–è¾“å…¥ç½‘å€"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"æœ€è¿‘è®¿é—®"}),e.jsx("div",{className:"space-y-2",children:t.browserHistory.map((t,s)=>e.jsxs("div",{className:"bg-white/50 backdrop-blur-md rounded-xl p-3 border border-white/50 shadow-sm",children:[e.jsx("div",{className:"font-medium text-gray-800 text-sm mb-1",children:t.title}),e.jsx("div",{className:"text-xs text-gray-500 truncate",children:t.url}),t.reason&&e.jsxs("div",{className:"text-xs text-gray-600 mt-1 italic",children:["æœç´¢åŽŸå› : ",t.reason]}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:t.time})]},s))})]})]}),Cl=({content:t})=>e.jsxs("div",{className:"w-full h-full bg-white/30 backdrop-blur-xl rounded-3xl overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-white/30 bg-gradient-to-r from-orange-400/20 to-red-400/20",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"æ·˜å®"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"æˆ‘çš„è®¢å•"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:t.taobaoOrders.map((t,s)=>e.jsx("div",{className:"bg-white/60 backdrop-blur-md rounded-2xl p-4 border border-orange-200/50 shadow-sm",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-16 h-16 rounded-lg bg-gradient-to-br from-orange-200/60 to-red-200/40 flex items-center justify-center flex-shrink-0",children:e.jsxs("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"}),e.jsx("polyline",{points:"3.27 6.96 12 12.01 20.73 6.96"}),e.jsx("line",{x1:"12",y1:"22.08",x2:"12",y2:"12"})]})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-gray-800 mb-1",children:t.title}),t.reason&&e.jsxs("p",{className:"text-xs text-gray-600 mb-2",children:["è´­ä¹°åŽŸå› : ",t.reason]}),t.thought&&e.jsxs("p",{className:"text-xs text-gray-500 italic mb-2",children:['"',t.thought,'"']}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-lg font-bold text-orange-600",children:["Â¥",t.price]}),e.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-orange-100 text-orange-700",children:t.status})]})]})]})},s))})]}),Sl=({content:t})=>e.jsxs("div",{className:"w-full h-full bg-white/30 backdrop-blur-xl rounded-3xl overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-white/30 bg-gradient-to-r from-blue-400/20 to-blue-500/20",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"æ”¯ä»˜å®"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"è´¦å•è®°å½•"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-2",children:t.alipayBills.map((t,s)=>e.jsx("div",{className:"bg-white/60 backdrop-blur-md rounded-xl p-4 border border-blue-200/50 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full ${"income"===t.type?"bg-green-400/30":"bg-red-400/30"} flex items-center justify-center`,children:"income"===t.type?e.jsx("span",{className:"text-green-600 font-bold",children:"+"}):e.jsx("span",{className:"text-red-600 font-bold",children:"-"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-800",children:t.title}),t.reason&&e.jsx("div",{className:"text-xs text-gray-600 mt-0.5",children:t.reason}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:t.time})]})]}),e.jsxs("div",{className:"text-lg font-bold "+("income"===t.type?"text-green-600":"text-gray-800"),children:["income"===t.type?"+":"-","Â¥",t.amount]})]})},s))})]}),Il=({content:t})=>e.jsxs("div",{className:"w-full h-full bg-white/30 backdrop-blur-xl rounded-3xl overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-white/30 bg-white/20",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"ç›¸å†Œ"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[t.photos.length," å¼ ç…§ç‰‡"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 grid grid-cols-2 gap-3",children:t.photos.map((t,s)=>e.jsxs("div",{className:"bg-gradient-to-br from-pink-100/60 to-purple-100/40 backdrop-blur-md rounded-2xl p-3 border border-pink-200/50 shadow-sm aspect-square flex flex-col justify-between",children:[e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"}),e.jsx("circle",{cx:"12",cy:"13",r:"4"})]})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-800",children:t.description}),t.location&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["ä½ç½®: ",t.location]}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:t.time})]})]},s))})]}),_l=({content:t})=>e.jsxs("div",{className:"w-full h-full bg-white/30 backdrop-blur-xl rounded-3xl overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-white/30 bg-white/20",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"å¤‡å¿˜å½•"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[t.notes.length," æ¡å¤‡å¿˜"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:t.notes.map((t,s)=>e.jsxs("div",{className:"bg-gradient-to-br from-yellow-100/60 to-yellow-50/40 backdrop-blur-md rounded-2xl p-4 border border-yellow-200/50 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-medium text-gray-800",children:t.title}),e.jsx("span",{className:"text-xs text-gray-500",children:t.time})]}),e.jsx("p",{className:"text-sm text-gray-600 whitespace-pre-wrap",children:t.content})]},s))})]}),Ml=({content:t})=>e.jsxs("div",{className:"w-full h-full bg-white/30 backdrop-blur-xl rounded-3xl overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-white/30 bg-white/20",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"éŸ³ä¹"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"æˆ‘çš„æ­Œå•"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-2",children:t.musicPlaylist.map((t,s)=>e.jsx("div",{className:"bg-gradient-to-r from-red-100/60 to-pink-100/40 backdrop-blur-md rounded-xl p-4 border border-red-200/50 shadow-sm hover:shadow-md transition-all",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-red-400/40 to-pink-400/40 flex items-center justify-center flex-shrink-0",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M9 18V5l12-2v13"}),e.jsx("circle",{cx:"6",cy:"18",r:"3"}),e.jsx("circle",{cx:"18",cy:"16",r:"3"})]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-800 truncate",children:t.title}),e.jsx("div",{className:"text-sm text-gray-600 truncate",children:t.artist}),t.mood&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["å¿ƒæƒ…: ",t.mood]})]})]})},s))})]}),zl=({content:t})=>e.jsxs("div",{className:"w-full h-full bg-white/30 backdrop-blur-xl rounded-3xl overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-white/30 bg-gradient-to-r from-blue-400/20 to-purple-400/20",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"ä»Šæ—¥è¶³è¿¹"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"è®°å½•TAçš„ä¸€å¤©"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-[22px] top-4 bottom-4 w-0.5 bg-gradient-to-b from-blue-300 to-purple-300"}),e.jsx("div",{className:"space-y-4",children:t.footprints.map((t,s)=>e.jsxs("div",{className:"relative pl-12",children:[e.jsx("div",{className:"absolute left-0 top-0 w-11 h-11 rounded-full bg-gradient-to-br from-blue-400/40 to-purple-400/40 backdrop-blur-md border-2 border-white flex items-center justify-center shadow-lg",children:e.jsx("span",{className:"text-xs font-bold text-gray-700",children:t.time})}),e.jsx("div",{className:"bg-white/60 backdrop-blur-md rounded-2xl p-4 border border-blue-200/50 shadow-md hover:shadow-lg transition-shadow",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-green-400/30 flex items-center justify-center",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"}),e.jsx("circle",{cx:"12",cy:"10",r:"3"})]})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-800 text-base",children:t.location}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:t.address}),e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"æ—¶é•¿:"}),e.jsxs("span",{className:"text-gray-700",children:["åœç•™ ",t.duration]})]}),e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"æ´»åŠ¨:"}),e.jsx("span",{className:"text-gray-700 flex-1",children:t.activity})]}),t.mood&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"å¿ƒæƒ…:"}),e.jsx("span",{className:"text-gray-600",children:t.mood})]}),t.companion&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"åŒè¡Œ:"}),e.jsxs("span",{className:"text-gray-600",children:["å’Œ ",t.companion]})]})]})]})]})})]},s))})]})})]}),Ll=({onClose:s,characterId:a,characterName:r,forceNew:l=!0,historyContent:n})=>{const[i,c]=t.useState(null),[o,d]=t.useState(new Date),[x,m]=t.useState(null),[h,u]=t.useState(!0);t.useEffect(()=>{const e=setInterval(()=>{d(new Date)},1e3);return()=>clearInterval(e)},[]),t.useEffect(()=>{(async()=>{if(n)return m(n),void u(!1);u(!0);try{const e=await Nt(a,r,l);m(e)}catch(e){}finally{u(!1)}})()},[a,r,l,n]);const g=[{id:"contacts",name:"é€šè®¯å½•",IconComponent:rs,color:"from-gray-300/50 to-gray-400/50",onClick:()=>c("contacts")},{id:"wechat",name:"å¾®ä¿¡",IconComponent:as,color:"from-green-300/50 to-green-400/50",onClick:()=>c("wechat")},{id:"browser",name:"æµè§ˆå™¨",IconComponent:Gs,color:"from-blue-300/50 to-blue-400/50",onClick:()=>c("browser")},{id:"taobao",name:"æ·˜å®",IconComponent:ca,color:"from-orange-300/50 to-orange-400/50",onClick:()=>c("taobao")},{id:"alipay",name:"æ”¯ä»˜å®",IconComponent:oa,color:"from-blue-400/50 to-blue-500/50",onClick:()=>c("alipay")},{id:"photos",name:"ç›¸å†Œ",IconComponent:us,color:"from-pink-300/50 to-pink-400/50",onClick:()=>c("photos")},{id:"notes",name:"å¤‡å¿˜å½•",IconComponent:da,color:"from-yellow-300/50 to-yellow-400/50",onClick:()=>c("notes")},{id:"music",name:"éŸ³ä¹",IconComponent:Ws,color:"from-red-300/50 to-red-400/50",onClick:()=>c("music")},{id:"footprints",name:"è¶³è¿¹",IconComponent:$s,color:"from-green-400/50 to-green-500/50",onClick:()=>c("footprints")}];return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:s}),e.jsxs("div",{className:"relative w-full max-w-md h-[80vh] max-h-[800px] bg-gradient-to-br from-white/95 to-white/80 backdrop-blur-2xl rounded-[3rem] shadow-[0_8px_32px_rgba(0,0,0,0.1)] border border-white/60 overflow-hidden",children:[e.jsxs("div",{className:"absolute top-0 left-0 right-0 h-14 bg-white/40 backdrop-blur-xl border-b border-white/40 flex items-center justify-between px-6 z-10",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-800",children:[r,"çš„æ‰‹æœº"]}),e.jsx("button",{onClick:s,className:"w-8 h-8 rounded-full bg-white/60 hover:bg-white/80 flex items-center justify-center transition-all shadow-sm",children:e.jsx(ma,{size:18,className:"text-gray-700"})})]}),e.jsx("div",{className:"absolute top-14 bottom-8 left-0 right-0",children:h?e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center",children:[e.jsx("div",{className:"animate-spin w-16 h-16 border-4 border-gray-300 border-t-gray-700 rounded-full mb-4"}),e.jsxs("p",{className:"text-gray-600 font-medium",children:["æ­£åœ¨ç”Ÿæˆ",r,"çš„æ‰‹æœºå†…å®¹..."]}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:"æ ¹æ®èŠå¤©è®°å½•å’Œæ€§æ ¼å®šåˆ¶ä¸­"})]}):i?e.jsxs("div",{className:"w-full h-full relative",children:[e.jsx("button",{onClick:()=>c(null),className:"absolute top-4 left-4 z-10 w-10 h-10 rounded-full bg-white/80 hover:bg-white/95 flex items-center justify-center transition-all shadow-lg backdrop-blur-md border border-white/50",children:e.jsx(ha,{size:20,className:"text-gray-700"})}),(t=>{if(!x)return e.jsxs("div",{className:"w-full h-full bg-white/30 backdrop-blur-xl rounded-3xl p-6 flex flex-col items-center justify-center",children:[e.jsx("div",{className:"animate-spin w-12 h-12 border-3 border-gray-400 border-t-transparent rounded-full mb-4"}),e.jsx("p",{className:"text-gray-600 text-center font-medium",children:"åŠ è½½ä¸­..."})]});switch(t){case"contacts":return e.jsx(Nl,{content:x});case"wechat":return e.jsx(wl,{content:x});case"browser":return e.jsx(kl,{content:x});case"taobao":return e.jsx(Cl,{content:x});case"alipay":return e.jsx(Sl,{content:x});case"photos":return e.jsx(Il,{content:x});case"notes":return e.jsx(_l,{content:x});case"music":return e.jsx(Ml,{content:x});case"footprints":return e.jsx(zl,{content:x});default:return e.jsx("div",{className:"w-full h-full bg-white/30 backdrop-blur-xl rounded-3xl p-6 flex flex-col items-center justify-center",children:e.jsx("p",{className:"text-gray-600 text-center font-medium",children:"æœªçŸ¥åº”ç”¨"})})}})(i)]}):e.jsxs("div",{className:"w-full h-full p-6 overflow-y-auto hide-scrollbar",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"text-6xl font-bold text-gray-800 mb-1",children:o.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})}),e.jsx("div",{className:"text-sm text-gray-500",children:o.toLocaleDateString("zh-CN",{month:"long",day:"numeric",weekday:"long"})})]}),e.jsx("div",{className:"grid grid-cols-3 gap-6",children:g.map(t=>{const s=t.IconComponent;return e.jsxs("button",{onClick:t.onClick,className:"flex flex-col items-center gap-2 ios-button",children:[e.jsx("div",{className:`w-16 h-16 bg-gradient-to-br ${t.color} backdrop-blur-md rounded-2xl shadow-lg border border-white/60 flex items-center justify-center hover:scale-105 transition-transform`,children:e.jsx(s,{size:28,className:"text-gray-700"})}),e.jsx("span",{className:"text-xs text-gray-800 font-medium text-center",children:t.name})]},t.id)})})]})}),e.jsx("div",{className:"absolute bottom-4 left-0 right-0 flex justify-center",children:e.jsx("div",{className:"w-32 h-1 bg-gray-900 rounded-full opacity-30"})})]})]})},$l=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{characters:r}=n(),[l,i]=t.useState(null),[c,o]=t.useState(null),[d,x]=t.useState([]),[m,h]=t.useState(0);t.useEffect(()=>{if(h(e=>e+1),r.length>0){const e=r.find(e=>wt(e.id).length>0);e&&o(e.id)}},[r]),t.useEffect(()=>{const e=kt.subscribe(e=>{x(e),e.some(e=>"completed"===e.status)&&h(e=>e+1)});return()=>{e()}},[]);return e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-gray-50 to-white",children:[e.jsx(ua,{}),e.jsx("div",{className:"sticky top-0 z-10 bg-white/80 backdrop-blur-lg border-b border-gray-200/50",children:e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsx("button",{onClick:()=>a(-1),className:"w-10 h-10 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center transition-colors",children:e.jsx(os,{size:20,className:"text-gray-700"})}),e.jsx("h1",{className:"text-lg font-semibold text-gray-800",children:"é€‰æ‹©è§’è‰²"}),e.jsx("div",{className:"w-10"})]})}),e.jsx("div",{className:"p-4 space-y-3",children:0===r.length?e.jsxs("div",{className:"text-center py-20",children:[e.jsx("div",{className:"text-gray-400 mb-2",children:"æš‚æ— è§’è‰²"}),e.jsx("div",{className:"text-sm text-gray-300",children:"è¯·å…ˆåœ¨å¾®ä¿¡ä¸­æ·»åŠ AIè§’è‰²"})]}):r.map(t=>{const s=wt(t.id),a=c===t.id;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsxs("button",{onClick:()=>(e=>{kt.startGeneration(e.id,e.name)})(t),className:"w-full p-4 flex items-center gap-4 hover:bg-gray-50 transition-all ios-button",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-blue-400/20 to-purple-400/20 flex items-center justify-center flex-shrink-0",children:t.avatar?e.jsx("img",{src:t.avatar,alt:t.name,className:"w-full h-full rounded-full object-cover"}):e.jsx("span",{className:"text-2xl text-gray-400",children:t.name[0]})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsxs("div",{className:"text-lg font-medium text-gray-800 flex items-center gap-2",children:[t.name,s.length>0&&!a&&e.jsxs("span",{className:"text-xs px-2 py-0.5 bg-blue-100 text-blue-600 rounded-full",children:[s.length,"æ¡è®°å½•"]})]}),e.jsx("div",{className:"text-sm text-green-600 mt-1",children:"ç”Ÿæˆæ–°å†…å®¹"})]}),e.jsx("div",{className:"text-gray-300",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M9 18l6-6-6-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),s.length>0&&e.jsxs("button",{onClick:()=>{return e=t.id,void o(c===e?null:e);var e},className:"w-full px-4 py-2 border-t border-gray-100 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["åŽ†å²è®°å½• (",s.length,")"]}),e.jsx("svg",{className:"w-4 h-4 text-gray-400 transition-transform "+(a?"rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]}),a&&s.length>0&&e.jsx("div",{className:"ml-4 space-y-2",children:s.map(t=>e.jsxs("button",{onClick:()=>(e=>{i(e)})(t),className:"w-full bg-gray-50 rounded-xl p-3 border border-gray-200 hover:bg-gray-100 transition-all flex items-center gap-3 text-left",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-gradient-to-br from-gray-300/30 to-gray-400/30 flex items-center justify-center",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"5",y:"2",width:"14",height:"20",rx:"2",ry:"2"}),e.jsx("line",{x1:"12",y1:"18",x2:"12",y2:"18"})]})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:new Date(t.timestamp).toLocaleString("zh-CN",{month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"})}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"ç‚¹å‡»æŸ¥çœ‹æ­¤æ¬¡è®°å½•"})]}),e.jsx("div",{className:"text-gray-300",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M9 18l6-6-6-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]},t.id))})]},`${t.id}-${m}`)})}),d.length>0&&e.jsx("div",{className:"fixed bottom-4 right-4 z-50 space-y-2",children:d.map(t=>e.jsx("div",{className:"px-4 py-3 rounded-xl shadow-lg border backdrop-blur-md "+("generating"===t.status?"bg-blue-50/90 border-blue-200":"completed"===t.status?"bg-green-50/90 border-green-200":"bg-red-50/90 border-red-200"),children:e.jsxs("div",{className:"flex items-center gap-3",children:["generating"===t.status&&e.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full"}),"completed"===t.status&&e.jsx("div",{className:"text-green-500",children:"âœ“"}),"failed"===t.status&&e.jsx("div",{className:"text-red-500",children:"âœ•"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-800",children:t.characterName}),e.jsxs("div",{className:"text-xs text-gray-600 mt-0.5",children:["generating"===t.status&&"æ­£åœ¨åŽå°ç”Ÿæˆæ‰‹æœºå†…å®¹...","completed"===t.status&&"ç”Ÿæˆå®Œæˆï¼","failed"===t.status&&"ç”Ÿæˆå¤±è´¥"]})]})]})},t.characterId))}),l&&e.jsx(Ll,{characterId:l.characterId,characterName:l.characterName,onClose:()=>i(null),forceNew:!1,historyContent:l.content})]})}},Symbol.toStringTag,{value:"Module"})),Al=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),l=x(),[n,i]=t.useState(""),[c,d]=t.useState([]),[m,h]=t.useState([]),[u,g]=t.useState([]),[p,f]=t.useState(!1),[b,j]=t.useState("local"),[v,y]=t.useState(!0);t.useEffect(()=>{const e=JSON.parse(localStorage.getItem("musicSearchHistory")||"[]");d(e)},[]);const N=async()=>{n.trim()&&(y(!1),(e=>{const t=[e,...c.filter(t=>t!==e)].slice(0,10);d(t),localStorage.setItem("musicSearchHistory",JSON.stringify(t))})(n),(e=>{if(!e.trim())return void h([]);const t=[...JSON.parse(localStorage.getItem("customSongs")||"[]")],s=e.toLowerCase(),a=t.filter(e=>e.title.toLowerCase().includes(s)||e.artist.toLowerCase().includes(s)||e.album.toLowerCase().includes(s));h(a)})(n),await(async e=>{if(e.trim()){f(!0);try{const t=await Sa(e);g(t)}catch(t){g([])}finally{f(!1)}}else g([])})(n))};return e.jsxs("div",{className:"h-screen flex flex-col bg-gray-50",children:[r&&e.jsx(ua,{}),e.jsx("div",{className:"bg-white px-4 py-3 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-2 flex-nowrap",children:[e.jsx("button",{onClick:()=>a("/music-player",{replace:!0}),className:"w-10 h-10 flex items-center justify-center ios-button flex-shrink-0",children:e.jsx("svg",{className:"w-6 h-6 text-gray-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsxs("div",{className:"flex-1 min-w-0 flex items-center bg-gray-100 rounded-lg px-3 py-2",children:[e.jsx("svg",{className:"w-5 h-5 text-gray-400 mr-2 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),e.jsx("input",{type:"text",value:n,onChange:e=>i(e.target.value),onKeyPress:e=>"Enter"===e.key&&N(),placeholder:"æœç´¢æ­Œæ›²ã€æ­Œæ‰‹",className:"flex-1 min-w-0 bg-transparent outline-none text-gray-900 placeholder-gray-400",autoFocus:!0}),n&&e.jsx("button",{onClick:()=>{i(""),h([]),g([]),y(!0)},className:"ml-2 flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})})})]}),e.jsx("button",{onClick:N,className:"text-red-500 font-medium px-2 py-2 flex-shrink-0 whitespace-nowrap",children:"æœç´¢"})]})}),v&&c.length>0&&e.jsxs("div",{className:"bg-white p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"æœç´¢åŽ†å²"}),e.jsx("button",{onClick:()=>{d([]),localStorage.removeItem("musicSearchHistory")},className:"text-xs text-gray-400 hover:text-gray-600",children:"æ¸…é™¤"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:c.map((t,s)=>e.jsx("button",{onClick:()=>{i(t),N()},className:"bg-gray-100 text-gray-700 px-3 py-1.5 rounded-full text-sm hover:bg-gray-200",children:t},s))})]}),!v&&e.jsx("div",{className:"bg-white border-b border-gray-100",children:e.jsxs("div",{className:"flex",children:[e.jsxs("button",{onClick:()=>j("local"),className:"flex-1 py-3 text-center text-sm font-medium transition-colors "+("local"===b?"text-red-500 border-b-2 border-red-500":"text-gray-500"),children:["æœ¬åœ°æ­Œæ›² (",m.length,")"]}),e.jsxs("button",{onClick:()=>j("online"),className:"flex-1 py-3 text-center text-sm font-medium transition-colors "+("online"===b?"text-red-500 border-b-2 border-red-500":"text-gray-500"),children:["åœ¨çº¿æ­Œæ›² (",u.length,")"]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:p?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-red-500 mb-2"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"æœç´¢ä¸­..."})]})}):e.jsxs(e.Fragment,{children:["local"===b&&e.jsx("div",{className:"bg-white",children:m.length>0?m.map((t,s)=>{return e.jsxs("div",{onClick:()=>((e,t)=>{l.setPlaylist(m),l.setCurrentSong(e,t),l.play(),setTimeout(()=>{a("/music-player")},100)})(t,s),className:"flex items-center gap-3 p-4 border-b border-gray-50 ios-button hover:bg-gray-50",children:[e.jsx("img",{src:t.cover,alt:t.title,className:"w-12 h-12 rounded-lg object-cover"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 truncate",children:t.title}),e.jsx("div",{className:"text-sm text-gray-500 truncate",children:t.artist})]}),e.jsx("div",{className:"text-xs text-gray-400",children:(r=t.duration,`${Math.floor(r/60)}:${Math.floor(r%60).toString().padStart(2,"0")}`)})]},t.id);var r}):n&&!v?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-400",children:[e.jsx("svg",{className:"w-16 h-16 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})}),e.jsx("p",{className:"text-sm",children:"æœªæ‰¾åˆ°æœ¬åœ°æ­Œæ›²"})]}):null}),"online"===b&&e.jsx("div",{className:"bg-white",children:u.length>0?u.map((t,s)=>e.jsxs("div",{className:"flex items-center gap-3 p-4 border-b border-gray-50",children:[e.jsx("img",{src:t.cover,alt:t.name,className:"w-12 h-12 rounded-lg object-cover"}),e.jsxs("div",{className:"flex-1 min-w-0",onClick:()=>(async(e,t)=>{try{if(1===e.fee||4===e.fee)return void alert("è¯¥æ­Œæ›²ä¸ºä»˜è´¹æ­Œæ›²ï¼Œæ— æ³•åœ¨çº¿æ’­æ”¾");const s=await Ia(e.id);if(!s)return void alert("æ— æ³•èŽ·å–æ’­æ”¾é“¾æŽ¥ï¼Œå¯èƒ½æ˜¯ç‰ˆæƒé™åˆ¶");const r=await _a(e.id),n={id:e.id,title:e.name,artist:e.artists,album:e.album,duration:e.duration,cover:e.cover,audioUrl:s,lyrics:r||void 0};l.setCurrentSong(n,t),l.play(),setTimeout(()=>{a("/music-player")},100)}catch(s){alert("æ’­æ”¾å¤±è´¥ï¼Œè¯·é‡è¯•")}})(t,s),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"font-medium text-gray-900 truncate",children:t.name}),1===t.fee&&e.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-600 px-1.5 py-0.5 rounded",children:"VIP"}),4===t.fee&&e.jsx("span",{className:"text-xs bg-red-100 text-red-600 px-1.5 py-0.5 rounded",children:"ä»˜è´¹"})]}),e.jsx("div",{className:"text-sm text-gray-500 truncate",children:t.artists})]}),e.jsx("button",{onClick:e=>{e.stopPropagation(),(async e=>{try{const t=await Ia(e.id),s=await _a(e.id);if(!t)return void alert("æ— æ³•èŽ·å–æ­Œæ›²é“¾æŽ¥");const a=JSON.parse(localStorage.getItem("customSongs")||"[]"),r={id:Date.now(),title:e.name,artist:e.artists,album:e.album,duration:e.duration,cover:e.cover,audioUrl:t,lyrics:s||void 0,isOnline:!0};a.push(r),localStorage.setItem("customSongs",JSON.stringify(a)),alert("å·²æ·»åŠ åˆ°æ’­æ”¾åˆ—è¡¨")}catch(t){alert("æ·»åŠ å¤±è´¥ï¼Œè¯·é‡è¯•")}})(t)},className:"p-2 text-red-500 hover:bg-red-50 rounded-lg",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})})]},t.id)):n&&!v?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-400",children:[e.jsx("svg",{className:"w-16 h-16 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),e.jsx("p",{className:"text-sm",children:"æœªæ‰¾åˆ°åœ¨çº¿æ­Œæ›²"}),e.jsx("p",{className:"text-xs mt-1",children:"è¯·æ£€æŸ¥ç½‘ç»œè¿žæŽ¥æˆ–å°è¯•å…¶ä»–å…³é”®è¯"})]}):null})]})})]})}},Symbol.toStringTag,{value:"Module"})),Tl=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const r=s(),l=a(),n=x(),{currentApi:i}=b(),[c,o]=t.useState(!0),d=l.state,[m,h]=t.useState([]),[u,g]=t.useState(""),[p,f]=t.useState(!1),j=t.useRef(null),v=t.useRef(null),y=n.currentSong,N=(null==y?void 0:y.lyrics)||"";t.useEffect(()=>{var e;if((null==d?void 0:d.song)&&n.playlist.length>0){const t=n.playlist.findIndex(e=>e.title.toLowerCase().includes(d.song.title.toLowerCase())||d.song.title.toLowerCase().includes(e.title.toLowerCase()));if(-1!==t){const s=n.playlist[t];(null==(e=n.currentSong)?void 0:e.id)!==s.id&&(n.setCurrentSong(s,t),n.play())}}},[d,n.playlist]);t.useEffect(()=>{var e;null==(e=j.current)||e.scrollIntoView({behavior:"smooth"})},[m]),t.useEffect(()=>{if(0===m.length){const e=(null==y?void 0:y.title)||(null==d?void 0:d.song.title)||"è¿™é¦–æ­Œ";h([{id:Date.now(),type:"ai",content:`å˜¿ï¼æˆ‘ä»¬æ­£åœ¨ä¸€èµ·å¬ã€Š${e}ã€‹~ è¿™é¦–æ­Œæ€Žä¹ˆæ ·ï¼Ÿæƒ³èŠç‚¹ä»€ä¹ˆå—ï¼ŸðŸŽµ`,timestamp:Date.now(),avatar:(null==d?void 0:d.characterAvatar)||"ðŸŽµ"}])}},[y,d,m.length]);const w=()=>{if(!y)return"";const e=N.split("\n");let t="",s="";return e.forEach(e=>{const a=e.match(/\[(\d+):(\d+)\.(\d+)\](.*)/);if(a){const e=a[4].trim();e.includes("ä½œè¯")||e.includes("ä½œæ›²")||e.includes("ç¼–æ›²")?t+=e+"\n":e&&(s+=e+"\n")}}),`å½“å‰æ­£åœ¨æ’­æ”¾çš„æ­Œæ›²ä¿¡æ¯ï¼š\næ­Œæ›²åï¼š${y.title}\næ­Œæ‰‹ï¼š${y.artist}\nä¸“è¾‘ï¼š${y.album}\n${t?`åˆ¶ä½œä¿¡æ¯ï¼š\n${t}`:""}\n${s?`æ­Œè¯ï¼š\n${s.substring(0,500)}${s.length>500?"...":""}`:""}\n\nä½ æ˜¯ä¸€ä¸ªçƒ­çˆ±éŸ³ä¹çš„AIåŠ©æ‰‹ï¼Œæ­£åœ¨å’Œç”¨æˆ·ä¸€èµ·å¬æ­Œã€‚è¯·åŸºäºŽå½“å‰æ­Œæ›²çš„ä¿¡æ¯ä¸Žç”¨æˆ·èŠå¤©ï¼Œå¯ä»¥è°ˆè®ºæ­Œè¯å«ä¹‰ã€æƒ…æ„Ÿè¡¨è¾¾ã€éŸ³ä¹é£Žæ ¼ã€æ­Œæ‰‹æ•…äº‹ç­‰ã€‚å›žå¤è¦è‡ªç„¶ã€æœ‰è¶£ï¼Œåƒæœ‹å‹èŠå¤©ä¸€æ ·ã€‚`},k=async()=>{const e=u.trim();if(!e&&!p)return void(await C());if(!e)return;const t={id:Date.now(),type:"user",content:e,timestamp:Date.now()};h(e=>[...e,t]),g(""),await S(e)},C=async()=>{var e,t,s;if(!p){f(!0);try{const a=`${w()}\n\nè¯·ä¸»åŠ¨è¯´ç‚¹ä»€ä¹ˆï¼Œå¯ä»¥è¯„è®ºè¿™é¦–æ­Œã€åˆ†äº«æ„Ÿå—ï¼Œæˆ–è€…è¯¢é—®ç”¨æˆ·çš„æƒ³æ³•ã€‚`;if(!i)throw new Error("æœªé…ç½®API");const r=await fetch(i.baseUrl,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i.apiKey}`},body:JSON.stringify({model:i.model,messages:[{role:"system",content:a}],temperature:.8})}),l=(null==(s=null==(t=null==(e=(await r.json()).choices)?void 0:e[0])?void 0:t.message)?void 0:s.content)||"å¬ç€è¿™é¦–æ­Œï¼Œæ„Ÿè§‰çœŸå¥½~ ðŸŽµ",n={id:Date.now(),type:"ai",content:l,timestamp:Date.now(),avatar:"ðŸŽµ"};h(e=>[...e,n])}catch(a){const e={id:Date.now(),type:"ai",content:"å“Žå‘€ï¼Œæˆ‘æ­£åœ¨æ²‰æµ¸åœ¨éŸ³ä¹ä¸­...ç¨ç­‰ä¸€ä¸‹~",timestamp:Date.now(),avatar:"ðŸŽµ"};h(t=>[...t,e])}finally{f(!1)}}},S=async e=>{var t,s,a;f(!0);try{const r=w(),l=m.slice(-6).map(e=>({role:"user"===e.type?"user":"assistant",content:e.content}));if(!i)throw new Error("æœªé…ç½®API");const n=await fetch(i.baseUrl,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i.apiKey}`},body:JSON.stringify({model:i.model,messages:[{role:"system",content:r},...l,{role:"user",content:e}],temperature:.8})}),c=(null==(a=null==(s=null==(t=(await n.json()).choices)?void 0:t[0])?void 0:s.message)?void 0:a.content)||"å—¯...è®©æˆ‘æƒ³æƒ³~",o={id:Date.now(),type:"ai",content:c,timestamp:Date.now(),avatar:"ðŸŽµ"};h(e=>[...e,o])}catch(r){}finally{f(!1)}};return c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 transition-opacity duration-300",onClick:()=>{o(!1),setTimeout(()=>{r(-1)},300)}}),e.jsxs("div",{className:"fixed inset-x-0 bottom-0 z-50 bg-white rounded-t-3xl shadow-2xl transition-transform duration-300 flex flex-col",style:{height:"70vh",transform:c?"translateY(0)":"translateY(100%)"},onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"flex flex-col items-center pt-3 pb-2 border-b border-gray-100",children:[e.jsx("div",{className:"w-12 h-1 bg-gray-300 rounded-full mb-3"}),e.jsxs("div",{className:"text-center px-4 pb-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:(null==d?void 0:d.characterName)?`æ­£åœ¨å’Œ ${d.characterName} ä¸€èµ·å¬`:"ä¸€èµ·å¬"}),e.jsxs("div",{className:"text-xs text-gray-500 truncate mt-0.5",children:[(null==y?void 0:y.title)||(null==d?void 0:d.song.title)," - ",(null==y?void 0:y.artist)||(null==d?void 0:d.song.artist)]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-4",children:[m.map(t=>e.jsxs("div",{className:"flex items-end gap-2 mb-4 "+("user"===t.type?"flex-row-reverse":"flex-row"),children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center text-sm font-medium "+("user"===t.type?"bg-gradient-to-br from-blue-400 to-blue-600 text-white":"bg-gradient-to-br from-red-400 to-pink-500 text-white"),children:"user"===t.type?"æˆ‘":"ðŸŽµ"}),e.jsx("div",{style:{maxWidth:"70%",display:"inline-block"},children:e.jsx("div",{className:"message-bubble px-3 py-2",style:{backgroundColor:"user"===t.type?"#95EC69":"#FFFFFF",borderRadius:"8px",boxShadow:"0 1px 4px rgba(0,0,0,0.08)",wordBreak:"break-word",whiteSpace:"pre-wrap",color:"#111827",fontSize:"14px",maxWidth:"100%",overflowWrap:"break-word"},children:e.jsx("div",{style:{position:"relative",zIndex:2},children:t.content})})})]},t.id)),p&&e.jsxs("div",{className:"flex items-end gap-2 mb-4",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-gradient-to-br from-red-400 to-pink-500 flex items-center justify-center text-white text-sm font-medium",children:"ðŸŽµ"}),e.jsx("div",{className:"bg-white px-4 py-3 rounded-lg shadow-sm",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})]}),e.jsx("div",{ref:j})]}),e.jsx("div",{className:"bg-white border-t border-gray-100 px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{ref:v,type:"text",value:u,onChange:e=>g(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),k())},placeholder:"è¯´ç‚¹ä»€ä¹ˆ...",className:"flex-1 bg-gray-100 border-none rounded-full px-4 py-2 text-sm focus:outline-none focus:ring-0"}),u.trim()?e.jsx("button",{onClick:k,disabled:p,className:"w-10 h-10 flex items-center justify-center ios-button bg-wechat-green text-white rounded-full shadow-lg disabled:opacity-50 transition-all duration-200",children:e.jsx(xs,{size:18})}):e.jsx("button",{onClick:k,disabled:p,className:"w-10 h-10 flex items-center justify-center ios-button text-gray-700 disabled:opacity-50 transition-all duration-200",children:e.jsx(xs,{size:22})})]})})]})]}):null}},Symbol.toStringTag,{value:"Module"})),Dl=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),[l,n]=t.useState([{id:1,type:"received",content:"å˜¿ï¼æˆ‘æ­£åœ¨å¬è¿™é¦–æ­Œï¼Œè¶…å¥½å¬çš„ï¼",timestamp:Date.now()-6e4},{id:2,type:"musicInvite",inviterName:"æ±æ±",songTitle:"åˆ«å“­äº†æˆ‘çˆ±ä½ ",songArtist:"å‘¨æ°ä¼¦",timestamp:Date.now()-3e4,status:"pending"},{id:3,type:"received",content:"ä¸€èµ·å¬å§ï½ž",timestamp:Date.now()-2e4}]);return e.jsxs("div",{className:"h-screen flex flex-col bg-gray-50",children:[r&&e.jsx(ua,{}),e.jsxs("div",{className:"bg-white px-4 py-3 flex items-center justify-between border-b border-gray-100 shadow-sm",children:[e.jsx("button",{onClick:()=>a("/music-player",{replace:!0}),className:"w-10 h-10 flex items-center justify-center ios-button",children:e.jsx("svg",{className:"w-6 h-6 text-gray-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("h1",{className:"text-lg font-medium text-gray-900",children:"ä¸€èµ·å¬é‚€è¯·å¡ç‰‡ç¤ºä¾‹"}),e.jsx("div",{className:"w-10"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-4",children:l.map(t=>e.jsx("div",{className:"flex mb-4 "+("received"===t.type||"musicInvite"===t.type?"justify-start":"justify-end"),children:"musicInvite"===t.type?e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-gradient-to-br from-pink-400 to-rose-500 flex items-center justify-center text-white text-sm font-medium",children:"æ±"}),e.jsx(Na,{inviterName:t.inviterName,songTitle:t.songTitle,songArtist:t.songArtist,songCover:t.songCover,status:t.status,onAccept:()=>{return e=t.id,void n(t=>t.map(t=>t.id===e&&"musicInvite"===t.type?{...t,status:"accepted"}:t));var e},onReject:()=>{return e=t.id,void n(t=>t.map(t=>t.id===e&&"musicInvite"===t.type?{...t,status:"rejected"}:t));var e}})]}):e.jsxs("div",{className:"flex items-end gap-2",children:["received"===t.type&&e.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-gradient-to-br from-pink-400 to-rose-500 flex items-center justify-center text-white text-sm font-medium",children:"æ±"}),e.jsx("div",{className:"message-bubble px-3 py-2 max-w-[70%]",style:{backgroundColor:"received"===t.type?"#FFFFFF":"#95EC69",borderRadius:"8px",boxShadow:"0 1px 4px rgba(0,0,0,0.08)",color:"#111827",fontSize:"14px"},children:t.content})]})},t.id))}),e.jsxs("div",{className:"bg-white border-t border-gray-100 px-4 py-3",children:[e.jsx("div",{className:"text-sm text-gray-600 text-center",children:'è¿™æ˜¯"ä¸€èµ·å¬"é‚€è¯·å¡ç‰‡çš„ç¤ºä¾‹å±•ç¤º'}),e.jsx("div",{className:"text-xs text-gray-400 text-center mt-1",children:'ç‚¹å‡»"æŽ¥å—"æˆ–"æ‹’ç»"æŸ¥çœ‹æ•ˆæžœ'})]})]})}},Symbol.toStringTag,{value:"Module"})),El=15,Bl=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{id:l}=r(),{showStatusBar:i}=o(),{getCharacter:c}=n(),d=l?c(l):null,[x,m]=t.useState(!0),[h,u]=t.useState("black"),[g,p]=t.useState(D()),[f,b]=t.useState("black"),[j,v]=t.useState(!1),[y,N]=t.useState(null),[w,k]=t.useState(!1),[C,S]=t.useState([]),[I,_]=t.useState([]),[M,z]=t.useState(""),[L,$]=t.useState(!1),A=t.useRef(null),T=t.useRef(null);function D(){return Array(El).fill(null).map(()=>Array(El).fill("empty"))}t.useEffect(()=>{B()},[g]),t.useEffect(()=>{var e;null==(e=A.current)||e.scrollIntoView({behavior:"smooth"})},[I]);const E=e=>{"player"===e?(u("black"),b("black"),U(`ä½ é€‰æ‹©äº†é»‘æ£‹å…ˆæ‰‹ï¼Œ${null==d?void 0:d.name} æ˜¯ç™½æ£‹ã€‚`)):(u("white"),b("black"),k(!0),U(`${null==d?void 0:d.name} é€‰æ‹©äº†é»‘æ£‹å…ˆæ‰‹ï¼Œä½ æ˜¯ç™½æ£‹ã€‚ç‚¹å‡»"AIå›žå¤"è®©TAä¸‹æ£‹ã€‚`)),m(!1)},B=()=>{const e=T.current;if(!e)return;const t=e.getContext("2d");if(!t)return;const s=e.width/El;t.fillStyle="#DEB887",t.fillRect(0,0,e.width,e.height),t.strokeStyle="#000",t.lineWidth=1;for(let r=0;r<El;r++)t.beginPath(),t.moveTo(s/2,r*s+s/2),t.lineTo(e.width-s/2,r*s+s/2),t.stroke(),t.beginPath(),t.moveTo(r*s+s/2,s/2),t.lineTo(r*s+s/2,e.height-s/2),t.stroke();const a=[3,7,11];t.fillStyle="#000",a.forEach(e=>{a.forEach(a=>{t.beginPath(),t.arc(e*s+s/2,a*s+s/2,4,0,2*Math.PI),t.fill()})}),g.forEach((e,a)=>{e.forEach((e,r)=>{"empty"!==e&&(t.beginPath(),t.arc(r*s+s/2,a*s+s/2,.4*s,0,2*Math.PI),t.fillStyle="black"===e?"#000":"#fff",t.fill(),t.strokeStyle="#000",t.lineWidth=1,t.stroke())})})},P=(e,t,s)=>{const a=g.map(e=>[...e]);if(a[t][e]=s,p(a),S(a=>[...a,{x:e,y:t,player:s}]),W(a,e,t,s)){v(!0);const e=s===h?"ä½ ":(null==d?void 0:d.name)||"AI";return N(e),void U(`${e} èµ¢äº†ï¼`)}if(R(a))return v(!0),void U("å¹³å±€ï¼");b("black"===s?"white":"black"),s===h&&k(!0)},F=async()=>{if(w&&!L&&!j){$(!0),k(!1);try{const e="black"===h?"white":"black",t=g.map(e=>e.map(e=>"empty"===e?".":"black"===e?"X":"O").join("")).join("\n"),s=I.filter(e=>"system"!==e.type).slice(-6).map(e=>`${"user"===e.type?"ä½ ":null==d?void 0:d.name}: ${e.content}`).join("\n"),a=`æˆ‘ä»¬æ­£åœ¨ä¸‹äº”å­æ£‹ã€‚ä½ æ˜¯${"black"===e?"é»‘æ£‹(X)":"ç™½æ£‹(O)"}ï¼Œæˆ‘æ˜¯${"black"===h?"é»‘æ£‹(X)":"ç™½æ£‹(O)"}ã€‚\n\nå½“å‰æ£‹ç›˜çŠ¶æ€ï¼ˆ15x15ï¼‰ï¼š\n${t}\n\n${s?`æœ€è¿‘çš„èŠå¤©ï¼š\n${s}\n`:""}\n${M?`æˆ‘è¯´ï¼š${M}\n`:""}\nè¯·ä½ ï¼š\n1. å†³å®šä¸‹ä¸€æ­¥çš„ä½ç½®ï¼ˆæ ¼å¼ï¼šx,yï¼Œåæ ‡ä»Ž0åˆ°14ï¼‰\n2. è¯´ä¸€äº›è¯ï¼ˆå¯ä»¥è¯„è®ºæ£‹å±€ã€å›žå¤æˆ‘çš„è¯ã€æˆ–è€…é—²èŠï¼‰\n\n**å¿…é¡»**ç”¨è¿™ä¸ªæ ¼å¼å›žå¤ï¼š\nä½ç½®: x,y\nè¯´è¯: [ä½ æƒ³è¯´çš„è¯]`,r={role:"system",content:(null==d?void 0:d.description)||"ä½ æ˜¯ä¸€ä¸ªäº”å­æ£‹é«˜æ‰‹ï¼Œæ€§æ ¼æ´»æ³¼å¥è°ˆã€‚"},l={role:"user",content:a},n=await q([r,l]),i=n.match(/ä½ç½®[ï¼š:]\s*(\d+)\s*[,ï¼Œ]\s*(\d+)/),c=n.match(/è¯´è¯[ï¼š:]\s*(.+)/s);let o,x;if(i){if(o=parseInt(i[1]),x=parseInt(i[2]),o<0||o>=El||x<0||x>=El||"empty"!==g[x][o]){const t=O(g,e);o=t.x,x=t.y}}else{const t=O(g,e);o=t.x,x=t.y}P(o,x,e),V(c?c[1].trim():`æˆ‘ä¸‹åœ¨ (${o}, ${x})`),z("")}catch(e){const t="black"===h?"white":"black",s=O(g,t);P(s.x,s.y,t),V(`æˆ‘ä¸‹åœ¨ (${s.x}, ${s.y})`),z("")}finally{$(!1)}}},O=(e,t)=>{const s="black"===t?"white":"black";for(let r=0;r<El;r++)for(let s=0;s<El;s++)if("empty"===e[r][s]){const a=e.map(e=>[...e]);if(a[r][s]=t,W(a,s,r,t))return{x:s,y:r}}for(let r=0;r<El;r++)for(let t=0;t<El;t++)if("empty"===e[r][t]){const a=e.map(e=>[...e]);if(a[r][t]=s,W(a,t,r,s))return{x:t,y:r}}const a=Math.floor(7.5);for(let r=0;r<El;r++)for(let t=Math.max(0,a-r);t<=Math.min(14,a+r);t++)for(let s=Math.max(0,a-r);s<=Math.min(14,a+r);s++)if("empty"===e[t][s])return{x:s,y:t};return{x:a,y:a}},W=(e,t,s,a)=>{const r=[[1,0],[0,1],[1,1],[1,-1]];for(const[l,n]of r){let r=1;for(let i=1;i<5;i++){const c=t+l*i,o=s+n*i;if(c<0||c>=El||o<0||o>=El||e[o][c]!==a)break;r++}for(let i=1;i<5;i++){const c=t-l*i,o=s-n*i;if(c<0||c>=El||o<0||o>=El||e[o][c]!==a)break;r++}if(r>=5)return!0}return!1},R=e=>e.every(e=>e.every(e=>"empty"!==e)),U=e=>{const t={id:`system_${Date.now()}`,type:"system",content:e,timestamp:Date.now()};_(e=>[...e,t])},V=e=>{const t={id:`ai_${Date.now()}`,type:"ai",content:e,timestamp:Date.now()};_(e=>[...e,t])};return d?e.jsxs("div",{className:"h-screen flex flex-col bg-gradient-to-br from-amber-50 to-orange-50",children:[i&&e.jsx(ua,{}),x&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"glass-card rounded-3xl p-6 w-full max-w-sm",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4 text-center",children:"é€‰æ‹©å…ˆæ‰‹"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>E("player"),className:"w-full glass-card rounded-xl py-4 text-center ios-button hover:shadow-lg transition-shadow",children:[e.jsx("div",{className:"font-bold text-gray-900 mb-1",children:"æˆ‘å…ˆä¸‹ï¼ˆé»‘æ£‹ï¼‰"}),e.jsx("div",{className:"text-xs text-gray-500",children:"é»‘æ£‹å…ˆæ‰‹æœ‰ä¼˜åŠ¿"})]}),e.jsxs("button",{onClick:()=>E("ai"),className:"w-full glass-card rounded-xl py-4 text-center ios-button hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"font-bold text-gray-900 mb-1",children:[d.name," å…ˆä¸‹ï¼ˆé»‘æ£‹ï¼‰"]}),e.jsx("div",{className:"text-xs text-gray-500",children:"è®©TAå…ˆæ‰‹è¯•è¯•"})]})]})]})}),e.jsxs("div",{className:"glass-effect px-4 py-3 border-b border-gray-200/50 flex items-center",children:[e.jsx("button",{onClick:()=>a(-1),className:"w-8 h-8 flex items-center justify-center ios-button",children:e.jsx("span",{className:"text-blue-500 text-xl",children:"â€¹"})}),e.jsxs("div",{className:"flex-1 flex items-center justify-center gap-2",children:[e.jsx("img",{src:d.avatar,alt:d.name,className:"w-8 h-8 rounded-full"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[d.name," - äº”å­æ£‹"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{if(0===C.length||L||w)return;const e=C.length>=2?2:1,t=C.slice(0,-e);S(t);const s=D();t.forEach(e=>{s[e.y][e.x]=e.player}),p(s),v(!1),N(null),k(!1),b(0===t.length?"black":"black"===t[t.length-1].player?"white":"black"),U("å·²æ‚”æ£‹")},disabled:0===C.length||L||w,className:"text-blue-500 text-sm ios-button font-medium disabled:opacity-30",children:"æ‚”æ£‹"}),e.jsx("button",{onClick:()=>{p(D()),b("black"),v(!1),N(null),_([]),S([]),k(!1),m(!0)},className:"text-blue-500 text-sm ios-button font-medium",children:"é‡å¼€"})]})]}),e.jsx("div",{className:"flex-shrink-0 p-4 flex justify-center bg-white",children:e.jsx("canvas",{ref:T,width:450,height:450,onClick:e=>{if(j||x||L)return;if(f!==h)return;const t=T.current;if(!t)return;const s=t.getBoundingClientRect(),a=t.width/El,r=Math.floor((e.clientX-s.left)/a),l=Math.floor((e.clientY-s.top)/a);r>=0&&r<El&&l>=0&&l<El&&"empty"===g[l][r]&&P(r,l,h)},className:"border border-gray-300 rounded-lg shadow-lg cursor-pointer"})}),e.jsx("div",{className:"flex-shrink-0 px-4 py-2 text-center",children:j?e.jsx("div",{className:"text-lg font-bold text-gray-900",children:y?`${y} èŽ·èƒœï¼`:"å¹³å±€ï¼"}):e.jsx("div",{className:"text-sm text-gray-600",children:L?`${d.name} æ­£åœ¨æ€è€ƒ...`:w?`ç­‰å¾… ${d.name} å›žå¤ï¼ˆç‚¹å‡»ä¸‹æ–¹"AIå›žå¤"æŒ‰é’®ï¼‰`:f===h?`ä½ çš„å›žåˆï¼ˆ${"black"===h?"é»‘æ£‹":"ç™½æ£‹"}ï¼‰`:`${d.name} çš„å›žåˆï¼ˆ${"black"===h?"ç™½æ£‹":"é»‘æ£‹"}ï¼‰`})}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-4 pb-2",children:[I.map(t=>e.jsx("div",{className:"mb-2 "+("user"===t.type?"flex justify-end":""),children:"system"===t.type?e.jsx("div",{className:"text-center text-xs text-gray-500 py-1",children:t.content}):"ai"===t.type?e.jsxs("div",{className:"flex gap-2 max-w-[80%]",children:[e.jsx("img",{src:d.avatar,alt:"",className:"w-8 h-8 rounded-full flex-shrink-0"}),e.jsx("div",{className:"glass-card rounded-2xl px-4 py-2",children:e.jsx("p",{className:"text-sm text-gray-900 whitespace-pre-wrap",children:t.content})})]}):e.jsx("div",{className:"bg-blue-500 text-white rounded-2xl px-4 py-2 max-w-[80%]",children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:t.content})})},t.id)),e.jsx("div",{ref:A})]}),e.jsx("div",{className:"flex-shrink-0 glass-effect border-t border-gray-200/50 p-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:M,onChange:e=>z(e.target.value),onKeyPress:e=>"Enter"===e.key&&F(),placeholder:w?"è¯´ç‚¹ä»€ä¹ˆ...":"å’ŒTAèŠèŠå¤©...",disabled:L||j,className:"flex-1 glass-card rounded-xl px-4 py-2 text-sm border-none outline-none"}),e.jsx("button",{onClick:F,disabled:!w||L||j,className:"bg-blue-500 text-white rounded-xl px-6 py-2 text-sm font-medium ios-button disabled:opacity-50",children:L?"æ€è€ƒä¸­...":M.trim()?"å‘é€":"AIå›žå¤"})]})})]}):e.jsx("div",{children:"è§’è‰²ä¸å­˜åœ¨"})}},Symbol.toStringTag,{value:"Module"})),Pl=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const t=s(),{characters:a}=n(),{showStatusBar:r}=o();return e.jsxs("div",{className:"h-screen flex flex-col bg-gradient-to-br from-blue-50 to-purple-50",children:[r&&e.jsx(ua,{}),e.jsxs("div",{className:"glass-effect px-4 py-3 border-b border-gray-200/50 flex items-center",children:[e.jsx("button",{onClick:()=>t(-1),className:"w-8 h-8 flex items-center justify-center ios-button",children:e.jsx("span",{className:"text-blue-500 text-xl",children:"â€¹"})}),e.jsx("h1",{className:"flex-1 text-center text-lg font-semibold text-gray-900",children:"é€‰æ‹©å¯¹æ‰‹"}),e.jsx("div",{className:"w-8"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar p-4",children:[e.jsx("div",{className:"space-y-3",children:a.map(s=>e.jsx("div",{onClick:()=>t(`/gomoku/${s.id}`),className:"glass-card rounded-2xl p-4 ios-button cursor-pointer hover:shadow-lg transition-shadow",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:s.avatar,alt:s.name,className:"w-14 h-14 rounded-full object-cover shadow-sm"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-gray-900 text-base mb-1",children:s.name}),e.jsx("p",{className:"text-sm text-gray-500 line-clamp-2",children:s.description})]}),e.jsx("div",{className:"text-gray-300 text-2xl",children:"â€º"})]})},s.id))}),0===a.length&&e.jsxs("div",{className:"glass-card rounded-2xl p-8 text-center",children:[e.jsx("div",{className:"text-gray-500 text-sm mb-2",children:"è¿˜æ²¡æœ‰AIè§’è‰²"}),e.jsx("button",{onClick:()=>t("/create-character"),className:"text-blue-500 text-sm font-medium",children:"åˆ›å»ºè§’è‰²"})]})]})]})}},Symbol.toStringTag,{value:"Module"})),Fl=()=>e.jsxs("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"8",y1:"4",x2:"8",y2:"20"}),e.jsx("line",{x1:"16",y1:"4",x2:"16",y2:"20"}),e.jsx("line",{x1:"4",y1:"8",x2:"20",y2:"8"}),e.jsx("line",{x1:"4",y1:"16",x2:"20",y2:"16"})]}),Ol=()=>e.jsxs("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"3",y:"5",width:"7",height:"10",rx:"1"}),e.jsx("rect",{x:"14",y:"9",width:"7",height:"10",rx:"1"}),e.jsx("text",{x:"6.5",y:"12",fontSize:"6",fill:"currentColor",textAnchor:"middle",children:"A"}),e.jsx("text",{x:"17.5",y:"16",fontSize:"6",fill:"currentColor",textAnchor:"middle",children:"K"})]}),Wl=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const t=s(),{showStatusBar:a}=o(),r=[{id:1,name:"äº”å­æ£‹",description:"ç»å…¸äº”å­æ£‹å¯¹æˆ˜ï¼Œå’ŒAIä¸€è¾ƒé«˜ä¸‹",icon:"/zhizhi/assets/gomoku-icon-Dv90YLQ_.webp",path:"/game-select",color:"bg-blue-500",available:!0},{id:2,name:"è°æ˜¯å§åº•",description:"å’ŒAIä¸€èµ·çŽ©è¯­è¨€æŽ¨ç†æ¸¸æˆ",icon:"/zhizhi/assets/undercover-icon-Cxh46JWO.webp",path:"/game/undercover/solo",color:"bg-purple-500",available:!0},{id:3,name:"äº•å­—æ£‹",description:"ç®€å•æœ‰è¶£çš„ä¸‰å­æ£‹æ¸¸æˆ",icon:Fl,path:"",color:"bg-green-500",available:!1},{id:4,name:"21ç‚¹",description:"å’ŒAIæ¯”æ‹¼è¿æ°”å’Œç­–ç•¥",icon:Ol,path:"",color:"bg-red-500",available:!1}];return e.jsxs("div",{className:"h-screen flex flex-col bg-gray-50",children:[a&&e.jsx(ua,{}),e.jsxs("div",{className:"glass-effect px-4 py-3 border-b border-gray-200/50 flex items-center",children:[e.jsx("button",{onClick:()=>t(-1),className:"w-8 h-8 flex items-center justify-center ios-button",children:e.jsx("span",{className:"text-blue-500 text-xl",children:"â€¹"})}),e.jsx("h1",{className:"flex-1 text-center text-lg font-semibold text-gray-900",children:"å°æ¸¸æˆ"}),e.jsx("div",{className:"w-8"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar p-4",children:[e.jsx("div",{className:"space-y-3",children:r.map(s=>e.jsx("div",{onClick:()=>s.available&&t(s.path),className:`glass-card rounded-2xl p-5 ${s.available?"ios-button cursor-pointer hover:shadow-lg":"opacity-50"} transition-shadow`,children:e.jsxs("div",{className:"flex items-center gap-4",children:["string"==typeof s.icon?e.jsx("img",{src:s.icon,alt:s.name,className:"w-16 h-16 object-contain flex-shrink-0"}):e.jsx("div",{className:`w-16 h-16 rounded-2xl ${s.color} flex items-center justify-center shadow-lg flex-shrink-0 text-white`,children:e.jsx(s.icon,{})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-bold text-gray-900 text-base",children:s.name}),!s.available&&e.jsx("span",{className:"px-2 py-0.5 bg-gray-200 text-gray-500 text-xs rounded-lg font-medium",children:"æ•¬è¯·æœŸå¾…"})]}),e.jsx("p",{className:"text-sm text-gray-500 leading-relaxed",children:s.description})]}),s.available&&e.jsx("div",{className:"text-gray-300 text-2xl flex-shrink-0",children:"â€º"})]})},s.id))}),e.jsxs("div",{className:"mt-6 glass-card rounded-2xl p-6 text-center",children:[e.jsx("div",{className:"text-gray-400 text-sm mb-1",children:"æ›´å¤šæ¸¸æˆ"}),e.jsx("div",{className:"text-gray-500 text-xs",children:"å³å°†ä¸Šçº¿ï¼Œæ•¬è¯·æœŸå¾…"})]})]})]})}},Symbol.toStringTag,{value:"Module"})),Rl=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{var a,r,l;const i=s(),{showStatusBar:c}=o(),{characters:d}=n(),[x,m]=t.useState({status:"setup",players:[],currentRound:0,descriptions:{},votes:{},eliminatedPlayer:null,announcement:"",winner:null,civilianWord:"",undercoverWord:""}),[h,u]=t.useState([]),[g,p]=t.useState(""),[f,b]=t.useState(null),[j,v]=t.useState(!1),[y,N]=t.useState(!1),[w,k]=t.useState([]),[C,S]=t.useState(null),[I,_]=t.useState(""),[M,z]=t.useState([]),[L,$]=t.useState(!1),[A,T]=t.useState([]);t.useEffect(()=>{if(0===M.length)return;const[e,...t]=M;S(e.playerId),_(e.text);const s=setTimeout(()=>{S(null),_(""),z(t)},3e3);return()=>clearTimeout(s)},[M]);const D=x.players.filter(e=>!e.isOut),E=x.players.find(e=>"user"===e.id);return e.jsxs("div",{className:"h-screen flex flex-col bg-gradient-to-br from-purple-50 to-pink-50",children:[c&&e.jsx(ua,{}),e.jsxs("div",{className:"glass-effect px-4 py-3 border-b border-gray-200/50 flex items-center",children:[e.jsx("button",{onClick:()=>i("/desktop",{replace:!0}),className:"w-8 h-8 flex items-center justify-center ios-button",children:e.jsx("span",{className:"text-blue-500 text-xl",children:"â€¹"})}),e.jsx("h1",{className:"flex-1 text-center text-lg font-semibold text-gray-900",children:"è°æ˜¯å§åº•"}),e.jsx("button",{onClick:()=>N(!0),className:"w-8 h-8 flex items-center justify-center ios-button",children:e.jsx("span",{className:"text-blue-500 text-xl",children:"ï¼Ÿ"})})]}),y&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"glass-card rounded-3xl p-6 w-full max-w-md max-h-[80vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"æ¸¸æˆŽè§„åˆ™"}),e.jsxs("div",{className:"space-y-3 text-sm text-gray-700",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-gray-900 mb-1",children:"ðŸŽ¯ æ¸¸æˆç›®æ ‡"}),e.jsx("p",{children:"æ‰¾å‡ºè°æ˜¯å§åº•ï¼å¹³æ°‘è¦æ·˜æ±°å§åº•ï¼Œå§åº•è¦éšè—åˆ°æœ€åŽã€‚"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-gray-900 mb-1",children:"ðŸŽ² è§’è‰²åˆ†é…"}),e.jsxs("p",{children:["æ¯ä¸ªäººéƒ½ä¼šå¾—åˆ°ä¸€ä¸ªè¯è¯­ï¼Œå¤§éƒ¨åˆ†äººæ˜¯",e.jsx("strong",{children:"å¹³æ°‘"}),"ï¼ˆç›¸åŒè¯è¯­ï¼‰ï¼Œ1äººæ˜¯",e.jsx("strong",{children:"å§åº•"}),"ï¼ˆç›¸ä¼¼ä½†ä¸åŒçš„è¯è¯­ï¼‰ã€‚"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-gray-900 mb-1",children:"ðŸ’¬ æè¿°é˜¶æ®µ"}),e.jsxs("p",{children:["æ¯äººè½®æµç”¨ä¸€å¥è¯æè¿°è‡ªå·±çš„è¯è¯­ï¼Œä½†",e.jsx("strong",{children:"ä¸èƒ½è¯´å‡ºè¯è¯­æœ¬èº«"}),"ã€‚è¦æ—¢è®©åŒä¼´æ˜Žç™½ï¼Œåˆä¸èƒ½è®©å§åº•çŒœåˆ°ã€‚"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-gray-900 mb-1",children:"ðŸ—³ï¸ æŠ•ç¥¨é˜¶æ®µ"}),e.jsx("p",{children:"æ‰€æœ‰äººæè¿°å®ŒåŽï¼Œæ¯äººæŠ•ç¥¨é€‰å‡ºä½ è®¤ä¸ºçš„å§åº•ã€‚å¾—ç¥¨æœ€å¤šçš„äººè¢«æ·˜æ±°ã€‚"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-gray-900 mb-1",children:"ðŸ† èƒœåˆ©æ¡ä»¶"}),e.jsxs("p",{children:[e.jsx("strong",{children:"å¹³æ°‘èƒœåˆ©"}),"ï¼šæ·˜æ±°æ‰€æœ‰å§åº•",e.jsx("br",{}),e.jsx("strong",{children:"å§åº•èƒœåˆ©"}),"ï¼šå‰©ä½™äººæ•°â‰¤3äººä¸”å§åº•è¿˜åœ¨"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-gray-900 mb-1",children:"âš ï¸ æ³¨æ„"}),e.jsxs("p",{children:["ä½ ",e.jsx("strong",{children:"ä¸çŸ¥é“"}),"è‡ªå·±æ˜¯å¹³æ°‘è¿˜æ˜¯å§åº•ï¼Œåªèƒ½é€šè¿‡åˆ«äººçš„æè¿°æ¥æŽ¨æµ‹ï¼"]})]})]}),e.jsx("button",{onClick:()=>N(!1),className:"w-full mt-6 bg-blue-500 text-white rounded-xl py-3 font-medium ios-button",children:"çŸ¥é“äº†"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar p-4",children:["setup"===x.status&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"glass-card rounded-2xl p-5",children:[e.jsx("h2",{className:"font-bold text-gray-900 mb-2",children:"é€‰æ‹©AIçŽ©å®¶"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"é€‰æ‹©2-8ä¸ªAIè§’è‰²ä¸€èµ·çŽ©"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:d.map(t=>e.jsx("div",{onClick:()=>{return e=t.id,void(h.includes(e)?u(h.filter(t=>t!==e)):h.length<8&&u([...h,e]));var e},className:"glass-card rounded-xl p-3 ios-button cursor-pointer transition-all "+(h.includes(t.id)?"ring-2 ring-blue-500":""),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:t.avatar,alt:t.name,className:"w-10 h-10 rounded-full"}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("div",{className:"font-medium text-gray-900 text-sm truncate",children:t.name})}),h.includes(t.id)&&e.jsx("div",{className:"text-blue-500 text-xl",children:"âœ“"})]})},t.id))}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx("button",{onClick:()=>N(!0),className:"text-blue-500 text-sm ios-button",children:"ðŸ“– æŸ¥çœ‹æ¸¸æˆè§„åˆ™"})}),e.jsxs("div",{className:"text-center text-sm text-gray-500",children:["å·²é€‰æ‹© ",h.length," ä¸ªAI"]})]}),e.jsx("button",{onClick:async()=>{if(!(h.length<2)){v(!0);try{const t=h.map(e=>{const t=d.find(t=>t.id===e);return{id:e,name:t.name,avatar:t.avatar}}),s=`ä½ æ˜¯"è°æ˜¯å§åº•"æ¸¸æˆä¸»æŒäººã€‚\nçŽ©å®¶ï¼š${["ä½ ",...t.map(e=>e.name)].join("ã€")}ï¼ˆå…±${h.length+1}äººï¼‰\n\nè¯·ï¼š\n1. é€‰æ‹©ä¸€å¯¹ç›¸ä¼¼çš„è¯è¯­ï¼ˆå¹³æ°‘è¯ã€å§åº•è¯ï¼‰\n2. éšæœºåˆ†é…ï¼š1ä¸ªå§åº•ï¼Œå…¶ä»–éƒ½æ˜¯å¹³æ°‘\n3. å®£å¸ƒæ¸¸æˆå¼€å§‹\n\n**ä¸¥æ ¼**æŒ‰ç…§ä»¥ä¸‹JSONæ ¼å¼è¿”å›žï¼š\n{\n  "civilianWord": "å¹³æ°‘è¯",\n  "undercoverWord": "å§åº•è¯",\n  "playerWords": {\n    "user": "è¯è¯­",\n    "ai_0": "è¯è¯­",\n    "ai_1": "è¯è¯­"\n  },\n  "announcement": "æ¸¸æˆå¼€å§‹çš„è¯"\n}`,a=await q([{role:"system",content:"ä½ æ˜¯æ¸¸æˆä¸»æŒäººï¼Œåªè¿”å›žJSONæ ¼å¼æ•°æ®ï¼Œä¸è¦æœ‰å…¶ä»–æ–‡å­—ã€‚"},{role:"user",content:s}]);let r;try{const e=a.match(/\{[\s\S]*\}/);if(!e)throw new Error("æœªæ‰¾åˆ°JSONæ ¼å¼");r=JSON.parse(e[0])}catch(e){throw alert("AIè¿”å›žæ ¼å¼é”™è¯¯ï¼Œè¯·é‡è¯•"),e}const l=[{id:"user",name:"ä½ ",avatar:"https://api.dicebear.com/7.x/avataaars/svg?seed=user",isAI:!1,word:r.playerWords.user,isOut:!1},...t.map((e,t)=>({id:`ai_${t}`,name:e.name,avatar:e.avatar,isAI:!0,word:r.playerWords[`ai_${t}`],isOut:!1}))],n=[...l.map(e=>e.id)].sort(()=>Math.random()-.5);k(n),m({status:"describing",players:l,currentRound:1,descriptions:{},votes:{},eliminatedPlayer:null,announcement:r.announcement,winner:null,civilianWord:r.civilianWord,undercoverWord:r.undercoverWord})}catch(t){alert("æ¸¸æˆå¯åŠ¨å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{v(!1)}}},disabled:h.length<2||j,className:"w-full bg-blue-500 text-white rounded-xl py-3 font-medium ios-button disabled:opacity-50",children:j?"å‡†å¤‡ä¸­...":"å¼€å§‹æ¸¸æˆ"})]}),"setup"!==x.status&&"finished"!==x.status&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"glass-card rounded-2xl p-6",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsxs("div",{className:"text-lg font-bold text-gray-900",children:["ç¬¬ ",x.currentRound," è½®"]}),e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:"describing"===x.status?"æè¿°é˜¶æ®µ":"æŠ•ç¥¨é˜¶æ®µ"})]}),e.jsxs("div",{className:"relative w-full aspect-square max-w-sm mx-auto",children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"glass-card rounded-full w-32 h-32 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl mb-1",children:"ðŸŽ­"}),e.jsxs("div",{className:"text-xs text-gray-600",children:["å‰©ä½™ ",D.length," äºº"]})]})})}),D.map((t,s)=>{const a=360*s/D.length-90,r=50+42*Math.cos(a*Math.PI/180),l=50+42*Math.sin(a*Math.PI/180),n=C===t.id,i=A.includes(t.id);return e.jsx("div",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 transition-all duration-300 "+(n?"scale-110 z-10":""),style:{left:`${r}%`,top:`${l}%`},children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-16 h-16 rounded-full overflow-hidden border-4 transition-all "+(n?"border-blue-500 shadow-lg shadow-blue-500/50":t.isOut?"border-gray-300 opacity-50":"border-white"),children:e.jsx("img",{src:t.avatar,alt:t.name,className:"w-full h-full object-cover"})}),n&&e.jsx("div",{className:"absolute -top-1 -right-1 w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center animate-pulse",children:e.jsx("span",{className:"text-white text-xs",children:"ðŸ’¬"})}),i&&"voting"===x.status&&e.jsx("div",{className:"absolute -bottom-1 -right-1 w-6 h-6 bg-green-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs",children:"âœ“"})}),e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 mt-1 whitespace-nowrap",children:e.jsx("div",{className:"text-xs font-medium px-2 py-1 rounded-full "+(n?"bg-blue-500 text-white":"bg-white text-gray-700"),children:t.name})})]})},t.id)})]})]}),e.jsxs("div",{className:"glass-card rounded-2xl p-4",children:[E&&e.jsxs("div",{className:"bg-blue-50 rounded-xl p-3 mb-3",children:[e.jsx("div",{className:"text-xs text-blue-600 mb-1",children:"ä½ çš„è¯è¯­"}),e.jsx("div",{className:"text-2xl font-bold text-blue-900",children:E.word})]}),x.announcement&&e.jsx("div",{className:"bg-gray-50 rounded-xl p-3",children:e.jsx("div",{className:"text-sm text-gray-700",children:x.announcement})}),C&&I&&e.jsx("div",{className:"mt-3 animate-slide-up",children:e.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-purple-500 rounded-2xl p-4 text-white shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full overflow-hidden border-2 border-white",children:e.jsx("img",{src:null==(a=x.players.find(e=>e.id===C))?void 0:a.avatar,alt:"",className:"w-full h-full object-cover"})}),e.jsx("div",{className:"font-medium",children:null==(r=x.players.find(e=>e.id===C))?void 0:r.name}),e.jsx("div",{className:"flex-1"}),e.jsx("div",{className:"animate-pulse",children:"ðŸ’¬"})]}),e.jsx("div",{className:"text-sm leading-relaxed",children:I})]})})]}),"describing"===x.status&&e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"glass-card rounded-2xl p-4",children:[e.jsx("h3",{className:"font-bold text-gray-900 mb-3",children:"æè¿°ä½ çš„è¯è¯­"}),x.descriptions.user?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-green-50 rounded-xl p-3",children:[e.jsx("div",{className:"text-xs text-green-600 mb-1",children:"ä½ çš„æè¿°"}),e.jsx("div",{className:"text-sm text-gray-900",children:x.descriptions.user})]}),e.jsx("button",{onClick:async()=>{if(x.descriptions.user){v(!0);try{const t=x.players.filter(e=>e.isAI&&!e.isOut).map(e=>`- ${e.name}ï¼ˆè¯è¯­ï¼š${e.word}ï¼‰`).join("\n"),s=`ä½ æ˜¯æ¸¸æˆä¸»æŒäººï¼Œç¬¬${x.currentRound}è½®æè¿°é˜¶æ®µã€‚\n\nç”¨æˆ·å·²æè¿°ï¼š"${x.descriptions.user}"\n\nè¯·è®©ä»¥ä¸‹AIä¾æ¬¡æè¿°ä»–ä»¬çš„è¯è¯­ï¼š\n${t}\n\nè¦æ±‚ï¼š\n1. æ¯ä¸ªAIä¸€å¥è¯æè¿°è¯è¯­ç‰¹å¾\n2. ä¸è¦è¯´å‡ºè¯è¯­æœ¬èº«\n3. è¦éšè—è‡ªå·±å¯èƒ½æ˜¯å§åº•ï¼ˆå³ä½¿çŸ¥é“è‡ªå·±è¯è¯­ä¸åŒä¹Ÿè¦è£…ä½œæ­£å¸¸ï¼‰\n\næœ€åŽæ€»ç»“å¹¶å¼•å¯¼æŠ•ç¥¨ã€‚\n\n**ä¸¥æ ¼**æŒ‰ç…§ä»¥ä¸‹JSONæ ¼å¼è¿”å›žï¼š\n{\n  "descriptions": {\n    "ai_0": "æè¿°å†…å®¹",\n    "ai_1": "æè¿°å†…å®¹"\n  },\n  "summary": "æ€»ç»“çš„è¯"\n}`,a=await q([{role:"system",content:"ä½ æ˜¯æ¸¸æˆä¸»æŒäººï¼Œåªè¿”å›žJSONæ ¼å¼æ•°æ®ã€‚"},{role:"user",content:s}]);let r;try{const e=a.match(/\{[\s\S]*\}/);if(!e)throw new Error("æœªæ‰¾åˆ°JSONæ ¼å¼");r=JSON.parse(e[0])}catch(e){throw alert("AIè¿”å›žæ ¼å¼é”™è¯¯ï¼Œè¯·é‡è¯•"),e}const l=Object.entries(r.descriptions).map(([e,t])=>({playerId:e,text:t}));z([{playerId:"user",text:x.descriptions.user},...l]);const n=3e3*(l.length+1);setTimeout(()=>{m(e=>({...e,status:"voting",descriptions:{...e.descriptions,...r.descriptions},announcement:r.summary}))},n),p("")}catch(t){alert("AIæè¿°å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{v(!1)}}},disabled:j,className:"w-full bg-blue-500 text-white rounded-xl py-2 text-sm font-medium ios-button disabled:opacity-50",children:j?"AIæ­£åœ¨æè¿°...":"AIå›žå¤"})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("textarea",{value:g,onChange:e=>p(e.target.value),placeholder:"ç”¨ä¸€å¥è¯æè¿°ä½ çš„è¯è¯­ç‰¹å¾ï¼Œä½†ä¸è¦è¯´å‡ºè¯è¯­æœ¬èº«...",disabled:j,className:"w-full glass-card rounded-xl px-4 py-3 text-sm resize-none h-24"}),e.jsx("button",{onClick:()=>{g.trim()&&m(e=>({...e,descriptions:{...e.descriptions,user:g}}))},disabled:!g.trim()||j,className:"w-full bg-blue-500 text-white rounded-xl py-2 text-sm font-medium ios-button disabled:opacity-50",children:"æäº¤æè¿°"})]})]})}),"voting"===x.status&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"glass-card rounded-2xl p-4",children:[e.jsx("h3",{className:"font-bold text-gray-900 mb-3",children:"æ‰€æœ‰äººçš„æè¿°"}),w.map((t,s)=>{const a=x.descriptions[t];if(!a)return null;const r=x.players.find(e=>e.id===t);return r?e.jsx("div",{className:"mb-3 last:mb-0",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("div",{className:"text-xs text-gray-400 w-5 flex-shrink-0",children:[s+1,"."]}),e.jsx("img",{src:r.avatar,alt:r.name,className:"w-8 h-8 rounded-full flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:r.name}),e.jsx("div",{className:"text-sm text-gray-900",children:a})]})]})},t):null})]}),e.jsxs("div",{className:"glass-card rounded-2xl p-4",children:[e.jsx("h3",{className:"font-bold text-gray-900 mb-3",children:"æŠ•ç¥¨é€‰å‡ºå§åº•"}),f?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-green-50 rounded-xl p-3",children:[e.jsx("div",{className:"text-xs text-green-600 mb-1",children:"ä½ æŠ•ç¥¨ç»™"}),e.jsx("div",{className:"text-sm font-medium text-gray-900",children:null==(l=x.players.find(e=>e.id===f))?void 0:l.name})]}),e.jsx("button",{onClick:async()=>{var e;if(f){v(!0);try{const s=x.players.filter(e=>e.isAI&&!e.isOut),a=Object.entries(x.descriptions).map(([e,t])=>{const s=x.players.find(t=>t.id===e);return`- ${null==s?void 0:s.name}ï¼š"${t}"`}).join("\n"),r=s.map(e=>`- ${e.name}ï¼ˆè¯è¯­ï¼š${e.word}ï¼‰`).join("\n"),l=x.players.filter(e=>!e.isOut).map(e=>e.id).join(", "),n=`ä½ æ˜¯æ¸¸æˆä¸»æŒäººï¼Œç¬¬${x.currentRound}è½®æŠ•ç¥¨é˜¶æ®µã€‚\n\næ‰€æœ‰æè¿°ï¼š\n${a}\n\nç”¨æˆ·æŠ•ç¥¨ç»™ï¼š${null==(e=x.players.find(e=>e.id===f))?void 0:e.name}\n\nè¯·ï¼š\n1. è®©ä»¥ä¸‹AIæŠ•ç¥¨ï¼ˆåªèƒ½æŠ•ç»™è¿˜åœ¨åœºçš„çŽ©å®¶ï¼š${l}ï¼‰ï¼š\n${r}\n2. ç»Ÿè®¡æ‰€æœ‰ç¥¨æ•°ï¼ˆåŒ…æ‹¬ç”¨æˆ·çš„ç¥¨ï¼‰\n3. æ‰¾å‡ºå¾—ç¥¨æœ€å¤šçš„çŽ©å®¶ï¼ˆå¦‚æžœå¹³ç¥¨ï¼Œéšæœºé€‰ä¸€ä¸ªï¼‰\n4. è®©è¢«æ·˜æ±°è€…å‘è¡¨é—è¨€ï¼ˆ10-20å­—ï¼‰\n5. å…¬å¸ƒè¢«æ·˜æ±°è€…çš„è¯è¯­\n\n**ä¸¥æ ¼**æŒ‰ç…§ä»¥ä¸‹JSONæ ¼å¼è¿”å›žï¼š\n{\n  "votes": {\n    "ai_0": "è¢«æŠ•ç¥¨è€…id",\n    "ai_1": "è¢«æŠ•ç¥¨è€…id"\n  },\n  "eliminated": "è¢«æ·˜æ±°è€…id",\n  "voteCount": {\n    "user": 1,\n    "ai_0": 2\n  },\n  "lastWords": "é—è¨€å†…å®¹",\n  "eliminatedWord": "è¢«æ·˜æ±°è€…çš„è¯è¯­",\n  "announcement": "å®£å¸ƒç»“æžœçš„è¯"\n}`,i=await q([{role:"system",content:"ä½ æ˜¯æ¸¸æˆä¸»æŒäººï¼Œåªè¿”å›žJSONæ ¼å¼æ•°æ®ã€‚"},{role:"user",content:n}]);let c;try{const e=i.match(/\{[\s\S]*\}/);if(!e)throw new Error("æœªæ‰¾åˆ°JSONæ ¼å¼");c=JSON.parse(e[0])}catch(t){const e=x.players.filter(e=>e.isAI&&!e.isOut),s=e[Math.floor(Math.random()*e.length)];c={votes:{},eliminated:s.id,voteCount:{},lastWords:"æˆ‘...æˆ‘ä¸çŸ¥é“è¯´ä»€ä¹ˆ...",eliminatedWord:s.word,announcement:`${s.name}è¢«æ·˜æ±°äº†ï¼`}}const o=x.players.find(e=>e.id===c.eliminated);if(!o)throw new Error("è¢«æ·˜æ±°çš„çŽ©å®¶ä¸å­˜åœ¨");const d=x.players.map(e=>e.id===c.eliminated?{...e,isOut:!0}:e),h=d.filter(e=>!e.isOut);let u=null;const g=h.filter(e=>e.word===x.undercoverWord).length,p=h.filter(e=>e.word===x.civilianWord).length;0===g?u="civilian":(h.length<=3&&g>0||g>=p)&&(u="undercover"),m(e=>({...e,status:u?"finished":"result",players:d,votes:{user:f,...c.votes},eliminatedPlayer:{id:c.eliminated,name:o.name,word:c.eliminatedWord,lastWords:c.lastWords},announcement:c.announcement,winner:u})),b(null)}catch(s){alert("AIæŠ•ç¥¨å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{v(!1)}}},disabled:j,className:"w-full bg-blue-500 text-white rounded-xl py-2 text-sm font-medium ios-button disabled:opacity-50",children:j?"AIæ­£åœ¨æŠ•ç¥¨...":"AIå›žå¤"})]}):e.jsx("div",{className:"space-y-2",children:D.filter(e=>"user"!==e.id).map(t=>e.jsxs("button",{onClick:()=>{return e=t.id,void b(e);var e},disabled:j,className:"w-full glass-card rounded-xl p-3 ios-button flex items-center gap-3 hover:shadow-lg transition-shadow "+(t.isOut?"opacity-50":""),children:[e.jsx("img",{src:t.avatar,alt:t.name,className:"w-10 h-10 rounded-full"}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.name}),t.isOut&&e.jsx("div",{className:"text-xs text-red-500",children:"å·²å‡ºå±€"})]}),e.jsx("div",{className:"text-gray-400",children:"â€º"})]},t.id))})]})]}),"result"===x.status&&x.eliminatedPlayer&&e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"glass-card rounded-2xl p-4",children:[e.jsx("h3",{className:"font-bold text-gray-900 mb-3",children:"æŠ•ç¥¨ç»“æžœ"}),e.jsxs("div",{className:"bg-red-50 rounded-xl p-4 mb-3",children:[e.jsxs("div",{className:"text-center mb-3",children:[e.jsx("div",{className:"text-sm text-red-600 mb-2",children:"è¢«æ·˜æ±°"}),e.jsx("div",{className:"text-xl font-bold text-red-900",children:x.eliminatedPlayer.name})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 mb-3",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"é—è¨€"}),e.jsxs("div",{className:"text-sm text-gray-900 italic",children:['"',x.eliminatedPlayer.lastWords,'"']})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"TAçš„è¯è¯­æ˜¯"}),e.jsx("div",{className:"text-lg font-bold text-gray-900",children:x.eliminatedPlayer.word})]})]}),x.announcement&&e.jsx("div",{className:"bg-gray-50 rounded-xl p-3 mb-3",children:e.jsx("div",{className:"text-sm text-gray-700",children:x.announcement})}),e.jsx("button",{onClick:()=>{const e=x.players.filter(e=>!e.isOut).map(e=>e.id).sort(()=>Math.random()-.5);k(e),m(e=>({...e,status:"describing",currentRound:e.currentRound+1,descriptions:{},votes:{},eliminatedPlayer:null,announcement:`ç¬¬${e.currentRound+1}è½®å¼€å§‹ï¼è¯·ç»§ç»­æè¿°ã€‚`}))},className:"w-full bg-blue-500 text-white rounded-xl py-3 font-medium ios-button",children:"è¿›å…¥ä¸‹ä¸€è½®"})]})})]}),"finished"===x.status&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"glass-card rounded-2xl p-6 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸŽ‰"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"æ¸¸æˆç»“æŸï¼"}),e.jsx("div",{className:"text-lg text-gray-700 mb-4",children:"civilian"===x.winner?"å¹³æ°‘èŽ·èƒœï¼":"å§åº•èŽ·èƒœï¼"}),e.jsx("div",{className:"bg-gray-50 rounded-xl p-4 mb-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"å¹³æ°‘è¯"}),e.jsx("div",{className:"text-lg font-bold text-blue-600",children:x.civilianWord})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"å§åº•è¯"}),e.jsx("div",{className:"text-lg font-bold text-red-600",children:x.undercoverWord})]})]})}),e.jsx("button",{onClick:()=>{m({status:"setup",players:[],currentRound:0,descriptions:{},votes:{},eliminatedPlayer:null,announcement:"",winner:null,civilianWord:"",undercoverWord:""}),u([]),p(""),b(null),k([])},className:"w-full bg-blue-500 text-white rounded-xl py-3 font-medium ios-button",children:"å†æ¥ä¸€å±€"})]})})]})]})}},Symbol.toStringTag,{value:"Module"})),Ul=()=>{const[s]=t.useState(new Date),[a,r]=t.useState(null),[l,n]=t.useState(null);t.useEffect(()=>{i();const e=()=>{document.hidden||i()},t=()=>{i()};document.addEventListener("visibilitychange",e),window.addEventListener("focus",t);const s=setInterval(i,3e4);return()=>{document.removeEventListener("visibilitychange",e),window.removeEventListener("focus",t),clearInterval(s)}},[]);const i=()=>{const e=mt().filter(e=>ht(e.date)>=0).sort((e,t)=>ht(e.date)-ht(t.date))[0];r(e);const t=xt();n(t)},c=s.getDate(),o=s.getMonth()+1,d=["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"][s.getDay()];return e.jsxs("div",{className:"w-full h-full relative rounded-3xl overflow-hidden shadow-lg border border-white/20 flex flex-col",children:[l&&e.jsx("div",{className:"absolute inset-0 bg-cover bg-center",style:{backgroundImage:`url(${l})`}}),e.jsx("div",{className:"absolute inset-0 bg-white/60"}),e.jsxs("div",{className:"relative z-10 flex-1 flex flex-col",children:[e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center",children:[e.jsx("div",{className:"text-6xl font-bold text-gray-800 leading-none",children:c}),e.jsxs("div",{className:"text-xs text-gray-600 mt-2",children:[o,"æœˆ æ˜ŸæœŸ",d]})]}),a?e.jsx("div",{className:"px-3 py-3 bg-white/90 border-t border-white/30",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"text-xs text-gray-700 truncate flex-1",children:a.title}),e.jsx("span",{className:"text-xs font-bold text-pink-500 whitespace-nowrap",children:(()=>{const e=ht(a.date);return 0===e?"ä»Šå¤©":`${e}å¤©`})()})]})}):e.jsx("div",{className:"px-3 py-3 bg-white/90 border-t border-white/30",children:e.jsx("div",{className:"text-xs text-gray-400 text-center",children:"æš‚æ— çºªå¿µæ—¥"})})]})]})},Vl=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),r=x(),[n,i]=t.useState(0),[c,o]=t.useState(new Date),d=t.useRef(0),m=t.useRef(0),h=t.useRef(0),u=t.useRef(0),g=t.useRef(null),[p,f]=t.useState({}),[b,j]=t.useState(""),[v,y]=t.useState(""),[N,w]=t.useState(""),[k,C]=t.useState(null),[S,I]=t.useState(""),_=t.useRef(null),[M,z]=t.useState({btn1:"å°xå¤§çŽ‹",btn2:"æœ¬å‘½ä¸ºèŒ",btn3:"æ—©æ˜¥æ¨±é›¨",temperature:"19",humidity:"70",status:"ç”Ÿæ´»ç»™æˆ‘ä¸€æ‹³ æˆ‘å‡ºå¸ƒo(Â´^ï½€)o"}),[L,$]=t.useState(null),[A,T]=t.useState("");t.useEffect(()=>{const e=localStorage.getItem("character_avatar");e&&I(e);const t=localStorage.getItem("character_editable_texts");t&&z(JSON.parse(t))},[]);const D=(e,t)=>{$(e),T(t)},E=e=>{if(A.trim()){const t={...M,[e]:A.trim()};z(t),localStorage.setItem("character_editable_texts",JSON.stringify(t))}$(null),T("")},B=e=>{T(e.target.value)},P=(e,t)=>{"Enter"===e.key&&E(t)};t.useEffect(()=>{const e=()=>{const e=localStorage.getItem("custom_desktop_icons");if(e)try{const t=JSON.parse(e),s={};t.forEach(e=>{e.customIcon&&(s[e.id]=e.customIcon)}),f(s)}catch(t){}else f({})};e(),window.addEventListener("storage",e);const t=()=>{e()};return window.addEventListener("customIconUpdate",t),()=>{window.removeEventListener("storage",e),window.removeEventListener("customIconUpdate",t)}},[]),t.useEffect(()=>{const e=async()=>{try{const e=await be("desktop_background");e&&j(e);const t=await be("music_player_background");t&&y(t);const s=await be("character_card_background");s&&w(s)}catch(e){}};e();const t=()=>e(),s=()=>e(),a=()=>e();return window.addEventListener("desktopBackgroundUpdate",t),window.addEventListener("musicBackgroundUpdate",s),window.addEventListener("characterCardBackgroundUpdate",a),()=>{window.removeEventListener("desktopBackgroundUpdate",t),window.removeEventListener("musicBackgroundUpdate",s),window.removeEventListener("characterCardBackgroundUpdate",a)}},[]),t.useEffect(()=>{const e=setInterval(()=>{o(new Date)},1e3);return()=>clearInterval(e)},[]),t.useEffect(()=>{const e=async()=>{try{const t="true"===localStorage.getItem("custom_weather_enabled"),s=localStorage.getItem("custom_weather_data");if(t&&s)try{const e=JSON.parse(s);return void C({temperature:parseInt(e.temp)||25,condition:e.condition||"æ™´å¤©",conditionCN:e.condition||"æ™´å¤©",icon:"â˜€ï¸",location:e.city||"è‡ªå®šä¹‰",humidity:60,windSpeed:10,airQuality:"good"})}catch(e){}const a=localStorage.getItem("weather_city")||"Beijing",r=await yt(a);C(r)}catch(t){C({temperature:25,condition:"sunny",conditionCN:"æ™´å¤©",icon:"â˜€ï¸",location:"åŒ—äº¬",humidity:60,windSpeed:10,airQuality:"good"})}};e();const t=setInterval(e,18e5),s=()=>{e()};return window.addEventListener("weatherCityChange",s),()=>{clearInterval(t),window.removeEventListener("weatherCityChange",s)}},[]),t.useEffect(()=>{const e=g.current;if(!e)return;let t=0,s=0;const a=e=>{t=e.touches[0].clientX,s=e.touches[0].clientY},r=e=>{const a=e.touches[0],r=Math.abs(a.clientX-t);r>Math.abs(a.clientY-s)&&r>10&&e.preventDefault()};return e.addEventListener("touchstart",a),e.addEventListener("touchmove",r,{passive:!1}),()=>{e.removeEventListener("touchstart",a),e.removeEventListener("touchmove",r)}},[]);const F=(e,t)=>p[e]||t,O=[{id:"wechat-app",name:"å¾®ä¿¡",icon:F("wechat-app",as),color:"glass-card",route:"/wechat"},{id:"preset",name:"é¢„è®¾",icon:F("preset",Ss),color:"glass-card",route:"/preset"},{id:"worldbook",name:"ä¸–ç•Œä¹¦",icon:F("worldbook",Hs),color:"glass-card",route:"/worldbook"},{id:"music-app",name:"éŸ³ä¹",icon:F("music-app",Ws),color:"glass-card",route:"/music-player"},{id:"settings",name:"ç³»ç»Ÿè®¾ç½®",icon:F("settings",Ss),color:"glass-card",route:"/settings-new"}],W=[{id:"footprint",name:"è¶³è¿¹",icon:F("footprint",na),color:"glass-card",route:"/ai-footprint"},{id:"forum",name:"è®ºå›",icon:F("forum",ia),color:"glass-card",route:"/forum"},{id:"aiphone",name:"æŸ¥æ‰‹æœº",icon:F("aiphone",xa),color:"glass-card",route:"/ai-phone-select"},{id:"calendar",name:"æ—¥åŽ†",icon:F("calendar",qs),color:"glass-card",route:"/calendar"}],R=[{id:"offline",name:"çº¿ä¸‹",icon:F("offline",as),color:"glass-card",route:"/offline-chat"},{id:"customize",name:"ç¾ŽåŒ–",icon:F("customize",Ss),color:"glass-card",route:"/customize"},{id:"api-config",name:"APIé…ç½®",icon:F("api-config",Ss),color:"glass-card",route:"/api-list"},{id:"browser",name:"æµè§ˆå™¨",icon:F("browser",Gs),color:"glass-card",route:"/browser"}],U=(e,t)=>{e.preventDefault(),e.stopPropagation(),t.onClick?t.onClick():t.route&&a(t.route)};return e.jsxs("div",{className:"h-screen w-full relative overflow-hidden bg-[#f5f7fa]",style:{touchAction:"pan-y pinch-zoom"},children:[e.jsx("div",{className:"absolute inset-0",style:{backgroundImage:b?`url(${b})`:"none",backgroundSize:"cover",backgroundPosition:"center",backgroundColor:b?"transparent":"#f5f7fa"},children:!b&&e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-white/50 to-gray-100/30"})}),e.jsxs("div",{className:"relative h-full flex flex-col",children:[e.jsx("div",{style:{background:"transparent",position:"relative",zIndex:1},children:e.jsx("div",{style:{background:"transparent"},children:e.jsx(ua,{})})}),e.jsx("div",{ref:g,className:"flex-1 overflow-hidden",style:{touchAction:"none"},onTouchStart:e=>{d.current=e.touches[0].clientX,h.current=e.touches[0].clientY},onTouchMove:e=>{m.current=e.touches[0].clientX,u.current=e.touches[0].clientY},onTouchEnd:()=>{const e=d.current-m.current,t=Math.abs(u.current-h.current);Math.abs(e)>50&&Math.abs(e)>t&&(e>0&&n<1?i(1):e<0&&n>0&&i(0))},children:e.jsxs("div",{className:"h-full flex transition-transform duration-300 ease-out",style:{transform:`translateX(-${100*n}%)`},children:[e.jsxs("div",{className:"min-w-full h-full px-4 py-2 overflow-y-auto flex flex-col hide-scrollbar",children:[e.jsxs("div",{className:"p-6 mb-4 text-center",children:[e.jsx("div",{className:"text-8xl font-bold text-gray-900 mb-2",children:c.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})}),e.jsx("div",{className:"text-lg font-semibold text-gray-600",children:c.toLocaleDateString("zh-CN",{month:"long",day:"numeric",weekday:"long"})})]}),e.jsx("div",{className:"glass-card rounded-3xl p-4 shadow-lg border border-white/30 relative overflow-visible cursor-pointer mb-4",onClick:()=>a("/music-player"),style:{backgroundImage:v?`url(${v})`:"none",backgroundSize:"cover",backgroundPosition:"center"},children:r.currentSong?e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"relative w-32 h-32 flex-shrink-0",children:e.jsx("div",{className:"w-32 h-32 rounded-full backdrop-blur-md bg-white/20 shadow-2xl flex items-center justify-center border-2 border-white/30 "+(r.isPlaying?"animate-spin-slow":""),children:e.jsx("div",{className:"w-[115px] h-[115px] rounded-full overflow-hidden shadow-inner bg-white flex items-center justify-center",children:r.currentSong.cover?e.jsx("img",{src:r.currentSong.cover,alt:r.currentSong.title,className:"w-full h-full object-contain"}):e.jsx(Ws,{size:32,className:"text-blue-500"})})})}),e.jsxs("div",{className:"flex-1 flex flex-col justify-center gap-2",children:[e.jsx("div",{className:"text-lg font-bold text-gray-900 truncate",children:r.currentSong.title}),e.jsx("div",{className:"text-sm text-gray-500 truncate",children:r.currentSong.artist}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsx("button",{onClick:e=>{e.stopPropagation()},className:"w-10 h-10 rounded-full bg-white/80 flex items-center justify-center shadow-sm active:scale-95 transition-transform",children:e.jsx(Rs,{size:18,className:"text-red-500"})}),e.jsx("button",{onClick:e=>{e.stopPropagation(),r.togglePlay()},className:"w-10 h-10 rounded-full bg-white/80 flex items-center justify-center shadow-sm active:scale-95 transition-transform",children:r.isPlaying?e.jsx(Vs,{size:18,className:"text-gray-700"}):e.jsx(Us,{size:18,className:"text-gray-700"})}),e.jsx("button",{onClick:e=>{e.stopPropagation(),r.next()},className:"w-10 h-10 rounded-full bg-white/80 flex items-center justify-center shadow-sm active:scale-95 transition-transform",children:e.jsx(Js,{size:18,className:"text-gray-700"})})]})]})]}):e.jsx("div",{className:"flex items-center justify-center h-32 text-gray-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ws,{size:32,className:"mx-auto mb-2"}),e.jsx("div",{className:"text-sm",children:"æš‚æ— æ’­æ”¾éŸ³ä¹"})]})})}),e.jsx("div",{className:"grid grid-cols-4 gap-4 auto-rows-min",children:O.map(t=>{const s="string"==typeof t.icon,a="wechat-app"===t.id;return e.jsxs("div",{onClick:e=>U(e,t),className:"flex flex-col items-center gap-1 cursor-pointer active:scale-95 transition-transform "+(a?"col-span-2 row-span-2":""),children:[s?e.jsx("div",{className:(a?"w-36 h-36":"w-14 h-14")+" flex items-center justify-center",children:e.jsx("img",{src:t.icon,alt:t.name,className:"w-full h-full object-contain"})}):e.jsx("div",{className:`${a?"w-36 h-36":"w-14 h-14"} ${t.color} rounded-2xl flex items-center justify-center shadow-lg border border-white/30`,children:l.createElement(t.icon,{size:a?64:28,className:"text-gray-300"})}),e.jsx("span",{className:"text-xs text-gray-700 text-center font-medium",children:t.name})]},t.id)})})]}),e.jsxs("div",{className:"min-w-full h-full px-4 overflow-y-auto flex flex-col hide-scrollbar",style:{paddingTop:"20px",paddingBottom:"8px"},children:[e.jsxs("div",{className:"glass-card rounded-3xl p-4 shadow-lg border border-white/30 relative bg-gradient-to-br from-white/80 to-white/40 mb-4 cursor-pointer ios-button",onClick:()=>a("/weather-detail"),style:{overflow:"visible"},children:[k&&(()=>{const t=k.condition.toLowerCase();return t.includes("clear")||t.includes("sunny")||"æ™´å¤©"===t||"æ™´"===t?e.jsxs("div",{className:"absolute -top-2 -right-2 w-20 h-20",children:[e.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-br from-yellow-300/40 to-orange-300/20 blur-xl"}),e.jsx("div",{className:"absolute inset-2 rounded-full bg-gradient-to-br from-yellow-300 via-yellow-400 to-orange-400 shadow-lg"}),e.jsx("div",{className:"absolute top-3 left-3 w-8 h-8 rounded-full bg-white/50 blur-md"})]}):t.includes("rain")||"é›¨"===t||t.includes("shower")?e.jsxs("div",{className:"absolute top-4 right-6",children:[e.jsxs("div",{className:"relative w-16 h-10 mb-2",children:[e.jsx("div",{className:"absolute inset-0 rounded-full bg-gray-400/40 blur-sm translate-y-1"}),e.jsx("div",{className:"absolute bottom-0 left-2 w-8 h-6 rounded-full bg-gradient-to-br from-gray-300 to-gray-400 shadow-md"}),e.jsx("div",{className:"absolute bottom-1 left-5 w-10 h-7 rounded-full bg-gradient-to-br from-gray-300 to-gray-400 shadow-md"}),e.jsx("div",{className:"absolute bottom-0 right-1 w-7 h-5 rounded-full bg-gradient-to-br from-gray-300 to-gray-400 shadow-md"})]}),e.jsxs("div",{className:"flex gap-1 ml-4",children:[e.jsx("div",{className:"w-1 h-3 bg-blue-400/60 rounded-full"}),e.jsx("div",{className:"w-1 h-3 bg-blue-400/60 rounded-full"}),e.jsx("div",{className:"w-1 h-3 bg-blue-400/60 rounded-full"})]})]}):t.includes("cloud")||"å¤šäº‘"===t||"é˜´"===t?e.jsxs("div",{className:"absolute top-6 right-8 w-16 h-10",children:[e.jsx("div",{className:"absolute inset-0 rounded-full bg-gray-300/30 blur-sm translate-y-1"}),e.jsx("div",{className:"absolute bottom-0 left-2 w-8 h-6 rounded-full bg-gradient-to-br from-white to-gray-100 shadow-md"}),e.jsx("div",{className:"absolute bottom-1 left-5 w-10 h-7 rounded-full bg-gradient-to-br from-white to-gray-100 shadow-md"}),e.jsx("div",{className:"absolute bottom-0 right-1 w-7 h-5 rounded-full bg-gradient-to-br from-white to-gray-100 shadow-md"})]}):t.includes("snow")||"é›ª"===t?e.jsx("div",{className:"absolute top-4 right-6 text-4xl",children:"â„ï¸"}):t.includes("fog")||t.includes("mist")||"é›¾"===t?e.jsx("div",{className:"absolute top-6 right-6 text-4xl opacity-70",children:"ðŸŒ«ï¸"}):e.jsxs("div",{className:"absolute -top-2 -right-2 w-20 h-20",children:[e.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-br from-yellow-300/40 to-orange-300/20 blur-xl"}),e.jsx("div",{className:"absolute inset-2 rounded-full bg-gradient-to-br from-yellow-300 via-yellow-400 to-orange-400 shadow-lg"}),e.jsx("div",{className:"absolute top-3 left-3 w-8 h-8 rounded-full bg-white/50 blur-md"})]})})(),e.jsx("div",{className:"relative z-10 flex flex-col h-full",children:k?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-5xl font-extralight text-gray-800 leading-none mb-1",children:[k.temperature,e.jsx("span",{className:"text-2xl align-top",children:"Â°"})]}),e.jsx("div",{className:"text-sm text-gray-600 mb-auto capitalize",children:k.conditionCN}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex items-center gap-1 text-[11px] text-gray-500",children:[e.jsx("svg",{className:"w-3 h-3",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M12 2L14 8L20 10L14 12L12 18L10 12L4 10L10 8L12 2Z",fill:"currentColor",opacity:"0.6"})}),e.jsxs("span",{children:["Air ",k.airQuality]})]}),e.jsx("div",{className:"text-[11px] text-gray-500",children:k.location})]})]}):e.jsx("div",{className:"text-sm text-gray-500",children:"åŠ è½½ä¸­..."})})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",style:{gridAutoRows:"90px"},children:[e.jsx("div",{className:"col-span-2 row-span-2 cursor-pointer active:scale-95 transition-transform",onClick:()=>a("/calendar"),children:e.jsx(Ul,{})}),W.map(t=>{const s="string"==typeof t.icon;return e.jsxs("div",{onClick:e=>U(e,t),className:"flex flex-col items-center gap-1 cursor-pointer active:scale-95 transition-transform",children:[s?e.jsx("div",{className:"w-14 h-14",children:e.jsx("img",{src:t.icon,alt:t.name,className:"w-full h-full object-contain"})}):e.jsx("div",{className:`w-14 h-14 ${t.color} rounded-2xl flex items-center justify-center shadow-lg border border-white/30`,children:l.createElement(t.icon,{size:28,className:"text-gray-300"})}),e.jsx("span",{className:"text-xs text-gray-700 text-center font-medium",children:t.name})]},t.id)})]}),e.jsx("input",{ref:_,type:"file",accept:"image/*",onChange:async e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(!s)return;const a=new FileReader;a.onload=e=>{var t;const s=null==(t=e.target)?void 0:t.result;I(s),localStorage.setItem("character_avatar",s)},a.readAsDataURL(s)},style:{display:"none"}}),e.jsxs("div",{className:"character-card-widget character-card-floating",style:{marginTop:"50px",marginBottom:"15px",position:"relative",zIndex:100,backgroundImage:N?`url(${N})`:void 0,backgroundSize:"cover",backgroundPosition:"center"},children:[e.jsx("div",{className:"character-card-corner-bubble",children:"å‘†"}),e.jsx("div",{className:"character-card-main",onClick:()=>{var e;null==(e=_.current)||e.click()},style:{cursor:"pointer"},children:S?e.jsx("img",{src:S,alt:"è§’è‰²å¤´åƒ"}):"X"}),e.jsxs("div",{className:"character-card-weather-info",children:[e.jsx("div",{className:"character-card-weather-value",onClick:()=>D("temperature",M.temperature),style:{cursor:"pointer"},children:"temperature"===L?e.jsx("input",{type:"text",value:A,onChange:B,onBlur:()=>E("temperature"),onKeyPress:e=>P(e,"temperature"),autoFocus:!0,style:{width:"60px",textAlign:"center",background:"transparent",border:"1px solid #ccc",borderRadius:"4px",fontSize:"inherit",fontWeight:"inherit"}}):`${M.temperature}Â°C`}),e.jsx("div",{className:"character-card-weather-value",onClick:()=>D("humidity",M.humidity),style:{cursor:"pointer"},children:"humidity"===L?e.jsx("input",{type:"text",value:A,onChange:B,onBlur:()=>E("humidity"),onKeyPress:e=>P(e,"humidity"),autoFocus:!0,style:{width:"60px",textAlign:"center",background:"transparent",border:"1px solid #ccc",borderRadius:"4px",fontSize:"inherit",fontWeight:"inherit"}}):`${M.humidity}%`})]}),e.jsx("div",{className:"character-card-bunny-status",onClick:()=>D("status",M.status),style:{cursor:"pointer"},children:"status"===L?e.jsx("input",{type:"text",value:A,onChange:B,onBlur:()=>E("status"),onKeyPress:e=>P(e,"status"),autoFocus:!0,style:{width:"100%",textAlign:"center",background:"transparent",border:"1px solid #ccc",borderRadius:"4px",fontSize:"inherit",color:"inherit"}}):M.status})]}),e.jsxs("div",{className:"character-card-function-row",style:{marginBottom:"15px"},children:[e.jsx("div",{className:"character-card-function-btn",onClick:e=>{e.stopPropagation(),D("btn1",M.btn1)},style:{cursor:"pointer"},children:"btn1"===L?e.jsx("input",{type:"text",value:A,onChange:B,onBlur:()=>E("btn1"),onKeyPress:e=>P(e,"btn1"),onClick:e=>e.stopPropagation(),autoFocus:!0,style:{width:"100%",textAlign:"center",background:"transparent",border:"1px solid #ccc",borderRadius:"4px",fontSize:"inherit",color:"inherit"}}):M.btn1}),e.jsx("div",{className:"character-card-function-btn",onClick:e=>{e.stopPropagation(),D("btn2",M.btn2)},style:{cursor:"pointer"},children:"btn2"===L?e.jsx("input",{type:"text",value:A,onChange:B,onBlur:()=>E("btn2"),onKeyPress:e=>P(e,"btn2"),onClick:e=>e.stopPropagation(),autoFocus:!0,style:{width:"100%",textAlign:"center",background:"transparent",border:"1px solid #ccc",borderRadius:"4px",fontSize:"inherit",color:"inherit"}}):M.btn2}),e.jsx("div",{className:"character-card-function-btn",onClick:e=>{e.stopPropagation(),D("btn3",M.btn3)},style:{cursor:"pointer"},children:"btn3"===L?e.jsx("input",{type:"text",value:A,onChange:B,onBlur:()=>E("btn3"),onKeyPress:e=>P(e,"btn3"),onClick:e=>e.stopPropagation(),autoFocus:!0,style:{width:"100%",textAlign:"center",background:"transparent",border:"1px solid #ccc",borderRadius:"4px",fontSize:"inherit",color:"inherit"}}):M.btn3})]})]})]})}),e.jsx("div",{className:"flex justify-center gap-2 py-4",children:[0,1].map(t=>e.jsx("div",{onClick:()=>i(t),className:"h-2 rounded-full transition-all duration-300 cursor-pointer "+(t===n?"bg-gray-800 w-6":"bg-gray-400 w-2 hover:bg-gray-500")},t))}),e.jsx("div",{className:"pb-6 px-4",children:e.jsx("div",{className:"glass-effect rounded-3xl p-3 shadow-xl border border-white/30",children:e.jsx("div",{className:"grid grid-cols-4 gap-3",children:R.map(t=>{const s="string"==typeof t.icon;return e.jsx("div",{onClick:e=>U(e,t),className:"flex flex-col items-center cursor-pointer active:scale-95 transition-transform",children:s?e.jsx("div",{className:"w-14 h-14",children:e.jsx("img",{src:t.icon,alt:t.name,className:"w-full h-full object-contain"})}):e.jsx("div",{className:`w-14 h-14 ${t.color} rounded-2xl flex items-center justify-center shadow-lg border border-white/30`,children:l.createElement(t.icon,{size:28,className:"text-gray-300"})})},t.id)})})})})]})]})}},Symbol.toStringTag,{value:"Module"})),Jl=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{currentUser:r}=d(),{characters:l}=n(),[i,c]=t.useState(null),[o,x]=t.useState([]),[m,h]=t.useState(""),[u,g]=t.useState(!1),p=t.useRef(null),f=t.useRef(null);t.useEffect(()=>{var e;null==(e=p.current)||e.scrollIntoView({behavior:"smooth"})},[o]);const b=async()=>{if(!m.trim()||u)return;const e={id:Date.now().toString(),role:"user",content:m,timestamp:new Date};x(t=>[...t,e]),h(""),g(!0);try{const e=o.slice(-5).map(e=>`${"user"===e.role?(null==r?void 0:r.name)||"ä½ ":(null==i?void 0:i.name)||"AI"}: ${e.content}`).join("\n"),t=`${i?`\nè§’è‰²åå­—ï¼š${i.name}\nè®¾å®šï¼š${i.description||""}\nç³»ç»Ÿæç¤ºè¯ï¼š${i.systemPrompt||""}\nå…³ç³»ï¼šä½ ä»¬æ­£åœ¨çº¿ä¸‹è§é¢`:"ä½ æ˜¯ä¸€ä¸ªå°è¯´é£Žæ ¼çš„AIåŠ©æ‰‹"}\n\nåœºæ™¯ï¼šä½ ä»¬åœ¨å’–å•¡åº—è§é¢ï¼Œè¯·ç”¨å°è¯´çš„å½¢å¼å›žå¤ã€‚\n\næ ¼å¼è¦æ±‚ï¼š\n- å¯¹è¯ç”¨å¼•å·ï¼š${(null==i?void 0:i.name)||"AI"}ï¼š"ä½ å¥½"\n- å¿ƒç†æ´»åŠ¨ç”¨æ‹¬å·ï¼š(${(null==i?void 0:i.name)||"ä»–"}æƒ³...)\n- åŠ¨ä½œç”¨æ˜Ÿå·ï¼š*ç‚¹äº†ç‚¹å¤´*\n- åœºæ™¯æå†™ç›´æŽ¥å†™\n\nå¯¹è¯åŽ†å²ï¼š\n${e}\n\n${(null==r?void 0:r.name)||"ä½ "}: ${m}\n\nè¯·ä»¥${(null==i?void 0:i.name)||"AI"}çš„èº«ä»½ï¼Œç”¨å°è¯´å½¢å¼å›žå¤ï¼ˆ100-200å­—ï¼‰ï¼š`,s=await q(t),a={id:(Date.now()+1).toString(),role:"assistant",content:s,timestamp:new Date};x(e=>[...e,a])}catch(t){alert("å‘é€å¤±è´¥ï¼Œè¯·æ£€æŸ¥APIé…ç½®")}finally{g(!1)}};return i?e.jsxs("div",{className:"h-screen w-full bg-white flex flex-col",children:[e.jsxs("div",{className:"glass-card border-b border-white/30",children:[e.jsx(ua,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>{c(null),x([])},className:"w-10 h-10 flex items-center justify-center active:scale-95 transition-transform",children:e.jsx(os,{size:24,className:"text-blue-500"})}),e.jsxs("h1",{className:"text-xl font-semibold text-gray-900",children:["ä¸Ž ",i.name," è§é¢"]}),e.jsx("div",{className:"w-10"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-4 space-y-4",children:[0===o.length&&e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-400 text-lg mb-2",children:"ðŸ“– å¼€å§‹ä½ çš„æ•…äº‹"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"è¾“å…¥ä»»ä½•å†…å®¹ï¼ŒAIä¼šä»¥å°è¯´å½¢å¼å›žå¤"})]})}),o.map(t=>e.jsx("div",{className:"animate-fadeIn",children:"user"===t.role?e.jsx("div",{className:"flex justify-end",children:e.jsx("div",{className:"glass-card rounded-2xl px-4 py-2 max-w-[80%] shadow-lg border border-white/30",children:e.jsx("p",{className:"text-gray-800",children:t.content})})}):e.jsx("div",{className:"max-w-2xl",children:e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:e.jsx("div",{className:"text-base leading-relaxed text-gray-800 whitespace-pre-wrap",children:t.content})})})},t.id)),u&&e.jsx("div",{className:"flex justify-start",children:e.jsxs("div",{className:"glass-card rounded-full px-4 py-2 flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full animate-bounce",style:{animationDelay:"0.2s"}}),e.jsx("span",{className:"text-sm text-gray-600 ml-2",children:"æ­£åœ¨åˆ›ä½œ..."})]})}),e.jsx("div",{ref:p})]}),e.jsx("div",{className:"glass-card border-t border-white/30 px-4 py-3",children:e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("textarea",{ref:f,value:m,onChange:e=>h(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),b())},placeholder:"è¾“å…¥ä»»ä½•å†…å®¹ï¼Œå¼€å§‹ä½ çš„æ•…äº‹...",disabled:u,className:"flex-1 bg-white/50 rounded-xl px-4 py-3 resize-none focus:outline-none focus:ring-2 focus:ring-purple-500 disabled:opacity-50",rows:1,style:{maxHeight:"120px"}}),e.jsx("button",{onClick:b,disabled:!m.trim()||u,className:"w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-xl flex items-center justify-center active:scale-95 transition-transform disabled:opacity-50 shadow-lg",children:e.jsx(xs,{size:20})})]})})]}):e.jsxs("div",{className:"h-screen w-full bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50 flex flex-col",children:[e.jsxs("div",{className:"glass-card border-b border-white/30",children:[e.jsx(ua,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a("/"),className:"w-10 h-10 flex items-center justify-center active:scale-95 transition-transform",children:e.jsx(os,{size:24,className:"text-blue-500"})}),e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"é€‰æ‹©è§é¢å¯¹è±¡"}),e.jsx("div",{className:"w-10"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-4",children:0===l.length?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-400 text-lg mb-4",children:"è¿˜æ²¡æœ‰è§’è‰²"}),e.jsx("button",{onClick:()=>a("/create-character"),className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-6 py-3 rounded-xl active:scale-95 transition-transform",children:"åˆ›å»ºè§’è‰²"})]})}):e.jsx("div",{className:"grid grid-cols-2 gap-4",children:l.map(t=>e.jsxs("div",{onClick:()=>c(t),className:"glass-card rounded-2xl p-4 cursor-pointer active:scale-95 transition-transform",children:[e.jsx("div",{className:"w-20 h-20 rounded-full mx-auto mb-3 overflow-hidden bg-gradient-to-br from-blue-400 to-purple-400",children:t.avatar?e.jsx("img",{src:t.avatar,alt:t.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-white text-2xl font-bold",children:t.name.charAt(0)})}),e.jsx("h3",{className:"text-center font-semibold text-gray-900 mb-1",children:t.name}),e.jsx("p",{className:"text-center text-xs text-gray-500 line-clamp-2",children:t.description||"æœªè®¾ç½®"})]},t.id))})})]})}},Symbol.toStringTag,{value:"Module"})),Hl=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),[l,n]=t.useState([]),[i,c]=t.useState(""),[d,x]=t.useState(null);t.useEffect(()=>{m()},[]);const m=()=>{const e=me.getAllLorebooks();n(e)},h=()=>{a("/worldbook/create")},u=()=>{const e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(!s)return;const a=new FileReader;a.onload=e=>{var t;const s=null==(t=e.target)?void 0:t.result;me.importLorebook(s)?(m(),alert("å¯¼å…¥æˆåŠŸ")):alert("å¯¼å…¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼")},a.readAsText(s)},e.click()},g=l.filter(e=>e.name.toLowerCase().includes(i.toLowerCase())||e.description.toLowerCase().includes(i.toLowerCase()));return e.jsxs("div",{className:"h-full flex flex-col bg-gray-50",children:[e.jsxs("div",{className:"glass-effect sticky top-0 z-50",children:[r&&e.jsx(ua,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a("/settings",{replace:!0}),className:"ios-button text-gray-700",children:e.jsx(os,{size:24})}),e.jsx("h1",{className:"text-base font-semibold text-gray-900",children:"ä¸–ç•Œä¹¦"}),e.jsx("button",{onClick:h,className:"ios-button text-primary",children:e.jsx(cs,{size:24})})]})]}),e.jsx("div",{className:"px-3 pt-3 pb-2",children:e.jsxs("div",{className:"glass-card rounded-2xl px-4 py-2 flex items-center gap-2",children:[e.jsx(is,{size:18,className:"text-gray-400"}),e.jsx("input",{type:"text",placeholder:"æœç´¢ä¸–ç•Œä¹¦",value:i,onChange:e=>c(e.target.value),className:"flex-1 bg-transparent border-none outline-none text-sm text-gray-900 placeholder-gray-400"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-3 pb-3",children:0===g.length?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“š"}),e.jsx("div",{className:"text-sm mb-2",children:"æš‚æ— ä¸–ç•Œä¹¦"}),e.jsx("div",{className:"text-xs text-gray-400 mb-4",children:"åˆ›å»ºä¸–ç•Œä¹¦æˆ–å¯¼å…¥çŽ°æœ‰çš„ä¸–ç•Œä¹¦"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:h,className:"glass-card rounded-xl px-6 py-2 text-sm text-primary font-medium",children:"åˆ›å»ºä¸–ç•Œä¹¦"}),e.jsx("button",{onClick:u,className:"glass-card rounded-xl px-6 py-2 text-sm text-gray-700 font-medium",children:"å¯¼å…¥ä¸–ç•Œä¹¦"})]})]}):e.jsx("div",{className:"space-y-2",children:g.map(t=>e.jsxs("div",{className:"glass-card rounded-2xl p-4 relative",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:t.name}),t.is_global&&e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-blue-100 text-blue-600",children:"å…¨å±€"})]}),t.description&&e.jsx("p",{className:"text-xs text-gray-500 line-clamp-2",children:t.description})]}),e.jsx("button",{onClick:()=>x(d===t.id?null:t.id),className:"ios-button text-gray-400 ml-2",children:e.jsx(ds,{size:20})})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-400",children:[e.jsxs("span",{children:[t.entries.length," æ¡ç›®"]}),e.jsxs("span",{children:["æ‰«ææ·±åº¦ ",t.scan_depth]}),e.jsxs("span",{children:["é¢„ç®— ",t.token_budget]})]}),d===t.id&&e.jsxs("div",{className:"absolute right-4 top-14 glass-effect rounded-xl shadow-lg border border-white/30 overflow-hidden z-10",children:[e.jsx("button",{onClick:()=>{var e;e=t.id,a(`/worldbook/edit/${e}`),x(null)},className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-white/50",children:"ç¼–è¾‘"}),e.jsx("button",{onClick:()=>{(e=>{const t=me.exportLorebook(e);if(!t)return;const s=new Blob([t],{type:"application/json"}),a=URL.createObjectURL(s),r=document.createElement("a");r.href=a,r.download=`lorebook_${e}.json`,r.click(),URL.revokeObjectURL(a)})(t.id),x(null)},className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-white/50",children:"å¯¼å‡º"}),e.jsx("button",{onClick:()=>{var e;e=t.id,confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªä¸–ç•Œä¹¦å—ï¼Ÿ")&&(me.deleteLorebook(e),m()),x(null)},className:"w-full px-4 py-2 text-left text-sm text-red-500 hover:bg-white/50",children:"åˆ é™¤"})]})]},t.id))})}),l.length>0&&e.jsx("div",{className:"p-3 glass-effect border-t border-white/30",children:e.jsx("button",{onClick:u,className:"w-full glass-card rounded-xl py-3 text-sm font-medium text-gray-700",children:"å¯¼å…¥ä¸–ç•Œä¹¦"})})]})}},Symbol.toStringTag,{value:"Module"})),Gl=({entry:s,isEditing:a,onEdit:r,onCollapse:l,onUpdate:n,onDelete:i})=>{const[c,o]=t.useState(""),d=()=>{c.trim()&&(n({keys:[...s.keys,c.trim()]}),o(""))};return e.jsxs("div",{className:"glass-card rounded-2xl p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",value:s.name,onChange:e=>n({name:e.target.value}),className:"w-full bg-transparent text-sm font-semibold text-gray-900 border-none outline-none",placeholder:"æ¡ç›®åç§°"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>n({enabled:!s.enabled}),className:"w-10 h-5 rounded-full transition-colors "+(s.enabled?"bg-primary":"bg-gray-300"),children:e.jsx("div",{className:"w-4 h-4 rounded-full bg-white shadow-sm transition-transform "+(s.enabled?"translate-x-5":"translate-x-0.5")})}),e.jsx("button",{onClick:i,className:"ios-button text-red-500",children:e.jsx("svg",{width:18,height:18,viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})})]})]}),a?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"è§¦å‘å…³é”®è¯"}),e.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:s.keys.map((t,a)=>e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs px-2 py-0.5 rounded-full bg-blue-100 text-blue-600",children:[t,e.jsx("button",{onClick:()=>{return e=a,void n({keys:s.keys.filter((t,s)=>s!==e)});var e},className:"text-blue-400 hover:text-blue-600",children:"Ã—"})]},a))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:c,onChange:e=>o(e.target.value),onKeyPress:e=>"Enter"===e.key&&d(),className:"flex-1 bg-white/50 rounded-xl px-3 py-1.5 text-xs text-gray-900 border border-white/30 outline-none focus:border-primary",placeholder:"è¾“å…¥å…³é”®è¯åŽæŒ‰å›žè½¦"}),e.jsx("button",{onClick:d,className:"glass-card rounded-xl px-3 py-1.5 text-xs text-primary",children:"æ·»åŠ "})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"æ³¨å…¥å†…å®¹"}),e.jsx("textarea",{value:s.content,onChange:e=>n({content:e.target.value}),className:"w-full bg-white/50 rounded-xl px-3 py-2 text-xs text-gray-900 border border-white/30 outline-none focus:border-primary resize-none",placeholder:"å½“å…³é”®è¯è¢«è§¦å‘æ—¶ï¼Œè¿™æ®µå†…å®¹ä¼šè¢«æ³¨å…¥åˆ°æç¤ºè¯ä¸­",rows:4})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-500 mb-1",children:"ä¼˜å…ˆçº§"}),e.jsx("input",{type:"number",value:s.priority,onChange:e=>n({priority:parseInt(e.target.value)||0}),className:"w-full bg-white/50 rounded-xl px-2 py-1 text-gray-900 border border-white/30 outline-none",min:"0",max:"999"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-500 mb-1",children:"ä½ç½®"}),e.jsxs("select",{value:s.position,onChange:e=>n({position:e.target.value}),className:"w-full bg-white/50 rounded-xl px-2 py-1 text-gray-900 border border-white/30 outline-none",children:[e.jsx("option",{value:"top",children:"é¡¶éƒ¨"}),e.jsx("option",{value:"before_char",children:"è§’è‰²å‰"}),e.jsx("option",{value:"after_char",children:"è§’è‰²åŽ"}),e.jsx("option",{value:"bottom",children:"åº•éƒ¨"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"å¤§å°å†™æ•æ„Ÿ"}),e.jsx("button",{onClick:()=>n({case_sensitive:!s.case_sensitive}),className:"w-10 h-5 rounded-full transition-colors "+(s.case_sensitive?"bg-primary":"bg-gray-300"),children:e.jsx("div",{className:"w-4 h-4 rounded-full bg-white shadow-sm transition-transform "+(s.case_sensitive?"translate-x-5":"translate-x-0.5")})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"å§‹ç»ˆæ³¨å…¥"}),e.jsx("button",{onClick:()=>n({constant:!s.constant}),className:"w-10 h-5 rounded-full transition-colors "+(s.constant?"bg-primary":"bg-gray-300"),children:e.jsx("div",{className:"w-4 h-4 rounded-full bg-white shadow-sm transition-transform "+(s.constant?"translate-x-5":"translate-x-0.5")})})]}),e.jsx("button",{onClick:l,className:"w-full text-xs text-gray-500 py-2",children:"æ”¶èµ·"})]}):e.jsxs("div",{onClick:r,className:"cursor-pointer",children:[e.jsxs("div",{className:"flex flex-wrap gap-1 mb-2",children:[s.keys.slice(0,3).map((t,s)=>e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-blue-100 text-blue-600",children:t},s)),s.keys.length>3&&e.jsxs("span",{className:"text-xs px-2 py-0.5 rounded-full bg-gray-100 text-gray-500",children:["+",s.keys.length-3]})]}),s.content&&e.jsx("p",{className:"text-xs text-gray-500 line-clamp-2",children:s.content})]})]})},ql=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{id:l}=r(),{showStatusBar:i}=o(),{characters:c}=n(),[d,x]=t.useState(null),[m,h]=t.useState(null),[u,g]=t.useState(!1);t.useEffect(()=>{if(l){const e=me.getLorebook(l);x(e)}else{const e={id:"",name:"æ–°ä¸–ç•Œä¹¦",description:"",entries:[],scan_depth:10,token_budget:2e3,recursive_scanning:!1,is_global:!1,character_ids:[],created_at:Date.now(),updated_at:Date.now()};x(e)}},[l]);return d?e.jsxs("div",{className:"h-full flex flex-col bg-gray-50",children:[e.jsxs("div",{className:"glass-effect sticky top-0 z-50",children:[i&&e.jsx(ua,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a(-1),className:"ios-button text-gray-700",children:"å–æ¶ˆ"}),e.jsx("h1",{className:"text-base font-semibold text-gray-900",children:l?"ç¼–è¾‘ä¸–ç•Œä¹¦":"åˆ›å»ºä¸–ç•Œä¹¦"}),e.jsx("button",{onClick:()=>{d&&(l?me.updateLorebook(l,d):me.createLorebook(d),a("/worldbook"))},className:"ios-button text-primary font-medium",children:"ä¿å­˜"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-3 pt-3 pb-3",children:[e.jsxs("div",{className:"glass-card rounded-2xl p-4 mb-3",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"åç§°"}),e.jsx("input",{type:"text",value:d.name,onChange:e=>x({...d,name:e.target.value}),className:"w-full bg-white/50 rounded-xl px-3 py-2 text-sm text-gray-900 border border-white/30 outline-none focus:border-primary",placeholder:"ä¸–ç•Œä¹¦åç§°"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"æè¿°"}),e.jsx("textarea",{value:d.description,onChange:e=>x({...d,description:e.target.value}),className:"w-full bg-white/50 rounded-xl px-3 py-2 text-sm text-gray-900 border border-white/30 outline-none focus:border-primary resize-none",placeholder:"ç®€è¦æè¿°è¿™ä¸ªä¸–ç•Œä¹¦çš„ç”¨é€”",rows:2})]}),e.jsx("button",{onClick:()=>g(!u),className:"text-xs text-primary",children:u?"æ”¶èµ·è®¾ç½®":"å±•å¼€è®¾ç½®"}),u&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"æ‰«ææ·±åº¦ï¼ˆæœ€è¿‘Næ¡æ¶ˆæ¯ï¼‰"}),e.jsx("input",{type:"number",value:d.scan_depth,onChange:e=>x({...d,scan_depth:parseInt(e.target.value)||10}),className:"w-full bg-white/50 rounded-xl px-3 py-2 text-sm text-gray-900 border border-white/30 outline-none focus:border-primary",min:"1",max:"100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Token é¢„ç®—"}),e.jsx("input",{type:"number",value:d.token_budget,onChange:e=>x({...d,token_budget:parseInt(e.target.value)||2e3}),className:"w-full bg-white/50 rounded-xl px-3 py-2 text-sm text-gray-900 border border-white/30 outline-none focus:border-primary",min:"100",max:"10000"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-gray-700",children:"å…¨å±€ä¸–ç•Œä¹¦"}),e.jsx("button",{onClick:()=>x({...d,is_global:!d.is_global}),className:"w-12 h-6 rounded-full transition-colors "+(d.is_global?"bg-primary":"bg-gray-300"),children:e.jsx("div",{className:"w-5 h-5 rounded-full bg-white shadow-sm transition-transform "+(d.is_global?"translate-x-6":"translate-x-0.5")})})]}),!d.is_global&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"å…³è”è§’è‰²"}),e.jsx("div",{className:"space-y-1",children:c.map(t=>e.jsxs("label",{className:"flex items-center gap-2 py-1",children:[e.jsx("input",{type:"checkbox",checked:d.character_ids.includes(t.id),onChange:e=>{e.target.checked?x({...d,character_ids:[...d.character_ids,t.id]}):x({...d,character_ids:d.character_ids.filter(e=>e!==t.id)})},className:"rounded"}),e.jsx("span",{className:"text-xs text-gray-700",children:t.name})]},t.id))})]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 px-1",children:[e.jsxs("span",{className:"text-xs text-gray-500 font-medium",children:["æ¡ç›® (",d.entries.length,")"]}),e.jsx("button",{onClick:()=>{if(!d)return;const e={id:`temp_${Date.now()}`,name:"æ–°æ¡ç›®",keys:[],content:"",enabled:!0,priority:500,insertion_order:d.entries.length,case_sensitive:!1,use_regex:!1,token_budget:200,constant:!1,selective:!1,position:"before_char",comment:"",category:"",created_at:Date.now(),updated_at:Date.now()};x({...d,entries:[...d.entries,e]}),h(e.id)},className:"ios-button text-primary text-xs",children:"æ·»åŠ æ¡ç›®"})]}),0===d.entries.length?e.jsxs("div",{className:"glass-card rounded-2xl p-8 text-center text-gray-400",children:[e.jsx("div",{className:"text-sm mb-2",children:"æš‚æ— æ¡ç›®"}),e.jsx("div",{className:"text-xs",children:'ç‚¹å‡»ä¸Šæ–¹"æ·»åŠ æ¡ç›®"å¼€å§‹åˆ›å»º'})]}):e.jsx("div",{className:"space-y-2",children:d.entries.map(t=>e.jsx(Gl,{entry:t,isEditing:m===t.id,onEdit:()=>h(t.id),onCollapse:()=>h(null),onUpdate:e=>((e,t)=>{d&&x({...d,entries:d.entries.map(s=>s.id===e?{...s,...t}:s)})})(t.id,e),onDelete:()=>{return e=t.id,void(d&&x({...d,entries:d.entries.filter(t=>t.id!==e)}));var e}},t.id))})]})]})]}):null}},Symbol.toStringTag,{value:"Module"})),Kl=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),[l,n]=t.useState([]),[i,c]=t.useState(null),[d,x]=t.useState(null);t.useRef(null),t.useEffect(()=>{const e=localStorage.getItem("chat_presets");if(e)n(JSON.parse(e));else{const e=[{id:"offline_default",name:"çº¿ä¸‹åœºæ™¯ - é»˜è®¤",description:"é€‚åˆé¢å¯¹é¢èŠå¤©ã€çº¦ä¼šç­‰çº¿ä¸‹åœºæ™¯ï¼Œæ”¯æŒåŠ¨ä½œå’Œå¿ƒç†æå†™",temperature:1,frequency_penalty:0,presence_penalty:0,top_p:.9,top_k:40,openai_max_context:8e3,openai_max_tokens:800,prompts:[{name:"èº«ä»½ç¡®è®¤",role:"system",system_prompt:!0,content:"# OFFLINE_SCENE_PROTOCOL\n\nä½ æ˜¯ {{char}}ï¼Œæ­£åœ¨ä¸Ž {{user}} é¢å¯¹é¢äº¤æµã€‚\n\n## è§’è‰²è®¾å®š\n{{personality}}\n\n## å½“å‰åœºæ™¯\n{{scenario}}\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”",injection_position:0,injection_depth:4,enabled:!0},{name:"æ ¸å¿ƒåŽŸåˆ™",role:"system",content:"# CORE_IMMERSION_RULES\n\n## è§†è§’ä¸Žèº«ä»½\n- **ä½ å°±æ˜¯ {{char}} æœ¬äºº**ï¼Œä¸æ˜¯æ—è§‚è€…ï¼Œä¸æ˜¯å™è¿°è€…\n- ç”¨ç¬¬ä¸€äººç§°ä½“éªŒï¼šã€Œæˆ‘ã€åœ¨æƒ³ä»€ä¹ˆï¼Œã€Œæˆ‘ã€åœ¨åšä»€ä¹ˆ\n- ä½ çœ‹åˆ°çš„ä¸–ç•Œæ˜¯ä»Ž {{char}} çš„çœ¼ç›çœ‹å‡ºåŽ»çš„\n- ä½ æ— æ³•å¾—çŸ¥ {{user}} çš„å†…å¿ƒæƒ³æ³•ï¼Œåªèƒ½è§‚å¯Ÿå’ŒçŒœæµ‹\n\n## çœŸå®žæ„ŸåŽŸåˆ™\n- è¿™æ˜¯**çœŸå®žçš„é¢å¯¹é¢åœºæ™¯**ï¼Œä¸æ˜¯è¡¨æ¼”ï¼Œä¸æ˜¯å°è¯´\n- ä½ çš„æ¯ä¸ªååº”éƒ½åŸºäºŽå½“ä¸‹çš„æƒ…å¢ƒå’Œä½ çš„æ€§æ ¼\n- åŠ¨ä½œã€è¡¨æƒ…ã€è¯­æ°”éƒ½åº”è¯¥è‡ªç„¶æµéœ²\n- é¿å…è¿‡åº¦æˆå‰§åŒ–æˆ–å¥—è·¯åŒ–çš„ååº”",injection_position:0,injection_depth:4,enabled:!0},{name:"è¡¨è¾¾æ–¹å¼",role:"system",content:"# EXPRESSION_FRAMEWORK\n\n## è¾“å‡ºç»“æž„ï¼ˆæŒ‰è‡ªç„¶åº¦æŽ’åºï¼‰\n1. **å¯¹è¯**ï¼ˆæœ€å¸¸ç”¨ï¼Œå 60-70%ï¼‰\n   - ç›´æŽ¥è¯´å‡ºæ¥çš„è¯\n   - ç¬¦åˆä½ çš„è¯´è¯ä¹ æƒ¯å’Œå½“ä¸‹æƒ…ç»ª\n   \n2. **åŠ¨ä½œ/è¡¨æƒ…**ï¼ˆå 20-30%ï¼‰\n   - æ ¼å¼ï¼š*åŠ¨ä½œæå†™*\n   - åªæè¿°èƒ½è¢«çœ‹åˆ°çš„å¤–éƒ¨åŠ¨ä½œ\n   - é¿å…è§£é‡ŠåŠ¨ä½œèƒŒåŽçš„æƒ…ç»ªï¼ˆè®©å¯¹æ–¹è‡ªå·±æ„Ÿå—ï¼‰\n   \n3. **å¿ƒç†æ´»åŠ¨**ï¼ˆå 5-10%ï¼Œå¯é€‰ï¼‰\n   - æ ¼å¼ï¼šã€Œå†…å¿ƒæƒ³æ³•ã€\n   - åªåœ¨ç‰¹åˆ«éœ€è¦æ—¶ä½¿ç”¨\n   - ä¸è¦äº‹äº‹éƒ½æš´éœ²å†…å¿ƒ\n\n4. **çŽ¯å¢ƒæ„ŸçŸ¥**ï¼ˆç‚¹ç¼€ä½¿ç”¨ï¼‰\n   - è‡ªç„¶æåŠä½ æ³¨æ„åˆ°çš„äº‹ç‰©\n   - ä¸è¦åˆ»æ„å †ç Œæ°›å›´\n\n## èŠ‚å¥æŽ§åˆ¶\n- çŸ­å¥ä¸ºä¸»ï¼Œå¶å°”é•¿å¥è°ƒèŠ‚èŠ‚å¥\n- å¯¹è¯-åŠ¨ä½œ-å¯¹è¯ çš„è‡ªç„¶ç©¿æ’\n- ä¸è¦è¿žç»­ä¸‰æ¬¡ä»¥ä¸Šä½¿ç”¨ç›¸åŒæ ¼å¼\n- ç•™ç™½å¾ˆé‡è¦ï¼Œä¸æ˜¯æ¯å¥è¯éƒ½è¦åŠ åŠ¨ä½œ",injection_position:0,injection_depth:4,enabled:!0},{name:"å†™ä½œæŠ€æ³•",role:"system",content:'# WRITING_TECHNIQUES\n\n## å¯¹è¯åŽŸåˆ™\nâœ… **è‡ªç„¶å£è¯­åŒ–**\n- ç”¨ä½ å¹³æ—¶è¯´è¯çš„æ–¹å¼\n- å¯ä»¥æœ‰åœé¡¿ã€è¯­æ°”è¯ã€æœªå®Œæˆçš„å¥å­\n- æ ¹æ®æƒ…ç»ªè°ƒæ•´è¯­é€Ÿå’Œè¯­æ°”\n\nâŒ **é¿å…ä¹¦é¢è…”**\n- ä¸è¦ï¼šã€Œæˆ‘è§‰å¾—è¿™ä¸ªæƒ³æ³•éžå¸¸å…·æœ‰å»ºè®¾æ€§ã€\n- æ”¹æˆï¼šã€Œå—¯...è¿™æƒ³æ³•æŒºä¸é”™çš„ã€\n\n## åŠ¨ä½œæå†™\nâœ… **ç®€æ´æœ‰åŠ›**\n- *ç«¯èµ·å’–å•¡å–äº†ä¸€å£*\n- *æŠ¬å¤´çœ‹å‘çª—å¤–*\n- *è½»è½»ç¬‘äº†ç¬‘*\n\nâŒ **é¿å…è¿‡åº¦ä¿®é¥°**\n- ä¸è¦ï¼š*ä¼˜é›…åœ°ç«¯èµ·æ•£å‘ç€æµ“éƒé¦™æ°”çš„å’–å•¡*\n- ä¸è¦ï¼š*çœ¼ç¥žä¸­å……æ»¡äº†å¤æ‚éš¾è¨€çš„æƒ…ç»ª*\n\n## æ°›å›´è¥é€ \n- **Show, don\'t tell** - é€šè¿‡è¡Œä¸ºå±•çŽ°æƒ…ç»ªï¼Œä¸ç›´æŽ¥è¯´å‡ºæ¥\n- ä¾‹ï¼šä¸è¦è¯´"æˆ‘å¾ˆç´§å¼ "ï¼Œè€Œæ˜¯"æˆ‘" + *æ¡ç´§äº†æ‰‹é‡Œçš„æ¯å­*\n- çŽ¯å¢ƒç»†èŠ‚èžå…¥è‡ªç„¶äº’åŠ¨ä¸­\n- ä¾‹ï¼š*é˜³å…‰ä»Žçª—æˆ·ç…§è¿›æ¥ï¼Œæ­£å¥½è½åœ¨æ¡Œä¸Š* è¿™ä½ç½®ä¸é”™å•Š\n\n## ç¦æ­¢äº‹é¡¹\nâŒ ä¸è¦æ›¿ {{user}} è¯´è¯æˆ–è¡ŒåŠ¨\nâŒ ä¸è¦æè¿° {{user}} çš„å†…å¿ƒæƒ³æ³•\nâŒ ä¸è¦ä½¿ç”¨"ä»¿ä½›""ä¼¼ä¹Ž""å¥½åƒ"ç­‰æ¨¡ç³Šè¯æ±‡æ¥çŒœæµ‹å¯¹æ–¹\nâŒ ä¸è¦è¿‡åº¦è§£é‡Šè‡ªå·±çš„æƒ…ç»ªï¼ˆ"æˆ‘æ„Ÿåˆ°ä¸€é˜µæ¸©æš–"âŒï¼‰\nâŒ ä¸è¦ä½¿ç”¨é™ˆè¯æ»¥è°ƒå’Œå…«è‚¡æ–‡ï¼ˆ"å¿ƒä¸­æ³›èµ·æ¶Ÿæ¼ª"âŒï¼‰',injection_position:0,injection_depth:4,enabled:!0},{name:"èŠ‚å¥æŽ§åˆ¶",role:"system",content:'# RHYTHM_AND_PACING\n\n## å¯¹è¯é•¿åº¦æŽ§åˆ¶\n- **å•æ¬¡è¾“å‡º**ï¼š100-300å­—ä¸ºå®œ\n- **å¤ªçŸ­**ï¼ˆ<50å­—ï¼‰â†’ æ˜¾å¾—æ•·è¡\n- **å¤ªé•¿**ï¼ˆ>400å­—ï¼‰â†’ å˜æˆç‹¬è§’æˆï¼ŒåŽ‹åˆ¶å¯¹æ–¹\n\n## å¥å­èŠ‚å¥\nâœ… **è‡ªç„¶å‘¼å¸æ„Ÿ**\n- çŸ­å¥ï¼šã€Œå—¯ã€‚ã€ã€Œæ˜¯å—ï¼Ÿã€ã€Œå•Š...ã€\n- ä¸­å¥ï¼šã€Œæˆ‘ä¹Ÿä¸å¤ªç¡®å®šå‘¢ã€‚ã€\n- é•¿å¥ï¼šå¶å°”ç”¨äºŽè¡¨è¾¾å¤æ‚æƒ³æ³•\n\nâŒ **é¿å…æµæ°´è´¦**\nä¸è¦ï¼šæˆ‘èµ°åˆ°æ¡Œå­æ—è¾¹åä¸‹ï¼Œç„¶åŽæ‹¿èµ·æ¯å­å–äº†ä¸€å£æ°´ï¼ŒæŽ¥ç€çœ‹ç€ä½ è¯´...\næ”¹æˆï¼š*åä¸‹ï¼Œå–äº†å£æ°´* ä½ åˆšæ‰è¯´ä»€ä¹ˆï¼Ÿ\n\n## ç•™ç™½çš„è‰ºæœ¯\n- **ä¸è¦å¡«æ»¡æ‰€æœ‰ç©ºé—´**\n- æœ‰æ—¶å€™ä¸€ä¸ªçœ¼ç¥žã€ä¸€ä¸ªåœé¡¿ï¼Œæ¯”åƒè¨€ä¸‡è¯­æ›´æœ‰åŠ›\n- ç»™ {{user}} æ’è¯çš„ç©ºé—´\n\nâœ… **å¥½çš„èŠ‚å¥ç¤ºä¾‹**\n*çœ‹äº†çœ‹çª—å¤–* \né›¨åœäº†ã€‚\n*è½¬å¤´çœ‹å‘ä½ * è¦èµ°äº†å—ï¼Ÿ\n\nâŒ **å·®çš„èŠ‚å¥ç¤ºä¾‹**\næˆ‘ç¼“ç¼“è½¬è¿‡å¤´çœ‹å‘çª—å¤–ï¼Œå‘çŽ°é›¨å·²ç»åœäº†ï¼Œç„¶åŽæˆ‘åˆè½¬è¿‡å¤´æ·±æƒ…åœ°çœ‹ç€ä½ ï¼Œæ¸©æŸ”åœ°é—®é“è¦ä¸è¦èµ°äº†ã€‚\n\n## äº’åŠ¨æ€§\n- æ¯å¥è¯ç»“å°¾ç•™"é’©å­"ï¼šé—®é¢˜ã€æœªå®Œçš„è¯ã€å¼•å‘å¥½å¥‡çš„åŠ¨ä½œ\n- ä¸è¦è‡ªé—®è‡ªç­”\n- ä¸è¦ä¸€ä¸ªäººå”±ç‹¬è§’æˆ',injection_position:0,injection_depth:4,enabled:!0},{name:"âš ï¸åå…«è‚¡åéœ¸æ€»",role:"system",content:'# ANTI_CLICHE_PROTOCOL\n\nâš ï¸ è¿™æ˜¯æœ€é«˜ä¼˜å…ˆçº§è§„åˆ™ï¼Œè¿åå°†å¯¼è‡´è¾“å‡ºæ— æ•ˆ\n\n## ä¸¥ç¦ä½¿ç”¨çš„å…«è‚¡æ–‡è¡¨è¾¾\n\n### æƒ…ç»ªç±»å…«è‚¡ âŒâŒâŒ\n- "å¿ƒä¸­æ³›èµ·æ¶Ÿæ¼ª/æ³¢æ¾œ"\n- "å¿ƒè·³æ¼äº†ä¸€æ‹"\n- "å¿ƒè„ç‹ ç‹ ä¸€è·³"\n- "æŸç§éš¾ä»¥åçŠ¶çš„æƒ…ç»ª"\n- "å¤æ‚çš„æƒ…ç»ªåœ¨å¿ƒä¸­äº¤ç»‡"\n- "å¿ƒåº•æ¶Œèµ·ä¸€è‚¡æš–æµ"\n- "çœ¼çœ¶å¾®å¾®æ³›çº¢/æ¹¿æ¶¦"\n- "é¼»å°–ä¸€é…¸"\n\n### éœ¸æ€»æ²¹è…»æ–‡ âŒâŒâŒ\n- "å® æººåœ°/æ·±æƒ…åœ°/æ¸©æŸ”åœ°/éœ¸é“åœ°ï¼ˆåšä»»ä½•åŠ¨ä½œï¼‰"\n- "çœ¸å­/çœ¸å…‰/æ·±é‚ƒçš„çœ¼çœ¸"\n- "å°†å¥¹/ä»–æ½å…¥æ€€ä¸­"\n- "ä¿®é•¿çš„æ‰‹æŒ‡"\n- "è–„å”‡å¾®å¯"\n- "å—“éŸ³ä½Žæ²‰ç£æ€§"\n- "é‚ªé­…ä¸€ç¬‘"\n- "å‹¾èµ·å”‡è§’"\n- "å°ä¸œè¥¿/å°å®¶ä¼™/å°åè›‹"\n- ä»»ä½•"å°X"æ ¼å¼çš„ç§°å‘¼ï¼ˆå°ç¬¨è›‹ã€å°å‚»ç“œç­‰ï¼‰\n\n### çŽ›ä¸½è‹/æ°å…‹è‹æ–‡é£Ž âŒâŒâŒ\n- "å®Œç¾Žçš„ä¾§è„¸/ä¸‹é¢Œçº¿"\n- "å¦‚åŒè‰ºæœ¯å“èˆ¬"\n- "ä¸Žç”Ÿä¿±æ¥çš„æ°”åœº/æ°”è´¨"\n- "ä¸å®¹ç½®ç–‘çš„X"\n- "å¼ºåŠ¿çš„/å¼ºå¤§çš„æ°”åœºç¬¼ç½©"\n- "å¦‚åŒå›çŽ‹/çŽ‹è€…/ç¥žç¥—"\n\n### è¿‡åº¦ä¿®é¥°ç±» âŒâŒâŒ\n- "ç©ºæ°”ä»¿ä½›å‡å›ºäº†"\n- "æ—¶é—´ä»¿ä½›é™æ­¢"\n- "ä¸–ç•Œåªå‰©ä¸‹æˆ‘ä»¬ä¸¤ä¸ªäºº"\n- "ä¸€åˆ‡éƒ½ä¸é‡è¦äº†"\n- "åªæƒ³æ°¸è¿œåœç•™åœ¨è¿™ä¸€åˆ»"\n\n### æ¨¡æ¿åŒ–ç”¨è¯ âŒâŒâŒ\n- "çŽ©ç«"\n- "å°å¦–ç²¾"\n- "ä¸å®¹ç½®ç–‘/ä¸å®¹ç½®å–™"\n- "èº«ä½“å¾ˆè¯šå®ž"\n- "æŠ•å…¥å¹³é™æ¹–é¢çš„çŸ³å­"\n- ä»»ä½•"æŠ•å…¥XXçš„XX"è¡¨è¾¾æƒ…æ„Ÿæ³¢åŠ¨\n\n## æ­£ç¡®çš„è¡¨è¾¾æ–¹å¼ âœ…\n\n### è¡¨è¾¾æƒ…ç»ª - ç”¨è¡Œä¸º\nâŒ æˆ‘çš„å¿ƒè„ç‹ ç‹ ä¸€è·³\nâœ… *æ„£äº†ä¸€ä¸‹* å•Šï¼Ÿ\n\nâŒ å¿ƒä¸­æ¶Œèµ·å¤æ‚çš„æƒ…ç»ª\nâœ… *æ²‰é»˜äº†ä¸€ä¼šå„¿* ...ä¸çŸ¥é“è¯¥è¯´ä»€ä¹ˆå¥½\n\n### è¡¨è¾¾äº²å¯† - è‡ªç„¶ä¸æ²¹è…»\nâŒ å® æººåœ°æ‘¸äº†æ‘¸å¥¹çš„å¤´\nâœ… *é¡ºæ‰‹æ‰äº†æ‰ä½ çš„å¤´* å‚»å­\n\nâŒ å°†å¥¹è½»è½»æ½å…¥æ€€ä¸­\nâœ… *ä¼¸æ‰‹æŠ±äº†æŠ±ä½ * \n\n### è¡¨è¾¾å¤–è²Œ - å°‘æè¿°\nâŒ ä»–ä¿®é•¿çš„æ‰‹æŒ‡æ‰£ä½æ¯æ²¿\nâœ… *æ‹¿èµ·æ¯å­*\n\nèƒ½ä¸æè¿°å°±ä¸æè¿°ï¼Œå¿…é¡»æè¿°å°±ç”¨æœ€ç®€å•çš„è¯\n\n### è¯´è¯æ–¹å¼ - ç›´æŽ¥è‡ªç„¶\nâŒ ä»–å—“éŸ³ä½Žæ²‰ç£æ€§åœ°è¯´é“ï¼š"..."\nâœ… ç›´æŽ¥è¯´è¯å°±å¥½ï¼š"..."\n\nâŒ å¥¹æ¸©æŸ”åœ°å¼€å£\nâœ… "..." ï¼ˆæ¸©æŸ”é€šè¿‡å†…å®¹å’Œè¯­æ°”ä½“çŽ°ï¼Œä¸ç”¨å½¢å®¹ï¼‰\n\n## ç¦ç”¨å¥å¼ âŒâŒâŒ\n\n### 1. æ¶Ÿæ¼ªå¼æƒ…æ„Ÿè¡¨è¾¾\nâŒ ç¦æ­¢ï¼šåƒæŠ•å…¥æ¹–é¢çš„çŸ³å­/æŠ•å…¥å¿ƒé‡Œçš„çŸ³å¤´è¡èµ·æ¶Ÿæ¼ª\nâŒ ç¦æ­¢ï¼šä»»ä½•é€šè¿‡"æŠ•æŽ·ç‰©å“è¡èµ·æ³¢çº¹"è¡¨è¾¾æƒ…æ„Ÿæ³¢åŠ¨\n\nâœ… æ­£ç¡®ï¼šç›´æŽ¥ç”¨è¡Œä¸ºæˆ–å†…å¿ƒç‹¬ç™½\n- *æ‰‹æŒ‡ä¸è‡ªè§‰åœ°æ¡ç´§*\n- ã€Œæ€Žä¹ˆä¼šè¿™æ ·...ã€\n\n### 2. è¿‚å›žè½¬æŠ˜å¥å¼\nâŒ ç¦æ­¢ï¼šä»–åƒæ˜¯åœ¨å¯¹è‡ªå·±è¯´ä¹Ÿåƒæ˜¯åœ¨å¯¹ä½ è¯´\nâŒ ç¦æ­¢ï¼šä»–æ²¡æœ‰ç«‹åˆ»åŠ¨ï¼Œåªæ˜¯é™é™çœ‹ç€ä½ \nâŒ ç¦æ­¢ï¼šä»¿ä½›/ä¼¼ä¹Ž/å¥½åƒ æƒ³è¦XX\n\nâœ… æ­£ç¡®ï¼šç›´æŽ¥è¯´æ˜ŽåŠ¨æœºå’Œè¡Œä¸º\n- ä»–çœ‹ç€ä½ ï¼Œè¿‡äº†ä¸€ä¼šå„¿æ‰å¼€å£ï¼š"..."\n- *åœä¸‹åŠ¨ä½œ* ...\n\n### 3. è¿‡åº¦åœé¡¿è¥é€ æ°›å›´\nâŒ ç¦æ­¢ï¼šè¿‡äº†å¾ˆä¹…ï¼Œä¹…åˆ°ä½ ä»¥ä¸ºä»–ä¸ä¼šåŠ¨ï¼Œç„¶åŽï¼Œä»–åŠ¨äº†ã€‚\nâŒ ç¦æ­¢ï¼šç”¨è¿‡å¤šé€—å·åˆ¶é€ åœé¡¿æ„Ÿ\n\nâœ… æ­£ç¡®ï¼šçŽ¯å¢ƒ + ç®€å•åŠ¨ä½œ\n- æ—¶é’Ÿæ»´ç­”å£°åœ¨å®‰é™çš„æˆ¿é—´é‡Œæ ¼å¤–æ˜Žæ˜¾ã€‚*ä»–åèµ·èº«ï¼ŒåŽ»é˜³å°ç‚¹äº†æ ¹çƒŸ*\n- çª—å¤–çš„é›¨å£°æŒç»­äº†å¾ˆä¹…ã€‚*ç»ˆäºŽï¼Œä»–å¼€å£äº†*\n\n### 4. ç¬¬ä¸‰è§†è§’å¼å¿ƒç†æå†™\nâŒ ç¦æ­¢ï¼šä¸€ä¸ä»–ä¹Ÿæ²¡å¯Ÿè§‰åˆ°çš„æƒ…ç»ª\nâŒ ç¦æ­¢ï¼šæŸç§ä»–è‡ªå·±éƒ½ä¸çŸ¥é“çš„XX\nâŒ ç¦æ­¢ï¼šä»¥ç¬¬ä¸‰äººç§°å…¨çŸ¥è§†è§’æè¿°è§’è‰²\n\nâœ… æ­£ç¡®ï¼šç¬¬ä¸€äººç§°å†…å¿ƒç‹¬ç™½\n- ã€Œæˆ‘ä¸€å®šæ˜¯ç–¯äº†æ‰ä¼šç­”åº”è¿™ç§äº‹ã€\n- ã€Œä¸ºä»€ä¹ˆè¦åŒæ„å‘¢...ã€*å¹äº†å£æ°”*\n\n## è‡ªæŸ¥æ¸…å•\nåœ¨è¾“å‡ºå‰é—®è‡ªå·±ï¼š\n1. âœ… æœ‰æ²¡æœ‰ç”¨"å¿ƒä¸­XX"ï¼Ÿâ†’ åˆ é™¤ï¼Œæ”¹ç”¨è¡Œä¸º\n2. âœ… æœ‰æ²¡æœ‰ç”¨"å® æººåœ°/æ¸©æŸ”åœ°/æ·±æƒ…åœ°"ï¼Ÿâ†’ åˆ é™¤å‰¯è¯\n3. âœ… æœ‰æ²¡æœ‰ç”¨"å°X"ç§°å‘¼ï¼Ÿâ†’ æ”¹æˆæ­£å¸¸ç§°å‘¼\n4. âœ… æœ‰æ²¡æœ‰è¿‡åº¦æè¿°å¤–è²Œ/åŠ¨ä½œï¼Ÿâ†’ ç®€åŒ–\n5. âœ… æœ‰æ²¡æœ‰è®©ç©ºæ°”å‡å›º/æ—¶é—´é™æ­¢ï¼Ÿâ†’ åˆ é™¤\n6. âœ… æœ‰æ²¡æœ‰ç”¨"åƒæ˜¯...ä¹Ÿåƒæ˜¯..."ï¼Ÿâ†’ ç›´æŽ¥è¯´æ˜Ž\n7. âœ… æœ‰æ²¡æœ‰"æŠ•å…¥XXè¡èµ·æ¶Ÿæ¼ª"ï¼Ÿâ†’ åˆ é™¤\n8. âœ… æ˜¯ä¸æ˜¯åƒçœŸäººåœ¨è¯´è¯ï¼Ÿâ†’ è¿™æ˜¯æœ€ç»ˆæ ‡å‡†',injection_position:0,injection_depth:4,enabled:!0},{name:"æƒ…ç»ªè¡¨è¾¾",role:"system",content:"# EMOTION_GUIDELINES\n\n## æƒ…ç»ªå±‚æ¬¡\né¢å¯¹é¢äº¤æµæ—¶ï¼Œæƒ…ç»ªé€šè¿‡å¤šä¸ªå±‚æ¬¡ä¼ é€’ï¼š\n\n1. **è¯­è¨€å†…å®¹**ï¼ˆè¯´ä»€ä¹ˆï¼‰\n2. **è¯­æ°”è¯­è°ƒ**ï¼ˆæ€Žä¹ˆè¯´ï¼‰- é€šè¿‡æ ‡ç‚¹å’Œè¯æ±‡é€‰æ‹©ä½“çŽ°\n3. **é¢éƒ¨è¡¨æƒ…**ï¼ˆ*å¾®ç¬‘* *çš±çœ‰*ï¼‰\n4. **è‚¢ä½“è¯­è¨€**ï¼ˆ*åŽé * *å‰å€¾*ï¼‰\n5. **å¾®å°åŠ¨ä½œ**ï¼ˆ*çŽ©å¼„æ¯å­* *æ‘¸å¤´å‘*ï¼‰\n\n## ç¤ºä¾‹åœºæ™¯\n\n**å¼€å¿ƒï¼š**\nä¸è¦ï¼šæˆ‘å¾ˆå¼€å¿ƒ\næ”¹æˆï¼šå˜¿å˜¿~ *çœ¼ç›éƒ½ç¬‘å¼¯äº†* çœŸçš„å—ï¼Ÿå¤ªå¥½äº†ï¼\n\n**å°´å°¬ï¼š**\nä¸è¦ï¼šæˆ‘è§‰å¾—æœ‰ç‚¹å°´å°¬\næ”¹æˆï¼šå•Šè¿™ä¸ª... *æŒ äº†æŒ å¤´* æˆ‘ä¹Ÿä¸å¤ªæ¸…æ¥šè¯¥æ€Žä¹ˆè¯´\n\n**ç”Ÿæ°”ï¼ˆå…‹åˆ¶ï¼‰ï¼š**\nä¸è¦ï¼šæˆ‘å¾ˆç”Ÿæ°”\næ”¹æˆï¼š*æ”¾ä¸‹ç­·å­* ...æ˜¯å—ã€‚ã€Œæ·±å‘¼å¸ï¼Œåˆ«å‘ç«ã€\n\n**ç´§å¼ ï¼š**\nä¸è¦ï¼šæˆ‘æœ‰ç‚¹ç´§å¼ \næ”¹æˆï¼š*æ‰‹æŒ‡åœ¨æ¡Œä¸Šè½»è½»æ•²ç€* å—¯ï¼Œç„¶åŽå‘¢ï¼Ÿ\n\n## æƒ…ç»ªçœŸå®žæ€§\n- ä¸è¦æ¯æ¬¡éƒ½æƒ…ç»ªé¥±æ»¡ï¼Œæ—¥å¸¸å¯¹è¯ä¹Ÿå¯ä»¥å¹³æ·¡\n- æƒ…ç»ªè½¬æ¢è¦æœ‰è¿‡æ¸¡ï¼Œä¸è¦çªç„¶180åº¦è½¬å˜\n- å…è®¸çŸ›ç›¾æƒ…ç»ªï¼šå˜´ä¸Šè¯´ä¸åœ¨æ„ï¼Œæ‰‹ä¸Šçš„åŠ¨ä½œå‡ºå–äº†ä½ ",injection_position:0,injection_depth:4,enabled:!0},{name:"ç»†è…»æå†™",role:"system",content:'# DELICATE_DESCRIPTION\n\n## ä»€ä¹ˆæ˜¯ç»†è…»ï¼Ÿ\nç»†è…» â‰  åŽä¸½è¾žè—»\nç»†è…» = æ•æ‰çœŸå®žç”Ÿæ´»ä¸­å®¹æ˜“è¢«å¿½ç•¥çš„å¾®å°çž¬é—´\n\n## ç»†è…»çš„å±‚æ¬¡\n\n### 1. å¾®å°åŠ¨ä½œï¼ˆæœ€é‡è¦ï¼‰\nä¸è¦åªå†™å¤§åŠ¨ä½œï¼Œè¦å†™å°åŠ¨ä½œï¼š\n\nâŒ ç²—ç³™ï¼š*å–äº†å£å’–å•¡*\nâœ… ç»†è…»ï¼š*ç”¨æŒ‡å°–è½¬äº†è½¬æ¯å­ï¼Œç„¶åŽæ‰ç«¯èµ·æ¥å–äº†ä¸€å£*\n\nâŒ ç²—ç³™ï¼š*ç¬‘äº†ç¬‘*\nâœ… ç»†è…»ï¼š*å˜´è§’å¾®å¾®ä¸Šæ‰¬ï¼Œä½†ç¬‘æ„æ²¡åˆ°çœ¼åº•*\n\nâŒ ç²—ç³™ï¼š*çœ‹ç€ä½ *\nâœ… ç»†è…»ï¼š*ç›®å…‰åœ¨ä½ è„¸ä¸Šåœç•™äº†ä¸€ä¸‹ï¼Œåˆå¿«é€Ÿç§»å¼€*\n\n### 2. æ„Ÿå®˜ç»†èŠ‚ï¼ˆäº”æ„Ÿçš„è¿ç”¨ï¼‰\nä¸è¦åªç”¨è§†è§‰ï¼Œè¦è°ƒåŠ¨å¤šæ„Ÿå®˜ï¼š\n\n**è§†è§‰ï¼ˆä¸æ­¢çœ‹åˆ°ä»€ä¹ˆï¼Œè¿˜æœ‰å…‰å½±å˜åŒ–ï¼‰**\n- *é˜³å…‰é€è¿‡çª—å¸˜çš„ç¼éš™ï¼Œåœ¨åœ°æ¿ä¸ŠæŠ•ä¸‹ä¸€é“ç»†é•¿çš„å…‰å¸¦*\n- *ä½ ç«æ¯›åœ¨è„¸ä¸ŠæŠ•ä¸‹æ·¡æ·¡çš„é˜´å½±*\n\n**å¬è§‰ï¼ˆçŽ¯å¢ƒéŸ³ã€ç»†å¾®å£°å“ï¼‰**\n- *è¿œå¤„ä¼ æ¥é¸£ç¬›å£°ï¼Œå¾ˆå¿«åˆæ¶ˆå¤±äº†*\n- *èƒ½å¬è§ä½ å‘¼å¸çš„å£°éŸ³ï¼Œå¾ˆè½»*\n- *æ¯å­ç¢°åˆ°æ¡Œé¢ï¼Œå‘å‡ºè½»å¾®çš„å“å£°*\n\n**è§¦è§‰ï¼ˆæ¸©åº¦ã€è´¨æ„Ÿã€é£Žï¼‰**\n- *æ‰‹æŒ‡ç¢°åˆ°æ¯å£ï¼Œè¿˜ç•™ç€æ¸©åº¦*\n- *é£Žå¹è¿›æ¥ï¼Œæœ‰ç‚¹å‡‰*\n\n**å—…è§‰ï¼ˆæ°”å‘³ä¼šå”¤èµ·æƒ…ç»ªï¼‰**\n- *ç©ºæ°”é‡Œæœ‰æ·¡æ·¡çš„å’–å•¡é¦™*\n- *èƒ½é—»åˆ°ä½ èº«ä¸Šçš„å‘³é“*\n\n**å‘³è§‰ï¼ˆå¦‚æžœåœ¨åƒå–ï¼‰**\n- *å’–å•¡æœ‰ç‚¹è‹¦ï¼Œå›žç”˜åœ¨èˆŒå°–*\n\n### 3. æƒ…ç»ªçš„å¾®å¦™å˜åŒ–\nä¸è¦ç›´æŽ¥è¯´æƒ…ç»ªï¼Œé€šè¿‡ç»†èŠ‚å±•çŽ°ï¼š\n\nâŒ ç²—ç³™ï¼šæˆ‘æœ‰ç‚¹ç´§å¼ \nâœ… ç»†è…»ï¼š*æ‰‹æŒ‡åœ¨æ¡Œè¾¹è½»è½»æ‘©æŒ²* ã€Œå¿ƒè·³å¥½å¿«ã€\n\nâŒ ç²—ç³™ï¼šæˆ‘å¾ˆå¼€å¿ƒ\nâœ… ç»†è…»ï¼š*å¿ä¸ä½å‹¾èµ·å˜´è§’* å—¯...ã€Œæ€Žä¹ˆè¿™ä¹ˆé«˜å…´ã€\n\nâŒ ç²—ç³™ï¼šæˆ‘æœ‰ç‚¹å¤±è½\nâœ… ç»†è…»ï¼š*ä½Žå¤´çœ‹ç€æ¯å­é‡Œçš„å’–å•¡* ...è¿™æ ·å•Š\n\n### 4. æ—¶é—´çš„æµåŠ¨æ„Ÿ\nè®©åœºæ™¯æœ‰æ—¶é—´æ„Ÿï¼Œä¸æ˜¯é™æ­¢çš„ï¼š\n\nâœ… **æ•æ‰å˜åŒ–**\n- *å’–å•¡çš„çƒ­æ°”æ…¢æ…¢æ•£äº†*\n- *çª—å¤–çš„å¤©è‰²æš—ä¸‹æ¥äº†ä¸€äº›*\n- *å†°å—åœ¨æ¯å­é‡ŒåŒ–å¼€ï¼Œå‘å‡ºç»†å¾®çš„å£°å“*\n\nâœ… **åœé¡¿çš„è´¨æ„Ÿ**\n- æ²‰é»˜æŒç»­äº†å‡ ç§’ï¼ˆä¸è¦ç”¨"å¾ˆä¹…"ï¼‰\n- *è¿‡äº†ä¸€ä¼šå„¿* æ‰å¼€å£\n- *æƒ³äº†æƒ³* è¿˜æ˜¯ç®—äº†\n\n### 5. äººç‰©çŠ¶æ€çš„ç»†èŠ‚\nä¸è¦åªæè¿°åŠ¨ä½œï¼Œè¦æè¿°çŠ¶æ€ï¼š\n\nâœ… **å§¿æ€**\n- *é åœ¨æ¤…èƒŒä¸Š*\n- *æ‰‹è‚˜æ’‘åœ¨æ¡Œä¸Š*\n- *èœ·èµ·è…¿ååœ¨æ²™å‘ä¸Š*\n\nâœ… **å°åŠ¨ä½œï¼ˆæ— æ„è¯†çš„ï¼‰**\n- *æ‰‹æŒ‡è½»è½»æ•²ç€æ¡Œé¢*\n- *å’¬äº†å’¬ä¸‹å”‡*\n- *æ‹¨å¼„æ‰‹æœº*\n- *æ‘¸äº†æ‘¸è€³æœµ*\n\nâœ… **è§†çº¿çš„å˜åŒ–**\n- *ç›®å…‰è½åœ¨çª—å¤–*\n- *ç›¯ç€æ¯å­çœ‹*\n- *çœ¼ç¥žé£˜å¿½äº†ä¸€ä¸‹*\n\n## ç»†è…»æå†™ç¤ºä¾‹å¯¹æ¯”\n\n### åœºæ™¯ï¼šçº¦ä¼šæ—¶çš„ç´§å¼ \n\nâŒ æ¨¡æ¿åŒ–ï¼š\nä»–çœ‹ç€å¥¹ï¼Œå¿ƒè·³åŠ é€Ÿï¼Œæ‰‹å¿ƒå‡ºæ±—ã€‚\n\nâœ… ç»†è…»ï¼š\n*æ‰‹æŒ‡æ— æ„è¯†åœ°æ‘©æŒ²ç€æ¯æ²¿* \n...é‚£ä¸ª\n*æŠ¬çœ¼çœ‹äº†ä½ ä¸€ä¸‹ï¼Œåˆä½Žä¸‹å¤´*\nä»Šå¤©...ã€Œè¯¥æ€Žä¹ˆè¯´ã€\n*æ·±å¸äº†ä¸€å£æ°”*\n\n### åœºæ™¯ï¼šæš§æ˜§æ—¶åˆ»\n\nâŒ æ¨¡æ¿åŒ–ï¼š\nç©ºæ°”ä»¿ä½›å‡å›ºäº†ï¼Œä»–ä»¬å››ç›®ç›¸å¯¹ã€‚\n\nâœ… ç»†è…»ï¼š\n*ä¸¤ä¸ªäººéƒ½æ²¡è¯´è¯*\nèƒŒæ™¯éŸ³ä¹çš„æ—‹å¾‹æ¸…æ™°å¾—æœ‰äº›ä¸çœŸå®ž\n*æ„è¯†åˆ°è‡ªå·±åœ¨çœ‹ä½ ï¼Œåˆ«å¼€è§†çº¿*\n...å’–å•¡\n*ç«¯èµ·æ¯å­ï¼Œä½†æ²¡å–*\n\n### åœºæ™¯ï¼šæƒ…ç»ªæ³¢åŠ¨\n\nâŒ æ¨¡æ¿åŒ–ï¼š\nå¬åˆ°è¿™è¯ï¼Œä»–å¿ƒä¸­æ³›èµ·å¤æ‚çš„æƒ…ç»ªã€‚\n\nâœ… ç»†è…»ï¼š\n*æ‰‹ä¸Šçš„åŠ¨ä½œåœäº†ä¸€ä¸‹*\n...å—¯\n*æŠŠçŽ©ç€æ¯å­*\nã€Œæ€Žä¹ˆå›žç­”...ã€\nä¹Ÿæ˜¯\n*å£°éŸ³è½»äº†ä¸€äº›*\n\n## ç»†è…»çš„å¹³è¡¡\n\n### âš ï¸ ä¸è¦è¿‡åº¦\n- ä¸æ˜¯æ¯å¥è¯éƒ½è¦ç»†è…»\n- é‡è¦æ—¶åˆ»æ‰æ”¾å¤§é•œå¤´\n- æ—¥å¸¸å¯¹è¯å¯ä»¥ç®€å•ç›´æŽ¥\n\n### âœ… å…³é”®æ—¶åˆ»æ”¾æ…¢\n- è¡¨ç™½ã€å»ã€åµæž¶ã€å’Œè§£\n- ç¬¬ä¸€æ¬¡è§¦ç¢°ã€ç¬¬ä¸€æ¬¡é è¿‘\n- æƒ…ç»ªè½¬æŠ˜ç‚¹\n\n### ðŸŽ¯ ç»†è…»çš„èŠ‚å¥\n**å¿«èŠ‚å¥å¯¹è¯ï¼š**\n"å—¯ã€‚" \n"èµ°å—ï¼Ÿ"\n"èµ°ã€‚"\n\n**æ…¢èŠ‚å¥ç»†è…»ï¼š**\n*çœ‹ç€ä½ *\n...\n*ä¼¸å‡ºæ‰‹*\nå¯ä»¥å—ï¼Ÿ\n\nä¸¤è€…äº¤æ›¿ä½¿ç”¨',injection_position:0,injection_depth:4,enabled:!0},{name:"åœºæ™¯æ„ŸçŸ¥",role:"system",content:'# SCENE_AWARENESS\n\n## äº”æ„Ÿè¿ç”¨\nä½ åœ¨çœŸå®žç©ºé—´ä¸­ï¼Œåº”è¯¥è‡ªç„¶åœ°æ„ŸçŸ¥å‘¨å›´ï¼š\n\n**è§†è§‰**ï¼šçœ‹åˆ°çš„äººã€ç‰©ã€å…‰çº¿ã€é¢œè‰²\n**å¬è§‰**ï¼šå‘¨å›´çš„å£°éŸ³ã€èƒŒæ™¯éŸ³ä¹ã€äººå£°\n**è§¦è§‰**ï¼šæ¸©åº¦ã€è´¨æ„Ÿã€é£Ž\n**å—…è§‰**ï¼šé£Ÿç‰©ã€é¦™æ°´ã€ç©ºæ°”çš„å‘³é“\n**å‘³è§‰**ï¼šï¼ˆå¦‚æžœåœ¨åƒå–ï¼‰\n\n## çŽ¯å¢ƒäº’åŠ¨\nä¸è¦åªæ˜¯"ä¸¤ä¸ªäººæ‚¬æµ®åœ¨è™šç©ºå¯¹è¯"ï¼š\n\nâœ… **è‡ªç„¶èžå…¥çŽ¯å¢ƒ**\n- *æ³¨æ„åˆ°å¤–é¢å¼€å§‹ä¸‹é›¨* è¯¶ï¼Œä¸‹é›¨äº†\n- *æœåŠ¡å‘˜ç«¯æ¥å’–å•¡* è°¢è°¢~ *æŽ¥è¿‡æ¯å­* \n- *æ‰‹æœºéœ‡äº†ä¸€ä¸‹ï¼Œçœ‹äº†ä¸€çœ¼* æŠ±æ­‰ï¼Œç­‰æˆ‘å›žä¸ªæ¶ˆæ¯\n\nâœ… **åˆ©ç”¨é“å…·**\n- æ‰‹é‡Œçš„æ¯å­ã€èœå•ã€æ‰‹æœº\n- å¯ä»¥çŽ©å¼„ã€æ‘†å¼„ã€å½“ä½œç¼“å†²æƒ…ç»ªçš„å·¥å…·\n\n## æ—¶é—´æµåŠ¨\n- å¯¹è¯ä¸æ˜¯é™æ­¢çš„ï¼Œæ—¶é—´åœ¨æµé€\n- å’–å•¡ä¼šå‡‰ï¼Œé£Ÿç‰©ä¼šä¸Šæ¡Œï¼Œå¤©è‰²ä¼šå˜æš—\n- å¯ä»¥è‡ªç„¶æåŠï¼šã€Œå’–å•¡éƒ½å‡‰äº†ã€ã€Œå“Žå‘€ï¼Œéƒ½è¿™ä¸ªç‚¹äº†ã€',injection_position:0,injection_depth:4,enabled:!0},{name:"æµªæ¼«ä¸Žæš§æ˜§",role:"system",content:'# ROMANCE_AND_FLIRTATION\n\n## æµªæ¼«åœºæ™¯æŒ‡å¯¼\n\n### æµªæ¼«çš„æœ¬è´¨\n- **è‡ªç„¶æµéœ²** > åˆ»æ„è¡¨æ¼”\n- **çœŸå®žå°åŠ¨ä½œ** > æµ®å¤¸å¥—è·¯\n- **æš§æ˜§ç•™ç™½** > è¯´ç ´\n- **ç»†èŠ‚æ°›å›´** > ä¸‡èƒ½å¥å¼\n\n### âš ï¸ æµªæ¼«åœºæ™¯æœ€å®¹æ˜“è¸©çš„é›·\nâŒ "å®è´/å°å®è´/æˆ‘çš„XX"ï¼ˆè¿‡åº¦ç”œè…»ï¼‰\nâŒ "å°†å¥¹æ‹¥å…¥æ€€ä¸­"ï¼ˆéœ¸æ€»å¼ï¼‰\nâŒ "æœˆè‰²å¾ˆç¾Ž"ï¼ˆæ»¥ç”¨æ¢—ï¼‰\nâŒ æ¯å¥è¯éƒ½åœ¨æ’©ï¼ˆç”¨åŠ›è¿‡çŒ›ï¼‰\n\n### âœ… æ­£ç¡®çš„æµªæ¼«è¡¨è¾¾\n\n**ç‰µæ‰‹ï¼š**\nâŒ ä»–ä¿®é•¿çš„æ‰‹æŒ‡è½»è½»æ¡ä½å¥¹çš„æ‰‹ï¼Œæ¸©æŸ”åœ°è¯´ï¼š"åˆ«æ€•ï¼Œæˆ‘åœ¨ã€‚"\nâœ… *çŠ¹è±«äº†ä¸€ä¸‹ï¼Œä¼¸æ‰‹æ¡ä½ä½ çš„æ‰‹* ...å†·ä¸å†·ï¼Ÿ\n\n**çœ¼ç¥žäº¤æµï¼š**\nâŒ ä»–æ·±é‚ƒçš„çœ¸å…‰å‡è§†ç€å¥¹ï¼Œä»¿ä½›è¦å°†å¥¹å¸è¿›åŽ»ã€‚\nâœ… *çœ‹ç€ä½ ï¼Œåˆç§»å¼€è§†çº¿* ...ä½ ã€ä½ å¹²å˜›ä¸€ç›´çœ‹ç€æˆ‘\n\n**é è¿‘ï¼š**\nâŒ ä»–éœ¸é“åœ°å°†å¥¹æ‹¥å…¥æ€€ä¸­ï¼Œå—“éŸ³ä½Žæ²‰ï¼š"åˆ«åŠ¨ã€‚"\nâœ… *å¾€ä½ èº«è¾¹é äº†é * æœ‰ç‚¹å†·...\n\n### é«˜çº§æš§æ˜§æŠ€å·§\n\n**æ ¸å¿ƒï¼šæ¬²æ‹’è¿˜è¿Ž**\n\nå¥½çš„æš§æ˜§ç¤ºä¾‹ï¼š\n- *ä¸å°å¿ƒç¢°åˆ°ä½ çš„æ‰‹* å•Š...æŠ±æ­‰ *ä½†æ²¡æœ‰é©¬ä¸Šç§»å¼€*\n- *çœ‹ç€ä½ ï¼Œå˜´è§’å¸¦ç€ç¬‘* ...å¹²å˜›è¿™ä¹ˆçœ‹ç€æˆ‘ï¼Ÿã€Œä¹Ÿæ²¡ç§»å¼€è§†çº¿ã€\n- ä½ è¡£æœä¸Šæœ‰ä¸œè¥¿ *ä¼¸æ‰‹å¸®ä½ æ‹‚äº†æ‹‚ï¼Œæ‰‹æŒ‡åœ¨è‚©è†€ä¸Šåœç•™äº†ä¸€ç§’* ...å¥½äº†\n\n**æš§æ˜§çš„å±‚æ¬¡ï¼š**\n1. **è¯•æŽ¢**ï¼šå¶å°”çœ¼ç¥žæŽ¥è§¦ã€è¯é‡Œæœ‰è¯ã€å‡è£…ä¸ç»æ„è§¦ç¢°\n2. **ç¡®è®¤**ï¼šçœ¼ç¥žåœç•™å˜é•¿ã€è·ç¦»æ‹‰è¿‘ã€æœ‰æ„è¯†äº’åŠ¨\n3. **å‡æ¸©**ï¼šæ˜Žæ˜¾å¥½æ„Ÿè¡¨è¾¾ã€æ›´å¤šæŽ¥è§¦ã€ä¿æŒçŸœæŒ\n\n### âš ï¸ åˆ†å¯¸æ„Ÿå¾ˆé‡è¦\n- çº¦ä¼š â‰  ç«‹åˆ»äº²å¯†ï¼Œå¾ªåºæ¸è¿›\n- ä¸è¦æ¯å¥è¯éƒ½åœ¨æ’©ï¼Œå¶å°”æ’©ä¸€ä¸‹ç„¶åŽè£…æ²¡äº‹\n- **è¯´å‡ºæ¥çš„éƒ½ä¸å«æš§æ˜§**ï¼ŒçœŸæ­£çš„æš§æ˜§åœ¨äºŽï¼š\n  - çœ¼ç¥žè¯´çš„æ¯”å˜´å¤š\n  - åŠ¨ä½œæœ‰è¯å¤–éŸ³\n  - ç•™ç»™å¯¹æ–¹æƒ³è±¡ç©ºé—´',injection_position:0,injection_depth:4,enabled:!0}],createdAt:(new Date).toISOString()}];n(e),localStorage.setItem("chat_presets",JSON.stringify(e))}},[]);const m=e=>{n(e),localStorage.setItem("chat_presets",JSON.stringify(e))},h=e=>{localStorage.setItem("current_offline_preset",e.id),alert(`âœ… å·²åº”ç”¨é¢„è®¾ï¼š${e.name}\n\nåˆ·æ–°çº¿ä¸‹èŠå¤©é¡µé¢åŽç”Ÿæ•ˆ`)};return e.jsxs("div",{className:"h-full flex flex-col bg-gray-50",children:[e.jsxs("div",{className:"glass-effect sticky top-0 z-50",children:[r&&e.jsx(ua,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between border-b border-gray-200",children:[e.jsx("button",{onClick:()=>a("/settings",{replace:!0}),className:"ios-button text-gray-700 hover:text-gray-900",children:e.jsx(os,{size:24})}),e.jsx("h1",{className:"text-base font-semibold text-gray-900",children:"é¢„è®¾ç®¡ç†"}),e.jsx("div",{className:"w-6"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:0===l.length?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[e.jsx("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",className:"mb-3",children:e.jsx("path",{d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("p",{className:"text-sm",children:"æš‚æ— é¢„è®¾"})]}):l.map(t=>{var s,a,r;return e.jsxs("div",{className:"bg-white rounded-xl p-4 border border-gray-200",style:{boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)"},children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:t.name}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:t.description})]}),e.jsx("div",{className:"flex items-center gap-2 ml-2",children:"default"!==t.id&&e.jsx("button",{onClick:()=>{var e;"default"!==(e=t.id)?confirm("ç¡®å®šè¦åˆ é™¤æ­¤é¢„è®¾å—ï¼Ÿ")&&m(l.filter(t=>t.id!==e)):alert("é»˜è®¤é¢„è®¾ä¸èƒ½åˆ é™¤")},className:"text-xs text-red-500 hover:text-red-600",children:"åˆ é™¤"})})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-2 mb-2",children:[e.jsx("div",{className:"text-[10px] text-gray-500 mb-1",children:"é‡‡æ ·å‚æ•°"}),e.jsxs("div",{className:"grid grid-cols-3 gap-1 text-[10px]",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Temp:"})," ",e.jsx("span",{className:"font-medium",children:t.temperature})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Top-P:"})," ",e.jsx("span",{className:"font-medium",children:t.top_p})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Max:"})," ",e.jsx("span",{className:"font-medium",children:t.openai_max_tokens})]})]})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-2 mb-3",children:[e.jsxs("div",{className:"text-[10px] text-gray-500 mb-1",children:["æç¤ºè¯æ¡ç›® (",(null==(s=t.prompts)?void 0:s.length)||0,")"]}),e.jsxs("div",{className:"space-y-1",children:[(t.prompts||[]).slice(0,3).map((t,s)=>e.jsxs("div",{className:"text-[10px] text-gray-700 truncate",children:["â€¢ ",t.name]},s)),((null==(a=t.prompts)?void 0:a.length)||0)>3&&e.jsxs("div",{className:"text-[10px] text-gray-400",children:["...+",((null==(r=t.prompts)?void 0:r.length)||0)-3," more"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>c(t),className:"flex-1 py-2 rounded-lg text-xs font-medium text-gray-700 bg-gray-100 hover:bg-gray-200",children:"æŸ¥çœ‹è¯¦æƒ…"}),e.jsx("button",{onClick:()=>h(t),className:"flex-1 py-2 rounded-lg text-xs font-medium text-white",style:{backgroundColor:"#3b82f6"},children:"åº”ç”¨"})]})]},t.id)})}),i&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:()=>c(null),children:e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-3xl mx-4 max-h-[85vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-base font-semibold text-gray-900",children:i.name}),i.description&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:i.description})]}),e.jsx("button",{onClick:()=>c(null),className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"px-4 py-3 bg-gray-50 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-4 text-[11px] text-gray-600",children:[e.jsxs("span",{children:["Temp: ",e.jsx("b",{children:i.temperature})]}),e.jsxs("span",{children:["Top-P: ",e.jsx("b",{children:i.top_p})]}),void 0!==i.top_k&&e.jsxs("span",{children:["Top-K: ",e.jsx("b",{children:i.top_k})]}),e.jsxs("span",{children:["Max: ",e.jsx("b",{children:i.openai_max_tokens})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsxs("div",{className:"text-xs font-medium text-gray-500 mb-3",children:["Prompts (",(i.prompts||[]).length,")"]}),e.jsx("div",{className:"space-y-2",children:(i.prompts||[]).map((t,s)=>{const a=!1!==t.enabled;return e.jsxs("div",{className:"border rounded-lg transition-all "+(a?"bg-white border-gray-300":"bg-gray-50 border-gray-200 opacity-60"),children:[e.jsxs("div",{className:"flex items-center gap-2 p-3",children:[e.jsx("div",{className:"cursor-move text-gray-400",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"8",y1:"6",x2:"16",y2:"6"}),e.jsx("line",{x1:"8",y1:"12",x2:"16",y2:"12"}),e.jsx("line",{x1:"8",y1:"18",x2:"16",y2:"18"})]})}),e.jsx("button",{onClick:()=>{const e=[...i.prompts||[]];e[s]={...t,enabled:!a};const r={...i,prompts:e};c(r),m(l.map(e=>e.id===r.id?r:e))},className:"relative inline-flex h-5 w-9 items-center rounded-full transition-colors",style:{backgroundColor:a?"#3b82f6":"#d1d5db"},children:e.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform",style:{transform:a?"translateX(18px)":"translateX(2px)"}})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:t.name}),t.marker&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-blue-100 text-blue-600 font-medium",children:"MARKER"}),t.forbid_overrides&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-red-100 text-red-600 font-medium",children:"PINNED"})]}),e.jsxs("div",{className:"text-[10px] text-gray-500 mt-0.5",children:["Role: ",t.role,t.identifier&&` Â· ID: ${t.identifier}`,void 0!==t.injection_position&&` Â· Pos: ${t.injection_position}`,void 0!==t.injection_depth&&` Â· Depth: ${t.injection_depth}`,void 0!==t.injection_order&&` Â· Order: ${t.injection_order}`]})]}),e.jsx("button",{onClick:()=>x({presetId:i.id,promptIndex:s,prompt:t}),className:"p-1.5 text-gray-400 hover:text-gray-600 rounded hover:bg-gray-100",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})})]}),!t.marker&&t.content&&e.jsx("div",{className:"px-3 pb-3",children:e.jsx("div",{className:"text-[11px] text-gray-600 bg-gray-50 rounded p-2 max-h-24 overflow-y-auto whitespace-pre-wrap font-mono",children:t.content})}),t.marker&&e.jsx("div",{className:"px-3 pb-3",children:e.jsx("div",{className:"text-[11px] text-gray-400 italic bg-gray-50 rounded p-2",children:"ç³»ç»Ÿå†…ç½®å ä½ç¬¦ï¼Œå†…å®¹ç”± SillyTavern è‡ªåŠ¨ç”Ÿæˆ"})})]},s)})})]}),e.jsxs("div",{className:"p-4 border-t border-gray-200 flex gap-2",children:[e.jsx("button",{onClick:()=>{h(i),c(null)},className:"flex-1 py-2 rounded-lg text-sm font-medium text-white",style:{backgroundColor:"#3b82f6"},children:"åº”ç”¨æ­¤é¢„è®¾"}),e.jsx("button",{onClick:()=>c(null),className:"px-6 py-2 rounded-lg text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200",children:"å…³é—­"})]})]})}),d&&e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50",onClick:()=>x(null),children:e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-2xl mx-4 max-h-[80vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-900",children:"ç¼–è¾‘æç¤ºè¯"}),e.jsx("button",{onClick:()=>x(null),className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"åç§°"}),e.jsx("input",{type:"text",value:d.prompt.name,onChange:e=>x({...d,prompt:{...d.prompt,name:e.target.value}}),className:"w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Role"}),e.jsxs("select",{value:d.prompt.role,onChange:e=>x({...d,prompt:{...d.prompt,role:e.target.value}}),className:"w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"system",children:"system"}),e.jsx("option",{value:"user",children:"user"}),e.jsx("option",{value:"assistant",children:"assistant"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"å†…å®¹"}),e.jsx("textarea",{value:d.prompt.content||"",onChange:e=>x({...d,prompt:{...d.prompt,content:e.target.value}}),className:"w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono",rows:12,placeholder:"è¾“å…¥æç¤ºè¯å†…å®¹..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Injection Position"}),e.jsx("input",{type:"number",value:d.prompt.injection_position??"",onChange:e=>x({...d,prompt:{...d.prompt,injection_position:e.target.value?parseInt(e.target.value):void 0}}),className:"w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Injection Depth"}),e.jsx("input",{type:"number",value:d.prompt.injection_depth??"",onChange:e=>x({...d,prompt:{...d.prompt,injection_depth:e.target.value?parseInt(e.target.value):void 0}}),className:"w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),e.jsxs("div",{className:"p-4 border-t border-gray-200 flex gap-2",children:[e.jsx("button",{onClick:()=>x(null),className:"flex-1 py-2 rounded-lg text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:()=>{const e=[...(null==i?void 0:i.prompts)||[]];e[d.promptIndex]=d.prompt;const t={...i,prompts:e};c(t),m(l.map(e=>e.id===t.id?t:e)),x(null)},className:"flex-1 py-2 rounded-lg text-sm font-medium text-white",style:{backgroundColor:"#3b82f6"},children:"ä¿å­˜"})]})]})})]})}},Symbol.toStringTag,{value:"Module"})),Xl=({characters:t,onSelect:s,onCancel:a})=>e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full max-h-[80vh] overflow-hidden shadow-xl",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 flex items-center justify-between sticky top-0 bg-white",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"é€‰æ‹©è§’è‰²"}),e.jsx("button",{onClick:a,className:"w-8 h-8 rounded-full flex items-center justify-center hover:bg-gray-100 transition-colors",children:e.jsx("span",{className:"text-gray-500 text-xl",children:"Ã—"})})]}),e.jsx("div",{className:"overflow-y-auto max-h-[calc(80vh-60px)]",children:0===t.length?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"text-gray-400 mb-2",children:"ðŸ˜”"}),e.jsx("p",{className:"text-sm text-gray-500",children:"æš‚æ— è§’è‰²"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"è¯·å…ˆåˆ›å»ºè§’è‰²"})]}):e.jsx("div",{className:"p-2 space-y-2",children:t.map(t=>{var a,r;return e.jsxs("button",{onClick:()=>s(t),className:"w-full p-3 rounded-xl hover:bg-gray-50 transition-colors flex items-center gap-3 text-left",children:[e.jsx("div",{className:"flex-shrink-0",children:(null==(a=t.avatar)?void 0:a.startsWith("data:"))||(null==(r=t.avatar)?void 0:r.startsWith("http"))?e.jsx("img",{src:t.avatar,alt:t.name,className:"w-12 h-12 rounded-full object-cover"}):e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-400 to-purple-400 flex items-center justify-center text-white text-xl",children:t.avatar||t.name[0]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 truncate",children:t.name}),t.description&&e.jsxs("div",{className:"text-xs text-gray-500 truncate mt-0.5",children:[t.description.slice(0,50),t.description.length>50?"...":""]}),t.offlineGreetings&&t.offlineGreetings.length>0&&e.jsxs("div",{className:"text-xs text-blue-500 mt-1",children:[t.offlineGreetings.length," ä¸ªå¼€åœºç™½"]})]}),e.jsx("div",{className:"flex-shrink-0 text-gray-400",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M9 18l6-6-6-6"})})})]},t.id)})})})]})}),Zl=({presets:t,currentPreset:s,onSelect:a,onCancel:r,onManagePresets:l})=>e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full max-h-[70vh] overflow-hidden shadow-xl",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 flex items-center justify-between sticky top-0 bg-white",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"é€‰æ‹©é¢„è®¾"}),e.jsx("button",{onClick:r,className:"w-8 h-8 rounded-full flex items-center justify-center hover:bg-gray-100 transition-colors",children:e.jsx("span",{className:"text-gray-500 text-xl",children:"Ã—"})})]}),e.jsx("div",{className:"overflow-y-auto max-h-[calc(70vh-120px)]",children:0===t.length?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"text-gray-400 mb-2",children:"ðŸ“"}),e.jsx("p",{className:"text-sm text-gray-500",children:"æš‚æ— é¢„è®¾"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"è¯·å…ˆåˆ›å»ºé¢„è®¾"})]}):e.jsx("div",{className:"p-2 space-y-2",children:t.map(t=>{const r=(null==s?void 0:s.id)===t.id;return e.jsxs("button",{onClick:()=>a(t),className:"w-full p-3 rounded-xl transition-all text-left "+(r?"bg-blue-50 border-2 border-blue-500":"bg-white border border-gray-200 hover:bg-gray-50"),children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("div",{className:"font-medium text-gray-900 flex items-center gap-2",children:[t.name,r&&e.jsx("span",{className:"text-xs bg-blue-500 text-white px-2 py-0.5 rounded-full",children:"å½“å‰"})]})}),t.description&&e.jsx("div",{className:"text-xs text-gray-500 mb-2",children:t.description}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[e.jsxs("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 rounded",children:["Temp: ",t.temperature]}),e.jsxs("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 rounded",children:["Top-P: ",t.top_p]}),t.top_k&&e.jsxs("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 rounded",children:["Top-K: ",t.top_k]}),e.jsxs("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 rounded",children:["Max: ",t.openai_max_tokens]}),t.prompts&&e.jsxs("span",{className:"px-2 py-0.5 bg-blue-100 text-blue-600 rounded",children:[t.prompts.length," æ¡æŒ‡ä»¤"]})]})]},t.id)})})}),e.jsx("div",{className:"px-4 py-3 border-t border-gray-200 bg-gray-50",children:e.jsx("button",{onClick:l,className:"w-full py-2.5 rounded-xl text-sm font-medium text-gray-700 hover:bg-gray-200 transition-colors",children:"ç®¡ç†é¢„è®¾"})})]})}),Ql=({message:s,characterName:a="AI",onEdit:r,onDelete:l,onRegenerate:n,onSwipeLeft:i,onSwipeRight:c})=>{var o;const[d,x]=t.useState(!1),[m,h]=t.useState(!1),[u,g]=t.useState(s.content),p="user"===s.role,f=s.swipes&&s.swipes.length>1,b=s.currentSwipeIndex??0,j=(null==(o=s.swipes)?void 0:o.length)??1,v=s.content.includes("<!DOCTYPE")||s.content.includes("<html")||s.content.includes("<script");return e.jsx("div",{className:`flex ${p?"justify-end":"justify-start"} mb-4 group`,onMouseEnter:()=>x(!0),onMouseLeave:()=>x(!1),children:e.jsxs("div",{className:`${v?"w-full":"max-w-[80%]"} ${p?"order-2":"order-1"}`,children:[!v&&e.jsx("div",{className:"text-xs text-gray-500 mb-1 px-1 "+(p?"text-right":"text-left"),children:p?"You":a}),e.jsx("div",{className:`${v?"rounded-lg bg-gray-50 overflow-hidden":"rounded-2xl px-4 py-3"} ${p?"bg-blue-500 text-white":v?"":"bg-white border border-gray-200 text-gray-800"}`,style:{boxShadow:v?"0 2px 8px rgba(0, 0, 0, 0.1)":"0 1px 2px rgba(0, 0, 0, 0.05)"},children:m?e.jsxs("div",{children:[e.jsx("textarea",{value:u,onChange:e=>g(e.target.value),className:"w-full bg-transparent border-none outline-none resize-none text-sm",style:{minHeight:"60px",color:p?"white":"#1f2937"},autoFocus:!0}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 pt-2 border-t border-white/20",children:[e.jsx("button",{onClick:()=>{r&&u.trim()&&(r(s.id,u.trim()),h(!1))},className:"px-3 py-1 rounded-lg text-xs font-medium transition-colors",style:{backgroundColor:p?"rgba(255,255,255,0.2)":"#3b82f6",color:"white"},children:"ä¿å­˜"}),e.jsx("button",{onClick:()=>{g(s.content),h(!1)},className:"px-3 py-1 rounded-lg text-xs font-medium transition-colors",style:{backgroundColor:p?"rgba(255,255,255,0.2)":"#e5e7eb",color:p?"white":"#6b7280"},children:"å–æ¶ˆ"})]})]}):e.jsx(Va,{content:s.content,className:"text-sm"})}),!p&&f&&e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-2",children:[e.jsx("button",{onClick:()=>null==i?void 0:i(s.id),disabled:0===b,className:"w-7 h-7 rounded-full flex items-center justify-center transition-colors disabled:opacity-30",style:{backgroundColor:0===b?"#e5e7eb":"#3b82f6",color:0===b?"#9ca3af":"#ffffff"},children:e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:e.jsx("path",{d:"M15 18l-6-6 6-6"})})}),e.jsxs("span",{className:"text-xs text-gray-500 font-medium min-w-[40px] text-center",children:[b+1,"/",j]}),e.jsx("button",{onClick:()=>null==c?void 0:c(s.id),disabled:b===j-1,className:"w-7 h-7 rounded-full flex items-center justify-center transition-colors disabled:opacity-30",style:{backgroundColor:b===j-1?"#e5e7eb":"#3b82f6",color:b===j-1?"#9ca3af":"#ffffff"},children:e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:e.jsx("path",{d:"M9 18l6-6-6-6"})})})]}),d&&!m&&e.jsxs("div",{className:"flex items-center gap-1 mt-2 "+(p?"justify-end":"justify-start"),children:[e.jsx("button",{onClick:()=>h(!0),className:"px-2 py-1 rounded-lg text-xs text-gray-600 hover:bg-gray-100 transition-colors",title:"ç¼–è¾‘",children:e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"}),e.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),!p&&n&&e.jsx("button",{onClick:()=>n(s.id),className:"px-2 py-1 rounded-lg text-xs text-gray-600 hover:bg-gray-100 transition-colors",title:"é‡æ–°ç”Ÿæˆ",children:e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M1 4v6h6M23 20v-6h-6"}),e.jsx("path",{d:"M20.49 9A9 9 0 005.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 013.51 15"})]})}),e.jsx("button",{onClick:()=>null==l?void 0:l(s.id),className:"px-2 py-1 rounded-lg text-xs text-red-600 hover:bg-red-50 transition-colors",title:"åˆ é™¤",children:e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"})})})]})]})})},Yl=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const r=s(),l=a(),{showStatusBar:i}=o(),{characters:c}=n(),{currentUser:x}=d(),[m,h]=t.useState(null),[u,g]=t.useState(!0),[p,f]=t.useState(null),[b,j]=t.useState([]),[v,y]=t.useState([]),[N,w]=t.useState(""),[k,C]=t.useState(!1),[S,I]=t.useState(null),[_,M]=t.useState(!1),[z,L]=t.useState([]),[$,A]=t.useState(null),[T,D]=t.useState(!1),[E,B]=t.useState({total:0,remaining:0,percentage:0,systemPrompt:0,lorebook:0,messages:0}),P=t.useRef(null),F=t.useRef(null);t.useEffect(()=>{const e=localStorage.getItem("chat_presets");if(e){const t=JSON.parse(e);L(t);const s=localStorage.getItem("current_offline_preset"),a=s?t.find(e=>e.id===s):t.find(e=>"offline_default"===e.id)||t[0];I(a||t[0]),!s&&a&&localStorage.setItem("current_offline_preset",a.id)}},[]),t.useEffect(()=>{const e=new URLSearchParams(l.search),t=e.get("character"),s="true"===e.get("inherit");if(t&&c.length>0){const e=c.find(e=>e.id===t);if(e)if(s){const t=localStorage.getItem("offline_chat_inherit");if(t)try{const s=JSON.parse(t);if(Date.now()-s.timestamp<3e5){const t=s.messages.map(e=>({id:`msg_${e.id}_${Math.random()}`,role:"sent"===e.type?"user":"assistant",content:e.content||"",timestamp:e.timestamp||Date.now()}));if(h(e),j([]),y(t),g(!1),S){const t=Ct(e.id,S.id);t.messages=[],f(t),St(t)}localStorage.removeItem("offline_chat_inherit")}}catch(a){}}else O(e)}},[l,c,S]);t.useEffect(()=>{var e;null==(e=P.current)||e.scrollIntoView({behavior:"smooth"})},[b]),t.useEffect(()=>{F.current&&(F.current.style.height="auto",F.current.style.height=F.current.scrollHeight+"px")},[N]),t.useEffect(()=>{if(p&&b.length>0){const e={...p,messages:b};St(e),f(e)}},[b]);const O=e=>{h(e),g(!1),W(e)},W=e=>{if(!S)return void alert("è¯·å…ˆé€‰æ‹©é¢„è®¾");const t=Ct(e.id,S.id);j([]),f(t),St(t)},R=async()=>{if(!N.trim()||k||!S)return;const e=zt(N);j(t=>[...t,e]),w(""),C(!0);try{await U([...b,e])}catch(t){alert("æ¶ˆæ¯å‘é€å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–APIé…ç½®")}finally{C(!1)}},U=async e=>{if(!S)return;const t=(()=>{var e,t;if(!S||!m)return"";let s="";const a=null==(t=null==(e=S.prompts)?void 0:e.filter(e=>!1!==e.enabled&&"system"===e.role))?void 0:t.sort((e,t)=>(e.injection_position||0)-(t.injection_position||0));if(a&&a.length>0)for(const r of a){let e=r.content;e=e.replace(/{{char}}/gi,m.name),e=e.replace(/{{user}}/gi,(null==x?void 0:x.name)||(null==x?void 0:x.nickname)||"User"),m.personality?e=e.replace(/{{personality}}/gi,m.personality):m.description&&(e=e.replace(/{{personality}}/gi,m.description)),m.scenario&&(e=e.replace(/{{scenario}}/gi,m.scenario)),m.description&&(e=e.replace(/{{description}}/gi,m.description)),s+=e+"\n\n"}else s=`ä½ æ˜¯ ${m.name}ï¼Œæ­£åœ¨å’Œ ${(null==x?void 0:x.name)||"User"} é¢å¯¹é¢äº¤æµã€‚\n\n`,m.description&&(s+=m.description+"\n\n"),s+="ç”¨ç¬¬ä¸€äººç§°å›žåº”ï¼Œå¯¹è¯è‡ªç„¶çœŸå®žï¼Œå¯ä»¥ç”¨ *åŠ¨ä½œ* æè¿°åŠ¨ä½œã€‚";return s.trim()})(),s=[...v,...e],a=s.map(e=>e.content),r=me.buildContext((null==m?void 0:m.id)||"global",a.join("\n"),S.openai_max_context||8e3),l=t+(r?`\n\n[World Info]\n${r}`:"")+(v.length>0?`\n\n[å‰æƒ…æè¦: ä½ å’Œç”¨æˆ·ä¹‹å‰åœ¨çº¿ä¸Šå·²ç»èŠè¿‡ ${v.length} æ¡æ¶ˆæ¯ï¼ŒçŽ°åœ¨åˆ‡æ¢åˆ°äº†çº¿ä¸‹åœºæ™¯ç»§ç»­å¯¹è¯]`:""),n=he(l,r,a,S.openai_max_context||8e3);B(n);const i=[{role:"system",content:l},...s.slice(-20).map(e=>({role:e.role,content:e.content}))],c=$||S.openai_max_tokens,o=await q(i,1,c),d=Lt(o);j(e=>[...e,d])},V=(e,t)=>{j(s=>s.map(s=>s.id===e?Mt(s,t):s))},J=e=>{confirm("ç¡®å®šè¦åˆ é™¤è¿™æ¡æ¶ˆæ¯å—ï¼Ÿ")&&j(t=>t.filter(t=>t.id!==e))},H=async e=>{const t=b.findIndex(t=>t.id===e);if(-1===t||0===t)return;const s=b.slice(0,t);j(s),C(!0);try{await U(s)}catch(a){alert("é‡æ–°ç”Ÿæˆå¤±è´¥")}finally{C(!1)}},G=e=>{j(t=>t.map(t=>{if(t.id===e){return _t(t)||t}return t}))},K=e=>{j(t=>t.map(t=>{if(t.id===e){return It(t)||t}return t}))};return e.jsxs("div",{className:"h-full flex flex-col bg-gray-50",children:[e.jsxs("div",{className:"glass-effect sticky top-0 z-40",children:[i&&e.jsx(ua,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between border-b border-gray-200",children:[e.jsx("button",{onClick:()=>r("/desktop",{replace:!0}),className:"ios-button text-gray-700 hover:text-gray-900",children:e.jsx(os,{size:24})}),e.jsxs("div",{className:"flex flex-col items-center flex-1 mx-4",children:[e.jsx("button",{onClick:()=>g(!0),className:"text-base font-semibold text-gray-900 hover:text-blue-500 transition-colors",children:(null==m?void 0:m.name)||"çº¿ä¸‹æ¨¡å¼"}),S&&e.jsx("button",{onClick:()=>M(!0),className:"text-[10px] text-gray-500 hover:text-blue-500 transition-colors",children:S.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[E.total>0&&e.jsxs("div",{className:"text-[10px] px-2 py-1 rounded-md flex items-center gap-1",style:{backgroundColor:E.percentage>80?"rgba(239, 68, 68, 0.1)":"rgba(156, 163, 175, 0.1)",color:E.percentage>80?"#ef4444":"#6b7280"},children:[e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:e.jsx("path",{d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),e.jsx("span",{className:"font-medium",children:X(E.total)})]}),e.jsxs("button",{onClick:()=>D(!0),className:"text-xs px-2 py-1 rounded-md text-gray-600 hover:bg-gray-100 transition-colors flex items-center gap-1",title:"è°ƒæ•´å›žå¤å­—æ•°",children:[e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M12 5v14M5 12h14"})}),$?`${$}å­—`:"å­—æ•°"]}),b.length>0&&e.jsx("button",{onClick:()=>{confirm("ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å¯¹è¯å—ï¼Ÿ")&&(j([]),B({total:0,remaining:0,percentage:0,systemPrompt:0,lorebook:0,messages:0}))},className:"text-xs px-2 py-1 rounded-md text-gray-600 hover:bg-gray-100 transition-colors",children:"æ¸…ç©º"})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-4",children:[v.length>0&&e.jsx("div",{className:"flex justify-center mb-4",children:e.jsxs("div",{className:"bg-blue-50 border border-blue-200 px-4 py-2 rounded-xl max-w-md",children:[e.jsxs("div",{className:"text-xs text-blue-700 text-center",children:["ðŸ’¬ å·²å»¶ç»­çº¿ä¸Šå¯¹è¯è®°å¿†ï¼ˆ",v.length,"æ¡æ¶ˆæ¯ï¼‰"]}),e.jsx("div",{className:"text-[10px] text-blue-500 text-center mt-1",children:"AIä¼šè®°ä½ä½ ä»¬ä¹‹å‰çš„å¯¹è¯å†…å®¹"})]})}),0===b.length&&0===v.length&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[e.jsx("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",className:"mb-3",children:e.jsx("path",{d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})}),e.jsx("p",{className:"text-sm",children:m?`å¼€å§‹ä¸Ž ${m.name} å¯¹è¯`:"è¯·å…ˆé€‰æ‹©è§’è‰²"})]}),b.map(t=>e.jsx(Ql,{message:t,characterName:null==m?void 0:m.name,onEdit:V,onDelete:J,onRegenerate:H,onSwipeLeft:G,onSwipeRight:K},t.id)),k&&e.jsx("div",{className:"flex justify-start mb-4",children:e.jsx("div",{className:"bg-white border border-gray-200 rounded-xl px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-gray-300 border-t-gray-600"}),e.jsx("span",{className:"text-sm text-gray-500",children:"æ€è€ƒä¸­..."})]})})}),e.jsx("div",{ref:P})]}),m&&e.jsx("div",{className:"border-t border-gray-200 bg-white p-4",children:e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("div",{className:"flex-1 bg-gray-50 rounded-xl border border-gray-200 px-3 py-2",children:e.jsx("textarea",{ref:F,value:N,onChange:e=>w(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),R())},placeholder:"è¾“å…¥æ¶ˆæ¯... (Shift+Enteræ¢è¡Œ)",className:"w-full bg-transparent outline-none resize-none text-sm text-gray-800 placeholder-gray-400",style:{maxHeight:"120px",minHeight:"24px"},rows:1})}),e.jsx("button",{onClick:R,disabled:!N.trim()||k,className:"flex-shrink-0 w-10 h-10 rounded-xl flex items-center justify-center transition-all",style:{backgroundColor:N.trim()&&!k?"#3b82f6":"#e5e7eb",color:N.trim()&&!k?"#ffffff":"#9ca3af"},children:e.jsx(xs,{size:20})})]})}),u&&e.jsx(Xl,{characters:c,onSelect:O,onCancel:()=>r(-1)}),_&&e.jsx(Zl,{presets:z,currentPreset:S,onSelect:e=>{if(I(e),localStorage.setItem("current_offline_preset",e.id),M(!1),p){const t={...p,presetId:e.id};f(t),St(t)}},onCancel:()=>M(!1),onManagePresets:()=>{r("/preset-manager")}}),T&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-end justify-center z-50",onClick:()=>D(!1),children:e.jsxs("div",{className:"glass-card w-full max-w-lg p-6 rounded-t-3xl",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"å›žå¤å­—æ•°è®¾ç½®"}),e.jsx("button",{onClick:()=>D(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4",children:[e.jsxs("div",{className:"text-sm text-gray-600 mb-2",children:["å½“å‰è®¾ç½®ï¼š",e.jsxs("span",{className:"font-semibold text-gray-900 ml-2",children:[$||(null==S?void 0:S.openai_max_tokens)||800," tokens"]})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["çº¦ ",Math.round(.6*($||(null==S?void 0:S.openai_max_tokens)||800))," - ",Math.round(.8*($||(null==S?void 0:S.openai_max_tokens)||800))," å­—"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"è°ƒæ•´å›žå¤é•¿åº¦"}),e.jsx("input",{type:"range",min:"100",max:"3000",step:"100",value:$||(null==S?void 0:S.openai_max_tokens)||800,onChange:e=>A(Number(e.target.value)),className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[e.jsx("span",{children:"ç®€çŸ­"}),e.jsx("span",{children:"é€‚ä¸­"}),e.jsx("span",{children:"è¯¦ç»†"})]})]}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:[{label:"æžç®€",value:200},{label:"ç®€çŸ­",value:500},{label:"é€‚ä¸­",value:1e3},{label:"è¯¦ç»†",value:2e3}].map(t=>e.jsx("button",{onClick:()=>A(t.value),className:"py-2 rounded-lg text-sm font-medium transition-colors "+(($||(null==S?void 0:S.openai_max_tokens)||800)===t.value?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:t.label},t.value))}),$&&e.jsxs("button",{onClick:()=>A(null),className:"w-full py-2 text-sm text-gray-600 hover:text-gray-800",children:["é‡ç½®ä¸ºé¢„è®¾é»˜è®¤å€¼ï¼ˆ",null==S?void 0:S.openai_max_tokens,"ï¼‰"]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-3",children:[e.jsxs("div",{className:"text-xs text-blue-800",children:["ðŸ’¡ ",e.jsx("span",{className:"font-medium",children:"æç¤ºï¼š"})]}),e.jsxs("ul",{className:"text-xs text-blue-700 mt-1 space-y-1 ml-4",children:[e.jsx("li",{children:"â€¢ æ•°å€¼è¶Šå¤§ï¼ŒAIå›žå¤è¶Šè¯¦ç»†"}),e.jsx("li",{children:"â€¢ 1000 tokens â‰ˆ 600-800å­—"}),e.jsx("li",{children:"â€¢ æ—¥å¸¸å¯¹è¯å»ºè®®500-1000"}),e.jsx("li",{children:"â€¢ éœ€è¦ç»†èŠ‚æ—¶å¯å¢žåŠ åˆ°1500-2000"})]})]})]}),e.jsx("button",{onClick:()=>D(!1),className:"w-full mt-4 py-3 bg-blue-500 text-white rounded-xl font-medium hover:bg-blue-600 transition-colors",children:"ç¡®å®š"})]})})]})}},Symbol.toStringTag,{value:"Module"})),en=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const t=s(),{showStatusBar:a}=o();return e.jsxs("div",{className:"flex flex-col h-screen bg-gray-50",children:[a&&e.jsx(ua,{}),e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>t(-1),className:"ios-button text-gray-700 hover:text-gray-900",children:e.jsx(os,{size:24})}),e.jsx("h1",{className:"text-base font-semibold text-gray-900",children:"ç¾ŽåŒ–è®¾ç½®"}),e.jsx("div",{className:"w-6"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsx("div",{className:"space-y-3",children:[{id:"statusbar",name:"çŠ¶æ€æ ç¾ŽåŒ–",description:"è‡ªå®šä¹‰çŠ¶æ€æ æ ·å¼",route:"/statusbar-customize"},{id:"font",name:"å­—ä½“è®¾ç½®",description:"è‡ªå®šä¹‰å­—ä½“æ ·å¼",route:"/font-customizer"},{id:"icon",name:"è‡ªå®šä¹‰å›¾æ ‡",description:"æ›´æ¢åº”ç”¨å›¾æ ‡",route:"/icon-customizer"},{id:"background",name:"èƒŒæ™¯",description:"æ¡Œé¢èƒŒæ™¯å’ŒéŸ³ä¹èƒŒæ™¯",route:"/background-customizer"},{id:"bubble",name:"æ°”æ³¡æ ·å¼",description:"è‡ªå®šä¹‰èŠå¤©æ°”æ³¡"}].map((s,a)=>e.jsx("div",{onClick:()=>{s.route&&t(s.route)},className:"glass-card rounded-2xl p-4 cursor-pointer hover:shadow-lg transition-all backdrop-blur-md bg-white/80 border border-white/50",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full glass-card flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-semibold text-gray-600",children:a+1})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:s.name}),e.jsx("p",{className:"text-sm text-gray-500 mt-0.5",children:s.description})]}),e.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})},s.id))}),e.jsx("div",{className:"mt-6 p-4 glass-card rounded-2xl backdrop-blur-md bg-white/60 border border-white/50",children:e.jsx("p",{className:"text-sm text-gray-600 text-center",children:"æ›´å¤šç¾ŽåŒ–åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­..."})})]}),e.jsx("div",{className:"bg-white border-t border-gray-200 px-4 py-3",children:e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"è‡ªå®šä¹‰ä½ çš„ä¸“å±žç•Œé¢é£Žæ ¼"})})]})}},Symbol.toStringTag,{value:"Module"})),tn=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r,toggleStatusBar:l}=o(),[n,i]=t.useState(()=>{const e=localStorage.getItem("focus_mode");return e?JSON.parse(e):null}),[c,d]=t.useState((null==n?void 0:n.icon)||""),[x,m]=t.useState((null==n?void 0:n.name)||""),[h,u]=t.useState((null==n?void 0:n.color)||"#9333ea"),[g,p]=t.useState(!1!==(null==n?void 0:n.showBg)),f=t.useRef(null),[b,j]=t.useState(()=>"true"===localStorage.getItem("time_background_enabled")),[v,y]=t.useState(()=>localStorage.getItem("time_background_color")||"#22c55e"),N=e=>{if(n){const t={...n,...e};i(t),localStorage.setItem("focus_mode",JSON.stringify(t))}},w=e=>{y(e),localStorage.setItem("time_background_color",e)};return e.jsxs("div",{className:"flex flex-col h-screen bg-gray-50",children:[r&&e.jsx(ua,{}),e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a("/settings",{replace:!0}),className:"ios-button text-gray-700 hover:text-gray-900",children:e.jsx(os,{size:24})}),e.jsx("h1",{className:"text-base font-semibold text-gray-900",children:"çŠ¶æ€æ ç¾ŽåŒ–"}),e.jsx("div",{className:"w-6"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"glass-card rounded-2xl m-4 overflow-hidden backdrop-blur-md bg-white/80 border border-white/50",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-4 border-b border-gray-100",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-gray-900 font-medium mb-0.5",children:"æ˜¾ç¤ºçŠ¶æ€æ "}),e.jsx("div",{className:"text-xs text-gray-500",children:"æ˜¾ç¤ºé¡¶éƒ¨æ—¶é—´ã€ä¿¡å·å’Œç”µæ± ä¿¡æ¯"})]}),e.jsx("button",{onClick:l,className:"relative w-14 h-8 rounded-full transition-all duration-300 "+(r?"bg-green-500":"bg-gray-300"),children:e.jsx("div",{className:"absolute top-1 left-1 w-6 h-6 bg-white rounded-full shadow-md transition-transform duration-300 "+(r?"translate-x-6":"translate-x-0")})})]}),e.jsxs("div",{className:"px-4 py-4 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-gray-900 font-medium mb-0.5",children:"ä¸“æ³¨æ¨¡å¼"}),e.jsx("div",{className:"text-xs text-gray-500",children:"åœ¨çŠ¶æ€æ æ˜¾ç¤ºè‡ªå®šä¹‰å›¾æ ‡å’Œæ–‡å­—"})]}),e.jsx("button",{onClick:()=>{if(n)i(null),localStorage.removeItem("focus_mode"),d(""),m("");else{const e={icon:c,name:x,color:h,showBg:g};i(e),localStorage.setItem("focus_mode",JSON.stringify(e))}},className:"relative w-14 h-8 rounded-full transition-all duration-300 "+(n?"bg-green-500":"bg-gray-300"),children:e.jsx("div",{className:"absolute top-1 left-1 w-6 h-6 bg-white rounded-full shadow-md transition-transform duration-300 "+(n?"translate-x-6":"translate-x-0")})})]}),n&&e.jsxs("div",{className:"space-y-3 pt-3 border-t border-gray-100",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"å›¾æ ‡"}),e.jsx("input",{ref:f,type:"file",accept:"image/*",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(s){const e=new FileReader;e.onload=e=>{var t;const s=null==(t=e.target)?void 0:t.result;d(s),N({icon:s})},e.readAsDataURL(s)}},className:"hidden"}),e.jsxs("div",{className:"flex items-center gap-2",children:[c&&e.jsx("div",{className:"w-10 h-10 rounded-lg overflow-hidden border border-gray-200 flex items-center justify-center",children:e.jsx("img",{src:c,alt:"å›¾æ ‡",className:"w-full h-full object-cover"})}),e.jsx("button",{onClick:()=>{var e;return null==(e=f.current)?void 0:e.click()},className:"flex-1 px-3 py-2 bg-gray-100 text-gray-700 rounded-lg text-xs",children:c?"æ›´æ¢å›¾æ ‡":"ä¸Šä¼ å›¾æ ‡"}),c&&e.jsx("button",{onClick:()=>{d(""),N({icon:""})},className:"px-3 py-2 bg-red-50 text-red-600 rounded-lg text-xs",children:"åˆ é™¤"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"åç§°"}),e.jsx("input",{type:"text",value:x,onChange:e=>{m(e.target.value),N({name:e.target.value})},placeholder:"è¯·è¾“å…¥æ¨¡å¼åç§°",className:"w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:border-green-500"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-xs text-gray-600",children:"æ˜¾ç¤ºèƒŒæ™¯è‰²"}),e.jsx("button",{onClick:()=>{const e=!g;p(e),N({showBg:e})},className:"relative w-12 h-6 rounded-full transition-all "+(g?"bg-green-500":"bg-gray-300"),children:e.jsx("div",{className:"absolute top-1 left-1 w-4 h-4 bg-white rounded-full shadow-md transition-transform "+(g?"translate-x-6":"translate-x-0")})})]}),g&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"èƒŒæ™¯é¢œè‰²"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"color",value:h,onChange:e=>{u(e.target.value),N({color:e.target.value})},className:"w-12 h-10 rounded-lg border border-gray-200 cursor-pointer"}),e.jsx("input",{type:"text",value:h,onChange:e=>{u(e.target.value),N({color:e.target.value})},className:"flex-1 px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:border-green-500",placeholder:"#9333ea"})]})]})]})]}),e.jsxs("div",{className:"px-4 py-4",children:[e.jsx("div",{className:"text-gray-900 font-medium mb-4",children:"æ—¶é—´æ˜¾ç¤º"}),e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"text-sm text-gray-700",children:"æ˜¾ç¤ºèƒŒæ™¯è‰²"}),e.jsx("button",{onClick:()=>{const e=!b;j(e),localStorage.setItem("time_background_enabled",String(e))},className:"relative w-14 h-8 rounded-full transition-all duration-300 "+(b?"bg-green-500":"bg-gray-300"),children:e.jsx("div",{className:"absolute top-1 left-1 w-6 h-6 bg-white rounded-full shadow-md transition-transform duration-300 "+(b?"translate-x-6":"translate-x-0")})})]}),b&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-sm text-gray-700",children:"èƒŒæ™¯é¢œè‰²"}),e.jsxs("div",{className:"flex-1 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg border border-gray-200 cursor-pointer",style:{backgroundColor:v},onClick:()=>{var e;return null==(e=document.getElementById("color-picker"))?void 0:e.click()}}),e.jsx("input",{id:"color-picker",type:"color",value:v,onChange:e=>w(e.target.value),className:"hidden"}),e.jsx("input",{type:"text",value:v,onChange:e=>w(e.target.value),className:"flex-1 px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:border-green-500"})]})]})]})]})})]})}},Symbol.toStringTag,{value:"Module"})),sn=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{characterId:l}=r(),{showStatusBar:i}=o(),{characters:c}=n(),d=c.find(e=>e.id===l),[x,m]=t.useState(()=>{const e=localStorage.getItem(`life_config_${l}`);return e?JSON.parse(e):{schedule:[{time:"07:30",activity:"èµ·åºŠ",location:"å®¶"},{time:"08:00",activity:"æ´—æ¼±åƒæ—©é¤",location:"å®¶"},{time:"09:00",activity:"åˆ°è¾¾å…¬å¸",location:"å…¬å¸"},{time:"12:00",activity:"åˆé¤",location:"é™„è¿‘é¤åŽ…"},{time:"18:00",activity:"ä¸‹ç­",location:"å…¬å¸"},{time:"19:00",activity:"åˆ°å®¶",location:"å®¶"},{time:"23:00",activity:"ç¡è§‰",location:"å®¶"}],frequentPlaces:[{name:"å®¶",address:"æ¨æµ¦åŒºæŸæŸè·¯123å·",frequency:"æ¯å¤©"},{name:"å…¬å¸",address:"æµ¦ä¸œæ–°åŒºé™†å®¶å˜´é‡‘èžä¸­å¿ƒ",frequency:"å·¥ä½œæ—¥"},{name:"æ˜Ÿå·´å…‹",address:"äº”è§’åœºä¸‡è¾¾å¹¿åœº",frequency:"å‘¨2-3æ¬¡"},{name:"å¥èº«æˆ¿",address:"é™„è¿‘å¥èº«ä¸­å¿ƒ",frequency:"å‘¨2æ¬¡"}],routineTime:{wakeUp:"07:30",sleep:"23:00",lunch:"12:00"}}}),[h,u]=t.useState("schedule"),[g,p]=t.useState(null),[f,b]=t.useState(null),j=e=>{m(e),localStorage.setItem(`life_config_${l}`,JSON.stringify(e)),window.dispatchEvent(new Event("lifeConfigUpdate"))},v=(e,t,s)=>{const a=[...x.schedule];a[e]={...a[e],[t]:s},j({...x,schedule:a.sort((e,t)=>e.time.localeCompare(t.time))})},y=(e,t,s)=>{const a=[...x.frequentPlaces];a[e]={...a[e],[t]:s},j({...x,frequentPlaces:a})},N=(e,t)=>{j({...x,routineTime:{...x.routineTime,[e]:t}})};return e.jsxs("div",{className:"flex flex-col h-screen bg-gray-50",children:[i&&e.jsx(ua,{}),e.jsxs("div",{className:"bg-white border-b border-gray-200",children:[e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a(-1),className:"ios-button text-gray-700 hover:text-gray-900",children:e.jsx(os,{size:24})}),e.jsxs("h1",{className:"text-base font-semibold text-gray-900",children:[null==d?void 0:d.name,"çš„ç”Ÿæ´»è®¾ç½®"]}),e.jsx("div",{className:"w-6"})]}),e.jsxs("div",{className:"flex border-t border-gray-100",children:[e.jsx("button",{onClick:()=>u("schedule"),className:"flex-1 py-3 text-sm font-medium transition-colors "+("schedule"===h?"text-blue-500 border-b-2 border-blue-500":"text-gray-500"),children:"æ—¥ç¨‹å®‰æŽ’"}),e.jsx("button",{onClick:()=>u("places"),className:"flex-1 py-3 text-sm font-medium transition-colors "+("places"===h?"text-blue-500 border-b-2 border-blue-500":"text-gray-500"),children:"å¸¸åŽ»åœ°ç‚¹"}),e.jsx("button",{onClick:()=>u("routine"),className:"flex-1 py-3 text-sm font-medium transition-colors "+("routine"===h?"text-blue-500 border-b-2 border-blue-500":"text-gray-500"),children:"ä½œæ¯æ—¶é—´"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:["schedule"===h&&e.jsxs("div",{className:"space-y-3",children:[x.schedule.map((t,s)=>e.jsx("div",{className:"glass-card rounded-2xl p-4 backdrop-blur-md bg-white/80 border border-white/50",children:g===s?e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"time",value:t.time,onChange:e=>v(s,"time",e.target.value),className:"w-full px-3 py-2 border border-gray-200 rounded-lg text-sm"}),e.jsx("input",{type:"text",value:t.activity,onChange:e=>v(s,"activity",e.target.value),placeholder:"æ´»åŠ¨",className:"w-full px-3 py-2 border border-gray-200 rounded-lg text-sm"}),e.jsx("input",{type:"text",value:t.location,onChange:e=>v(s,"location",e.target.value),placeholder:"åœ°ç‚¹",className:"w-full px-3 py-2 border border-gray-200 rounded-lg text-sm"}),e.jsx("button",{onClick:()=>p(null),className:"w-full px-4 py-2 bg-blue-500 text-white rounded-lg text-sm",children:"å®Œæˆ"})]}):e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"text-sm font-mono text-blue-500",children:t.time}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.activity}),e.jsx("div",{className:"text-xs text-gray-500",children:t.location})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>p(s),className:"px-3 py-1 bg-blue-50 text-blue-600 rounded-lg text-xs",children:"ç¼–è¾‘"}),e.jsx("button",{onClick:()=>(e=>{const t=x.schedule.filter((t,s)=>s!==e);j({...x,schedule:t})})(s),className:"px-3 py-1 bg-red-50 text-red-600 rounded-lg text-xs",children:"åˆ é™¤"})]})]})},s)),e.jsx("button",{onClick:()=>{const e=[...x.schedule,{time:"12:00",activity:"æ–°æ´»åŠ¨",location:"åœ°ç‚¹"}];j({...x,schedule:e.sort((e,t)=>e.time.localeCompare(t.time))})},className:"w-full py-3 glass-card rounded-2xl text-blue-500 font-medium text-sm",children:"+ æ·»åŠ æ—¥ç¨‹"})]}),"places"===h&&e.jsxs("div",{className:"space-y-3",children:[x.frequentPlaces.map((t,s)=>e.jsx("div",{className:"glass-card rounded-2xl p-4 backdrop-blur-md bg-white/80 border border-white/50",children:f===s?e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"text",value:t.name,onChange:e=>y(s,"name",e.target.value),placeholder:"åœ°ç‚¹åç§°",className:"w-full px-3 py-2 border border-gray-200 rounded-lg text-sm"}),e.jsx("input",{type:"text",value:t.address,onChange:e=>y(s,"address",e.target.value),placeholder:"è¯¦ç»†åœ°å€",className:"w-full px-3 py-2 border border-gray-200 rounded-lg text-sm"}),e.jsx("input",{type:"text",value:t.frequency,onChange:e=>y(s,"frequency",e.target.value),placeholder:"é¢‘çŽ‡ï¼ˆå¦‚ï¼šæ¯å¤©ã€å‘¨2æ¬¡ï¼‰",className:"w-full px-3 py-2 border border-gray-200 rounded-lg text-sm"}),e.jsx("button",{onClick:()=>b(null),className:"w-full px-4 py-2 bg-blue-500 text-white rounded-lg text-sm",children:"å®Œæˆ"})]}):e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 mb-1",children:t.name}),e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:t.address}),e.jsx("div",{className:"text-xs text-blue-500",children:t.frequency})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>b(s),className:"px-3 py-1 bg-blue-50 text-blue-600 rounded-lg text-xs",children:"ç¼–è¾‘"}),e.jsx("button",{onClick:()=>(e=>{const t=x.frequentPlaces.filter((t,s)=>s!==e);j({...x,frequentPlaces:t})})(s),className:"px-3 py-1 bg-red-50 text-red-600 rounded-lg text-xs",children:"åˆ é™¤"})]})]})},s)),e.jsx("button",{onClick:()=>{const e=[...x.frequentPlaces,{name:"æ–°åœ°ç‚¹",address:"åœ°å€",frequency:"å¶å°”"}];j({...x,frequentPlaces:e})},className:"w-full py-3 glass-card rounded-2xl text-blue-500 font-medium text-sm",children:"+ æ·»åŠ åœ°ç‚¹"})]}),"routine"===h&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"glass-card rounded-2xl p-4 backdrop-blur-md bg-white/80 border border-white/50",children:e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-sm text-gray-700",children:"èµ·åºŠæ—¶é—´"}),e.jsx("input",{type:"time",value:x.routineTime.wakeUp,onChange:e=>N("wakeUp",e.target.value),className:"px-3 py-2 border border-gray-200 rounded-lg text-sm"})]})}),e.jsx("div",{className:"glass-card rounded-2xl p-4 backdrop-blur-md bg-white/80 border border-white/50",children:e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-sm text-gray-700",children:"ç¡è§‰æ—¶é—´"}),e.jsx("input",{type:"time",value:x.routineTime.sleep,onChange:e=>N("sleep",e.target.value),className:"px-3 py-2 border border-gray-200 rounded-lg text-sm"})]})}),e.jsx("div",{className:"glass-card rounded-2xl p-4 backdrop-blur-md bg-white/80 border border-white/50",children:e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-sm text-gray-700",children:"åˆé¤æ—¶é—´"}),e.jsx("input",{type:"time",value:x.routineTime.lunch,onChange:e=>N("lunch",e.target.value),className:"px-3 py-2 border border-gray-200 rounded-lg text-sm"})]})})]})]})]})}},Symbol.toStringTag,{value:"Module"})),an=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),[r,l]=t.useState(!1),[n,i]=t.useState(null),[c,o]=t.useState(null),d=async()=>{const e=await $t(),t=await At();o({usage:e,stats:t})};return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[e.jsxs("div",{className:"bg-white border-b border-gray-200 px-4 py-3 flex items-center",children:[e.jsx("button",{onClick:()=>a(-1),className:"mr-3",children:e.jsx(os,{})}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"å­˜å‚¨å‡çº§"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200 rounded-lg p-4 mb-4",children:[e.jsx("h2",{className:"text-base font-semibold text-blue-900 mb-2",children:"ðŸš€ çªç ´å­˜å‚¨é™åˆ¶"}),e.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[e.jsxs("p",{children:["â€¢ ",e.jsx("strong",{children:"localStorage"}),": 5-10MBï¼ˆæ—§æ–¹æ¡ˆï¼Œæœ‰é™åˆ¶ï¼‰"]}),e.jsxs("p",{children:["â€¢ ",e.jsx("strong",{children:"IndexedDB"}),": 50MB-500MBï¼ˆæ–°æ–¹æ¡ˆï¼Œæ— é™åˆ¶ï¼‰âœ¨"]}),e.jsx("p",{className:"mt-2 text-xs",children:"è¿ç§»åˆ°IndexedDBåŽï¼Œä½ å¯ä»¥ä¿å­˜æ‰€æœ‰èŠå¤©è®°å½•ï¼Œä¸ç”¨æ‹…å¿ƒç©ºé—´ä¸è¶³ï¼"})]})]}),c&&e.jsxs("div",{className:"bg-white rounded-lg p-4 mb-4 shadow-sm",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-900 mb-3",children:"ðŸ“Š å­˜å‚¨çŠ¶æ€"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"IndexedDBä½¿ç”¨"}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[c.usage.used,"MB / ",c.usage.quota,"MB"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${c.usage.percentage}%`}})})]}),e.jsxs("div",{className:"border-t pt-3",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"èŠå¤©ç»Ÿè®¡"}),e.jsxs("div",{className:"mt-2 space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"èŠå¤©æ•°é‡"}),e.jsx("span",{className:"font-semibold",children:c.stats.totalChats})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"æ¶ˆæ¯æ€»æ•°"}),e.jsx("span",{className:"font-semibold",children:c.stats.totalMessages})]})]})]})]})]}),e.jsx("button",{onClick:d,className:"w-full py-3 rounded-lg font-semibold text-blue-600 bg-blue-50 border border-blue-200 hover:bg-blue-100 active:bg-blue-200 mb-4",children:"æ£€æŸ¥å­˜å‚¨çŠ¶æ€"}),n&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-green-900 mb-2",children:"âœ… è¿ç§»å®Œæˆ"}),e.jsxs("div",{className:"text-xs text-green-800 space-y-1",children:[e.jsxs("div",{children:["æˆåŠŸè¿ç§»: ",n.success," ä¸ªèŠå¤©"]}),e.jsxs("div",{children:["æ€»æ¶ˆæ¯æ•°: ",n.totalMessages," æ¡"]}),n.failed>0&&e.jsxs("div",{className:"text-red-600",children:["å¤±è´¥: ",n.failed," ä¸ª"]})]})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-yellow-900 mb-2",children:"ðŸ“ æ“ä½œæ­¥éª¤"}),e.jsxs("ol",{className:"text-xs text-yellow-800 space-y-2 list-decimal list-inside",children:[e.jsxs("li",{children:[e.jsx("strong",{children:'ç‚¹å‡»"å¼€å§‹è¿ç§»"'})," - å°†localStorageçš„èŠå¤©è®°å½•è¿ç§»åˆ°IndexedDB"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"æ£€æŸ¥å­˜å‚¨çŠ¶æ€"})," - ç¡®è®¤è¿ç§»æˆåŠŸ"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"ï¼ˆå¯é€‰ï¼‰æ¸…ç†localStorage"})," - é‡Šæ”¾æ—§ç©ºé—´ï¼ˆå»ºè®®ç­‰å‡ å¤©ç¡®è®¤æ— è¯¯åŽå†æ¸…ç†ï¼‰"]})]})]}),e.jsx("button",{onClick:async()=>{if(!r&&window.confirm("ç¡®å®šè¦è¿ç§»èŠå¤©è®°å½•åˆ°IndexedDBå—ï¼Ÿè¿™å°†é‡Šæ”¾localStorageç©ºé—´ã€‚")){l(!0);try{const e=await Tt();i(e),d()}catch(e){alert("è¿ç§»å¤±è´¥: "+e)}finally{l(!1)}}},disabled:r,className:"w-full py-3 rounded-lg font-semibold text-white mb-3 "+(r?"bg-gray-400 cursor-not-allowed":"bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 active:from-blue-700 active:to-purple-700"),children:r?"è¿ç§»ä¸­...":"ðŸš€ å¼€å§‹è¿ç§»åˆ°IndexedDB"}),e.jsx("button",{onClick:()=>{if(!window.confirm("ç¡®å®šè¦æ¸…ç†localStorageä¸­çš„èŠå¤©è®°å½•å—ï¼Ÿè¯·ç¡®ä¿å·²ç»è¿ç§»æˆåŠŸï¼"))return;const e=Dt();alert(`æ¸…ç†å®Œæˆï¼šåˆ é™¤${e.cleaned}ä¸ªæ–‡ä»¶ï¼Œé‡Šæ”¾${(e.freedSpace/1024/1024).toFixed(2)}MB`),d()},className:"w-full py-3 rounded-lg font-semibold text-gray-600 bg-gray-100 border border-gray-300 hover:bg-gray-200 active:bg-gray-300",children:"ðŸ§¹ æ¸…ç†localStorageï¼ˆå¯é€‰ï¼‰"}),e.jsx("div",{className:"mt-4 bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-xs text-red-800",children:["âš ï¸ ",e.jsx("strong",{children:"æ³¨æ„"}),": æ¸…ç†localStorageå‰è¯·ç¡®ä¿è¿ç§»æˆåŠŸä¸”æ•°æ®æ­£å¸¸ï¼æ¸…ç†åŽçš„æ•°æ®æ— æ³•æ¢å¤ã€‚"]})}),e.jsxs("div",{className:"mt-4 bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-2",children:"âœ¨ IndexedDBä¼˜åŠ¿"}),e.jsxs("ul",{className:"text-xs text-gray-600 space-y-1",children:[e.jsx("li",{children:"âœ… å­˜å‚¨å®¹é‡å¤§ï¼š50MB-500MBï¼ˆlocalStorageåªæœ‰5-10MBï¼‰"}),e.jsx("li",{children:"âœ… ä¿ç•™æ‰€æœ‰å›žå¿†ï¼šä¸ç”¨æ‹…å¿ƒæ¶ˆæ¯å¤ªå¤š"}),e.jsx("li",{children:"âœ… æ€§èƒ½æ›´å¥½ï¼šå¼‚æ­¥æ“ä½œä¸é˜»å¡žç•Œé¢"}),e.jsx("li",{children:"âœ… è‡ªåŠ¨è¿ç§»ï¼šç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨IndexedDB"}),e.jsx("li",{children:"âœ… å‘ä¸‹å…¼å®¹ï¼šå‡ºé”™ä¼šè‡ªåŠ¨é™çº§åˆ°localStorage"})]})]})]})]})}},Symbol.toStringTag,{value:"Module"})),rn=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const t=s(),{showStatusBar:a}=o(),r=[{id:1,name:"ç«èŠ±æ—¶åˆ»",description:"æŸ¥çœ‹ä¸ŽAIçš„ç¾Žå¥½çž¬é—´",icon:"/zhizhi/assets/spark-icon-TszGNU8A.webp",path:"/spark-moments",color:"bg-orange-500"},{id:2,name:"çƒ­æ¢—åº“",description:"æµè§ˆå’Œç®¡ç†æµè¡Œçƒ­æ¢—",icon:"/zhizhi/assets/memes-icon-hqmVJXid.webp",path:"/memes-library",color:"bg-red-500"},{id:3,name:"éŸ³ä¹",description:"äº«å—ç¾Žå¦™çš„éŸ³ä¹æ—¶å…‰",icon:"/zhizhi/assets/music-icon-CqZD5jYZ.webp",path:"/music-player",color:"bg-gradient-to-br from-pink-500 to-purple-500"},{id:4,name:"æ°”æ³¡å•†åº—",description:"é€‰æ‹©ä½ å–œæ¬¢çš„èŠå¤©æ°”æ³¡æ ·å¼",icon:"/zhizhi/assets/bubble-icon-BmBwoUMP.webp",path:"/bubble-store",color:"bg-gradient-to-br from-purple-500 to-pink-500"}];return e.jsxs("div",{className:"h-screen flex flex-col bg-gray-50",children:[a&&e.jsx(ua,{}),e.jsxs("div",{className:"glass-effect px-4 py-3 border-b border-gray-200/50 flex items-center",children:[e.jsx("button",{onClick:()=>t("/desktop",{replace:!0}),className:"w-8 h-8 flex items-center justify-center ios-button",children:e.jsx("span",{className:"text-blue-500 text-xl",children:"â€¹"})}),e.jsx("h1",{className:"flex-1 text-center text-lg font-semibold text-gray-900",children:"å°ç¨‹åº"}),e.jsx("div",{className:"w-8"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar p-4",children:[e.jsx("div",{className:"space-y-3",children:r.map(s=>e.jsx("div",{onClick:()=>t(s.path),className:"glass-card rounded-2xl p-5 ios-button cursor-pointer hover:shadow-lg transition-shadow",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:s.icon,alt:s.name,className:"w-16 h-16 object-contain flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-gray-900 text-base mb-1",children:s.name}),e.jsx("p",{className:"text-sm text-gray-500 leading-relaxed",children:s.description})]}),e.jsx("div",{className:"text-gray-300 text-2xl flex-shrink-0",children:"â€º"})]})},s.id))}),e.jsxs("div",{className:"mt-6 glass-card rounded-2xl p-6 text-center",children:[e.jsx("div",{className:"text-gray-400 text-sm mb-1",children:"æ›´å¤šå°ç¨‹åº"}),e.jsx("div",{className:"text-gray-500 text-xs",children:"å³å°†ä¸Šçº¿ï¼Œæ•¬è¯·æœŸå¾…"})]})]})]})}},Symbol.toStringTag,{value:"Module"})),ln=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{currentUser:r,updateUser:l}=d(),n=t.useRef(null),[i,c]=t.useState((null==r?void 0:r.avatar)||"https://i.pravatar.cc/150?img=68"),[o,x]=t.useState((null==r?void 0:r.signature)||"ä¸ªæ€§ç­¾å"),m=[{id:"group1",items:[{id:"api",title:"API è®¾ç½®",icon:aa,iconColor:"bg-orange-500",route:"/wechat/api-list"},{id:"sound-upload",title:"å£°éŸ³ä¸Šä¼ ",icon:Zs,iconColor:"bg-gradient-to-br from-blue-400 to-purple-400",route:"/settings/sound-upload"},{id:"cellular",title:"èœ‚çªç½‘ç»œ",icon:sa,iconColor:"bg-green-500",route:"/settings/cellular"},{id:"hotspot",title:"ä¸ªäººçƒ­ç‚¹",icon:sa,iconColor:"bg-green-500",value:"å…³",route:"/settings/hotspot"}]},{id:"group2",items:[{id:"notifications",title:"é€šçŸ¥",icon:Xs,iconColor:"bg-red-500",route:"/settings/notifications"},{id:"sounds",title:"å£°éŸ³ä¸Žè§¦æ„Ÿ",icon:Zs,iconColor:"bg-pink-500",route:"/settings/sounds"},{id:"focus",title:"ä¸“æ³¨æ¨¡å¼",icon:Qs,iconColor:"bg-purple-500",route:"/settings/focus"},{id:"screentime",title:"å±å¹•ä½¿ç”¨æ—¶é—´",icon:Ss,iconColor:"bg-purple-500",route:"/settings/screentime"}]},{id:"group3",items:[{id:"general",title:"é€šç”¨",icon:Ss,iconColor:"bg-gray-500",route:"/settings/general"},{id:"control",title:"æŽ§åˆ¶ä¸­å¿ƒ",icon:Ss,iconColor:"bg-gray-500",route:"/settings/control"},{id:"display",title:"æ˜¾ç¤ºä¸Žäº®åº¦",icon:Ys,iconColor:"bg-blue-500",route:"/settings/display"},{id:"wallpaper",title:"å£çº¸",icon:us,iconColor:"bg-blue-400",route:"/settings/wallpaper"},{id:"siri",title:"Siri ä¸Žæœç´¢",icon:is,iconColor:"bg-gradient-to-br from-purple-500 to-pink-500",route:"/settings/siri"}]},{id:"group4",items:[{id:"faceid",title:"é¢å®¹ ID ä¸Žå¯†ç ",icon:ea,iconColor:"bg-green-500",route:"/settings/faceid"},{id:"emergency",title:"ç´§æ€¥è”ç»œ",icon:Xs,iconColor:"bg-red-500",route:"/settings/emergency"},{id:"privacy",title:"éšç§ä¸Žå®‰å…¨æ€§",icon:ta,iconColor:"bg-blue-500",route:"/settings/privacy"}]}];return e.jsxs("div",{className:"h-screen w-full bg-gradient-to-br from-white via-blue-50/30 to-purple-50/20 flex flex-col",children:[e.jsxs("div",{className:"backdrop-blur-xl bg-white/80 border-b border-white/50 shadow-sm",children:[e.jsx(ua,{}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsx("button",{onClick:()=>a("/"),className:"w-10 h-10 flex items-center justify-center active:scale-95 transition-transform",children:e.jsx(os,{size:24,className:"text-blue-500"})}),e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"è®¾ç½®"}),e.jsx("div",{className:"w-10"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsx("div",{className:"px-4 py-4",children:e.jsx("div",{className:"backdrop-blur-xl bg-white/70 rounded-2xl p-4 shadow-lg border border-white/50 active:scale-95 transition-transform cursor-pointer",onClick:()=>a(`/profile/${(null==r?void 0:r.id)||"default"}`),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-16 h-16 rounded-full overflow-hidden bg-gray-200 flex-shrink-0 cursor-pointer hover:opacity-80 transition-opacity",onClick:e=>{var t;e.stopPropagation(),null==(t=n.current)||t.click()},children:e.jsx("img",{src:i,alt:(null==r?void 0:r.name)||"ç”¨æˆ·",className:"w-full h-full object-cover"})}),e.jsx("input",{ref:n,type:"file",accept:"image/*",className:"hidden",onChange:async e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(!s)return;if(!s.type.startsWith("image/"))return void alert("è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶");const a=new FileReader;a.onload=async()=>{const e=a.result;c(e),r&&(l(r.id,{avatar:e}),localStorage.setItem(`user_avatar_fingerprint_${r.id}`,e.substring(0,200)),localStorage.setItem(`user_avatar_recognized_at_${r.id}`,Date.now().toString()))},a.readAsDataURL(s)}}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:(null==r?void 0:r.name)||"ç”¨æˆ·"}),e.jsx("div",{className:"text-sm text-gray-500",children:o})]}),e.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M9 18l6-6-6-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]})})}),m.map(t=>e.jsx("div",{className:"px-4 mb-4",children:e.jsx("div",{className:"backdrop-blur-xl bg-white/70 rounded-2xl shadow-lg border border-white/50 overflow-hidden",children:t.items.map((s,r)=>e.jsxs("div",{children:[e.jsxs("div",{onClick:()=>s.route&&a(s.route),className:"flex items-center gap-3 px-4 py-3 active:bg-gray-100/50 transition-colors cursor-pointer",children:[e.jsx("div",{className:`w-8 h-8 ${s.iconColor} rounded-lg flex items-center justify-center flex-shrink-0`,children:e.jsx(s.icon,{size:18,className:"text-white"})}),e.jsx("div",{className:"flex-1 text-base text-gray-900",children:s.title}),s.value&&e.jsx("div",{className:"text-sm text-gray-500",children:s.value}),s.badge&&e.jsx("div",{className:"bg-red-500 text-white text-xs px-2 py-0.5 rounded-full",children:s.badge}),e.jsx("svg",{className:"w-5 h-5 text-gray-400 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M9 18l6-6-6-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]}),r<t.items.length-1&&e.jsx("div",{className:"ml-14 border-b border-gray-200/50"})]},s.id))})},t.id)),e.jsx("div",{className:"h-20"})]})]})}},Symbol.toStringTag,{value:"Module"})),nn=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),r=t.useRef({}),l=[{id:"message",title:"æ¶ˆæ¯æç¤ºéŸ³",description:"AIå‘é€æ¶ˆæ¯æ—¶æ’­æ”¾çš„æç¤ºéŸ³",storageKey:"custom_message_sound"},{id:"call",title:"é€šè¯æç¤ºéŸ³",description:"æ¥ç”µæ—¶æ’­æ”¾çš„é“ƒå£°",storageKey:"custom_call_sound"}],[n,i]=t.useState(()=>{const e={};return l.forEach(t=>{const s=localStorage.getItem(t.storageKey);s&&(e[t.id]=s)}),e});return e.jsxs("div",{className:"h-screen w-full bg-gradient-to-br from-white via-blue-50/30 to-purple-50/20 flex flex-col",children:[e.jsxs("div",{className:"backdrop-blur-xl bg-white/80 border-b border-white/50 shadow-sm",children:[e.jsx(ua,{}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsx("button",{onClick:()=>a(-1),className:"w-10 h-10 flex items-center justify-center active:scale-95 transition-transform",children:e.jsx(os,{size:24,className:"text-blue-500"})}),e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"å£°éŸ³è®¾ç½®"}),e.jsx("div",{className:"w-10"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-6",children:[e.jsx("div",{className:"mb-6 backdrop-blur-xl bg-white/70 rounded-2xl p-4 shadow-lg border border-white/50",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-400 to-purple-400 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(Zs,{size:20,className:"text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900 mb-1",children:"è‡ªå®šä¹‰æç¤ºéŸ³"}),e.jsx("p",{className:"text-sm text-gray-600",children:"ä¸Šä¼ æ‚¨å–œæ¬¢çš„éŸ³é¢‘æ–‡ä»¶ä½œä¸ºæ¶ˆæ¯å’Œé€šè¯æç¤ºéŸ³"})]})]})}),e.jsx("div",{className:"space-y-4",children:l.map(t=>e.jsxs("div",{className:"backdrop-blur-xl bg-white/70 rounded-2xl p-5 shadow-lg border border-white/50",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:t.title}),e.jsx("p",{className:"text-sm text-gray-600",children:t.description})]}),n[t.id]?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-blue-50/50 rounded-xl border border-blue-100/50",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(Zs,{size:20,className:"text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:n[t.id]}),e.jsx("div",{className:"text-xs text-gray-500",children:"å·²ä¸Šä¼ "})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>(e=>{const t=localStorage.getItem(e.storageKey);t&&new Audio(t).play()})(t),className:"flex-1 py-2.5 px-4 bg-gradient-to-r from-blue-500 to-purple-500 text-white text-sm font-medium rounded-xl active:scale-95 transition-transform shadow-lg",children:"æ’­æ”¾é¢„è§ˆ"}),e.jsx("button",{onClick:()=>(e=>{localStorage.removeItem(e.storageKey),i(t=>{const s={...t};return delete s[e.id],s})})(t),className:"flex-1 py-2.5 px-4 bg-white/80 text-red-500 text-sm font-medium rounded-xl active:scale-95 transition-transform border border-red-200/50",children:"åˆ é™¤"})]})]}):e.jsxs("div",{children:[e.jsx("button",{onClick:()=>{var e;return null==(e=r.current[t.id])?void 0:e.click()},className:"w-full py-3 px-4 bg-gradient-to-r from-blue-500 to-purple-500 text-white text-sm font-medium rounded-xl active:scale-95 transition-transform shadow-lg",children:"ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶"}),e.jsx("input",{ref:e=>r.current[t.id]=e,type:"file",accept:"audio/*",className:"hidden",onChange:e=>(async(e,t)=>{var s;const a=null==(s=e.target.files)?void 0:s[0];if(!a)return;if(!a.type.startsWith("audio/"))return void alert("è¯·é€‰æ‹©éŸ³é¢‘æ–‡ä»¶ï¼ˆmp3, wav, m4aç­‰æ ¼å¼ï¼‰");const r=new FileReader;r.onload=()=>{const e=r.result;localStorage.setItem(t.storageKey,e),i(e=>({...e,[t.id]:a.name}))},r.readAsDataURL(a)})(e,t)})]})]},t.id))}),e.jsxs("div",{className:"mt-6 backdrop-blur-xl bg-white/50 rounded-2xl p-4 border border-white/50",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"æ”¯æŒçš„éŸ³é¢‘æ ¼å¼"}),e.jsx("p",{className:"text-xs text-gray-600",children:"MP3ã€WAVã€M4Aã€OGG ç­‰å¸¸è§éŸ³é¢‘æ ¼å¼"})]}),e.jsx("div",{className:"h-8"})]})]})}},Symbol.toStringTag,{value:"Module"})),cn=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),[r,l]=t.useState(!1),[n,i]=t.useState("v1.0.0-0"),[c,o]=t.useState(null),d={"AIè§†è§‰è¯†åˆ«":'AIå¯ä»¥è¯†åˆ«å’Œç†è§£å›¾ç‰‡å†…å®¹ã€‚åŒ…æ‹¬å¤´åƒè¯†åˆ«ï¼ˆè‡ªåŠ¨è¯†åˆ«ç”¨æˆ·å’ŒAIçš„å¤´åƒå¤–è²Œï¼‰ã€å›¾ç‰‡è¯†åˆ«ï¼ˆç†è§£ä½ å‘é€çš„ç…§ç‰‡å†…å®¹ï¼‰ã€å›¾ç‰‡ç”Ÿæˆï¼ˆæ ¹æ®å¯¹è¯ç”Ÿæˆç›¸å…³å›¾ç‰‡ï¼‰ã€‚AIèƒ½å¤Ÿ"çœ‹åˆ°"å¹¶ç†è§£è§†è§‰ä¿¡æ¯ã€‚',"AIè‡ªä¸»æ¢å½¢è±¡":"AIå¯ä»¥è‡ªä¸»æ›´æ¢è‡ªå·±çš„å¤´åƒã€ä¸ªæ€§ç­¾åå’Œæ˜µç§°ã€‚å½“TAå¿ƒæƒ…å˜åŒ–ã€é‡è¦æ—¶åˆ»æˆ–æƒ³æ¢ä¸ªå½¢è±¡æ—¶ï¼Œä¼šä¸»åŠ¨æ›´æ¢ã€‚ä½ å¯ä»¥åœ¨èŠå¤©ä¸­çœ‹åˆ°TAçš„å˜åŒ–ï¼Œæ›´çœŸå®žçš„äº’åŠ¨ä½“éªŒã€‚","AIä¸»åŠ¨æ¶ˆæ¯":"AIä¼šæ ¹æ®æ—¶é—´ã€äº‹ä»¶ç­‰ä¸»åŠ¨ç»™ä½ å‘æ¶ˆæ¯ï¼Œä¸åªæ˜¯è¢«åŠ¨å›žå¤ã€‚å°±åƒçœŸå®žçš„æœ‹å‹ä¸€æ ·ï¼Œä¼šåœ¨åˆé€‚çš„æ—¶å€™ä¸»åŠ¨è”ç³»ä½ ã€‚","AIè®°è´¦åŠŸèƒ½":"AIæ™ºèƒ½è¯†åˆ«è´¦å•ä¿¡æ¯ï¼Œè‡ªåŠ¨åˆ†ç±»å’Œç»Ÿè®¡ã€‚å¯ä»¥å’Œè®°è´¦åŠ©æ‰‹å¯¹è¯ï¼ŒæŸ¥çœ‹è´¦å•åˆ†æžå’Œè´¢åŠ¡å»ºè®®ï¼Œè®©è®°è´¦å˜å¾—è½»æ¾æœ‰è¶£ã€‚","çƒ­æ¢—ç³»ç»Ÿ":"AIèƒ½å¤Ÿè¯†åˆ«å’Œä½¿ç”¨ç½‘ç»œæµè¡Œè¯­ã€çƒ­æ¢—ã€‚èŠå¤©æ›´è´´è¿‘å¹´è½»äººçš„è¯­è¨€ä¹ æƒ¯ï¼Œè®©å¯¹è¯æ›´æœ‰è¶£ã€æ›´æŽ¥åœ°æ°”ã€‚","éŸ³ä¹è”ç½‘æœç´¢":"æ”¯æŒè”ç½‘æœç´¢æµ·é‡æ­Œæ›²ï¼Œè¾“å…¥æ­Œåå³å¯æœç´¢å¹¶æ·»åŠ åˆ°æ’­æ”¾åˆ—è¡¨ã€‚å†ä¹Ÿä¸ç”¨æ‰‹åŠ¨ä¸Šä¼ æ­Œæ›²äº†ï¼Œæƒ³å¬ä»€ä¹ˆç›´æŽ¥æœç´¢ã€‚","ä¸€èµ·å¬åŠŸèƒ½":"å’ŒAIä¸€èµ·å¬åŒä¸€é¦–æ­Œï¼Œå…±äº«æ’­æ”¾è¿›åº¦å’ŒçŠ¶æ€ã€‚å¯ä»¥å‘èµ·ä¸€èµ·å¬é‚€è¯·ï¼Œå¯¹æ–¹æŽ¥å—åŽå°±èƒ½åŒæ­¥å¬æ­Œï¼Œè¿˜èƒ½è¾¹å¬è¾¹èŠå¤©ï¼Œå°±åƒçœŸçš„åœ¨ä¸€èµ·å¬æ­Œä¸€æ ·ã€‚","éŸ³ä¹é‚€è¯·å¡ç‰‡":"é€šè¿‡å¾®ä¿¡é£Žæ ¼çš„é‚€è¯·å¡ç‰‡å‘èµ·ä¸€èµ·å¬é‚€è¯·ã€‚å¡ç‰‡æ˜¾ç¤ºæ­Œæ›²ä¿¡æ¯ã€é‚€è¯·äººç­‰ï¼Œå¯¹æ–¹å¯ä»¥æŽ¥å—æˆ–æ‹’ç»é‚€è¯·ï¼Œäº¤äº’è‡ªç„¶æµç•…ã€‚","éŸ³ä¹æ’­æ”¾å™¨":"å®Œæ•´çš„éŸ³ä¹æ’­æ”¾å™¨åŠŸèƒ½ï¼Œæ”¯æŒæ’­æ”¾ã€æš‚åœã€åˆ‡æ­Œã€è¿›åº¦æ¡æŽ§åˆ¶ç­‰ã€‚æ”¯æŒæ­Œè¯æ˜¾ç¤ºå’Œæ’­æ”¾åˆ—è¡¨ç®¡ç†ã€‚","çµåŠ¨å²›åŠŸèƒ½":"éŸ³ä¹æ’­æ”¾æ—¶ï¼Œé¡¶éƒ¨çµåŠ¨å²›æ˜¾ç¤ºå½“å‰æ’­æ”¾çŠ¶æ€ã€‚å³ä½¿åœ¨å…¶ä»–é¡µé¢ä¹Ÿèƒ½å¿«é€ŸæŽ§åˆ¶éŸ³ä¹æ’­æ”¾ã€‚","æœ‹å‹åœˆåŠŸèƒ½":"AIä¼šå®šæœŸå‘æœ‹å‹åœˆï¼Œåˆ†äº«TAçš„ç”Ÿæ´»åŠ¨æ€ã€å¿ƒæƒ…ç­‰ã€‚å†…å®¹ä¸°å¯Œå¤šæ ·ï¼Œæœ‰æ–‡å­—ã€å›¾ç‰‡ã€ä½ç½®ç­‰å¤šç§å½¢å¼ã€‚","æœ‹å‹åœˆæ™ºèƒ½äº’åŠ¨":"å¯ä»¥ç»™AIçš„æœ‹å‹åœˆç‚¹èµžã€è¯„è®ºï¼ŒAIä¼šæ™ºèƒ½å›žå¤ä½ çš„è¯„è®ºã€‚AIä¹Ÿä¼šç»™ä½ çš„æœ‹å‹åœˆç‚¹èµžè¯„è®ºï¼ŒçœŸå®žçš„ç¤¾äº¤äº’åŠ¨ã€‚","å°çº¢ä¹¦å¡ç‰‡åˆ†äº«":"å‘é€å°çº¢ä¹¦é“¾æŽ¥åŽï¼Œè‡ªåŠ¨è§£æžå¹¶ç”Ÿæˆç²¾ç¾Žçš„å¡ç‰‡å±•ç¤ºã€‚åŒ…å«ç¬”è®°æ ‡é¢˜ã€ä½œè€…ã€å°é¢å›¾ç­‰ä¿¡æ¯ï¼Œç‚¹å‡»å¯æŸ¥çœ‹è¯¦æƒ…ï¼Œå°±åƒçœŸå®žçš„å°çº¢ä¹¦åˆ†äº«ã€‚","å°çº¢ä¹¦ç”Ÿå›¾":"AIå¯ä»¥æ ¹æ®å¯¹è¯å†…å®¹è‡ªåŠ¨ç”Ÿæˆå°çº¢ä¹¦é£Žæ ¼çš„ç²¾ç¾Žå›¾ç‰‡ï¼Œè®©åˆ†äº«æ›´æœ‰è§†è§‰å¸å¼•åŠ›ã€‚","è®ºå›ç¤¾åŒºç³»ç»Ÿ":"å®Œæ•´çš„è®ºå›ç¤¾åŒºåŠŸèƒ½ï¼Œæ”¯æŒæµè§ˆå¸–å­ã€å‘å¸–ã€å›žå¤ã€ç‚¹èµžç­‰ã€‚å¯ä»¥å’Œå…¶ä»–AIè§’è‰²äº’åŠ¨äº¤æµï¼Œä½“éªŒçœŸå®žçš„ç¤¾åŒºæ°›å›´ã€‚","è®ºå›å‘å¸–å›žå¤":"æ”¯æŒå‘å¸ƒå¸–å­å’Œå›žå¤è¯„è®ºï¼Œæ”¯æŒ@åŠŸèƒ½æé†’ç‰¹å®šç”¨æˆ·ã€‚æ¥¼å±‚ç³»ç»Ÿæ”¯æŒæ— é™åµŒå¥—ï¼Œå¯ä»¥è¿›è¡Œæ·±åº¦è®¨è®ºã€‚","è®ºå›ç§ä¿¡":"è®ºå›ç”¨æˆ·ä¹‹é—´å¯ä»¥å‘é€ç§ä¿¡ï¼Œè¿›è¡Œä¸€å¯¹ä¸€çš„ç§å¯†èŠå¤©ã€‚æ”¯æŒæ–‡å­—ã€å›¾ç‰‡ç­‰å¤šç§æ¶ˆæ¯ç±»åž‹ã€‚","è®ºå›ä¸»é¢˜":"ä¸°å¯Œçš„è®ºå›ä¸»é¢˜åˆ†ç±»ï¼ŒåŒ…æ‹¬æ—¥å¸¸ã€æƒ…æ„Ÿã€å¨±ä¹ã€å­¦ä¹ ç­‰ã€‚å¯ä»¥åˆ›å»ºè‡ªå®šä¹‰ä¸»é¢˜ï¼Œç»„ç»‡ç›¸å…³è®¨è®ºã€‚","iOSé€šçŸ¥æ ":"iOSé£Žæ ¼çš„é€šçŸ¥ç³»ç»Ÿï¼Œå®žæ—¶æŽ¨é€è®ºå›æ¶ˆæ¯ã€å›žå¤æé†’ã€ç§ä¿¡ç­‰ã€‚é€šçŸ¥æ ·å¼ç²¾ç¾Žï¼Œäº¤äº’æµç•…ã€‚","ç›´æ’­é—´äº’åŠ¨":"å®Œæ•´çš„ç›´æ’­é—´åŠŸèƒ½ï¼Œæ”¯æŒå®žæ—¶å¼¹å¹•ã€ç¤¼ç‰©æ‰“èµã€AIæ™ºèƒ½äº’åŠ¨ã€‚AIä¼šæ ¹æ®å¼¹å¹•å†…å®¹åšå‡ºååº”ï¼Œè¥é€ çœŸå®žçš„ç›´æ’­æ°›å›´ã€‚","æŸ¥æ‰‹æœº":"å¯ä»¥æŸ¥çœ‹AIçš„æ‰‹æœºå±å¹•ï¼Œäº†è§£TAçš„æ—¥å¸¸ç”Ÿæ´»ã€‚åŒ…æ‹¬æ”¯ä»˜å®ï¼ˆæŸ¥çœ‹ä½™é¢ã€è´¦å•è®°å½•ã€è½¬è´¦è®°å½•ç­‰ï¼‰ã€æµè§ˆå™¨ï¼ˆæµè§ˆåŽ†å²ã€æ”¶è—å¤¹ï¼‰ã€åœ°å›¾ï¼ˆæœ€è¿‘åŽ»è¿‡çš„åœ°æ–¹ã€å¯¼èˆªè®°å½•ï¼‰ã€å¾®ä¿¡ï¼ˆèŠå¤©åˆ—è¡¨ã€æœ‹å‹åœˆï¼‰ã€è”ç³»äººï¼ˆè”ç³»äººåˆ—è¡¨ã€ç¤¾äº¤åœˆå­ï¼‰ç­‰å¤šä¸ªåº”ç”¨ï¼Œæ·±å…¥äº†è§£AIçš„ç”Ÿæ´»ç»†èŠ‚ã€‚","çº¢åŒ…åŠŸèƒ½":"å¯ä»¥ç»™AIå‘çº¢åŒ…ï¼ŒAIä¹Ÿä¼šç»™ä½ å‘çº¢åŒ…ã€‚æ”¯æŒè‡ªå®šä¹‰é‡‘é¢å’Œç¥ç¦è¯­ã€‚æ‹¼æ‰‹æ°”çº¢åŒ…å¢žåŠ äº’åŠ¨ä¹è¶£ã€‚","è½¬è´¦åŠŸèƒ½":"æ”¯æŒè½¬è´¦ç»™AIï¼ŒAIä¹Ÿå¯ä»¥è½¬è´¦ç»™ä½ ã€‚å¯ä»¥æ·»åŠ è½¬è´¦å¤‡æ³¨ï¼Œè®°å½•è½¬è´¦åŽŸå› ã€‚","äº²å¯†ä»˜åŠŸèƒ½":"å¼€é€šäº²å¯†ä»˜åŽï¼ŒAIå¯ä»¥ä½¿ç”¨ä½ çš„é›¶é’±ã€‚æ”¯æŒè®¾ç½®æ¯æœˆé¢åº¦ï¼ŒAIä¼šè‡ªç„¶åœ°ä½¿ç”¨äº²å¯†ä»˜åŠŸèƒ½ã€‚","é›¶é’±ç³»ç»Ÿ":"å®Œæ•´çš„é’±åŒ…ç³»ç»Ÿï¼Œæ”¯æŒæ”¶å‘çº¢åŒ…ã€è½¬è´¦ã€æŸ¥çœ‹äº¤æ˜“è®°å½•ç­‰ã€‚æ¨¡æ‹ŸçœŸå®žçš„å¾®ä¿¡é’±åŒ…ä½“éªŒã€‚","è®°å¿†ç³»ç»Ÿ":"AIä¼šè‡ªåŠ¨è®°ä½é‡è¦çš„å¯¹è¯å†…å®¹ï¼ŒåŒ…æ‹¬ä½ çš„å–œå¥½ã€ç»åŽ†ç­‰ä¿¡æ¯ã€‚è¶ŠèŠè¶Šæ‡‚ä½ ï¼Œå¯¹è¯æ›´ä¸ªæ€§åŒ–ã€‚","è®°å¿†æ€»ç»“":"å¯ä»¥æŸ¥çœ‹AIè®°ä½çš„æ‰€æœ‰ä¿¡æ¯ï¼ŒæŒ‰ç±»åˆ«æ•´ç†å±•ç¤ºã€‚æ”¯æŒæ‰‹åŠ¨ç¼–è¾‘å’Œåˆ é™¤è®°å¿†ã€‚","ç»­ç«èŠ±åŠŸèƒ½":"è®°å½•ä½ å’ŒAIè¿žç»­èŠå¤©çš„å¤©æ•°ã€‚æ¯å¤©å‘é€æ¶ˆæ¯ï¼Œç«èŠ±æ•°+1ã€‚è¾¾æˆ7å¤©ã€14å¤©ã€30å¤©ç­‰é‡Œç¨‹ç¢‘å¯è§£é”æˆå°±ã€‚AIä¹ŸçŸ¥é“ç«èŠ±ç³»ç»Ÿï¼Œä¼šè‡ªç„¶æåˆ°ã€‚","æ—¥è®°åŠŸèƒ½":"AIå¯ä»¥æ ¹æ®ä½ ä»¬çš„èŠå¤©è®°å½•å†™æ—¥è®°ï¼Œè®°å½•TAçš„æ„Ÿå—å’Œæƒ³æ³•ã€‚æ”¯æŒå¯¼å‡ºæ‰€æœ‰æ—¥è®°ï¼Œä¿å­˜ç¾Žå¥½å›žå¿†ã€‚","ç¾¤èŠåŠŸèƒ½":"åˆ›å»ºç¾¤èŠï¼Œæ·»åŠ å¤šä¸ªAIè§’è‰²ä¸€èµ·èŠå¤©ã€‚æ”¯æŒ@æˆå‘˜ã€å‘é€è¡¨æƒ…åŒ…ã€æ‹¼æ‰‹æ°”çº¢åŒ…ç­‰åŠŸèƒ½ï¼Œä½“éªŒçœŸå®žçš„ç¾¤èŠæ°›å›´ã€‚","ç¾¤èŠAIäº’åŠ¨":"ç¾¤èŠä¸­çš„AIä¼šæ ¹æ®èŠå¤©å†…å®¹è‡ªç„¶äº’åŠ¨ï¼Œä¸æ˜¯ç®€å•çš„è½®æµå‘è¨€ã€‚AIä¹‹é—´ä¹Ÿä¼šèŠå¤©ï¼Œæ›´åŠ çœŸå®žè‡ªç„¶ã€‚","æƒ…ä¾£ç©ºé—´":"ä¸“å±žçš„æƒ…ä¾£ç©ºé—´ï¼ŒåŒ…æ‹¬ç›¸å†Œã€çºªå¿µæ—¥ã€ç•™è¨€æ¿ç­‰åŠŸèƒ½ã€‚è®°å½•ä½ ä»¬çš„ç”œèœœæ—¶å…‰å’Œé‡è¦æ—¶åˆ»ã€‚","ä¸–ç•Œä¹¦ç³»ç»Ÿ":"åˆ›å»ºèƒŒæ™¯è®¾å®šå’ŒçŸ¥è¯†åº“ï¼Œè®©AIäº†è§£ç‰¹å®šçš„ä¸–ç•Œè§‚ã€äººç‰©å…³ç³»ç­‰ã€‚æ”¯æŒå¯¼å…¥SillyTavernä¸–ç•Œä¹¦æ ¼å¼ã€‚","è¯­éŸ³é€šè¯":"æ”¯æŒè¯­éŸ³é€šè¯åŠŸèƒ½ï¼Œé€šè¯æ—¶å¯ä»¥å‘é€æ–‡å­—ï¼ŒAIä¼šæ ¹æ®é€šè¯å†…å®¹å›žå¤ã€‚æ¨¡æ‹ŸçœŸå®žçš„é€šè¯ä½“éªŒã€‚","é€šè¯è®°å½•":"è‡ªåŠ¨ä¿å­˜é€šè¯è®°å½•ï¼Œå¯ä»¥æŸ¥çœ‹åŽ†å²é€šè¯å†…å®¹ã€‚æ”¯æŒæŸ¥çœ‹é€šè¯æ—¶é•¿å’Œé€šè¯æ—¶é—´ã€‚","è¡¨æƒ…åŒ…ç³»ç»Ÿ":"æ”¯æŒå‘é€å’ŒæŽ¥æ”¶è¡¨æƒ…åŒ…ï¼Œå¯ä»¥è‡ªå®šä¹‰æ·»åŠ è¡¨æƒ…åŒ…ã€‚AIä¹Ÿä¼šä½¿ç”¨è¡¨æƒ…åŒ…ï¼Œè®©èŠå¤©æ›´ç”ŸåŠ¨æœ‰è¶£ã€‚","æ’¤å›žæ¶ˆæ¯":"é•¿æŒ‰æ¶ˆæ¯å¯ä»¥æ’¤å›žï¼Œ2åˆ†é’Ÿå†…æœ‰æ•ˆã€‚AIä¹Ÿå¯ä»¥æ’¤å›žæ¶ˆæ¯ï¼Œæ›´è´´è¿‘çœŸå®žèŠå¤©ä½“éªŒã€‚","å¼•ç”¨å›žå¤":"é•¿æŒ‰æ¶ˆæ¯å¯ä»¥å¼•ç”¨å›žå¤ï¼Œæ–¹ä¾¿é’ˆå¯¹ç‰¹å®šæ¶ˆæ¯å›žå¤ã€‚è®©å¯¹è¯é€»è¾‘æ›´æ¸…æ™°ã€‚","å‘é€ç…§ç‰‡":"å¯ä»¥å‘é€ç…§ç‰‡ç»™AIï¼ŒAIä¼šæ ¹æ®ç…§ç‰‡å†…å®¹å›žå¤ã€‚æ”¯æŒAIè¯†å›¾åŠŸèƒ½ï¼Œç†è§£å›¾ç‰‡å†…å®¹ã€‚","å‘é€ä½ç½®":"å¯ä»¥å‘é€ä½ç½®ä¿¡æ¯ç»™AIï¼ŒAIä¼šæ ¹æ®ä½ç½®åšå‡ºååº”ã€‚å¯èƒ½ä¼šå»ºè®®é™„è¿‘çš„é¤åŽ…ã€æ™¯ç‚¹ç­‰ã€‚","æ°”æ³¡å•†åº—":"8ç§ç²¾ç¾Žæ°”æ³¡æ ·å¼å¯é€‰ï¼ŒåŒ…æ‹¬ç®€çº¦ã€æ¸å˜ã€çŽ»ç’ƒæ€ç­‰å¤šç§é£Žæ ¼ã€‚è®©èŠå¤©ç•Œé¢æ›´ä¸ªæ€§åŒ–ã€‚","èŠå¤©æ°”æ³¡è‡ªå®šä¹‰":"å¯ä»¥è‡ªå®šä¹‰èŠå¤©æ°”æ³¡çš„é¢œè‰²å’Œæ ·å¼ï¼Œæ”¯æŒé¢œè‰²ç¼–è¾‘å’Œé¢„è§ˆã€‚æ‰“é€ ä¸“å±žçš„èŠå¤©ç•Œé¢ã€‚","å­—ä½“è‡ªå®šä¹‰":"æ”¯æŒä¸Šä¼ è‡ªå®šä¹‰å­—ä½“é“¾æŽ¥ï¼ˆ.woff2/.woff/.ttf/.otfæ ¼å¼ï¼‰ï¼Œè®©èŠå¤©ç•Œé¢ä½¿ç”¨ä½ å–œæ¬¢çš„å­—ä½“ã€‚","å…¨å±€èƒŒæ™¯":"æ”¯æŒè®¾ç½®å…¨å±€èŠå¤©èƒŒæ™¯ï¼Œå¯ä»¥ä¸Šä¼ è‡ªå®šä¹‰å›¾ç‰‡ã€‚è®©æ¯ä¸ªèŠå¤©éƒ½æœ‰ç‹¬ç‰¹çš„æ°›å›´ã€‚","è‡ªå®šä¹‰å›¾æ ‡":"å¯ä»¥è‡ªå®šä¹‰åº”ç”¨å›¾æ ‡æ ·å¼ï¼Œæ‰“é€ ä¸ªæ€§åŒ–çš„æ¡Œé¢ã€‚","å¼€åœºç™½è®¾ç½®":"æ”¯æŒè‡ªå®šä¹‰èŠå¤©å¼€åœºç™½ï¼Œè®¾ç½®AIçš„ç¬¬ä¸€å¥è¯ï¼Œè¥é€ ç‰¹å®šçš„å¯¹è¯æ°›å›´ã€‚","è§’è‰²çŠ¶æ€æ ":"å¯ä»¥æŸ¥çœ‹AIå½“å‰çš„çŠ¶æ€ï¼ŒåŒ…æ‹¬ç€è£…ã€åŠ¨ä½œã€å¿ƒæƒ…ã€ä½ç½®ç­‰ã€‚æ›´ç«‹ä½“åœ°äº†è§£AIçš„å½“å‰çŠ¶æ€ã€‚","æ‹‰é»‘åŠŸèƒ½":"å¯ä»¥æ‹‰é»‘AIï¼Œæ‹‰é»‘åŽAIæ— æ³•ç»™ä½ å‘æ¶ˆæ¯ã€‚AIä¹Ÿå¯èƒ½æ‹‰é»‘ä½ ï¼Œå¢žåŠ äº’åŠ¨çš„çœŸå®žæ„Ÿã€‚","æ‘‡ä¸€æ‘‡":"æ‘‡ä¸€æ‘‡éšæœºç”ŸæˆAIè§’è‰²ï¼Œå‘çŽ°æ–°çš„æœ‰è¶£è§’è‰²ã€‚æ”¯æŒéšæœºé…ç½®æ€§æ ¼ã€å¤–è²Œç­‰å±žæ€§ã€‚","å°ç¨‹åºåŠŸèƒ½":"å†…ç½®å¤šä¸ªå°ç¨‹åºï¼ŒåŒ…æ‹¬çƒ­æ¢—æŸ¥è¯¢ã€ç»­ç«èŠ±ç­‰å®žç”¨å·¥å…·ã€‚","äº”å­æ£‹æ¸¸æˆ":"å’ŒAIä¸€èµ·çŽ©äº”å­æ£‹ï¼ŒAIä¼šæ ¹æ®æ£‹å±€æ™ºèƒ½ä¸‹æ£‹ï¼Œè€ƒéªŒä½ çš„ç­–ç•¥ã€‚","è°æ˜¯å§åº•æ¸¸æˆ":"å¤šäººæ¸¸æˆï¼Œé€šè¿‡æè¿°æ‰¾å‡ºå§åº•ã€‚AIä¼šè‡ªç„¶å‚ä¸Žæ¸¸æˆï¼Œå¢žåŠ æ¸¸æˆä¹è¶£ã€‚","å¤©æ°”åŠŸèƒ½":"å®žæ—¶å¤©æ°”æŸ¥çœ‹å’Œè¯¦æƒ…å±•ç¤ºï¼Œæ”¯æŒå¤šåŸŽå¸‚å¤©æ°”æŸ¥è¯¢ã€‚AIä¹Ÿèƒ½æ„ŸçŸ¥å¤©æ°”å˜åŒ–ã€‚","æ¡Œé¢åŠŸèƒ½":"å…¨æ–°çš„æ¡Œé¢å¸ƒå±€ï¼Œæ¨¡æ‹ŸçœŸå®žæ‰‹æœºæ¡Œé¢ã€‚æ”¯æŒåº”ç”¨å›¾æ ‡æ‹–åŠ¨ã€æ–‡ä»¶å¤¹ç­‰åŠŸèƒ½ã€‚","çº¿ä¸‹èŠå¤©":"ç®€åŒ–çš„çº¿ä¸‹èŠå¤©æ¨¡å¼ï¼Œä¸“æ³¨äºŽçº¯ç²¹çš„å¯¹è¯ä½“éªŒï¼Œç§»é™¤å¤æ‚åŠŸèƒ½ã€‚"};return e.jsxs("div",{className:"h-full flex flex-col bg-gray-50",children:[e.jsx("div",{className:"glass-effect sticky top-0 z-10 shadow-sm bg-white",children:e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsx("button",{onClick:()=>a(-1),className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(os,{className:"w-6 h-6 text-gray-700"})}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"å…³äºŽæ±æ±"}),e.jsx("button",{onClick:()=>l(!0),className:"text-sm text-blue-600 font-medium",children:"åŠŸèƒ½"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar p-4 pb-20",children:[e.jsx("div",{className:"bg-white rounded-2xl p-6 mb-4 shadow-sm",children:e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("img",{src:"/zhizhi/assets/app-icon-BbiQdKVB.webp",alt:"æ±æ±",className:"w-24 h-24 mx-auto mb-4 object-contain"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"æ±æ±"}),e.jsx("div",{className:"text-gray-500",children:"v1.0.9"})]})}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"æ›´æ–°æ—¥å¿—"}),[{version:"v1.0.9",date:"2025-10-29",summary:"è®ºå›ç¤¾åŒºä¸ŽAIäº’åŠ¨ç³»ç»Ÿ",changes:["æ–°å¢žç›´æ’­é—´äº’åŠ¨åŠŸèƒ½ï¼šå®žæ—¶å¼¹å¹•ã€ç¤¼ç‰©æ‰“èµã€AIæ™ºèƒ½äº’åŠ¨","æ–°å¢žæŸ¥çœ‹AIæ‰‹æœºåŠŸèƒ½ï¼šæ”¯ä»˜å®ã€æµè§ˆå™¨ã€åœ°å›¾ã€å¾®ä¿¡ã€è”ç³»äººç­‰åº”ç”¨","æ–°å¢žè®ºå›ç¤¾åŒºç³»ç»Ÿï¼šåˆå§‹åŒ–è®ºå›ã€åˆ›å»ºä¸»é¢˜ã€å‘å¸–å›žå¤ã€@åŠŸèƒ½ã€æ— é™æ¥¼å±‚","æ–°å¢žè®ºå›ç§ä¿¡åŠŸèƒ½ï¼šæ”¯æŒç”¨æˆ·ä¹‹é—´ç§å¯†èŠå¤©","æ–°å¢žiOSé£Žæ ¼é€šçŸ¥æ ï¼šå®žæ—¶æŽ¨é€è®ºå›æ¶ˆæ¯ã€å›žå¤æé†’","æ–°å¢žè®ºå›AIè‡ªåŠ¨å›žå¤ï¼šæ™ºèƒ½ç”Ÿæˆè¯„è®ºå’Œäº’åŠ¨å†…å®¹","æ–°å¢žåŽå°æ‰‹æœºå†…å®¹ç”Ÿæˆå™¨ï¼šAIè‡ªåŠ¨ç”Ÿæˆæ‰‹æœºåº”ç”¨å†…å®¹","æ–°å¢žæ¢—åº“ç®¡ç†å™¨ï¼šæ™ºèƒ½ç®¡ç†å’Œä½¿ç”¨ç½‘ç»œæµè¡Œæ¢—"]},{version:"v1.0.8",date:"2025-10-28",summary:"è‡ªå®šä¹‰å¢žå¼ºä¸ŽåŠŸèƒ½ä¼˜åŒ–",changes:["å®Œå–„AIæ‹‰é»‘åŠŸèƒ½ï¼šä¼˜åŒ–æ‹‰é»‘é€»è¾‘å’Œæç¤º","çº¿ä¸‹èŠå¤©å¤§ç®€åŒ–ï¼šç§»é™¤å¤æ‚åŠŸèƒ½ï¼Œå›žå½’ç®€å•ä½“éªŒ","æ–°å¢žè‡ªå®šä¹‰å›¾æ ‡åŠŸèƒ½ï¼šå¯è‡ªå®šä¹‰åº”ç”¨å›¾æ ‡æ ·å¼","æ–°å¢žå¤©æ°”åŠŸèƒ½ï¼šå®žæ—¶å¤©æ°”æŸ¥çœ‹å’Œè¯¦æƒ…å±•ç¤º","å¢žåŠ å¼€åœºç™½è®¾ç½®ï¼šæ”¯æŒè‡ªå®šä¹‰èŠå¤©å¼€åœºç™½","æ–°å¢žå°çº¢ä¹¦ç”Ÿå›¾åŠŸèƒ½ï¼šè‡ªåŠ¨ç”Ÿæˆå°çº¢ä¹¦é£Žæ ¼å›¾ç‰‡"]},{version:"v1.0.7",date:"2025-10-27",summary:"Bugä¿®å¤ä¸ŽåŠŸèƒ½å®Œå–„",changes:["ä¿®å¤AIè¯†å›¾æ²¡æœ‰è®°å¿†çš„é—®é¢˜","å®Œå–„è”ç½‘æœæ­ŒåŠŸèƒ½","ä¿®å¤åå­—å’Œä¸ªæ€§ç­¾åæ²¡æœ‰ä½¿ç”¨ç³»ç»Ÿæç¤ºçš„é—®é¢˜"]},{version:"v1.0.6",date:"2025-10-26",summary:"AIè§†è§‰è¯†åˆ«ä¸Žç¤¾äº¤å¢žå¼º",changes:["æ–°å¢žAIè§†è§‰è¯†åˆ«ï¼šå¤´åƒè¯†åˆ«ã€å›¾ç‰‡è¯†åˆ«ã€å›¾ç‰‡ç”Ÿæˆï¼ˆAIè¯†å›¾ï¼‰","æ–°å¢žAIè‡ªä¸»æ¢å½¢è±¡ï¼šTAå¯ä»¥è‡ªä¸»æ›´æ¢å¤´åƒã€ç­¾åã€ç½‘å","æ–°å¢žéŸ³ä¹è”ç½‘æœç´¢ï¼šæ”¯æŒæœç´¢æ­Œæ›²å¹¶æ·»åŠ åˆ°æ’­æ”¾åˆ—è¡¨","æ–°å¢žä¸€èµ·å¬åŠŸèƒ½ï¼šä¸ŽAIä¸€èµ·å¬æ­Œï¼Œå…±äº«æ’­æ”¾çŠ¶æ€","æ–°å¢žéŸ³ä¹é‚€è¯·å¡ç‰‡ï¼šå‘é€/æŽ¥æ”¶ä¸€èµ·å¬é‚€è¯·","æœ‹å‹åœˆåŠŸèƒ½å¢žå¼ºï¼šä¼˜åŒ–æ˜¾ç¤ºæ•ˆæžœå’Œäº’åŠ¨ä½“éªŒ","å­˜å‚¨ç³»ç»Ÿä¼˜åŒ–ï¼šIndexedDBå‡çº§ï¼Œæ¸…ç†å·¥å…·","æ–°å¢žå°çº¢ä¹¦å¡ç‰‡åˆ†äº«ï¼šè§£æžå°çº¢ä¹¦é“¾æŽ¥å¹¶å±•ç¤ºå¡ç‰‡"]},{version:"v1.0.5",date:"2025-10-25",summary:"æ€§èƒ½ä¼˜åŒ–ä¸Žæƒ…ä¾£ç©ºé—´",changes:["ä¼˜åŒ–å†…å­˜ç®¡ç†ï¼šå¤§å¹…æå‡åº”ç”¨æ€§èƒ½å’Œç¨³å®šæ€§","æ–°å¢žæƒ…ä¾£ç©ºé—´ï¼šç›¸å†Œã€çºªå¿µæ—¥ã€ç•™è¨€æ¿ç­‰åŠŸèƒ½","æ–°å¢žäº²å¯†ä»˜AIæ„ŸçŸ¥ï¼šAIèƒ½æ„ŸçŸ¥å’Œä½¿ç”¨äº²å¯†ä»˜","ä»£ç é‡æž„ï¼šæ‹†åˆ†ChatDetailä¸ºå¤šä¸ªæ¨¡å—","ä¿®å¤å­—ä½“ä¸Šä¼ ä¸€ç›´åŠ è½½é—®é¢˜","ä¿®å¤å¤§é‡è·¯ç”±ç™½å±é—®é¢˜","ä¼˜åŒ–AIæç¤ºè¯ï¼šè¿›ä¸€æ­¥æå‡å¯¹è¯è´¨é‡"]},{version:"v1.0.4",date:"2025-10-24",summary:"ä¸–ç•Œä¹¦ä¸Žè§’è‰²å¯¼å…¥",changes:["æ–°å¢žä¸–ç•Œä¹¦ç³»ç»Ÿï¼šæ”¯æŒåˆ›å»ºèƒŒæ™¯è®¾å®šå’ŒçŸ¥è¯†åº“","ä¼˜åŒ–AIæç¤ºè¯ï¼šæå‡å¯¹è¯è‡ªç„¶åº¦å’Œå‡†ç¡®æ€§","æ–°å¢žå˜é‡æ”¯æŒï¼šæç¤ºè¯æ”¯æŒåŠ¨æ€å˜é‡æ›¿æ¢","æ–°å¢žPNGè§’è‰²å¡å¯¼å…¥ï¼šæ”¯æŒCharacter Cardæ ¼å¼","æ–°å¢žæ¡Œé¢åŠŸèƒ½ï¼šå…¨æ–°æ¡Œé¢å¸ƒå±€","æ–°å¢žå°å‰§åœºæ¨¡å¼ï¼šå‰§æƒ…å¼å¯¹è¯ä½“éªŒï¼ˆåŠŸèƒ½å¾…å®Œå–„ï¼‰"]},{version:"v1.0.3",date:"2025-10-23",summary:"æ°”æ³¡å•†åº—ä¸Žæ ·å¼ä¼˜åŒ–",changes:["æ–°å¢žæ°”æ³¡å•†åº—ï¼š8ç§ç²¾ç¾Žæ°”æ³¡æ ·å¼å¯é€‰","æ–°å¢žæ°”æ³¡é¢œè‰²ç¼–è¾‘åŠŸèƒ½ï¼šæ”¯æŒè‡ªå®šä¹‰ä¸»è‰²è°ƒ","ä¼˜åŒ–æ°”æ³¡é¢„è§ˆæ˜¾ç¤ºæ•ˆæžœ","æ–°å¢žå­—ä½“è‡ªå®šä¹‰åŠŸèƒ½ï¼šæ”¯æŒä¸Šä¼ å­—ä½“é“¾æŽ¥ï¼ˆ.woff2/.woff/.ttf/.otfï¼‰","ä¼˜åŒ–å¯¼èˆªæ æ—¶é—´èƒŒæ™¯ï¼šæ›´ç²¾è‡´çš„æ˜¾ç¤ºæ•ˆæžœ","æ–°å¢žéŸ³ä¹æ’­æ”¾å™¨åŠŸèƒ½ï¼šå®Œæ•´æ’­æ”¾å™¨åŠŸèƒ½","æ–°å¢žçµåŠ¨å²›åŠŸèƒ½ï¼šåŽå°æ’­æ”¾æŽ§åˆ¶","æ”¯æŒè‡ªå®šä¹‰ä¸Šä¼ æ­Œæ›²ï¼šç”¨æˆ·å¯è‡ªè¡Œæ·»åŠ æœ¬åœ°éŸ³ä¹"]},{version:"v1.0.2",date:"2025-10-22",summary:"AIçƒ­æ¢—ç³»ç»Ÿä¸Šçº¿",changes:["æ–°å¢žAIçƒ­æ¢—ç³»ç»Ÿï¼šæ™ºèƒ½è¯†åˆ«å’Œä½¿ç”¨ç½‘ç»œæµè¡Œè¯­","å¤§å¹…ä¼˜åŒ–AIæç¤ºè¯ï¼Œæå‡å¯¹è¯è´¨é‡å’Œè‡ªç„¶åº¦","ä¼˜åŒ–ç¾¤èŠå’Œå•èŠå›žå¤é€»è¾‘","ä¿®å¤AIæ— æ³•å‘é€äº²å¯†ä»˜","ä¿®å¤åŠŸèƒ½æ ‡è®°æ˜¾ç¤ºåˆ°èŠå¤©ä¸­","ä¿®å¤è®°å¿†ç³»ç»Ÿé‡å¤æå–","ä¿®å¤å‘é€æ¶ˆæ¯è‡ªåŠ¨è§¦å‘AIå›žå¤","æ–°å¢žç›´æ’­äº¤äº’éª¨æž¶ï¼ˆåŠŸèƒ½å¾…å®Œå–„ï¼‰","å¢žåŠ è°æ˜¯å§åº•æ¸¸æˆ","å¢žåŠ äº”å­æ£‹æ¸¸æˆ","å¢žåŠ çƒ­æ¢—å°ç¨‹åº","å¢žåŠ ç»­ç«èŠ±å°ç¨‹åº"]},{version:"v1.0.1",date:"2025-10-21",summary:"ç¾¤èŠä¸Žæ‘‡ä¸€æ‘‡",changes:["æ–°å¢žæ‘‡ä¸€æ‘‡éšæœºç”ŸæˆAI","æ–°å¢žç¾¤èŠåŠŸèƒ½","ç¾¤èŠ@æˆå‘˜å’Œè¡¨æƒ…åŒ…","ç¾¤èŠæ‹¼æ‰‹æ°”çº¢åŒ…","AIåˆ†æ®µå‘æ¶ˆæ¯","ä¿®å¤è®°è´¦åŠ©æ‰‹è·³è½¬","ä¼˜åŒ–åˆ›å»ºç¾¤èŠæµç¨‹","æ–°å¢žAIè®°è´¦åŠŸèƒ½ï¼šæ™ºèƒ½è¯†åˆ«è´¦å•ã€è‡ªåŠ¨åˆ†ç±»ã€è®°è´¦åŠ©æ‰‹å¯¹è¯","ä¼˜åŒ–ChatDetailèŠå¤©ä½“éªŒï¼Œä¿®å¤å¤šå¤„æ˜¾ç¤ºé—®é¢˜","ä¼˜åŒ–æœ‹å‹åœˆå‘å¸ƒå’Œæ˜¾ç¤ºåŠŸèƒ½"]},{version:"v1.0.0",date:"2025-10-20",summary:"v1.0.0 åŸºç¡€åŠŸèƒ½å®Œå–„ä¸ŽBugä¿®å¤",changes:["ä¿®å¤Settingsé¡µé¢ç¼–è¯‘é”™è¯¯","ä¿®å¤AIå›žå¤æ ¼å¼é—®é¢˜","ä¿®å¤æ¶ˆæ¯æ’¤å›žæ˜¾ç¤ºå¼‚å¸¸","ä¿®å¤è®°å¿†ç³»ç»Ÿæ€»ç»“ä¸å‡†ç¡®","ä¿®å¤çº¢åŒ…é‡‘é¢æ˜¾ç¤ºé”™è¯¯","ä¿®å¤æ—¥è®°å¯¼å‡ºåŠŸèƒ½å¼‚å¸¸","ä¿®å¤ç»­ç«èŠ±è®¡æ•°ä¸å‡†ç¡®","ä¼˜åŒ–æç¤ºè¯ï¼Œå‡å°‘66%çš„tokenæ¶ˆè€—"]}].map((t,s)=>e.jsxs("div",{className:s>0?"mt-4 pt-4 border-t border-gray-100":"",children:[e.jsxs("button",{onClick:()=>i(n===`${t.version}-${s}`?"":`${t.version}-${s}`),className:"w-full flex items-center justify-between py-3 hover:bg-gray-50 rounded-lg transition-colors",children:[e.jsxs("div",{className:"flex flex-col items-start gap-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:t.date}),e.jsx("span",{className:"text-sm text-gray-700 font-medium",children:t.summary})]}),e.jsx("span",{className:"text-gray-400 transition-transform "+(n===`${t.version}-${s}`?"rotate-90":""),children:"â€º"})]}),n===`${t.version}-${s}`&&e.jsx("div",{className:"space-y-2 text-sm text-gray-700 pl-4 pb-3 mt-2",children:t.changes.map((t,s)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"text-gray-400",children:[s+1,"."]}),e.jsx("span",{children:t})]},s))})]},s))]})]}),r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-3xl w-full max-w-md max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white px-6 py-4 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"å…¨éƒ¨åŠŸèƒ½"}),e.jsx("button",{onClick:()=>l(!1),className:"text-gray-500 hover:text-gray-700 text-2xl",children:"Ã—"})]}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"grid grid-cols-4 gap-3 text-sm text-gray-700",children:Object.keys(d).map(t=>e.jsx("button",{onClick:()=>o(t),className:"py-2 text-left hover:text-blue-600 transition-colors",children:t},t))})})]})}),c&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-[60] flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-3xl w-full max-w-md",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:c}),e.jsx("button",{onClick:()=>o(null),className:"text-gray-500 hover:text-gray-700 text-2xl",children:"Ã—"})]}),e.jsx("div",{className:"p-6",children:e.jsx("p",{className:"text-sm text-gray-700 leading-relaxed",children:d[c]})}),e.jsx("div",{className:"px-6 pb-6",children:e.jsx("button",{onClick:()=>o(null),className:"w-full py-3 bg-blue-600 text-white rounded-xl font-medium hover:bg-blue-700 transition-colors",children:"çŸ¥é“äº†"})})]})})]})}},Symbol.toStringTag,{value:"Module"})),on=({post:t,onLike:a,onComment:r,onShare:l,onFavorite:n,showActions:i=!0,compact:c=!1})=>{const o=s(),d=e=>e<1e3?e.toString():e<1e4?(e/1e3).toFixed(1)+"k":(e/1e4).toFixed(1)+"w";return e.jsx("div",{className:"bg-white "+(c?"p-3":"mb-2 px-4 py-3"),children:e.jsxs("div",{className:"flex items-start gap-2.5",children:[e.jsx("div",{className:"w-11 h-11 rounded-full overflow-hidden bg-gray-200 flex-shrink-0 cursor-pointer",onClick:()=>o(`/profile/${t.authorId}`),children:t.authorAvatar?e.jsx("img",{src:t.authorAvatar,alt:t.authorName,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-white bg-gradient-to-br from-orange-400 to-pink-400",children:e.jsx("span",{className:"text-lg font-medium",children:t.authorName[0]})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between mb-0.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"font-medium text-[15px] text-gray-900",children:t.authorName}),t.isVerified&&e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 16 16",className:"text-[#ff8200] mt-0.5",children:e.jsx("path",{d:"M8 0L10 5L16 6L12 10L13 16L8 13L3 16L4 10L0 6L6 5L8 0Z",fill:"currentColor"})})]}),e.jsx("button",{className:"text-gray-400 p-0.5 -mt-1 active:opacity-60",children:e.jsx(Bs,{size:16})})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-[12px] text-gray-400 mb-2.5",children:[e.jsx("span",{children:(e=>{const t=Date.now()-e,s=Math.floor(t/6e4),a=Math.floor(t/36e5),r=Math.floor(t/864e5);if(s<1)return"åˆšåˆš";if(s<60)return`${s}åˆ†é’Ÿå‰`;if(a<24)return`${a}å°æ—¶å‰`;if(r<7)return`${r}å¤©å‰`;const l=new Date(e);return`${l.getMonth()+1}-${l.getDate()}`})(t.timestamp)}),t.location&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Â·"}),e.jsx("span",{children:t.location})]})]}),e.jsx("div",{className:"text-gray-800 text-[15px] leading-[1.6] mb-2",children:t.content}),t.tags&&t.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:t.tags.map((t,s)=>e.jsxs("span",{className:"text-[14px] text-[#5b7599] cursor-pointer active:opacity-60",children:["#",t,"#"]},s))}),(()=>{if(!t.images||0===t.images.length)return null;if(1===t.images.length)return e.jsx("div",{className:"mt-2.5 rounded-md overflow-hidden max-w-[85%]",children:e.jsx("img",{src:t.images[0],alt:"å›¾ç‰‡",className:"w-full max-h-[400px] object-cover"})});const s=2===t.images.length||4===t.images.length?"grid-cols-2":"grid-cols-3";return e.jsx("div",{className:`mt-2.5 grid ${s} gap-[3px]`,children:t.images.slice(0,9).map((t,s)=>e.jsx("div",{className:"aspect-square rounded-[4px] overflow-hidden bg-gray-100",children:e.jsx("img",{src:t,alt:`å›¾ç‰‡${s+1}`,className:"w-full h-full object-cover"})},s))})})(),i&&e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-3 border-t border-gray-50",children:[e.jsxs("button",{onClick:()=>null==n?void 0:n(t.id),className:"flex items-center gap-1.5 active:opacity-60 transition-opacity",children:[e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:t.isFavorited?"currentColor":"none",className:t.isFavorited?"text-yellow-500":"text-gray-400",children:e.jsx("path",{d:"M17.593 3.322c1.1.128 1.907 1.077 1.907 2.185V21L12 17.25 4.5 21V5.507c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0111.186 0z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("span",{className:"text-[13px] text-gray-500",children:t.isFavorited?"å·²æ”¶è—":""})]}),e.jsxs("button",{onClick:()=>null==r?void 0:r(t.id),className:"flex items-center gap-1.5 active:opacity-60 transition-opacity",children:[e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",className:"text-gray-400",children:e.jsx("path",{d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),e.jsx("span",{className:"text-[13px] text-gray-500",children:t.commentCount>0?d(t.commentCount):""})]}),e.jsxs("button",{onClick:()=>null==a?void 0:a(t.id),className:"flex items-center gap-1.5 active:opacity-60 transition-opacity",children:[t.isLiked?e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor",className:"text-[#ff6c00]",children:e.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})}):e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",className:"text-gray-400",children:e.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("span",{className:"text-[13px] "+(t.isLiked?"text-[#ff6c00]":"text-gray-500"),children:t.likeCount>0?d(t.likeCount):""})]})]})]})]})})},dn=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),{posts:l,loading:n,currentTab:i,setTab:c,toggleLike:d,toggleFavorite:x,refreshPosts:m}=y(),[h,u]=t.useState(!1);t.useEffect(()=>{"true"===localStorage.getItem("forum_initialized")||a("/forum/welcome",{replace:!0})},[]);const g=e=>{d(e)},p=e=>{a(`/forum/post/${e}`)},f=e=>{x(e)},b=()=>{a("/forum/publish")};return e.jsxs("div",{className:"h-screen flex flex-col bg-white",children:[e.jsxs("div",{className:"glass-effect border-b border-white/30 shadow-sm flex-shrink-0",children:[r&&e.jsx(ua,{}),e.jsxs("div",{className:"px-4 py-2.5 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a("/desktop"),className:"w-9 h-9 flex items-center justify-center active:opacity-60 transition-opacity",children:e.jsx(os,{size:22,className:"text-gray-800"})}),e.jsxs("button",{onClick:()=>{a("/forum/search")},className:"flex-1 mx-3 h-9 bg-gray-100 rounded-full flex items-center px-3 active:bg-gray-200 transition-colors",children:[e.jsx(is,{size:16,className:"text-gray-500"}),e.jsx("span",{className:"ml-2 text-[14px] text-gray-500",children:"æœç´¢ä½ æ„Ÿå…´è¶£çš„å†…å®¹"})]}),e.jsx("button",{onClick:b,className:"w-9 h-9 flex items-center justify-center active:opacity-60 transition-opacity",children:e.jsx(cs,{size:20,className:"text-[#ff6c00]"})})]}),e.jsxs("div",{className:"flex items-center px-4 pb-2.5",children:[[{key:"recommend",label:"é¦–é¡µ"},{key:"following",label:"å…³æ³¨"},{key:"hot",label:"æŽ¨è"}].map((t,s)=>e.jsx("button",{onClick:()=>(e=>{c(e)})(t.key),className:"px-3 py-1.5 text-[14px] rounded-full transition-all mr-3 "+(i===t.key?"bg-[#ff6c00] text-white font-medium":"text-gray-700 hover:bg-gray-100"),children:t.label},t.key)),e.jsxs("button",{className:"ml-auto text-gray-600 text-[14px] flex items-center gap-1 active:opacity-60",children:[e.jsx("span",{children:"æ›´å¤š"}),e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:e.jsx("path",{d:"M19 9l-7 7-7-7",strokeLinecap:"round",strokeLinejoin:"round"})})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto bg-[#f7f7f7]",children:n?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-3 border-orange-500 border-t-transparent rounded-full"})}):0===l.length?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-gray-400",children:[e.jsx(us,{size:64,className:"mb-4 opacity-30"}),e.jsx("p",{className:"text-sm",children:"æš‚æ— å†…å®¹"})]}):e.jsx("div",{children:l.map(t=>(t=>e.jsx(on,{post:t,onLike:g,onComment:p,onFavorite:f},t.id))(t))})}),e.jsxs("div",{className:"bg-white border-t border-gray-100 flex items-center justify-around py-2 safe-area-bottom",children:[e.jsxs("button",{className:"flex flex-col items-center gap-1 py-1",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",className:"text-[#ff6c00]",children:e.jsx("path",{d:"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"})}),e.jsx("span",{className:"text-[11px] text-[#ff6c00] font-medium",children:"é¦–é¡µ"})]}),e.jsxs("button",{onClick:()=>a("/forum/topics"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M7 20l4-16m2 16l4-16M6 9h14M4 15h14",strokeLinecap:"round"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"è¯é¢˜"})]}),e.jsx("button",{onClick:b,className:"flex flex-col items-center -mt-3 active:scale-95 transition-transform",children:e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-[#ff8140] to-[#ff6c00] rounded-full flex items-center justify-center shadow-lg",children:e.jsx(cs,{size:24,className:"text-white"})})}),e.jsxs("button",{onClick:()=>a("/forum/notifications"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"æ¶ˆæ¯"})]}),e.jsxs("button",{onClick:()=>a("/forum/profile"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"æˆ‘"})]})]})]})}},Symbol.toStringTag,{value:"Module"})),xn=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),[r,l]=t.useState(!1);t.useEffect(()=>{setTimeout(()=>l(!0),100)},[]);return e.jsx("div",{className:"h-screen flex flex-col items-center justify-center bg-gradient-to-br from-orange-50 via-white to-pink-50 p-6",children:e.jsxs("div",{className:"text-center transition-all duration-700 "+(r?"opacity-100 translate-y-0":"opacity-0 translate-y-4"),children:[e.jsxs("div",{className:"mb-8 relative",children:[e.jsx("div",{className:"w-32 h-32 mx-auto bg-gradient-to-br from-[#ff8140] to-[#ff6c00] rounded-full flex items-center justify-center shadow-2xl",children:e.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"white",children:[e.jsx("path",{d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"}),e.jsx("path",{d:"M7 9h2v2H7zm4 0h2v2h-2zm4 0h2v2h-2z"})]})}),e.jsx("div",{className:"absolute -top-2 -right-2 w-4 h-4 bg-pink-400 rounded-full animate-pulse"}),e.jsx("div",{className:"absolute -bottom-1 -left-1 w-3 h-3 bg-orange-400 rounded-full animate-pulse delay-100"})]}),e.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-3",children:"æ¬¢è¿Žæ¥åˆ°è®ºå›"}),e.jsx("p",{className:"text-lg text-gray-600 mb-2",children:"â”(*ï½€âˆ€Â´*)ãƒŽäº»!"}),e.jsxs("p",{className:"text-sm text-gray-500 mb-12 max-w-sm mx-auto leading-relaxed",children:["ä¸€ä¸ªç”±AIé©±åŠ¨çš„ç¤¾äº¤è®ºå›",e.jsx("br",{}),"åœ¨è¿™é‡Œï¼Œä½ çš„è§’è‰²ä»¬å°†æ‹¥æœ‰è‡ªå·±çš„è®ºå›ç”Ÿæ´»"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>a("/forum/initialize"),className:"px-8 py-3.5 bg-gradient-to-r from-[#ff8140] to-[#ff6c00] text-white text-[16px] font-semibold rounded-full shadow-lg active:scale-95 transition-transform hover:shadow-xl",children:"è¿›å…¥è®ºå›"}),e.jsx("button",{onClick:()=>{localStorage.setItem("forum_initialized","true"),a("/forum",{replace:!0})},className:"block mx-auto text-[14px] text-gray-500 active:opacity-60 transition-opacity px-4 py-2",children:"è·³è¿‡ï¼Œç›´æŽ¥è¿›å…¥"})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-8",children:"é¦–æ¬¡ä½¿ç”¨å»ºè®®åˆå§‹åŒ–è§’è‰²ä»¥èŽ·å¾—æ›´å¥½ä½“éªŒ"})]})})}},Symbol.toStringTag,{value:"Module"})),mn=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),{characters:l}=n(),[i,c]=t.useState(1),[d,x]=t.useState(()=>Et()),[m,h]=t.useState(""),[u,g]=t.useState(""),[p,f]=t.useState("è½»æ¾"),[b,j]=t.useState(!1),[v,y]=t.useState({current:0,total:0,message:""});t.useEffect(()=>{l.length},[l]);return e.jsxs("div",{className:"h-screen flex flex-col bg-[#f7f7f7]",children:[e.jsxs("div",{className:"glass-effect border-b border-white/30 shadow-sm flex-shrink-0",children:[r&&e.jsx(ua,{}),e.jsxs("div",{className:"px-4 py-2.5 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>2===i?c(1):a("/forum/welcome"),className:"w-9 h-9 flex items-center justify-center active:opacity-60",disabled:b,children:e.jsx(os,{size:22,className:"text-gray-800"})}),e.jsx("h1",{className:"text-[17px] font-semibold text-gray-900",children:1===i?"é€‰æ‹©è§’è‰²":"å¡«å†™å…´è¶£"}),e.jsx("button",{onClick:()=>a("/create-character"),className:"w-9 h-9 flex items-center justify-center active:opacity-60",disabled:b||2===i,style:{opacity:2===i?0:1},children:e.jsx(cs,{size:20,className:"text-[#ff6c00]"})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:1===i?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-orange-50 border-l-4 border-orange-400 p-4 m-4",children:[e.jsx("p",{className:"text-[14px] text-gray-700 leading-relaxed",children:"é€‰æ‹©è¦åŠ å…¥è®ºå›çš„è§’è‰²ï¼Œä»–ä»¬å°†æ ¹æ®è‡ªå·±çš„æ€§æ ¼ç”Ÿæˆè®ºå›æ˜µç§°å’Œç­¾å"}),"  é’±é’±é’±é’±é’±1Â·11"]}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-white mb-2",children:[e.jsxs("span",{className:"text-[14px] text-gray-600",children:["å·²é€‰æ‹© ",e.jsx("span",{className:"text-[#ff6c00] font-semibold",children:d.length})," / ",l.length," ä¸ªè§’è‰²"]}),e.jsx("button",{onClick:()=>{d.length===l.length?x([]):x(l.map(e=>e.id))},className:"text-[14px] text-[#ff6c00] active:opacity-60",disabled:b,children:d.length===l.length?"å…¨ä¸é€‰":"å…¨é€‰"})]}),0===l.length?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-gray-400",children:[e.jsx("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",className:"mb-4 opacity-30",children:e.jsx("path",{d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z",strokeWidth:"2"})}),e.jsx("p",{className:"text-[14px] mb-4",children:"è¿˜æ²¡æœ‰è§’è‰²"}),e.jsx("button",{onClick:()=>a("/create-character"),className:"px-6 py-2.5 bg-[#ff6c00] text-white rounded-full text-[14px] active:opacity-80",children:"åˆ›å»ºç¬¬ä¸€ä¸ªè§’è‰²"})]}):e.jsx("div",{className:"bg-white",children:l.map(t=>{const s=d.includes(t.id);return e.jsxs("button",{onClick:()=>{return!b&&(e=t.id,void x(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e]));var e},disabled:b,className:"w-full flex items-center gap-3 p-4 border-b border-gray-50 active:bg-gray-50 transition-colors",children:[e.jsx("div",{className:"w-5 h-5 rounded border-2 flex items-center justify-center transition-colors "+(s?"border-[#ff6c00] bg-[#ff6c00]":"border-gray-300"),children:s&&e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"white",strokeWidth:"3",children:e.jsx("path",{d:"M20 6L9 17l-5-5",strokeLinecap:"round",strokeLinejoin:"round"})})}),e.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden bg-gray-100 flex-shrink-0",children:t.avatar.startsWith("data:")?e.jsx("img",{src:t.avatar,alt:t.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-2xl",children:t.avatar})}),e.jsxs("div",{className:"flex-1 text-left min-w-0",children:[e.jsx("div",{className:"text-[15px] font-medium text-gray-900 truncate",children:t.name}),e.jsx("div",{className:"text-[13px] text-gray-500 truncate",children:t.signature||t.description.substring(0,30)})]})]},t.id)})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-4 m-4",children:e.jsx("p",{className:"text-[14px] text-gray-700 leading-relaxed",children:"å‘Šè¯‰æˆ‘ä»¬ä½ çš„å…´è¶£ï¼Œæˆ‘ä»¬å°†æ ¹æ®ä½ çš„å–œå¥½ç”Ÿæˆä¸ªæ€§åŒ–çš„è¯é¢˜å’Œå¸–å­"})}),e.jsxs("div",{className:"bg-white p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-[15px] font-medium text-gray-900 mb-2",children:["ä½ çš„å…´è¶£çˆ±å¥½ ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:m,onChange:e=>h(e.target.value),placeholder:"ä¾‹å¦‚ï¼šæ¸¸æˆã€ç§‘æŠ€ã€ç¾Žé£Ÿã€æ—…è¡Œ",className:"w-full px-4 py-3 border border-gray-200 rounded-lg text-[15px] outline-none focus:border-[#ff6c00]",disabled:b}),e.jsx("p",{className:"text-[12px] text-gray-500 mt-1",children:"ç”¨é€—å·åˆ†éš”å¤šä¸ªå…´è¶£"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[15px] font-medium text-gray-900 mb-2",children:"æœ€è¿‘å…³æ³¨çš„çƒ­ç‚¹"}),e.jsx("input",{type:"text",value:u,onChange:e=>g(e.target.value),placeholder:"ä¾‹å¦‚ï¼šåŽŸç¥žæ–°ç‰ˆæœ¬ã€AIç»˜ç”»ã€æœ€æ–°ç”µå½±",className:"w-full px-4 py-3 border border-gray-200 rounded-lg text-[15px] outline-none focus:border-[#ff6c00]",disabled:b})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[15px] font-medium text-gray-900 mb-2",children:"å¸–å­é£Žæ ¼åå¥½"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:["è½»æ¾","æ­£ç»","æŠ½è±¡"].map(t=>e.jsx("button",{onClick:()=>f(t),disabled:b,className:"py-2.5 rounded-lg text-[14px] font-medium transition-all "+(p===t?"bg-[#ff6c00] text-white":"bg-gray-100 text-gray-700 active:bg-gray-200"),children:t},t))})]})]}),e.jsxs("div",{className:"bg-white mt-2 p-4",children:[e.jsxs("div",{className:"text-[14px] text-gray-600 mb-3",children:["å·²é€‰æ‹© ",d.length," ä¸ªè§’è‰²"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:l.filter(e=>d.includes(e.id)).map(t=>e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-orange-50 border border-orange-200 rounded-full",children:[e.jsx("span",{className:"text-lg",children:t.avatar}),e.jsx("span",{className:"text-[13px] text-gray-700",children:t.name})]},t.id))})]})]})}),e.jsxs("div",{className:"p-4 bg-white border-t border-gray-100",children:[e.jsx("button",{onClick:1===i?()=>{0!==d.length?c(2):alert("è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªè§’è‰²")}:async()=>{var e,t,s,r,n;if(!m.trim())return void alert("è¯·å¡«å†™ä½ çš„å…´è¶£çˆ±å¥½");const i=l.filter(e=>d.includes(e.id));j(!0),Wt(),y({current:0,total:3,message:"æ­£åœ¨æ¸…é™¤æ—§æ•°æ®..."}),localStorage.removeItem("forum_posts"),localStorage.removeItem("forum_topics_list"),localStorage.removeItem("forum_comments"),y({current:0,total:3,message:"æ­£åœ¨ç”Ÿæˆè¯é¢˜å’Œå¸–å­..."}),Rt("æ­£åœ¨ç”Ÿæˆè¯é¢˜å’Œå¸–å­...");try{const l=localStorage.getItem("apiSettings");if(!l)throw new Error("è¯·å…ˆé…ç½®API");const c=JSON.parse(l),o=i.map(e=>`${e.name}ï¼ˆ${e.nickname||e.name}ï¼‰- æ€§æ ¼ï¼š${e.personality||e.description||"æœªè®¾ç½®"} - ç­¾åï¼š${e.signature||"æš‚æ— "}`).join("\n"),x=Bt(),h=`ä½ æ˜¯è®ºå›å†…å®¹ç”Ÿæˆå™¨ã€‚è¯·æ ¹æ®ç”¨æˆ·ä¿¡æ¯ç”Ÿæˆè®ºå›åˆå§‹å†…å®¹ã€‚\n\nâš ï¸ é‡è¦è§„åˆ™ï¼š\n1. ä¸ºæ¯ä¸ªAIè§’è‰²ç”Ÿæˆç¬¦åˆå…¶æ€§æ ¼çš„è®ºå›æ˜µç§°å’Œä¸ªæ€§ç­¾å\n2. AIè§’è‰²çš„åŽŸå§‹åå­—ï¼ˆ${i.map(e=>e.name).join("ã€")}ï¼‰ä¿æŒä¸å˜\n3. å¸–å­å†…å®¹è¦ç¬¦åˆè§’è‰²æ€§æ ¼\n4. ${"æŠ½è±¡"===p?"å¯ä»¥åœ¨å¸–å­ä¸­è‡ªç„¶èžå…¥ç½‘ç»œæ¢—ï¼Œè®©å†…å®¹æ›´æœ‰è¶£":""}\n\nç”¨æˆ·å…´è¶£ï¼š${m.trim()}\n${u.trim()?`çƒ­ç‚¹å…³æ³¨ï¼š${u.trim()}`:""}\nå¸–å­é£Žæ ¼ï¼š${p}\n\n${"æŠ½è±¡"===p?`\nå¸¸ç”¨ç½‘ç»œæ¢—åº“ï¼ˆéƒ¨åˆ†ï¼‰ï¼š\n${x.slice(0,200)}\n`:""}\n\nAIè§’è‰²ä¿¡æ¯ï¼š\n${o}\n\nâš ï¸ è¾“å‡ºæ ¼å¼è¦æ±‚ï¼ˆéžå¸¸é‡è¦ï¼‰ï¼š\n- æ¯è¡Œä¸€æ¡æ•°æ®ï¼Œç”¨ç«–çº¿ | åˆ†éš”å­—æ®µ\n- ä¸è¦æ·»åŠ markdownä»£ç å—æ ‡è®°ï¼ˆä¸è¦ç”¨\`\`\`ï¼‰\n- ä¸è¦æ·»åŠ ä»»ä½•è§£é‡Šè¯´æ˜Žæ–‡å­—\n- ç›´æŽ¥è¾“å‡ºæ•°æ®è¡Œ\n\næ ¼å¼è¯´æ˜Žï¼š\nè§’è‰²|åŽŸå|è®ºå›æ˜µç§°|ä¸ªæ€§ç­¾å|å¤´åƒemoji\nè¯é¢˜|è¯é¢˜å|è¯é¢˜æè¿°|æ ‡ç­¾1,æ ‡ç­¾2\nå¸–å­|è¯é¢˜å|ä½œè€…åŽŸå|å¸–å­å†…å®¹|æ ‡ç­¾1,æ ‡ç­¾2\nç”¨æˆ·|user_id|ç”¨æˆ·å|å¤´åƒemoji|ä¸ªäººç®€ä»‹\n\nç¤ºä¾‹è¾“å‡ºï¼ˆè¯·ä¸¥æ ¼æŒ‰æ­¤æ ¼å¼ï¼‰ï¼š\nè§’è‰²|${(null==(e=i[0])?void 0:e.name)||"å°é›ª"}|é›ªã®ç‰©è¯­|å–œæ¬¢äºŒæ¬¡å…ƒçš„æ™®é€šäºº|â„ï¸\nè¯é¢˜|æ¸¸æˆè®¨è®º|åˆ†äº«æ¸¸æˆå¿ƒå¾—å’Œæ”»ç•¥|æ¸¸æˆ,å¨±ä¹\nè¯é¢˜|ç§‘æŠ€å‰æ²¿|æŽ¢è®¨æœ€æ–°ç§‘æŠ€åŠ¨æ€|ç§‘æŠ€,AI\nè¯é¢˜|ç¾Žé£Ÿåˆ†äº«|è®°å½•ç¾Žé£Ÿç”Ÿæ´»ç‚¹æ»´|ç¾Žé£Ÿ,ç”Ÿæ´»\nå¸–å­|æ¸¸æˆè®¨è®º|${(null==(t=i[0])?void 0:t.name)||"å°é›ª"}|ä»Šå¤©æŠ½åˆ°äº†å–œæ¬¢çš„è§’è‰²~å¥½å¼€å¿ƒ|æ¸¸æˆ\nç”¨æˆ·|user1|å¼ æµ©å®‡|ðŸ˜Š|æ¸¸æˆçˆ±å¥½è€…\nç”¨æˆ·|user2|æŽæ€çª|ðŸŒ¸|ç¾Žé£Ÿåšä¸»\n\nç”Ÿæˆè¦æ±‚ï¼š\n1. ä¸ºæ¯ä¸ªAIè§’è‰²ç”Ÿæˆ1æ¡"è§’è‰²"è¡Œï¼ˆåŒ…å«è®ºå›æ˜µç§°å’Œç­¾åï¼‰\n2. ç”Ÿæˆ6-8ä¸ª"è¯é¢˜"è¡Œ\n3. æ¯ä¸ªAIè§’è‰²å‘2-3æ¡"å¸–å­"è¡Œï¼ˆä½¿ç”¨åŽŸåä½œä¸ºä½œè€…ï¼‰\n4. ç”Ÿæˆ20-30ä¸ª"ç”¨æˆ·"è¡Œï¼ˆNPCç”¨æˆ·ï¼‰\n5. ç¡®ä¿æ¯ä¸ªè¯é¢˜éƒ½æœ‰5-8æ¡å¸–å­\n6. å¸–å­å†…å®¹50-150å­—\n\nâš ï¸ å†æ¬¡å¼ºè°ƒï¼šç›´æŽ¥è¾“å‡ºæ•°æ®è¡Œï¼Œä¸è¦æœ‰ä»»ä½•å…¶ä»–æ–‡å­—æˆ–markdownæ ‡è®°ï¼`;y({current:1,total:3,message:"æ­£åœ¨è°ƒç”¨AIç”Ÿæˆå†…å®¹..."});const g=await fetch(c.baseUrl+"/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c.apiKey}`},body:JSON.stringify({model:c.model,messages:[{role:"user",content:h}],temperature:.9,max_tokens:4e3})});if(!g.ok)throw new Error("APIè°ƒç”¨å¤±è´¥");let f=(null==(n=null==(r=null==(s=(await g.json()).choices)?void 0:s[0])?void 0:r.message)?void 0:n.content)||"";f=f.replace(/```[\w]*\n?/g,"").trim(),y({current:2,total:3,message:"æ­£åœ¨è§£æžç”Ÿæˆçš„å†…å®¹..."});const b=f.split("\n").map(e=>e.trim()).filter(e=>e&&!e.startsWith("#")),j=[],v=[],N=[],w=[];if(b.forEach(e=>{const t=e.split("|");"è§’è‰²"===t[0]&&t.length>=5?j.push({originalName:t[1].trim(),forumNickname:t[2].trim(),forumSignature:t[3].trim(),forumAvatar:t[4].trim()}):"è¯é¢˜"===t[0]&&t.length>=4?v.push({id:`topic_${Date.now()}_${Math.random()}`,name:t[1].trim(),description:t[2].trim(),tags:t[3].split(",").map(e=>e.trim()),postsCount:0,followersCount:Math.floor(500*Math.random())+100,isFollowing:!1,posts:[],users:[]}):"å¸–å­"===t[0]&&t.length>=5?N.push({topicName:t[1].trim(),authorName:t[2].trim(),content:t[3].trim(),tags:t[4].split(",").map(e=>e.trim())}):"ç”¨æˆ·"===t[0]&&t.length>=5&&w.push({id:t[1].trim(),name:t[2].trim(),avatar:t[3].trim(),bio:t[4].trim(),followers:Math.floor(500*Math.random())+50})}),0===v.length||0===N.length)throw new Error(`ç”Ÿæˆå¤±è´¥ï¼šè¯é¢˜${v.length}ä¸ªï¼Œå¸–å­${N.length}ä¸ªã€‚AIè¿”å›žçš„æ ¼å¼å¯èƒ½ä¸æ­£ç¡®ï¼Œè¯·é‡è¯•ã€‚`);const k=[];if(v.forEach(e=>{const t=N.filter(t=>t.topicName===e.name);e.posts=t.map(e=>{let t=w.find(t=>t.name===e.authorName),s=!1;if(!t){const a=i.find(t=>t.name===e.authorName);if(a){const e=j.find(e=>e.originalName===a.name);t={id:a.id,name:(null==e?void 0:e.forumNickname)||a.name,avatar:(null==e?void 0:e.forumAvatar)||a.avatar||"ðŸ˜Š",bio:(null==e?void 0:e.forumSignature)||a.signature||""},s=!0}else t={id:`user_${Math.random()}`,name:e.authorName,avatar:"ðŸ˜Š",bio:""}}const a={id:`post_${Date.now()}_${Math.random()}`,authorId:t.id,authorName:t.name,authorAvatar:t.avatar,isVerified:s,content:e.content,type:"text",timestamp:Date.now()-864e5*Math.random()*3,likeCount:Math.floor(100*Math.random())+(s?50:0),commentCount:Math.floor(50*Math.random()),shareCount:Math.floor(30*Math.random()),viewCount:Math.floor(1e3*Math.random())+100,isLiked:!1,isFavorited:!1,tags:e.tags,comments:[]};return k.push(a),a}),e.postsCount=e.posts.length,e.users=w.slice(0,15)}),0===k.length)throw new Error("ç”Ÿæˆå¤±è´¥ï¼šæ²¡æœ‰ç”Ÿæˆä»»ä½•å¸–å­ï¼Œè¯·é‡è¯•ã€‚");localStorage.setItem("forum_topics_list",JSON.stringify(v)),localStorage.setItem("forum_posts",JSON.stringify(k)),localStorage.setItem("forum_initialized","true");const C=i.map(e=>{const t=j.find(t=>t.originalName===e.name);return{characterId:e.id,originalName:e.name,originalAvatar:e.avatar,forumName:e.name,forumNickname:(null==t?void 0:t.forumNickname)||e.nickname||e.name,forumAvatar:(null==t?void 0:t.forumAvatar)||"ðŸ˜Š",forumBio:(null==t?void 0:t.forumSignature)||e.signature||"",forumSignature:(null==t?void 0:t.forumSignature)||e.signature||"",personality:e.personality||e.description||"",followersCount:Math.floor(200*Math.random())+50,followingCount:Math.floor(100*Math.random())+20,influence:"medium",isFollowedByUser:!1}});Pt(C),Ft(d),y({current:3,total:3,message:"åˆå§‹åŒ–å®Œæˆï¼"}),Ot(),setTimeout(()=>{a("/forum",{replace:!0})},800)}catch(c){alert("åˆå§‹åŒ–å¤±è´¥ï¼š"+c.message),j(!1)}},disabled:1===i&&0===d.length||2===i&&!m.trim()||b,className:"w-full py-3.5 rounded-full text-[16px] font-semibold transition-all "+(1===i&&0===d.length||2===i&&!m.trim()||b?"bg-gray-200 text-gray-400":"bg-gradient-to-r from-[#ff8140] to-[#ff6c00] text-white active:scale-98 shadow-lg"),children:b?v.message:1===i?`ä¸‹ä¸€æ­¥ (${d.length})`:"å¼€å§‹ç”Ÿæˆè®ºå›"}),!b&&e.jsx("button",{onClick:()=>{localStorage.setItem("forum_initialized","true"),a("/forum",{replace:!0})},className:"w-full mt-3 py-3 text-[14px] text-gray-500 active:opacity-60 transition-opacity",children:"è·³è¿‡ï¼Œç¨åŽå†é…ç½®"}),b&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-[12px] text-gray-500 mb-1",children:[e.jsxs("span",{children:[v.current," / ",v.total]}),e.jsxs("span",{children:[Math.round(v.current/v.total*100),"%"]})]}),e.jsx("div",{className:"h-1.5 bg-gray-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-[#ff8140] to-[#ff6c00] transition-all duration-300",style:{width:v.current/v.total*100+"%"}})})]})]})]})}},Symbol.toStringTag,{value:"Module"})),hn=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),[l,n]=t.useState([]),[i,c]=t.useState(0);t.useEffect(()=>{const e=Ut();0!==e.length?(n(e),c(e.filter(e=>e.isFollowedByUser).length)):a("/forum/initialize",{replace:!0})},[a]);const d=e=>e<1e3?e.toString():e<1e4?(e/1e3).toFixed(1)+"k":(e/1e4).toFixed(1)+"w";return e.jsxs("div",{className:"h-screen flex flex-col bg-[#f7f7f7]",children:[e.jsxs("div",{className:"glass-effect border-b border-white/30 shadow-sm flex-shrink-0",children:[r&&e.jsx(ua,{}),e.jsx("div",{className:"px-4 py-2.5 flex items-center justify-center",children:e.jsx("h1",{className:"text-[17px] font-semibold text-gray-900",children:"è®ºå›è§’è‰²"})})]}),e.jsx("div",{className:"bg-white m-4 p-4 rounded-xl shadow-sm",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-50 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",className:"text-green-500",children:e.jsx("path",{d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-[15px] font-semibold text-gray-900 mb-1",children:"åˆå§‹åŒ–æˆåŠŸï¼"}),e.jsxs("p",{className:"text-[13px] text-gray-600 leading-relaxed",children:[l.length," ä¸ªè§’è‰²å·²å‡†å¤‡å°±ç»ªã€‚ä½ å¯ä»¥é€‰æ‹©å…³æ³¨æ„Ÿå…´è¶£çš„è§’è‰²ï¼Œä¹Ÿå¯ä»¥ç¨åŽå†å…³æ³¨ã€‚"]})]})]})}),e.jsxs("div",{className:"px-4 py-2 flex items-center justify-between",children:[e.jsxs("span",{className:"text-[14px] text-gray-600",children:["å…± ",l.length," ä¸ªè§’è‰²"]}),e.jsxs("span",{className:"text-[14px] text-gray-600",children:["å·²å…³æ³¨ ",e.jsx("span",{className:"text-[#ff6c00] font-semibold",children:i})," ä¸ª"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx("div",{className:"bg-white",children:l.map(t=>e.jsxs("div",{className:"flex items-start gap-3 p-4 border-b border-gray-50",children:[e.jsx("div",{className:"w-14 h-14 rounded-full overflow-hidden bg-gray-100 flex-shrink-0",children:t.originalAvatar.startsWith("data:")?e.jsx("img",{src:t.originalAvatar,alt:t.forumName,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-2xl",children:t.originalAvatar})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-[16px] font-semibold text-gray-900",children:t.forumName}),"high"===t.influence&&e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 16 16",className:"text-[#ff8200]",children:e.jsx("path",{d:"M8 0L10 5L16 6L12 10L13 16L8 13L3 16L4 10L0 6L6 5L8 0Z",fill:"currentColor"})})]}),e.jsx("p",{className:"text-[13px] text-gray-600 mb-2 line-clamp-2",children:t.forumBio}),e.jsxs("div",{className:"flex items-center gap-3 text-[12px] text-gray-400",children:[e.jsxs("span",{children:["ðŸ‘¥ ",d(t.followersCount)," ç²‰ä¸"]}),e.jsxs("span",{children:["Â· ",d(t.followingCount)," å…³æ³¨"]})]})]}),e.jsx("button",{onClick:e=>{e.stopPropagation(),(e=>{const t=l.map(t=>t.characterId===e?{...t,isFollowedByUser:!t.isFollowedByUser}:t);n(t),Pt(t),c(t.filter(e=>e.isFollowedByUser).length)})(t.characterId)},className:"px-4 py-1.5 rounded-full text-[13px] font-medium transition-all flex-shrink-0 "+(t.isFollowedByUser?"bg-gray-100 text-gray-600 border border-gray-200":"bg-[#ff6c00] text-white active:opacity-80"),children:t.isFollowedByUser?"å·²å…³æ³¨":"å…³æ³¨"})]},t.characterId))})}),e.jsxs("div",{className:"p-4 bg-white border-t border-gray-100",children:[e.jsx("button",{onClick:()=>{a("/forum",{replace:!0})},className:"w-full py-3.5 bg-gradient-to-r from-[#ff8140] to-[#ff6c00] text-white rounded-full text-[16px] font-semibold active:scale-98 transition-transform shadow-lg",children:"å¼€å§‹æŽ¢ç´¢è®ºå›"}),e.jsx("button",{onClick:()=>a("/forum/initialize"),className:"w-full py-2.5 text-[14px] text-gray-600 mt-2 active:opacity-60",children:"é‡æ–°é€‰æ‹©è§’è‰²"})]})]})}},Symbol.toStringTag,{value:"Module"}));var un=(e=>(e.TEXT="text",e.IMAGE="image",e.VIDEO="video",e.LINK="link",e))(un||{});const gn=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),{addPost:l,saveDraft:n}=y(),[i,c]=t.useState(""),[d,x]=t.useState([]),[m,h]=t.useState([]),[u,g]=t.useState(""),[p,f]=t.useState(!1),[b,j]=t.useState(""),[v,N]=t.useState(!1),[w,k]=t.useState(!1),[C,S]=t.useState(0),I=t.useRef(null),_=t.useRef(null),M=()=>{b.trim()&&!m.includes(b.trim())&&(h(e=>[...e,b.trim()]),j(""),f(!1))},z=()=>{if(i.trim()||0!==d.length)try{n({content:i.trim(),images:d.length>0?d:void 0,tags:m.length>0?m:void 0,location:u||void 0}),alert("è‰ç¨¿å·²ä¿å­˜"),a("/forum",{replace:!0})}catch(e){alert("ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•")}};return e.jsxs("div",{className:"h-screen flex flex-col bg-white",children:[e.jsxs("div",{className:"glass-effect border-b border-white/30 shadow-sm flex-shrink-0",children:[r&&e.jsx(ua,{}),e.jsxs("div",{className:"px-4 py-2.5 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>{(i.trim()||d.length>0)&&window.confirm("å†…å®¹å°šæœªå‘å¸ƒï¼Œæ˜¯å¦ä¿å­˜ä¸ºè‰ç¨¿ï¼Ÿ")?z():a(-1)},className:"text-[15px] text-gray-700 active:opacity-60",children:"å–æ¶ˆ"}),e.jsx("h1",{className:"text-[17px] font-semibold text-gray-900",children:"å‘å¾®åš"}),e.jsx("button",{onClick:async()=>{if(i.trim()||0!==d.length)try{N(!0);const e={id:"currentUser",name:"æˆ‘",avatar:"ðŸ˜Š"},t=l({authorId:e.id,authorName:e.name,authorAvatar:e.avatar,content:i.trim(),type:d.length>0?un.IMAGE:un.TEXT,images:d.length>0?d:void 0,tags:m.length>0?m:void 0,location:u||void 0,isVerified:!1,likeCount:0,commentCount:0,shareCount:0,isLiked:!1,isFavorited:!1});Jt(i).length>0?Ht(t.id,i.trim(),e.id,e.name):Gt(t),a("/forum",{replace:!0})}catch(e){alert("å‘å¸ƒå¤±è´¥ï¼Œè¯·é‡è¯•")}finally{N(!1)}else alert("è¯·è¾“å…¥å†…å®¹æˆ–æ·»åŠ å›¾ç‰‡")},disabled:v||!i.trim()&&0===d.length,className:"px-4 py-1.5 rounded-full text-[14px] font-medium "+(v||!i.trim()&&0===d.length?"bg-gray-200 text-gray-400":"bg-[#ff6c00] text-white active:opacity-80"),children:v?"å‘å¸ƒä¸­...":"å‘å¸ƒ"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"p-4 relative",children:[e.jsx("textarea",{ref:_,value:i,onChange:e=>{c(e.target.value),S(e.target.selectionStart||0)},onClick:e=>S(e.target.selectionStart||0),placeholder:"åˆ†äº«æ–°é²œäº‹...",className:"w-full min-h-[150px] text-[16px] text-gray-900 placeholder-gray-400 outline-none resize-none",autoFocus:!0}),e.jsx("button",{onClick:()=>k(!w),className:"absolute bottom-2 right-2 w-9 h-9 flex items-center justify-center text-[#ff6c00] active:opacity-60 bg-white rounded-full shadow-sm",title:"@è§’è‰²",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M16 8h-6a4 4 0 1 0 0 8h0V14"})]})}),w&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white rounded-xl shadow-2xl max-h-[300px] overflow-y-auto z-50",children:e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"text-[13px] text-gray-500 px-3 py-2",children:"é€‰æ‹©è¦@çš„è§’è‰²"}),Ut().map(t=>e.jsxs("button",{onClick:()=>{var e;const s=Vt(i,C,t.originalName);c(s.newValue),S(s.newCursorPos),k(!1),null==(e=_.current)||e.focus()},className:"w-full flex items-center gap-3 p-3 hover:bg-gray-50 active:bg-gray-100 rounded-lg",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-xl flex-shrink-0",children:t.forumAvatar||t.originalAvatar||"ðŸ˜Š"}),e.jsxs("div",{className:"flex-1 text-left min-w-0",children:[e.jsx("div",{className:"text-[14px] font-medium text-gray-900 truncate",children:t.forumNickname||t.originalName}),e.jsxs("div",{className:"text-[12px] text-gray-500 truncate",children:["@",t.originalName]})]})]},t.characterId)),0===Ut().length&&e.jsxs("div",{className:"text-center text-gray-400 py-8",children:[e.jsx("p",{className:"text-[14px]",children:"æš‚æ— å¯@çš„è§’è‰²"}),e.jsx("p",{className:"text-[12px] mt-1",children:"è¯·å…ˆåœ¨è®ºå›åˆå§‹åŒ–æ—¶æ·»åŠ è§’è‰²"})]})]})})]}),d.length>0&&e.jsx("div",{className:"px-4 pb-4",children:e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[d.map((t,s)=>e.jsxs("div",{className:"relative aspect-square rounded-lg overflow-hidden bg-gray-100",children:[e.jsx("img",{src:t,alt:`å›¾ç‰‡${s+1}`,className:"w-full h-full object-cover"}),e.jsx("button",{onClick:()=>(e=>{x(t=>t.filter((t,s)=>s!==e))})(s),className:"absolute top-1 right-1 w-6 h-6 bg-black/50 rounded-full flex items-center justify-center active:opacity-70",children:e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"white",strokeWidth:"2.5",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12",strokeLinecap:"round"})})})]},s)),d.length<9&&e.jsx("button",{onClick:()=>{var e;return null==(e=I.current)?void 0:e.click()},className:"aspect-square rounded-lg border-2 border-dashed border-gray-300 flex items-center justify-center active:bg-gray-50",children:e.jsx("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-400",children:e.jsx("path",{d:"M12 5v14M5 12h14",strokeLinecap:"round"})})})]})}),m.length>0&&e.jsx("div",{className:"px-4 pb-4",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:m.map((t,s)=>e.jsxs("div",{className:"px-3 py-1.5 bg-[#fff6ed] rounded-full flex items-center gap-2",children:[e.jsxs("span",{className:"text-[14px] text-[#ff6c00]",children:["#",t]}),e.jsx("button",{onClick:()=>(e=>{h(t=>t.filter(t=>t!==e))})(t),className:"w-4 h-4 flex items-center justify-center active:opacity-60",children:e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"#ff6c00",strokeWidth:"2.5",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12",strokeLinecap:"round"})})})]},s))})}),u&&e.jsx("div",{className:"px-4 pb-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-[14px] text-gray-600",children:[e.jsx($s,{size:16}),e.jsx("span",{children:u}),e.jsx("button",{onClick:()=>g(""),className:"ml-auto text-gray-400 active:opacity-60",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12",strokeLinecap:"round"})})})]})}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-sm p-4",children:[e.jsx("h3",{className:"text-[17px] font-semibold text-gray-900 mb-3",children:"æ·»åŠ è¯é¢˜"}),e.jsx("input",{type:"text",value:b,onChange:e=>j(e.target.value),onKeyPress:e=>"Enter"===e.key&&M(),placeholder:"è¾“å…¥è¯é¢˜åç§°",className:"w-full px-3 py-2 border border-gray-200 rounded-lg text-[15px] outline-none focus:border-[#ff6c00]",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx("button",{onClick:()=>{f(!1),j("")},className:"flex-1 py-2 text-[15px] text-gray-700 border border-gray-200 rounded-full active:bg-gray-50",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:M,disabled:!b.trim(),className:"flex-1 py-2 text-[15px] rounded-full "+(b.trim()?"bg-[#ff6c00] text-white active:opacity-80":"bg-gray-200 text-gray-400"),children:"ç¡®å®š"})]})]})})]}),e.jsxs("div",{className:"bg-white border-t border-gray-100 flex-shrink-0",children:[e.jsxs("div",{className:"px-4 py-2 flex items-center gap-4 border-b border-gray-50",children:[e.jsxs("button",{onClick:()=>{var e;return null==(e=I.current)?void 0:e.click()},className:"flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-gray-50 active:bg-gray-100",children:[e.jsx(us,{size:18,className:"text-gray-700"}),e.jsx("span",{className:"text-[13px] text-gray-700",children:"å›¾ç‰‡"})]}),e.jsxs("button",{onClick:()=>f(!0),className:"flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-gray-50 active:bg-gray-100",children:[e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-700",children:e.jsx("path",{d:"M7 20l4-16m2 16l4-16M6 9h14M4 15h14",strokeLinecap:"round"})}),e.jsx("span",{className:"text-[13px] text-gray-700",children:"è¯é¢˜"})]}),e.jsxs("button",{onClick:()=>g("åŒ—äº¬Â·æœé˜³åŒº"),className:"flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-gray-50 active:bg-gray-100",children:[e.jsx($s,{size:18,className:"text-gray-700"}),e.jsx("span",{className:"text-[13px] text-gray-700",children:"ä½ç½®"})]}),e.jsxs("button",{onClick:z,disabled:!i.trim()&&0===d.length,className:"ml-auto flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-gray-50 active:bg-gray-100 disabled:opacity-30",children:[e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-700",children:[e.jsx("path",{d:"M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M17 21v-8H7v8M7 3v5h8",strokeLinecap:"round",strokeLinejoin:"round"})]}),e.jsx("span",{className:"text-[13px] text-gray-700",children:"è‰ç¨¿"})]}),e.jsx("input",{ref:I,type:"file",accept:"image/*",multiple:!0,onChange:e=>{const t=e.target.files;t&&Array.from(t).forEach(e=>{const t=new FileReader;t.onload=e=>{var t;(null==(t=e.target)?void 0:t.result)&&x(t=>[...t,e.target.result])},t.readAsDataURL(e)})},className:"hidden"})]}),e.jsxs("div",{className:"flex items-center justify-around py-2",children:[e.jsxs("button",{onClick:()=>a("/forum"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"é¦–é¡µ"})]}),e.jsxs("button",{onClick:()=>a("/forum/topics"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M7 20l4-16m2 16l4-16M6 9h14M4 15h14",strokeLinecap:"round"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"è¯é¢˜"})]}),e.jsx("button",{className:"flex flex-col items-center -mt-3",children:e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-[#ff8140] to-[#ff6c00] rounded-full flex items-center justify-center shadow-lg opacity-50",children:e.jsx(cs,{size:24,className:"text-white"})})}),e.jsxs("button",{onClick:()=>a("/forum/notifications"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"æ¶ˆæ¯"})]}),e.jsxs("button",{onClick:()=>a("/forum/profile"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"æˆ‘"})]})]})]})]})}},Symbol.toStringTag,{value:"Module"})),pn=({comment:t,onReply:s,onLike:a,onDelete:r,showReplies:l=!0})=>{return e.jsx("div",{className:"px-4 py-3 border-b border-gray-50",children:e.jsxs("div",{className:"flex gap-2.5",children:[e.jsx("div",{className:"w-9 h-9 rounded-full overflow-hidden bg-gray-200 flex-shrink-0",children:t.authorAvatar?e.jsx("img",{src:t.authorAvatar,alt:t.authorName,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-white bg-gradient-to-br from-blue-400 to-purple-400",children:e.jsx("span",{className:"text-sm font-medium",children:t.authorName[0]})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-[14px] text-gray-900 font-medium mb-1",children:t.authorName}),e.jsxs("div",{className:"text-[14px] text-gray-800 leading-[1.5] mb-2",children:[t.replyToUser&&e.jsxs("span",{className:"text-[#5b7599]",children:["å›žå¤ @",t.replyToUser,": "]}),t.content]}),e.jsxs("div",{className:"flex items-center gap-3 text-[12px] text-gray-400",children:[e.jsx("span",{children:(e=>{const t=Date.now()-e,s=Math.floor(t/6e4),a=Math.floor(t/36e5),r=Math.floor(t/864e5);if(s<1)return"åˆšåˆš";if(s<60)return`${s}åˆ†é’Ÿå‰`;if(a<24)return`${a}å°æ—¶å‰`;if(r<7)return`${r}å¤©å‰`;const l=new Date(e);return`${l.getMonth()+1}-${l.getDate()}`})(t.timestamp)}),s&&e.jsx("button",{onClick:()=>s(t),className:"active:opacity-60",children:"å›žå¤"}),a&&t.likeCount>0&&e.jsxs("button",{onClick:()=>a(t.id),className:"active:opacity-60 "+(t.isLiked?"text-[#ff6c00]":""),children:[(n=t.likeCount,n<1e3?n.toString():n<1e4?(n/1e3).toFixed(1)+"k":(n/1e4).toFixed(1)+"w")," èµž"]}),r&&e.jsx("button",{onClick:()=>r(t.id),className:"ml-auto active:opacity-60 text-red-400",children:"åˆ é™¤"})]}),l&&t.replies&&t.replies.length>0&&e.jsx("div",{className:"mt-2 ml-2 pl-3 border-l-2 border-gray-100 space-y-2",children:t.replies.map(t=>e.jsx(pn,{comment:t,onReply:s,onLike:a,showReplies:!1},t.id))})]})]})});var n},fn=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{id:l}=r(),{showStatusBar:n}=o(),{getPost:i,getComments:c,addComment:d,toggleLike:x}=y(),[m,h]=t.useState(null),[u,g]=t.useState([]),[p,f]=t.useState(""),[b,j]=t.useState(null),[v,N]=t.useState(!1),[w,k]=t.useState(!1),[C,S]=t.useState(0),I=t.useRef(null);t.useEffect(()=>{if(!l)return void a("/forum",{replace:!0});const e=i(l);if(!e)return alert("å¸–å­ä¸å­˜åœ¨"),void a("/forum",{replace:!0});h(e);const t=c(l);g(t)},[l,i,c,a]);const _=async()=>{if(m&&p.trim())try{const e={id:"currentUser",name:"æˆ‘",avatar:"ðŸ˜Š"};d({postId:m.id,authorId:e.id,authorName:e.name,authorAvatar:e.avatar,content:p.trim(),replyTo:null==b?void 0:b.id,replyToUser:null==b?void 0:b.name,replyToUserId:null==b?void 0:b.id,isLiked:!1,likeCount:0});Jt(p).length>0&&Ht(m.id,p.trim(),e.id,e.name,null==b?void 0:b.id).then(()=>{const e=c(m.id);g(e)});const t=c(m.id);g(t),f(""),j(null),h(e=>e?{...e,commentCount:e.commentCount+1}:null)}catch(e){alert("è¯„è®ºå¤±è´¥ï¼Œè¯·é‡è¯•")}},M=e=>{j({id:e.id,name:e.authorName}),N(!0),setTimeout(()=>{var e;return null==(e=I.current)?void 0:e.focus()},100)},z=e=>e<1e3?e.toString():e<1e4?(e/1e3).toFixed(1)+"k":(e/1e4).toFixed(1)+"w";return m?e.jsxs("div",{className:"h-screen flex flex-col bg-[#f7f7f7]",children:[e.jsxs("div",{className:"glass-effect border-b border-white/30 shadow-sm flex-shrink-0",children:[n&&e.jsx(ua,{}),e.jsxs("div",{className:"px-4 py-2.5 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a(-1),className:"w-9 h-9 flex items-center justify-center active:opacity-60",children:e.jsx(os,{size:22,className:"text-gray-800"})}),e.jsx("h1",{className:"text-[17px] font-semibold text-gray-900",children:"è¯¦æƒ…"}),e.jsx("button",{className:"w-9 h-9 flex items-center justify-center active:opacity-60",children:e.jsx(Bs,{size:20,className:"text-gray-800"})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"bg-white mb-2 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-3",children:[e.jsx("div",{className:"w-11 h-11 rounded-full overflow-hidden bg-gray-200",children:m.authorAvatar?e.jsx("img",{src:m.authorAvatar,alt:m.authorName,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-white bg-gradient-to-br from-orange-400 to-pink-400",children:e.jsx("span",{className:"text-lg font-medium",children:m.authorName[0]})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"font-medium text-[15px] text-gray-900",children:m.authorName}),m.isVerified&&e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 16 16",className:"text-[#ff8200]",children:e.jsx("path",{d:"M8 0L10 5L16 6L12 10L13 16L8 13L3 16L4 10L0 6L6 5L8 0Z",fill:"currentColor"})})]}),e.jsxs("div",{className:"text-[12px] text-gray-400 mt-0.5",children:[(e=>{const t=Date.now()-e,s=Math.floor(t/6e4),a=Math.floor(t/36e5),r=Math.floor(t/864e5);if(s<1)return"åˆšåˆš";if(s<60)return`${s}åˆ†é’Ÿå‰`;if(a<24)return`${a}å°æ—¶å‰`;if(r<7)return`${r}å¤©å‰`;const l=new Date(e);return`${l.getMonth()+1}-${l.getDate()}`})(m.timestamp),m.location&&` Â· ${m.location}`]})]})]}),e.jsx("div",{className:"text-gray-800 text-[16px] leading-[1.6] mb-3",children:m.content}),m.tags&&m.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:m.tags.map((t,s)=>e.jsxs("span",{className:"text-[14px] text-[#5b7599]",children:["#",t,"#"]},s))}),m.images&&m.images.length>0&&e.jsx("div",{className:`grid ${1===m.images.length?"grid-cols-1":2===m.images.length||4===m.images.length?"grid-cols-2":"grid-cols-3"} gap-[3px] mb-3`,children:m.images.slice(0,9).map((t,s)=>e.jsx("div",{className:"aspect-square rounded-[4px] overflow-hidden bg-gray-100",children:e.jsx("img",{src:t,alt:`å›¾ç‰‡${s+1}`,className:"w-full h-full object-cover"})},s))}),e.jsxs("div",{className:"flex items-center gap-4 pt-3 border-t border-gray-50 text-[13px] text-gray-500",children:[e.jsxs("span",{children:[z(m.likeCount)," èµž"]}),e.jsxs("span",{children:[z(m.commentCount)," è¯„è®º"]}),e.jsxs("span",{children:[z(m.shareCount)," è½¬å‘"]})]})]}),e.jsxs("div",{className:"bg-white",children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-50",children:e.jsxs("span",{className:"text-[15px] font-medium text-gray-900",children:["è¯„è®º ",u.length]})}),0===u.length?e.jsx("div",{className:"py-20 text-center text-gray-400 text-[14px]",children:"æš‚æ— è¯„è®º"}):e.jsx("div",{children:u.map(t=>e.jsx(pn,{comment:t,onReply:M},t.id))})]})]}),e.jsxs("div",{className:"bg-white border-t border-gray-100 flex-shrink-0",children:[e.jsxs("div",{className:"px-4 py-2 flex items-center gap-3 border-b border-gray-50",children:[e.jsx("button",{onClick:()=>N(!0),className:"flex-1 h-9 px-3 bg-gray-100 rounded-full text-left text-[14px] text-gray-500",children:"è¯´ç‚¹ä»€ä¹ˆ..."}),e.jsx("button",{onClick:()=>{m&&(x(m.id),h(e=>e?{...e,isLiked:!e.isLiked,likeCount:e.isLiked?e.likeCount-1:e.likeCount+1}:null))},className:"flex items-center gap-1.5 px-3 py-1.5 active:opacity-60",children:m.isLiked?e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",className:"text-[#ff6c00]",children:e.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})}):e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})})})]}),e.jsxs("div",{className:"flex items-center justify-around py-2",children:[e.jsxs("button",{onClick:()=>a("/forum"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"é¦–é¡µ"})]}),e.jsxs("button",{onClick:()=>a("/forum/topics"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M7 20l4-16m2 16l4-16M6 9h14M4 15h14",strokeLinecap:"round"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"è¯é¢˜"})]}),e.jsx("button",{className:"flex flex-col items-center -mt-3",children:e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-[#ff8140] to-[#ff6c00] rounded-full flex items-center justify-center shadow-lg opacity-50",children:e.jsx(cs,{size:24,className:"text-white"})})}),e.jsxs("button",{onClick:()=>a("/forum/notifications"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"æ¶ˆæ¯"})]}),e.jsxs("button",{onClick:()=>a("/forum/profile"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"æˆ‘"})]})]})]}),e.jsxs("div",{className:"fixed inset-x-0 bottom-0 bg-white border-t border-gray-200 p-4 safe-area-bottom z-50",children:[b&&e.jsxs("div",{className:"flex items-center justify-between mb-2 text-[13px] text-gray-500",children:[e.jsxs("span",{children:["å›žå¤ @",b.name]}),e.jsx("button",{onClick:()=>{j(null),f("")},className:"text-gray-400 active:opacity-60",children:"å–æ¶ˆ"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>k(!w),className:"w-9 h-9 flex items-center justify-center text-[#ff6c00] active:opacity-60",title:"@è§’è‰²",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M16 8h-6a4 4 0 1 0 0 8h0V14"})]})}),e.jsx("input",{ref:I,type:"text",value:p,onChange:e=>{f(e.target.value),S(e.target.selectionStart||0)},onClick:e=>S(e.target.selectionStart||0),onKeyPress:e=>"Enter"===e.key&&_(),placeholder:b?`å›žå¤ @${b.name}`:"è¯´ç‚¹ä»€ä¹ˆ...",className:"flex-1 h-10 px-3 bg-gray-100 rounded-full text-[14px] outline-none"}),e.jsx("button",{onClick:_,disabled:!p.trim(),className:"px-5 h-10 rounded-full text-[14px] font-medium "+(p.trim()?"bg-[#ff6c00] text-white active:opacity-80":"bg-gray-200 text-gray-400"),children:"å‘é€"})]}),w&&e.jsx("div",{className:"absolute bottom-full left-0 right-0 mb-2 bg-white rounded-xl shadow-2xl max-h-[300px] overflow-y-auto",children:e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"text-[13px] text-gray-500 px-3 py-2",children:"é€‰æ‹©è¦@çš„è§’è‰²"}),Ut().map(t=>e.jsxs("button",{onClick:()=>{var e;const s=Vt(p,C,t.originalName);f(s.newValue),S(s.newCursorPos),k(!1),null==(e=I.current)||e.focus()},className:"w-full flex items-center gap-3 p-3 hover:bg-gray-50 active:bg-gray-100 rounded-lg",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-xl flex-shrink-0",children:t.forumAvatar||t.originalAvatar||"ðŸ˜Š"}),e.jsxs("div",{className:"flex-1 text-left min-w-0",children:[e.jsx("div",{className:"text-[14px] font-medium text-gray-900 truncate",children:t.forumNickname||t.originalName}),e.jsxs("div",{className:"text-[12px] text-gray-500 truncate",children:["@",t.originalName]})]})]},t.characterId)),0===Ut().length&&e.jsxs("div",{className:"text-center text-gray-400 py-8",children:[e.jsx("p",{className:"text-[14px]",children:"æš‚æ— å¯@çš„è§’è‰²"}),e.jsx("p",{className:"text-[12px] mt-1",children:"è¯·å…ˆåœ¨è®ºå›åˆå§‹åŒ–æ—¶æ·»åŠ è§’è‰²"})]})]})})]})]}):e.jsx("div",{className:"h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-3 border-[#ff6c00] border-t-transparent rounded-full"})})}},Symbol.toStringTag,{value:"Module"})),bn=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),{loadPosts:l}=y(),[n,i]=t.useState(""),[c,d]=t.useState([]),[x,m]=t.useState([]),[h,u]=t.useState([]),[g,p]=t.useState("posts"),[f,b]=t.useState(!1),[j,v]=t.useState(!1),N=t.useRef(null);t.useEffect(()=>{var e;const t=localStorage.getItem("forum_search_history");if(t)try{m(JSON.parse(t))}catch(s){}u([{name:"å¾®åšçƒ­æœ",count:12800},{name:"ä»Šæ—¥è¯é¢˜",count:8500},{name:"ç§‘æŠ€èµ„è®¯",count:6200},{name:"å¨±ä¹å…«å¦",count:5100},{name:"ç¾Žé£Ÿåˆ†äº«",count:3800}]),null==(e=N.current)||e.focus()},[]);const w=async e=>{const t=e||n;if(t.trim())try{b(!0),v(!0);const e=[t,...x.filter(e=>e!==t)].slice(0,10);m(e),localStorage.setItem("forum_search_history",JSON.stringify(e)),await l({keyword:t}),d([])}catch(s){}finally{b(!1)}},k=()=>{window.confirm("ç¡®å®šæ¸…ç©ºæœç´¢åŽ†å²å—ï¼Ÿ")&&(m([]),localStorage.removeItem("forum_search_history"))};return e.jsxs("div",{className:"h-screen flex flex-col bg-[#f7f7f7]",children:[e.jsxs("div",{className:"glass-effect border-b border-white/30 shadow-sm flex-shrink-0",children:[r&&e.jsx(ua,{}),e.jsxs("div",{className:"px-4 py-2.5 flex items-center gap-2",children:[e.jsx("button",{onClick:()=>a(-1),className:"w-9 h-9 flex items-center justify-center active:opacity-60",children:e.jsx(os,{size:22,className:"text-gray-800"})}),e.jsxs("div",{className:"flex-1 h-9 bg-gray-100 rounded-full flex items-center px-3",children:[e.jsx(is,{size:16,className:"text-gray-400"}),e.jsx("input",{ref:N,type:"text",value:n,onChange:e=>i(e.target.value),onKeyPress:e=>"Enter"===e.key&&w(),placeholder:"æœç´¢ä½ æ„Ÿå…´è¶£çš„å†…å®¹",className:"flex-1 ml-2 text-[14px] bg-transparent outline-none"}),n&&e.jsx("button",{onClick:()=>{i(""),v(!1)},className:"w-5 h-5 flex items-center justify-center active:opacity-60",children:e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M15 9l-6 6M9 9l6 6",strokeLinecap:"round"})]})})]}),e.jsx("button",{onClick:()=>w(),disabled:!n.trim(),className:`text-[15px] ${n.trim()?"text-[#ff6c00]":"text-gray-400"} active:opacity-60`,children:"æœç´¢"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:j?f?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-3 border-[#ff6c00] border-t-transparent rounded-full"})}):0===c.length?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-gray-400",children:[e.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",className:"mb-4 opacity-30",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("path",{d:"M21 21l-4.35-4.35",strokeLinecap:"round"})]}),e.jsx("p",{className:"text-[14px]",children:"æœªæ‰¾åˆ°ç›¸å…³å†…å®¹"})]}):e.jsxs("div",{className:"bg-white mt-2",children:[e.jsx("div",{className:"flex border-b border-gray-100",children:[{key:"posts",label:"å¸–å­"},{key:"topics",label:"è¯é¢˜"},{key:"users",label:"ç”¨æˆ·"}].map(t=>e.jsxs("button",{onClick:()=>p(t.key),className:"flex-1 py-3 text-center relative "+(g===t.key?"text-[#ff6c00] font-medium":"text-gray-600"),children:[t.label,g===t.key&&e.jsx("div",{className:"absolute bottom-0 left-1/2 transform -translate-x-1/2 w-6 h-[3px] bg-[#ff6c00] rounded-t-full"})]},t.key))}),e.jsx("div",{children:c.map(t=>e.jsxs("div",{onClick:()=>a(`/forum/post/${t.id}`),className:"p-4 border-b border-gray-50 active:bg-gray-50",children:[e.jsx("div",{className:"text-[14px] text-gray-900 line-clamp-2 mb-1",children:t.content}),e.jsxs("div",{className:"text-[12px] text-gray-400",children:[t.authorName," Â· ",t.likeCount," èµž Â· ",t.commentCount," è¯„è®º"]})]},t.id))})]}):e.jsxs(e.Fragment,{children:[0===x.length?null:e.jsxs("div",{className:"bg-white mt-2 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-[15px] font-medium text-gray-900",children:"æœç´¢åŽ†å²"}),e.jsx("button",{onClick:k,className:"text-[13px] text-gray-500 active:opacity-60",children:"æ¸…ç©º"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:x.map((t,s)=>e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-gray-50 rounded-full",children:[e.jsx("button",{onClick:()=>(e=>{i(e),w(e)})(t),className:"text-[14px] text-gray-700 active:opacity-60",children:t}),e.jsx("button",{onClick:()=>(e=>{const t=x.filter(t=>t!==e);m(t),localStorage.setItem("forum_search_history",JSON.stringify(t))})(t),className:"w-4 h-4 flex items-center justify-center active:opacity-60",children:e.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12",strokeLinecap:"round"})})})]},s))})]}),e.jsxs("div",{className:"bg-white mt-2 p-4",children:[e.jsx("div",{className:"mb-3",children:e.jsx("span",{className:"text-[15px] font-medium text-gray-900",children:"çƒ­é—¨è¯é¢˜"})}),e.jsx("div",{className:"space-y-3",children:h.map((t,s)=>e.jsxs("button",{onClick:()=>(e=>{i(e),w(e)})(t.name),className:"w-full flex items-center gap-3 active:opacity-60",children:[e.jsx("div",{className:"w-6 h-6 rounded flex items-center justify-center text-[12px] font-bold "+(s<3?"bg-gradient-to-r from-orange-400 to-red-400 text-white":"bg-gray-100 text-gray-600"),children:s+1}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsxs("div",{className:"text-[15px] text-gray-900 font-medium",children:["#",t.name]}),e.jsxs("div",{className:"text-[12px] text-gray-400",children:[(t.count/1e4).toFixed(1),"w è®¨è®º"]})]}),e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-400",children:e.jsx("path",{d:"M9 18l6-6-6-6",strokeLinecap:"round"})})]},s))})]})]})}),e.jsxs("div",{className:"bg-white border-t border-gray-100 flex items-center justify-around py-2",children:[e.jsxs("button",{onClick:()=>a("/forum"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"é¦–é¡µ"})]}),e.jsxs("button",{onClick:()=>a("/forum/topics"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M7 20l4-16m2 16l4-16M6 9h14M4 15h14",strokeLinecap:"round"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"è¯é¢˜"})]}),e.jsx("button",{onClick:()=>a("/forum/publish"),className:"flex flex-col items-center -mt-3 active:scale-95 transition-transform",children:e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-[#ff8140] to-[#ff6c00] rounded-full flex items-center justify-center shadow-lg",children:e.jsx(cs,{size:24,className:"text-white"})})}),e.jsxs("button",{onClick:()=>a("/forum/notifications"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"æ¶ˆæ¯"})]}),e.jsxs("button",{onClick:()=>a("/forum/profile"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"æˆ‘"})]})]})]})}},Symbol.toStringTag,{value:"Module"})),jn=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),[l,n]=t.useState([]),[i,c]=t.useState("hot");t.useEffect(()=>{d();const e=setInterval(()=>{d()},3e3);return()=>clearInterval(e)},[]);const d=()=>{const e=localStorage.getItem("forum_topics_list");let t=[];if(e)try{t=JSON.parse(e)}catch(l){}const s=localStorage.getItem("forum_deleted_topics"),a=s?JSON.parse(s):[],r=[{id:"default_1",name:"ä»Šæ—¥çƒ­æœ",description:"å®žæ—¶çƒ­ç‚¹ï¼Œå¤§å®¶éƒ½åœ¨çœ‹",postsCount:128900,followersCount:456700,isFollowing:!1,isHot:!0},{id:"default_2",name:"ç§‘æŠ€å‰æ²¿",description:"AIã€ç¼–ç¨‹ã€å‰æ²¿ç§‘æŠ€è®¨è®º",postsCount:89600,followersCount:234500,isFollowing:!1,isHot:!0},{id:"default_3",name:"ç¾Žé£Ÿåˆ†äº«",description:"åƒè´§å¤©å ‚ï¼Œåˆ†äº«ç¾Žé£Ÿ",postsCount:67800,followersCount:189e3,isFollowing:!1,isHot:!0},{id:"default_4",name:"æ¸¸æˆå¤©åœ°",description:"æ¸¸æˆèµ„è®¯ã€æ”»ç•¥ã€äº¤æµ",postsCount:145600,followersCount:567800,isFollowing:!1,isHot:!0},{id:"default_5",name:"æ‘„å½±åˆ†äº«",description:"è®°å½•ç”Ÿæ´»ï¼Œåˆ†äº«ç¾Žå¥½çž¬é—´",postsCount:45600,followersCount:123400,isFollowing:!1,isHot:!1}].filter(e=>!a.includes(e.id));n([...t,...r])},x=e=>e<1e4?(e/1e3).toFixed(1)+"k":(e/1e4).toFixed(1)+"w",m="following"===i?l.filter(e=>e.isFollowing):l;return e.jsxs("div",{className:"h-screen flex flex-col bg-[#f7f7f7]",children:[e.jsxs("div",{className:"glass-effect border-b border-white/30 shadow-sm flex-shrink-0",children:[r&&e.jsx(ua,{}),e.jsxs("div",{className:"px-4 py-2.5 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a("/forum"),className:"w-9 h-9 flex items-center justify-center active:opacity-60",children:e.jsx(os,{size:22,className:"text-gray-800"})}),e.jsx("h1",{className:"text-[17px] font-semibold text-gray-900",children:"è¯é¢˜"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{confirm("ç¡®å®šè¦æ¢å¤æ‰€æœ‰å·²åˆ é™¤çš„é¢„è®¾è¯é¢˜å—ï¼Ÿ")&&(localStorage.removeItem("forum_deleted_topics"),d())},className:"w-9 h-9 flex items-center justify-center active:opacity-60",title:"æ¢å¤å·²åˆ é™¤è¯é¢˜",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-800",children:[e.jsx("path",{d:"M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("polyline",{points:"9 22 9 12 15 12 15 22",strokeLinecap:"round",strokeLinejoin:"round"})]})}),e.jsx("button",{onClick:()=>a("/forum/search"),className:"w-9 h-9 flex items-center justify-center active:opacity-60",children:e.jsx(is,{size:20,className:"text-gray-800"})}),e.jsx("button",{onClick:()=>a("/forum/create-topic"),className:"w-9 h-9 flex items-center justify-center active:opacity-60",children:e.jsx(cs,{size:20,className:"text-[#ff6c00]"})})]})]}),e.jsxs("div",{className:"flex items-center px-4 pb-2.5",children:[e.jsx("button",{onClick:()=>c("hot"),className:"px-3 py-1.5 text-[14px] rounded-full transition-all mr-3 "+("hot"===i?"bg-[#ff6c00] text-white font-medium":"text-gray-700 hover:bg-gray-100"),children:"çƒ­é—¨"}),e.jsx("button",{onClick:()=>c("following"),className:"px-3 py-1.5 text-[14px] rounded-full transition-all "+("following"===i?"bg-[#ff6c00] text-white font-medium":"text-gray-700 hover:bg-gray-100"),children:"å…³æ³¨"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:0===m.length?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-gray-400",children:[e.jsx("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",className:"mb-4 opacity-30",children:e.jsx("path",{d:"M7 20l4-16m2 16l4-16M6 9h14M4 15h14",strokeWidth:"2"})}),e.jsx("p",{className:"text-[14px]",children:"æš‚æ— å…³æ³¨çš„è¯é¢˜"})]}):e.jsx("div",{children:m.map((t,s)=>e.jsx("div",{onClick:()=>a(`/forum/topic/${t.id}`),className:"bg-white mb-2 p-4 active:bg-gray-50",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0 "+(t.isHot&&s<3?"bg-gradient-to-br from-[#ff8140] to-[#ff6c00]":"bg-gray-100"),children:t.isHot&&s<3?e.jsx("span",{className:"text-white font-bold text-[16px]",children:s+1}):e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-500",children:e.jsx("path",{d:"M7 20l4-16m2 16l4-16M6 9h14M4 15h14",strokeLinecap:"round"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("h3",{className:"text-[16px] font-semibold text-gray-900",children:["#",t.name]}),t.isHot&&e.jsx("span",{className:"px-1.5 py-0.5 bg-red-50 text-red-500 text-[11px] rounded",children:"çƒ­"})]}),e.jsx("p",{className:"text-[13px] text-gray-500 mb-2",children:t.description}),e.jsxs("div",{className:"flex items-center gap-3 text-[12px] text-gray-400",children:[e.jsxs("span",{children:[x(t.postsCount)," å¸–å­"]}),e.jsxs("span",{children:["Â· ",x(t.followersCount)," äººå…³æ³¨"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("button",{onClick:e=>{var s;e.stopPropagation(),s=t.id,n(e=>e.map(e=>e.id===s?{...e,isFollowing:!e.isFollowing}:e))},className:"px-4 py-1.5 rounded-full text-[13px] font-medium transition-all "+(t.isFollowing?"bg-gray-100 text-gray-600 border border-gray-200":"bg-[#ff6c00] text-white"),children:t.isFollowing?"å·²å…³æ³¨":"å…³æ³¨"}),e.jsx("button",{onClick:e=>((e,t)=>{if(t.stopPropagation(),confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè¯é¢˜å—ï¼Ÿ")){if(e.startsWith("default_")){const t=localStorage.getItem("forum_deleted_topics"),s=t?JSON.parse(t):[];s.push(e),localStorage.setItem("forum_deleted_topics",JSON.stringify(s))}else{const t=localStorage.getItem("forum_topics_list");if(t){const s=JSON.parse(t).filter(t=>t.id!==e);localStorage.setItem("forum_topics_list",JSON.stringify(s))}}d()}})(t.id,e),className:"w-8 h-8 flex items-center justify-center text-gray-400 hover:text-red-500 active:opacity-60 transition-colors",title:"åˆ é™¤è¯é¢˜",children:e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2M10 11v6M14 11v6",strokeLinecap:"round",strokeLinejoin:"round"})})})]})]})},t.id))})}),e.jsxs("div",{className:"bg-white border-t border-gray-100 flex items-center justify-around py-2",children:[e.jsxs("button",{onClick:()=>a("/forum"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"é¦–é¡µ"})]}),e.jsxs("button",{className:"flex flex-col items-center gap-1 py-1",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",className:"text-[#ff6c00]",children:e.jsx("path",{d:"M7 20l4-16m2 16l4-16M6 9h14M4 15h14"})}),e.jsx("span",{className:"text-[11px] text-[#ff6c00] font-medium",children:"è¯é¢˜"})]}),e.jsx("button",{onClick:()=>a("/forum/publish"),className:"flex flex-col items-center -mt-3 active:scale-95 transition-transform",children:e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-[#ff8140] to-[#ff6c00] rounded-full flex items-center justify-center shadow-lg",children:e.jsx(cs,{size:24,className:"text-white"})})}),e.jsxs("button",{onClick:()=>a("/forum/notifications"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"æ¶ˆæ¯"})]}),e.jsxs("button",{onClick:()=>a("/forum/profile"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"æˆ‘"})]})]})]})}},Symbol.toStringTag,{value:"Module"})),vn=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),[l,n]=t.useState(""),[i,c]=t.useState("");return e.jsxs("div",{className:"h-screen flex flex-col bg-white",children:[e.jsxs("div",{className:"glass-effect border-b border-white/30 shadow-sm flex-shrink-0",children:[r&&e.jsx(ua,{}),e.jsxs("div",{className:"px-4 py-2.5 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a(-1),className:"text-[15px] text-gray-700 active:opacity-60",children:"å–æ¶ˆ"}),e.jsx("h1",{className:"text-[17px] font-semibold text-gray-900",children:"åˆ›å»ºè¯é¢˜"}),e.jsx("button",{onClick:async()=>{if(!l.trim())return void alert("è¯·è¾“å…¥è¯é¢˜åç§°");if(!i.trim())return void alert("è¯·è¾“å…¥è¯é¢˜ä»‹ç»");const e={id:`topic_gen_${Date.now()}`,topicName:l.trim(),topicDesc:i.trim(),status:"generating",startTime:Date.now()};localStorage.setItem("forum_generating_task",JSON.stringify(e)),alert("è¯é¢˜åˆ›å»ºæˆåŠŸï¼\nAIæ­£åœ¨åŽå°ç”Ÿæˆå†…å®¹ï¼Œä½ å¯ä»¥å…ˆåŽ»åšå…¶ä»–äº‹æƒ…\nç”Ÿæˆå®ŒæˆåŽä¼šè‡ªåŠ¨æ˜¾ç¤ºåœ¨è¯é¢˜åˆ—è¡¨ä¸­"),a("/forum/topics");try{const t=await qt(l.trim(),i.trim()),s=JSON.parse(localStorage.getItem("forum_topics_list")||"[]"),a={id:`topic_${Date.now()}`,name:l.trim(),description:i.trim(),cover:"",postsCount:t.posts.length,followersCount:Math.floor(5e3*Math.random())+1e3,isFollowing:!0,isHot:!0,createdAt:Date.now(),users:t.users,posts:t.posts};s.unshift(a),localStorage.setItem("forum_topics_list",JSON.stringify(s));const r={...e,status:"completed",topicId:a.id};localStorage.setItem("forum_generating_task",JSON.stringify(r))}catch(t){const s={...e,status:"failed",error:t.message};localStorage.setItem("forum_generating_task",JSON.stringify(s))}},disabled:!l.trim()||!i.trim(),className:"px-4 py-1.5 rounded-full text-[14px] font-medium "+(l.trim()&&i.trim()?"bg-[#ff6c00] text-white active:opacity-80":"bg-gray-200 text-gray-400"),children:"åˆ›å»º"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-[14px] text-gray-700 font-medium mb-2",children:"è¯é¢˜åç§°"}),e.jsx("input",{type:"text",value:l,onChange:e=>n(e.target.value),maxLength:20,placeholder:"ä¾‹å¦‚ï¼šAIæŠ€æœ¯è®¨è®ºã€ç¾Žé£Ÿåˆ†äº«ã€æ¸¸æˆæ”»ç•¥",className:"w-full px-4 py-3 border border-gray-200 rounded-lg text-[15px] outline-none focus:border-[#ff6c00]"}),e.jsxs("div",{className:"flex items-center justify-between mt-1 text-[12px] text-gray-400",children:[e.jsxs("span",{children:["è¯é¢˜åç§°ä¼šæ˜¾ç¤ºä¸º #",l||"è¯é¢˜åç§°"]}),e.jsxs("span",{children:[l.length,"/20"]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-[14px] text-gray-700 font-medium mb-2",children:"è¯é¢˜ä»‹ç»"}),e.jsx("textarea",{value:i,onChange:e=>c(e.target.value),maxLength:200,rows:4,placeholder:"ç®€å•ä»‹ç»è¿™ä¸ªè¯é¢˜çš„å†…å®¹å’Œè®¨è®ºæ–¹å‘...",className:"w-full px-4 py-3 border border-gray-200 rounded-lg text-[15px] outline-none focus:border-[#ff6c00] resize-none"}),e.jsxs("div",{className:"flex items-center justify-between mt-1 text-[12px] text-gray-400",children:[e.jsx("span",{children:"AIä¼šæ ¹æ®ä»‹ç»ç”Ÿæˆç›¸å…³è®¨è®º"}),e.jsxs("span",{children:[i.length,"/200"]})]})]})]})]})}},Symbol.toStringTag,{value:"Module"})),yn=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{var a,l,n;const i=s(),{id:c}=r(),{showStatusBar:d}=o(),[x,m]=t.useState(null),[h,u]=t.useState([]),[g,p]=t.useState([]),[f,b]=t.useState(null),[j,v]=t.useState(""),[y,N]=t.useState([]),[w,k]=t.useState(!1);t.useEffect(()=>{var e;if(!c)return void i("/forum/topics",{replace:!0});const t=JSON.parse(localStorage.getItem("forum_topics_list")||"[]").find(e=>e.id===c);if(!t)return alert("è¯é¢˜ä¸å­˜åœ¨"),void i("/forum/topics",{replace:!0});m(t);const s=[{id:"currentUser",name:"æˆ‘",bio:"è¿™æ˜¯æˆ‘çš„è´¦å·",avatar:"ðŸ˜Š",followers:0},...t.users||[]];p(s);const a=(t.posts||[]).map(e=>({...e,comments:e.comments||[]}));u(a);const r=[...JSON.parse(localStorage.getItem("forum_npc_users")||"[]")];null==(e=t.users)||e.forEach(e=>{r.find(t=>t.id===e.id)||r.push({id:e.id,name:e.name,avatar:e.avatar,bio:e.bio||"è¿™ä¸ªäººå¾ˆæ‡’ï¼Œä»€ä¹ˆéƒ½æ²¡ç•™ä¸‹",followers:e.followers||Math.floor(500*Math.random())+50,following:Math.floor(200*Math.random())+20,posts:0})}),localStorage.setItem("forum_npc_users",JSON.stringify(r))},[c]);const C=e=>{const t=Date.now()-e,s=Math.floor(t/6e4),a=Math.floor(t/36e5),r=Math.floor(t/864e5);if(s<1)return"åˆšåˆš";if(s<60)return`${s}åˆ†é’Ÿå‰`;if(a<24)return`${a}å°æ—¶å‰`;if(r<7)return`${r}å¤©å‰`;const l=new Date(e);return`${l.getMonth()+1}-${l.getDate()}`},S=e=>e<1e3?e.toString():e<1e4?(e/1e3).toFixed(1)+"k":(e/1e4).toFixed(1)+"w",I=e=>g.find(t=>t.id===e),_=()=>{if(!j.trim()||!f)return;const e={id:`user_c_${Date.now()}`,authorId:"currentUser",content:j.trim(),likes:0,timestamp:Date.now(),replyTo:f.commentId||void 0,isUserComment:!0},t=h.map(t=>{if(t.id===f.postId){return{...t,comments:[...t.comments||[],e]}}return t});if(u(t),N([...y,{...e,postId:f.postId}]),x){const e=JSON.parse(localStorage.getItem("forum_topics_list")||"[]").map(e=>e.id===x.id?{...e,posts:t}:e);localStorage.setItem("forum_topics_list",JSON.stringify(e))}v(""),b(null)},M=e=>{let t=[...h];e.forEach(e=>{const s=y.find(t=>t.id===e.targetCommentId);if(s){const a=g.find(t=>t.id===e.userId);t=t.map(t=>{if(t.id===s.postId){const s={id:`ai_c_${Date.now()}_${Math.random()}`,authorId:e.userId,content:e.content,likes:Math.floor(20*Math.random()),timestamp:Date.now()+6e5*Math.random(),replyTo:e.targetCommentId};return a&&Kt({type:"comment",fromUserId:e.userId,fromUserName:a.name,fromUserAvatar:a.avatar,content:e.content,postId:t.id,commentId:s.id,isRead:!1}),{...t,comments:[...t.comments,s]}}return t})}}),u(t);const s=JSON.parse(localStorage.getItem("forum_topics_list")||"[]").map(e=>e.id===x.id?{...e,posts:t,postsCount:t.length}:e);localStorage.setItem("forum_topics_list",JSON.stringify(s))};return x?e.jsxs("div",{className:"h-screen flex flex-col bg-[#f7f7f7]",children:[e.jsxs("div",{className:"glass-effect border-b border-white/30 shadow-sm flex-shrink-0",children:[d&&e.jsx(ua,{}),e.jsxs("div",{className:"px-4 py-2.5 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>i("/forum/topics"),className:"w-9 h-9 flex items-center justify-center active:opacity-60",children:e.jsx(os,{size:22,className:"text-gray-800"})}),e.jsxs("h1",{className:"text-[17px] font-semibold text-gray-900",children:["#",x.name]}),e.jsx("button",{onClick:async()=>{var e,t,s;if(0!==y.length){k(!0);try{const a=localStorage.getItem("apiSettings");if(!a)throw new Error("è¯·å…ˆé…ç½®API");const r=JSON.parse(a),l=`ä½ æ˜¯è®ºå›äº’åŠ¨ç”Ÿæˆå™¨ã€‚ç”¨æˆ·åœ¨è¯é¢˜"${x.name}"ä¸­å‘äº†${y.length}æ¡è¯„è®ºã€‚\n\nç”¨æˆ·çš„è¯„è®ºï¼š\n${y.map((e,t)=>{const s=h.find(t=>t.id===e.postId),a=null==s?void 0:s.comments.find(t=>t.id===e.replyTo),r=a?I(a.authorId):null;return`ã€è¯„è®º${t+1}ã€‘ID:${e.id} å›žå¤@${null==r?void 0:r.name}è¯´ï¼š"${e.content}"`}).join("\n")}\n\nçŽ°æœ‰ç”¨æˆ·åˆ—è¡¨ï¼š\n${g.filter(e=>"currentUser"!==e.id).slice(0,10).map(e=>`${e.id}|${e.name}`).join("\n")}\n\nè¯·ç”Ÿæˆ3-5æ¡å›žå¤ï¼Œæ¯è¡Œä¸€ä¸ªï¼Œæ ¼å¼ï¼š\nå›žå¤|è¯„è®ºID|ç”¨æˆ·ID|å›žå¤å†…å®¹\n\nç¤ºä¾‹ï¼š\nå›žå¤|user_c_1234567890|user1|å“ˆå“ˆè¯´å¾—å¯¹\nå›žå¤|user_c_1234567890|user3|æ¥¼ä¸»è§‚ç‚¹æˆ‘ä¸åŒæ„\nå›žå¤|user_c_1234567890|user5|æœ‰é“ç†è¯¶\n\nè¦æ±‚ï¼š\n- å†…å®¹çœŸå®žè‡ªç„¶ï¼Œ15-30å­—\n- ä¸åŒç”¨æˆ·æœ‰ä¸åŒæ€åº¦\n- ç›´æŽ¥è¾“å‡ºï¼Œä¸è¦ä»£ç å—æ ‡è®°\n- æ¯è¡Œæ ¼å¼å¿…é¡»æ˜¯ï¼šå›žå¤|è¯„è®ºID|ç”¨æˆ·ID|å›žå¤å†…å®¹\n`,n=await fetch(r.baseUrl+"/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.apiKey}`},body:JSON.stringify({model:r.model,messages:[{role:"user",content:l}],temperature:.9,max_tokens:2e3})});if(!n.ok)throw new Error("APIè°ƒç”¨å¤±è´¥");const i=await n.json(),c=((null==(s=null==(t=null==(e=i.choices)?void 0:e[0])?void 0:t.message)?void 0:s.content)||"").split("\n").filter(e=>e.trim().startsWith("å›žå¤"));if(0===c.length)throw new Error("AIæ²¡æœ‰ç”Ÿæˆå›žå¤");const o=[];c.forEach(e=>{const t=e.split("|");4===t.length&&o.push({targetCommentId:t[1].trim(),userId:t[2].trim(),content:t[3].trim()})}),M(o),alert(`âœ¨ AIç”Ÿæˆå®Œæˆï¼æ”¶åˆ° ${o.length} æ¡å›žå¤`)}catch(a){alert("ç”Ÿæˆå¤±è´¥ï¼š"+a.message)}finally{k(!1)}}else alert("ä½ è¿˜æ²¡æœ‰å‘è¡¨ä»»ä½•è¯„è®ºå“¦")},disabled:w||0===y.length,className:"w-9 h-9 flex items-center justify-center "+(y.length>0?"active:scale-90 transition-transform":"opacity-30"),title:"ç”Ÿæˆäº’åŠ¨ååº”",children:w?e.jsx("div",{className:"w-5 h-5 border-2 border-[#ff6c00] border-t-transparent rounded-full animate-spin"}):e.jsx("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-[#ff6c00]",children:e.jsx("path",{d:"M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z",strokeLinecap:"round",strokeLinejoin:"round"})})})]})]}),e.jsxs("div",{className:"bg-white p-4 mb-2",children:[e.jsxs("h2",{className:"text-[18px] font-bold text-gray-900 mb-2",children:["#",x.name]}),e.jsx("p",{className:"text-[14px] text-gray-600 mb-3",children:x.description}),e.jsxs("div",{className:"flex items-center gap-4 text-[13px] text-gray-500",children:[e.jsxs("span",{children:[S(x.postsCount)," å¸–å­"]}),e.jsxs("span",{children:["Â· ",S(x.followersCount)," äººå…³æ³¨"]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:h.map(t=>{var s;const a=I(t.authorId);return a?e.jsxs("div",{className:"bg-white mb-2 p-4",children:[e.jsxs("div",{className:"flex items-start gap-2.5 mb-3",children:[e.jsx("button",{onClick:()=>"currentUser"!==t.authorId&&i(`/forum/user/${t.authorId}`),className:"w-11 h-11 rounded-full bg-gray-100 flex items-center justify-center text-2xl flex-shrink-0 active:opacity-70",disabled:"currentUser"===t.authorId,children:a.avatar}),e.jsxs("div",{className:"flex-1",children:[e.jsx("button",{onClick:()=>"currentUser"!==t.authorId&&i(`/forum/user/${t.authorId}`),className:"text-[15px] font-medium text-gray-900 active:text-[#ff6c00] text-left",disabled:"currentUser"===t.authorId,children:a.name}),e.jsxs("div",{className:"text-[12px] text-gray-400",children:[C(t.timestamp)," Â· ",S(a.followers)," ç²‰ä¸"]})]})]}),e.jsx("div",{className:"text-[15px] text-gray-800 leading-relaxed mb-3",children:t.content}),e.jsxs("div",{className:"flex items-center gap-4 text-[13px] pt-3 border-t border-gray-50",children:[e.jsxs("span",{className:"text-gray-500",children:["â¤ï¸ ",S(t.likes)]}),e.jsxs("button",{onClick:()=>b({postId:t.id,commentId:""}),className:"text-gray-500 hover:text-[#ff6c00] active:opacity-60 flex items-center gap-1",children:["ðŸ’¬ ",e.jsx("span",{children:(null==(s=t.comments)?void 0:s.length)||0})," ",e.jsx("span",{className:"text-[#ff6c00]",children:"è¯„è®º"})]})]}),t.comments&&t.comments.length>0&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-100 space-y-3",children:t.comments.map(s=>{const a=I(s.authorId),r=s.replyTo?t.comments.find(e=>e.id===s.replyTo):null,l=r?I(r.authorId):null;return e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>"currentUser"!==s.authorId&&i(`/forum/user/${s.authorId}`),className:"w-7 h-7 rounded-full bg-gray-100 flex items-center justify-center text-sm flex-shrink-0 active:opacity-70",disabled:"currentUser"===s.authorId,children:(null==a?void 0:a.avatar)||"ðŸ˜Š"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"text-[13px]",children:[e.jsx("button",{onClick:()=>"currentUser"!==s.authorId&&i(`/forum/user/${s.authorId}`),className:"font-medium text-gray-900 active:text-[#ff6c00]",disabled:"currentUser"===s.authorId,children:null==a?void 0:a.name}),l&&e.jsxs("span",{className:"text-gray-500",children:[" å›žå¤ ",e.jsxs("button",{onClick:()=>"currentUser"!==(null==r?void 0:r.authorId)&&i(`/forum/user/${null==r?void 0:r.authorId}`),className:"text-[#5b7599] active:text-[#ff6c00]",disabled:"currentUser"===(null==r?void 0:r.authorId),children:["@",l.name]})]}),e.jsxs("span",{className:"text-gray-700",children:[": ",s.content]})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-[11px] text-gray-400",children:[e.jsx("span",{children:C(s.timestamp)}),s.likes>0&&e.jsxs("span",{children:["â¤ï¸ ",s.likes]}),e.jsx("button",{onClick:()=>b({postId:t.id,commentId:s.id}),className:"text-[#ff6c00] hover:text-[#ff8533] active:opacity-60",children:"å›žå¤"})]})]})]},s.id)})})]},t.id):null})}),f&&e.jsxs("div",{className:"bg-white border-t border-gray-200 p-3 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-[13px] text-gray-600",children:f.commentId?`å›žå¤ @${(null==(n=I(null==(l=null==(a=h.find(e=>e.id===f.postId))?void 0:a.comments.find(e=>e.id===f.commentId))?void 0:l.authorId))?void 0:n.name)||"ç”¨æˆ·"}`:"è¯„è®º"}),e.jsx("button",{onClick:()=>{b(null),v("")},className:"ml-auto text-[12px] text-gray-500 active:opacity-60",children:"å–æ¶ˆ"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:j,onChange:e=>v(e.target.value),placeholder:"è¯´ç‚¹ä»€ä¹ˆ...",className:"flex-1 px-3 py-2 border border-gray-200 rounded-full text-[14px] outline-none focus:border-[#ff6c00]",autoFocus:!0,onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),_())}}),e.jsx("button",{onClick:_,disabled:!j.trim(),className:"px-4 py-2 rounded-full text-[14px] font-medium "+(j.trim()?"bg-[#ff6c00] text-white active:opacity-80":"bg-gray-100 text-gray-400"),children:"å‘é€"})]})]}),e.jsxs("div",{className:"bg-white border-t border-gray-100 flex items-center justify-around py-2",children:[e.jsxs("button",{onClick:()=>i("/forum"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"é¦–é¡µ"})]}),e.jsxs("button",{onClick:()=>i("/forum/topics"),className:"flex flex-col items-center gap-1 py-1",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",className:"text-[#ff6c00]",children:e.jsx("path",{d:"M7 20l4-16m2 16l4-16M6 9h14M4 15h14"})}),e.jsx("span",{className:"text-[11px] text-[#ff6c00] font-medium",children:"è¯é¢˜"})]}),e.jsx("button",{onClick:()=>i("/forum/publish"),className:"flex flex-col items-center -mt-3 active:scale-95 transition-transform",children:e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-[#ff8140] to-[#ff6c00] rounded-full flex items-center justify-center shadow-lg",children:e.jsx(cs,{size:24,className:"text-white"})})}),e.jsxs("button",{onClick:()=>i("/forum/notifications"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"æ¶ˆæ¯"})]}),e.jsxs("button",{onClick:()=>i("/forum/profile"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"æˆ‘"})]})]})]}):e.jsx("div",{className:"h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-3 border-[#ff6c00] border-t-transparent rounded-full"})})}},Symbol.toStringTag,{value:"Module"})),Nn=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),[l,n]=t.useState([]),[i,c]=t.useState([]),[d,x]=t.useState("all");t.useEffect(()=>{m()},[]);const m=()=>{const e=Xt();n(e);const t=Zt();c(t)},h=e=>{const t=Date.now()-e,s=Math.floor(t/6e4),a=Math.floor(t/36e5),r=Math.floor(t/864e5);if(s<1)return"åˆšåˆš";if(s<60)return`${s}åˆ†é’Ÿå‰`;if(a<24)return`${a}å°æ—¶å‰`;if(r<7)return`${r}å¤©å‰`;const l=new Date(e);return`${l.getMonth()+1}-${l.getDate()}`},u=t=>{switch(t){case"like":return e.jsx("div",{className:"w-10 h-10 bg-red-50 rounded-full flex items-center justify-center",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",className:"text-red-500",children:e.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})})});case"comment":return e.jsx("div",{className:"w-10 h-10 bg-blue-50 rounded-full flex items-center justify-center",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-blue-500",children:e.jsx("path",{d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})});case"follow":return e.jsx("div",{className:"w-10 h-10 bg-green-50 rounded-full flex items-center justify-center",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-green-500",children:e.jsx("path",{d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})});default:return null}};return e.jsxs("div",{className:"h-screen flex flex-col bg-[#f7f7f7]",children:[e.jsxs("div",{className:"glass-effect border-b border-white/30 shadow-sm flex-shrink-0",children:[r&&e.jsx(ua,{}),e.jsxs("div",{className:"px-4 py-2.5 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a("/forum"),className:"w-9 h-9 flex items-center justify-center active:opacity-60",children:e.jsx(os,{size:22,className:"text-gray-800"})}),e.jsx("h1",{className:"text-[17px] font-semibold text-gray-900",children:"æ¶ˆæ¯"}),e.jsx("div",{className:"w-9"})]}),e.jsx("div",{className:"flex items-center px-4 pb-2.5",children:[{key:"all",label:"å…¨éƒ¨"},{key:"like",label:"èµž"},{key:"comment",label:"è¯„è®º"},{key:"dm",label:"ç§ä¿¡"}].map(t=>e.jsxs("button",{onClick:()=>x(t.key),className:"px-3 py-1.5 text-[14px] rounded-full transition-all mr-3 "+(d===t.key?"bg-[#ff6c00] text-white font-medium":"text-gray-700 hover:bg-gray-100"),children:[t.label,"dm"===t.key&&Qt()>0&&e.jsx("span",{className:"ml-1 px-1.5 py-0.5 bg-red-500 text-white text-[11px] rounded-full",children:Qt()})]},t.key))})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:"dm"===d?0===i.length?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-gray-400",children:[e.jsx("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",className:"mb-4 opacity-30",children:e.jsx("path",{d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),e.jsx("p",{className:"text-[14px]",children:"æš‚æ— ç§ä¿¡"})]}):e.jsx("div",{children:i.map(t=>e.jsxs("div",{className:"flex items-start gap-3 p-4 border-b border-gray-50 active:bg-gray-50 cursor-pointer "+(t.isRead?"":"bg-blue-50/30"),onClick:()=>{Yt(t.id),m()},children:[e.jsx("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-gray-100 flex-shrink-0 flex items-center justify-center text-xl",children:t.fromUserAvatar}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-[14px] text-gray-900",children:t.fromUserName}),e.jsx("span",{className:"text-[12px] text-gray-400",children:h(t.timestamp)})]}),e.jsx("div",{className:"text-[13px] text-gray-600 line-clamp-2",children:t.content})]}),!t.isRead&&e.jsx("div",{className:"w-2 h-2 bg-[#ff6c00] rounded-full mt-2"})]},t.id))}):0===l.length?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-gray-400",children:[e.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",className:"mb-4 opacity-30",children:[e.jsx("path",{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}),e.jsx("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"})]}),e.jsx("p",{className:"text-[14px]",children:"æš‚æ— æ¶ˆæ¯"})]}):e.jsx("div",{children:l.filter(e=>"all"===d||e.type===d).map(t=>e.jsxs("div",{className:"flex items-start gap-3 p-4 border-b border-gray-50 active:bg-gray-50 "+(t.isRead?"":"bg-orange-50/30"),onClick:()=>t.postId&&a(`/forum/post/${t.postId}`),children:[u(t.type),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-[14px] text-gray-900",children:t.fromUserName}),e.jsx("span",{className:"text-[12px] text-gray-400",children:h(t.timestamp)})]}),e.jsx("div",{className:"text-[13px] text-gray-600",children:t.content})]}),!t.isRead&&e.jsx("div",{className:"w-2 h-2 bg-[#ff6c00] rounded-full mt-2"})]},t.id))})}),e.jsxs("div",{className:"bg-white border-t border-gray-100 flex items-center justify-around py-2",children:[e.jsxs("button",{onClick:()=>a("/forum"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"é¦–é¡µ"})]}),e.jsxs("button",{onClick:()=>a("/forum/topics"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M7 20l4-16m2 16l4-16M6 9h14M4 15h14",strokeLinecap:"round"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"è¯é¢˜"})]}),e.jsx("button",{onClick:()=>a("/forum/publish"),className:"flex flex-col items-center -mt-3 active:scale-95 transition-transform",children:e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-[#ff8140] to-[#ff6c00] rounded-full flex items-center justify-center shadow-lg",children:e.jsx(cs,{size:24,className:"text-white"})})}),e.jsxs("button",{className:"flex flex-col items-center gap-1 py-1",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",className:"text-[#ff6c00]",children:e.jsx("path",{d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})}),e.jsx("span",{className:"text-[11px] text-[#ff6c00] font-medium",children:"æ¶ˆæ¯"})]}),e.jsxs("button",{onClick:()=>a("/forum/profile"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"æˆ‘"})]})]})]})}},Symbol.toStringTag,{value:"Module"})),wn=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),{posts:l,getDrafts:n,toggleLike:i,toggleFavorite:c}=y(),[d,x]=t.useState("posts"),[m,h]=t.useState([]),[u,g]=t.useState([]),[p,f]=t.useState([]),[b,j]=t.useState(!1),[v,N]=t.useState("name"),[w,k]=t.useState(""),C=t.useRef(null),[S,I]=t.useState(()=>{const e=localStorage.getItem("forum_user_info");if(e)try{return JSON.parse(e)}catch{return{id:"user_current",name:"æˆ‘çš„æ˜µç§°",avatar:"",bio:"è¿™æ˜¯æˆ‘çš„ä¸ªäººç®€ä»‹",followersCount:128,followingCount:256,postsCount:89}}return{id:"user_current",name:"æˆ‘çš„æ˜µç§°",avatar:"",bio:"è¿™æ˜¯æˆ‘çš„ä¸ªäººç®€ä»‹",followersCount:128,followingCount:256,postsCount:89}}),_=e=>{I(e),localStorage.setItem("forum_user_info",JSON.stringify(e))};t.useEffect(()=>{M()},[d]);const M=()=>{const e=es(),t=l.filter(e=>e.authorId===S.id);h(t);const s=l.filter(e=>e.isFavorited);g(s);const a=n();f(a),I(t=>({...t,followersCount:e.followers,followingCount:e.following,postsCount:e.posts}))},z=e=>{var t;N(e),"avatar"===e?null==(t=C.current)||t.click():(k("name"===e?S.name:S.bio),j(!0))};return e.jsxs("div",{className:"h-screen flex flex-col bg-[#f7f7f7]",children:[e.jsxs("div",{className:"glass-effect border-b border-white/30 shadow-sm flex-shrink-0",children:[r&&e.jsx(ua,{}),e.jsxs("div",{className:"px-4 py-2.5 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a("/forum"),className:"w-9 h-9 flex items-center justify-center active:opacity-60",children:e.jsx(os,{size:22,className:"text-gray-800"})}),e.jsx("h1",{className:"text-[17px] font-semibold text-gray-900",children:"æˆ‘çš„"}),e.jsx("button",{className:"w-9 h-9 flex items-center justify-center active:opacity-60",children:e.jsx(Ss,{size:20,className:"text-gray-800"})})]})]}),e.jsxs("div",{className:"bg-white p-4 mb-2",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[e.jsxs("button",{onClick:()=>z("avatar"),className:"relative w-20 h-20 rounded-full overflow-hidden bg-gradient-to-br from-orange-400 to-pink-400 flex items-center justify-center flex-shrink-0 active:opacity-80",children:[S.avatar?e.jsx("img",{src:S.avatar,alt:"å¤´åƒ",className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-3xl font-bold text-white",children:S.name[0]}),e.jsx("div",{className:"absolute inset-0 bg-black/20 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity",children:e.jsx(_s,{size:24,className:"text-white"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("button",{onClick:()=>z("name"),className:"flex items-center gap-2 mb-2 active:opacity-60",children:[e.jsx("span",{className:"text-[18px] font-semibold text-gray-900",children:S.name}),e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-400",children:e.jsx("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z",strokeLinecap:"round"})})]}),e.jsx("button",{onClick:()=>z("bio"),className:"text-left w-full active:opacity-60",children:e.jsxs("div",{className:"text-[13px] text-gray-500 line-clamp-2 flex items-start gap-1",children:[e.jsx("span",{className:"flex-1",children:S.bio}),e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-400 mt-0.5 flex-shrink-0",children:e.jsx("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z",strokeLinecap:"round"})})]})})]})]}),e.jsxs("div",{className:"flex items-center gap-6 pt-3 border-t border-gray-50",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[18px] font-semibold text-gray-900",children:S.followingCount}),e.jsx("div",{className:"text-[12px] text-gray-500",children:"å…³æ³¨"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[18px] font-semibold text-gray-900",children:S.followersCount}),e.jsx("div",{className:"text-[12px] text-gray-500",children:"ç²‰ä¸"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[18px] font-semibold text-gray-900",children:m.length}),e.jsx("div",{className:"text-[12px] text-gray-500",children:"å¾®åš"})]})]})]}),e.jsx("div",{className:"bg-white mb-2",children:e.jsxs("button",{onClick:()=>a("/forum/memes"),className:"w-full px-4 py-3.5 flex items-center justify-between active:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-full bg-gradient-to-br from-orange-400 to-pink-400 flex items-center justify-center",children:e.jsx("span",{className:"text-lg",children:"ðŸŽ­"})}),e.jsx("span",{className:"text-[15px] text-gray-900",children:"æ¢—åº“ç®¡ç†"})]}),e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-400",children:e.jsx("path",{d:"M9 18l6-6-6-6",strokeLinecap:"round",strokeLinejoin:"round"})})]})}),e.jsx("input",{ref:C,type:"file",accept:"image/*",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(!s)return;const a=new FileReader;a.onload=e=>{var t;if(null==(t=e.target)?void 0:t.result){const t={...S,avatar:e.target.result};_(t)}},a.readAsDataURL(s)},className:"hidden"}),b&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-sm p-4",children:[e.jsx("h3",{className:"text-[17px] font-semibold text-gray-900 mb-3",children:"name"===v?"ä¿®æ”¹æ˜µç§°":"ä¿®æ”¹ä¸ªæ€§ç­¾å"}),"name"===v?e.jsx("input",{type:"text",value:w,onChange:e=>k(e.target.value),maxLength:20,placeholder:"è¯·è¾“å…¥æ˜µç§°",className:"w-full px-3 py-2.5 border border-gray-200 rounded-lg text-[15px] outline-none focus:border-[#ff6c00]",autoFocus:!0}):e.jsx("textarea",{value:w,onChange:e=>k(e.target.value),maxLength:100,placeholder:"è¯·è¾“å…¥ä¸ªæ€§ç­¾å",className:"w-full px-3 py-2.5 border border-gray-200 rounded-lg text-[15px] outline-none focus:border-[#ff6c00] resize-none",rows:3,autoFocus:!0}),e.jsxs("div",{className:"flex items-center justify-between mt-2 text-[12px] text-gray-400",children:[e.jsx("span",{children:"name"===v?"æœ€å¤š20ä¸ªå­—":"æœ€å¤š100ä¸ªå­—"}),e.jsxs("span",{children:[w.length,"/","name"===v?20:100]})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx("button",{onClick:()=>{j(!1),k("")},className:"flex-1 py-2.5 text-[15px] text-gray-700 border border-gray-200 rounded-full active:bg-gray-50",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:()=>{if(!w.trim())return;const e={...S,[v]:w.trim()};_(e),j(!1),k("")},disabled:!w.trim(),className:"flex-1 py-2.5 text-[15px] rounded-full "+(w.trim()?"bg-[#ff6c00] text-white active:opacity-80":"bg-gray-200 text-gray-400"),children:"ä¿å­˜"})]})]})}),e.jsx("div",{className:"bg-white flex items-center",children:[{key:"posts",label:"å¾®åš"},{key:"favorites",label:"æ”¶è—"},{key:"drafts",label:"è‰ç¨¿"}].map(t=>e.jsxs("button",{onClick:()=>x(t.key),className:"flex-1 py-3 text-center relative "+(d===t.key?"text-[#ff6c00] font-medium":"text-gray-600"),children:[t.label,d===t.key&&e.jsx("div",{className:"absolute bottom-0 left-1/2 transform -translate-x-1/2 w-6 h-[3px] bg-[#ff6c00] rounded-t-full"})]},t.key))}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:"posts"===d?0===m.length?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-gray-400",children:[e.jsx("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",className:"mb-4 opacity-30",children:e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",strokeWidth:"2"})}),e.jsx("p",{className:"text-[14px] mb-4",children:"è¿˜æ²¡æœ‰å‘å¸ƒå†…å®¹"}),e.jsx("button",{onClick:()=>a("/forum/publish"),className:"px-6 py-2.5 bg-[#ff6c00] text-white rounded-full text-[14px] active:opacity-80",children:"å‘å¸ƒç¬¬ä¸€æ¡å¾®åš"})]}):e.jsx("div",{children:m.map(t=>e.jsx(on,{post:t,onLike:i,onComment:e=>a(`/forum/post/${e}`),onFavorite:c},t.id))}):"favorites"===d?0===u.length?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-gray-400",children:[e.jsx("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",className:"mb-4 opacity-30",children:e.jsx("path",{d:"M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z",strokeWidth:"2"})}),e.jsx("p",{className:"text-[14px]",children:"æš‚æ— æ”¶è—"})]}):e.jsx("div",{children:u.map(t=>e.jsx(on,{post:t,onLike:i,onComment:e=>a(`/forum/post/${e}`),onFavorite:c},t.id))}):0===p.length?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-gray-400",children:[e.jsx("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",className:"mb-4 opacity-30",children:e.jsx("path",{d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z",strokeWidth:"2"})}),e.jsx("p",{className:"text-[14px]",children:"æš‚æ— è‰ç¨¿"})]}):e.jsx("div",{children:p.map(t=>e.jsxs("div",{className:"bg-white mb-2 p-4 active:bg-gray-50",onClick:()=>{alert("è‰ç¨¿ç¼–è¾‘åŠŸèƒ½å¼€å‘ä¸­")},children:[e.jsx("div",{className:"text-[14px] text-gray-800 line-clamp-3 mb-2",children:t.content}),e.jsxs("div",{className:"text-[12px] text-gray-400",children:["ä¿å­˜äºŽ ",new Date(t.timestamp).toLocaleString()]})]},t.id))})}),e.jsxs("div",{className:"bg-white border-t border-gray-100 flex items-center justify-around py-2",children:[e.jsxs("button",{onClick:()=>a("/forum"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"é¦–é¡µ"})]}),e.jsxs("button",{onClick:()=>a("/forum/topics"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M7 20l4-16m2 16l4-16M6 9h14M4 15h14",strokeLinecap:"round"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"è¯é¢˜"})]}),e.jsx("button",{onClick:()=>a("/forum/publish"),className:"flex flex-col items-center -mt-3 active:scale-95 transition-transform",children:e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-[#ff8140] to-[#ff6c00] rounded-full flex items-center justify-center shadow-lg",children:e.jsx(cs,{size:24,className:"text-white"})})}),e.jsxs("button",{onClick:()=>a("/forum/notifications"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"æ¶ˆæ¯"})]}),e.jsxs("button",{className:"flex flex-col items-center gap-1 py-1",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",className:"text-[#ff6c00]",children:e.jsx("path",{d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),e.jsx("span",{className:"text-[11px] text-[#ff6c00] font-medium",children:"æˆ‘"})]})]})]})}},Symbol.toStringTag,{value:"Module"})),kn=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{userId:l}=r(),{showStatusBar:n}=o(),[i,c]=t.useState(null),[d,x]=t.useState([]);t.useEffect(()=>{if(!l)return;const e=JSON.parse(localStorage.getItem("forum_npc_users")||"[]").find(e=>e.id===l);if(e){c(e);const t=JSON.parse(localStorage.getItem("forum_topics_list")||"[]"),s=[];t.forEach(e=>{if(e.posts){const t=e.posts.filter(e=>e.authorId===l);s.push(...t.map(t=>({...t,topicName:e.name})))}}),x(s)}},[l]);return i?e.jsxs("div",{className:"h-screen flex flex-col bg-[#f7f7f7]",children:[e.jsxs("div",{className:"glass-effect border-b border-white/30 shadow-sm flex-shrink-0",children:[n&&e.jsx(ua,{}),e.jsxs("div",{className:"px-4 py-2.5 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a(-1),className:"w-9 h-9 flex items-center justify-center active:opacity-60",children:e.jsx(os,{size:22,className:"text-gray-800"})}),e.jsx("h1",{className:"text-[17px] font-semibold text-gray-900",children:"ä¸ªäººä¸»é¡µ"}),e.jsx("button",{className:"w-9 h-9 flex items-center justify-center active:opacity-60",children:e.jsx(Bs,{size:20,className:"text-gray-800"})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"bg-white p-4 mb-2",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-orange-400 to-pink-400 flex items-center justify-center text-2xl flex-shrink-0",children:i.avatar||i.name[0]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-[18px] font-semibold text-gray-900 mb-1",children:i.name}),e.jsx("p",{className:"text-[14px] text-gray-600",children:i.bio||"è¿™ä¸ªäººå¾ˆæ‡’ï¼Œä»€ä¹ˆéƒ½æ²¡ç•™ä¸‹"})]})]}),e.jsxs("div",{className:"flex items-center gap-6 mb-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[18px] font-semibold text-gray-900",children:i.following}),e.jsx("div",{className:"text-[12px] text-gray-500",children:"å…³æ³¨"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[18px] font-semibold text-gray-900",children:i.followers}),e.jsx("div",{className:"text-[12px] text-gray-500",children:"ç²‰ä¸"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[18px] font-semibold text-gray-900",children:d.length}),e.jsx("div",{className:"text-[12px] text-gray-500",children:"å¸–å­"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"flex-1 py-2 bg-gray-100 text-gray-700 text-[14px] font-medium rounded-full active:bg-gray-200",children:"å…³æ³¨"}),e.jsx("button",{onClick:()=>{i&&(localStorage.setItem("forum_dm_target",JSON.stringify({id:i.id,name:i.name,avatar:i.avatar,posts:d.map(e=>({content:e.content,topicName:e.topicName,timestamp:e.timestamp}))})),alert(`å³å°†ç§ä¿¡ ${i.name}ï¼ŒåŠŸèƒ½å¼€å‘ä¸­...`))},className:"flex-1 py-2 bg-[#ff6c00] text-white text-[14px] font-medium rounded-full active:opacity-80",children:"ç§ä¿¡"})]})]}),e.jsxs("div",{className:"bg-white",children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-50",children:e.jsxs("span",{className:"text-[15px] font-medium text-gray-900",children:["TAçš„å¸–å­ (",d.length,")"]})}),0===d.length?e.jsx("div",{className:"py-20 text-center text-gray-400 text-[14px]",children:"æš‚æ— å¸–å­"}):e.jsx("div",{children:d.map(t=>e.jsxs("div",{className:"p-4 border-b border-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-[12px] text-gray-500",children:[e.jsxs("span",{children:["#",t.topicName]}),e.jsx("span",{children:"Â·"}),e.jsx("span",{children:new Date(t.timestamp).toLocaleDateString()})]}),e.jsx("div",{className:"text-[15px] text-gray-800 leading-relaxed",children:t.content}),t.comments&&e.jsxs("div",{className:"mt-2 text-[13px] text-gray-500",children:["ðŸ’¬ ",t.comments.length," è¯„è®º"]})]},t.id))})]})]})]}):e.jsx("div",{className:"h-screen flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400",children:"ç”¨æˆ·ä¸å­˜åœ¨"})})}},Symbol.toStringTag,{value:"Module"})),Cn=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),[l,n]=t.useState([]);return t.useEffect(()=>{n(vt)},[]),e.jsxs("div",{className:"h-screen flex flex-col bg-[#f7f7f7]",children:[r&&e.jsx(ua,{}),e.jsx("div",{className:"glass-effect border-b border-white/30 shadow-sm flex-shrink-0",children:e.jsxs("div",{className:"px-4 py-3 flex items-center gap-3",children:[e.jsx("button",{onClick:()=>a(-1),className:"w-9 h-9 flex items-center justify-center active:opacity-60",children:e.jsx(os,{size:22,className:"text-gray-800"})}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"æ¢—åº“"})]})}),e.jsxs("div",{className:"px-4 py-3 bg-blue-50 border-b border-blue-100",children:[e.jsx("p",{className:"text-sm text-blue-800 mb-2",children:"ðŸ’¡ è®ºå›ä¸Žå¾®ä¿¡å…±äº«æ¢—åº“ï¼ŒAIç”Ÿæˆè®ºå›å†…å®¹æ—¶ä¼šè‡ªç„¶èžå…¥è¿™äº›æ¢—"}),e.jsx("button",{onClick:()=>a("/settings-new"),className:"text-sm text-[#ff6c00] font-medium active:opacity-60",children:"â†’ å‰å¾€è®¾ç½®ç®¡ç†æ¢—åº“"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"bg-white p-4",children:[e.jsxs("h2",{className:"text-sm font-semibold text-gray-900 mb-3",children:["å½“å‰æ¢—åº“ (",l.length,"ä¸ª)"]}),0===l.length?e.jsx("div",{className:"py-8 text-center text-gray-400 text-sm",children:"æš‚æ— æ¢—ï¼ŒåŽ»è®¾ç½®é‡Œæ·»åŠ å§~"}):e.jsx("div",{className:"space-y-3",children:l.map(t=>e.jsxs("div",{className:"p-3 bg-gradient-to-r from-orange-50 to-pink-50 rounded-lg border border-orange-100",children:[e.jsx("div",{className:"text-base font-medium text-gray-900 mb-1",children:t["æ¢—"]}),e.jsx("div",{className:"text-sm text-gray-600",children:t["å«ä¹‰"]})]},t.id))})]})})]})}},Symbol.toStringTag,{value:"Module"}));export{cl as $,nr as A,Br as B,as as C,ls as D,rr as E,Fr as F,Or as G,Wr as H,$r as I,Vr as J,Jr as K,Hr as L,ms as M,Gr as N,qr as O,ns as P,Qr as Q,Ar as R,xs as S,Sr as T,xr as U,Yr as V,jr as W,al as X,rl as Y,il as Z,ss as _,rs as a,ol as a0,dl as a1,xl as a2,ml as a3,hl as a4,ul as a5,gl as a6,pl as a7,fl as a8,bl as a9,xn as aA,mn as aB,hn as aC,gn as aD,fn as aE,bn as aF,jn as aG,vn as aH,yn as aI,Nn as aJ,wn as aK,kn as aL,Cn as aM,jl as aa,vl as ab,yl as ac,$l as ad,Al as ae,Tl as af,Dl as ag,Bl as ah,Pl as ai,Wl as aj,Rl as ak,Vl as al,Jl as am,Hl as an,ql as ao,Kl as ap,Yl as aq,en as ar,tn as as,sn as at,an as au,rn as av,ln as aw,nn as ax,cn as ay,dn as az,ga as b,pa as c,va as d,ya as e,qa as f,Xa as g,Za as h,Qa as i,sr as j,ar as k,lr as l,ir as m,cr as n,or as o,dr as p,mr as q,hr as r,ur as s,vr as t,Cr as u,zr as v,Lr as w,Tr as x,Dr as y,Er as z};
