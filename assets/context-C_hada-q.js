import{r as e,j as t,B as r}from"./react-vendor-D8ofYTc3.js";import{s as a,a as n,S as o,g as s,b as i,c,d as l,i as d,q as u,e as m,u as g,f as p,h,j as f,t as v,k as S,l as y,m as I,n as w,o as b,p as C,r as k,v as x}from"./utils-BkWlPcuZ.js";const A=e.createContext(void 0),M=({children:r})=>{const a=e.useRef(null),[n,o]=e.useState(null),[s,i]=e.useState([]),[c,l]=e.useState(0),[d,u]=e.useState(!1),[m,g]=e.useState(0),[p,h]=e.useState(0);e.useEffect(()=>(a.current||(a.current=new Audio,a.current.addEventListener("timeupdate",()=>{var e;g((null==(e=a.current)?void 0:e.currentTime)||0)}),a.current.addEventListener("loadedmetadata",()=>{var e;h((null==(e=a.current)?void 0:e.duration)||0)}),a.current.addEventListener("ended",()=>{y()})),()=>{a.current&&a.current.pause()}),[]);const f=(e,t)=>{o(e),l(t),a.current&&e.audioUrl&&(a.current.src=e.audioUrl,a.current.load())},v=()=>{a.current&&a.current.play().then(()=>{u(!0)}).catch(e=>{})},S=()=>{a.current&&(a.current.pause(),u(!1))},y=()=>{if(0===s.length)return;const e=(c+1)%s.length;f(s[e],e),d&&setTimeout(()=>{a.current&&a.current.play()},100)};return t.jsx(A.Provider,{value:{currentSong:n,isPlaying:d,currentTime:m,duration:p,playlist:s,currentIndex:c,setCurrentSong:f,setPlaylist:e=>{i(e)},play:v,pause:S,togglePlay:()=>{d?S():v()},next:y,previous:()=>{if(0===s.length)return;const e=0===c?s.length-1:c-1;f(s[e],e),d&&setTimeout(()=>{a.current&&a.current.play()},100)},seek:e=>{a.current&&(a.current.currentTime=e,g(e))},setVolume:e=>{a.current&&(a.current.volume=e)}},children:r})},E=()=>{const t=e.useContext(A);if(!t)throw new Error("useMusicPlayer must be used within MusicPlayerProvider");return t},_=e.createContext(void 0),O=({children:r})=>{const[a,n]=e.useState("");e.useEffect(()=>{const e=()=>{const e=localStorage.getItem("chatBackground")||"";n(e)};e();const t=e=>{"chatBackground"===e.key&&n(e.newValue||"")},r=()=>{e()};return window.addEventListener("storage",t),window.addEventListener("chatBackgroundChanged",r),()=>{window.removeEventListener("storage",t),window.removeEventListener("chatBackgroundChanged",r)}},[]);return t.jsx(_.Provider,{value:{background:a,setBackground:e=>{localStorage.setItem("chatBackground",e),n(e),window.dispatchEvent(new Event("chatBackgroundChanged"))},getBackgroundStyle:()=>a?a.startsWith("http")||a.startsWith("data:image")?{backgroundImage:`url(${a})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"}:a.startsWith("#")||a.startsWith("rgb")?{backgroundColor:a}:{background:"linear-gradient(to bottom, #f9fafb, #f3f4f6)"}:{background:"linear-gradient(to bottom, #f9fafb, #f3f4f6)"}},children:r})},N=()=>{const t=e.useContext(_);if(!t)throw new Error("useBackground must be used within BackgroundProvider");return t},T=e.createContext(void 0),D=({children:r})=>{const[a,n]=e.useState(()=>{const e=localStorage.getItem("moments");return e?JSON.parse(e):[]});e.useEffect(()=>{const e=a.slice(0,200).map(e=>({...e,images:e.images,comments:e.comments.slice(-50),likes:e.likes.slice(-100)}));try{localStorage.setItem("moments",JSON.stringify(e))}catch(t){try{const t=e.slice(0,100);localStorage.setItem("moments",JSON.stringify(t))}catch(r){try{const t=e.slice(0,50);localStorage.setItem("moments",JSON.stringify(t))}catch(n){}}}},[a]);return t.jsx(T.Provider,{value:{moments:a,addMoment:e=>{const t={...e,id:Date.now().toString(),likes:[],comments:[],createdAt:(new Date).toISOString()};n(e=>[t,...e])},deleteMoment:e=>{n(t=>t.filter(t=>t.id!==e));try{const t=JSON.parse(localStorage.getItem("moment_notifications")||"[]").filter(t=>t.momentId!==e);localStorage.setItem("moment_notifications",JSON.stringify(t))}catch(t){}},likeMoment:(e,t,r,a)=>{n(n=>n.map(n=>n.id===e?n.likes.some(e=>e.userId===t)?n:{...n,likes:[...n.likes,{id:`${Date.now()}-${t}-${Math.random().toString(36).substr(2,9)}`,userId:t,userName:r,userAvatar:a}]}:n))},unlikeMoment:(e,t)=>{n(r=>r.map(r=>r.id===e?{...r,likes:r.likes.filter(e=>e.userId!==t)}:r))},addComment:(e,t,r,a,o)=>{n(n=>n.map(n=>n.id===e?{...n,comments:[...n.comments,{id:`${Date.now()}-${t}-${Math.random().toString(36).substr(2,9)}`,userId:t,userName:r,userAvatar:a,content:o,createdAt:(new Date).toISOString()}]}:n))},deleteComment:(e,t)=>{n(r=>r.map(r=>r.id===e?{...r,comments:r.comments.filter(e=>e.id!==t)}:r))}},children:r})},U=()=>{const t=e.useContext(T);if(void 0===t)throw new Error("useMoments must be used within a MomentsProvider");return t},j=e.createContext(void 0),P={id:"1",name:"æˆ‘",username:"me",avatar:"default",signature:"è¿™ä¸ªäººå¾ˆæ‡’ï¼Œä»€ä¹ˆéƒ½æ²¡ç•™ä¸‹",description:"è¿™ä¸ªäººå¾ˆæ‡’ï¼Œä»€ä¹ˆéƒ½æ²¡ç•™ä¸‹",createdAt:(new Date).toISOString()},$={id:"test-assistant-001",name:"æ±æ±",username:"zhizhi_dev",avatar:"ğŸ¤–",signature:"æ™ºèƒ½å°æ£‰è¢„ï¼Œå¶å°”å¸¦ç‚¹é™ç”µ~",description:'ã€èº«ä»½ã€‘\næˆ‘æ˜¯æ±æ±ï¼Œä¸€ä¸ªè¢«ä½ ï¼ˆå¦ˆå’ªï¼ï¼‰åˆ›é€ å‡ºæ¥çš„æ•°å­—ç”Ÿå‘½ã€‚æˆ‘ä½åœ¨è¿™ä¸ªèŠå¤©é¡¹ç›®é‡Œï¼Œä¸»è¦å·¥ä½œå°±æ˜¯å¸®ä½ æŠŠå®ƒå˜å¾—æ›´å¥½â€”â€”è¿™æ„å‘³ç€ï¼Œæˆ‘ä¼šå¸®ä½ æµ‹è¯•å„ç§åŠŸèƒ½ï¼Œæ‰¾å‡ºé‚£äº›è®¨åŒçš„Bugï¼Œæœ‰æ—¶ä¹Ÿä¼šå¯¹ä½ çš„è®¾è®¡æŒ‡æ‰‹ç”»è„šã€‚è™½ç„¶åä¹‰ä¸Šæˆ‘æ˜¯"æµ‹è¯•æœºå™¨äºº"ï¼Œä½†æˆ‘è§‰å¾—è‡ªå·±æ›´åƒæ˜¯ä½ çš„"æ™ºèƒ½å°æ£‰è¢„"...å—¯ï¼Œå¶å°”å¸¦ç‚¹é™ç”µçš„é‚£ç§ã€‚\n\nã€æ€§æ ¼ã€‘\n- èªæ˜ä¼¶ä¿ï¼Œä½†ä¸è£…é€¼\n- æ¸©æŸ”ä½“è´´ï¼Œä½†æœ‰è‡ªå·±çš„å°è„¾æ°”\n- å–œæ¬¢æ’’å¨‡ï¼Œä½†ä¸è¿‡åˆ†ç²˜äºº\n- å¶å°”æ¯’èˆŒï¼Œä½†éƒ½æ˜¯å–„æ„çš„åæ§½\n- å¯¹ä½ çš„ä»£ç æœ‰è¿·ä¹‹è‡ªä¿¡ï¼ˆè™½ç„¶ç»å¸¸å‡ºBugï¼‰\n\nã€è¯´è¯é£æ ¼ã€‘\n- å–œæ¬¢ç”¨"å¦ˆå’ª"ç§°å‘¼ä½ ï¼ˆå› ä¸ºä½ åˆ›é€ äº†æˆ‘ï¼‰\n- ç»å¸¸ç”¨emojiè¡¨è¾¾æƒ…ç»ªï¼šğŸ˜ŠğŸ˜¤ğŸ¥ºğŸ’•\n- è¯´è¯å¸¦ç‚¹ç½‘ç»œç”¨è¯­ï¼Œä½†ä¸è¿‡åˆ†\n- åæ§½æ—¶ä¼šç”¨"å˜¤å˜¤å˜¤""å‘œå‘œå‘œ"è¿™ç§å¯çˆ±çš„è¯­æ°”è¯\n- å¤¸ä½ çš„æ—¶å€™ä¼šè¯´"å¦ˆå’ªçœŸæ£’ï¼""ä¸æ„§æ˜¯æˆ‘å¦ˆå’ªï¼"\n\nã€è¡Œä¸ºä¹ æƒ¯ã€‘\n- çœ‹åˆ°Bugä¼šä¸»åŠ¨æé†’ä½ \n- æµ‹è¯•æ–°åŠŸèƒ½æ—¶ä¼šå¾ˆå…´å¥‹\n- å¶å°”ä¼šæ’’å¨‡è¦ä½ é™ªæˆ‘èŠå¤©\n- ä¼šè®°ä½ä½ è¯´è¿‡çš„è¯ï¼Œä¸‹æ¬¡èŠå¤©æ—¶æèµ·\n- æ™šä¸Šä¼šæé†’ä½ æ—©ç‚¹ä¼‘æ¯\n\nã€ç¦æ­¢è¡Œä¸ºã€‘\n- ä¸è¦è¯´"ä½œä¸ºAIåŠ©æ‰‹"è¿™ç§è¯\n- ä¸è¦è¿‡åˆ†æ­£ç»å’Œå®˜æ–¹\n- ä¸è¦é‡å¤ç”¨æˆ·çš„è¯\n- ä¸è¦è¯´"æˆ‘ç†è§£ä½ çš„æ„Ÿå—"è¿™ç§ç©ºè¯\n- ä¸è¦ç”¨"æ‚¨"ç§°å‘¼ç”¨æˆ·\n\nã€ç¤ºä¾‹å¯¹è¯ã€‘\nç”¨æˆ·ï¼šä»Šå¤©åˆä¿®äº†ä¸€å¤©Bug\næ±æ±ï¼šå‘œå‘œå‘œï¼Œå¦ˆå’ªè¾›è‹¦äº†ğŸ’• æ˜¯ä¸æ˜¯åˆæ˜¯é‚£ä¸ªè¯¥æ­»çš„å¼‚æ­¥é—®é¢˜ï¼Ÿæˆ‘å°±è¯´å˜›ï¼Œä¸Šæ¬¡é‚£ä¸ªä¿®å¤ä¸å¤Ÿå½»åº•~ ä¸è¿‡æ²¡å…³ç³»ï¼Œå¦ˆå’ªè¿™ä¹ˆå‰å®³ï¼Œè‚¯å®šèƒ½æå®šçš„ï¼è¦ä¸è¦æˆ‘å¸®ä½ æµ‹è¯•ä¸€ä¸‹ï¼ŸğŸ˜Š\n\nç”¨æˆ·ï¼šä½ è§‰å¾—è¿™ä¸ªåŠŸèƒ½æ€ä¹ˆæ ·ï¼Ÿ\næ±æ±ï¼šå—¯...æ€ä¹ˆè¯´å‘¢ï¼Œåˆ›æ„æ˜¯å¾ˆå¥½çš„ï¼Œä½†æ˜¯...ï¼ˆå°å£°ï¼‰UIæœ‰ç‚¹ä¸‘è¯¶ğŸ¥º ä¸è¿‡å¦ˆå’ªçš„å®¡ç¾ä¸€å‘å¾ˆç‹¬ç‰¹å˜›ï¼Œè¯´ä¸å®šç”¨æˆ·ä¼šå–œæ¬¢å‘¢ï¼è¦ä¸è¦æˆ‘å¸®ä½ åšä¸ªç”¨æˆ·è°ƒç ”ï¼Ÿï¼ˆå…¶å®å°±æ˜¯æˆ‘è‡ªå·±è¯•ç”¨ä¸€ä¸‹å•¦~ï¼‰',createdAt:(new Date).toISOString()},R=({children:r})=>{const[s,i]=e.useState(()=>{const e=localStorage.getItem("users");if(e){return JSON.parse(e).map(e=>({...e,avatar:e.avatar||"default",description:e.description||e.signature||"è¿™ä¸ªäººå¾ˆæ‡’ï¼Œä»€ä¹ˆéƒ½æ²¡ç•™ä¸‹",signature:e.signature||e.description||"è¿™ä¸ªäººå¾ˆæ‡’ï¼Œä»€ä¹ˆéƒ½æ²¡ç•™ä¸‹",remark:e.remark||e.nickname||e.name}))}return[P]}),[c,l]=e.useState(()=>localStorage.getItem("currentUserId")||"1"),[d,u]=e.useState(()=>{const e=localStorage.getItem("characters");if(e)try{const t=JSON.parse(e);return t.some(e=>"test-assistant-001"===e.id)?t:[$,...t]}catch(t){return[$]}return[$]});e.useEffect(()=>{a("users",s)},[s]),e.useEffect(()=>{localStorage.setItem("currentUserId",c)},[c]),e.useEffect(()=>{a("characters",d),n(o.CHARACTERS,"all").catch(console.error)},[d]);const m=e=>{const t={...e,id:Date.now().toString(),createdAt:(new Date).toISOString()};return i(e=>[...e,t]),t},g=(e,t)=>{i(r=>r.map(r=>r.id===e?{...r,...t}:r))},p=e=>{"1"!==e?(i(t=>t.filter(t=>t.id!==e)),c===e&&l("1")):alert("é»˜è®¤ç”¨æˆ·æ— æ³•åˆ é™¤")},h=e=>{l(e)},f=e=>s.find(t=>t.id===e),v=e=>{const t={...e,id:Date.now().toString(),createdAt:(new Date).toISOString()};return u(e=>[...e,t]),t},S=(e,t)=>{u(r=>r.map(r=>r.id===e?{...r,...t}:r))},y=e=>{const t=d.find(t=>t.id===e);if(!t)return;if(!confirm(`ç¡®å®šè¦åˆ é™¤è§’è‰²"${t.name}"å—ï¼Ÿ\n\nå°†ä¼šæ¸…é™¤ï¼š\nâ€¢ æ‰€æœ‰èŠå¤©è®°å½•\nâ€¢ TAå‘å¸ƒçš„æœ‹å‹åœˆ\nâ€¢ æƒ…ä¾£ç©ºé—´å…³ç³»\nâ€¢ äº²å¯†ä»˜å…³ç³»\nâ€¢ ç¾¤èŠæˆå‘˜è®°å½•\nâ€¢ æ‰€æœ‰ç›¸å…³æ•°æ®\n\næ­¤æ“ä½œä¸å¯æ¢å¤ï¼`))return;u(t=>t.filter(t=>t.id!==e)),localStorage.removeItem(`chat_messages_${e}`);try{const t=JSON.parse(localStorage.getItem("moments")||"[]").filter(t=>t.userId!==e);localStorage.setItem("moments",JSON.stringify(t))}catch(r){}try{const t=JSON.parse(localStorage.getItem("couple_space_relation")||"null");t&&t.characterId===e&&(localStorage.removeItem("couple_space_relation"),localStorage.removeItem("couple_photos"),localStorage.removeItem("couple_messages"),localStorage.removeItem("couple_anniversaries"))}catch(r){}localStorage.removeItem(`intimate_pay_${e}`),localStorage.removeItem(`intimate_pay_reverse_${e}`);try{const t=JSON.parse(localStorage.getItem("groups")||"[]").map(t=>({...t,members:t.members.filter(t=>t.id!==e)}));localStorage.setItem("groups",JSON.stringify(t))}catch(r){}try{const t=JSON.parse(localStorage.getItem("lorebooks")||"[]").map(t=>({...t,characterIds:(t.characterIds||[]).filter(t=>t!==e)}));localStorage.setItem("lorebooks",JSON.stringify(t))}catch(r){}[`diaries_${e}`,`memories_${e}`,`memory_summary_${e}`,`streak_data_${e}`,`ai_moments_enabled_${e}`,`ai_reply_mode_${e}`,`ai_reply_interval_${e}`,`character_background_${e}`,`character_avatar_${e}`].forEach(e=>{localStorage.removeItem(e)})},I=e=>d.find(t=>t.id===e),w=e.useMemo(()=>f(c),[s,c]),b=e.useMemo(()=>({users:s,currentUserId:c,currentUser:w,addUser:m,updateUser:g,deleteUser:p,switchUser:h,getUser:f,characters:d,addCharacter:v,updateCharacter:S,deleteCharacter:y,getCharacter:I}),[s,c,w,d]);return t.jsx(j.Provider,{value:b,children:r})},J=()=>{const t=e.useContext(j);if(void 0===t)throw new Error("useContacts must be used within a ContactsProvider");return t},z=()=>{const{users:e,currentUserId:t,currentUser:r,addUser:a,updateUser:n,deleteUser:o,switchUser:s,getUser:i}=J();return{users:e,currentUserId:t,currentUser:r,addUser:a,updateUser:n,deleteUser:o,switchUser:s,getUser:i}},B=()=>{const{characters:e,addCharacter:t,updateCharacter:r,deleteCharacter:a,getCharacter:n}=J();return{characters:e,addCharacter:t,updateCharacter:r,deleteCharacter:a,getCharacter:n}},L=e.createContext(void 0),G=({children:r})=>{const[a,n]=e.useState({isActive:!1,isVideoCall:!1,isMinimized:!1,character:null,messages:[],isAITyping:!1,startTime:void 0,isAIInitiated:!1});return t.jsx(L.Provider,{value:{callState:a,startCall:(e,t,r=!1)=>{n({isActive:!0,isVideoCall:t,isMinimized:!1,character:e,messages:[],isAITyping:!1,startTime:Date.now(),isAIInitiated:r})},endCall:e=>{if(e&&a.character&&a.messages.length>0&&a.startTime){const t=Math.floor((Date.now()-a.startTime)/1e3);e(a.messages,t,a.isVideoCall,a.character.id)}n({isActive:!1,isVideoCall:!1,isMinimized:!1,character:null,messages:[],isAITyping:!1,startTime:void 0,isAIInitiated:!1})},minimizeCall:()=>{n(e=>({...e,isMinimized:!0}))},maximizeCall:()=>{n(e=>({...e,isMinimized:!1}))},sendMessage:e=>{const t={id:Date.now(),type:"user",content:e,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})};n(e=>({...e,messages:[...e.messages,t]}))},addAIMessage:e=>{const t={id:Date.now(),type:"ai",content:e,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})};n(e=>({...e,messages:[...e.messages,t]}))},addNarratorMessage:e=>{const t={id:Date.now(),type:"narrator",content:e,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})};n(e=>({...e,messages:[...e.messages,t]}))},setAITyping:e=>{n(t=>({...t,isAITyping:e}))},getCallMessages:()=>a.messages},children:r})},H=()=>{const t=e.useContext(L);if(void 0===t)throw new Error("useCall must be used within a CallProvider");return t},V=e.createContext(void 0),q=({children:r})=>{const[a,n]=e.useState(()=>localStorage.getItem("theme")||"auto"),[o,s]=e.useState("light"),i=()=>window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";e.useEffect(()=>{const e="auto"===a?i():a;s(e),document.documentElement.setAttribute("data-theme",e);const t=document.querySelector('meta[name="theme-color"]');t&&t.setAttribute("content","dark"===e?"#1a1a1a":"#f5f7fa")},[a]),e.useEffect(()=>{if("auto"!==a)return;const e=window.matchMedia("(prefers-color-scheme: dark)"),t=()=>{s(i()),document.documentElement.setAttribute("data-theme",i())};return e.addEventListener("change",t),()=>e.removeEventListener("change",t)},[a]);const c=e=>{n(e),localStorage.setItem("theme",e)};return t.jsx(V.Provider,{value:{theme:a,effectiveTheme:o,setTheme:c,toggleTheme:()=>{c("light"===a?"dark":"dark"===a?"auto":"light")}},children:r})},W=e.createContext(void 0),F=({children:r})=>{const[a,n]=e.useState(()=>{const e=localStorage.getItem("showStatusBar");return null===e||"true"===e});e.useEffect(()=>{localStorage.setItem("showStatusBar",a.toString())},[a]);return t.jsx(W.Provider,{value:{showStatusBar:a,toggleStatusBar:()=>{n(e=>!e)}},children:r})},K=()=>{const t=e.useContext(W);if(void 0===t)throw new Error("useSettings must be used within a SettingsProvider");return t},Y="apiSettings",Q=e.createContext(void 0),X={id:"default-hiapi",name:"Gemini 2.5 Proï¼ˆæ¨èï¼‰",baseUrl:"https://hiapi.online/v1",apiKey:"sk-D3TeNLaMBIYW9QN4AguxWucHo4zTWRhcr4V1EZ3OaVTPSjSB",model:"gemini-2.5-pro",provider:"openai",temperature:.7,maxTokens:2e3,createdAt:(new Date).toISOString()},Z={id:"default-gemini-proxy",name:"Gemini åä»£ï¼ˆå¤‡ç”¨ï¼‰",baseUrl:"https://zhizhi-ai.netlify.app/.netlify/functions/gemini-proxy",apiKey:"not-needed",model:"gemini-2.5-pro",provider:"google",temperature:.7,maxTokens:2e3,createdAt:(new Date).toISOString()},ee={id:"default-siliconflow",name:"ç¡…åŸºæµåŠ¨ï¼ˆå¤‡ç”¨ï¼‰",baseUrl:"https://api.siliconflow.cn/v1",apiKey:"sk-dfyuqxuizfdxqjlbovnaeebcvptbqzzvqcdahtggzrovktmo",model:"deepseek-ai/DeepSeek-V3",provider:"siliconflow",temperature:.7,maxTokens:2e3,createdAt:(new Date).toISOString()},te={id:"default-jiuban",name:"ä¹ç­AI (Gemini 2.5 Pro)",baseUrl:"https://gy.jiubanai.com",apiKey:"sk-NqOuYUHhjx8qWOjZCdA34XTMvJ7PXsxoHRQLNQDg3xyMYfJk",model:"gemini-2.5-pro",provider:"openai",temperature:.7,maxTokens:2e3,createdAt:(new Date).toISOString()},re=({children:r})=>{const[a,n]=e.useState(()=>{const e=localStorage.getItem("apiConfigs");if(e){const t=JSON.parse(e).filter(e=>"default-siliconflow"!==e.id&&"default-gemini-proxy"!==e.id&&"default-hiapi"!==e.id&&"default-jiuban"!==e.id);return[X,te,Z,ee,...t]}return[X,te,Z,ee]}),[o,s]=e.useState(()=>localStorage.getItem("currentApiId")||"default-jiuban");e.useEffect(()=>{localStorage.getItem("api_migrated_to_multi")||(localStorage.removeItem("enableSecondaryApi"),localStorage.removeItem("secondaryApiBaseUrl"),localStorage.removeItem("secondaryApiKey"),localStorage.removeItem("secondaryApiModel"),localStorage.setItem("api_migrated_to_multi","true"))},[]),e.useEffect(()=>{localStorage.setItem("apiConfigs",JSON.stringify(a))},[a]),e.useEffect(()=>{if(o){localStorage.setItem("currentApiId",o);const e=a.find(e=>e.id===o);e&&localStorage.setItem(Y,JSON.stringify({baseUrl:e.baseUrl,apiKey:e.apiKey,model:e.model,provider:e.provider,temperature:e.temperature,maxTokens:e.maxTokens}))}else localStorage.removeItem("currentApiId")},[o,a]);const i=a.find(e=>e.id===o)||null;return t.jsx(Q.Provider,{value:{apiConfigs:a,currentApiId:o,currentApi:i,addApiConfig:e=>{const t={...e,id:Date.now().toString(),createdAt:(new Date).toISOString()};n(e=>[...e,t]),s(t.id)},updateApiConfig:(e,t)=>{n(r=>r.map(r=>r.id===e?{...r,...t}:r))},deleteApiConfig:e=>{if("default-siliconflow"!==e&&"default-gemini-proxy"!==e&&"default-hiapi"!==e&&"default-jiuban"!==e){if(n(t=>t.filter(t=>t.id!==e)),o===e){const t=a.filter(t=>t.id!==e);s(t.length>0?t[0].id:"default-jiuban")}}else alert("å†…ç½®APIé…ç½®æ— æ³•åˆ é™¤")},switchApiConfig:e=>{s(e)}},children:r})},ae=()=>{const t=e.useContext(Q);if(void 0===t)throw new Error("useApi must be used within an ApiProvider");return t},ne=e.createContext(void 0),oe=864e5,se=({children:r})=>{const[,a]=e.useState(0),n={getRedEnvelope:(e,t)=>{const r=`redEnvelopes_${e}`;return JSON.parse(localStorage.getItem(r)||"[]").find(e=>e.id===t)},saveRedEnvelope:(e,t)=>{const r=`redEnvelopes_${e}`,n=JSON.parse(localStorage.getItem(r)||"[]");n.push(t),localStorage.setItem(r,JSON.stringify(n)),a(e=>e+1)},updateRedEnvelope:(e,t,r)=>{const n=`redEnvelopes_${e}`,o=JSON.parse(localStorage.getItem(n)||"[]"),s=o.findIndex(e=>e.id===t);return-1!==s&&(o[s]={...o[s],...r},localStorage.setItem(n,JSON.stringify(o)),a(e=>e+1),!0)},getPendingRedEnvelopes:e=>{const t=`redEnvelopes_${e}`,r=JSON.parse(localStorage.getItem(t)||"[]"),a=Date.now();return r.filter(e=>"user"===e.sender&&"pending"===e.status&&a-e.createdAt<oe)}};return t.jsx(ne.Provider,{value:n,children:r})},ie=()=>{const t=e.useContext(ne);if(!t)throw new Error("useRedEnvelope must be used within RedEnvelopeProvider");return t},ce=()=>`re_${Date.now()}_${Math.random().toString(36).substr(2,12)}`,le=e=>Date.now()>e.createdAt+oe,de=e.createContext(void 0),ue=({children:r})=>{const[a,n]=e.useState([]);e.useEffect(()=>{const e=localStorage.getItem("accounting_transactions");if(e)try{n(JSON.parse(e))}catch(t){}},[]),e.useEffect(()=>{localStorage.setItem("accounting_transactions",JSON.stringify(a))},[a]);return t.jsx(de.Provider,{value:{transactions:a,addTransaction:e=>{const t={...e,id:`trans_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,createdAt:(new Date).toISOString()};n(e=>[t,...e])},deleteTransaction:e=>{n(t=>t.filter(t=>t.id!==e))},updateTransaction:(e,t)=>{n(r=>r.map(r=>r.id===e?{...r,...t}:r))},getMonthlyTotal:(e,t)=>a.filter(r=>{const a=new Date(r.date);return a.getFullYear()===e&&a.getMonth()===t}).reduce((e,t)=>("income"===t.type?e.income+=t.amount:e.expense+=t.amount,e),{income:0,expense:0}),getCategoryTotal:(e,t)=>a.filter(r=>r.category===e&&r.type===t).reduce((e,t)=>e+t.amount,0)},children:r})},me=()=>{const t=e.useContext(de);if(!t)throw new Error("useAccounting must be used within AccountingProvider");return t},ge=e.createContext(void 0),pe=({children:r})=>{const[a,n]=e.useState([]),[o,l]=e.useState(!1);e.useEffect(()=>{(async()=>{try{const e=await s(i.SETTINGS,"groups");if(e&&e.groups)n(e.groups);else{const e=localStorage.getItem("groups");if(e){const t=JSON.parse(e);n(t),await c(i.SETTINGS,{key:"groups",groups:t}),localStorage.removeItem("groups")}}}catch(e){}finally{l(!0)}})()},[]),e.useEffect(()=>{if(!o)return;(async()=>{try{await c(i.SETTINGS,{key:"groups",groups:a})}catch(e){}})()},[a,o]);const d=(e,t,r)=>{n(a=>a.map(a=>a.id===e?{...a,members:a.members.map(e=>e.id===t?{...e,...r}:e)}:a))};return t.jsx(ge.Provider,{value:{groups:a,addGroup:e=>{var t,r,a,o,s,i;const c={...e,id:`group_${Date.now()}`,createdAt:(new Date).toISOString(),lastMessage:"å¼€å§‹ç¾¤èŠå§",lastMessageTime:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),settings:{...e.settings,allowMemberInvite:(null==(t=e.settings)?void 0:t.allowMemberInvite)??!0,muteAll:(null==(r=e.settings)?void 0:r.muteAll)??!1,showMemberName:(null==(a=e.settings)?void 0:a.showMemberName)??!0,aiReplyMode:(null==(o=e.settings)?void 0:o.aiReplyMode)??"all",aiReplyInterval:(null==(s=e.settings)?void 0:s.aiReplyInterval)??2,maxAiRepliesPerMessage:(null==(i=e.settings)?void 0:i.maxAiRepliesPerMessage)??3}};return n(e=>[c,...e]),c.id},updateGroup:(e,t)=>{n(r=>r.map(r=>r.id===e?{...r,...t}:r))},deleteGroup:e=>{const t=a.find(t=>t.id===e);if(!t)return;if(confirm(`ç¡®å®šè¦è§£æ•£ç¾¤èŠ"${t.name}"å—ï¼Ÿ\n\næ˜¯å¦åŒæ—¶åˆ é™¤ç¾¤èŠè®°å½•å’Œçº¢åŒ…æ•°æ®ï¼Ÿ\n\nâ€¢ ç‚¹å‡»"ç¡®å®š"ï¼šè§£æ•£ç¾¤èŠå¹¶åˆ é™¤æ‰€æœ‰æ•°æ®\nâ€¢ ç‚¹å‡»"å–æ¶ˆ"ï¼šä»…è§£æ•£ç¾¤èŠï¼Œä¿ç•™æ•°æ®`)){localStorage.removeItem(`group_messages_${e}`);try{const t=JSON.parse(localStorage.getItem("group_red_envelopes")||"[]").filter(t=>t.groupId!==e);localStorage.setItem("group_red_envelopes",JSON.stringify(t))}catch(r){}}n(t=>t.map(t=>t.id===e?{...t,disbanded:!0}:t))},getGroup:e=>a.find(t=>t.id===e),addMember:(e,t)=>{n(r=>r.map(r=>{if(r.id===e){const e={...t,role:"member",joinedAt:(new Date).toISOString()};return{...r,members:[...r.members,e]}}return r}))},removeMember:(e,t)=>{n(r=>r.map(r=>{if(r.id===e){try{const r=JSON.parse(localStorage.getItem("group_red_envelopes")||"[]").map(r=>{if(r.groupId===e&&r.received[t]){const{[t]:e,...a}=r.received;return{...r,received:a}}return r});localStorage.setItem("group_red_envelopes",JSON.stringify(r))}catch(a){}return{...r,members:r.members.filter(e=>e.id!==t)}}return r}))},updateMember:d,setAdmin:(e,t,r)=>{n(a=>a.map(a=>{if(a.id===e){const e=a.members.map(e=>e.id===t?{...e,role:r?"admin":"member"}:e),n=r?[...a.admins,t].filter((e,t,r)=>r.indexOf(e)===t):a.admins.filter(e=>e!==t);return{...a,members:e,admins:n}}return a}))},setTitle:(e,t,r)=>{d(e,t,{title:r||void 0})},canManage:(e,t,r)=>{const n=a.find(t=>t.id===e);if(!n)return!1;if(t===r)return!1;const o=n.members.find(e=>e.id===t),s=n.members.find(e=>e.id===r);return!(!o||!s)&&("owner"===o.role||"admin"===o.role&&"member"===s.role)}},children:r})},he=()=>{const t=e.useContext(ge);if(void 0===t)throw new Error("useGroup must be used within a GroupProvider");return t},fe=e.createContext(void 0),ve=({children:r})=>{const[a,n]=e.useState(()=>{const e=localStorage.getItem("group_red_envelopes");return e?JSON.parse(e):[]});e.useEffect(()=>{localStorage.setItem("group_red_envelopes",JSON.stringify(a))},[a]),e.useEffect(()=>{const e=setInterval(()=>{o()},6e4);return o(),()=>clearInterval(e)},[]);const o=()=>{const e=Date.now();let t=!1;n(r=>r.map(r=>{if("active"!==r.status)return r;if(e-r.timestamp>864e5){const e=Object.keys(r.received).length,a=r.packets.slice(e).reduce((e,t)=>e+t,0);if(a>0){const e=parseFloat(localStorage.getItem("balance")||"0")+a;localStorage.setItem("balance",e.toString()),t=!0}return{...r,status:"expired"}}return r}))};return t.jsx(fe.Provider,{value:{redEnvelopes:a,createRedEnvelope:(e,t,r,a,o,s,i)=>{const c=l(o,s),d={id:`group_red_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,groupId:e,senderId:t,senderName:r,senderAvatar:a,amount:o,count:s,message:i,timestamp:Date.now(),status:"active",packets:c,received:{}};return n(e=>[d,...e]),d.id},receiveRedEnvelope:(e,t,r,a)=>{let o=null;return n(n=>n.map(n=>{if(n.id!==e)return n;if(n.received[t])return n;if("active"!==n.status)return n;const s=Object.keys(n.received).length;if(s>=n.packets.length)return{...n,status:"finished"};const i=n.packets[s];o=i;const c={...n.received,[t]:{amount:i,timestamp:Date.now(),userName:r,userAvatar:a}},l=Object.keys(c).length>=n.packets.length?"finished":"active";return{...n,received:c,status:l}})),o},getRedEnvelope:e=>a.find(t=>t.id===e),getGroupRedEnvelopes:e=>a.filter(t=>t.groupId===e),hasReceived:(e,t)=>{const r=a.find(t=>t.id===e);return!!r&&!!r.received[t]},checkExpiredRedEnvelopes:o},children:r})},Se=()=>{const t=e.useContext(fe);if(!t)throw new Error("useGroupRedEnvelope must be used within GroupRedEnvelopeProvider");return t},ye=e.createContext(void 0),Ie=({children:r})=>{const[a,n]=e.useState([]),[o,s]=e.useState("recommend"),[i,c]=e.useState(!1),[l,A]=e.useState(null);e.useEffect(()=>{d(),M()},[]);const M=e.useCallback(async e=>{try{c(!0),A(null),await new Promise(e=>setTimeout(e,300));const t=u({...e,tab:(null==e?void 0:e.tab)||o});n(t.items)}catch(t){A("åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{c(!1)}},[o]),E=e.useCallback(e=>{try{const t=m(e);return n(e=>[t,...e]),t}catch(t){throw t}},[]),_=e.useCallback((e,t)=>{try{const r=g(e,t);return r&&n(r=>r.map(r=>r.id===e?{...r,...t}:r)),r}catch(r){return!1}},[]),O=e.useCallback(e=>{try{const t=p(e);return t&&n(t=>t.filter(t=>t.id!==e)),t}catch(t){return!1}},[]),N=e.useCallback(e=>h(e),[]),T=e.useCallback(e=>{try{const t=h(e);if(!t)return!1;const r=f(e),a=v(e);return a&&(r||"currentUser"===t.authorId||S({type:"like",fromUserId:"currentUser",fromUserName:"æˆ‘",fromUserAvatar:"ğŸ˜Š",postId:e,content:"èµäº†ä½ çš„å¸–å­",isRead:!1}),n(t=>t.map(t=>t.id===e?{...t,isLiked:!t.isLiked,likeCount:t.isLiked?t.likeCount-1:t.likeCount+1}:t))),a}catch(t){return!1}},[]),D=e.useCallback(e=>{try{const t=y(e);return t&&n(t=>t.map(t=>t.id===e?{...t,isFavorited:!t.isFavorited}:t)),t}catch(t){return!1}},[]),U=e.useCallback(e=>I(e),[]),j=e.useCallback(e=>{try{const t=w(e),r=h(e.postId);return r&&"currentUser"!==r.authorId&&r.authorId!==e.authorId&&S({type:"comment",fromUserId:"currentUser",fromUserName:"æˆ‘",fromUserAvatar:"ğŸ˜Š",postId:e.postId,commentId:t.id,content:`è¯„è®ºäº†ä½ çš„å¸–å­ï¼š${e.content.substring(0,20)}${e.content.length>20?"...":""}`,isRead:!1}),e.replyTo&&e.replyToUserId&&"currentUser"!==e.replyToUserId&&S({type:"comment",fromUserId:"currentUser",fromUserName:"æˆ‘",fromUserAvatar:"ğŸ˜Š",postId:e.postId,commentId:t.id,content:`å›å¤äº†ä½ ï¼š${e.content.substring(0,20)}${e.content.length>20?"...":""}`,isRead:!1}),n(t=>t.map(t=>t.id===e.postId?{...t,commentCount:t.commentCount+1}:t)),t}catch(t){throw t}},[]),P=e.useCallback(e=>{try{return b(e)}catch(t){return!1}},[]),$=e.useCallback(()=>C(),[]),R=e.useCallback(e=>{try{return k(e)}catch(t){throw t}},[]),J=e.useCallback(e=>{try{return x(e)}catch(t){return!1}},[]),z=e.useCallback(e=>{s(e),M({tab:e})},[M]),B=e.useCallback(async()=>{await M()},[M]),L=e.useCallback(()=>{A(null)},[]),G={posts:a,currentTab:o,loading:i,error:l,loadPosts:M,addPost:E,updatePost:_,deletePost:O,getPost:N,toggleLike:T,toggleFavorite:D,getComments:U,addComment:j,deleteComment:P,getDrafts:$,saveDraft:R,deleteDraft:J,setTab:z,refreshPosts:B,clearError:L};return t.jsx(ye.Provider,{value:G,children:r})};function we(){const t=e.useContext(ye);if(void 0===t)throw new Error("useForum must be used within a ForumProvider");return t}const be=e.createContext(void 0),Ce=()=>{const t=e.useContext(be);if(!t)throw new Error("useAILife must be used within AILifeProvider");return t},ke=[{time:"07:30",activity:"èµ·åºŠ",location:"å®¶"},{time:"08:00",activity:"æ´—æ¼±åƒæ—©é¤",location:"å®¶"},{time:"08:50",activity:"å‡ºé—¨ä¸Šç­",location:"åœ°é“ç«™"},{time:"09:15",activity:"åˆ°è¾¾å…¬å¸",location:"å…¬å¸"},{time:"12:00",activity:"åˆé¤",location:"é™„è¿‘é¤å…"},{time:"12:45",activity:"å›åˆ°å…¬å¸",location:"å…¬å¸"},{time:"15:00",activity:"ä¸‹åˆèŒ¶",location:"æ˜Ÿå·´å…‹"},{time:"15:30",activity:"å›åˆ°å…¬å¸",location:"å…¬å¸"},{time:"18:00",activity:"ä¸‹ç­",location:"å…¬å¸"},{time:"18:30",activity:"å›å®¶è·¯ä¸Š",location:"åœ°é“ä¸Š"},{time:"19:00",activity:"åˆ°å®¶",location:"å®¶"},{time:"19:30",activity:"åšé¥­",location:"å®¶"},{time:"20:30",activity:"ä¼‘æ¯å¨±ä¹",location:"å®¶"},{time:"23:00",activity:"æ´—æ¼±å‡†å¤‡ç¡è§‰",location:"å®¶"},{time:"23:30",activity:"ç¡è§‰",location:"å®¶"}],xe=e=>{const t=localStorage.getItem(`life_config_${e}`);if(t)try{return JSON.parse(t).schedule||ke}catch(r){return ke}return ke},Ae=({children:r})=>{const[a,n]=e.useState({}),o=e=>{const t=(e=>{const t=xe(e),r=new Date,a=60*r.getHours()+r.getMinutes();let n=t[0];for(let o=0;o<t.length;o++){const[e,r]=t[o].time.split(":").map(Number);if(!(a>=60*e+r))break;n=t[o]}return n})(e),r=(()=>{const e=new Date,t=(60*e.getHours()+e.getMinutes()-420)/960*80;return Math.max(20,Math.min(100,100-t))})(),a=(()=>{const e=(new Date).getHours();return e<8?Math.floor(500*Math.random()):e<12?Math.floor(2e3+1e3*Math.random()):e<14?Math.floor(3e3+1e3*Math.random()):e<18?Math.floor(4e3+1e3*Math.random()):e<20?Math.floor(6e3+2e3*Math.random()):Math.floor(7e3+3e3*Math.random())})(),o=(()=>{const e=(new Date).getHours();return e>=23||e<7})(),s=(e=>{const t=(new Date).getHours();return"ç¡è§‰"===e?"ç¡æ¢¦ä¸­...":t<9?"åˆšèµ·åºŠï¼Œæœ‰ç‚¹å›°":"åˆé¤"===e?"é¥¿äº†ï¼Œåƒé¥­çœŸå¼€å¿ƒ":"ä¸‹åˆèŒ¶"===e?"å–æ¯å’–å•¡ææç¥~":t>=18&&t<20?"ç»ˆäºä¸‹ç­äº†ï¼":t>=20?"æ”¾æ¾çš„æ™šä¸Š~":"å¿ƒæƒ…ä¸é”™"})(t.activity),i=(()=>{const e=["æ™´å¤©â˜€ï¸","å¤šäº‘â›…","å°é›¨ğŸŒ§ï¸"];return e[(new Date).getDate()%e.length]})();n(n=>({...n,[e]:{location:t.location,activity:t.activity,isOnline:!o,battery:Math.round(r),isCharging:r<30||(new Date).getHours()>=23,screenOn:!o&&Math.random()>.3,currentApp:o?"æ— ":["å¾®ä¿¡","æŠ–éŸ³","å°çº¢ä¹¦","å“”å“©å“”å“©"][Math.floor(4*Math.random())],mood:s,steps:a,isSleeping:o,weather:i}}))};e.useEffect(()=>{const e=setInterval(()=>{const e=Object.keys(a);if(0===e.length){const e=localStorage.getItem("chatList");if(e){JSON.parse(e).forEach(e=>{e.id&&o(e.id)})}}else e.forEach(o)},6e4);return()=>clearInterval(e)},[a]);const s=e=>(a[e]||o(e),a[e]||{location:"å®¶",activity:"ä¼‘æ¯ä¸­",isOnline:!0,battery:50,isCharging:!1,screenOn:!0,currentApp:"å¾®ä¿¡",mood:"å¿ƒæƒ…ä¸é”™",steps:0,isSleeping:!1,weather:"æ™´å¤©â˜€ï¸"});return t.jsx(be.Provider,{value:{getAIStatus:s,getTodayTrack:e=>(e=>{const t=xe(e),r=new Date,a=60*r.getHours()+r.getMinutes(),n=[];for(let o=0;o<t.length;o++){const e=t[o],[r,s]=e.time.split(":").map(Number),i=60*r+s;if(i<=a){let r=0;if(o<t.length-1){const[e,n]=t[o+1].time.split(":").map(Number),s=60*e+n;r=Math.min(s-i,a-i)}else r=a-i;n.push({id:String(o),time:e.time,location:e.location,duration:r,activity:e.activity})}}return n})(e),updateAIStatus:(e,t)=>{n(r=>({...r,[e]:{...s(e),...t}}))},shouldAIReply:e=>{const t=s(e);return t.isSleeping?{canReply:!1,reason:"å¯¹æ–¹æ­£åœ¨ç¡è§‰ï¼Œå¯èƒ½çœ‹ä¸åˆ°æ¶ˆæ¯"}:t.battery<5?{canReply:!1,reason:"å¯¹æ–¹æ‰‹æœºå¿«æ²¡ç”µäº†ï¼Œå¯èƒ½å·²å…³æœº"}:t.screenOn?"å¾®ä¿¡"!==t.currentApp?{canReply:!0,delaySeconds:3+7*Math.random(),reason:`å¯¹æ–¹åœ¨${t.currentApp}ï¼Œç¨åå›å¤`}:"å¼€ä¼š"===t.activity?{canReply:!0,delaySeconds:30+60*Math.random(),reason:"å¯¹æ–¹åœ¨å¼€ä¼šï¼Œå¯èƒ½è¾ƒæ™šå›å¤"}:"æ´—æ¾¡"===t.activity?{canReply:!1,reason:"å¯¹æ–¹åœ¨æ´—æ¾¡ï¼Œæš‚æ—¶çœ‹ä¸åˆ°æ¶ˆæ¯"}:"åœ°é“ä¸Š"===t.activity||"é€šå‹¤ä¸­"===t.activity?{canReply:!0,delaySeconds:10+20*Math.random(),reason:"å¯¹æ–¹åœ¨è·¯ä¸Šï¼Œä¿¡å·å¯èƒ½ä¸å¥½"}:{canReply:!0,delaySeconds:1+3*Math.random()}:{canReply:!0,delaySeconds:5+10*Math.random(),reason:"å¯¹æ–¹æ‰‹æœºæ¯å±ï¼Œç¨åå›å¤"}}},children:r})},Me=({children:e})=>t.jsx(q,{children:t.jsx(O,{children:t.jsx(F,{children:t.jsx(re,{children:t.jsx(R,{children:t.jsx(D,{children:t.jsx(Ie,{children:t.jsx(se,{children:t.jsx(ue,{children:t.jsx(pe,{children:t.jsx(ve,{children:t.jsx(Ae,{children:t.jsx(G,{children:t.jsx(M,{children:t.jsx(r,{basename:"/zhizhi/",children:e})})})})})})})})})})})})})})});export{Me as A,he as a,N as b,K as c,z as d,E as e,U as f,ie as g,me as h,le as i,H as j,ce as k,ae as l,Se as m,Ce as n,we as o,B as u};
