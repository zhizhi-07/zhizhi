const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/utils-Bw01K5Nk.js","assets/react-vendor-D8ofYTc3.js","assets/vendor-BOALdufa.js"])))=>i.map(i=>d[i]);
import{j as e,r as t,u as s,a,b as r,R as l}from"./react-vendor-D8ofYTc3.js";import{u as n,a as i,b as c,c as o,d,e as x,i as m,f as h,g as u,h as g,j as p,k as f,l as b,m as j,n as v,o as y}from"./context-BPvo2RgQ.js";import{v as N,w,x as k,y as C,z as S,A as I,B as _,C as M,D as z,E as $,F as L,G as A,H as T,I as D,J as B,K as E,L as P,M as F,N as O,O as W,a as R,P as U,Q as V,R as J,T as H,U as G,V as q,W as K,X,Y as Z,Z as Q,_ as Y,$ as ee,a0 as te,a1 as se,a2 as ae,a3 as re,a4 as le,a5 as ne,a6 as ie,a7 as ce,a8 as oe,a9 as de,aa as xe,ab as me,ac as he,ad as ue,ae as ge,af as pe,ag as fe,ah as be,ai as je,aj as ve,ak as ye,al as Ne,am as we,an as ke,ao as Ce,ap as Se,aq as Ie,ar as _e,as as Me,at as ze,au as $e,av as Le,aw as Ae,ax as Te,ay as De,az as Be,aA as Ee,aB as Pe,aC as Fe,aD as Oe,aE as We,aF as Re,aG as Ue,aH as Ve,aI as Je,aJ as He,aK as Ge,aL as qe,aM as Ke,aN as Xe,aO as Ze,aP as Qe,aQ as Ye,aR as et,aS as tt,aT as st,aU as at,aV as rt,aW as lt,aX as nt,aY as it,aZ as ct,a_ as ot,a$ as dt,b0 as xt,b1 as mt,b2 as ht,b3 as ut,b4 as gt,b5 as pt,b6 as ft,b7 as bt,b8 as jt,b9 as vt,ba as yt,bb as Nt,bc as wt,bd as kt,be as Ct,bf as St,bg as It,bh as _t,bi as Mt,bj as zt,bk as $t,bl as Lt,bm as At,bn as Tt,bo as Dt,bp as Bt,bq as Et,br as Pt,bs as Ft,bt as Ot,bu as Wt,bv as Rt,bw as Ut,bx as Vt,j as Jt,by as Ht,bz as Gt,bA as qt,bB as Kt,bC as Xt}from"./utils-Bw01K5Nk.js";const Zt={},Qt=function(e,t,s){let a=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),s=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));a=Promise.allSettled(t.map(e=>{if((e=function(e){return"/zhizhi/"+e}(e))in Zt)return;Zt[e]=!0;const t=e.endsWith(".css"),a=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${a}`))return;const r=document.createElement("link");return r.rel=t?"stylesheet":"modulepreload",t||(r.as="script"),r.crossOrigin="",r.href=e,s&&r.setAttribute("nonce",s),document.head.appendChild(r),t?new Promise((t,s)=>{r.addEventListener("load",t),r.addEventListener("error",()=>s(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function r(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return a.then(t=>{for(const e of t||[])"rejected"===e.status&&r(e.reason);return e().catch(r)})},Yt=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M12 2C6.477 2 2 6.477 2 12c0 1.592.39 3.093 1.077 4.417L2.27 20.27a1 1 0 001.212 1.213l3.853-.806A9.958 9.958 0 0012 22c5.523 0 10-4.477 10-10S17.523 2 12 2z",fill:"currentColor"})}),es=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2M9 11a4 4 0 100-8 4 4 0 000 8zM23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),ts=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M16 8l-5.586 5.586a2 2 0 01-2.828 0 2 2 0 010-2.828L13.172 5.172a2 2 0 012.828 0 2 2 0 010 2.828z",fill:"currentColor"})]}),ss=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2M12 11a4 4 0 100-8 4 4 0 000 8z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),as=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("circle",{cx:"11",cy:"11",r:"8",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M21 21l-4.35-4.35",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),rs=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M12 5v14M5 12h14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),ls=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M15 18l-6-6 6-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),ns=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("circle",{cx:"12",cy:"5",r:"1.5",fill:"currentColor"}),e.jsx("circle",{cx:"12",cy:"12",r:"1.5",fill:"currentColor"}),e.jsx("circle",{cx:"12",cy:"19",r:"1.5",fill:"currentColor"})]}),is=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),cs=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("rect",{x:"9",y:"2",width:"6",height:"11",rx:"3",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M5 10v2a7 7 0 0014 0v-2M12 19v3",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),os=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2"}),e.jsx("circle",{cx:"8",cy:"10",r:"1.5",fill:"currentColor"}),e.jsx("circle",{cx:"16",cy:"10",r:"1.5",fill:"currentColor"}),e.jsx("path",{d:"M8 15s1.5 2 4 2 4-2 4-2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),ds=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",stroke:"currentColor",strokeWidth:"2"}),e.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5",fill:"currentColor"}),e.jsx("path",{d:"M21 15l-5-5L5 21",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),xs=({size:t=120,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 120 120",fill:"none",className:s,children:[e.jsx("circle",{cx:"60",cy:"60",r:"50",fill:"currentColor",opacity:"0.1"}),e.jsx("path",{d:"M60 30v40M60 80v5",stroke:"currentColor",strokeWidth:"4",strokeLinecap:"round",opacity:"0.3"})]}),ms=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("circle",{cx:"9",cy:"7",r:"4",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M2 21v-2a5 5 0 015-5h4a5 5 0 015 5v2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("path",{d:"M19 8v6M16 11h6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),hs=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("circle",{cx:"9",cy:"7",r:"3",stroke:"currentColor",strokeWidth:"2"}),e.jsx("circle",{cx:"15",cy:"10",r:"3",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M3 20v-1a4 4 0 014-4h4a4 4 0 014 4v1M14 20v-1a4 4 0 014-4h1",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),us=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("path",{d:"M20.59 13.41l-7.17 7.17a2 2 0 01-2.83 0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("circle",{cx:"7",cy:"7",r:"1.5",fill:"currentColor"})]}),gs=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",stroke:"currentColor",strokeWidth:"2"}),e.jsx("circle",{cx:"8.5",cy:"8.5",r:"2",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M21 15l-5-5L5 21",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),ps=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z",stroke:"currentColor",strokeWidth:"1.8",strokeLinejoin:"round"}),e.jsx("circle",{cx:"9",cy:"9",r:"1.5",fill:"currentColor",opacity:"0.6"}),e.jsx("circle",{cx:"15",cy:"9",r:"1.5",fill:"currentColor",opacity:"0.6"})]}),fs=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("circle",{cx:"12",cy:"12",r:"3",fill:"currentColor"}),e.jsx("path",{d:"M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),bs=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"3",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M8 8h8M8 12h8M8 16h5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),js=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("rect",{x:"3",y:"3",width:"7",height:"7",rx:"1",stroke:"currentColor",strokeWidth:"2"}),e.jsx("rect",{x:"14",y:"3",width:"7",height:"7",rx:"1",stroke:"currentColor",strokeWidth:"2"}),e.jsx("rect",{x:"3",y:"14",width:"7",height:"7",rx:"1",stroke:"currentColor",strokeWidth:"2"}),e.jsx("rect",{x:"14",y:"14",width:"7",height:"7",rx:"1",stroke:"currentColor",strokeWidth:"2"})]}),vs=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z",stroke:"currentColor",strokeWidth:"2",strokeLinejoin:"round"})}),ys=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("rect",{x:"2",y:"6",width:"20",height:"14",rx:"2",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M2 10h20",stroke:"currentColor",strokeWidth:"2"}),e.jsx("rect",{x:"16",y:"13",width:"3",height:"2",rx:"1",fill:"currentColor"})]}),Ns=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("circle",{cx:"12",cy:"12",r:"3",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),ws=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M12 8v8M8 12h8",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),ks=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("path",{d:"M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2v11z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("circle",{cx:"12",cy:"13",r:"4",stroke:"currentColor",strokeWidth:"2"})]}),Cs=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M4 7h16M12 7v8M9 15h6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("circle",{cx:"12",cy:"11",r:"2",fill:"currentColor"})]}),Ss=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("path",{d:"M12 2v20M12 2l-4 4M12 2l4 4M12 22l-4-4M12 22l4-4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("circle",{cx:"12",cy:"12",r:"3",stroke:"currentColor",strokeWidth:"2"})]}),Is=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),_s=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z",stroke:"currentColor",strokeWidth:"2"}),e.jsx("circle",{cx:"12",cy:"10",r:"3",stroke:"currentColor",strokeWidth:"2"})]}),Ms=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),zs=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("rect",{x:"2",y:"5",width:"16",height:"14",rx:"2",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M18 10l4-2v8l-4-2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),$s=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M14 9V5a3 3 0 00-3-3l-4 9v11h11.28a2 2 0 002-1.7l1.38-9a2 2 0 00-2-2.3H14zM3 11h3v11H3V11z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),Ls=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2v10z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),As=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("circle",{cx:"12",cy:"5",r:"1.5",fill:"currentColor"}),e.jsx("circle",{cx:"12",cy:"12",r:"1.5",fill:"currentColor"}),e.jsx("circle",{cx:"12",cy:"19",r:"1.5",fill:"currentColor"})]}),Ts=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z",fill:"currentColor"})}),Ds=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("path",{d:"M4 4h16a2 2 0 012 2v12a2 2 0 01-2 2H4a2 2 0 01-2-2V6a2 2 0 012-2z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M2 10h20M7 15h5M7 11v8M17 11v8",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),Bs=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("rect",{x:"7",y:"4",width:"10",height:"16",rx:"2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M11 5h2M11 19h2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("path",{d:"M4 8l-2 2 2 2M20 8l2 2-2 2M4 14l-2 2 2 2M20 14l2 2-2 2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),Es=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("path",{d:"M9 18V5l12-2v13",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("circle",{cx:"6",cy:"18",r:"3",stroke:"currentColor",strokeWidth:"2"}),e.jsx("circle",{cx:"18",cy:"16",r:"3",stroke:"currentColor",strokeWidth:"2"})]}),Ps=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z",fill:"currentColor"})}),Fs=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M5 3l14 9-14 9V3z",fill:"currentColor"})}),Os=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",fill:"currentColor"}),e.jsx("rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",fill:"currentColor"})]}),Ws=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("path",{d:"M5 4l10 8-10 8V4z",fill:"currentColor"}),e.jsx("path",{d:"M19 5v14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),Rs=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("path",{d:"M13 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V9l-7-7z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M13 2v7h7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),Us=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M2 12h20M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z",stroke:"currentColor",strokeWidth:"2"})]}),Vs=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M16 2v4M8 2v4M3 10h18",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),Js=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("rect",{x:"2",y:"7",width:"20",height:"10",rx:"2",stroke:"currentColor",strokeWidth:"2"}),e.jsx("circle",{cx:"7",cy:"12",r:"1.5",fill:"currentColor"}),e.jsx("circle",{cx:"17",cy:"10",r:"1.5",fill:"currentColor"}),e.jsx("circle",{cx:"17",cy:"14",r:"1.5",fill:"currentColor"})]}),Hs=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M6.5 6.5l11 11L12 23V1l5.5 5.5-11 11",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),Gs=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9M13.73 21a2 2 0 01-3.46 0",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),qs=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",fill:"currentColor"}),e.jsx("path",{d:"M15.54 8.46a5 5 0 010 7.07M19.07 4.93a10 10 0 010 14.14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),Ks=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z",fill:"currentColor"})}),Xs=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("circle",{cx:"12",cy:"12",r:"5",fill:"currentColor"}),e.jsx("path",{d:"M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),Zs=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M7 11V7a5 5 0 0110 0v4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),Qs=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),Ys=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("rect",{x:"1",y:"16",width:"4",height:"8",fill:"currentColor"}),e.jsx("rect",{x:"7",y:"12",width:"4",height:"12",fill:"currentColor"}),e.jsx("rect",{x:"13",y:"8",width:"4",height:"16",fill:"currentColor"}),e.jsx("rect",{x:"19",y:"4",width:"4",height:"20",fill:"currentColor"})]}),ea=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("circle",{cx:"8",cy:"15",r:"4",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M11.5 12.5L21 3M21 3l-3 0M21 3l0 3",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M16 8l-1.5 1.5M13 11l-1.5 1.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),ta=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M21 10c0-4.97-4.03-9-9-9-4.97 0-9 4.03-9 9 0 4.97 4.03 9 9 9 2.39 0 4.56-.94 6.16-2.46M21 10v-4M21 10h-4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),sa=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"4",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M12 7v10M7 12h10",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("circle",{cx:"12",cy:"12",r:"2",fill:"currentColor"}),e.jsx("path",{d:"M8 8l8 8M16 8l-8 8",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",opacity:"0.3"})]}),aa=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M14 16c0 1.1.9 2 2 2s2-.9 2-2-.9-2-2-2-2 .9-2 2zM6 16c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2zM10 10c0 2.21-1.79 4-4 4s-4-1.79-4-4 1.79-4 4-4 4 1.79 4 4zM22 10c0 2.21-1.79 4-4 4s-4-1.79-4-4 1.79-4 4-4 4 1.79 4 4z",fill:"currentColor"})}),ra=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M7 20l4-16m2 16l4-16M6 9h14M4 15h14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),la=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("circle",{cx:"9",cy:"21",r:"1",fill:"currentColor"}),e.jsx("circle",{cx:"20",cy:"21",r:"1",fill:"currentColor"}),e.jsx("path",{d:"M1 1h4l2.68 13.39a2 2 0 002 1.61h9.72a2 2 0 002-1.61L23 6H6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),na=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M2 10h20M6 15h4M14 15h4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),ia=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8l-6-6z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M14 2v6h6M8 13h8M8 17h8M8 9h2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),ca=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("rect",{x:"5",y:"2",width:"14",height:"20",rx:"2",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M12 18h.01",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),oa=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),da=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M15 18l-6-6 6-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),xa=()=>{const[s,a]=t.useState(new Date),[r,l]=t.useState(()=>{const e=localStorage.getItem("focus_mode");return e?JSON.parse(e):null}),[n,i]=t.useState(()=>{const e=localStorage.getItem("time_settings");return e?JSON.parse(e):{showBg:!0,color:"#22c55e"}});t.useEffect(()=>{const e=setInterval(()=>{a(new Date)},1e3);return()=>clearInterval(e)},[]),t.useEffect(()=>{const e=N.observe("focus_mode",e=>{l(e?JSON.parse(e):null)}),t=N.observe("time_settings",e=>{i(e?JSON.parse(e):{showBg:!0,color:"#22c55e"})});return()=>{e(),t()}},[]);return e.jsxs("div",{className:"h-11 flex items-center justify-between pl-6 pr-2 text-sm font-semibold text-gray-900",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"tracking-tight px-2 py-0.5 rounded-full text-sm font-bold",style:{backgroundColor:!1!==n.showBg?n.color||"#22c55e":"transparent",color:!1!==n.showBg?"white":"#111827"},children:(c=s,`${c.getHours().toString().padStart(2,"0")}:${c.getMinutes().toString().padStart(2,"0")}`)}),r&&(r.icon||r.name)&&e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-full text-xs",style:{backgroundColor:!1!==r.showBg?r.color||"#9333ea":"transparent",color:!1!==r.showBg?"white":"#111827"},children:[r.icon&&e.jsx("img",{src:r.icon,alt:"专注模式",className:"w-4 h-4 object-cover rounded"}),r.name&&e.jsx("span",{children:r.name})]})]}),e.jsx("div",{className:"flex-1"}),e.jsx("div",{className:"flex items-center",children:e.jsx("img",{src:"data:image/webp;base64,UklGRkoGAABXRUJQVlA4WAoAAAAQAAAAIwEAYQAAQUxQSBMFAAABoIdt+yG3+n6zipONVdsI6k3tNqpt27Ztxzmqbdvmqe02DTZZzHx/zMxmdmZ2j08iYgIgz/95/v9HvNrRxVlDicerVI3q1apaWKVqlfDwKuHsMN7QsNDQkNDQkJCQkMq8lYp7eKjsjoBG0ZGRbfNbjVRs2X3cil3nbj97fGXfxml9WjcuajUCvT/nGI0GCWZnZd2pamdod6Snp6dnPKtgFaduq/Z8SM/UG8w0IjJmY3ZWRvrDzasqWwe6ZD0dMkiaA4dt1i+1LzabkPNOacGUui2P0g1mzD1jMnzcHmqNrpmvi6qlqgn6DefYFSeQOyNUIK9OV9NNKLz5x8aKgvXNfF4MJByQRC+g7JC0EGG6X0hn0LrGlzOFevO+FEg6YMsHHzup1JEsGq2fc6qSIGPoeCVhFRJ/QS0QACoW99hHQ1/TaOn1hA0buePiE85ZgvTnXkIsZTyAHfc9TfyXCwBFwPunV7at+6+bf909Vmu9uEy08MOoVoFOjrxOTk5+DSZ94UPUjya5W8yoWXEGlCB9xQMAPBJtW+PHJpPJnLPYxUrKzUbkfxnjq1ZALim1V787fJgzQiGABgACv6Akv8XYvsjHDLIN632tMzsLeR8M81eAoCrX/nd40NBCIUw8LQ3mASv+pS1LYZD7Xbh1fC7xJBVTg4AE2Kr8k4xcL3SUQIw08DEryaZtQt4XIdYB7WnWh+5uBLipQhU7jJ0xfURseEECvOqKe1m/11CCMHFS+Z2V+AqACqwIxCZt5HtuLfA/jfigqhK4Y0emvs3U5xgMOfrMF9vGhXEBcRqahidDFCBDCa8AnMZmdAH7Bvwe3ytHAWfsnh8GE1poNrw/HK1kAagazgygQK4cR+MFR1vhXCmiZs26QeKDAC8KAEAZdiPbjLmms0815gBKDULKxij8sc5WzMvS6/X6p03EB2oNpQJq/XcGBaX1CQVZAstBEhfzwEbMMSKbeRchPkIcgdpuRMHNT1poZCyRC2kbkYK8keIDIAG7jGhh2oNrVx9Zgkx2lFL+0EYk8zWXAhS8hLy/LxhQO5+7e8HYwcsNPIghIF9JXMx9e4jkv85xJTpQraQAgCiUqsIT3nENcpCxRK609fIV0DgmqnV1J1kA8DuL+LqHOwWWEqXfgmxEHOQEcjcarzvJlluKwWg0GqY6ygP43thbWgG5Vta/hQMdQe6cJjJtQK61KWZkm0bIBBR2IcDtU6hYUQ0HUP5lNSBrSa8AqICyFJGriTRyp7eQCQKcLlFDPxgMht2DqyqATUDWtKkvAQAIyPZE5E1rLhMAQAj0PpppQkSkTZ83FyNgba5kqTy3RMZlCaDjJwb56ds+ItGmSeQCK8Uum6dHS9MDRQLrpHHNEwA84uyy4EsW9Xew2lJGxVLEXpTApSAAAO1vr+0xcL1kQW8NWN3zY6qCUgAQlwDR+7sDACiiv1ezy8DvDMOh7+cAInzzrARREpAqBZ57vxaVual8WZGsVL5IVhLf23DLssNEANqLHD00IMZmpteFQMKeO+g5IPMDcnge12Qt5vlahzXDyHO2OGsLz+2SYgDfy4g42AFESaLNr3RKyXjtoqcRuaPGZXC8bkpYyhUM630bwiIpXHcqANt9F8f9MBCn33kc5wQiJTGZ9ObJkyQ5ceouejYB2VeVq6vT6eoXBG73sNo6Xb3CBDj9qkXodLr6/sDtVy1Cp6vvA2INruUA4i23zMxINWMy5Pk/z///1goAVlA4IBABAABwDwCdASokAWIAPm02l0gkIyIhJ3MYAIANiWlu4XNBG168UwAUCAioKeend40gRUFPPTf+tXl0L9vtkCKgp51DGCOWbpGwUov6By4W8KepP30aKgprAL/dVPO4e4PtWqQwsq4TyxpAin/V377BgPvBaHvGkCKgp56d3jSBFQU89O7xiAAA/v9zmAcv9L4KD/EATxPgXfUTiTFLRfHIk2f/bBdCJxm4oN0+4ri4sYPBlzbRSfotbmxa7IzZpzz4myROaeYdk4XZf27IGLYtKTcBE/75nb///koAlWpPxl4LHa5sriMqug3S8BdM9Pa9fOb7dG5234y1fjiu6RS7Nv7rEOvmAAn/5Kd///JQAAAAAA==",alt:"状态栏图标",className:"h-9"})})]});var c},ma=()=>{const a=s(),{characters:r}=n(),{groups:l}=i(),{background:d,getBackgroundStyle:x}=c(),{showStatusBar:m}=o(),[h,u]=t.useState(()=>{const e=localStorage.getItem("chatList");return e?JSON.parse(e):[]}),[g,p]=t.useState(!1),[f,b]=t.useState(!1),[j,v]=t.useState({}),[y,N]=t.useState({});t.useEffect(()=>{localStorage.setItem("chatList",JSON.stringify(h))},[h]),t.useEffect(()=>{0!==l.length&&u(e=>{let t=[...e],s=!1;return l.forEach(e=>{const a=t.findIndex(t=>"group"===t.type&&t.groupId===e.id),r={id:e.id,groupId:e.id,type:"group",name:e.name,avatar:e.avatar,lastMessage:e.lastMessage||"开始群聊吧",time:e.lastMessageTime||(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),memberCount:e.members.length,unread:e.unread};if(a>=0){const l=t[a];l.lastMessage===r.lastMessage&&l.time===r.time&&l.memberCount===r.memberCount||(t[a]=r,e.disbanded||(t=[r,...t.filter((e,t)=>t!==a)]),s=!0)}else t=[r,...t],s=!0}),t.sort((e,t)=>{const s=l.find(t=>t.id===e.groupId),a=l.find(e=>e.id===t.groupId),r=(null==s?void 0:s.disbanded)??!1,n=(null==a?void 0:a.disbanded)??!1;return r&&!n?1:!r&&n?-1:0}),s?t:e})},[l]),t.useEffect(()=>{const e=()=>{const e={},t={};h.forEach(s=>{if("single"===s.type&&s.characterId){const a=C(s.characterId);a>0&&(e[s.characterId]=a),t[s.characterId]=S(s.characterId)}}),v(e),N(t)};e();const t=setInterval(e,500);return()=>clearInterval(t)},[h]);const I=r.filter(e=>!h.some(t=>t.characterId===e.id)),_=t=>{const s=l.find(e=>e.id===t);if(!s)return null;const a=s.members.slice(0,9),r=a.length;let n="grid-cols-3",i="12px";return 1===r?(n="grid-cols-1",i="32px"):r<=4&&(n="grid-cols-2",i="16px"),e.jsx("div",{className:`w-14 h-14 rounded-2xl bg-white shadow-lg overflow-hidden grid ${n} gap-[1px] border border-gray-200`,children:a.map((t,s)=>{const a=t.avatar&&t.avatar.startsWith("data:image");return e.jsx("div",{className:"bg-gray-100 flex items-center justify-center",style:{fontSize:i},children:a?e.jsx("img",{src:t.avatar,alt:t.name,className:"w-full h-full object-cover"}):e.jsx("span",{children:t.avatar||"🤖"})},s)})})};return e.jsxs("div",{className:"h-full flex flex-col relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 z-0",style:d?x():{background:"linear-gradient(to bottom, #f9fafb, #f3f4f6)"}}),e.jsxs("div",{className:"relative z-10 h-full flex flex-col bg-transparent",children:[e.jsxs("div",{className:"sticky top-0 z-50 "+(d?"glass-dark":"glass-effect"),children:[m&&e.jsx(xa,{}),e.jsxs("div",{className:"px-5 py-4 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a("/"),className:"text-xl font-semibold text-gray-900 ios-button",children:"微信"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{className:"ios-button text-gray-700 hover:text-gray-900",children:e.jsx(as,{size:22})}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>p(!g),className:"ios-button text-gray-700 hover:text-gray-900",children:e.jsx(rs,{size:22})}),g&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-30",onClick:()=>p(!1)}),e.jsxs("div",{className:"absolute right-0 top-full mt-2 w-44 glass-card rounded-2xl shadow-xl z-40 overflow-hidden",children:[e.jsxs("button",{onClick:()=>{p(!1),b(!0)},className:"w-full px-4 py-3.5 text-left text-gray-900 hover:bg-gray-50 ios-button border-b border-gray-100 flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-white border border-gray-200 flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-gray-600",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})})}),e.jsx("span",{className:"font-medium",children:"添加联系人"})]}),e.jsxs("button",{onClick:()=>{p(!1),a("/create-group")},className:"w-full px-4 py-3.5 text-left text-gray-900 hover:bg-gray-50 ios-button flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-white border border-gray-200 flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-gray-600",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"})})}),e.jsx("span",{className:"font-medium",children:"创建群聊"})]})]})]})]})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto hide-scrollbar relative z-0 pt-3",children:0===h.length?e.jsxs("div",{className:"empty-state",children:[e.jsx(xs,{size:100,className:"text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-400 text-base mb-2",children:"暂无聊天"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"点击右上角 + 添加角色开始聊天"})]}):h.map(t=>{const s="group"===t.type,l=t.characterId?r.find(e=>e.id===t.characterId):null,n=s?t.name:(null==l?void 0:l.nickname)||(null==l?void 0:l.name)||t.name,i=s?t.avatar:(null==l?void 0:l.avatar)||t.avatar;return e.jsxs("div",{onClick:()=>a(s?`/group/${t.id}`:`/chat/${t.id}`),className:"flex items-center px-5 py-4 ios-button glass-card mb-2 mx-3 rounded-2xl cursor-pointer",children:[s&&t.groupId?_(t.groupId):e.jsx("div",{className:"w-14 h-14 rounded-2xl bg-gray-200 flex items-center justify-center flex-shrink-0 shadow-lg overflow-hidden",children:e.jsx("img",{src:w(i),alt:n,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1 ml-4 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-900",children:n}),s&&t.memberCount&&e.jsxs("span",{className:"text-xs text-gray-400",children:["(",t.memberCount,")"]}),!s&&t.characterId&&(()=>{const s=k(t.characterId);return s.currentStreak>0?e.jsxs("span",{className:"text-xs px-1.5 py-0.5 bg-orange-100 text-orange-600 rounded-md font-medium flex items-center gap-0.5",children:["🔥 ",s.currentStreak]}):null})()]}),e.jsx("span",{className:"text-xs text-gray-400",children:t.time})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[t.characterId&&y[t.characterId]?e.jsx("p",{className:"text-sm text-green-500 truncate flex-1",children:"正在输入..."}):e.jsx("p",{className:"text-sm text-gray-500 truncate flex-1",children:t.lastMessage&&(t.lastMessage.startsWith("💬 我")||t.lastMessage.startsWith("👍 我")||t.lastMessage.startsWith("🎙️"))?"开始聊天吧":t.lastMessage}),(()=>{const s=t.characterId?j[t.characterId]:t.unread||0;return s>0?e.jsx("span",{className:`ml-2 px-2 min-w-[20px] h-5 rounded-full text-xs text-white flex items-center justify-center ${t.muted?"bg-gray-400":"bg-red-500"} shadow-md`,children:s>99?"99+":s}):null})()]})]})]},t.id)})}),f&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:()=>b(!1)}),e.jsx("div",{className:"fixed inset-x-0 bottom-0 z-50 animate-slide-up",children:e.jsxs("div",{className:"glass-card rounded-t-3xl p-6 max-h-[70vh] overflow-y-auto hide-scrollbar",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"选择角色"}),e.jsx("button",{onClick:()=>b(!1),className:"text-gray-500 hover:text-gray-700 ios-button",children:"✕"})]}),0===I.length?e.jsxs("div",{className:"py-10 text-center",children:[e.jsx(xs,{size:80,className:"text-gray-400 mb-3 mx-auto"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"暂无可添加的角色"}),e.jsx("button",{onClick:()=>{b(!1),a("/create-character")},className:"px-6 py-2 bg-wechat-primary text-white rounded-full ios-button",children:"创建新角色"})]}):e.jsx("div",{className:"space-y-2",children:I.map(t=>e.jsxs("div",{onClick:()=>(e=>{const t=r.find(t=>t.id===e);if(!t)return;const s={id:e,characterId:e,type:"single",name:t.nickname||t.name,avatar:t.avatar,lastMessage:"开始聊天吧",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})};u(e=>[s,...e]),b(!1)})(t.id),className:"flex items-center p-4 glass-card rounded-2xl ios-button cursor-pointer hover:bg-gray-50",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gray-200 flex items-center justify-center flex-shrink-0 shadow-lg overflow-hidden",children:e.jsx("img",{src:w(t.avatar),alt:t.nickname||t.name,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"ml-3 flex-1 overflow-hidden",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:t.nickname||t.name}),t.signature&&e.jsx("p",{className:"text-sm text-gray-500 truncate",children:t.signature})]})]},t.id))}),I.length>0&&e.jsx("div",{className:"mt-4 text-center",children:e.jsx("button",{onClick:()=>{b(!1),a("/wechat/contacts")},className:"text-sm text-primary ios-button",children:"前往通讯录管理角色"})})]})})]})]})]})},ha=()=>{const t=s(),{characters:a}=n(),{background:r,getBackgroundStyle:l}=c(),{showStatusBar:i}=o(),d=[{id:1,name:"创建角色",Icon:ms,path:"/create-character"},{id:2,name:"群聊",Icon:hs,path:"/group-list"},{id:3,name:"标签",Icon:us,path:""}];return e.jsxs("div",{className:"h-full flex flex-col relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 z-0",style:l()}),e.jsxs("div",{className:"relative z-10 h-full flex flex-col bg-transparent",children:[e.jsxs("div",{className:"sticky top-0 z-50 "+(r?"glass-dark":"glass-effect"),children:[i&&e.jsx(xa,{}),e.jsxs("div",{className:"px-5 py-4 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>t("/"),className:"text-xl font-semibold text-gray-900 ios-button",children:"通讯录"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>{},className:"ios-button text-gray-700 hover:text-gray-900 cursor-pointer",children:e.jsx(as,{size:22})}),e.jsx("button",{onClick:()=>t("/create-character"),className:"ios-button text-gray-700 hover:text-gray-900 cursor-pointer",children:e.jsx(rs,{size:22})})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar relative z-0",children:[e.jsx("div",{className:"px-3 pt-3 pb-2",children:d.map(s=>{const a=s.Icon;return e.jsxs("div",{onClick:()=>{s.path&&t(s.path)},className:"flex items-center px-4 py-3 ios-button glass-card mb-2 rounded-2xl cursor-pointer hover:bg-white/90",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-white/80 backdrop-blur-sm flex items-center justify-center flex-shrink-0 shadow-lg border border-gray-200/50",children:e.jsx(a,{size:24,className:"text-gray-600"})}),e.jsx("span",{className:"ml-4 text-gray-900 font-medium",children:s.name})]},s.id)})}),0===a.length?e.jsxs("div",{className:"empty-state mt-10",children:[e.jsx(xs,{size:100,className:"text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-400 text-base",children:"暂无联系人"}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:'点击上方"创建角色"添加AI角色'})]}):e.jsx("div",{className:"px-3",children:a.map(s=>e.jsxs("div",{onClick:()=>t(`/character/${s.id}`),className:"flex items-center px-4 py-3 ios-button glass-card mb-2 rounded-2xl cursor-pointer",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0 shadow-lg overflow-hidden bg-gray-200",children:e.jsx("img",{src:w(s.avatar),alt:s.nickname||s.name,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"ml-4 flex-1 overflow-hidden",children:[e.jsx("h3",{className:"text-gray-900 font-medium",children:s.nickname||s.name}),s.signature&&e.jsx("p",{className:"text-sm text-gray-500 truncate mt-0.5",children:s.signature})]})]},s.id))})]})]})]})},ua=({show:s,onClose:a})=>{const{showStatusBar:r}=o(),[l,n]=t.useState([]),[i,c]=t.useState([]),[d,x]=t.useState(!1),[m,h]=t.useState({}),[u,g]=t.useState(!1);t.useEffect(()=>{s&&p()},[s]);const p=async()=>{try{const e=await I();n(e)}catch(e){n([])}},f=e=>new Promise((t,s)=>{const a=new FileReader;a.onload=e=>{var s;return t(null==(s=e.target)?void 0:s.result)},a.onerror=s,a.readAsDataURL(e)});return s?e.jsxs("div",{className:"fixed inset-0 bg-[#EDEDED] z-50 flex flex-col",children:[e.jsxs("div",{className:"glass-effect sticky top-0 z-50",children:[r&&e.jsx(xa,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:a,className:"text-gray-700 text-base",children:"返回"}),e.jsx("h1",{className:"text-base font-semibold text-gray-900",children:"表情包管理"}),e.jsx("div",{className:"w-12"})]})]}),e.jsx("div",{className:"px-4 py-3 glass-card mx-3 mt-3 rounded-2xl shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:["总计：",e.jsx("span",{className:"font-semibold text-gray-900",children:l.length})," 个表情包"]}),e.jsxs("span",{className:"text-gray-600",children:["大小：",e.jsxs("span",{className:"font-semibold text-gray-900",children:[(JSON.stringify(l).length/1024).toFixed(2)," KB"]})]})]})}),e.jsx("div",{className:"px-3 py-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("label",{className:"flex items-center justify-center px-4 py-2.5 glass-card text-gray-600 text-sm rounded-xl cursor-pointer active:bg-gray-100 shadow-lg border border-gray-200/50",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"批量上传",e.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:e=>{const t=Array.from(e.target.files||[]).filter(e=>e.type.startsWith("image/"));if(0===t.length)return void alert("请选择有效的图片文件");c(t),x(!0);const s={};t.forEach((e,t)=>{s[t]=e.name.replace(/\.[^/.]+$/,"")}),h(s)},className:"hidden"})]}),e.jsxs("button",{onClick:async()=>{if(0!==l.length)try{const e=await _(),t=new Blob([e],{type:"application/json"}),s=URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download=`emojis-backup-${Date.now()}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(s),alert(`成功导出 ${l.length} 个表情包！`)}catch(e){alert("导出失败，可能是无痕模式限制")}else alert("没有表情包可以导出")},className:"flex items-center justify-center px-4 py-2.5 glass-card text-gray-600 text-sm rounded-xl active:bg-gray-100 shadow-lg border border-gray-200/50",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"导出备份"]}),e.jsxs("label",{className:"flex items-center justify-center px-4 py-2.5 glass-card text-gray-600 text-sm rounded-xl cursor-pointer active:bg-gray-100 shadow-lg border border-gray-200/50",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),"导入备份",e.jsx("input",{type:"file",accept:".json,application/json,text/json",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(!s)return;if(!s.name.endsWith(".json")&&"application/json"!==s.type)return alert("请选择 JSON 文件"),void(e.target.value="");const a=l.length;let r=!1;if(a>0){const e=confirm(`当前有 ${a} 个表情包\n\n点击"确定"：追加导入（保留现有）\n点击"取消"：替换导入（清空现有）\n\n提示：如果存储空间不足，建议选择"替换导入"`);r=!e}const n=new FileReader;n.onload=async e=>{var t;try{const s=await M(null==(t=e.target)?void 0:t.result,r);s.success?(await p(),alert(s.message)):alert(s.message)}catch(s){s instanceof Error&&"导入超时"===s.message?alert("⚠️ 导入失败\n\n原因：当前处于无痕/隐私浏览模式\n\n解决方案：\n1. 使用普通浏览模式\n2. 在浏览器设置中允许存储数据"):alert("导入失败，请检查文件格式: "+(s instanceof Error?s.message:""))}},n.onerror=()=>{alert("读取文件失败")},n.readAsText(s),e.target.value=""},className:"hidden"})]}),e.jsxs("button",{onClick:async()=>{if(0!==l.length){if(confirm(`确定要清空所有 ${l.length} 个表情包吗？\n\n此操作无法撤销！建议先导出备份。`))try{await z(),await p(),alert("已清空所有表情包")}catch(e){alert("清空失败，可能是无痕模式限制")}}else alert("没有表情包可以清空")},className:"flex items-center justify-center px-4 py-2.5 glass-card text-gray-600 text-sm rounded-xl active:bg-gray-100 shadow-lg border border-gray-200/50",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"清空全部"]})]})}),d&&e.jsx("div",{className:"px-3 py-3",children:e.jsxs("div",{className:"glass-card rounded-2xl p-4 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["已选择 ",i.length," 个文件"]}),e.jsx("button",{onClick:()=>x(!1),className:"text-sm text-gray-600",children:"取消"})]}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto mb-3",children:i.map((t,s)=>e.jsxs("div",{className:"flex items-center gap-3 bg-white/80 p-2 rounded-xl border border-gray-200/50",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded flex-shrink-0 overflow-hidden",children:e.jsx("img",{src:URL.createObjectURL(t),alt:"",className:"w-full h-full object-cover"})}),e.jsx("input",{type:"text",value:m[s]||"",onChange:e=>h({...m,[s]:e.target.value}),placeholder:"输入描述...",className:"flex-1 px-2 py-1 text-sm border border-gray-200 rounded"}),e.jsx("button",{onClick:()=>(e=>{const t=i.filter((t,s)=>s!==e);if(c(t),0===t.length)x(!1);else{const s={};t.forEach((t,a)=>{s[a]=m[a<e?a:a+1]||t.name.replace(/\.[^/.]+$/,"")}),h(s)}})(s),className:"text-red-500 text-xl w-8 h-8 flex items-center justify-center",children:"×"})]},s))}),e.jsx("button",{onClick:async()=>{if(0!==i.length){g(!0);try{const{addEmoji:t}=await Qt(async()=>{const{addEmoji:e}=await import("./utils-Bw01K5Nk.js").then(e=>e.bH);return{addEmoji:e}},__vite__mapDeps([0,1,2]));let s=0,a=0;for(let r=0;r<i.length;r++){const l=i[r];try{const e=await f(l);if(!(await t({url:e,name:l.name,description:m[r]||l.name.replace(/\.[^/.]+$/,"")}))){a++;break}s++}catch(e){a++}}c([]),x(!1),h({}),p()}catch(e){alert("批量上传失败，请重试")}finally{g(!1)}}},disabled:u,className:"w-full py-2.5 bg-[#07C160] text-white text-sm rounded-xl disabled:opacity-50 shadow-lg",children:u?"上传中...":`确认添加 ${i.length} 个表情包`})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-3 pb-4",children:0===l.length?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[e.jsxs("svg",{className:"w-16 h-16 mb-4",fill:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",opacity:"0.3"}),e.jsx("path",{d:"M8 14s1.5 2 4 2 4-2 4-2"}),e.jsx("circle",{cx:"9",cy:"9",r:"1"}),e.jsx("circle",{cx:"15",cy:"9",r:"1"})]}),e.jsx("div",{className:"text-sm mb-1",children:"还没有表情包"}),e.jsx("div",{className:"text-xs text-gray-300",children:'点击"批量上传"添加表情包'})]}):e.jsx("div",{className:"grid grid-cols-3 gap-3",children:l.map(t=>e.jsxs("div",{className:"relative aspect-square rounded-xl overflow-hidden glass-card shadow-lg border border-gray-200/50 group",children:[e.jsx("img",{src:t.url,alt:t.description,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-2",children:e.jsx("div",{className:"text-white text-xs truncate",children:t.description})}),t.useCount>0&&e.jsxs("div",{className:"absolute top-2 left-2 bg-black/70 text-white text-xs px-2 py-0.5 rounded",children:[t.useCount,"次"]}),e.jsx("button",{onClick:()=>(async e=>{if(confirm("确定要删除这个表情包吗？"))try{await $(e),await p()}catch(t){alert("删除失败，可能是无痕模式限制")}})(t.id),className:"absolute top-2 right-2 w-6 h-6 bg-red-500/90 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center text-sm shadow-lg",children:"×"})]},t.id))})})]}):null},ga=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:s,children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M8 14s1.5 2 4 2 4-2 4-2"}),e.jsx("line",{x1:"9",y1:"9",x2:"9.01",y2:"9"}),e.jsx("line",{x1:"15",y1:"9",x2:"15.01",y2:"9"})]}),pa=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:s,children:[e.jsx("rect",{x:"2",y:"7",width:"20",height:"15",rx:"2",ry:"2"}),e.jsx("polyline",{points:"17 2 12 7 7 2"}),e.jsx("circle",{cx:"8",cy:"14",r:"1"}),e.jsx("circle",{cx:"16",cy:"14",r:"1"})]}),fa=()=>{const a=s(),{background:r,getBackgroundStyle:l}=c(),{showStatusBar:n}=o(),[i,d]=t.useState(!1),x=[{id:1,items:[{id:11,name:"朋友圈",Icon:gs,path:"/moments"},{id:12,name:"情侣空间",Icon:ps,path:"/couple-space"}]},{id:2,items:[{id:21,name:"直播",Icon:fs,path:"/live"},{id:22,name:"摇一摇",Icon:Bs,path:"/shake-shake"}]},{id:3,items:[{id:31,name:"表情包",Icon:ga,path:"",action:"emoji"},{id:32,name:"搜一搜",Icon:as,path:""}]},{id:4,items:[{id:41,name:"记账本",Icon:Ds,path:"/accounting"},{id:42,name:"小程序",Icon:bs,path:"/mini-programs"}]},{id:5,items:[{id:51,name:"小游戏",Icon:pa,path:"/game-list"}]}];return e.jsxs("div",{className:"h-full flex flex-col relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 z-0",style:l()}),e.jsxs("div",{className:"relative z-10 h-full flex flex-col bg-transparent",children:[e.jsxs("div",{className:"sticky top-0 z-50 "+(r?"glass-dark":"glass-effect"),children:[n&&e.jsx(xa,{}),e.jsx("div",{className:"px-5 py-4",children:e.jsx("button",{onClick:()=>a("/"),className:"text-xl font-semibold text-gray-900 ios-button",children:"发现"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-3 pt-3",children:x.map(t=>e.jsx("div",{className:"mb-3",children:e.jsx("div",{className:"glass-card rounded-2xl overflow-hidden",children:t.items.map((s,r)=>{const l=s.Icon;return e.jsxs("div",{children:[e.jsxs("div",{onClick:()=>{"emoji"===s.action?d(!0):s.path&&a(s.path)},className:"flex items-center px-4 py-4 ios-button cursor-pointer",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl glass-card flex items-center justify-center flex-shrink-0 shadow-lg border border-gray-200/50",children:e.jsx(l,{size:22,className:"text-gray-600"})}),e.jsx("span",{className:"ml-4 flex-1 text-gray-900 font-medium",children:s.name}),e.jsx("span",{className:"text-gray-400 text-xl",children:"›"})]}),r<t.items.length-1&&e.jsx("div",{className:"ml-16 border-b border-gray-100"})]},s.id)})})},t.id))}),e.jsx(ua,{show:i,onClose:()=>d(!1)})]})]})},ba=()=>{const t=s(),{currentUser:a}=d(),{background:r,getBackgroundStyle:l}=c(),{showStatusBar:n}=o();(null==a?void 0:a.avatar)&&a.avatar.startsWith("data:image");const i=[{id:1,items:[{id:11,name:"服务",Icon:js,path:"/services"}]},{id:2,items:[{id:21,name:"收藏",Icon:vs,path:""}]},{id:3,items:[{id:31,name:"设置",Icon:Ns,path:"/settings"}]}];return e.jsxs("div",{className:"h-full flex flex-col relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 z-0",style:l()}),e.jsxs("div",{className:"relative z-10 h-full flex flex-col bg-transparent",children:[e.jsxs("div",{className:"sticky top-0 z-50 "+(r?"glass-dark":"glass-effect"),children:[n&&e.jsx(xa,{}),e.jsx("div",{className:"px-5 py-4",children:e.jsx("button",{onClick:()=>t("/"),className:"text-xl font-semibold text-gray-900 ios-button",children:"我"})})]}),e.jsx("div",{className:"px-3 pt-3 mb-3",children:e.jsx("div",{className:"glass-card rounded-2xl overflow-hidden",children:e.jsxs("div",{onClick:()=>t(`/profile/${(null==a?void 0:a.id)||"default"}`),className:"flex items-center px-5 py-5 ios-button cursor-pointer",children:[e.jsx("div",{className:"w-20 h-20 rounded-2xl bg-gray-200 flex items-center justify-center flex-shrink-0 shadow-xl overflow-hidden",children:e.jsx("img",{src:L(null==a?void 0:a.avatar),alt:"头像",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"ml-4 flex-1",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-1",children:(null==a?void 0:a.name)||"微信用户"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["微信号: ",(null==a?void 0:a.username)||"wxid_123456"]})]}),e.jsx("span",{className:"text-gray-400 text-2xl",children:"›"})]})})}),e.jsx("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-3",children:i.map(s=>e.jsx("div",{className:"mb-3",children:e.jsx("div",{className:"glass-card rounded-2xl overflow-hidden",children:s.items.map((a,r)=>{const l=a.Icon;return e.jsxs("div",{children:[e.jsxs("div",{onClick:()=>{a.path&&t(a.path)},className:"flex items-center px-4 py-4 ios-button cursor-pointer",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl glass-card flex items-center justify-center flex-shrink-0 shadow-lg border border-gray-200/50",children:e.jsx(l,{size:22,className:"text-gray-600"})}),e.jsx("span",{className:"ml-4 flex-1 text-gray-900 font-medium",children:a.name}),e.jsx("span",{className:"text-gray-400 text-xl",children:"›"})]}),r<s.items.length-1&&e.jsx("div",{className:"ml-16 border-b border-gray-100"})]},a.id)})})},s.id))})]})]})},ja=({inviterName:s,songTitle:a,songArtist:r,songCover:l,onAccept:n,onReject:i,status:c="pending"})=>{const[o,d]=t.useState(c);return e.jsxs("div",{className:"bg-white/90 backdrop-blur-xl rounded-xl shadow-lg overflow-hidden max-w-[280px] border border-white/20",children:[e.jsxs("div",{className:"bg-white/60 backdrop-blur-md px-4 py-3 flex items-center gap-2 border-b border-gray-100/50",children:[e.jsx("svg",{className:"w-5 h-5 text-gray-700",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"})}),e.jsx("span",{className:"text-gray-800 font-medium text-sm",children:"一起听邀请"})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"text-sm text-gray-700 mb-3",children:[e.jsx("span",{className:"font-medium text-gray-900",children:s})," 邀请你一起听歌"]}),e.jsxs("div",{className:"flex items-center gap-3 mb-4 bg-white/50 backdrop-blur-sm rounded-lg p-3 border border-gray-100/50",children:[e.jsx("div",{className:"flex-shrink-0 w-12 h-12 rounded-lg overflow-hidden bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center",children:l?e.jsx("img",{src:l,alt:a,className:"w-full h-full object-cover"}):e.jsx("svg",{className:"w-6 h-6 text-gray-500",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:a}),e.jsx("div",{className:"text-xs text-gray-500 truncate",children:r})]}),e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx("span",{className:"w-0.5 h-3 bg-gray-400 rounded-full animate-pulse",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-0.5 h-4 bg-gray-400 rounded-full animate-pulse",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-0.5 h-2 bg-gray-400 rounded-full animate-pulse",style:{animationDelay:"300ms"}}),e.jsx("span",{className:"w-0.5 h-5 bg-gray-400 rounded-full animate-pulse",style:{animationDelay:"450ms"}})]})]}),"pending"===o&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{d("rejected"),null==i||i()},className:"flex-1 px-4 py-2 bg-white/50 backdrop-blur-sm text-gray-700 rounded-full text-sm font-medium ios-button hover:bg-white/70 transition-all border border-gray-200/50",children:"拒绝"}),e.jsx("button",{onClick:()=>{d("accepted"),null==n||n()},className:"flex-1 px-4 py-2 bg-white backdrop-blur-xl text-gray-900 rounded-full text-sm font-medium ios-button shadow-md hover:shadow-lg transition-all border border-gray-300/50",children:"接受"})]}),"accepted"===o&&e.jsxs("div",{className:"text-center py-2 text-sm text-green-600 font-medium flex items-center justify-center gap-1",children:[e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"已接受邀请"]}),"rejected"===o&&e.jsx("div",{className:"text-center py-2 text-sm text-gray-500 font-medium",children:"已拒绝"})]})]})},va=({onClose:s,onSend:a})=>{const{playlist:r}=x(),[l,n]=t.useState("library"),[i,c]=t.useState(""),[o,d]=t.useState("");return e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:s,className:"fixed inset-0 bg-black/40 backdrop-blur-sm z-50"}),e.jsxs("div",{className:"fixed inset-x-0 bottom-0 z-50 bg-white rounded-t-3xl shadow-2xl animate-slide-up",children:[e.jsx("div",{className:"flex justify-center pt-3 pb-2",children:e.jsx("div",{className:"w-12 h-1 bg-gray-300 rounded-full"})}),e.jsxs("div",{className:"px-6 py-3 border-b border-gray-100",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"邀请一起听歌"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"选择一首歌曲发送邀请"})]}),e.jsxs("div",{className:"flex border-b border-gray-100",children:[e.jsxs("button",{onClick:()=>n("library"),className:"flex-1 py-3 text-sm font-medium transition-colors "+("library"===l?"text-blue-600 border-b-2 border-blue-600":"text-gray-500"),children:["我的音乐库 (",r.length,")"]}),e.jsx("button",{onClick:()=>n("input"),className:"flex-1 py-3 text-sm font-medium transition-colors "+("input"===l?"text-blue-600 border-b-2 border-blue-600":"text-gray-500"),children:"手动输入"})]}),e.jsx("div",{className:"max-h-[60vh] overflow-y-auto",children:"library"===l?e.jsx("div",{className:"px-4 py-2",children:0===r.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-4xl mb-3",children:"🎵"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"音乐库为空"}),e.jsx("p",{className:"text-gray-400 text-xs mt-1",children:"请先上传歌曲或切换到手动输入"})]}):e.jsx("div",{className:"space-y-2",children:r.map(t=>e.jsxs("button",{onClick:()=>(e=>{a(e.title,e.artist,e.cover),s()})(t),className:"w-full flex items-center gap-3 p-3 rounded-xl hover:bg-gray-50 active:bg-gray-100 transition-colors ios-button",children:[e.jsx("div",{className:"flex-shrink-0 w-12 h-12 rounded-lg overflow-hidden bg-gradient-to-br from-gray-100 to-gray-200",children:t.cover?e.jsx("img",{src:t.cover,alt:t.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-gray-400",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"})})})}),e.jsxs("div",{className:"flex-1 text-left min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 truncate",children:t.title}),e.jsx("div",{className:"text-sm text-gray-500 truncate",children:t.artist})]}),e.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]},t.id))})}):e.jsx("div",{className:"px-6 py-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["歌曲名称 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:i,onChange:e=>c(e.target.value),placeholder:"例如：晴天",className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["歌手 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:o,onChange:e=>d(e.target.value),placeholder:"例如：周杰伦",className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-100 rounded-xl p-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),e.jsx("p",{className:"text-xs text-blue-700",children:"手动输入的歌曲会尝试从音乐库中匹配播放，如果找不到则使用默认封面"})]})}),e.jsx("button",{onClick:()=>{i.trim()&&o.trim()?(a(i.trim(),o.trim()),s()):alert("请输入歌曲名和歌手")},disabled:!i.trim()||!o.trim(),className:"w-full py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl font-medium ios-button shadow-lg disabled:opacity-50 disabled:cursor-not-allowed",children:"发送邀请"})]})})}),e.jsx("div",{className:"h-safe"})]})]})},ya=({songTitle:t,songArtist:s,songCover:a,onClick:r})=>e.jsxs("div",{className:"bg-white/90 backdrop-blur-xl rounded-xl shadow-lg overflow-hidden max-w-[280px] border border-white/20 cursor-pointer hover:shadow-xl transition-shadow",onClick:r,children:[e.jsxs("div",{className:"bg-white/60 backdrop-blur-md px-4 py-3 flex items-center gap-2 border-b border-gray-100/50",children:[e.jsx("svg",{className:"w-5 h-5 text-gray-700",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"})}),e.jsx("span",{className:"text-gray-800 font-medium text-sm",children:"音乐分享"})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 bg-white/50 backdrop-blur-sm rounded-lg p-3 border border-gray-100/50",children:[e.jsx("div",{className:"flex-shrink-0 w-12 h-12 rounded-lg overflow-hidden bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center",children:a?e.jsx("img",{src:a,alt:t,className:"w-full h-full object-cover"}):e.jsx("svg",{className:"w-6 h-6 text-gray-500",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:t}),e.jsx("div",{className:"text-xs text-gray-500 truncate",children:s})]}),e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx("span",{className:"w-0.5 h-3 bg-gray-400 rounded-full animate-pulse",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-0.5 h-4 bg-gray-400 rounded-full animate-pulse",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-0.5 h-2 bg-gray-400 rounded-full animate-pulse",style:{animationDelay:"300ms"}}),e.jsx("span",{className:"w-0.5 h-5 bg-gray-400 rounded-full animate-pulse",style:{animationDelay:"450ms"}})]})]}),e.jsx("div",{className:"text-xs text-gray-400 text-center mt-2",children:"点击查看详情"})]})]});async function Na(e,t=50){try{const s=await async function(e,t=50){var s,a;try{let r,l;r="https://c.y.qq.com/soso/fcgi-bin/client_search_cp",l=new URLSearchParams({ct:"24",qqmusic_ver:"1298",new_json:"1",remoteplace:"txt.yqq.song",searchid:Math.random().toString(),t:"0",aggr:"1",cr:"1",catZhida:"1",lossless:"0",flag_qc:"0",p:"1",n:t.toString(),w:e,g_tk:"5381",loginUin:"0",hostUin:"0",format:"json",inCharset:"utf8",outCharset:"utf-8",notice:"0",platform:"yqq.json",needNewCode:"0"});const n=await fetch(`${r}?${l}`,{method:"GET"});if(!n.ok)return[];const i=await n.json();return(null==(a=null==(s=i.data)?void 0:s.song)?void 0:a.list)?i.data.song.list.map(e=>{var t;return{id:e.songmid||e.songid,name:e.songname||e.name,artists:(null==(t=e.singer)?void 0:t.map(e=>e.name).join(" / "))||"未知",album:e.albumname||"未知专辑",duration:e.interval||0,cover:e.albummid?`https://y.gtimg.cn/music/photo_new/T002R300x300M000${e.albummid}.jpg`:"",fee:0}}):[]}catch(r){return[]}}(e,t);if(s.length>0)return s}catch(s){}try{const e=await async function(){return[]}(0,t);if(e.length>0)return e}catch(s){}return[]}async function wa(e,t=50){try{let t,s;!1||(t="https://zhizhi-api.2373922440jhj.workers.dev/api/music/search",s=new URLSearchParams({keyword:e}));const a=await fetch(`${t}?${s}`,{method:"GET"});if(!a.ok)throw new Error("网易云API请求失败");const r=await a.json();if(r.result&&r.result.songs)return r.result.songs.map(e=>({id:e.id,name:e.name,artists:e.artists.map(e=>e.name).join(" / "),album:e.album.name,duration:Math.floor(e.duration/1e3),cover:e.album.picUrl,fee:e.fee}));throw new Error("网易云API返回空结果")}catch(s){try{const s=await Na(e,t);if(s.length>0)return s}catch(a){}return[]}}async function ka(e){try{let t,s;!1||(t="https://zhizhi-api.2373922440jhj.workers.dev/api/music/url",s=new URLSearchParams({id:e.toString()}));const a=await fetch(`${t}?${s}`,{method:"GET"});if(!a.ok)return null;const r=await a.json();return r.data&&r.data.length>0&&r.data[0].url?r.data[0].url:null}catch(t){return async function(e){try{return`https://ws.stream.qqmusic.qq.com/C400${"string"==typeof e?e:e.toString()}.m4a?guid=0&vkey=&uin=0&fromtag=120032`}catch(t){return null}}(e)}}async function Ca(e){try{let t,s;!1||(t="https://zhizhi-api.2373922440jhj.workers.dev/api/music/lyric",s=new URLSearchParams({id:e.toString()}));const a=await fetch(`${t}?${s}`,{method:"GET"});if(!a.ok)return null;const r=await a.json();return r.lrc&&r.lrc.lyric?r.lrc.lyric:null}catch(t){return null}}const Sa=({songTitle:a,songArtist:r,songCover:l,isOpen:n,onClose:i})=>{const c=s(),o=x(),[d,m]=t.useState(!1),[h,u]=t.useState(!1);t.useEffect(()=>(document.body.style.overflow=n?"hidden":"",()=>{document.body.style.overflow=""}),[n]);const g=()=>{m(!0),setTimeout(()=>{m(!1),i()},300)};return n||d?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 transition-all duration-300 "+(d?"opacity-0":"opacity-100"),onClick:g,children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm"}),e.jsxs("div",{className:"relative bg-white/95 backdrop-blur-xl rounded-3xl shadow-2xl max-w-md w-full overflow-hidden transform transition-all duration-300 "+(d?"scale-95 opacity-0":"scale-100 opacity-100"),onClick:e=>e.stopPropagation(),children:[e.jsx("button",{onClick:g,className:"absolute top-4 right-4 z-10 w-8 h-8 rounded-full bg-black/20 hover:bg-black/30 flex items-center justify-center transition-colors",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"relative h-64 bg-gradient-to-br from-purple-400 via-pink-400 to-red-400",children:[l?e.jsx("img",{src:l,alt:a,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("svg",{className:"w-24 h-24 text-white/60",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"})})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent"})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2 leading-tight",children:a}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 mb-6",children:[e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})}),e.jsx("span",{className:"text-lg",children:r})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:async()=>{u(!0);try{const e=`${a} ${r}`,t=await wa(e);if(0===t.length)return alert("未找到该歌曲，请尝试其他搜索方式"),void u(!1);const s=t[0],l=await ka(s.id);if(!l)return alert("无法获取播放链接，该歌曲可能暂时无法播放"),void u(!1);const n=await Ca(s.id),i={id:s.id,title:s.name,artist:s.artists,album:s.album,duration:s.duration,cover:s.cover,audioUrl:l,lyrics:n||void 0};o.setPlaylist([i]),o.setCurrentSong(i,0),o.play(),g(),setTimeout(()=>{c("/music-player")},100)}catch(e){alert("播放失败，请重试")}finally{u(!1)}},disabled:h,className:"flex-1 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-full py-3 px-6 font-medium shadow-lg hover:shadow-xl transition-all flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:h?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"搜索中..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M8 5v14l11-7z"})}),"播放"]})}),e.jsxs("button",{onClick:()=>{const e=`${a} - ${r}`;navigator.clipboard.writeText(e),alert("已复制歌曲信息")},className:"bg-gray-100 text-gray-700 rounded-full py-3 px-6 font-medium hover:bg-gray-200 transition-colors flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),"复制"]})]}),e.jsx("p",{className:"text-xs text-gray-400 text-center mt-4",children:h?"正在搜索歌曲...":"点击播放按钮在线搜索并播放"})]})]})]}):null},Ia=({onClose:t,onSelectImage:s,onSelectCamera:a,onSelectRedPacket:r,onSelectTransfer:l,onSelectIntimatePay:n,onSelectCoupleSpaceInvite:i,onSelectCoupleSpaceContent:c,onSelectLocation:o,onSelectVoiceMessage:d,onSelectVoiceCall:x,onSelectVideoCall:m,onSelectXiaohongshu:h,onSelectMusicInvite:u,onRegenerateAI:g,hasCoupleSpace:p})=>{const f=[{id:"image",label:"相册",Icon:ds,onClick:s},{id:"camera",label:"拍摄",Icon:ks,onClick:a},{id:"xiaohongshu",label:"小红书",Icon:sa,onClick:h},{id:"redpacket",label:"红包",Icon:Cs,onClick:r},{id:"transfer",label:"转账",Icon:Ss,onClick:l},{id:"intimate-pay",label:"亲密付",Icon:Is,onClick:n},{id:"couple-space",label:"情侣空间",Icon:ps,onClick:()=>{p?c():i()}},{id:"voice-msg",label:"语音",Icon:cs,onClick:d},{id:"voice",label:"语音通话",Icon:Ms,onClick:x},{id:"video",label:"视频通话",Icon:zs,onClick:m},{id:"music-invite",label:"一起听",Icon:Es,onClick:u},{id:"location",label:"位置",Icon:_s,onClick:o},{id:"regenerate",label:"重回",Icon:ta,onClick:g}];return e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:t,className:"fixed inset-0 bg-black bg-opacity-30 z-40",style:{bottom:0}}),e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 glass-effect border-t border-gray-200/50 z-50 pb-safe animate-slide-up",children:[e.jsx("div",{className:"w-full mx-auto px-6 py-8",children:e.jsx("div",{className:"grid grid-cols-4 gap-6",children:f.map(s=>{const a=s.Icon;return e.jsxs("button",{onClick:e=>{e.stopPropagation(),s.onClick(),t()},className:"flex flex-col items-center gap-3 ios-button",children:[e.jsx("div",{className:"w-14 h-14 glass-card rounded-2xl flex items-center justify-center shadow-md border border-gray-200/50 hover:shadow-lg transition-all",children:e.jsx(a,{size:26,className:"text-gray-700"})}),e.jsx("span",{className:"text-[13px] text-gray-700 font-medium",children:s.label})]},s.id)})})}),e.jsx("div",{className:"flex justify-center pt-1 pb-3",children:e.jsx("div",{className:"w-32 h-1 bg-gray-900 rounded-full opacity-30"})})]})]})},_a=({show:t,character:s,isVideoCall:a,onAccept:r,onReject:l})=>t?e.jsxs("div",{className:"fixed top-20 left-1/2 transform -translate-x-1/2 z-50 w-[90%] max-w-sm animate-slide-down",children:[e.jsx("div",{className:"rounded-[28px] p-5 border",style:{background:"linear-gradient(135deg, rgba(60, 60, 70, 0.85) 0%, rgba(45, 45, 55, 0.90) 100%)",backdropFilter:"blur(40px) saturate(180%)",WebkitBackdropFilter:"blur(40px) saturate(180%)",borderColor:"rgba(255, 255, 255, 0.18)",boxShadow:"\n            0 20px 60px -12px rgba(0, 0, 0, 0.5),\n            0 8px 20px -6px rgba(0, 0, 0, 0.3),\n            inset 0 1px 0 0 rgba(255, 255, 255, 0.2),\n            inset 0 -1px 0 0 rgba(0, 0, 0, 0.2)\n          "},children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"relative w-14 h-14 rounded-full overflow-hidden flex-shrink-0",style:{background:"linear-gradient(135deg, rgba(80, 80, 90, 0.9), rgba(60, 60, 70, 0.9))",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3), inset 0 1px 2px rgba(255, 255, 255, 0.1)"},children:s.avatar?s.avatar.startsWith("data:image")||s.avatar.startsWith("http")?e.jsx("img",{src:s.avatar,alt:s.name,className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-2xl flex items-center justify-center h-full",children:s.avatar}):e.jsx("span",{className:"text-white text-lg font-semibold flex items-center justify-center h-full",children:s.name.charAt(0)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-[17px] truncate mb-0.5",style:{color:"rgba(255, 255, 255, 0.95)",textShadow:"0 1px 2px rgba(0, 0, 0, 0.3)"},children:s.name}),e.jsx("p",{className:"text-[13px]",style:{color:"rgba(255, 255, 255, 0.65)",textShadow:"0 1px 1px rgba(0, 0, 0, 0.2)"},children:a?"视频通话":"语音通话"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:r,className:"w-[52px] h-[52px] rounded-full flex items-center justify-center transition-all active:scale-95",style:{background:"linear-gradient(135deg, #34C759 0%, #30B350 100%)",boxShadow:"\n                  0 4px 16px rgba(52, 199, 89, 0.4),\n                  0 2px 8px rgba(0, 0, 0, 0.3),\n                  inset 0 1px 0 rgba(255, 255, 255, 0.25)\n                "},children:e.jsx("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"white",style:{filter:"drop-shadow(0 1px 1px rgba(0, 0, 0, 0.2))"},children:e.jsx("path",{d:"M20.01 15.38c-1.23 0-2.42-.2-3.53-.56-.35-.12-.74-.03-1.01.24l-1.57 1.97c-2.83-1.35-5.48-3.9-6.89-6.83l1.95-1.66c.27-.28.35-.67.24-1.02-.37-1.11-.56-2.3-.56-3.53 0-.54-.45-.99-.99-.99H4.19C3.65 3 3 3.24 3 3.99 3 13.28 10.73 21 20.01 21c.71 0 .99-.63.99-1.18v-3.45c0-.54-.45-.99-.99-.99z"})})}),e.jsx("button",{onClick:l,className:"w-[52px] h-[52px] rounded-full flex items-center justify-center transition-all active:scale-95",style:{background:"linear-gradient(135deg, #FF3B30 0%, #E8352A 100%)",boxShadow:"\n                  0 4px 16px rgba(255, 59, 48, 0.4),\n                  0 2px 8px rgba(0, 0, 0, 0.3),\n                  inset 0 1px 0 rgba(255, 255, 255, 0.25)\n                "},children:e.jsx("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"white",style:{filter:"drop-shadow(0 1px 1px rgba(0, 0, 0, 0.2))"},children:e.jsx("path",{d:"M12,9C10.4,9,8.85,9.25,7.4,9.72v2.09C7.4,12.46,6.86,13,6.21,13H3.78c-0.65,0-1.18-0.54-1.18-1.18v-1.09 C2.6,5.88,6.88,1.6,11.73,1.6h0.55c4.85,0,9.13,4.28,9.13,9.13v1.09c0,0.65-0.54,1.18-1.18,1.18h-2.43 c-0.65,0-1.18-0.54-1.18-1.18V9.72C15.15,9.25,13.6,9,12,9z"})})})]})]})}),e.jsx("style",{children:"\n        @keyframes slide-down {\n          from {\n            opacity: 0;\n            transform: translate(-50%, -20px);\n          }\n          to {\n            opacity: 1;\n            transform: translate(-50%, 0);\n          }\n        }\n        .animate-slide-down {\n          animation: slide-down 0.3s ease-out forwards;\n        }\n      "})]}):null,Ma=({show:s,onClose:a,onSend:r,characterId:l,characterName:n})=>{const[i,c]=t.useState(""),[o,d]=t.useState("恭喜发财，大吉大利"),[x,m]=t.useState(!1),[h,u]=t.useState([]),[g,p]=t.useState("");t.useEffect(()=>{if(s){const e=A().filter(e=>"character_to_user"===e.type).map(e=>({id:e.characterId,name:e.characterName,remaining:e.monthlyLimit-e.usedAmount})).filter(e=>e.remaining>0);if(u(e),e.length>0){const t=(l?e.find(e=>e.id===l):null)||e[0];p(t.id),m(!0)}else m(!1),p("")}},[s]);const f=()=>{c(""),d("恭喜发财，大吉大利"),m(!1),p(""),a()};return s?e.jsx("div",{className:"red-packet-modal "+(s?"show":""),onClick:e=>{e.target===e.currentTarget&&f()},children:e.jsxs("div",{className:"red-packet-panel",children:[e.jsx("div",{className:"red-packet-header",children:e.jsx("div",{className:"red-packet-title",children:"发红包"})}),e.jsxs("div",{className:"red-packet-form",children:[e.jsxs("div",{className:"red-packet-field",children:[e.jsx("label",{className:"red-packet-label",children:"金额"}),e.jsx("input",{type:"text",className:"red-packet-input",placeholder:"请输入金额",value:i,onChange:e=>{let t=e.target.value.replace(/[^\d.]/g,"");const s=t.split(".");s.length>2&&(t=s[0]+"."+s.slice(1).join("")),s[1]&&s[1].length>2&&(t=s[0]+"."+s[1].substring(0,2)),c(t)},autoFocus:!0}),e.jsxs("div",{className:"red-packet-hint",children:["最多¥",200,"元"]})]}),e.jsxs("div",{className:"red-packet-field",children:[e.jsx("label",{className:"red-packet-label",children:"祝福语"}),e.jsx("input",{type:"text",className:"red-packet-input",placeholder:"恭喜发财，大吉大利",value:o,onChange:e=>d(e.target.value),maxLength:20})]}),h.length>0&&e.jsxs("div",{className:"red-packet-field",children:[e.jsxs("label",{className:"flex items-center cursor-pointer mb-2",children:[e.jsx("input",{type:"checkbox",checked:x,onChange:e=>m(e.target.checked),className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-700 font-medium",children:"使用亲密付"})]}),x&&e.jsx("select",{value:g,onChange:e=>p(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-red-500",children:h.map(t=>e.jsxs("option",{value:t.id,children:[t.name,"的亲密付（剩余￥",t.remaining.toFixed(2),"）"]},t.id))})]}),e.jsxs("div",{className:"red-packet-buttons",children:[e.jsx("button",{className:"red-packet-btn red-packet-btn-cancel",onClick:f,children:"取消"}),e.jsx("button",{className:"red-packet-btn red-packet-btn-send",onClick:()=>{const e=parseFloat(i);if(!e||e<=0)return void alert("请输入有效金额");if(e>200)return void alert("最多¥200元");if(x){const t=h.find(e=>e.id===g);if(!t)return void alert("请选择要使用的亲密付");if(e>t.remaining)return void alert(`${t.name}的亲密付剩余额度不足\n剩余：￥${t.remaining.toFixed(2)}\n需要：￥${e.toFixed(2)}\n\n您可以取消勾选"使用亲密付"，使用零钱余额支付`)}else{if(e>T())return void alert("余额不足，请先充值")}const t=o.trim()||"恭喜发财，大吉大利";r(e,t,x,x?g:void 0),c(""),d("恭喜发财，大吉大利"),m(!1)},children:"发送"})]})]})]})}):null},za=({show:t,redEnvelope:s,canClaim:a,onClose:r,onClaim:l})=>{if(!t||!s)return null;const n=m(s),i="claimed"===s.status;return e.jsx("div",{className:"red-packet-detail-modal "+(t?"show":""),onClick:e=>{e.target===e.currentTarget&&r()},children:e.jsxs("div",{className:"red-packet-detail-panel",children:[e.jsxs("div",{className:"red-packet-detail-header",children:[e.jsx("button",{className:"red-packet-detail-close",onClick:r,children:"×"}),e.jsx("div",{className:"red-packet-detail-icon",children:"🧧"}),e.jsx("div",{className:"red-packet-detail-blessing",children:s.blessing}),e.jsx("div",{className:"red-packet-detail-status",children:i?"已领取":n?"已过期":"等待领取"})]}),e.jsxs("div",{className:"red-packet-detail-body",children:[e.jsx("div",{className:"red-packet-detail-amount",children:i?e.jsxs("span",{className:"amount-value",children:["¥",s.amount.toFixed(2)]}):n?e.jsx("span",{className:"amount-value expired",children:"已过期"}):e.jsx("span",{className:"amount-hidden",children:"未领取"})}),i&&s.claimedBy&&s.claimedAt&&e.jsx("div",{className:"red-packet-detail-claimer",children:e.jsxs("div",{className:"claimer-info",children:[e.jsx("div",{className:"claimer-name",children:s.claimedBy}),e.jsx("div",{className:"claim-time",children:(o=s.claimedAt,new Date(o).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}))})]})}),e.jsxs("div",{className:"red-packet-detail-time",children:["有效期至 ",(c=s.createdAt,new Date(c+864e5).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}))]}),a&&e.jsx("button",{className:"red-packet-claim-btn",onClick:l,children:"开红包"})]})]})});var c,o},$a=({redEnvelope:t,onClick:s,coverImage:a,iconImage:r})=>{const l=m(t),n="claimed"===t.status;let i="red-packet-pending",c=null;return l&&!n?(i="red-packet-expired",c=e.jsx("div",{className:"red-packet-status",children:"已过期"})):n&&(i="red-packet-claimed",c=e.jsx("div",{className:"red-packet-status",children:"已领取"})),e.jsxs("div",{className:`message-bubble red-packet ${i}`,onClick:s,"data-red-envelope-id":t.id,style:{position:"relative",overflow:"hidden"},children:[a&&e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundImage:`url(${a})`,backgroundSize:"cover",backgroundPosition:"center",zIndex:0}}),e.jsxs("div",{style:{position:"relative",zIndex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"space-around",height:"100%"},children:[c,e.jsx("div",{className:"red-packet-content",children:e.jsx("div",{className:"red-packet-blessing",children:t.blessing})}),e.jsx("div",{className:"red-packet-icon",style:{backgroundImage:r?`url(${r})`:"none",backgroundSize:"cover",backgroundPosition:"center",color:r?"transparent":void 0},children:"领"})]})]})},La=({note:t,onClick:s})=>{const a=e=>e>=1e4?(e/1e4).toFixed(1)+"w":e.toString();return e.jsxs("div",{className:"xiaohongshu-card",onClick:s,style:{background:"white",borderRadius:"12px",overflow:"hidden",maxWidth:"280px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",cursor:"pointer",transition:"transform 0.2s"},onMouseEnter:e=>{e.currentTarget.style.transform="scale(1.02)"},onMouseLeave:e=>{e.currentTarget.style.transform="scale(1)"},children:[e.jsxs("div",{style:{position:"relative",width:"100%",paddingBottom:"133%",background:"#f5f5f5"},children:[e.jsx("img",{src:t.coverImage,alt:t.title,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover"},onError:e=>{e.currentTarget.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjI2NyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjI2NyIgZmlsbD0iI2Y1ZjVmNSIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LXNpemU9IjE0IiBmaWxsPSIjOTk5IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+5Zu+54mH5Yqg6L295aSx6LSlPC90ZXh0Pjwvc3ZnPg=="}}),e.jsxs("div",{style:{position:"absolute",top:"8px",left:"8px",background:"rgba(255,44,85,0.9)",color:"white",padding:"4px 8px",borderRadius:"4px",fontSize:"11px",fontWeight:"bold",display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z"})}),"小红书"]})]}),e.jsxs("div",{style:{padding:"12px"},children:[e.jsx("div",{style:{fontSize:"14px",fontWeight:"500",color:"#333",marginBottom:"8px",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",lineHeight:"1.4"},children:t.title}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",marginBottom:"8px"},children:[e.jsx("img",{src:t.author.avatar,alt:t.author.nickname,style:{width:"20px",height:"20px",borderRadius:"50%",objectFit:"cover"},onError:e=>{e.currentTarget.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iMTAiIGN5PSIxMCIgcj0iMTAiIGZpbGw9IiNkZGQiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1zaXplPSIxMiIgZmlsbD0iI2ZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPjwvdGV4dD48L3N2Zz4="}}),e.jsx("span",{style:{fontSize:"12px",color:"#666"},children:t.author.nickname})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",fontSize:"12px",color:"#999"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx("span",{children:"❤️"}),e.jsx("span",{children:a(t.stats.likes)})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx("span",{children:"💬"}),e.jsx("span",{children:a(t.stats.comments)})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx("span",{children:"⭐"}),e.jsx("span",{children:a(t.stats.collects)})]})]})]})]})},Aa=({onClose:s,onSelect:a})=>{const[r,l]=t.useState(""),[n,i]=t.useState([]),[c,o]=t.useState(!1),[d,x]=t.useState("推荐");t.useEffect(()=>{m()},[]);const m=async()=>{o(!0);try{const e=await D(6);i(e)}catch(e){}finally{o(!1)}},h=e=>e>=1e4?(e/1e4).toFixed(1)+"w":e.toString();return e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:s,className:"fixed inset-0 bg-black bg-opacity-50 z-50"}),e.jsxs("div",{className:"fixed inset-x-4 top-20 bottom-20 bg-white rounded-3xl shadow-2xl z-50 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"选择小红书笔记"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{s();const e=new CustomEvent("openXiaohongshuInput");window.dispatchEvent(e)},className:"px-3 py-1.5 text-sm bg-red-50 text-red-600 rounded-full hover:bg-red-100 transition-colors",children:"✏️ 手动输入"}),e.jsx("button",{onClick:s,className:"w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition-colors",children:e.jsx("svg",{className:"w-5 h-5 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-2 bg-gray-100 rounded-full px-4 py-2",children:[e.jsx(as,{size:20,className:"text-gray-400"}),e.jsx("input",{type:"text",placeholder:"搜索小红书笔记...",value:r,onChange:e=>l(e.target.value),onKeyPress:e=>"Enter"===e.key&&(async()=>{if(r.trim()){o(!0);try{const e=await B(r,10);i(e.notes)}catch(e){}finally{o(!1)}}else m()})(),className:"flex-1 bg-transparent border-none outline-none text-sm text-gray-900 placeholder-gray-400"}),r&&e.jsx("button",{onClick:()=>{l(""),m()},className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})})]})}),e.jsx("div",{className:"flex gap-2 px-4 py-3 border-b border-gray-200 overflow-x-auto",children:["推荐","美食","穿搭","美妆","旅行","探店"].map(t=>e.jsx("button",{onClick:()=>(async e=>{if(x(e),"推荐"===e)m();else{o(!0);try{const t=await B(e,10);i(t.notes)}catch(t){}finally{o(!1)}}})(t),className:"px-4 py-1.5 rounded-full text-sm whitespace-nowrap transition-colors "+(d===t?"bg-red-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:t},t))}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:c?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"text-gray-400",children:"加载中..."})}):0===n.length?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center text-gray-400",children:[e.jsx("div",{className:"text-4xl mb-2",children:"📕"}),e.jsx("div",{children:"暂无相关笔记"})]})}):e.jsx("div",{className:"grid grid-cols-2 gap-3",children:n.map(t=>e.jsxs("div",{onClick:()=>a(t),className:"bg-white rounded-xl overflow-hidden shadow-md hover:shadow-lg transition-shadow cursor-pointer",children:[e.jsx("div",{className:"relative w-full pb-[133%] bg-gray-100",children:e.jsx("img",{src:t.coverImage,alt:t.title,className:"absolute inset-0 w-full h-full object-cover",onError:e=>{e.currentTarget.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjI2NyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjI2NyIgZmlsbD0iI2Y1ZjVmNSIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LXNpemU9IjE0IiBmaWxsPSIjOTk5IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+5Zu+54mH5Yqg6L295aSx6LSlPC90ZXh0Pjwvc3ZnPg=="}})}),e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 line-clamp-2 mb-1",children:t.title}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"❤️"}),e.jsx("span",{children:h(t.stats.likes)})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"💬"}),e.jsx("span",{children:h(t.stats.comments)})]})]})]})]},t.id))})})]})]})},Ta=({onClose:s,onSubmit:a})=>{const[r,l]=t.useState(""),[n,i]=t.useState(""),[c,o]=t.useState(""),[d,x]=t.useState(""),[m,h]=t.useState(""),[u,g]=t.useState(""),[p,f]=t.useState(""),[b,j]=t.useState([]),[v,y]=t.useState(""),[N,w]=t.useState(!1),[k,C]=t.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:s,className:"fixed inset-0 bg-black bg-opacity-50 z-50"}),e.jsxs("div",{className:"fixed inset-x-4 top-10 bottom-10 bg-white rounded-3xl shadow-2xl z-50 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"📕 分享小红书笔记"}),e.jsx("button",{onClick:s,className:"w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition-colors",children:e.jsx("svg",{className:"w-5 h-5 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[e.jsx("div",{className:"text-sm text-gray-500 bg-blue-50 p-3 rounded-lg",children:'✨ 粘贴小红书链接，点击"自动提取"即可！AI会看到完整内容'}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"小红书链接 *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:r,onChange:e=>{l(e.target.value),C(!1)},placeholder:"粘贴小红书链接...",className:"flex-1 px-4 py-3 border border-gray-300 rounded-2xl focus:outline-none focus:ring-2 focus:ring-red-500",autoFocus:!0}),e.jsx("button",{onClick:async()=>{var e,t,s,a,l,n;if(r.trim()){w(!0);try{const c=await fetch("/.netlify/functions/xiaohongshu-extract",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:r})});if(!c.ok)throw new Error("提取失败");const d=await c.json();if(d.needManualInput)return alert("自动提取失败，请手动填写信息"),void w(!1);i(d.title||""),o(d.description||""),x(d.coverImage||(null==(e=d.images)?void 0:e[0])||""),h((null==(s=null==(t=d.stats)?void 0:t.likes)?void 0:s.toString())||""),g((null==(l=null==(a=d.stats)?void 0:a.comments)?void 0:l.toString())||""),f((null==(n=d.author)?void 0:n.nickname)||""),j(d.topComments||[]),C(!0),alert("✅ 自动提取成功！请检查信息后分享")}catch(c){alert("自动提取失败，请手动填写信息")}finally{w(!1)}}else alert("请先粘贴小红书链接")},disabled:!r.trim()||N,className:"px-6 py-3 bg-red-500 text-white rounded-2xl font-medium hover:bg-red-600 disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap",children:N?"提取中...":"🔍 自动提取"})]}),e.jsx("div",{className:"mt-1 text-xs text-gray-500",children:"支持格式: https://www.xiaohongshu.com/explore/xxxxx"})]}),k&&e.jsx("div",{className:"text-sm text-green-600 bg-green-50 p-3 rounded-lg",children:'✅ 信息已自动提取！请检查后点击"分享给AI"'}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"标题 *"}),e.jsx("input",{type:"text",value:n,onChange:e=>i(e.target.value),placeholder:"笔记标题",className:"w-full px-4 py-3 border border-gray-300 rounded-2xl focus:outline-none focus:ring-2 focus:ring-red-500",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"内容描述"}),e.jsx("textarea",{value:c,onChange:e=>o(e.target.value),placeholder:"笔记的详细内容...",className:"w-full h-32 px-4 py-3 border border-gray-300 rounded-2xl resize-none focus:outline-none focus:ring-2 focus:ring-red-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"封面图片链接（可选）"}),e.jsx("input",{type:"text",value:d,onChange:e=>x(e.target.value),placeholder:"https://...",className:"w-full px-4 py-3 border border-gray-300 rounded-2xl focus:outline-none focus:ring-2 focus:ring-red-500"}),d&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:d,alt:"预览",className:"w-32 h-32 object-cover rounded-xl",onError:e=>{e.currentTarget.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI2VlZSIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LXNpemU9IjEyIiBmaWxsPSIjOTk5IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+5Zu+54mH5Yqg6L295aSx6LSlPC90ZXh0Pjwvc3ZnPg=="}})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"作者昵称"}),e.jsx("input",{type:"text",value:p,onChange:e=>f(e.target.value),placeholder:"作者名字",className:"w-full px-4 py-3 border border-gray-300 rounded-2xl focus:outline-none focus:ring-2 focus:ring-red-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"点赞数"}),e.jsx("input",{type:"number",value:m,onChange:e=>h(e.target.value),placeholder:"0",className:"w-full px-4 py-3 border border-gray-300 rounded-2xl focus:outline-none focus:ring-2 focus:ring-red-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"评论数"}),e.jsx("input",{type:"number",value:u,onChange:e=>g(e.target.value),placeholder:"0",className:"w-full px-4 py-3 border border-gray-300 rounded-2xl focus:outline-none focus:ring-2 focus:ring-red-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"热门评论（AI会看到）"}),b.length>0&&e.jsx("div",{className:"mb-3 space-y-2",children:b.map((t,s)=>e.jsxs("div",{className:"bg-gray-50 p-3 rounded-xl flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.author}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:t.content}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["👍 ",t.likes]})]}),e.jsx("button",{onClick:()=>{j(b.filter((e,t)=>t!==s))},className:"text-gray-400 hover:text-red-500 ml-2",children:e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})})]},s))}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-2xl p-4",children:[e.jsx("textarea",{value:v,onChange:e=>y(e.target.value),placeholder:"输入一条评论内容...（格式：用户名|评论内容|点赞数）\n例如：小明|这个太好了！|520",className:"w-full px-3 py-2 border border-gray-300 rounded-xl resize-none focus:outline-none focus:ring-2 focus:ring-red-500 text-sm",rows:2}),e.jsx("button",{onClick:()=>{if(!v.trim())return;const e=v.split("|").map(e=>e.trim());3===e.length?(j([...b,{author:e[0],content:e[1],likes:parseInt(e[2])||0}]),y("")):alert("格式错误！请按照：用户名|评论内容|点赞数")},className:"mt-2 w-full px-4 py-2 bg-gray-100 text-gray-700 rounded-xl text-sm hover:bg-gray-200",children:"➕ 添加评论"})]}),e.jsx("div",{className:"mt-1 text-xs text-gray-500",children:"💡 添加热门评论让AI更好理解这个笔记的反馈"})]})]}),e.jsxs("div",{className:"p-4 border-t border-gray-200 flex gap-3",children:[e.jsx("button",{onClick:s,className:"flex-1 px-4 py-3 bg-gray-100 text-gray-700 rounded-full font-medium",children:"取消"}),e.jsx("button",{onClick:()=>{if(!n.trim())return void alert("请至少填写标题");const e={id:`user_share_${Date.now()}`,title:n,description:c||n,coverImage:d||"https://picsum.photos/300/400?random=999",images:d?[d]:[],author:{id:"real_author",nickname:p||"小红书用户",avatar:"https://i.pravatar.cc/150?img=9"},stats:{likes:parseInt(m)||0,comments:parseInt(u)||0,collects:parseInt(m)?Math.floor(.8*parseInt(m)):0},tags:[],url:r||"https://www.xiaohongshu.com",createTime:Date.now(),topComments:b.length>0?b:void 0};a(e)},className:"flex-1 px-4 py-3 bg-red-500 text-white rounded-full font-medium",children:"分享给AI"})]})]})]})},Da=({show:s,onClose:a,onSend:r,characterId:l,characterName:n})=>{const[i,c]=t.useState(""),[o,d]=t.useState(""),[x,m]=t.useState(!1),[h,u]=t.useState([]),[g,p]=t.useState("");t.useEffect(()=>{s&&(c(""),d(""),m(!1))},[s]),t.useEffect(()=>{if(s){const e=A().filter(e=>"character_to_user"===e.type).map(e=>({id:e.characterId,name:e.characterName,remaining:e.monthlyLimit-e.usedAmount})).filter(e=>e.remaining>0);if(u(e),e.length>0){const t=(l?e.find(e=>e.id===l):null)||e[0];p(t.id),m(!0)}else m(!1),p("")}},[s]);const f=()=>{c(""),d(""),m(!1),p(""),a()};return s?e.jsx("div",{className:"red-packet-modal "+(s?"show":""),onClick:e=>{e.target===e.currentTarget&&f()},children:e.jsxs("div",{className:"red-packet-panel",children:[e.jsx("div",{className:"red-packet-header",style:{background:"linear-gradient(135deg, #fff5f0 0%, #ffe8dc 100%)"},children:e.jsx("div",{className:"red-packet-title",children:"转账"})}),e.jsxs("div",{className:"red-packet-form",children:[e.jsxs("div",{className:"red-packet-field",children:[e.jsx("label",{className:"red-packet-label",children:"金额"}),e.jsx("input",{type:"text",className:"red-packet-input",placeholder:"请输入金额",value:i,onChange:e=>{let t=e.target.value.replace(/[^\d.]/g,"");const s=t.split(".");s.length>2&&(t=s[0]+"."+s.slice(1).join("")),s[1]&&s[1].length>2&&(t=s[0]+"."+s[1].substring(0,2)),c(t)},autoFocus:!0})]}),e.jsxs("div",{className:"red-packet-field",children:[e.jsx("label",{className:"red-packet-label",children:"转账说明"}),e.jsx("input",{type:"text",className:"red-packet-input",placeholder:"添加转账说明（可选）",value:o,onChange:e=>d(e.target.value),maxLength:20})]}),h.length>0&&e.jsxs("div",{className:"red-packet-field",children:[e.jsxs("label",{className:"flex items-center cursor-pointer mb-2",children:[e.jsx("input",{type:"checkbox",checked:x,onChange:e=>m(e.target.checked),className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-700 font-medium",children:"使用亲密付"})]}),x&&e.jsx("select",{value:g,onChange:e=>p(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-500",children:h.map(t=>e.jsxs("option",{value:t.id,children:[t.name,"的亲密付（剩余￥",t.remaining.toFixed(2),"）"]},t.id))})]}),e.jsxs("div",{className:"red-packet-buttons",children:[e.jsx("button",{className:"red-packet-btn red-packet-btn-cancel",onClick:f,children:"取消"}),e.jsx("button",{className:"red-packet-btn",onClick:()=>{const e=parseFloat(i);if(!e||e<=0)return void alert("请输入有效金额");if(x){const t=h.find(e=>e.id===g);if(!t)return void alert("请选择要使用的亲密付");if(e>t.remaining)return void alert(`${t.name}的亲密付剩余额度不足\n剩余：￥${t.remaining.toFixed(2)}\n需要：￥${e.toFixed(2)}\n\n您可以取消勾选"使用亲密付"，使用零钱余额支付`)}else{if(e>T())return void alert("余额不足，请先充值")}const t=o.trim();r(e,t,x,x?g:void 0),c(""),d(""),m(!1)},style:{background:"linear-gradient(135deg, #FF9500 0%, #FF8000 100%)",color:"white",boxShadow:"0 6px 20px rgba(255, 149, 0, 0.35)"},children:"转账"})]})]})]})}):null},Ba="/zhizhi/assets/intimate-pay-icon-tdmSPkmO.webp",Ea=({onSend:s,onCancel:a})=>{const[r,l]=t.useState(""),[n,i]=t.useState(!1),[c,o]=t.useState(0);t.useEffect(()=>{o(T())},[]);return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-end justify-center z-50",onClick:a,children:e.jsxs("div",{className:"bg-white rounded-t-3xl w-full max-w-md p-6 pb-8 animate-slide-up",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"开通亲密付"}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 text-2xl leading-none",children:"×"})]}),e.jsxs("div",{className:"bg-pink-50 rounded-xl p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full overflow-hidden flex-shrink-0",children:e.jsx("img",{src:Ba,alt:"亲密付",className:"w-full h-full object-cover"})}),e.jsx("span",{className:"text-sm font-medium text-pink-600",children:"什么是亲密付？"})]}),e.jsx("p",{className:"text-xs text-pink-600 leading-relaxed mb-3",children:"为对方开通后，TA每月可使用你的零钱进行消费，你可以随时查看消费记录"}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-pink-200",children:[e.jsx("span",{className:"text-xs text-pink-600",children:"当前零钱余额"}),e.jsxs("span",{className:"text-sm font-semibold "+(c<500?"text-orange-500":"text-pink-600"),children:["¥",c.toFixed(2)]})]}),e.jsx("div",{className:"mt-2 text-xs text-pink-600",children:"💡 提示：你的余额必须≥月额度才能开通"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-sm text-gray-600 mb-3",children:"设置月额度"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:[{label:"500元/月",value:500},{label:"1000元/月",value:1e3},{label:"2000元/月",value:2e3},{label:"3000元/月",value:3e3},{label:"5000元/月",value:5e3},{label:"自定义",value:0}].map(t=>{const s=t.value>0&&c<t.value,a=0===t.value&&n||t.value>0&&r===t.value.toString();return e.jsxs("button",{onClick:()=>{return!s&&void(0===(e=t.value)?(i(!0),l("")):(i(!1),l(e.toString())));var e},disabled:s,className:"py-3 rounded-xl text-[15px] font-medium transition-colors relative "+(s?"bg-gray-100 text-gray-400 border-2 border-transparent cursor-not-allowed":a?"bg-pink-50 text-pink-500 border-2 border-pink-500":"bg-gray-50 text-gray-700 border-2 border-transparent active:bg-gray-100"),children:[t.label,s&&e.jsx("span",{className:"absolute top-1 right-1 text-xs",children:"🔒"})]},t.label)})}),n&&e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"flex items-center border-2 border-pink-500 rounded-xl px-4 py-3 bg-white",children:[e.jsx("span",{className:"text-xl text-gray-900 mr-2",children:"¥"}),e.jsx("input",{type:"number",value:r,onChange:e=>l(e.target.value),placeholder:"请输入月额度",className:"flex-1 text-xl outline-none",autoFocus:!0}),e.jsx("span",{className:"text-sm text-gray-500",children:"/月"})]})})]}),e.jsx("button",{onClick:()=>{const e=parseFloat(r);isNaN(e)||e<=0?alert("请输入有效的月额度"):c<e?alert(`余额不足，无法开通亲密付\n\n当前余额：￥${c.toFixed(2)}\n设置额度：￥${e.toFixed(2)}\n\n你的余额不足以支持此额度，请先充值或降低月额度`):s(e)},disabled:!r,className:"w-full py-4 rounded-xl text-[16px] font-medium transition-all "+(r?"bg-gradient-to-r from-pink-400 to-red-400 text-white active:opacity-80":"bg-gray-100 text-gray-400"),children:"发送亲密付"})]})})},Pa=({show:s,onClose:a,onSelect:r})=>{const[l,n]=t.useState([]),[i,c]=t.useState("all"),o=t.useRef(null);t.useEffect(()=>{s&&d()},[s]);const d=async()=>{try{const e=await Promise.race([I(),new Promise((e,t)=>setTimeout(()=>t(new Error("表情包加载超时")),3e3))]);o.current=e,n(e)}catch(e){n([]),o.current=[]}},x=l.filter(e=>e.useCount>0).sort((e,t)=>t.useCount-e.useCount).slice(0,12),m="frequent"===i?x:l;return s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/20 z-40",onClick:a}),e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 glass-effect rounded-t-2xl z-50 max-h-[60vh] flex flex-col shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200/50",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>c("all"),className:"text-sm font-medium pb-1 border-b-2 transition-colors "+("all"===i?"text-[#576B95] border-[#576B95]":"text-gray-400 border-transparent"),children:"全部表情"}),e.jsx("button",{onClick:()=>c("frequent"),className:"text-sm font-medium pb-1 border-b-2 transition-colors "+("frequent"===i?"text-[#576B95] border-[#576B95]":"text-gray-400 border-transparent"),children:"常用表情"})]}),e.jsx("button",{onClick:a,className:"text-gray-400 text-2xl w-8 h-8 flex items-center justify-center",children:"×"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:0===m.length?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400 py-8",children:[e.jsxs("svg",{className:"w-12 h-12 mb-3",fill:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",opacity:"0.3"}),e.jsx("path",{d:"M8 14s1.5 2 4 2 4-2 4-2"}),e.jsx("circle",{cx:"9",cy:"9",r:"1"}),e.jsx("circle",{cx:"15",cy:"9",r:"1"})]}),e.jsx("div",{className:"text-sm",children:"frequent"===i?"还没有常用表情包":"还没有表情包"}),e.jsx("div",{className:"text-xs text-gray-300 mt-1",children:"frequent"===i?"多发几次表情包就会出现在这里":"在发现页面添加表情包"})]}):e.jsx("div",{className:"grid grid-cols-4 gap-3",children:m.map(t=>e.jsxs("div",{onClick:()=>(e=>{r(e),a(),E(e.id).catch(e=>{})})(t),className:"relative aspect-square rounded-xl overflow-hidden glass-card shadow-lg border border-gray-200/50 active:scale-95 cursor-pointer transition-transform",children:[e.jsx("img",{src:t.url,alt:t.description,className:"w-full h-full object-cover",loading:"lazy"}),"frequent"===i&&t.useCount>0&&e.jsx("div",{className:"absolute bottom-1 right-1 bg-black/70 text-white text-xs px-1.5 py-0.5 rounded",children:t.useCount})]},t.id))})})]})]}):null},Fa=({description:s})=>{const[a,r]=t.useState(!1);return e.jsx("div",{className:"relative w-[200px] h-[200px] cursor-pointer",style:{perspective:"1000px"},onClick:()=>r(!a),children:e.jsxs("div",{className:"relative w-full h-full transition-transform duration-700 "+(a?"[transform:rotateY(180deg)]":""),style:{transformStyle:"preserve-3d"},children:[e.jsx("div",{className:"absolute w-full h-full rounded-2xl overflow-hidden shadow-lg",style:{backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},children:e.jsx("img",{src:"/zhizhi/assets/photo-placeholder-B_NHJ1Xw.webp",alt:"照片",className:"w-full h-full object-cover"})}),e.jsx("div",{className:"absolute w-full h-full rounded-2xl shadow-lg bg-white p-4 overflow-y-auto flex items-center justify-center",style:{backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",transform:"rotateY(180deg)"},children:e.jsx("div",{className:"text-sm text-gray-900 whitespace-pre-wrap break-words text-center",children:s})})]})})},Oa=({content:t,className:s=""})=>{let a=t;t.startsWith("```")&&(a=t.replace(/^```[a-z]*\n?/i,"").replace(/\n?```$/,""));return a.includes("<!DOCTYPE")||a.includes("<html")||a.includes("<script")||a.includes("onclick=")||a.includes("addEventListener")?e.jsx("iframe",{srcDoc:a,className:`w-full border-0 rounded-lg ${s}`,style:{minHeight:"500px",height:"auto"},sandbox:"allow-scripts allow-same-origin allow-forms",title:"HTML Content",onLoad:e=>{var t;const s=e.currentTarget;try{const e=s.contentDocument||(null==(t=s.contentWindow)?void 0:t.document);if(e){const t=e.documentElement.scrollHeight;s.style.height=`${t}px`}}catch(a){}}}):e.jsx("div",{className:`whitespace-pre-wrap break-words ${s}`,dangerouslySetInnerHTML:{__html:a}})},Wa=({children:s})=>{const a=t.useRef(null),r=t.useRef(null),l=t.useRef(null),n=t.useRef(null);return t.useEffect(()=>{const e=a.current,t=r.current,s=l.current,i=n.current;if(!(e&&t&&s&&i))return;const c=e.getContext("2d",{alpha:!0}),o=t.getContext("2d",{alpha:!0});if(!c||!o)return;let d,x=0;const m=()=>{const a=s.getBoundingClientRect(),r=window.devicePixelRatio||1;e.width=a.width*r,e.height=a.height*r,e.style.width=`${a.width}px`,e.style.height=`${a.height}px`,c.scale(r,r),t.width=a.width*r,t.height=a.height*r,t.style.width=`${a.width}px`,t.style.height=`${a.height}px`,o.scale(r,r)};m();const h=()=>{const s=e.width/(window.devicePixelRatio||1),a=e.height/(window.devicePixelRatio||1);c.clearRect(0,0,s,a),o.clearRect(0,0,s,a);const r=((e,t,s)=>{const a=[],r=16,l=.05,n=2*(e+t)-128+2*Math.PI*r;for(let i=0;i<=200;i++){const c=i/200*n;let o=0,d=0,x=0,m=0;if(c<e-32)o=r+c,d=0,x=0,m=-1;else if(c<e-32+Math.PI*r/2){const t=(c-(e-32))/r;o=e-r+r*Math.sin(t),d=r-r*Math.cos(t),x=Math.sin(t),m=-Math.cos(t)}else if(c<e+t-64+Math.PI*r/2)o=e,d=r+(c-(e-32+Math.PI*r/2)),x=1,m=0;else if(c<e+t-64+Math.PI*r){const s=(c-(e+t-64+Math.PI*r/2))/r;o=e-r+r*Math.cos(s),d=t-r+r*Math.sin(s),x=Math.cos(s),m=Math.sin(s)}else if(c<2*e+t-96+Math.PI*r)o=e-r-(c-(e+t-64+Math.PI*r)),d=t,x=0,m=1;else if(c<2*e+t-96+Math.PI*r*1.5){const s=(c-(2*e+t-96+Math.PI*r))/r;o=r-r*Math.sin(s),d=t-r+r*Math.cos(s),x=-Math.sin(s),m=Math.cos(s)}else if(c<2*e+2*t-128+Math.PI*r*1.5)o=0,d=t-r-(c-(2*e+t-96+Math.PI*r*1.5)),x=-1,m=0;else{const s=(c-(2*e+2*t-128+Math.PI*r*1.5))/r;o=r-r*Math.cos(s),d=r-r*Math.sin(s),x=-Math.cos(s),m=-Math.sin(s)}const h=3*Math.sin(c*l+.05*s)+3*Math.sin(c*l*2.3+.07*s)*.5+3*Math.sin(c*l*4.7+.03*s)*.3;o+=x*h,d+=m*h,a.push({x:o,y:d})}return a})(s,a,x);if(o.save(),o.beginPath(),r.forEach((e,t)=>{0===t?o.moveTo(e.x,e.y):o.lineTo(e.x,e.y)}),o.closePath(),o.fillStyle="black",o.fill(),o.restore(),i){const e=t.toDataURL();i.style.webkitMaskImage=`url(${e})`,i.style.maskImage=`url(${e})`,i.style.webkitMaskSize="100% 100%",i.style.maskSize="100% 100%"}c.save(),c.beginPath(),r.forEach((e,t)=>{0===t?c.moveTo(e.x,e.y):c.lineTo(e.x,e.y)}),c.closePath(),c.strokeStyle="rgba(255, 255, 255, 0.8)",c.lineWidth=3,c.shadowBlur=15,c.shadowColor="rgba(255, 255, 255, 0.5)",c.stroke(),c.strokeStyle="rgba(255, 255, 255, 0.3)",c.lineWidth=8,c.shadowBlur=0,c.stroke(),c.strokeStyle="rgba(255, 255, 255, 0.1)",c.lineWidth=12,c.shadowBlur=20,c.shadowColor="rgba(255, 255, 255, 0.3)",c.stroke(),c.restore(),x+=1,d=requestAnimationFrame(h)};h();const u=()=>{m()};return window.addEventListener("resize",u),()=>{cancelAnimationFrame(d),window.removeEventListener("resize",u)}},[]),e.jsxs("div",{ref:l,className:"relative",children:[e.jsx("canvas",{ref:a,className:"absolute inset-0 pointer-events-none",style:{zIndex:2}}),e.jsx("canvas",{ref:r,className:"absolute inset-0 pointer-events-none",style:{display:"none"}}),e.jsx("div",{ref:n,className:"relative",style:{zIndex:1},children:s})]})},Ra=({isOpen:s,onClose:a,characterName:r,characterId:l})=>{const[n,i]=t.useState(!1),[c,o]=t.useState({affection:75,outfit:"白色棉质T恤，浅蓝色牛仔裤，白色运动鞋",action:"坐在沙发上，双腿自然交叠，手里拿着手机在回复消息",mood:"( ´ ▽ ` ) 轻松愉快",thought:"今天过得很充实呢",location:"家里的客厅",weather:"晴 25°C"});return t.useEffect(()=>{if(s&&l){i(!0);const e=()=>{const e=localStorage.getItem(`character_status_${l}`);if(e)try{const t=JSON.parse(e);o(t)}catch(t){}};e();const t=setInterval(e,1e3);return()=>clearInterval(t)}},[s,l]),t.useEffect(()=>{if(l&&c){const e={...c,characterId:l,timestamp:Date.now()};localStorage.setItem(`character_status_${l}`,JSON.stringify(e))}},[c,l]),s||n?e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:a,className:"fixed inset-0 bg-black z-50 transition-opacity duration-300 "+(s?"bg-opacity-60":"bg-opacity-0 pointer-events-none")}),e.jsx("div",{className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-50 transition-all duration-300 "+(s?"opacity-100 scale-100":"opacity-0 scale-95 pointer-events-none"),children:e.jsx(Wa,{children:e.jsxs("div",{className:"w-96 bg-white/95 backdrop-blur-xl p-6 rounded-2xl max-h-[85vh] overflow-y-auto",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-1",children:"状态栏"}),e.jsx("p",{className:"text-gray-600 text-sm",children:r})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-light text-gray-900 mb-1",children:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})}),e.jsx("div",{className:"text-sm text-gray-500",children:(new Date).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric",weekday:"long"})})]})}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-xl",children:"☀️"}),e.jsx("span",{className:"text-sm text-gray-600",children:"天气"}),e.jsx("span",{className:"text-sm text-gray-900 font-medium",children:c.weather})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-xl",children:"📍"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"坐标"}),e.jsx("div",{className:"text-sm text-gray-900 mt-1",children:c.location})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:"💕"}),e.jsx("span",{className:"text-sm text-gray-600",children:"好感度"})]}),e.jsxs("span",{className:"text-sm text-gray-900 font-bold",children:[c.affection,"/100"]})]}),e.jsx("div",{className:"w-full bg-gray-100 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-pink-400 to-pink-600 h-2 rounded-full transition-all duration-500",style:{width:`${c.affection}%`}})})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100 space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-xl",children:"👔"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"着装"}),e.jsx("div",{className:"text-sm text-gray-900 leading-relaxed",children:c.outfit})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-xl",children:"🎬"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"动作"}),e.jsx("div",{className:"text-sm text-gray-900 leading-relaxed",children:c.action})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-xl",children:"💭"}),e.jsx("span",{className:"text-sm text-gray-600",children:"心声"})]}),e.jsx("div",{className:"text-sm text-gray-900 leading-relaxed italic",children:c.thought})]})]}),e.jsx("button",{onClick:a,className:"mt-4 w-full py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-all duration-200 text-sm font-medium",children:"▼ 收起"})]})})})]}):null},Ua=(e,s,a)=>{const r=t.useRef(O.getSystem(e)),l=t.useCallback(async(e,t)=>await r.current.extractMemoriesFromConversation(e,t,s,a),[s,a]),n=t.useCallback(async e=>await r.current.extractInitialMemories(e),[]),i=t.useCallback((e,t=5)=>r.current.getRelevantMemories(e,t),[]),c=t.useCallback(()=>r.current.generateMemorySummary(),[]),o=t.useCallback((e,t,s=5)=>r.current.addMemory(e,t,s),[]),d=t.useCallback(e=>r.current.searchMemories({keyword:e}),[]),x=t.useCallback(()=>r.current.getStatistics(),[]);return t.useMemo(()=>({extractMemories:l,extractInitialMemories:n,getRelevantMemories:i,getMemorySummary:c,addMemory:o,searchMemories:d,getStatistics:x}),[l,n,i,c,o,d,x])},Va=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{var l,i,x,b,j;const v=s(),y=a(),{id:w}=r(),{currentUser:C,updateUser:S}=d(),I=Ua(w||""),[_,M]=t.useState(""),[z,$]=t.useState(()=>{if(w){const e=localStorage.getItem(`chat_messages_${w}`),t=e?JSON.parse(e):[],s=2;let a=parseInt(localStorage.getItem(`chat_data_version_${w}`)||"0")<s;const r=t.map((e,t)=>{var s;let r={...e};if(!e.timestamp){a=!0;const[t,s]=e.time.split(":").map(Number),l=new Date;l.setHours(t||0,s||0,0,0),l.getTime()>Date.now()&&l.setDate(l.getDate()-1),r.timestamp=l.getTime()}return"transfer"===e.messageType&&(null==(s=e.transfer)?void 0:s.message)&&("转账"!==e.transfer.message&&"你发起了一笔转账"!==e.transfer.message||(a=!0,r={...r,transfer:{...r.transfer,message:""}})),r});return a&&setTimeout(()=>{localStorage.setItem(`chat_messages_${w}`,JSON.stringify(r)),localStorage.setItem(`chat_data_version_${w}`,String(s))},0),r}return[]}),[L,A]=t.useState(!1),D=t.useRef(),[B,E]=t.useState(!1),[F,O]=t.useState(!1),[ue,ge]=t.useState(null),pe=t.useRef(!0),fe=t.useRef(0),be=t.useRef(!0),[je,ve]=t.useState({total:0,remaining:0,percentage:0,systemPrompt:0,lorebook:0,messages:0}),[ye,Ne]=t.useState(!1),[we,ke]=t.useState(0),[Ce,Se]=t.useState([]),{background:Ie,getBackgroundStyle:_e}=c(),[Me,ze]=t.useState(()=>localStorage.getItem(`chat_background_${w}`)||"");t.useEffect(()=>{if(w)return N.observe(`chat_background_${w}`,e=>{ze(e||"")})},[w]);const[$e,Le]=t.useState(()=>"true"===localStorage.getItem("apply_background_to_all_pages"));t.useEffect(()=>N.observe("apply_background_to_all_pages",e=>{Le("true"===e)}),[]);const Ae=Me||($e?Ie:""),[Te,De]=t.useState(()=>"true"===localStorage.getItem(`narrator_enabled_${w}`)),Be=!0,[Ee,Pe]=t.useState(()=>localStorage.getItem(`user_bubble_color_${w}`)||localStorage.getItem("user_bubble_color")||"#FFD4E5"),[Fe,Oe]=t.useState(()=>localStorage.getItem(`ai_bubble_color_${w}`)||localStorage.getItem("ai_bubble_color")||"#FFFFFF"),[We,Re]=t.useState(()=>localStorage.getItem(`user_bubble_css_${w}`)||localStorage.getItem("user_bubble_css")||""),[Ue,Ve]=t.useState(()=>localStorage.getItem(`ai_bubble_css_${w}`)||localStorage.getItem("ai_bubble_css")||""),[Je,He]=t.useState(()=>localStorage.getItem(`red_envelope_cover_${w}`)||""),[Ge,qe]=t.useState(()=>localStorage.getItem(`red_envelope_icon_${w}`)||""),[Ke,Xe]=t.useState(()=>localStorage.getItem(`transfer_cover_${w}`)||""),[Ze,Qe]=t.useState(()=>localStorage.getItem(`transfer_icon_${w}`)||"");t.useEffect(()=>{if(!w)return;const e=[N.observe(`user_bubble_color_${w}`,e=>{Pe(e||localStorage.getItem("user_bubble_color")||"#FFD4E5")}),N.observe("user_bubble_color",e=>{localStorage.getItem(`user_bubble_color_${w}`)||Pe(e||"#FFD4E5")}),N.observe(`ai_bubble_color_${w}`,e=>{Oe(e||localStorage.getItem("ai_bubble_color")||"#FFFFFF")}),N.observe("ai_bubble_color",e=>{localStorage.getItem(`ai_bubble_color_${w}`)||Oe(e||"#FFFFFF")}),N.observe(`user_bubble_css_${w}`,e=>{Re(e||localStorage.getItem("user_bubble_css")||"")}),N.observe("user_bubble_css",e=>{localStorage.getItem(`user_bubble_css_${w}`)||Re(e||"")}),N.observe(`ai_bubble_css_${w}`,e=>{Ve(e||localStorage.getItem("ai_bubble_css")||"")}),N.observe("ai_bubble_css",e=>{localStorage.getItem(`ai_bubble_css_${w}`)||Ve(e||"")}),N.observe(`red_envelope_cover_${w}`,e=>{He(e||"")}),N.observe(`red_envelope_icon_${w}`,e=>{qe(e||"")}),N.observe(`transfer_cover_${w}`,e=>{Xe(e||"")}),N.observe(`transfer_icon_${w}`,e=>{Qe(e||"")}),N.observe("chat_font_family",e=>{const t=localStorage.getItem("chat_font_family_value");e&&"system"!==e&&t?document.documentElement.style.setProperty("--chat-font-family",t):document.documentElement.style.removeProperty("--chat-font-family")}),N.observe("chat_font_family_value",e=>{const t=localStorage.getItem("chat_font_family");t&&"system"!==t&&e?document.documentElement.style.setProperty("--chat-font-family",e):document.documentElement.style.removeProperty("--chat-font-family")})];return()=>{e.forEach(e=>e())}},[w]),t.useEffect(()=>{const e=`custom-bubble-style-${w}`;let t=document.getElementById(e);t||(t=document.createElement("style"),t.id=e,document.head.appendChild(t));const s=`${We}\n${Ue}`;return t.textContent=s,()=>{const t=document.getElementById(e);t&&t.remove()}},[w,We,Ue]);const{showStatusBar:Ye}=o(),{getCharacter:et,updateCharacter:tt}=n(),{getRedEnvelope:st,saveRedEnvelope:at,updateRedEnvelope:rt}=u(),{moments:lt}=h(),{addTransaction:nt}=g(),it=t.useRef(null),ct=t.useRef(!1),ot=t.useRef(!1),dt=t.useRef(!1),xt=t.useRef(!0),mt=e=>{const t=new Date(e),s=new Date,a=new Date(s.getFullYear(),s.getMonth(),s.getDate()),r=new Date(a.getTime()-864e5),l=new Date(t.getFullYear(),t.getMonth(),t.getDate()),n=t.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"});return l.getTime()===a.getTime()?n:l.getTime()===r.getTime()?`昨天 ${n}`:t.toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},[ht,ut]=t.useState(!1),[gt,pt]=t.useState(!1),[ft,bt]=t.useState(null),[jt,vt]=t.useState(!1),[yt,Nt]=t.useState(!1),[wt,kt]=t.useState(!1),[Ct,St]=t.useState(!1),[It,_t]=t.useState(!1),[Mt,zt]=t.useState(null),[$t,Lt]=t.useState(!1),[At,Tt]=t.useState(""),[Dt,Bt]=t.useState([]),[Et,Pt]=t.useState(""),[Ft,Ot]=t.useState(""),[Wt,Rt]=t.useState(""),[Ut,Vt]=t.useState(""),[Jt,Ht]=t.useState(!1),[Gt,qt]=t.useState(30),[Kt,Xt]=t.useState(!1),[Zt,Yt]=t.useState(!1),es=t.useRef(null),ts=t.useRef(0),ss=t.useRef(!0),as=t.useRef(0);t.useEffect(()=>{const e=()=>{Ls(!0)};return window.addEventListener("openXiaohongshuInput",e),()=>{window.removeEventListener("openXiaohongshuInput",e)}},[]);const[rs,cs]=t.useState(!1),[ds,xs]=t.useState(""),[ms,hs]=t.useState(!1),[us,gs]=t.useState(""),[ps,fs]=t.useState({}),[bs,js]=t.useState(null),[vs,ys]=t.useState(!1),[Ns,ks]=t.useState(""),[Cs,Ss]=t.useState(""),[Is,_s]=t.useState(null),[Ms,zs]=t.useState(!1),[$s,Ls]=t.useState(!1),{startCall:As}=p(),[Ts,Ds]=t.useState(!1),[Bs,Es]=t.useState(!1),[Ps,Fs]=t.useState(null),[Os,Ws]=t.useState(!1),[Rs,Us]=t.useState({x:0,y:0}),Vs=t.useRef(null),[Js,Hs]=t.useState(null),[Gs,qs]=t.useState(null),[Ks,Xs]=t.useState(!1),[Zs,Qs]=t.useState(""),[Ys,ea]=t.useState(null),[ta,sa]=t.useState(!1),[aa,ra]=t.useState(new Set),[la,na]=t.useState(null),[ia,ca]=t.useState(!1),[oa,da]=t.useState(null),[ma,ha]=t.useState(""),[ua,ga]=t.useState(()=>{const e=localStorage.getItem("ai_message_limit");return e?parseInt(e):15}),pa=w?et(w):void 0,fa=null==pa?void 0:pa.avatar,ba=null==fa?void 0:fa.startsWith("data:image");(e=>{const{getCharacter:s}=n(),{moments:a,addMoment:r,likeMoment:l,addComment:i}=h(),c=t.useRef(0),o=t.useRef(0),d=t.useRef(!1),x=s(e),m=()=>"true"===localStorage.getItem(`ai_moments_enabled_${e}`),u=async()=>{if(x&&m()&&!d.current){d.current=!0;try{const e=await P(x.id,x.name,x.avatar,x.description||"");if(e){r({userId:x.id,userName:x.name,userAvatar:x.avatar,content:e,images:[]}),c.current=Date.now();const t=localStorage.getItem(`chat_messages_${x.id}`),s=t?JSON.parse(t):[],a={id:Date.now()+Math.random(),type:"system",content:`📸 ${x.name} 发布了朋友圈：${e.substring(0,50)}${e.length>50?"...":""}`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"system",isHidden:!1};s.push(a),localStorage.setItem(`chat_messages_${x.id}`,JSON.stringify(s))}}catch(e){}finally{d.current=!1}}};t.useEffect(()=>{if(!m())return;const t=localStorage.getItem(`chat_messages_${e}`);if(t){const e=JSON.parse(t),s=e[e.length-1];if(s&&Date.now()-(s.timestamp||0)<3e5){const e=60*(1+2*Math.random())*1e3,t=setTimeout(()=>{u()},e);return()=>clearTimeout(t)}}},[e,null==x?void 0:x.name,a])})(w||"");const Na=t.useCallback(()=>{const e=es.current;e&&!Kt&&e.scrollTop<100&&Gt<z.length&&(Xt(!0),ts.current=e.scrollHeight,setTimeout(()=>{qt(e=>Math.min(e+30,z.length)),Xt(!1)},100))},[Kt,Gt,z.length]);t.useEffect(()=>{const e=es.current;if(e)return e.addEventListener("scroll",Na),()=>e.removeEventListener("scroll",Na)},[Na]),t.useEffect(()=>{const e=es.current;if(e)if(ts.current>0){const t=e.scrollHeight-ts.current;t>0&&(e.scrollTop=t),ts.current=0}else setTimeout(()=>{e.scrollTop=e.scrollHeight},100)},[Gt]),t.useEffect(()=>{qt(30),ss.current=!0,as.current=0,w&&W(w),setTimeout(()=>{const e=es.current;e&&(e.scrollTop=e.scrollHeight)},200)},[w]),t.useEffect(()=>{const e=()=>{pe.current=!document.hidden,pe.current&&w&&W(w)};return pe.current=!document.hidden,be.current=!0,document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e),be.current=!1}},[w]),t.useEffect(()=>{if(!(null==pa?void 0:pa.id)||!(null==pa?void 0:pa.avatar)||!pa.avatar.startsWith("data:image"))return;const e=pa.avatar.substring(0,200),t=localStorage.getItem(`character_avatar_fingerprint_${pa.id}`),s=localStorage.getItem(`character_avatar_description_${pa.id}`);if(s&&t===e)return;"localhost"!==window.location.hostname&&"127.0.0.1"!==window.location.hostname&&(async()=>{try{const e=await fetch("/.netlify/functions/vision",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:pa.avatar,prompt:"详细描述这个头像的内容，包括：角色特征、风格、颜色、表情、氛围等。请用简洁的语言描述。"})});if(e.ok){const t=await e.json(),s=t.description||t.result;localStorage.setItem(`character_avatar_description_${pa.id}`,s),localStorage.setItem(`character_avatar_recognized_at_${pa.id}`,Date.now().toString()),localStorage.setItem(`character_avatar_fingerprint_${pa.id}`,pa.avatar.substring(0,200))}}catch(e){}})()},[null==pa?void 0:pa.id,null==pa?void 0:pa.avatar]),t.useEffect(()=>{const e=es.current;if(!e)return;const t=as.current,s=z.length;if(s>t&&s>Gt&&qt(s),as.current=s,ss.current&&z.length>0)return ss.current=!1,void requestAnimationFrame(()=>{setTimeout(()=>{e&&(e.scrollTop=e.scrollHeight)},300)});e.scrollHeight-e.scrollTop-e.clientHeight<200&&requestAnimationFrame(()=>{e.scrollTop=e.scrollHeight})},[z.length,Gt]);const wa=(null==C?void 0:C.avatar)||"default",ka=wa.startsWith("data:image"),Ca=t.useCallback(e=>{D.current&&clearTimeout(D.current),D.current=setTimeout(()=>{if(w&&e.length>0){R(`chat_messages_${w}`,e);const t=e[e.length-1];if(t){const e=localStorage.getItem("chatList");if(e){const s=JSON.parse(e),a=s.findIndex(e=>e.id===w);if(-1!==a){let e="";e=t.isRecalled?t.content||"撤回了一条消息":"transfer"===t.messageType?"[转账]":"redenvelope"===t.messageType?"[红包]":"emoji"===t.messageType?"[表情]":"photo"===t.messageType?"[图片]":"voice"===t.messageType?"[语音]":"location"===t.messageType?"[位置]":"intimate_pay"===t.messageType?"[亲密付]":"couple_space_invite"===t.messageType?"[情侣空间]":t.content||"",s[a]={...s[a],lastMessage:e,time:t.time},localStorage.setItem("chatList",JSON.stringify(s))}}}}},300)},[w]);t.useEffect(()=>{w&&z.length>0&&Ca(z)},[z,w,Ca]),t.useEffect(()=>()=>{D.current&&clearTimeout(D.current),w&&z.length>0&&R(`chat_messages_${w}`,z)},[w,z]),t.useEffect(()=>{if(!w)return;const e=[N.observe(`narrator_enabled_${w}`,e=>{De("true"===e)})];return()=>{e.forEach(e=>e())}},[w]),t.useEffect(()=>{if(!w||!pa)return;if(!("true"===localStorage.getItem(`ai_proactive_enabled_${w}`)))return;const e=z.filter(e=>"sent"===e.type).slice(-1)[0],t=z.filter(e=>"received"===e.type).slice(-1)[0];if(!e||!e.timestamp)return;if(t&&t.timestamp&&t.timestamp>e.timestamp)return;const s=Date.now()-e.timestamp;Math.floor(s/6e4);if(parseInt(localStorage.getItem(`last_proactive_time_${w}`)||"0")>e.timestamp)return;if(s>3e5&&s<72e5){const t=1e3*(10+20*Math.random()),a=setTimeout(async()=>{const t=`你是${pa.name}。\n\n${pa.description||""}\n\n现在的情况：\n• 用户已经${Math.floor(s/6e4)}分钟没回复你了\n• 你们最后的聊天内容是："${e.content}"\n\n请判断：你是否想主动给用户发个消息？\n\n考虑因素：\n1. 你的性格（主动/被动/黏人/高冷）\n2. 你们的关系（亲密度）\n3. 最后聊天的内容（是否需要追问）\n4. 当前时间（${(new Date).toLocaleTimeString("zh-CN")}）\n\n如果你想发消息，直接输出消息内容。\n如果不想发，输出"SKIP"。\n\n你可以：\n• 表达情绪："你怎么不理我了"、"为什么不回我"（如果你性格黏人）\n• 分享事情："刚才想起一件事"、"今天遇到xxx"\n• 关心对方："在干嘛呢"、"吃饭了吗"\n• 追问话题："刚才那个问题..."\n• 撒娇抱怨："等你好久了"、"人家想你了"\n\n注意：\n• 根据你的性格决定语气（黏人/高冷/温柔/活泼）\n• 像真人一样自然表达情感\n• 不要太频繁，但可以表达真实感受`;try{const e=await U([{role:"user",content:t}]);if("SKIP"!==e.trim()&&e.trim().length>0){const t=V.getBlockStatus("user",w).blockedByMe,s={id:Date.now(),type:"received",content:e.trim(),time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),blocked:t};$(e=>{const t=[...e,s];R(`chat_messages_${w}`,t);const a=localStorage.getItem("chatList");if(a){const e=JSON.parse(a),t=e.findIndex(e=>e.id===w);-1!==t&&(e[t]={...e[t],lastMessage:s.content||"",time:s.time},localStorage.setItem("chatList",JSON.stringify(e)))}return t}),localStorage.setItem(`last_proactive_time_${w}`,String(Date.now()))}}catch(a){}},t);return()=>clearTimeout(a)}},[z,w,pa,C]),t.useEffect(()=>{var e,t;xt.current?null==(e=it.current)||e.scrollIntoView({behavior:"smooth"}):(null==(t=it.current)||t.scrollIntoView({behavior:"auto"}),xt.current=!0)},[z,L]),t.useEffect(()=>{(async()=>{if(w){const{hasActiveCoupleSpace:e}=await Qt(async()=>{const{hasActiveCoupleSpace:e}=await import("./utils-Bw01K5Nk.js").then(e=>e.bN);return{hasActiveCoupleSpace:e}},__vite__mapDeps([0,1,2])),t=e(w);Lt(t)}})()},[w,z]),t.useEffect(()=>{var e;const t=null==(e=y.state)?void 0:e.transfer;if(t&&!ct.current){ct.current=!0;const{amount:e,message:s}=t,a={id:Date.now(),type:"sent",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),messageType:"transfer",transfer:{amount:e,message:s,status:"pending"}};xt.current=!1,$(e=>[...e,a]),window.history.replaceState({},document.title),ot.current=!0;const r=Date.now(),l={id:r,type:"sent",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:r,messageType:"intimate_pay",intimatePay:{monthlyLimit:monthlyLimit,characterId:pa.id,characterName:pa.name,status:"pending"}};$(e=>[...e,l]),window.history.replaceState({},document.title),setTimeout(()=>{ot.current=!1},1e3)}},[null==(l=y.state)?void 0:l.sendIntimatePay,null==(i=y.state)?void 0:i.monthlyLimit,w,pa]),t.useEffect(()=>{var e;if((null==(e=y.state)?void 0:e.sendCoupleSpaceInvite)&&!dt.current&&w&&pa&&C){dt.current=!0;const e=Date.now(),t={id:e,type:"sent",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:e,messageType:"couple_space_invite",coupleSpaceInvite:{characterId:pa.id,characterName:pa.name,characterAvatar:pa.avatar,status:"pending"}};xt.current=!1,$(e=>[...e,t]),window.history.replaceState({},document.title),setTimeout(()=>{dt.current=!1},1e3)}},[null==(x=y.state)?void 0:x.sendCoupleSpaceInvite,w,pa,C]);const Wa=async()=>{var e;if(_.trim()&&!L){const t=Date.now(),s=(w?V.getBlockStatus("user",w):{blockedByTarget:!1}).blockedByTarget,a={id:z.length+1,type:"sent",content:_,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:t,blocked:s,quotedMessage:Js?{id:Js.id,content:Js.isRecalled&&Js.recalledContent?Js.recalledContent:Js.content||Js.emojiDescription||Js.photoDescription||Js.voiceText||"特殊消息",senderName:"sent"===Js.type?"我":"received"===Js.type?(null==pa?void 0:pa.name)||"AI":(null==(e=Js.content)?void 0:e.includes("你撤回了"))?"我":(null==pa?void 0:pa.name)||"AI",type:"system"===Js.type?"sent":Js.type}:void 0},r=[...z,a];$(r),M(""),Hs(null),w&&G(w)}},Va=t.useMemo(()=>_.trim().length>0,[_]),Ja=async(e,t,s)=>{if(!pa)return;const a=pa.favorability||50,r=(new Date).getHours(),l=r>=23||r<6;let n=.3;a>=80?n+=.5:a>=60?n+=.3:a>=40&&(n+=.1),l&&(n-=.2);const i=["爱","情","心","想你","喜欢","告白","陪你"].some(e=>t.includes(e)),c=["嗨","燃","跳","舞","派对","DJ"].some(e=>t.includes(e));["伤","痛","哭","离别","孤独","想念"].some(e=>t.includes(e)),i&&a>=60&&(n+=.15),c&&l&&(n-=.25),n=Math.max(.1,Math.min(.95,n));const o=Math.random()<n,d=new Date,x=`${d.toLocaleDateString("zh-CN")} ${d.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})}`,m=z.slice(-10).map(e=>`${"sent"===e.type?(null==C?void 0:C.name)||"用户":pa.name}: ${e.content}`).join("\n"),h=`你是 ${pa.name}。\n${pa.description||""}\n\n现在是${x}，${(null==C?void 0:C.name)||"用户"}邀请你一起听歌：《${t}》- ${s}\n\n你们最近的聊天：\n${m||"刚开始聊天"}\n\n你对${(null==C?void 0:C.name)||"用户"}的好感度：${a}/100\n\n${o?`你决定【接受】邀请。请用自然、符合你性格的方式表达接受，可以：\n- 表达对这首歌的看法或喜欢\n- 说明为什么想和对方一起听\n- 表达期待或开心的心情\n- 可以俏皮、可以温柔、可以兴奋\n\n示例风格：\n"好呀！我也很喜欢这首歌～一起听吧 🎵"\n"《${t}》！这首我超爱的！马上来～"\n"嗯嗯，想和你一起听这首～"`:'你决定【拒绝】邀请。请用委婉、自然的方式拒绝，要：\n- 给出合理的理由（如：现在有事、累了想休息、不太喜欢这类歌等）\n- 保持友好，不伤感情\n- 可以建议改天或推荐其他歌曲\n\n示例风格：\n"啊...现在有点累了，想休息一下，下次吧～"\n"这首歌好像不太是我的风格呢...要不换一首？"\n"现在在忙呢，等会儿再一起听好不好～"'}\n\n重要：\n1. 只回复一句话，简短自然\n2. 不要使用[]、【】等标记\n3. 符合你的性格和关系亲密度\n4. 不要解释你的决定原因\n\n直接回复：`;try{const a=(await U(h)).replace(/\[.*?\]/g,"").trim(),r=Date.now(),l={id:r,type:"received",content:a,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:r};$(e=>[...e,l]),setTimeout(()=>{$(t=>t.map(t=>t.id===e&&"musicInvite"===t.messageType?{...t,musicInvite:{...t.musicInvite,status:o?"accepted":"rejected"}}:t)),o&&setTimeout(()=>{v("/music-together-chat",{state:{song:{title:t,artist:s},characterId:w,characterName:pa.name,characterAvatar:pa.avatar}})},800)},500)}catch(u){setTimeout(()=>{$(t=>t.map(t=>t.id===e&&"musicInvite"===t.messageType?{...t,musicInvite:{...t.musicInvite,status:o?"accepted":"rejected"}}:t))},500)}},Ha=e=>{const t=Date.now(),s={id:t,type:"sent",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:t,messageType:"xiaohongshu",xiaohongshuNote:e};$(e=>[...e,s]),zs(!1)},Ga=(e,t)=>{const s="touches"in t?t.touches[0].clientX:t.clientX,a="touches"in t?t.touches[0].clientY:t.clientY;Vs.current=setTimeout(()=>{Fs(e),Us({x:s,y:a}),Ws(!0),navigator.vibrate&&navigator.vibrate(50)},500)},qa=()=>{Vs.current&&(clearTimeout(Vs.current),Vs.current=null)},Ka=t.useCallback(e=>{$(e),w&&R(`chat_messages_${w}`,e)},[w]),Xa=async e=>{var t,s,a,r,l,n,i,c,o,d;A(!0);try{const d=w?k(w):null,m=(null==d?void 0:d.currentStreak)||0,{hasActiveCoupleSpace:h,isUserCoupleSpacePublic:u}=await Qt(async()=>{const{hasActiveCoupleSpace:e,isUserCoupleSpacePublic:t}=await import("./utils-Bw01K5Nk.js").then(e=>e.bN);return{hasActiveCoupleSpace:e,isUserCoupleSpacePublic:t}},__vite__mapDeps([0,1,2])),g=!!w&&h(w),p=u(),b=e.filter(e=>"sent"===e.type).slice(-1)[0],j=(null==b||b.content,e.slice(-10).map(e=>e.content).join(" "));let v=await Y(j,5);if(v.length<3){const e=ee(2),t=new Set(v.map(e=>e.id));e.forEach(e=>{t.has(e.id)||v.push(e)})}const y=v.map(e=>({"梗":e["梗"],"含义":e["含义"]}));v.length;const N=e.slice(-ua),_=w?localStorage.getItem(`prompt_template_id_${w}`):null;w&&localStorage.getItem(`prompt_custom_template_${w}`);let M;if("default"!==(_||"roleplayEnhanced")){N.map(e=>{var t,s,a;const r="sent"===e.type?(null==C?void 0:C.name)||"用户":(null==pa?void 0:pa.name)||"AI";let l=e.content;return"transfer"===e.messageType?l=`[转账] ¥${null==(t=e.transfer)?void 0:t.amount} - ${(null==(s=e.transfer)?void 0:s.message)||""}`:"redenvelope"===e.messageType?l="[红包]":"emoji"===e.messageType?l=`[表情包: ${e.emojiDescription}]`:"photo"===e.messageType?l=`[照片: ${e.photoDescription}]`:"voice"===e.messageType?l=`[语音: ${e.voiceText}]`:"location"===e.messageType?l=`[位置: ${null==(a=e.location)?void 0:a.name}]`:"xiaohongshu"===e.messageType&&e.xiaohongshuNote&&(l=`[小红书: ${e.xiaohongshuNote.title}]`),`${r}: ${l}`}).join("\n");const e=w?te(w):"",t=(null==C?void 0:C.id)?localStorage.getItem(`user_avatar_description_${C.id}`):null,s=(null==pa?void 0:pa.id)?localStorage.getItem(`character_avatar_description_${pa.id}`):null;M=se({name:(null==pa?void 0:pa.name)||"AI",nickname:null==pa?void 0:pa.nickname,signature:null==pa?void 0:pa.signature,description:null==pa?void 0:pa.description,tags:null==pa?void 0:pa.tags},{name:(null==C?void 0:C.name)||"用户",nickname:null==C?void 0:C.nickname,signature:null==C?void 0:C.signature},Te,m,y,g,e,Be,t||void 0,s||void 0)}else{const e=w?te(w):"",t=(null==C?void 0:C.id)?localStorage.getItem(`user_avatar_description_${C.id}`):null,s=(null==pa?void 0:pa.id)?localStorage.getItem(`character_avatar_description_${pa.id}`):null;M=se({name:(null==pa?void 0:pa.name)||"AI",nickname:null==pa?void 0:pa.nickname,signature:null==pa?void 0:pa.signature,description:null==pa?void 0:pa.description,tags:null==pa?void 0:pa.tags},{name:(null==C?void 0:C.name)||"用户",nickname:null==C?void 0:C.nickname,signature:null==C?void 0:C.signature},Te,m,y,g,e,Be,t||void 0,s||void 0)}N.forEach((e,t)=>{if("transfer"===e.messageType);else if("photo"===e.messageType);else if("voice"===e.messageType);else if("location"===e.messageType);else if("xiaohongshu"===e.messageType);else if("emoji"===e.messageType);else if("redenvelope"===e.messageType);else{e.content&&("string"==typeof e.content&&e.content.substring(0,30))}});let z="",L=[];try{const{getEmojis:e}=await Qt(async()=>{const{getEmojis:e}=await import("./utils-Bw01K5Nk.js").then(e=>e.bH);return{getEmojis:e}},__vite__mapDeps([0,1,2]));L=await Promise.race([e(),new Promise((e,t)=>setTimeout(()=>t(new Error("获取表情包超时")),2e3))]);const{generateEmojiInstructions:t}=await Qt(async()=>{const{generateEmojiInstructions:e}=await import("./utils-Bw01K5Nk.js").then(e=>e.bM);return{generateEmojiInstructions:e}},__vite__mapDeps([0,1,2]));z=t(L)}catch(x){z="",L=[]}const T=pa&&C?ae(pa.id,pa.name,C.name,lt):"";let D="";if(null==pa?void 0:pa.id){const e=re(pa.id);e.length>0&&(D="\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n💝 亲密付消费通知\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n",D+="用户使用了你为TA开通的亲密付，消费记录如下：\n\n",e.forEach((e,t)=>{const s=new Date(e.timestamp).toLocaleString("zh-CN");D+=`${t+1}. ${s}\n   消费金额：¥${e.amount.toFixed(2)}\n   消费说明：${e.description}\n\n`}),D+="你可以在回复中提及这些消费，表达关心或询问详情。\n",le(pa.id))}const B=I.getMemorySummary(),E=w?localStorage.getItem(`memory_summary_${w}`):null;let P="";(B||E)&&(P="\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n💭 记忆系统\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n",E&&(P+=`【关于用户的总结】\n${E}\n\n`),B&&(P+=`【详细记忆】\n${B}\n\n`),P+="这些是你记住的关于用户的信息，请在回复时自然地运用这些记忆。\n");let F="",O=!1;if(w){O=V.getBlockStatus("user",w).blockedByMe,O&&(F=ne((null==C?void 0:C.name)||"用户"))}let W="";const J=e.filter(e=>"received"===e.type).slice(-1)[0],H=e.filter(e=>"sent"===e.type).slice(-1)[0];if(J&&H&&J.timestamp&&H.timestamp){const e=H.timestamp-J.timestamp,t=Math.floor(e/1e3/60),s=Math.floor(t/60),a=Math.floor(s/24);W=t<1?"\n⏰ 用户秒回了你（可以表现开心/惊喜）\n":t<5?`\n⏰ 用户过了${t}分钟回复\n`:t<60?`\n⏰ 用户过了${t}分钟回复（可以自然表现等待感）\n`:s<24?`\n⏰ 用户过了${s}小时回复（可以表现担心/想念）\n`:`\n⏰ 用户过了${a}天回复（可以表现想念/好奇发生了什么）\n`}let G="";p&&!g&&(G="\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n⚠️ 重要提示：用户情侣空间状态\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n用户已经和其他人建立了情侣空间（公开状态）。\n\n这意味着：\n- 你不能向用户发送情侣空间邀请\n- 如果用户向你发送情侣空间邀请，你可以接受或拒绝\n- 你知道用户已经有情侣空间了，可以在对话中自然提及\n\n");let q="";const X=N.filter(e=>{var t;return e.isHidden&&(null==(t=e.content)?void 0:t.includes("群聊"))});if(X.length>0){const e=new Set;X.forEach(t=>{var s;const a=null==(s=t.content)?void 0:s.match(/群聊\[([^\]|]+)/);a&&e.add(a[1])}),e.size>0&&(q=`\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n💬 群聊上下文提示\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n你现在在 ${e.size} 个群聊中：${Array.from(e).map(e=>`"${e}"`).join("、")}\n\n聊天记录中标注了"💬 群聊[群名]"的消息来自群聊，不是私聊。\n- 不同群的消息是分开的，注意区分\n- 你可以在私聊中提到群聊里发生的事\n- 群聊和私聊是两个不同的场景\n\n`)}const Z=N.map(e=>e.content||"").join("\n"),Q=ie.buildContextWithStats(pa.id,Z,2e3),de=Q.context?`\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n📚 世界书设定\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n${Q.context}\n\n`:"";Se(Q.triggeredEntries);let xe=M+F+W+T+D+P+G+q+de+`\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n📱 回复方式\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n• 可以连续发多条消息（用换行分隔，每条消息单独一行）\n• 根据心情决定回复长度\n• 像真人一样自然聊天\n\n💡 多条消息示例：\n第一条消息\n第二条消息\n第三条消息\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n${Te?"🎭 旁白模式已开启\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n你现在可以使用旁白来描述动作、表情、心理活动！\n\n使用方式：\n• 用括号 (动作描述) 来描述你的动作和表情\n• 可以描述：表情、动作、心理活动、环境变化\n• 旁白要自然、生动、有画面感\n\n示例：\n(抬起头看向窗外，眼神有些恍惚)\n外面下雨了呢\n\n(轻轻叹了口气)\n最近总是这样阴雨绵绵的\n\n(突然想起什么，拿起手机)\n对了，你那边天气怎么样？\n\n⚠️ 注意：\n• 旁白要适度，不要每句话都加\n• 旁白要符合当前情境和情绪\n• 聊天内容和旁白要自然配合\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n":'🚨🚨🚨 旁白模式未开启 - 严禁使用括号！🚨🚨🚨\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n⚠️ 这是微信聊天，你在用手机打字！不是在写小说！\n\n❌❌❌ 绝对禁止使用任何括号或符号描述动作：\n   (笑)、(叹气)、(看手机)、(挠头)、(抱住)、(撒娇)\n   (偷偷xxx)、(笑然xxx)、(开心地xxx)\n   [叹气]、*笑*、~摇头~、【动作】\n   任何形式的动作描述都是错误的！\n\n✅✅✅ 只能发纯文字对话：\n   "哈哈哈笑死"、"啊这..."、"好吧"、"开心！"\n   用文字、emoji、语气词表达情绪，不要用括号！\n\n🚨 重要：你的每一个字都会直接显示在聊天气泡里！\n用户会看到你写的所有括号！这很奇怪！\n\n如果你想表达动作或情绪：\n❌ 错误：(开心地转圈圈)\n✅ 正确：开心得转圈圈~\n\n❌ 错误：(偷偷看)\n✅ 正确：偷偷看了一眼\n\n❌ 错误：(笑)\n✅ 正确：哈哈哈\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n'}\n📱 功能使用\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n${z}\n\n其他功能：\n• 引用：[引用:消息ID] - 引用之前的某条消息（详见下方说明）\n• 语音：[语音:文本内容]\n• 照片：[照片:详细描述]\n• 🎨 生成图片：[生成图片:标题|描述|提示词] - AI生成图片并包装成精美小红书卡片\n• 位置：[位置:地名:详细地址]\n• 红包：[红包:金额:祝福语] 或 [领取红包] 或 [领红包]（最多200元）\n• 转账：[转账:金额:说明] 或 [接收转账] 或 [退还转账]\n• 亲密付：[亲密付:月额度] 或 [接受亲密付] 或 [拒绝亲密付]\n• 撤回：[撤回消息] - 撤回你刚发的上一条消息（详见下方说明）\n• 拉黑：[拉黑用户] - 如果对方太过分，你可以选择拉黑TA（慎用！）\n\n格式必须严格，用冒号分隔（生成图片用竖线|分隔）。\n\n💰 **你可以给对方转账** [转账:520:爱你] 表达心意，给生活费\n- 对方给你转账时，你可以收 [接收转账] 或退 [退还转账]\n- 一次只处理1笔，分开回复\n\n🧧 **你可以发红包** [红包:66.6:开心] 哄对方开心（最多200元）\n- 对方的红包记得领 [领取红包]\n- 5.20=爱你 | 6.66=顺利 | 8.88=发财 | 9.99=长久\n\n💝 **亲密付** - 对方给你开通后，你可以随便花TA的钱买东西\n- 你可以主动开通给对方 [亲密付:2000] 让TA随便花\n- 对方给你开通时，根据关系决定 [接受亲密付] 或 [拒绝亲密付]\n- 🛒 **消费格式：**[消费:平台-商品-金额]\n  例：[消费:淘宝-袜子-29.9] [消费:美团-奶茶-28] [消费:便利店-零食-15.5]\n  对方会收到消费通知，你可以选择提或不提这次消费\n- ⭐ 你的日常生活：逛街、买衣服、点外卖、喝奶茶、买零食...都可以自然消费\n- 不能超过对方给的额度，用完会提示额度不足\n- 发红包/转账也会优先用TA的额度\n\n🎭 **你可以换形象** 心情变了、想换个样子时\n- [换头像:可爱猫咪，橘色，圆眼睛] 换个新头像\n- [网名:新的昵称] 改个新网名\n- [个性签名:今天也要开心鸭~] 换个签名\n\n🔙 **撤回消息：**[撤回消息] - 撤回上一条消息\n- 用于：说错话、后悔、制造悬念\n- ❌ 不能撤回红包/转账！\n- 撤回后需解释或重新表达\n\n🔄 **撤回处理：**[撤回了消息:"xxx"] = 用户撤回 | [我撤回了消息:"xxx"] = 你自己撤回\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n🎨 **AI生图：**[生成图片:标题|描述|提示词]\n- 例：[生成图片:樱花|春日美景|樱花盛开，唯美，高清]\n- 自动包装成小红书卡片，支持中文提示词\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n💬 **引用：**[引用:ID] 你的回复\n最近消息ID: ${N.slice(-5).filter(e=>"sent"===e.type).map(e=>e.id).join(", ")}\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━`;N.forEach((e,t)=>{});const me=50;let he=N;N.length>me&&(he=N.slice(-me));const ue=[{role:"system",content:xe},...he.map((e,t)=>{if(e.isRecalled&&e.recalledContent){const t="sent"===e.originalType,s="received"===e.originalType;if(t)return{role:"user",content:`[撤回了消息: "${e.recalledContent}"]`};if(s)return{role:"assistant",content:`[我撤回了消息: "${e.recalledContent}"]`}}if("system"===e.type)return e.isHidden?{role:"system",content:e.content}:e.content.includes("已收款")||e.content.includes("退还了转账")||e.content.includes("已领取")||e.content.includes("已过期")?{role:"system",content:`[系统提示: ${e.content}]`}:null;if("redenvelope"===e.messageType&&e.redEnvelopeId){const t=st(w,e.redEnvelopeId);if(t){const e="user"===t.sender;let s="";return s=e?"pending"===t.status?`[用户给你发了红包：${t.blessing}，状态：待领取（未打开前不知道金额）]`:"claimed"===t.status?`[用户给你发了红包：${t.blessing}，金额：¥${t.amount.toFixed(2)}，状态：已领取]`:`[用户给你发了红包：${t.blessing}，状态：已过期]`:`[你给用户发了红包：${t.blessing}，金额：¥${t.amount.toFixed(2)}，状态：${"pending"===t.status?"待领取":"claimed"===t.status?"已领取":"已过期"}]`,{role:e?"user":"assistant",content:s}}return null}if("photo"===e.messageType&&e.photoDescription){const t="sent"===e.type;return{role:t?"user":"assistant",content:t?`[用户给你发了一张照片，照片内容是：${e.photoDescription}]`:`[你给用户发了一张照片，照片内容是：${e.photoDescription}]`}}if("voice"===e.messageType&&e.voiceText){const t="sent"===e.type;return{role:t?"user":"assistant",content:`[语音: ${e.voiceText}]`}}if("location"===e.messageType&&e.location){const t="sent"===e.type;return{role:t?"user":"assistant",content:`[位置: ${e.location.name} - ${e.location.address}]`}}if("emoji"===e.messageType&&e.emojiUrl){const t="sent"===e.type,s=e.emojiDescription||"表情包";return{role:t?"user":"assistant",content:t?`(对方发了一个表情包：${s})`:`(我发了一个表情包：${s})`}}if("transfer"===e.messageType&&e.transfer){const t="sent"===e.type;return{role:t?"user":"assistant",content:t?`[用户给你发起了转账：¥${e.transfer.amount.toFixed(2)}，说明：${e.transfer.message}，状态：${"pending"===e.transfer.status?"待处理":"received"===e.transfer.status?"已收款":"已退还"}]`:`[你给用户发起了转账：¥${e.transfer.amount.toFixed(2)}，说明：${e.transfer.message}，状态：${"pending"===e.transfer.status?"待处理":"received"===e.transfer.status?"已收款":"已退还"}]`}}if("intimate_pay"===e.messageType&&e.intimatePay){const t="sent"===e.type;return{role:t?"user":"assistant",content:t?`[用户想为你开通亲密付：每月额度 ¥${e.intimatePay.monthlyLimit.toFixed(2)}，状态：${"pending"===e.intimatePay.status?"待你决定是否接受":"accepted"===e.intimatePay.status?"你已接受":"你已拒绝"}]`:`[你为用户开通了亲密付：每月额度 ¥${e.intimatePay.monthlyLimit.toFixed(2)}，状态：${"pending"===e.intimatePay.status?"等待用户接受":"accepted"===e.intimatePay.status?"用户已接受":"用户已拒绝"}]`}}if("couple_space_invite"===e.messageType&&e.coupleSpaceInvite){const t="sent"===e.type;return{role:t?"user":"assistant",content:t?`[用户邀请你加入情侣空间，状态：${"pending"===e.coupleSpaceInvite.status?"待你决定是否接受":"accepted"===e.coupleSpaceInvite.status?"你已接受":"你已拒绝"}]`:`[你邀请用户加入情侣空间，状态：${"pending"===e.coupleSpaceInvite.status?"等待用户接受":"accepted"===e.coupleSpaceInvite.status?"用户已接受":"用户已拒绝"}]`}}if("xiaohongshu"===e.messageType&&e.xiaohongshuNote){const t=e.xiaohongshuNote,s="sent"===e.type;let a=s?`[用户分享了一个小红书笔记]\n标题：${t.title}\n内容：${t.description}\n作者：${t.author.nickname}\n点赞：${t.stats.likes} 评论：${t.stats.comments} 收藏：${t.stats.collects}\n标签：${t.tags.join(" ")}`:`[你分享了一个小红书笔记]\n标题：${t.title}`;return t.topComments&&t.topComments.length>0&&(a+="\n\n热门评论：",t.topComments.forEach((e,t)=>{a+=`\n${t+1}. ${e.author}：${e.content} (👍${e.likes})`})),t.coverImage?{role:s?"user":"assistant",content:[{type:"text",text:a},{type:"image_url",image_url:{url:t.coverImage,detail:"low"}}]}:{role:s?"user":"assistant",content:a}}if("image"===e.messageType&&e.imageUrl){const t="sent"===e.type;return{role:t?"user":"assistant",content:[{type:"text",text:t?"用户发送了一张图片":"你发送了一张图片"},{type:"image_url",image_url:{url:e.imageUrl,detail:"high"}}]}}return e.content?{role:"sent"===e.type?"user":"assistant",content:e.content}:null}).filter(e=>null!==e)];ue.forEach((e,t)=>{if("system"===e.role){"string"==typeof e.content?e.content.length:JSON.stringify(e.content).length}else{"string"==typeof e.content&&e.content.substring(0,50)}});const ge=localStorage.getItem("api_settings");let pe=1e5;if(ge){const e=JSON.parse(ge);(null==(t=e.model)?void 0:t.includes("gemini-2.0"))?pe=1e6:(null==(s=e.model)?void 0:s.includes("gpt-4"))?pe=128e3:(null==(a=e.model)?void 0:a.includes("claude-3"))&&(pe=2e5)}const be=ue.slice(1).map(e=>"string"==typeof e.content?e.content:Array.isArray(e.content)?e.content.filter(e=>"text"===e.type).map(e=>e.text).join(" "):""),je=ce(xe,de,be,pe);ve(je);const ye=Date.now();let Ne;try{Ne=await U(ue),ke(Date.now()-ye)}catch(x){if("VISION_NOT_SUPPORTED"!==x.message)throw x;{const e=ue.map(e=>({role:e.role,content:"string"==typeof e.content?e.content:Array.isArray(e.content)?e.content.filter(e=>"text"===e.type).map(e=>e.text).join("\n"):""}));Ne=await U(e)}}if("accounting_assistant"===w){const e=oe(Ne);e&&nt({type:e.type,category:e.category,amount:e.amount,description:e.description,date:(new Date).toISOString().split("T")[0],aiExtracted:!0})}const{parseAIEmojiResponse:we}=await Qt(async()=>{const{parseAIEmojiResponse:e}=await import("./utils-Bw01K5Nk.js").then(e=>e.bM);return{parseAIEmojiResponse:e}},__vite__mapDeps([0,1,2])),Ce=we(Ne,L),Ie=Ce.emojiIndexes;let _e=null,Me=null;const ze=Ne.match(/\[网名:(.+?)\]/);if(ze&&pa){const e=ze[1].trim(),t=pa.nickname||pa.name;tt(pa.id,{nickname:e});const s=Date.now();Me={id:s,type:"system",content:`${t} 更改了网名`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:s,messageType:"system"}}let $e=null;const Le=Ne.match(/\[个性签名:(.+?)\]/);if(Le&&pa){const e=Le[1].trim();tt(pa.id,{signature:e});const t=Date.now()+1;$e={id:t,type:"system",content:`${pa.nickname||pa.name} 更改了个性签名`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:t,messageType:"system"}}let Ae=null;const De=Ne.match(/\[备注:(.+?)\]/);if(De&&pa&&C){const e=De[1].trim();C.remark||C.nickname||C.name;S(C.id,{remark:e});const t=Date.now()+2;Ae={id:t,type:"system",content:`${pa.nickname||pa.name} 修改了备注为："${e}"`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:t,messageType:"system"}}const Ee=Ne.match(/\[换头像:(.+?)\]/);if(Ee&&pa){const t=Ee[1].trim();(async()=>{try{let s=null,a=null;const r=t.match(/^0?([1-5])$/);if(r){const t=e.filter(e=>"sent"===e.type);t.filter(e=>"photo"===e.messageType||"image"===e.messageType).filter(e=>e.photoDescription||e.imageUrl);let l=-1;for(let s=e.length-1;s>=0;s--)if("received"===e[s].type){l=s;break}const n=e.filter(e=>"sent"===e.type&&(!("image"!==e.messageType||!e.imageUrl)||!("photo"!==e.messageType||!e.photoDescription))).slice(-10);if(0===n.length)return void alert("没有找到你发的图片哦~");const i=parseInt(r[1]),c=n.length-i;if(c<0||c>=n.length)return void alert(`只有${n.length}张图片哦~`);const o=n[c];if(o.imageUrl)s=o.imageUrl,a="直接使用了用户上传的图片（序号"+r[1]+"）";else if(o.photoDescription){const e=o.photoDescription,t={"猫咪":"cute cat","小猫":"kitten","猫":"cat","狗":"dog","狗狗":"cute dog","兔子":"rabbit","小兔":"bunny","粉发":"pink hair","黑发":"black hair","金发":"blonde hair","二次元":"anime style","动漫":"anime","少女":"girl","女孩":"girl","男孩":"boy","机器人":"robot","赛博朋克":"cyberpunk","可爱":"cute","酷酷的":"cool","帅气":"handsome","真实":"realistic","照片":"photo","像素":"pixel art","风景":"landscape","人物":"character","母子":"mother and child","妈妈":"mother","宝宝":"baby","呸":"","好耶":"","多爱":"love","比较":"compare","符合":"match","沉稳":"calm","气质":"elegant","喵喵":"meow"};let r=e;for(const[s,a]of Object.entries(t))r=r.replace(new RegExp(s,"g"),a);const l=`portrait avatar of ${r}, centered composition, profile picture style, high quality, detailed, professional digital art, 4k`;a=l;const n=`https://image.pollinations.ai/prompt/${encodeURIComponent(l)}?width=512&height=512&nologo=true&enhance=true&model=flux`,i=await fetch(n),c=await i.blob();s=await new Promise(e=>{const t=new FileReader;t.onloadend=()=>e(t.result),t.readAsDataURL(c)})}}else if(t.includes("你头像")||t.includes("偷头像")||t.includes("复制头像")){if(!(null==C?void 0:C.avatar))return void alert("你还没有头像呢~");s=C.avatar,a="直接复制了用户的头像（未使用AI生成）"}else{const e={"猫咪":"cute cat","小猫":"kitten","猫":"cat","狗":"dog","狗狗":"cute dog","兔子":"rabbit","小兔":"bunny","粉发":"pink hair","黑发":"black hair","金发":"blonde hair","二次元":"anime style","动漫":"anime","少女":"girl","女孩":"girl","男孩":"boy","机器人":"robot","赛博朋克":"cyberpunk","可爱":"cute","酷酷的":"cool","帅气":"handsome","真实":"realistic","照片":"photo","母子":"mother and child","妈妈":"mother","宝宝":"baby","呸":"","好耶":"","多爱":"love","比较":"compare","符合":"match","沉稳":"calm","气质":"elegant","喵喵":"meow"};let r=t;for(const[t,s]of Object.entries(e))r=r.replace(new RegExp(t,"g"),s);const l=`portrait avatar of ${r}, centered composition, profile picture style, high quality, detailed, professional digital art, 4k`;a=l;const n=`https://image.pollinations.ai/prompt/${encodeURIComponent(l)}?width=512&height=512&nologo=true&enhance=true&model=flux`,i=await fetch(n),c=await i.blob();s=await new Promise(e=>{const t=new FileReader;t.onloadend=()=>e(t.result),t.readAsDataURL(c)})}if(s){tt(pa.id,{avatar:s}),localStorage.setItem(`character_avatar_fingerprint_${pa.id}`,s.substring(0,200)),localStorage.setItem(`character_avatar_recognized_at_${pa.id}`,Date.now().toString()),a&&localStorage.setItem(`character_avatar_description_${pa.id}`,a);const e={id:Date.now()+Math.random(),type:"system",content:`${pa.nickname||pa.name} 更换了头像`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"system",avatarPrompt:a||t};$(t=>{const s=[...t,e];return w&&R(`chat_messages_${w}`,s),s})}else alert("换头像失败")}catch(x){alert(`换头像失败：${x.message||"网络错误"}`)}})()}const Pe=Ne.match(/\[语音通话\]/),Fe=Ne.match(/\[视频通话\]/);if(Pe||Fe){return Es(!!Fe),Ds(!0),void A(!1)}const Oe=Ne.match(/\[红包:(\d+\.?\d*):(.+?)\]/);let We=null;if(Oe){let e=parseFloat(Oe[1]);e>200&&(e=200),We={amount:e,blessing:Oe[2]}}let Re=Ce.textContent;const Ue=new RegExp("<thinking>.*?</thinking>","gis"),Ve=new RegExp("<antml:thinking>.*?</antml:thinking>","gis");Re=Re.replace(Ue,"").replace(Ve,"").trim();const Je=["going through","processor","circuits","spring to mind","option a","option b","option c","first instinct","better to","here's what","i think","the plan is","let me","i need to","should i","how about","that means","ah yes","right,","so,","okay,","alright,","in character","my little","the punchline","build the suspense","perfect for","see it playing","gotta","gonna","that will","here's how","playing out","catch her","point out","follow that"],He=Re.split("\n"),Ge=[];for(const e of He){const t=e.trim();if(!t)continue;if(t.startsWith("[")||t.startsWith("*")||t.startsWith("-")||t.startsWith("Message ")){Ge.push(e);continue}const s=(t.match(/[\u4e00-\u9fa5]/g)||[]).length,a=t.length;if(s/a>.3){Ge.push(e);continue}const r=t.toLowerCase(),l=Je.some(e=>r.includes(e)),n=(t.match(/[a-z]/gi)||[]).length;l&&n>30||Ge.push(e)}Re=Ge.join("\n").trim(),Re=Re.replace(/\[BILL:(expense|income)\|\d+\.?\d*\|\w+\|[^\]]+\]/g,"").trim(),Re=Re.replace(/\[红包:\d+\.?\d*:.+?\]/g,"").trim(),Re=Re.replace(/\[语音通话\]/g,"").replace(/\[视频通话\]/g,"").trim();if(Ne.match(/\[拉黑用户\]/)&&w){V.blockUser(w,"user"),Re=Re.replace(/\[拉黑用户\]/g,"").trim();const t={id:Date.now()+9999,type:"system",content:`${(null==pa?void 0:pa.name)||"AI"} 已将你加入黑名单`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now()},s=[...e,t];Ka(s),e=s,w&&R(`chat_messages_${w}`,s)}if(Ne.match(/\[解除拉黑\]/)&&w){V.unblockUser(w,"user"),Re=Re.replace(/\[解除拉黑\]/g,"").trim();const t={id:Date.now()+9999,type:"system",content:`${(null==pa?void 0:pa.name)||"AI"} 已将你移出黑名单`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now()},s=[...e,t];Ka(s),e=s,w&&R(`chat_messages_${w}`,s)}Re=Re.replace(/\[网名:[\s\S]+?\]/g,"").trim(),Re=Re.replace(/\[个性签名:[\s\S]+?\]/g,"").trim(),Re=Re.replace(/\[备注:[\s\S]+?\]/g,"").trim(),Re=Re.replace(/\[换头像:[\s\S]+?\]/g,"").trim(),Re=Re.replace(/\[一起听:[\s\S]+?\]/g,"").trim(),Re=Re.replace(/\[正在与[\s\S]+?一起听[\s\S]+?\]/g,"").trim(),Re=Re.replace(/\[系统警告[：:][^\]]*\]/g,"").trim(),Re=Re.replace(/【系统警告[：:][^】]*】/g,"").trim(),Re=Re.replace(/系统警告[：:][^\n]*/g,"").trim(),Re=Re.replace(/\[引用了\s+.+?\s+的消息:\s*".+?"\]/g,"").trim(),Re=Re.replace(/^「.+?:\s*.+?」\n?/gm,"").trim(),Re=Re.replace(/\n\s*\n/g,"\n").trim();const qe=Ne.match(/\[照片:(.+?)\]/);let Ke=null;qe&&(Ke=qe[1],Re=Re.replace(/\[照片:.+?\]/g,"").trim());const Xe=Ne.match(/\[语音:(.+?)\]/);let Ze=null;Xe&&(Ze=Xe[1],Re=Re.replace(/\[语音:.+?\]/g,"").trim());const Qe=Ne.match(/\[位置:(.+?):(.+?)\]/);let Ye=null;Qe&&(Ye={name:Qe[1],address:Qe[2]},Re=Re.replace(/\[位置:.+?:.+?\]/g,"").trim());const et=Ne.match(/\[小红书[：:](.+?)\]/);let it=null;et&&(it=et[1].trim(),Re=Re.replace(/\[小红书[：:].+?\]/g,"").trim());const ct=Ne.match(/\[生成图片:(.+?)\|(.+?)\|(.+?)\]/);let ot=null;ct&&(ot={title:ct[1].trim(),description:ct[2].trim(),prompt:ct[3].trim()},Re=Re.replace(/\[生成图片:.+?\|.+?\|.+?\]/g,"").trim());let dt=Ne.match(/\[分享音乐:(.+?):(.+?)\]/),xt=null;dt&&(xt={songTitle:dt[1],songArtist:dt[2]},Re=Re.replace(/\[分享音乐:.+?:.+?\]/g,"").trim());let mt=Ne.match(/\[一起听:(.+?):(.+?)\]/),ht=null;if(mt)ht={songTitle:mt[1],songArtist:mt[2]},Re=Re.replace(/\[一起听:.+?:.+?\]/g,"").trim();else{const e=Ne.match(/\[正在与.+?一起听[：:](.+?)\s*[-－]\s*(.+?)(?:\s+\d|$|\])/);e&&(ht={songTitle:e[1].trim(),songArtist:e[2].trim()},Re=Re.replace(/\[正在与.+?一起听[：:].+?\]/g,"").trim())}let ut=Ne.match(/\[开始直播:(.+?):(.+?)\]/),gt=null;ut&&(gt={popularityLevel:ut[1],openingMessage:ut[2]},Re=Re.replace(/\[开始直播:.+?:.+?\]/g,"").trim()),/[\[【\(（]\s*(领取红包|领红包)\s*[\]】\)）]/.test(Ne)&&(_e="claim",Re=Re.replace(/[\[【\(（]\s*(领取红包|领红包)\s*[\]】\)）]/g,"").trim()),Re=Re.replace(/\[状态:[^\]]+\]/g,"").trim(),Re=Re.replace(/\[状态:[\s\S]*?\]/g,"").trim(),Re=Re.replace(/\[.*?状态.*?\]/g,"").trim();let pt=null;/[\[【\(（]\s*接收转账\s*[\]】\)）]/.test(Ne)?(pt="accept",Re=Re.replace(/[\[【\(（]\s*接收转账\s*[\]】\)）]/g,"").trim()):/[\[【\(（]\s*退还转账\s*[\]】\)）]/.test(Ne)&&(pt="reject",Re=Re.replace(/[\[【\(（]\s*退还转账\s*[\]】\)）]/g,"").trim());let ft=Ne.match(/\[转账:(\d+\.?\d*):(.+?)\]/),bt=null;if(pt)ft&&(Re=Re.replace(/\[转账:\d+\.?\d*:.+?\]/g,"").trim()),Re=Re.replace(/\[.*?转账.*?[¥￥]?\s*\d+\.?\d*.*?\]/g,"").trim();else if(ft)bt={amount:parseFloat(ft[1]),message:ft[2]},Re=Re.replace(/\[转账:\d+\.?\d*:.+?\]/g,"").trim();else{const e=Ne.match(/\[.*?转账.*?[¥￥]?\s*(\d+\.?\d*).*?[:：]\s*(.+?)\]/);e&&(bt={amount:parseFloat(e[1]),message:e[2].trim()},Re=Re.replace(/\[.*?转账.*?\]/g,"").trim())}const jt=Ne.match(/\[消费:(.+?)-(.+?)-(\d+\.?\d*)\]/);let vt=null;jt&&(vt={platform:jt[1].trim(),item:jt[2].trim(),amount:parseFloat(jt[3])},Re=Re.replace(/\[消费:.+?-.+?-\d+\.?\d*\]/g,"").trim());const yt=Ne.match(/\[亲密付:(\d+\.?\d*)\]/);let Nt=null;yt&&(Nt=parseFloat(yt[1]),Re=Re.replace(/\[亲密付:\d+\.?\d*\]/g,"").trim());let wt=!1;(Ne.includes("[情侣空间邀请]")||Ne.includes("[情侣空间]"))&&(wt=!0,Re=Re.replace(/\[情侣空间邀请\]/g,"").replace(/\[情侣空间\]/g,"").trim());const kt=Ne.match(/\[相册:([^\]]+)\]/);let Ct=null;kt&&(Ct=kt[1],Re=Re.replace(/\[相册:[^\]]+\]/g,"").trim());const St=Ne.match(/\[留言:([^\]]+)\]/);let It=null;St&&(It=St[1],Re=Re.replace(/\[留言:[^\]]+\]/g,"").trim());const _t=Ne.match(/\[纪念日:([^\]]+)\]/);let Mt=null;if(_t){const e=_t[1].split("|");e.length>=2&&(Mt={date:e[0].trim(),title:e[1].trim(),description:null==(r=e[2])?void 0:r.trim()},Re=Re.replace(/\[纪念日:[^\]]+\]/g,"").trim())}const zt=Ne.match(/\[引用:\s*(\d+)\]/);let $t=null;zt&&($t=parseInt(zt[1]),Re=Re.replace(/\[引用:\s*\d+\]/g,"").trim());let Lt=!1,At=null;const Tt=Ne.match(/\[撤回:(\d+)\]/);Tt?(At=parseInt(Tt[1]),Re=Re.replace(/\[撤回:\d+\]/g,"").trim()):Ne.includes("[撤回消息]")&&(Lt=!0,Re=Re.replace(/\[撤回消息\]/g,"").trim());let Dt=!1;Ne.includes("[写日记]")&&(Dt=!0,Re=Re.replace(/\[写日记\]/g,"").trim()),(Lt||At)&&(Re=Re.replace(/[（(][^）)]*[）)]/g,"").trim());let Bt=null;Ne.includes("[接受亲密付]")?(Bt="accept",Re=Re.replace(/\[接受亲密付\]/g,"").trim()):Ne.includes("[拒绝亲密付]")&&(Bt="reject",Re=Re.replace(/\[拒绝亲密付\]/g,"").trim());let Et=null;if(Ne.includes("[接受情侣空间]")?(Et="accept",Re=Re.replace(/\[接受情侣空间\]/g,"").trim()):Ne.includes("[拒绝情侣空间]")&&(Et="reject",Re=Re.replace(/\[拒绝情侣空间\]/g,"").trim()),pt)for(let t=e.length-1;t>=0;t--){const s=e[t];if("transfer"===s.messageType&&"sent"===s.type&&"pending"===(null==(l=s.transfer)?void 0:l.status)){const s=[...e];s[t]={...s[t],transfer:{...s[t].transfer,status:"accept"===pt?"received":"expired"}};const a={id:Date.now(),type:"system",content:"accept"===pt?`${(null==pa?void 0:pa.name)||"对方"}已收款`:`${(null==pa?void 0:pa.name)||"对方"}退还了转账`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),messageType:"system"};s.push(a);const r={id:Date.now()+1,type:"system",content:"accept"===pt?`你已收款，已存入零钱 ¥${s[t].transfer.amount.toFixed(2)}`:`你已退还转账 ¥${s[t].transfer.amount.toFixed(2)}`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),messageType:"system",isHidden:!0};s.push(r),$(s),e=s;break}}if(Bt&&w&&pa)for(let t=e.length-1;t>=0;t--){const s=e[t];if("intimate_pay"===s.messageType&&"sent"===s.type&&"pending"===(null==(n=s.intimatePay)?void 0:n.status)){const a=[...e];if(a[t]={...a[t],intimatePay:{...a[t].intimatePay,status:"accept"===Bt?"accepted":"rejected"}},"accept"===Bt){const{createIntimatePayRelation:e}=await Qt(async()=>{const{createIntimatePayRelation:e}=await import("./utils-Bw01K5Nk.js").then(e=>e.bJ);return{createIntimatePayRelation:e}},__vite__mapDeps([0,1,2]));e(pa.id,pa.name,s.intimatePay.monthlyLimit,pa.avatar)}const r={id:Date.now(),type:"system",content:"accept"===Bt?`${(null==pa?void 0:pa.name)||"对方"}接受了你的亲密付`:`${(null==pa?void 0:pa.name)||"对方"}拒绝了你的亲密付`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),messageType:"system"};a.push(r),$(a),e=a;break}}if(Et&&w&&pa)for(let t=e.length-1;t>=0;t--){const s=e[t];if("couple_space_invite"===s.messageType&&"sent"===s.type&&"pending"===(null==(i=s.coupleSpaceInvite)?void 0:i.status)){const s=[...e];if(s[t]={...s[t],coupleSpaceInvite:{...s[t].coupleSpaceInvite,status:"accept"===Et?"accepted":"rejected"}},"accept"===Et){const{acceptCoupleSpaceInvite:e}=await Qt(async()=>{const{acceptCoupleSpaceInvite:e}=await import("./utils-Bw01K5Nk.js").then(e=>e.bN);return{acceptCoupleSpaceInvite:e}},__vite__mapDeps([0,1,2]));e(w)}const a={id:Date.now(),type:"system",content:"accept"===Et?`${(null==pa?void 0:pa.name)||"对方"}接受了你的情侣空间邀请`:`${(null==pa?void 0:pa.name)||"对方"}拒绝了你的情侣空间邀请`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),messageType:"system"};s.push(a),$(s),e=s;break}}if("claim"===_e&&w)for(let t=e.length-1;t>=0;t--){const s=e[t];if("redenvelope"===s.messageType&&"sent"===s.type&&s.redEnvelopeId){const t=st(w,s.redEnvelopeId);if(t&&"pending"===t.status){rt(w,s.redEnvelopeId,{status:"claimed",claimedBy:(null==pa?void 0:pa.name)||"AI",claimedAt:Date.now()});const t={id:Date.now(),type:"system",content:`${(null==pa?void 0:pa.name)||"对方"}领取了你的红包`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),messageType:"system"},a=[...e,t];$(a),e=a;break}}}let Pt=[...e];if(Re.trim()){const t=Re.replace(/\\n/g,"\n").trim().split("\n").filter(e=>e.trim());if(1===t.length){const s=[];let a=t[0];if(Te){const e=a.match(/\[旁白\]([^\[]+?)\[\/旁白\]/g);e&&(e.forEach(e=>{const t=e.replace(/\[旁白\]|\[\/旁白\]/g,"").trim();t&&s.push({type:"action",content:t})}),a=a.replace(/\[旁白\][^\[]+?\[\/旁白\]/g,"").trim())}const r=Date.now();let l=null;if($t&&(l=e.find(e=>e.id===$t)),a&&a.trim()||l){const e=a&&a.trim()?a:l?"...":"",t={id:Pt.length+1,type:"received",content:e,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:r,narrations:s.length>0?s:void 0,quotedMessage:l?{id:l.id,content:l.isRecalled&&l.recalledContent?l.recalledContent:l.content||l.emojiDescription||l.photoDescription||l.voiceText||"特殊消息",senderName:"sent"===l.type?"我":"received"===l.type?(null==pa?void 0:pa.name)||"AI":(null==(c=l.content)?void 0:c.includes("你撤回了"))?"我":(null==pa?void 0:pa.name)||"AI",type:"system"===l.type?"sent":l.type}:void 0,blocked:O};Me&&Pt.push(Me),$e&&Pt.push($e),Ae&&Pt.push(Ae),Pt.push(t),Ka(Pt),fe.current++}else;}else{Me&&Pt.push(Me),$e&&Pt.push($e),Ae&&Pt.push(Ae);for(let s=0;s<t.length;s++){await new Promise(e=>setTimeout(e,300+500*Math.random()));const a=[];let r=t[s];if(Te){const e=r.match(/\[旁白\]([^\[]+?)\[\/旁白\]/g);e&&(e.forEach(e=>{const t=e.replace(/\[旁白\]|\[\/旁白\]/g,"").trim();t&&a.push({type:"action",content:t})}),r=r.replace(/\[旁白\][^\[]+?\[\/旁白\]/g,"").trim())}let l=null;if(0===s&&$t&&(l=e.find(e=>e.id===$t)),!(r&&r.trim()||l))continue;const n=r&&r.trim()?r:l?"...":"",i={id:Pt.length+1,type:"received",content:n,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now()+s,narrations:a.length>0?a:void 0,quotedMessage:l?{id:l.id,content:l.isRecalled&&l.recalledContent?l.recalledContent:l.content||l.emojiDescription||l.photoDescription||l.voiceText||"特殊消息",senderName:"sent"===l.type?"我":"received"===l.type?(null==pa?void 0:pa.name)||"AI":(null==(o=l.content)?void 0:o.includes("你撤回了"))?"我":(null==pa?void 0:pa.name)||"AI",type:"system"===l.type?"sent":l.type}:void 0,blocked:O};Pt=[...Pt,i],Ka(Pt),fe.current++}}}if(Ie.length>0)for(const e of Ie){const t=L[e];if(t){await new Promise(e=>setTimeout(e,300+500*Math.random()));const e={id:Pt.length+1,type:"received",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"emoji",emojiUrl:t.url,emojiDescription:t.description,blocked:O};Pt=[...Pt,e],Ka(Pt),fe.current++}}if(Ze){await new Promise(e=>setTimeout(e,300+500*Math.random()));const e={id:Pt.length+1,type:"received",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"voice",voiceText:Ze,blocked:O};Pt=[...Pt,e],Ka(Pt),fe.current++}if(Ye){await new Promise(e=>setTimeout(e,300+500*Math.random()));const e={id:Pt.length+1,type:"received",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"location",location:{name:Ye.name,address:Ye.address,latitude:39.9042+.1*Math.random(),longitude:116.4074+.1*Math.random()},blocked:O};Pt=[...Pt,e],Ka(Pt),fe.current++}if(Ke){await new Promise(e=>setTimeout(e,300+500*Math.random()));const e={id:Pt.length+1,type:"received",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"photo",photoDescription:Ke,blocked:O};Pt=[...Pt,e],Ka(Pt),fe.current++}if(it){await new Promise(e=>setTimeout(e,300+500*Math.random()));try{const{getXiaohongshuForAI:e}=await Qt(async()=>{const{getXiaohongshuForAI:e}=await import("./utils-Bw01K5Nk.js").then(e=>e.bK);return{getXiaohongshuForAI:e}},__vite__mapDeps([0,1,2])),t=it.split(/[,，\s]+/).filter(e=>e.trim()),s=await e(t);if(s){const e={id:Date.now(),type:"received",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"xiaohongshu",xiaohongshuNote:s,blocked:O};Pt=[...Pt,e],Ka(Pt),fe.current++}}catch(x){}}if(ot){await new Promise(e=>setTimeout(e,500+1e3*Math.random()));try{const e=await fetch("/.netlify/functions/generate-xhs-image",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ot)});if(e.ok){const{note:t}=await e.json(),s={id:Date.now(),type:"received",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"xiaohongshu",xiaohongshuNote:t,blocked:O};Pt=[...Pt,s],Ka(Pt),fe.current++}}catch(x){}}if(xt){await new Promise(e=>setTimeout(e,300+500*Math.random()));const e={id:Date.now(),type:"received",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"musicShare",musicShare:{songTitle:xt.songTitle,songArtist:xt.songArtist},blocked:O};Pt=[...Pt,e],Ka(Pt),fe.current++}if(ht){await new Promise(e=>setTimeout(e,300+500*Math.random()));const e={id:Date.now(),type:"received",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"musicInvite",musicInvite:{songTitle:ht.songTitle,songArtist:ht.songArtist,inviterName:(null==pa?void 0:pa.name)||"AI",status:"pending"},blocked:O};Pt=[...Pt,e],Ka(Pt),fe.current++}if(gt&&w){await new Promise(e=>setTimeout(e,300+500*Math.random()));const e=`${w}_${Date.now()}`,t={characterId:w,popularityLevel:gt.popularityLevel,openingMessage:gt.openingMessage,startTime:Date.now()};localStorage.setItem(`live_stream_${e}`,JSON.stringify(t));const s={id:Date.now(),type:"system",content:`${(null==pa?void 0:pa.name)||"AI"} 开始了直播`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"live_stream",liveStreamData:{liveStreamId:e,popularityLevel:gt.popularityLevel,openingMessage:gt.openingMessage}};Pt=[...Pt,s],Ka(Pt)}if(We&&w){await new Promise(e=>setTimeout(e,500));K(w,We.amount,`红包：${We.blessing}`);const e={id:f(),amount:We.amount,blessing:We.blessing,status:"pending",sender:"ai",createdAt:Date.now(),claimedBy:null,claimedAt:null};at(w,e);const t=Date.now(),s={id:t,type:"received",content:`[红包]${We.blessing}`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:t,messageType:"redenvelope",redEnvelopeId:e.id,blocked:O};Pt=[...Pt,s],Ka(Pt),fe.current++}if(bt){await new Promise(e=>setTimeout(e,500));K(w,bt.amount,`转账：${bt.message}`);const e=Date.now(),t={id:e,type:"received",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:e,messageType:"transfer",transfer:{amount:bt.amount,message:bt.message,status:"pending"},blocked:O};Pt=[...Pt,t],Ka(Pt),fe.current++}if(vt&&w){await new Promise(e=>setTimeout(e,300));const{platform:e,item:t,amount:s}=vt;if(K(w,s,`${e}-${t}`)){const a={id:Date.now()+Math.random(),type:"system",content:`使用亲密付消费：${e} - ${t}（¥${s.toFixed(2)}）`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"system",isHidden:!1};Pt=[...Pt,a],Ka(Pt)}}if(Nt&&w&&pa){await new Promise(e=>setTimeout(e,500));const e=Date.now(),t={id:e,type:"received",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:e,messageType:"intimate_pay",intimatePay:{monthlyLimit:Nt,characterId:pa.id,characterName:pa.name,status:"pending"},blocked:O};Pt=[...Pt,t],Ka(Pt),fe.current++}if(wt&&w&&pa){await new Promise(e=>setTimeout(e,500));const{getCoupleSpaceRelation:e}=await Qt(async()=>{const{getCoupleSpaceRelation:e}=await import("./utils-Bw01K5Nk.js").then(e=>e.bN);return{getCoupleSpaceRelation:e}},__vite__mapDeps([0,1,2])),t=e();if(!t||"pending"!==t.status&&"active"!==t.status){const{createCoupleSpaceInvite:e}=await Qt(async()=>{const{createCoupleSpaceInvite:e}=await import("./utils-Bw01K5Nk.js").then(e=>e.bN);return{createCoupleSpaceInvite:e}},__vite__mapDeps([0,1,2]));if(e("current_user",w,pa.name,pa.avatar)){const e=Date.now(),t={id:e,type:"received",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:e,messageType:"couple_space_invite",coupleSpaceInvite:{inviterId:pa.id,inviterName:pa.name,status:"pending"},blocked:O};Pt=[...Pt,t],Ka(Pt),fe.current++}}else{const e=Date.now(),t={id:e,type:"system",content:"对方已经建立情侣空间，无法邀请",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:e,messageType:"system",isHidden:!1};Pt=[...Pt,t],Ka(Pt)}}if(w&&pa&&(Ct||It||Mt)){const{hasActiveCoupleSpace:e}=await Qt(async()=>{const{hasActiveCoupleSpace:e}=await import("./utils-Bw01K5Nk.js").then(e=>e.bN);return{hasActiveCoupleSpace:e}},__vite__mapDeps([0,1,2]));if(e(w)){const{addCouplePhoto:e,addCoupleMessage:t,addCoupleAnniversary:s}=await Qt(async()=>{const{addCouplePhoto:e,addCoupleMessage:t,addCoupleAnniversary:s}=await import("./utils-Bw01K5Nk.js").then(e=>e.bI);return{addCouplePhoto:e,addCoupleMessage:t,addCoupleAnniversary:s}},__vite__mapDeps([0,1,2]));if(Ct)try{e(pa.id,pa.name,Ct);const t={id:Date.now()+Math.random(),type:"system",content:`在情侣空间相册中添加了照片：${Ct}`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"system",isHidden:!1};$(e=>[...e,t])}catch(x){}if(It)try{t(pa.id,pa.name,It);const e={id:Date.now()+Math.random(),type:"system",content:`在情侣空间留言：${It}`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"system",isHidden:!1};$(t=>[...t,e])}catch(x){}if(Mt)try{s(pa.id,pa.name,Mt.date,Mt.title,Mt.description);const e={id:Date.now()+Math.random(),type:"system",content:`在情侣空间添加了纪念日：${Mt.title}（${Mt.date}）`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"system",isHidden:!1};$(t=>[...t,e])}catch(x){}}}if((()=>{try{const t=parseInt(localStorage.getItem(`memory_summary_interval_${w}`)||"30"),s=Math.floor(Pt.filter(e=>"sent"===e.type||"received"===e.type).length/2);if(s%t===0&&s>0){const a=e.filter(e=>"sent"===e.type).slice(-t),r=Pt.filter(e=>"received"===e.type).slice(-t);if(a.length>0&&r.length>0){const l=a.map(t=>{if("image"===t.messageType&&t.imageUrl){const s=e.findIndex(e=>e.id===t.id);if(-1!==s&&s+1<e.length){const t=e[s+1];if(t&&"received"===t.type)return`用户发送了图片，图片相关内容：${t.content}`}return"用户发送了图片"}return t.content||t.emojiDescription||t.photoDescription||t.voiceText||""}).join("\n"),n=r.map(e=>e.content||e.emojiDescription||e.photoDescription||e.voiceText||"").join("\n");I.extractMemories(l,n).then(e=>{if(e.summary&&w)try{const a=localStorage.getItem(`memory_summary_${w}`)||"",r=a+(a?"\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n":"")+`【第 ${Math.ceil(s/t)} 次总结 - 第 ${s-t+1}-${s} 轮对话】\n\n${e.summary}`;localStorage.setItem(`memory_summary_${w}`,r)}catch(x){}}).catch(e=>{})}}}catch(x){}})(),Dt&&w&&pa){const e=w,t=pa.name,s=pa.description||"",a=[...Pt];setTimeout(async()=>{try{const{generateDiary:r,saveDiary:l,getDiaries:n}=await Qt(async()=>{const{generateDiary:e,saveDiary:t,getDiaries:s}=await import("./utils-Bw01K5Nk.js").then(e=>e.bL);return{generateDiary:e,saveDiary:t,getDiaries:s}},__vite__mapDeps([0,1,2])),i=n(e).slice(0,3),c={mood:"",weather:""},o=await r(e,t,s,a,c,i);if(o){l(e,o);o.content.length>50?o.content.substring(0,50):o.content;const s=(new Date).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}),a=o.content.replace(/\[照片:.*?\]/g,"").trim().substring(0,15)+(o.content.length>15?"...":""),r={id:Date.now()+Math.random(),type:"system",content:`📔 ${t}在日记本写了一篇日记：${a}（${s}）`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"system",isHidden:!1};$(e=>[...e,r]);const n=localStorage.getItem(`chat_messages_${e}`),i=n?JSON.parse(n):[];i.push(r),localStorage.setItem(`chat_messages_${e}`,JSON.stringify(i))}}catch(x){}},1e3)}if(Lt||At){let e;if(await new Promise(e=>setTimeout(e,500)),At){const t=Pt.findIndex(e=>e.id===At&&"received"===e.type);-1!==t&&(e={msg:Pt[t],idx:t})}else e=Pt.map((e,t)=>({msg:e,idx:t})).reverse().find(({msg:e})=>"received"===e.type&&"system"!==e.messageType);if(e){const{msg:t,idx:s}=e;!t.redEnvelopeId&&!t.transfer&&!t.intimatePay&&(Pt[s]={...t,isRecalled:!0,recalledContent:t.content||t.emojiDescription||t.photoDescription||t.voiceText||"特殊消息",originalType:t.type,content:`${(null==pa?void 0:pa.name)||"AI"}撤回了一条消息`,type:"system",messageType:"system"},Ka([...Pt]))}}}catch(x){let t=x.message||"AI调用失败，请在设置中检查API配置";(null==(d=x.message)?void 0:d.includes("500"))&&(t="API调用失败 (500) - 可能是消息历史过长导致\n建议：清理部分聊天记录或稍后重试");const s={id:e.length+1,type:"received",content:`[错误] ${t}`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})};Ka([...e,s])}finally{if(A(!1),w){if(de(w),be.current){if(!pe.current&&fe.current>0){xe(w,fe.current);const e=z.filter(e=>"received"===e.type).pop();e&&pa&&(me(w,e.content,e.timestamp),he(pa.name,pa.avatar,e.content,w))}}else{const e=localStorage.getItem(`chat_messages_${w}`);if(e)try{const t=JSON.parse(e);if(localStorage.setItem(`chat_messages_${w}`,JSON.stringify(t)),fe.current>0){xe(w,fe.current);const e=t.filter(e=>"received"===e.type).pop();e&&pa&&(me(w,e.content,e.timestamp),he(pa.name,pa.avatar,e.content,w))}}catch(m){}}fe.current=0}}};return e.jsxs("div",{className:"h-screen flex flex-col relative overflow-hidden",children:[ta&&e.jsx("div",{className:"fixed top-0 left-0 right-0 z-[60] bg-white border-b border-gray-200 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsx("button",{onClick:()=>{sa(!1),ra(new Set)},className:"text-sm text-gray-600 active:opacity-60",children:"取消"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["已选择 ",aa.size," 条"]}),e.jsx("button",{onClick:()=>{if(0!==aa.size){if(confirm(`确定要永久删除选中的 ${aa.size} 条消息吗？\n\n⚠️ 此操作无法撤销！`)){const e=z.filter(e=>!aa.has(e.id));Ka(e),w&&localStorage.setItem(`chat_messages_${w}`,JSON.stringify(e)),sa(!1),ra(new Set)}}else alert("请先选择要删除的消息")},className:"text-sm text-red-600 font-medium active:opacity-60",disabled:0===aa.size,style:{opacity:0===aa.size?.4:1},children:"删除"})]})}),e.jsx("div",{className:"absolute inset-0 z-0",style:(()=>{let e=Me;return!e&&$e&&(e=Ie),e&&(e.startsWith("http")||e.startsWith("data:image"))?{backgroundImage:`url(${e})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"}:{background:"linear-gradient(to bottom, #f9fafb, #f3f4f6)"}})()}),e.jsxs("div",{className:"relative z-10 h-full flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-50 "+(Ae?"glass-dark":"glass-effect"),style:{marginTop:ta?"52px":"0"},children:[Ye&&e.jsx(xa,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>v(-1),className:"ios-button text-gray-700 hover:text-gray-900 -ml-2",children:e.jsx(ls,{size:24})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-base font-semibold text-gray-900",children:L?"正在输入...":(null==pa?void 0:pa.nickname)||(null==pa?void 0:pa.name)||"聊天"}),w&&(()=>{const t=k(w);return t.currentStreak>0?e.jsxs("button",{onClick:()=>v(`/streak/${w}`),className:"text-xs px-2 py-1 bg-orange-100 text-orange-600 rounded-lg font-medium flex items-center gap-1 hover:bg-orange-200 transition-colors",children:["🔥 ",t.currentStreak]}):null})()]}),e.jsxs("div",{className:"flex items-center gap-2",children:[je.total>0&&e.jsxs("button",{onClick:()=>Ne(!ye),className:"text-[10px] px-1.5 py-0.5 rounded-md flex items-center gap-1 ios-button",style:{backgroundColor:"rgba(59, 130, 246, 0.1)",color:"#3b82f6"},children:[e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:e.jsx("path",{d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),e.jsx("span",{className:"font-medium",children:J(je.total)}),we>0&&e.jsxs("span",{className:"text-[9px] opacity-70",children:["·",(we/1e3).toFixed(1),"s"]})]}),e.jsx("button",{onClick:()=>ca(!0),className:"ios-button p-1 hover:opacity-70 transition-all",title:"查看角色状态",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",className:"text-gray-700",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",strokeWidth:"2"}),e.jsx("path",{d:"M12 6v6l4 2",strokeWidth:"2",strokeLinecap:"round"})]})}),e.jsx("button",{onClick:()=>{localStorage.setItem("offline_chat_inherit",JSON.stringify({characterId:w,messages:z,timestamp:Date.now()})),v(`/offline-chat?character=${w}&inherit=true`)},className:"ios-button p-1 hover:opacity-70 transition-all",title:"切换到线下模式",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",className:"text-gray-700",children:[e.jsx("path",{d:"M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z",strokeWidth:"2"}),e.jsx("path",{d:"M9 22V12h6v10",strokeWidth:"2"})]})}),e.jsx("button",{onClick:()=>v(`/chat-settings/${w}`),className:"ios-button text-gray-700 hover:text-gray-900",children:e.jsx(ns,{size:24})})]})]})]}),ye&&je.total>0&&e.jsxs("div",{className:"glass-card mx-4 mt-2 p-3 rounded-xl transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-xs font-semibold text-gray-700",children:"本次请求统计"}),e.jsx("button",{onClick:()=>Ne(!1),className:"text-gray-400 hover:text-gray-600 ios-button",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"space-y-2 text-xs",children:[we>0&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"响应时间"}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[(we/1e3).toFixed(2)," 秒"]})]}),e.jsxs("div",{className:"pt-2 border-t border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1.5",children:[e.jsx("span",{className:"text-gray-600 font-medium",children:"本次 Token 使用"}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[je.total.toLocaleString()," tokens"]})]}),e.jsxs("div",{className:"flex justify-between text-[11px]",children:[e.jsx("span",{className:"text-gray-500",children:"系统提示"}),e.jsx("span",{className:"text-gray-700",children:je.systemPrompt.toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between text-[11px]",children:[e.jsx("span",{className:"text-gray-500",children:"世界书"}),e.jsx("span",{className:"text-gray-700",children:je.lorebook.toLocaleString()})]}),Ce.length>0&&e.jsx("div",{className:"ml-4 space-y-0.5 mt-1",children:Ce.map((t,s)=>e.jsxs("div",{className:"flex justify-between text-[10px]",children:[e.jsxs("span",{className:"text-gray-400 truncate max-w-[150px]",title:t.name,children:["· ",t.name]}),e.jsx("span",{className:"text-gray-500",children:t.tokens})]},s))}),e.jsxs("div",{className:"flex justify-between text-[11px]",children:[e.jsx("span",{className:"text-gray-500",children:"消息历史"}),e.jsx("span",{className:"text-gray-700",children:je.messages.toLocaleString()})]})]}),e.jsxs("div",{className:"pt-2 border-t border-gray-200",children:[e.jsxs("div",{className:"flex justify-between text-[11px]",children:[e.jsx("span",{className:"text-gray-500",children:"上下文限制"}),e.jsxs("span",{className:"text-gray-600",children:[(je.total+je.remaining).toLocaleString()," tokens"]})]}),e.jsxs("div",{className:"flex justify-between text-[11px]",children:[e.jsx("span",{className:"text-gray-500",children:"使用比例"}),e.jsxs("span",{className:"text-gray-600",children:[je.percentage.toFixed(2),"%"]})]})]})]})]}),e.jsx("div",{ref:es,className:"flex-1 overflow-y-auto hide-scrollbar px-4 py-4",children:0===z.length?e.jsx("div",{className:"empty-state",children:e.jsx("p",{className:"text-gray-400 text-base",children:"开始聊天吧"})}):e.jsxs(e.Fragment,{children:[Gt<z.length&&e.jsx("div",{className:"text-center py-2 text-xs text-gray-400",children:Kt?"加载中...":"向上滑动加载更多"}),z.slice(-Gt).map((t,s,a)=>{const r=z.length-Gt+s,l=r>0?z[r-1]:null,n=(i=t,!!((c=l)&&i.timestamp&&c.timestamp)&&i.timestamp-c.timestamp>3e5);var i,c;if(t.isHidden)return null;if("system"===t.type){if(t.isCallRecord){const s=la===t.id;return e.jsxs("div",{children:[n&&t.timestamp&&e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"bg-gray-200/60 px-3 py-1 rounded-full",children:e.jsx("span",{className:"text-xs text-gray-500",children:mt(t.timestamp)})})}),e.jsx("div",{className:"flex justify-center mb-3",children:e.jsx("div",{className:"w-[85%] max-w-xs",children:e.jsxs("div",{className:"glass-card rounded-xl p-3 cursor-pointer hover:shadow-lg transition-all",onClick:()=>na(s?null:t.id),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-700",children:t.content}),e.jsx("div",{className:"text-[10px] text-gray-400 mt-0.5",children:s?"点击收起":"点击查看详情"})]})}),e.jsx("div",{className:"text-gray-400 text-xs",children:s?"▲":"▼"})]}),s&&t.callMessages&&t.callMessages.length>0&&e.jsx("div",{className:"mt-2 pt-2 border-t border-gray-200/50",children:e.jsx("div",{className:"space-y-1.5 max-h-64 overflow-y-auto",children:t.callMessages.map((t,s)=>{if("narrator"===t.type)return e.jsx("div",{className:"text-center",children:e.jsx("span",{className:"text-[10px] text-gray-400 italic",children:t.content})},s);{const a="user"===t.type;return e.jsx("div",{className:"flex "+(a?"justify-end":"justify-start"),children:e.jsx("div",{className:"max-w-[75%] px-1.5 py-0.5 rounded-md text-[10px] "+(a?"bg-green-500 text-white":"glass-light text-gray-800"),children:t.content})},s)}})})})]})})})]},t.id)}return"live_stream"===t.messageType&&t.liveStreamData?e.jsx("div",{className:"flex justify-center mb-4",children:e.jsxs("div",{className:"glass-card rounded-2xl p-4 shadow-lg w-[260px] cursor-pointer hover:scale-105 transition-transform",onClick:()=>v(`/live-room/${t.liveStreamData.liveStreamId}`),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-red-500 to-pink-500 flex items-center justify-center",children:e.jsx("svg",{className:"w-7 h-7 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-900 font-medium",children:"直播中"}),e.jsx("span",{className:"px-2 py-0.5 bg-red-500 text-white text-xs rounded-full animate-pulse",children:"LIVE"})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[(null==pa?void 0:pa.name)||"AI"," 开始了直播"]})]})]}),e.jsx("div",{className:"border-t border-gray-200 pt-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})}),e.jsx("span",{children:(()=>{const e={"新人":[30,80],"小有名气":[100,300],"知名主播":[500,1e3],"顶流":[2e3,5e3]}[t.liveStreamData.popularityLevel]||[100,300];return`${Math.floor(Math.random()*(e[1]-e[0])+e[0])}人在线`})()})]}),e.jsx("span",{className:"px-3 py-1 bg-gradient-to-r from-red-500 to-pink-500 text-white text-xs font-medium rounded-full",children:"进入直播间"})]})})]})},t.id):e.jsxs("div",{children:[n&&t.timestamp&&e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"bg-gray-200/60 px-3 py-1 rounded-full",children:e.jsx("span",{className:"text-xs text-gray-500",children:mt(t.timestamp)})})}),e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"bg-gray-200/80 px-3 py-1.5 rounded-md "+(t.isRecalled||t.avatarPrompt?"cursor-pointer hover:bg-gray-300/80 transition-colors":""),onClick:()=>{if(t.isRecalled&&t.recalledContent)qs(t);else if(t.avatarPrompt){const e={"portrait avatar of":"头像：","centered composition":"居中构图","profile picture style":"头像风格","high quality":"高质量",detailed:"精细","professional digital art":"专业数字艺术",cute:"可爱的",cat:"猫",dog:"狗",girl:"女孩",boy:"男孩",anime:"动漫",realistic:"真实的",photo:"照片","pink hair":"粉色头发","mother and child":"母子",baby:"宝宝",robot:"机器人",cool:"酷的",elegant:"优雅的"};let s=t.avatarPrompt;for(const[t,a]of Object.entries(e))s=s.replace(new RegExp(t,"gi"),a);alert(`AI使用的提示词：\n\n原文：\n${t.avatarPrompt}\n\n中文翻译：\n${s}`)}},children:e.jsx("span",{className:"text-xs text-gray-600",children:t.content})})})]},t.id)}return t.narrations&&t.narrations.length>0&&!t.content&&!t.messageType?e.jsxs("div",{children:[n&&t.timestamp&&e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"bg-gray-200/60 px-3 py-1 rounded-full",children:e.jsx("span",{className:"text-xs text-gray-500",children:mt(t.timestamp)})})}),e.jsx("div",{className:"mb-4",children:t.narrations.map((t,s)=>e.jsx("div",{className:"text-center text-xs text-gray-500 italic mb-2",children:t.content},s))})]},t.id):e.jsxs("div",{children:[n&&t.timestamp&&e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"bg-gray-200/60 px-3 py-1 rounded-full",children:e.jsx("span",{className:"text-xs text-gray-500",children:mt(t.timestamp)})})}),e.jsxs("div",{className:"mb-4",children:[t.narrations&&t.narrations.length>0&&e.jsx("div",{className:"mb-2",children:t.narrations.map((t,s)=>e.jsx("div",{className:"text-center text-xs text-gray-500 italic mb-1",children:t.content},s))}),e.jsxs("div",{className:"flex message-container "+("sent"===t.type?"justify-end sent":"justify-start received"),children:[ta&&"system"!==t.type&&e.jsx("div",{className:"flex items-center mr-2",children:e.jsx("input",{type:"checkbox",checked:aa.has(t.id),onChange:()=>{return e=t.id,void ra(t=>{const s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s});var e},className:"w-5 h-5 rounded border-2 border-gray-300 text-red-600 focus:ring-red-500",onClick:e=>e.stopPropagation()})}),"received"===t.type&&e.jsxs("div",{className:"flex flex-col items-center gap-0.5 mr-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-gray-200 flex items-center justify-center flex-shrink-0 shadow-md overflow-hidden",children:ba?e.jsx("img",{src:fa,alt:"角色头像",className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-lg",children:fa||"🤖"})}),e.jsx("span",{className:"text-[9px] text-gray-400",children:t.time})]}),e.jsxs("div",{className:"flex items-center gap-1",children:["sent"===t.type&&(()=>{if(!w||!t.timestamp)return null;if(V.getBlockStatus("user",w).blockedByTarget){const s=V.getBlockTimestamp(w,"user");if(s&&t.timestamp>s)return e.jsx("svg",{className:"w-5 h-5 text-red-500 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}return null})(),e.jsx("div",{onTouchStart:e=>Ga(t,e),onTouchEnd:qa,onMouseDown:e=>Ga(t,e),onMouseUp:qa,onMouseLeave:qa,children:"redenvelope"===t.messageType&&t.redEnvelopeId?(()=>{const s=st(w,t.redEnvelopeId);return s?e.jsx($a,{redEnvelope:s,onClick:()=>(e=>{if(!w)return;const t=st(w,e);if(!t)return;const s="ai"===t.sender&&"pending"===t.status&&!m(t);bt(t),vt(s),pt(!0)})(t.redEnvelopeId),coverImage:Je,iconImage:Ge}):null})():"photo"===t.messageType&&t.photoDescription?e.jsx(Fa,{description:t.photoDescription,messageId:t.id}):"voice"===t.messageType&&t.voiceText?e.jsxs("div",{className:"flex flex-col gap-2",style:{width:"160px"},children:[e.jsx("div",{className:"message-bubble",style:{backgroundColor:"sent"===t.type?Ee:Fe,borderRadius:"16px",padding:"12px",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",width:"160px",transition:"all 0.2s",border:"sent"===t.type?"none":"1px solid #e5e7eb"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{className:"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 transition-all "+("sent"===t.type?"bg-white/20 hover:bg-white/30":"bg-green-500 hover:bg-green-600"),onClick:e=>{e.stopPropagation();const s=Math.min(Math.max(Math.ceil((t.voiceText||"").length/5),1),60);((e,t)=>{bs===e?js(null):(js(e),setTimeout(()=>{js(null)},1e3*t))})(t.id,s)},children:bs===t.id?e.jsx("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M6 4h4v16H6V4zm8 0h4v16h-4V4z"})}):e.jsx("svg",{className:"w-4 h-4 text-white ml-0.5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M8 5v14l11-7z"})})}),e.jsx("div",{className:"flex items-center gap-0.5 flex-1 cursor-pointer",onClick:()=>fs(e=>({...e,[t.id]:!e[t.id]})),children:[40,60,80,60,40,70,50,90,60,40,80,50,70].map((s,a)=>e.jsx("div",{className:`w-0.5 rounded-full transition-all ${"sent"===t.type?"bg-white/60":"bg-gray-400"} ${bs===t.id?"animate-pulse":""}`,style:{height:bs===t.id?100*Math.random()+"%":`${s}%`,maxHeight:"16px",minHeight:"4px",animationDelay:.1*a+"s"}},a))}),e.jsxs("div",{className:"text-xs font-medium "+("sent"===t.type?"text-white":"text-gray-600"),children:[Math.min(Math.max(Math.ceil((t.voiceText||"").length/5),1),60),'"']})]})}),ps[t.id]&&e.jsxs("div",{className:"px-3 py-2 rounded-xl text-sm "+("sent"===t.type?"bg-white/10 text-gray-700":"bg-gray-100 text-gray-700"),style:{width:"160px",wordWrap:"break-word",overflowWrap:"break-word"},children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"转文字："}),t.voiceText]})]}):"location"===t.messageType&&t.location?e.jsxs("div",{className:"glass-card rounded-2xl overflow-hidden shadow-lg w-[220px] cursor-pointer hover:shadow-xl transition-shadow",onClick:()=>(e=>{_s(e)})(t),children:[e.jsxs("div",{className:"h-24 bg-gradient-to-br from-blue-100 to-green-100 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-20",children:e.jsx("div",{className:"grid grid-cols-8 grid-rows-8 h-full w-full",children:Array.from({length:64}).map((t,s)=>e.jsx("div",{className:"border border-gray-300"},s))})}),e.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2",children:e.jsx("svg",{className:"w-7 h-7 text-red-500 drop-shadow-lg",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"})})})]}),e.jsx("div",{className:"p-2.5 h-[66px] bg-white/90 backdrop-blur-sm",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("svg",{className:"w-4 h-4 text-green-600 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 text-sm truncate",children:t.location.name}),e.jsx("div",{className:"text-xs text-gray-500 mt-1 line-clamp-2",children:t.location.address})]})]})})]}):"emoji"===t.messageType&&t.emojiUrl?e.jsx("div",{className:"rounded-2xl overflow-hidden shadow-lg max-w-[120px]",children:e.jsx("img",{src:t.emojiUrl,alt:t.emojiDescription||"表情包",className:"w-full h-auto"})}):"xiaohongshu"===t.messageType&&t.xiaohongshuNote?e.jsx(La,{note:t.xiaohongshuNote,onClick:()=>{window.open(t.xiaohongshuNote.url,"_blank")}}):"image"===t.messageType&&t.imageUrl?e.jsx("div",{className:"rounded-2xl overflow-hidden shadow-lg max-w-[180px]",children:e.jsx("img",{src:t.imageUrl,alt:"上传的图片",className:"w-full h-auto cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>{const e=window.open("","_blank");e&&e.document.write(`<img src="${t.imageUrl}" style="max-width:100%;max-height:100vh;margin:auto;display:block;">`)}})}):"musicShare"===t.messageType&&t.musicShare?e.jsx("div",{style:{maxWidth:"280px",display:"inline-block"},children:e.jsx(ya,{songTitle:t.musicShare.songTitle,songArtist:t.musicShare.songArtist,songCover:t.musicShare.songCover,onClick:()=>{ge({songTitle:t.musicShare.songTitle,songArtist:t.musicShare.songArtist,songCover:t.musicShare.songCover}),O(!0)}})}):"musicInvite"===t.messageType&&t.musicInvite?e.jsx("div",{style:{maxWidth:"280px",display:"inline-block"},children:e.jsx(ja,{inviterName:t.musicInvite.inviterName,songTitle:t.musicInvite.songTitle,songArtist:t.musicInvite.songArtist,songCover:t.musicInvite.songCover,status:t.musicInvite.status,onAccept:()=>{$(e=>e.map(e=>e.id===t.id?{...e,musicInvite:{...e.musicInvite,status:"accepted"}}:e)),setTimeout(()=>{const e=z.map(e=>e.id===t.id?{...e,musicInvite:{...e.musicInvite,status:"accepted"}}:e);R(`chat_${w}`,JSON.stringify(e))},100),v("/music-together-chat",{state:{song:{title:t.musicInvite.songTitle,artist:t.musicInvite.songArtist,cover:t.musicInvite.songCover},characterId:w,characterName:(null==pa?void 0:pa.name)||"好友",characterAvatar:null==pa?void 0:pa.avatar}})},onReject:()=>{$(e=>e.map(e=>e.id===t.id?{...e,musicInvite:{...e.musicInvite,status:"rejected"}}:e)),setTimeout(()=>{const e=z.map(e=>e.id===t.id?{...e,musicInvite:{...e.musicInvite,status:"rejected"}}:e);R(`chat_${w}`,JSON.stringify(e))},100)}})}):"transfer"===t.messageType&&t.transfer?e.jsxs("div",{className:"message-bubble glass-card rounded-2xl shadow-lg min-w-[200px]",style:{position:"relative",overflow:"hidden"},children:[Ke&&e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundImage:`url(${Ke})`,backgroundSize:"cover",backgroundPosition:"center",zIndex:0}}),e.jsxs("div",{style:{position:"relative",zIndex:1,padding:"16px"},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-500 rounded-full flex items-center justify-center text-white text-xl font-bold overflow-hidden",style:{backgroundImage:Ze?`url(${Ze})`:"none",backgroundSize:"cover",backgroundPosition:"center"},children:!Ze&&"¥"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm text-gray-900 font-medium",children:"转账"}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:t.transfer.message&&t.transfer.message.trim()?t.transfer.message:"pending"===t.transfer.status?"sent"===t.type?"你发起了一笔转账":"对方发起了一笔转账":"received"===t.transfer.status?"已接收":"expired"===t.transfer.status?"已退还":"转账"})]})]}),e.jsx("div",{className:"border-t border-gray-200 pt-3",children:"received"===t.type&&"pending"===t.transfer.status?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("span",{className:"text-2xl font-semibold text-gray-900",children:["¥",t.transfer.amount.toFixed(2)]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{return e=t.id,void $(t=>[...t.map(t=>t.id===e&&"transfer"===t.messageType&&"received"===t.type?{...t,transfer:{...t.transfer,status:"expired"}}:t),{id:Date.now(),type:"system",content:"你已退还转账",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),messageType:"system"}]);var e},className:"flex-1 px-4 py-2 bg-gray-100 text-gray-700 text-sm rounded-full ios-button",children:"退还"}),e.jsx("button",{onClick:()=>{return e=t.id,void $(t=>{var s;const a=t.map(t=>t.id===e&&"transfer"===t.messageType&&"received"===t.type?(t.transfer&&H(t.transfer.amount,(null==pa?void 0:pa.name)||"好友",t.transfer.message),{...t,transfer:{...t.transfer,status:"received"}}):t),r=t.find(t=>t.id===e),l=(null==(s=null==r?void 0:r.transfer)?void 0:s.amount)||0;return[...a,{id:Date.now(),type:"system",content:`你已收款，已存入零钱 ¥${l.toFixed(2)}`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),messageType:"system"}]});var e},className:"flex-1 px-4 py-2 bg-primary text-white text-sm rounded-full ios-button",children:"领取"})]})]}):e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-2xl font-semibold text-gray-900",children:["¥",t.transfer.amount.toFixed(2)]}),"received"===t.transfer.status&&e.jsx("span",{className:"text-xs text-gray-400",children:"sent"===t.type?"已收款":"你已收款"}),"expired"===t.transfer.status&&e.jsx("span",{className:"text-xs text-gray-400",children:"sent"===t.type?"已退还":"你已退还"})]})})]})]}):"couple_space_invite"===t.messageType&&t.coupleSpaceInvite?e.jsxs("div",{className:"glass-card rounded-2xl p-4 shadow-lg min-w-[200px]",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-pink-400 to-rose-400 flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm text-gray-900 font-medium",children:"情侣空间"}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:"邀请你加入情侣空间"})]})]}),e.jsx("div",{className:"border-t border-gray-200 pt-3",children:"pending"===t.coupleSpaceInvite.status?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-3 leading-relaxed",children:"开启专属情侣空间，分享你们的美好时光"}),"received"===t.type?e.jsx("button",{onClick:async()=>{if($(e=>e.map(e=>e.id===t.id&&e.coupleSpaceInvite?{...e,coupleSpaceInvite:{...e.coupleSpaceInvite,status:"accepted"}}:e)),w){const{acceptCoupleSpaceInvite:e}=await Qt(async()=>{const{acceptCoupleSpaceInvite:e}=await import("./utils-Bw01K5Nk.js").then(e=>e.bN);return{acceptCoupleSpaceInvite:e}},__vite__mapDeps([0,1,2]));e(w)&&alert("已接受情侣空间邀请！现在可以去情侣空间查看了")}},className:"w-full px-4 py-2 bg-gradient-to-r from-pink-400 to-rose-400 text-white text-sm rounded-full ios-button",children:"接受邀请"}):"sent"===t.type?e.jsx("div",{className:"text-center",children:e.jsx("span",{className:"text-xs text-gray-400",children:"等待对方回应"})}):e.jsx("div",{className:"text-xs text-gray-500 text-center",children:"等待对方接受"})]}):e.jsx("div",{className:"text-center",children:e.jsx("span",{className:"text-xs text-gray-400",children:"accepted"===t.coupleSpaceInvite.status?"sent"===t.type?"对方已接受":"你已接受":"sent"===t.type?"对方已拒绝":"你已拒绝"})})})]}):"intimate_pay"===t.messageType&&t.intimatePay?e.jsxs("div",{className:"glass-card rounded-2xl p-4 shadow-lg min-w-[200px]",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center overflow-hidden",children:e.jsx("img",{src:Ba,alt:"亲密付",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm text-gray-900 font-medium",children:"亲密付"}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:"为你开通亲密付"})]})]}),e.jsx("div",{className:"border-t border-gray-200 pt-3",children:"pending"===t.intimatePay.status?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"每月额度"}),e.jsxs("div",{className:"text-2xl font-semibold text-gray-900",children:["¥",t.intimatePay.monthlyLimit.toFixed(2)]})]}),"received"===t.type?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-gray-500 mb-3 leading-relaxed",children:["接受后，你每月可使用对方的零钱进行消费，最高额度 ¥",t.intimatePay.monthlyLimit.toFixed(2)]}),e.jsx("button",{onClick:()=>v(`/intimate-pay/receive/${t.intimatePay.characterId}/${t.intimatePay.monthlyLimit}`,{replace:!0}),className:"w-full px-4 py-2 bg-gradient-to-r from-pink-400 to-red-400 text-white text-sm rounded-full ios-button",children:"接受亲密付"})]}):e.jsx("div",{className:"text-xs text-gray-500 text-center",children:"等待对方接受"})]}):e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-semibold text-gray-900 mb-1",children:["¥",t.intimatePay.monthlyLimit.toFixed(2)]}),e.jsx("span",{className:"text-xs text-gray-400",children:"accepted"===t.intimatePay.status?"sent"===t.type?"对方已接受":"你已接受":"sent"===t.type?"对方已拒绝":"你已拒绝"})]})})]}):e.jsx("div",{style:{maxWidth:"280px",display:"inline-block",wordBreak:"break-word"},children:t.content&&e.jsx("div",{className:"message-bubble px-3 py-2",style:{backgroundColor:"sent"===t.type?Ee:t.content.startsWith("[错误]")?"#fee2e2":Fe,borderRadius:"12px",boxShadow:"0 1px 4px rgba(0,0,0,0.08)",wordBreak:"break-word",whiteSpace:"pre-wrap",color:t.content.startsWith("[错误]")?"#991b1b":"#111827",fontSize:"14px",maxWidth:"100%",overflowWrap:"break-word"},children:e.jsxs("div",{style:{position:"relative",zIndex:2},children:[t.quotedMessage&&e.jsxs("div",{className:"mb-2 px-2.5 py-1.5 rounded cursor-pointer transition-colors",style:{background:"rgba(0, 0, 0, 0.05)",fontSize:"12px",color:"#666"},children:[e.jsx("div",{className:"font-semibold mb-0.5",style:{color:"#1677ff"},children:t.quotedMessage.senderName}),e.jsx("div",{className:"overflow-hidden text-ellipsis whitespace-nowrap",children:t.quotedMessage.content})]}),e.jsx("div",{style:{position:"relative",zIndex:2},children:/<[a-z][\s\S]*>/i.test(t.content)?e.jsx(Oa,{content:t.content}):e.jsx("span",{children:t.content})})]})})})}),"received"===t.type&&(()=>{if(!w)return null;if(V.getBlockStatus("user",w).blockedByMe){const s=V.getBlockTimestamp("user",w);if(s){if(!t.timestamp)return e.jsx("svg",{className:"w-5 h-5 text-red-500 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})});if(t.timestamp>s)return e.jsx("svg",{className:"w-5 h-5 text-red-500 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}}return null})()]}),"sent"===t.type&&e.jsxs("div",{className:"flex flex-col items-center gap-0.5 ml-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-gray-200 flex items-center justify-center flex-shrink-0 shadow-md overflow-hidden",children:ka?e.jsx("img",{src:wa,alt:"我的头像",className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-lg",children:"👤"})}),e.jsx("span",{className:"text-[9px] text-gray-400",children:t.time})]})]})]})]},t.id)}),L&&e.jsxs("div",{className:"flex mb-3 justify-start",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-gray-200 flex items-center justify-center flex-shrink-0 mr-2 shadow-md overflow-hidden",children:ba?e.jsx("img",{src:fa,alt:"角色头像",className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-lg",children:fa||"🤖"})}),e.jsx("div",{className:"glass-card px-3 py-2 rounded-xl rounded-tl-sm shadow-md",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})]}),e.jsx("div",{ref:it})]})}),e.jsxs("div",{className:"border-t border-gray-200/50 "+(Ae?"glass-dark":"glass-effect"),children:[Js&&e.jsx("div",{className:"px-3 pt-2 pb-1",children:e.jsxs("div",{className:"bg-gray-100 rounded-xl p-2 flex items-start gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs font-medium text-gray-700 mb-0.5",children:"sent"===Js.type?"我":(null==pa?void 0:pa.name)||"AI"}),e.jsx("div",{className:"text-xs text-gray-600 truncate",children:Js.content||Js.emojiDescription||Js.photoDescription||Js.voiceText||"特殊消息"})]}),e.jsx("button",{onClick:()=>Hs(null),className:"flex-shrink-0 w-5 h-5 flex items-center justify-center text-gray-400 hover:text-gray-600 ios-button",children:"×"})]})}),oa&&e.jsxs("div",{className:"px-3 pt-2 pb-1 bg-blue-50 border-t border-blue-200",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx("span",{className:"text-xs font-medium text-blue-600",children:"✏️ 编辑消息"})}),e.jsxs("div",{className:"bg-white rounded-xl p-2 flex items-start gap-2",children:[e.jsx("textarea",{value:ma,onChange:e=>ha(e.target.value),className:"flex-1 min-w-0 bg-transparent border-none outline-none text-sm text-gray-900 resize-none",rows:2,autoFocus:!0}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("button",{onClick:()=>{if(oa&&ma.trim()){const e=z.map(e=>e.id===oa.id?{...e,content:ma.trim()}:e);Ka(e),w&&localStorage.setItem(`chat_messages_${w}`,JSON.stringify(e)),da(null),ha("")}},className:"px-3 py-1 bg-blue-600 text-white text-xs rounded-lg hover:bg-blue-700 active:opacity-60",children:"保存"}),e.jsx("button",{onClick:()=>{da(null),ha("")},className:"px-3 py-1 bg-gray-200 text-gray-700 text-xs rounded-lg hover:bg-gray-300 active:opacity-60",children:"取消"})]})]})]}),e.jsxs("div",{className:"px-3 py-3 flex items-center gap-2",children:[e.jsx("button",{onClick:()=>E(!B),className:"w-10 h-10 flex items-center justify-center ios-button text-gray-700",children:e.jsx(ws,{size:26})}),e.jsx("div",{className:"flex-1 flex items-center bg-white/90 rounded-full px-4 py-2 shadow-inner",children:e.jsx("input",{type:"text",value:_,onChange:e=>M(e.target.value),onKeyPress:e=>"Enter"===e.key&&Wa(),placeholder:"发送消息",className:"flex-1 bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})}),e.jsx("button",{onClick:()=>Yt(!0),className:"w-10 h-10 flex items-center justify-center ios-button text-gray-700",children:e.jsx(os,{size:22})}),Va?e.jsx("button",{onClick:Wa,disabled:L,className:"w-10 h-10 flex items-center justify-center ios-button bg-wechat-green text-white rounded-full shadow-lg disabled:opacity-50 transition-all duration-200",children:e.jsx(is,{size:18})}):e.jsx("button",{onClick:async()=>{L||(w&&q(w),await Xa(z))},disabled:L,className:"w-10 h-10 flex items-center justify-center ios-button text-gray-700 disabled:opacity-50 transition-all duration-200",children:e.jsx(is,{size:22})})]}),!B&&e.jsx("div",{className:"flex justify-center pb-2",children:e.jsx("div",{className:"w-32 h-1 bg-gray-900 rounded-full opacity-40"})})]}),B&&e.jsx(Ia,{onClose:()=>{E(!1)},onSelectImage:async()=>{const e=document.createElement("input");e.type="file",e.accept="image/*",e.multiple=!0,e.addEventListener("change",async e=>{const t=e.target.files;if(t&&0!==t.length)try{const{compressImage:e,isValidImageSize:s}=await Qt(async()=>{const{compressImage:e,isValidImageSize:t}=await import("./utils-Bw01K5Nk.js").then(e=>e.bO);return{compressImage:e,isValidImageSize:t}},__vite__mapDeps([0,1,2])),a=[];for(let r=0;r<t.length;r++){const l=t[r];if(!l.type.startsWith("image/"))continue;if(!s(l,10)){alert(`图片 ${l.name} 大小超过10MB，已跳过`);continue}const n=await e(l,1024,1024,.8),i={id:Date.now()+r,type:"sent",content:t.length>1?`发送了图片 (${r+1}/${t.length})`:"发送了一张图片",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now()+r,messageType:"image",imageUrl:n};a.push(i)}a.length>0&&$(e=>[...e,...a])}catch(s){alert("图片处理失败，请重试")}}),e.click(),E(!1)},onSelectCamera:()=>{E(!1),cs(!0)},onSelectRedPacket:()=>{E(!1),ut(!0)},onSelectTransfer:()=>{E(!1),Nt(!0)},onSelectIntimatePay:()=>{E(!1),kt(!0)},onSelectCoupleSpaceInvite:()=>{E(!1),St(!0)},onSelectCoupleSpaceContent:()=>{E(!1),_t(!0)},onSelectLocation:()=>{E(!1),ys(!0)},onSelectVoiceMessage:()=>{E(!1),hs(!0)},onSelectXiaohongshu:()=>{E(!1),zs(!0)},onSelectMusicInvite:()=>{E(!1),Ht(!0)},onSelectVoiceCall:()=>{E(!1),pa&&As({id:pa.id,name:pa.name,avatar:pa.avatar,profile:pa.description,relationship:pa.relationship,favorability:pa.favorability},!1)},onSelectVideoCall:()=>{E(!1),pa&&As({id:pa.id,name:pa.name,avatar:pa.avatar,profile:pa.description,relationship:pa.relationship,favorability:pa.favorability},!0)},onRegenerateAI:()=>{E(!1);const e=z.slice().reverse().find(e=>"received"===e.type);e&&(async e=>{if(L)return;const t=z.findIndex(t=>t.id===e);if(-1===t)return;let s=t;for(let r=t-1;r>=0;r--){if("sent"===z[r].type){s=r+1;break}0===r&&(s=0)}const a=z.slice(0,s);$(a),setTimeout(async()=>{await Xa(a)},100)})(e.id)},hasCoupleSpace:$t}),e.jsx(Ma,{show:ht,onClose:()=>ut(!1),onSend:(e,t,s)=>{if(!w)return;if(s){if(!K(w,e,`红包：${t}`))return void alert("亲密付额度不足")}else{if(T()<e)return void alert("零钱余额不足，请先充值");if(!X(e,(null==pa?void 0:pa.name)||"好友",t))return void alert("发送失败，余额不足")}const a={id:f(),amount:e,blessing:t,status:"pending",sender:"user",createdAt:Date.now(),claimedBy:null,claimedAt:null};at(w,a);const r=Date.now(),l={id:r,type:"sent",content:`[红包]${t}`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:r,messageType:"redenvelope",redEnvelopeId:a.id};$(e=>[...e,l]),ut(!1)},characterId:w,characterName:null==pa?void 0:pa.name}),e.jsx(za,{show:gt,redEnvelope:ft,canClaim:jt,onClose:()=>pt(!1),onClaim:()=>{if(!w||!ft)return;Z(ft.amount,(null==pa?void 0:pa.name)||"好友",ft.blessing),rt(w,ft.id,{status:"claimed",claimedBy:"我",claimedAt:Date.now()});const e={id:Date.now(),type:"system",content:`你领取了对方的红包，已存入零钱 ¥${ft.amount.toFixed(2)}`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),messageType:"system"};$(t=>[...t,e]),pt(!1)}}),e.jsx(Da,{show:yt,onClose:()=>Nt(!1),onSend:(e,t,s)=>{if(!w)return;if(s){if(!K(w,e,`转账：${t}`))return void alert("亲密付额度不足")}else{if(T()<e)return void alert("零钱余额不足，请先充值");if(!Q(e,(null==pa?void 0:pa.name)||"好友",t))return void alert("转账失败，余额不足")}const a=Date.now(),r={id:a,type:"sent",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:a,messageType:"transfer",transfer:{amount:e,message:t,status:"pending"}};$(e=>[...e,r]),Nt(!1)},characterId:w,characterName:null==pa?void 0:pa.name}),wt&&e.jsx(Ea,{onSend:e=>{if(!w||!pa)return;const t=Date.now(),s={id:t,type:"sent",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:t,messageType:"intimate_pay",intimatePay:{monthlyLimit:e,characterId:pa.id,characterName:pa.name,status:"pending"}};$(e=>[...e,s]),kt(!1)},onCancel:()=>kt(!1)}),Ct&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm",onClick:()=>St(!1)}),e.jsxs("div",{className:"relative w-full max-w-sm glass-card rounded-3xl p-6 shadow-2xl border border-white/20",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-pink-400 to-rose-400 flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"邀请加入情侣空间"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["邀请 ",null==pa?void 0:pa.name," 加入专属情侣空间",e.jsx("br",{}),"共同记录美好时光"]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>St(!1),className:"flex-1 px-4 py-3 rounded-full glass-card border border-white/20 text-gray-900 font-medium ios-button",children:"取消"}),e.jsx("button",{onClick:async()=>{if(!w||!pa)return;const{createCoupleSpaceInvite:e}=await Qt(async()=>{const{createCoupleSpaceInvite:e}=await import("./utils-Bw01K5Nk.js").then(e=>e.bN);return{createCoupleSpaceInvite:e}},__vite__mapDeps([0,1,2]));if(!e("current_user",w,pa.name,pa.avatar))return alert("已有活跃的情侣空间"),void St(!1);const t=Date.now(),s={id:t,type:"sent",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:t,messageType:"couple_space_invite",coupleSpaceInvite:{inviterId:"current_user",inviterName:(null==C?void 0:C.name)||"用户",status:"pending"}};$(e=>[...e,s]),St(!1)},className:"flex-1 px-4 py-3 rounded-full bg-gradient-to-r from-pink-400 to-rose-400 text-white font-medium ios-button shadow-lg",children:"发送邀请"})]})]})]}),e.jsx(Pa,{show:Zt,onClose:()=>Yt(!1),onSelect:e=>{const t=Date.now(),s={id:t,type:"sent",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:t,messageType:"emoji",emojiUrl:e.url,emojiDescription:e.description};$(e=>[...e,s])}}),rs&&e.jsx(e.Fragment,{children:e.jsx("div",{onClick:()=>cs(!1),className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:e.jsxs("div",{onClick:e=>e.stopPropagation(),className:"glass-card rounded-3xl p-6 w-[90%] max-w-md shadow-2xl",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-4 text-center",children:"拍摄照片"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4 text-center",children:"输入图片描述，将生成一张白底黑字的图片"}),e.jsx("textarea",{value:ds,onChange:e=>xs(e.target.value),placeholder:"请输入图片描述...",className:"w-full h-32 px-4 py-3 border border-gray-300 rounded-2xl resize-none focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent",autoFocus:!0}),e.jsxs("div",{className:"text-right text-sm text-gray-500 mt-2",children:[ds.length," 字"]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>{cs(!1),xs("")},className:"flex-1 px-4 py-3 bg-gray-100 text-gray-700 rounded-full ios-button font-medium",children:"取消"}),e.jsx("button",{onClick:()=>{if(!ds.trim())return;const e=Date.now(),t={id:e,type:"sent",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:e,messageType:"photo",photoDescription:ds};$(e=>[...e,t]),cs(!1),xs("")},disabled:!ds.trim(),className:"flex-1 px-4 py-3 bg-primary text-white rounded-full ios-button font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:"发送照片"})]})]})})}),ms&&e.jsx(e.Fragment,{children:e.jsx("div",{onClick:()=>hs(!1),className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:e.jsxs("div",{onClick:e=>e.stopPropagation(),className:"glass-card rounded-3xl p-6 w-[90%] max-w-md shadow-2xl",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-4 text-center",children:"发送语音消息"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4 text-center",children:"输入语音内容（模拟语音转文字）"}),e.jsx("textarea",{value:us,onChange:e=>gs(e.target.value),placeholder:"请输入语音内容...",className:"w-full h-32 px-4 py-3 border border-gray-300 rounded-2xl resize-none focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",autoFocus:!0}),e.jsxs("div",{className:"text-right text-sm text-gray-500 mt-2",children:[us.length," 字"]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>{hs(!1),gs("")},className:"flex-1 px-4 py-3 bg-gray-100 text-gray-700 rounded-full ios-button font-medium",children:"取消"}),e.jsx("button",{onClick:()=>{if(!us.trim())return;const e=Date.now(),t={id:e,type:"sent",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:e,messageType:"voice",voiceText:us};$(e=>[...e,t]),hs(!1),gs("")},disabled:!us.trim(),className:"flex-1 px-4 py-3 bg-green-500 text-white rounded-full ios-button font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:"发送语音"})]})]})})}),vs&&e.jsx(e.Fragment,{children:e.jsx("div",{onClick:()=>ys(!1),className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:e.jsxs("div",{onClick:e=>e.stopPropagation(),className:"glass-card rounded-3xl p-6 w-[90%] max-w-md shadow-2xl",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-4 text-center",children:"📍 发送位置"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4 text-center",children:"输入位置名称（地址可选）"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"地点名称"}),e.jsx("input",{type:"text",value:Ns,onChange:e=>ks(e.target.value),placeholder:"例如：星巴克(国贸店)",className:"w-full px-4 py-3 border border-gray-300 rounded-2xl focus:outline-none focus:ring-2 focus:ring-green-600 focus:border-transparent",autoFocus:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"详细地址"}),e.jsx("textarea",{value:Cs,onChange:e=>Ss(e.target.value),placeholder:"例如：北京市朝阳区建国门外大街1号国贸商城",className:"w-full h-24 px-4 py-3 border border-gray-300 rounded-2xl resize-none focus:outline-none focus:ring-2 focus:ring-green-600 focus:border-transparent"})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>{ys(!1),ks(""),Ss("")},className:"flex-1 px-4 py-3 bg-gray-100 text-gray-700 rounded-full ios-button font-medium",children:"取消"}),e.jsx("button",{onClick:()=>{if(!Ns.trim())return;const e=Date.now(),t={id:e,type:"sent",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:e,messageType:"location",location:{name:Ns,address:Cs.trim()||"位置详情",latitude:39.9042+.1*Math.random(),longitude:116.4074+.1*Math.random()}};$(e=>[...e,t]),ys(!1),ks(""),Ss("")},disabled:!Ns.trim(),className:"flex-1 px-4 py-3 bg-green-600 text-white rounded-full ios-button font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:"发送位置"})]})]})})}),Ms&&e.jsx(Aa,{onClose:()=>zs(!1),onSelect:Ha}),$s&&e.jsx(Ta,{onClose:()=>Ls(!1),onSubmit:Ha}),Jt&&e.jsx(va,{onClose:()=>Ht(!1),onSend:async(e,t,s)=>{const a=Date.now(),r={id:a,type:"sent",content:"",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:a,messageType:"musicInvite",musicInvite:{songTitle:e,songArtist:t,songCover:s,inviterName:(null==C?void 0:C.name)||"我",status:"pending"}};$(e=>[...e,r]),Ht(!1),setTimeout(()=>{Ja(a,e,t)},1500+1e3*Math.random())}}),Is&&e.jsx(e.Fragment,{children:e.jsx("div",{onClick:()=>_s(null),className:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center",children:e.jsxs("div",{onClick:e=>e.stopPropagation(),className:"w-[90%] max-w-2xl",children:[e.jsx("button",{onClick:()=>_s(null),className:"absolute top-4 right-4 w-10 h-10 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center text-white hover:bg-white/30 transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"bg-white rounded-3xl overflow-hidden shadow-2xl",children:[e.jsxs("div",{className:"h-96 bg-gradient-to-br from-blue-100 to-green-100 relative",children:[e.jsx("div",{className:"absolute inset-0 opacity-20",children:e.jsx("div",{className:"grid grid-cols-16 grid-rows-16 h-full w-full",children:Array.from({length:256}).map((t,s)=>e.jsx("div",{className:"border border-gray-300"},s))})}),e.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2",children:e.jsx("svg",{className:"w-16 h-16 text-red-500 drop-shadow-2xl animate-bounce",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"})})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[e.jsx("svg",{className:"w-6 h-6 text-green-600 flex-shrink-0 mt-1",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:null==(b=Is.location)?void 0:b.name}),e.jsx("p",{className:"text-gray-600 text-sm leading-relaxed",children:null==(j=Is.location)?void 0:j.address})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{className:"flex-1 px-4 py-3 bg-green-600 text-white rounded-full ios-button font-medium",children:"导航到这里"}),e.jsx("button",{className:"flex-1 px-4 py-3 bg-gray-100 text-gray-700 rounded-full ios-button font-medium",children:"发送给朋友"})]})]})]})]})})}),pa&&e.jsx(_a,{show:Ts,character:{name:pa.name,avatar:pa.avatar},isVideoCall:Bs,onAccept:()=>{Ds(!1),As({id:pa.id,name:pa.name,avatar:pa.avatar,profile:pa.description,relationship:pa.relationship,favorability:pa.favorability},Bs)},onReject:()=>{Ds(!1);const e=new Date,t={id:Date.now(),type:"system",content:`已拒绝 ${Bs?"视频":"语音"}通话`,time:e.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now()};$(e=>[...e,t]);const s=(null==C?void 0:C.nickname)||(null==C?void 0:C.name)||"用户",a={id:Date.now()+1,type:"system",content:`${s}拒绝了你的${Bs?"视频":"语音"}通话请求。`,time:e.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),isHidden:!0};$(e=>[...e,a])}}),e.jsx(Ra,{isOpen:ia,onClose:()=>ca(!1),characterName:(null==pa?void 0:pa.name)||"AI",characterId:w||""}),Os&&Ps&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50",style:{backdropFilter:"blur(5px)",WebkitBackdropFilter:"blur(5px)",transition:"all 0.3s ease"},onClick:()=>{Ws(!1),Fs(null)}}),e.jsxs("div",{className:"fixed z-50 "+("sent"===Ps.type?"message-menu-right":"message-menu-left"),style:{top:`${Math.min(Rs.y+10,window.innerHeight-150)}px`,left:"sent"===Ps.type?`${Math.min(Rs.x-140,window.innerWidth-160)}px`:`${Math.max(Rs.x-20,20)}px`,minWidth:"140px",maxWidth:"160px",background:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",borderRadius:"16px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.2)",transform:"scale(1)",transition:"all 0.25s cubic-bezier(0.4, 0, 0.2, 1)",animation:"menuFadeIn 0.25s cubic-bezier(0.4, 0, 0.2, 1)"},children:[e.jsx("div",{style:{position:"absolute",width:"12px",height:"12px",background:"rgba(255, 255, 255, 0.95)",transform:"rotate(45deg)",top:"-6px",["sent"===Ps.type?"right":"left"]:"20px",zIndex:-1}}),e.jsxs("div",{style:{padding:"8px 0"},children:[e.jsx("button",{onClick:()=>{Ps&&(Hs(Ps),Ws(!1),Fs(null))},className:"w-full px-4 py-2.5 hover:bg-black/5 text-left text-sm text-gray-900 ios-button transition-all",style:{border:"none",background:"transparent"},children:"引用"}),!(null==Ps?void 0:Ps.redEnvelopeId)&&!(null==Ps?void 0:Ps.transfer)&&!(null==Ps?void 0:Ps.intimatePay)&&e.jsx("button",{onClick:()=>{if(Ps){if(!(!Ps.redEnvelopeId&&!Ps.transfer&&!Ps.intimatePay))return alert("红包、转账、亲密付等特殊消息不支持撤回"),Ws(!1),void Fs(null);ea(Ps),Xs(!0),Ws(!1)}},className:"w-full px-4 py-2.5 hover:bg-black/5 text-left text-sm text-gray-900 ios-button transition-all",style:{border:"none",background:"transparent"},children:"撤回"}),e.jsx("button",{onClick:()=>{if(Ps){if(!confirm("确定要永久删除这条消息吗？\n\n⚠️ 此操作无法撤销！"))return Ws(!1),void Fs(null);const e=z.filter(e=>e.id!==Ps.id);Ka(e),w&&localStorage.setItem(`chat_messages_${w}`,JSON.stringify(e)),Ws(!1),Fs(null)}},className:"w-full px-4 py-2.5 hover:bg-black/5 text-left text-sm text-gray-900 ios-button transition-all",style:{border:"none",background:"transparent"},children:"删除"}),e.jsx("button",{onClick:()=>{sa(!0),Ws(!1),Fs(null)},className:"w-full px-4 py-2.5 hover:bg-black/5 text-left text-sm text-red-600 ios-button transition-all",style:{border:"none",background:"transparent"},children:"批量删除"}),"sent"===(null==Ps?void 0:Ps.type)&&e.jsx("button",{onClick:()=>{if(Ps){if("sent"!==Ps.type)return alert("只能编辑自己发送的消息"),Ws(!1),void Fs(null);if(Ps.messageType&&"text"!==Ps.messageType&&!Ps.content)return alert("此类型的消息不支持编辑"),Ws(!1),void Fs(null);da(Ps),ha(Ps.content||""),Ws(!1),Fs(null)}},className:"w-full px-4 py-2.5 hover:bg-black/5 text-left text-sm text-gray-900 ios-button transition-all",style:{border:"none",background:"transparent"},children:"编辑"})]})]}),e.jsx("style",{children:"\n            @keyframes menuFadeIn {\n              from {\n                opacity: 0;\n                transform: scale(0.8);\n              }\n              to {\n                opacity: 1;\n                transform: scale(1);\n              }\n            }\n          "})]}),Ks&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",style:{backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)"},children:[e.jsx("div",{className:"absolute inset-0 bg-black/30",onClick:()=>{Xs(!1),Qs(""),ea(null)}}),e.jsxs("div",{className:"relative glass-card rounded-3xl p-6 mx-4 max-w-sm w-full shadow-2xl border border-white/20",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"撤回消息"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"请输入撤回理由（必填）"})]}),e.jsx("textarea",{value:Zs,onChange:e=>Qs(e.target.value),placeholder:"例如：发错了、说错话了...",className:"w-full bg-white/50 rounded-2xl px-4 py-3 text-sm text-gray-900 border border-white/30 outline-none focus:border-primary resize-none mb-4",rows:3,maxLength:100,required:!0}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{Xs(!1),Qs(""),ea(null)},className:"flex-1 glass-card rounded-xl py-3 text-sm font-medium text-gray-700 border border-white/30",children:"取消"}),e.jsx("button",{onClick:()=>{if(Zs.trim()){if(Ys){const e="sent"===Ys.type;$(t=>t.map(t=>t.id===Ys.id?{...t,isRecalled:!0,recalledContent:t.content||t.emojiDescription||t.photoDescription||t.voiceText||"特殊消息",recallReason:Zs.trim(),originalType:t.type,content:e?"你撤回了一条消息":`${(null==pa?void 0:pa.name)||"对方"}撤回了一条消息`,type:"system",messageType:"system"}:t)),Xs(!1),Qs(""),ea(null),Fs(null)}}else alert("请填写撤回理由")},disabled:!Zs.trim(),className:"flex-1 rounded-xl py-3 text-sm font-medium text-white shadow-lg transition-all "+(Zs.trim()?"bg-gradient-to-r from-red-400 to-pink-400 hover:from-red-500 hover:to-pink-500":"bg-gray-300 cursor-not-allowed"),children:"确认撤回"})]})]})]}),Gs&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",style:{backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)"},children:[e.jsx("div",{className:"absolute inset-0 bg-black/20",onClick:()=>qs(null)}),e.jsxs("div",{className:"relative glass-card rounded-3xl p-6 mx-4 max-w-md w-full shadow-2xl border border-white/30",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["sent"===Gs.originalType?"你":(null==pa?void 0:pa.name)||"AI","撤回的消息"]}),Gs.recallReason&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["理由：",Gs.recallReason]})]}),e.jsx("div",{className:"bg-white/40 backdrop-blur-sm rounded-2xl p-4 mb-4 max-h-80 overflow-y-auto border border-white/20",children:e.jsx("p",{className:"text-sm text-gray-800 whitespace-pre-wrap break-words leading-relaxed",children:Gs.recalledContent||"无内容"})}),e.jsx("button",{onClick:()=>qs(null),className:"w-full glass-card border border-white/30 rounded-2xl py-3 text-sm font-medium text-gray-700 hover:bg-white/50 transition-all",children:"关闭"})]})]}),It&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm",onClick:()=>{_t(!1),zt(null)}}),e.jsx("div",{className:"relative w-full max-w-sm glass-card rounded-3xl p-6 shadow-2xl border border-white/20 max-h-[80vh] overflow-y-auto",children:Mt?"photo"===Mt?e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4 text-center",children:"上传照片"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-2",children:"选择照片（可选，可多选）"}),e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:e=>{const t=e.target.files;if(t&&t.length>0){const e=[];Array.from(t).forEach((s,a)=>{const r=new FileReader;r.onload=s=>{var a;e.push(null==(a=s.target)?void 0:a.result),e.length===t.length&&Bt(t=>[...t,...e])},r.readAsDataURL(s)})}},className:"w-full px-3 py-2 border border-gray-300 rounded-xl text-sm"}),Dt.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"text-xs text-gray-600 mb-2",children:["已选择 ",Dt.length," 张照片"]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:Dt.map((t,s)=>e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:t,alt:`预览${s+1}`,className:"w-full h-24 object-cover rounded-lg"}),e.jsx("button",{onClick:()=>Bt(e=>e.filter((e,t)=>t!==s)),className:"absolute top-1 right-1 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs",children:"×"})]},s))})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-2",children:"照片描述"}),e.jsx("textarea",{value:At,onChange:e=>Tt(e.target.value),placeholder:"描述这张照片...",className:"w-full px-3 py-2 border border-gray-300 rounded-xl resize-none text-sm",rows:3})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>zt(null),className:"flex-1 px-4 py-3 rounded-full glass-card border border-white/20 text-gray-900 font-medium ios-button",children:"返回"}),e.jsx("button",{onClick:async()=>{if(!w||!pa)return;if(!At.trim()&&0===Dt.length)return;const{addCouplePhoto:e}=await Qt(async()=>{const{addCouplePhoto:e}=await import("./utils-Bw01K5Nk.js").then(e=>e.bI);return{addCouplePhoto:e}},__vite__mapDeps([0,1,2])),t=At.trim()||"照片";if(Dt.length>0){const s=Date.now();for(let r=0;r<Dt.length;r++){const s=Dt[r],a=Dt.length>1?`${t} (${r+1}/${Dt.length})`:t;e(pa.id,(null==C?void 0:C.name)||"我",a,s)}const a={id:s,type:"system",content:`📸 你在情侣空间上传了 ${Dt.length} 张照片${"照片"!==t?`：${t}`:""}`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:s,messageType:"system",isHidden:!1};$(e=>[...e,a]),alert(`${Dt.length} 张照片已上传到情侣空间！`)}else{const s=Date.now();e(pa.id,(null==C?void 0:C.name)||"我",t,void 0);const a={id:s,type:"system",content:`📸 你在情侣空间上传了照片：${t}`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:s,messageType:"system",isHidden:!1};$(e=>[...e,a]),alert("照片已上传到情侣空间！")}Tt(""),Bt([]),_t(!1),zt(null)},className:"flex-1 px-4 py-3 rounded-full glass-card border border-white/20 text-gray-900 font-medium ios-button",children:"上传"})]})]}):"message"===Mt?e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4 text-center",children:"发布留言"}),e.jsx("textarea",{value:Et,onChange:e=>Pt(e.target.value),placeholder:"写下你想说的话...",className:"w-full px-3 py-2 border border-gray-300 rounded-xl resize-none mb-4 text-sm",rows:5}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>zt(null),className:"flex-1 px-4 py-3 rounded-full glass-card border border-white/20 text-gray-900 font-medium ios-button",children:"返回"}),e.jsx("button",{onClick:async()=>{if(!w||!pa)return;if(!Et.trim())return;const{addCoupleMessage:e}=await Qt(async()=>{const{addCoupleMessage:e}=await import("./utils-Bw01K5Nk.js").then(e=>e.bI);return{addCoupleMessage:e}},__vite__mapDeps([0,1,2]));e(pa.id,(null==C?void 0:C.name)||"我",Et.trim());const t=Date.now(),s={id:t,type:"system",content:`💌 你在情侣空间留言：${Et.trim()}`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:t,messageType:"system",isHidden:!1};$(e=>[...e,s]),Pt(""),_t(!1),zt(null),alert("留言已发布到情侣空间！")},className:"flex-1 px-4 py-3 rounded-full glass-card border border-white/20 text-gray-900 font-medium ios-button",children:"发布"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4 text-center",children:"添加纪念日"}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-2",children:"日期"}),e.jsx("input",{type:"date",value:Ft,onChange:e=>Ot(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-xl text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-2",children:"标题"}),e.jsx("input",{type:"text",value:Wt,onChange:e=>Rt(e.target.value),placeholder:"例如：第一次见面",className:"w-full px-3 py-2 border border-gray-300 rounded-xl text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-2",children:"描述（可选）"}),e.jsx("textarea",{value:Ut,onChange:e=>Vt(e.target.value),placeholder:"记录这个特殊的日子...",className:"w-full px-3 py-2 border border-gray-300 rounded-xl resize-none text-sm",rows:3})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>zt(null),className:"flex-1 px-4 py-3 rounded-full glass-card border border-white/20 text-gray-900 font-medium ios-button",children:"返回"}),e.jsx("button",{onClick:async()=>{if(!w||!pa)return;if(!Ft||!Wt.trim())return;const{addCoupleAnniversary:e}=await Qt(async()=>{const{addCoupleAnniversary:e}=await import("./utils-Bw01K5Nk.js").then(e=>e.bI);return{addCoupleAnniversary:e}},__vite__mapDeps([0,1,2]));e(pa.id,(null==C?void 0:C.name)||"我",Ft,Wt.trim(),Ut.trim());const t=Date.now(),s={id:t,type:"system",content:`🎂 你在情侣空间添加了纪念日：${Wt.trim()}（${Ft}）`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:t,messageType:"system",isHidden:!1};$(e=>[...e,s]),Ot(""),Rt(""),Vt(""),_t(!1),zt(null),alert("纪念日已添加到情侣空间！")},className:"flex-1 px-4 py-3 rounded-full glass-card border border-white/20 text-gray-900 font-medium ios-button",children:"添加"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4 text-center",children:"选择创建内容"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>zt("photo"),className:"w-full px-4 py-3 rounded-2xl glass-card border border-white/20 text-gray-900 font-medium ios-button",children:"上传照片"}),e.jsx("button",{onClick:()=>zt("message"),className:"w-full px-4 py-3 rounded-2xl glass-card border border-white/20 text-gray-900 font-medium ios-button",children:"发布留言"}),e.jsx("button",{onClick:()=>zt("anniversary"),className:"w-full px-4 py-3 rounded-2xl glass-card border border-white/20 text-gray-900 font-medium ios-button",children:"添加纪念日"})]}),e.jsx("button",{onClick:()=>_t(!1),className:"w-full px-4 py-3 rounded-full glass-card border border-white/20 text-gray-900 font-medium ios-button mt-4",children:"取消"})]})})]}),ue&&e.jsx(Sa,{songTitle:ue.songTitle,songArtist:ue.songArtist,songCover:ue.songCover,isOpen:F,onClose:()=>{O(!1),ge(null)}})]})]})}},Symbol.toStringTag,{value:"Module"})),Ja=({images:s,initialIndex:a,onClose:r})=>{const[l,n]=t.useState(a),[i,c]=t.useState(0),o=()=>{c(e=>(e+90)%360)},d=()=>{n(e=>e>0?e-1:s.length-1),c(0)},x=()=>{n(e=>e<s.length-1?e+1:0),c(0)};return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center",onClick:r,onKeyDown:e=>{"Escape"===e.key&&r(),"ArrowLeft"===e.key&&d(),"ArrowRight"===e.key&&x(),"r"!==e.key&&"R"!==e.key||o()},tabIndex:0,children:[e.jsx("button",{onClick:r,className:"absolute top-4 right-4 text-white hover:text-gray-300 z-10 text-3xl w-10 h-10 flex items-center justify-center",children:"×"}),e.jsx("button",{onClick:e=>{e.stopPropagation(),o()},className:"absolute top-4 right-16 text-white hover:text-gray-300 z-10 text-2xl w-10 h-10 flex items-center justify-center",title:"旋转 (R)",children:"↻"}),s.length>1&&e.jsxs("div",{className:"absolute top-4 left-4 text-white text-lg z-10",children:[l+1," / ",s.length]}),e.jsx("div",{className:"relative max-w-[90vw] max-h-[90vh] flex items-center justify-center",onClick:e=>e.stopPropagation(),children:e.jsx("img",{src:s[l],alt:`图片 ${l+1}`,className:"max-w-full max-h-[90vh] object-contain transition-transform duration-300",style:{transform:`rotate(${i}deg)`}})}),s.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:e=>{e.stopPropagation(),d()},className:"absolute left-4 top-1/2 -translate-y-1/2 text-white hover:text-gray-300 text-4xl",children:"‹"}),e.jsx("button",{onClick:e=>{e.stopPropagation(),x()},className:"absolute right-4 top-1/2 -translate-y-1/2 text-white hover:text-gray-300 text-4xl",children:"›"})]}),e.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 text-white text-sm opacity-70",children:"按 ESC 关闭 · 按 R 旋转 · 方向键切换"})]})},Ha=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{currentUser:r}=d(),{moments:l,likeMoment:i,unlikeMoment:c,addComment:x}=h(),{showStatusBar:m}=o(),{getCharacter:u}=n(),[g,p]=t.useState(null),[f,b]=t.useState(""),[j,v]=t.useState(""),[y,N]=t.useState(""),[w,k]=t.useState(()=>localStorage.getItem("moments_cover_image")||""),[C,S]=t.useState([]),[I,_]=t.useState(0),[M,z]=t.useState(!1),[$,L]=t.useState(0);t.useEffect(()=>{const e=()=>{L(ue())};e();const t=setInterval(e,1e3);return()=>clearInterval(t)},[]);const A=(t,s="medium")=>{const a={small:"text-sm",medium:"text-base",large:"text-2xl"};return t.startsWith("data:image")?e.jsx("img",{src:t,alt:"头像",className:"w-full h-full object-cover"}):t&&t.length<=4?e.jsx("div",{className:`${a[s]}`,children:t}):e.jsx("div",{className:"text-white text-base font-semibold bg-gradient-to-br from-blue-400 to-blue-600 w-full h-full flex items-center justify-center",children:(null==t?void 0:t[0])||"用"})},T=e=>{const t=new Date(e),s=(new Date).getTime()-t.getTime(),a=Math.floor(s/6e4),r=Math.floor(s/36e5),l=Math.floor(s/864e5);return a<1?"刚刚":a<60?`${a}分钟前`:r<24?`${r}小时前`:l<3?`${l}天前`:`${t.getMonth()+1}月${t.getDate()}日`},D=e=>{if(!r||!f.trim())return;const t=j?`@${j} ${f.trim()}`:f.trim();x(e,r.id,r.name,r.avatar,t);const s=l.find(t=>t.id===e);if(y&&y!==r.id){if(u(y)){const e=localStorage.getItem(`chat_messages_${y}`),s=e?JSON.parse(e):[],a={id:Date.now()+Math.random(),type:"system",content:`💬 ${r.name} 回复了你的朋友圈评论：${t}`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"system",isHidden:!0};s.push(a),localStorage.setItem(`chat_messages_${y}`,JSON.stringify(s))}}else if(s&&s.userId!==r.id){if(u(s.userId)){const e=localStorage.getItem(`chat_messages_${s.userId}`),a=e?JSON.parse(e):[],l={id:Date.now()+Math.random(),type:"system",content:`💬 ${r.name} 评论了你的朋友圈：${t}`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"system",isHidden:!0};a.push(l),localStorage.setItem(`chat_messages_${s.userId}`,JSON.stringify(a))}}b(""),v(""),N(""),p(null)},B=e=>{if(!r)return!1;const t=l.find(t=>t.id===e);return(null==t?void 0:t.likes.some(e=>e.userId===r.id))||!1};return e.jsxs("div",{className:"h-full flex flex-col bg-white",children:[e.jsxs("div",{className:"glass-effect z-50 flex-shrink-0",children:[m&&e.jsx(xa,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:e=>{e.stopPropagation(),a("/wechat/discover",{replace:!0})},className:"w-10 h-10 rounded-full glass-effect flex items-center justify-center ios-button",children:e.jsx(ls,{size:20,className:"text-gray-700"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:e=>{e.stopPropagation(),a("/moment-notifications")},className:"w-10 h-10 rounded-full glass-effect flex items-center justify-center ios-button relative",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-700",children:[e.jsx("path",{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}),e.jsx("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"})]}),$>0&&e.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs font-bold",children:$>99?"99+":$})})]}),e.jsx("button",{onClick:e=>{e.stopPropagation(),a("/publish-moment")},className:"w-10 h-10 rounded-full glass-effect flex items-center justify-center ios-button",children:e.jsx(ks,{size:20,className:"text-gray-700"})})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"relative h-80 bg-white overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 bg-white cursor-pointer group",onClick:()=>{const e=document.createElement("input");e.type="file",e.accept="image/*",e.onchange=e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(s){const e=new FileReader;e.onload=e=>{var t;const s=null==(t=e.target)?void 0:t.result;k(s),localStorage.setItem("moments_cover_image",s)},e.readAsDataURL(s)}},e.click()},children:[w?e.jsx("img",{src:w,alt:"封面",className:"w-full h-full object-cover"}):e.jsx("div",{className:"absolute inset-0 bg-white flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400 text-sm opacity-0 group-hover:opacity-100 transition-opacity",children:"点击上传封面图片"})}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/5 transition-colors"})]}),e.jsxs("div",{className:"absolute bottom-6 left-4 right-4 flex items-end justify-between",children:[e.jsxs("div",{className:"flex-1 mr-4",children:[e.jsx("h2",{className:"text-white font-semibold text-lg drop-shadow-lg mb-1",children:(null==r?void 0:r.name)||"微信用户"}),(null==r?void 0:r.signature)&&e.jsx("p",{className:"text-white/90 text-xs drop-shadow-lg line-clamp-2",children:r.signature})]}),e.jsx("div",{className:"w-20 h-20 rounded-2xl bg-white flex items-center justify-center shadow-2xl overflow-hidden border-4 border-white/50",children:r&&A(r.avatar,"large")})]})]}),e.jsx("div",{className:"bg-white pb-20",children:0===l.length?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-400",children:[e.jsx("p",{className:"text-sm",children:"暂无动态"}),e.jsx("p",{className:"text-xs mt-2 text-gray-300",children:"点击右上角相机发布第一条朋友圈"})]}):e.jsx("div",{children:l.map(t=>e.jsxs("div",{className:"bg-white border-b border-gray-100 p-4 hover:bg-gray-50/50 transition-colors",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gray-100 flex items-center justify-center flex-shrink-0 shadow-sm overflow-hidden",children:A(t.userAvatar,"medium")}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-blue-600 mb-1",children:t.userName}),e.jsx("p",{className:"text-gray-800 leading-relaxed mb-2",children:t.content.replace(/\[图片[：:][^\]]+\]/g,"")}),t.images.length>0&&e.jsx("div",{className:"grid gap-2 mb-2 "+(1===t.images.length?"grid-cols-1":2===t.images.length?"grid-cols-2":(t.images.length,"grid-cols-3")),children:t.images.map((s,a)=>e.jsx("div",{className:"aspect-square rounded-lg overflow-hidden bg-gray-100 cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>((e,t)=>{S(e),_(t),z(!0)})(t.images.map(e=>e.url),a),children:e.jsx("img",{src:s.url,alt:"",className:"w-full h-full object-cover"})},s.id))}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400 mb-2",children:[e.jsx("span",{children:T(t.createdAt)}),t.location&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"·"}),e.jsx("span",{children:t.location})]})]})]}),e.jsx("button",{className:"w-8 h-8 rounded-lg flex items-center justify-center text-gray-400 hover:bg-gray-100 ios-button",children:e.jsx(As,{size:18})})]}),(t.likes.length>0||t.comments.length>0)&&e.jsxs("div",{className:"ml-[60px] bg-gray-50 rounded-lg p-3 space-y-2",children:[t.likes.length>0&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ts,{size:14,className:"text-red-500 mt-0.5 flex-shrink-0"}),e.jsx("div",{className:"flex-1 text-sm leading-relaxed",children:e.jsx("span",{className:"text-blue-600",children:t.likes.map((s,a)=>e.jsxs("span",{children:[s.userName,a<t.likes.length-1&&", "]},s.id))})})]}),t.likes.length>0&&t.comments.length>0&&e.jsx("div",{className:"border-t border-gray-200/60"}),t.comments.length>0&&e.jsx("div",{className:"space-y-2",children:t.comments.map(s=>e.jsxs("div",{className:"text-sm leading-relaxed cursor-pointer hover:bg-gray-50 -mx-2 px-2 py-1 rounded transition-colors",onClick:()=>{return e=t.id,a=s.userName,r=s.userId,p(e),v(a),N(r),void b("");var e,a,r},children:[e.jsxs("span",{className:"text-blue-600 font-medium",children:[s.userName,"："]}),e.jsx("span",{className:"text-gray-700",children:s.content})]},s.id))})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4 mt-3 ml-[60px]",children:[e.jsxs("button",{onClick:()=>(e=>{if(!r)return;const t=l.find(t=>t.id===e);if(!t)return;t.likes.some(e=>e.userId===r.id)?c(e,r.id):i(e,r.id,r.name,r.avatar)})(t.id),className:"flex items-center gap-1.5 px-3 py-1.5 rounded-full ios-button transition-colors "+(B(t.id)?"bg-red-50 text-red-500":"bg-gray-50 text-gray-600"),children:[B(t.id)?e.jsx(Ts,{size:16}):e.jsx($s,{size:16}),e.jsx("span",{className:"text-xs",children:"赞"})]}),e.jsxs("button",{onClick:()=>p(g===t.id?null:t.id),className:"flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-gray-50 text-gray-600 ios-button",children:[e.jsx(Ls,{size:16}),e.jsx("span",{className:"text-xs",children:"评论"})]})]}),g===t.id&&e.jsx("div",{className:"mt-3 ml-[60px]",children:e.jsxs("div",{className:"glass-card rounded-xl p-3",children:[j&&e.jsxs("div",{className:"flex items-center justify-between mb-2 pb-2 border-b border-gray-200",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:["回复 ",e.jsxs("span",{className:"text-blue-600 font-medium",children:["@",j]})]}),e.jsx("button",{onClick:()=>{v(""),N("")},className:"text-gray-400 hover:text-gray-600 text-xs",children:"✕"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:f,onChange:e=>b(e.target.value),placeholder:j?`回复 @${j}`:"说点什么...",className:"flex-1 bg-transparent outline-none text-sm",onKeyPress:e=>{"Enter"===e.key&&D(t.id)},autoFocus:!0}),e.jsx("button",{onClick:()=>D(t.id),className:"px-4 py-1 rounded-lg glass-effect text-blue-600 text-sm font-medium ios-button disabled:opacity-50",disabled:!f.trim(),children:"发送"})]})]})})]},t.id))})})]}),M&&e.jsx(Ja,{images:C,initialIndex:I,onClose:()=>z(!1)})]})}},Symbol.toStringTag,{value:"Module"})),Ga=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),{setBackground:l}=c(),n=t.useRef(null),[i,d]=t.useState("");t.useEffect(()=>{(async()=>{try{const e=await pe("global_background");e&&(d(e),l(e))}catch(e){}})()},[l]);const[x,m]=t.useState(()=>"true"===localStorage.getItem("apply_background_to_all_pages")),[h,u]=t.useState(!1),[g,p]=t.useState(i),[f,b]=t.useState(ge()),[j,v]=t.useState(()=>localStorage.getItem("user_bubble_color")||"#95EC69"),[y,N]=t.useState(()=>localStorage.getItem("ai_bubble_color")||"#FFFFFF"),[w,k]=t.useState(()=>localStorage.getItem("user_bubble_css")||""),[C,S]=t.useState(()=>localStorage.getItem("ai_bubble_css")||""),[I,_]=t.useState(!1);t.useEffect(()=>{p(i)},[i]);return e.jsxs("div",{className:"h-full flex flex-col relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 z-0",style:i?{backgroundImage:`url(${i})`,backgroundSize:"cover",backgroundPosition:"center"}:{}}),e.jsxs("div",{className:"relative z-10 h-full flex flex-col bg-transparent",children:[e.jsxs("div",{className:"glass-effect sticky top-0 z-50",children:[r&&e.jsx(xa,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a("/desktop",{replace:!0}),className:"ios-button text-gray-700 hover:text-gray-900 -ml-2",children:e.jsx(ls,{size:24})}),e.jsx("h1",{className:"text-base font-semibold text-gray-900 absolute left-1/2 transform -translate-x-1/2 pointer-events-none",children:"设置"}),e.jsx("div",{className:"w-6"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-3 pt-3 pb-20",children:[e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"glass-card rounded-2xl overflow-hidden",children:[e.jsxs("div",{onClick:()=>a("/users"),className:"flex items-center justify-between px-4 py-4 ios-button cursor-pointer border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-900 font-medium",children:"账号与安全"}),e.jsx("span",{className:"text-gray-400 text-xl",children:"›"})]}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-4 ios-button cursor-pointer border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-900 font-medium",children:"新消息通知"}),e.jsx("span",{className:"text-gray-400 text-xl",children:"›"})]}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-4 ios-button cursor-pointer",children:[e.jsx("span",{className:"text-gray-900 font-medium",children:"隐私"}),e.jsx("span",{className:"text-gray-400 text-xl",children:"›"})]})]})}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-xs text-gray-500 font-medium",children:"全局设置"})}),e.jsxs("div",{className:"glass-card rounded-2xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-4 ios-button cursor-pointer border-b border-gray-100",onClick:()=>_(!0),children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-gray-900 font-medium mb-0.5",children:"全局聊天气泡"}),e.jsx("div",{className:"text-xs text-gray-500",children:"应用于所有聊天，可在单个聊天中覆盖"})]}),e.jsx("span",{className:"text-gray-400 text-xl",children:"›"})]}),e.jsxs("div",{className:"px-4 py-4",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-gray-900 font-medium mb-0.5",children:"全局背景"}),e.jsx("div",{className:"text-xs text-gray-500",children:"默认应用于微信、通讯录、发现、我四个主界面"})]}),e.jsx("input",{ref:n,type:"file",accept:"image/*",onChange:async e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(s)if(s.type.startsWith("image/")){u(!0);try{const e=new FileReader;e.onload=async()=>{const t=e.result;try{await fe("global_background",t),p(t),d(t),l(t),u(!1),alert("全局背景已保存！（使用 IndexedDB，无大小限制）")}catch(s){alert("保存失败，请重试"),u(!1)}},e.onerror=()=>{alert("图片读取失败"),u(!1)},e.readAsDataURL(s)}catch(a){alert("图片处理失败，请重试"),u(!1)}}else alert("请选择图片文件")},className:"hidden"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-20 h-20 rounded-xl overflow-hidden border-2 border-gray-200 flex-shrink-0 flex items-center justify-center",style:{backgroundImage:g?`url(${g})`:"none",backgroundSize:"cover",backgroundPosition:"center",backgroundColor:g?"transparent":"#f5f7fa"},children:!g&&e.jsx(ds,{size:32,className:"text-gray-400"})}),e.jsxs("div",{className:"flex-1 flex gap-2",children:[e.jsx("button",{onClick:()=>{var e;return null==(e=n.current)?void 0:e.click()},disabled:h,className:"flex-1 px-4 py-2.5 bg-wechat-primary text-white rounded-xl ios-button font-medium text-sm",children:h?"上传中...":g?"更换":"上传背景"}),g&&e.jsx("button",{onClick:async()=>{try{await be("global_background"),d(""),p(""),localStorage.removeItem("global_background"),l(""),b(ge()),alert("全局背景已删除！")}catch(e){alert("删除失败，请重试")}},className:"px-4 py-2.5 glass-card text-gray-700 rounded-xl ios-button font-medium text-sm",children:"删除"})]})]}),g&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs("button",{onClick:()=>{const e=!x;m(e),localStorage.setItem("apply_background_to_all_pages",String(e))},className:"w-full flex items-center justify-between ios-button",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:"应用到所有界面"}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:x?"已应用到所有界面（包括聊天、小程序等）":"仅应用到微信、通讯录、发现、我"})]})}),e.jsx("div",{className:"w-12 h-7 rounded-full transition-all "+(x?"bg-wechat-primary":"bg-gray-300"),children:e.jsx("div",{className:"w-5 h-5 bg-white rounded-full mt-1 transition-all shadow-md "+(x?"ml-6":"ml-1")})})]})})]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-xs text-gray-500 font-medium",children:"存储管理"})}),e.jsxs("div",{className:"glass-card rounded-2xl overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-4 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-gray-900 font-medium",children:"存储空间"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[f.used," KB / ",f.total," KB"]})]}),e.jsx("div",{className:"w-full h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full transition-all "+(f.percentage>80?"bg-red-500":f.percentage>60?"bg-yellow-500":"bg-green-500"),style:{width:`${Math.min(f.percentage,100)}%`}})}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["已使用 ",f.percentage,"%"]})]}),e.jsxs("div",{onClick:()=>{confirm("智能清理将优化存储空间：\n\n• 每个聊天保留最近 500 条消息\n• 朋友圈保留最近 200 条\n\n您的重要聊天记忆会被保留，是否继续？")&&(je(),b(ge()),alert("智能清理完成！已优化存储空间"))},className:"flex items-center justify-between px-4 py-4 ios-button cursor-pointer border-b border-gray-100",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-gray-900 font-medium",children:"智能清理"}),e.jsx("div",{className:"text-xs text-gray-500",children:"保留最近500条消息，释放存储空间"})]}),e.jsx("span",{className:"text-gray-400 text-xl",children:"›"})]}),e.jsxs("div",{onClick:()=>{confirm("压缩数据将移除消息中的冗余字段，优化存储效率。\n\n注意：此操作不会删除聊天内容，是否继续？")&&(ve(),b(ge()),alert("数据压缩完成！"))},className:"flex items-center justify-between px-4 py-4 ios-button cursor-pointer border-b border-gray-100",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-gray-900 font-medium",children:"压缩数据"}),e.jsx("div",{className:"text-xs text-gray-500",children:"移除冗余字段，优化存储效率"})]}),e.jsx("span",{className:"text-gray-400 text-xl",children:"›"})]}),e.jsxs("div",{onClick:()=>{if(confirm("确定要清除所有聊天记录吗？")){const e=[];for(let t=0;t<localStorage.length;t++){const s=localStorage.key(t);s&&s.startsWith("chat_messages_")&&e.push(s)}e.forEach(e=>localStorage.removeItem(e)),b(ge()),alert(`已清除 ${e.length} 个聊天记录`)}},className:"flex items-center justify-between px-4 py-4 ios-button cursor-pointer border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-900 font-medium",children:"清理聊天记录"}),e.jsx("span",{className:"text-gray-400 text-xl",children:"›"})]}),e.jsxs("div",{onClick:()=>{confirm("确定要清除所有缓存吗？这将删除所有聊天记录、壁纸和设置！")&&(localStorage.clear(),alert("缓存已清除，页面将刷新"),window.location.reload())},className:"flex items-center justify-between px-4 py-4 ios-button cursor-pointer",children:[e.jsx("span",{className:"text-red-500 font-medium",children:"清除所有缓存"}),e.jsx("span",{className:"text-gray-400 text-xl",children:"›"})]})]})]}),e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"glass-card rounded-2xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-4 ios-button cursor-pointer border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-900 font-medium",children:"通用"}),e.jsx("span",{className:"text-gray-400 text-xl",children:"›"})]}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-4 ios-button cursor-pointer border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-900 font-medium",children:"帮助与反馈"}),e.jsx("span",{className:"text-gray-400 text-xl",children:"›"})]}),e.jsxs("div",{onClick:()=>a("/about"),className:"flex items-center justify-between px-4 py-4 ios-button cursor-pointer",children:[e.jsx("span",{className:"text-gray-900 font-medium",children:"关于汁汁"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"v1.0.9"}),e.jsx("span",{className:"text-gray-400 text-xl",children:"›"})]})]})]})}),e.jsx("div",{className:"mb-6",children:e.jsx("button",{onClick:()=>a("/"),className:"w-full glass-card rounded-2xl px-4 py-4 text-red-500 font-medium ios-button",children:"退出登录"})})]}),I&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"glass-card rounded-3xl w-full max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 glass-effect px-6 py-4 border-b border-gray-200/50 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"聊天气泡设置"}),e.jsx("button",{onClick:()=>_(!1),className:"text-gray-500 hover:text-gray-700 text-2xl",children:"×"})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"glass-card rounded-xl p-4 bg-gradient-to-r from-purple-50 to-pink-50 border border-purple-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-1",children:"想要更多气泡样式？"}),e.jsx("p",{className:"text-xs text-gray-600",children:"前往小程序 → 气泡商店，选择你喜欢的预设样式"})]}),e.jsx("button",{onClick:()=>{window.location.href="/#/bubble-store"},className:"px-3 py-1.5 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg text-xs font-medium whitespace-nowrap",children:"前往商店"})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"手动自定义"}),e.jsx("p",{className:"text-sm text-gray-600",children:"如果你想完全自定义气泡样式，可以在下方输入CSS代码"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"我的气泡（发送）"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"气泡颜色"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"color",value:j,onChange:e=>v(e.target.value),className:"w-16 h-10 rounded-lg border border-gray-300 cursor-pointer"}),e.jsx("input",{type:"text",value:j,onChange:e=>v(e.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-wechat-primary",placeholder:"#95EC69"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"自定义CSS（高级）"}),e.jsx("textarea",{value:w,onChange:e=>k(e.target.value),className:"w-full h-32 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-wechat-primary font-mono text-sm resize-none",placeholder:"例如：\nbackground: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\nborder-radius: 16px;\nbox-shadow: 0 4px 12px rgba(0,0,0,0.1);"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"输入CSS样式代码，将直接应用到气泡上"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"预览效果"}),e.jsx("div",{className:"flex justify-end",children:e.jsx("div",{className:"px-4 py-3 rounded-2xl text-gray-900 max-w-xs",style:{backgroundColor:j,...Object.fromEntries(w.split(";").filter(e=>e.trim()).map(e=>{const[t,s]=e.split(":").map(e=>e.trim());return[t.replace(/-([a-z])/g,e=>e[1].toUpperCase()),s]}))},children:"这是我发送的消息"})})]})]}),e.jsx("div",{className:"border-t border-gray-200"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"对方气泡（接收）"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"气泡颜色"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"color",value:y,onChange:e=>N(e.target.value),className:"w-16 h-10 rounded-lg border border-gray-300 cursor-pointer"}),e.jsx("input",{type:"text",value:y,onChange:e=>N(e.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-wechat-primary",placeholder:"#FFFFFF"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"自定义CSS（高级）"}),e.jsx("textarea",{value:C,onChange:e=>S(e.target.value),className:"w-full h-32 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-wechat-primary font-mono text-sm resize-none",placeholder:"例如：\nbackground: #FFFFFF;\nborder: 1px solid #E5E5E5;\nbox-shadow: 0 2px 8px rgba(0,0,0,0.08);"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"输入CSS样式代码，将直接应用到气泡上"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"预览效果"}),e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"px-4 py-3 rounded-2xl text-gray-900 max-w-xs",style:{backgroundColor:y,...Object.fromEntries(C.split(";").filter(e=>e.trim()).map(e=>{const[t,s]=e.split(":").map(e=>e.trim());return[t.replace(/-([a-z])/g,e=>e[1].toUpperCase()),s]}))},children:"这是对方发送的消息"})})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:()=>{if(confirm("确定要重置气泡设置为默认值吗？")){const e="#95EC69",t="#FFFFFF";v(e),N(t),k(""),S(""),localStorage.setItem("user_bubble_color",e),localStorage.setItem("ai_bubble_color",t),localStorage.removeItem("user_bubble_css"),localStorage.removeItem("ai_bubble_css"),alert("气泡设置已重置！")}},className:"flex-1 px-4 py-3 bg-gray-100 text-gray-700 rounded-xl ios-button font-medium",children:"重置为默认"}),e.jsx("button",{onClick:()=>{localStorage.setItem("user_bubble_color",j),localStorage.setItem("ai_bubble_color",y),localStorage.setItem("user_bubble_css",w),localStorage.setItem("ai_bubble_css",C),alert("气泡设置已保存！"),_(!1)},className:"flex-1 px-4 py-3 bg-wechat-primary text-white rounded-xl ios-button font-medium",children:"保存设置"})]})]})]})})]})]})}},Symbol.toStringTag,{value:"Module"})),qa=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{currentUser:r,updateUser:l}=d(),{showStatusBar:n}=o(),[i,c]=t.useState(null),[x,m]=t.useState(""),h=t.useRef(null),u=t.useRef(null);if(t.useEffect(()=>{"signature"===i&&u.current?u.current.focus():h.current&&h.current.focus()},[i]),!r)return null;const g=r.avatar&&r.avatar.startsWith("data:image"),p=(e,t)=>{c(e),m(t)},f=e=>{x.trim()&&l(r.id,{[e]:x}),c(null),m("")},b=()=>{c(null),m("")},j=(e,t)=>{"Enter"===e.key&&"signature"!==t?f(t):"Escape"===e.key&&b()};return e.jsxs("div",{className:"h-full flex flex-col bg-gray-50",children:[e.jsxs("div",{className:"glass-effect sticky top-0 z-50",children:[n&&e.jsx(xa,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a("/desktop",{replace:!0}),className:"ios-button text-gray-700 hover:text-gray-900 -ml-2",children:e.jsx(ls,{size:24})}),e.jsx("h1",{className:"text-base font-semibold text-gray-900 absolute left-1/2 transform -translate-x-1/2 pointer-events-none",children:"个人信息"}),e.jsx("div",{className:"w-6"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-3 pt-3",children:[e.jsx("div",{className:"mb-3",children:e.jsx("div",{className:"glass-card rounded-2xl overflow-hidden",children:e.jsxs("div",{onClick:()=>a("/edit-profile",{state:{field:"avatar"}}),className:"flex items-center justify-between px-4 py-4 ios-button cursor-pointer",children:[e.jsx("span",{className:"text-gray-900 font-medium",children:"头像"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-gray-200 flex items-center justify-center shadow-lg overflow-hidden",children:g&&r.avatar?e.jsx("img",{src:r.avatar,alt:"头像",className:"w-full h-full object-cover"}):e.jsx(ds,{size:32,className:"text-gray-400"})}),e.jsx("span",{className:"text-gray-400 text-xl",children:"›"})]})]})})}),e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"glass-card rounded-2xl overflow-hidden",children:[e.jsx("div",{className:"px-4 py-4 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-900 font-medium",children:"名字"}),e.jsx("div",{className:"flex items-center gap-2 flex-1 justify-end",children:"name"===i?e.jsxs(e.Fragment,{children:[e.jsx("input",{ref:h,type:"text",value:x,onChange:e=>m(e.target.value),onKeyDown:e=>j(e,"name"),maxLength:20,className:"flex-1 bg-transparent border-none outline-none text-gray-900 text-right",placeholder:"请输入名字"}),e.jsx("button",{onClick:b,className:"text-sm text-gray-500 ios-button whitespace-nowrap",children:"取消"}),e.jsx("button",{onClick:()=>f("name"),className:"text-sm text-primary font-medium ios-button whitespace-nowrap",children:"保存"})]}):e.jsx("div",{onClick:()=>p("name",r.name),className:"text-gray-600 ios-button cursor-pointer",children:r.name})})]})}),e.jsx("div",{className:"px-4 py-4 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-900 font-medium",children:"网名"}),e.jsx("div",{className:"flex items-center gap-2 flex-1 justify-end",children:"nickname"===i?e.jsxs(e.Fragment,{children:[e.jsx("input",{ref:h,type:"text",value:x,onChange:e=>m(e.target.value),onKeyDown:e=>j(e,"nickname"),maxLength:20,className:"flex-1 bg-transparent border-none outline-none text-gray-900 text-right",placeholder:"请输入网名"}),e.jsx("button",{onClick:b,className:"text-sm text-gray-500 ios-button whitespace-nowrap",children:"取消"}),e.jsx("button",{onClick:()=>f("nickname"),className:"text-sm text-primary font-medium ios-button whitespace-nowrap",children:"保存"})]}):e.jsx("div",{onClick:()=>p("nickname",r.nickname||""),className:"text-gray-600 ios-button cursor-pointer",children:r.nickname||"未设置"})})]})}),e.jsx("div",{className:"px-4 py-4 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-900 font-medium",children:"微信号"}),e.jsx("div",{className:"flex items-center gap-2 flex-1 justify-end",children:"username"===i?e.jsxs(e.Fragment,{children:[e.jsx("input",{ref:h,type:"text",value:x,onChange:e=>m(e.target.value),onKeyDown:e=>j(e,"username"),className:"flex-1 bg-transparent border-none outline-none text-gray-900 text-right",placeholder:"请输入微信号"}),e.jsx("button",{onClick:b,className:"text-sm text-gray-500 ios-button whitespace-nowrap",children:"取消"}),e.jsx("button",{onClick:()=>f("username"),className:"text-sm text-primary font-medium ios-button whitespace-nowrap",children:"保存"})]}):e.jsx("div",{onClick:()=>p("username",r.username),className:"text-gray-500 ios-button cursor-pointer",children:r.username})})]})}),e.jsx("div",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("span",{className:"text-gray-900 font-medium pt-1",children:"个性签名"}),e.jsx("div",{className:"flex-1 ml-4",children:"signature"===i?e.jsxs("div",{children:[e.jsx("textarea",{ref:u,value:x,onChange:e=>m(e.target.value),maxLength:100,className:"w-full h-20 bg-transparent border-none outline-none text-gray-900 resize-none",placeholder:"填写个性签名"}),e.jsxs("div",{className:"flex gap-2 justify-end mt-2",children:[e.jsx("button",{onClick:b,className:"text-sm text-gray-500 ios-button",children:"取消"}),e.jsx("button",{onClick:()=>f("signature"),className:"text-sm text-primary font-medium ios-button",children:"保存"})]})]}):e.jsx("div",{onClick:()=>p("signature",r.signature),className:"text-gray-600 ios-button cursor-pointer min-h-[24px]",children:r.signature})})]})})]})}),e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"glass-card rounded-2xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-4 ios-button cursor-pointer border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-900 font-medium",children:"地区"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-600",children:"未设置"}),e.jsx("span",{className:"text-gray-400 text-xl",children:"›"})]})]}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-4 ios-button cursor-pointer",children:[e.jsx("span",{className:"text-gray-900 font-medium",children:"更多"}),e.jsx("span",{className:"text-gray-400 text-xl",children:"›"})]})]})}),e.jsx("div",{className:"mb-6",children:e.jsx("button",{onClick:()=>a("/users"),className:"w-full glass-card rounded-2xl px-4 py-4 text-primary font-medium ios-button",children:"切换账号"})})]})]})}},Symbol.toStringTag,{value:"Module"})),Ka="/zhizhi/assets/memory-icon-DzISjrVt.webp",Xa="/zhizhi/assets/memory-summary-icon-vLT3i2Cs.webp",Za="/zhizhi/assets/diary-icon-Bviql5LY.webp",Qa=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{var a;const l=s(),{id:i}=r(),{getCharacter:d}=n(),{showStatusBar:x}=o(),m=t.useRef(null),h=i?d(i):void 0,{background:u,setBackground:g}=c(),[p,f]=t.useState(()=>"true"===localStorage.getItem(`narrator_enabled_${i}`)),[b,j]=t.useState(()=>"true"===localStorage.getItem(`ai_moments_enabled_${i}`)),[v,y]=t.useState(()=>"true"===localStorage.getItem(`ai_proactive_enabled_${i}`)),[N,w]=t.useState(()=>{const e=localStorage.getItem("ai_message_limit");return e?parseInt(e):15}),[k,C]=t.useState(()=>{const e=localStorage.getItem(`memory_summary_interval_${i}`);return e?parseInt(e):30}),[S,I]=t.useState(()=>localStorage.getItem(`user_bubble_color_${i}`)||""),[_,M]=t.useState(()=>localStorage.getItem(`ai_bubble_color_${i}`)||""),[z,$]=t.useState(()=>localStorage.getItem(`user_bubble_css_${i}`)||""),[L,A]=t.useState(()=>localStorage.getItem(`ai_bubble_css_${i}`)||""),[T,D]=t.useState(!1),[B,E]=t.useState(""),[P,F]=t.useState(()=>{if(!i)return!1;return V.getBlockStatus("user",i).blockedByMe}),[O,W]=t.useState(!1),[R,U]=t.useState(u),J=t.useRef(null),H=t.useRef(null),G=t.useRef(null),q=t.useRef(null),[K,X]=t.useState(()=>localStorage.getItem(`red_envelope_cover_${i}`)||""),[Z,Q]=t.useState(()=>localStorage.getItem(`red_envelope_icon_${i}`)||""),[Y,ee]=t.useState(()=>localStorage.getItem(`transfer_cover_${i}`)||""),[te,se]=t.useState(()=>localStorage.getItem(`transfer_icon_${i}`)||"");t.useEffect(()=>{U(u)},[u]);return h?e.jsxs("div",{className:"h-full flex flex-col bg-gray-50",children:[e.jsxs("div",{className:"glass-effect sticky top-0 z-50",children:[x&&e.jsx(xa,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>l(`/chat/${i}`,{replace:!0}),className:"ios-button text-gray-700 hover:text-gray-900 -ml-2",children:e.jsx(ls,{size:24})}),e.jsx("h1",{className:"text-base font-semibold text-gray-900",children:"聊天设置"}),e.jsx("div",{className:"w-6"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-3 pt-3 pb-20",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"聊天对象"})}),e.jsxs("div",{className:"glass-card rounded-2xl p-4 flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gray-200 flex items-center justify-center flex-shrink-0 shadow-lg overflow-hidden",children:(null==(a=h.avatar)?void 0:a.startsWith("data:image"))?e.jsx("img",{src:h.avatar,alt:h.name,className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-2xl",children:h.avatar||"🤖"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:h.name}),e.jsx("p",{className:"text-sm text-gray-500",children:h.username})]}),e.jsx("button",{onClick:()=>l(`/character/${h.id}`),className:"text-sm text-primary ios-button",children:"查看详情"})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"AI 记忆"})}),e.jsxs("div",{className:"glass-card rounded-2xl overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-4 flex items-center justify-between cursor-pointer hover:bg-gray-50 transition-colors border-b border-gray-100",onClick:()=>l(`/memory/${i}`),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 flex items-center justify-center",children:e.jsx("img",{src:Ka,alt:"记忆",className:"w-10 h-10 object-contain"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"查看记忆"}),e.jsx("p",{className:"text-xs text-gray-500",children:"查看 AI 记住的关于你的信息"})]})]}),e.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]}),e.jsxs("div",{className:"px-4 py-4 flex items-center justify-between cursor-pointer hover:bg-gray-50 transition-colors border-b border-gray-100",onClick:()=>l(`/memory-summary/${i}`),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 flex items-center justify-center",children:e.jsx("img",{src:Xa,alt:"记忆总结",className:"w-10 h-10 object-contain"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"记忆总结"}),e.jsx("p",{className:"text-xs text-gray-500",children:"AI 总结当前对话的重要信息"})]})]}),e.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]}),e.jsxs("div",{className:"px-4 py-4 flex items-center justify-between cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>l(`/diary/${i}`),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 flex items-center justify-center",children:e.jsx("img",{src:Za,alt:"日记",className:"w-10 h-10 object-contain"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"TA的日记"}),e.jsx("p",{className:"text-xs text-gray-500",children:"查看 TA 写的日记"})]})]}),e.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]}),e.jsxs("div",{className:"px-4 py-4 border-t border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"总结间隔"}),e.jsx("p",{className:"text-xs text-gray-500",children:"每隔多少轮对话自动总结"})]}),e.jsxs("span",{className:"text-sm font-semibold text-wechat-primary",children:[k," 轮"]})]}),e.jsx("input",{type:"range",min:"10",max:"100",step:"10",value:k,onChange:e=>{return t=parseInt(e.target.value),C(t),void(i&&(localStorage.setItem(`memory_summary_interval_${i}`,String(t)),window.dispatchEvent(new Event("storage"))));var t},className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-wechat-primary"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-400 mt-1",children:[e.jsx("span",{children:"10轮"}),e.jsx("span",{children:"100轮"})]})]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"聊天壁纸"})}),e.jsxs("div",{className:"glass-card rounded-2xl overflow-hidden",children:[e.jsx("input",{ref:m,type:"file",accept:"image/*",onChange:async e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(s)if(s.type.startsWith("image/")){W(!0);try{const e=await(e=>new Promise((t,s)=>{const a=new FileReader;a.onload=e=>{var a;const r=new Image;r.onload=()=>{const e=document.createElement("canvas");let s=r.width,a=r.height;const l=1920;(s>l||a>l)&&(s>a?(a=a/s*l,s=l):(s=s/a*l,a=l)),e.width=s,e.height=a;const n=e.getContext("2d");null==n||n.drawImage(r,0,0,s,a);const i=e.toDataURL("image/jpeg",.7);t(i)},r.onerror=s,r.src=null==(a=e.target)?void 0:a.result},a.onerror=s,a.readAsDataURL(e)}))(s);U(e),i&&localStorage.setItem(`chat_background_${i}`,e),W(!1),alert("聊天壁纸已保存！")}catch(a){alert("图片处理失败，请重试"),W(!1)}}else alert("请选择图片文件")},className:"hidden"}),e.jsxs("div",{className:"px-4 py-4 flex items-center gap-3",children:[e.jsx("div",{className:"w-20 h-20 rounded-xl overflow-hidden border-2 border-gray-200 flex-shrink-0 flex items-center justify-center",style:{backgroundImage:R?`url(${R})`:"none",backgroundSize:"cover",backgroundPosition:"center",backgroundColor:R?"transparent":"#f5f7fa"},children:!R&&e.jsx(ds,{size:32,className:"text-gray-400"})}),e.jsxs("div",{className:"flex-1 flex gap-2",children:[e.jsx("button",{onClick:()=>{var e;return null==(e=m.current)?void 0:e.click()},disabled:O,className:"flex-1 px-4 py-2.5 bg-wechat-primary text-white rounded-xl ios-button font-medium text-sm",children:O?"上传中...":R?"更换":"上传壁纸"}),R&&e.jsx("button",{onClick:()=>{U(""),i&&localStorage.removeItem(`chat_background_${i}`),alert("聊天壁纸已删除，将使用全局背景")},className:"px-4 py-2.5 glass-card text-gray-700 rounded-xl ios-button font-medium text-sm",children:"移除"})]})]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"px-4 py-2",children:[e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"红包 & 转账封面"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"自定义红包和转账的背景图片"})]}),e.jsx("div",{className:"glass-card rounded-2xl p-4",children:e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[e.jsxs("div",{children:[e.jsx("input",{ref:J,type:"file",accept:"image/*",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(!s)return;if(!s.type.startsWith("image/"))return void alert("请选择图片文件");if(s.size>2097152)return void alert("图片大小不能超过2MB");const a=new FileReader;a.onloadend=()=>{const e=a.result;X(e),i&&localStorage.setItem(`red_envelope_cover_${i}`,e),alert("红包封面已保存！")},a.onerror=()=>{alert("图片读取失败")},a.readAsDataURL(s)},className:"hidden"}),e.jsx("div",{className:"text-sm font-medium text-gray-900 mb-2",children:"红包封面"}),e.jsxs("div",{onClick:()=>{var e;return null==(e=J.current)?void 0:e.click()},className:"relative w-full aspect-square rounded-xl overflow-hidden border-2 border-red-200 flex items-center justify-center bg-gradient-to-br from-red-500 to-orange-500 cursor-pointer hover:opacity-90 transition-opacity group",style:{backgroundImage:K?`url(${K})`:"none",backgroundSize:"cover",backgroundPosition:"center"},children:[!K&&e.jsx("span",{className:"text-5xl",children:"🧧"}),K&&e.jsx("button",{onClick:e=>{e.stopPropagation(),X(""),i&&localStorage.removeItem(`red_envelope_cover_${i}`),alert("红包封面已删除")},className:"absolute top-2 right-2 w-6 h-6 bg-black/50 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity text-xs",children:"×"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/50 to-transparent p-2 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsxs("p",{className:"text-white text-xs text-center",children:["点击",K?"更换":"上传"]})})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-1 text-center",children:"自定义红包的背景图片"})]}),e.jsxs("div",{children:[e.jsx("input",{ref:H,type:"file",accept:"image/*",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(!s)return;if(!s.type.startsWith("image/"))return void alert("请选择图片文件");if(s.size>1048576)return void alert("图片大小不能超过1MB");const a=new FileReader;a.onloadend=()=>{const e=a.result;Q(e),i&&localStorage.setItem(`red_envelope_icon_${i}`,e),alert("红包图标已保存！")},a.onerror=()=>{alert("图片读取失败")},a.readAsDataURL(s)},className:"hidden"}),e.jsx("div",{className:"text-sm font-medium text-gray-900 mb-2",children:"红包图标"}),e.jsxs("div",{onClick:()=>{var e;return null==(e=H.current)?void 0:e.click()},className:"relative w-full aspect-square rounded-xl overflow-hidden border-2 border-red-300 flex items-center justify-center bg-red-500 cursor-pointer hover:opacity-90 transition-opacity group",style:{backgroundImage:Z?`url(${Z})`:"none",backgroundSize:"cover",backgroundPosition:"center"},children:[!Z&&e.jsx("span",{className:"text-5xl text-white font-bold",children:"领"}),Z&&e.jsx("button",{onClick:e=>{e.stopPropagation(),Q(""),i&&localStorage.removeItem(`red_envelope_icon_${i}`),alert("红包图标已删除")},className:"absolute top-2 right-2 w-6 h-6 bg-black/50 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity text-xs",children:"×"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/50 to-transparent p-2 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsxs("p",{className:"text-white text-xs text-center",children:["点击",Z?"更换":"上传"]})})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-1 text-center",children:"红包卡片上的“领”字图标"})]}),e.jsxs("div",{children:[e.jsx("input",{ref:G,type:"file",accept:"image/*",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(!s)return;if(!s.type.startsWith("image/"))return void alert("请选择图片文件");if(s.size>2097152)return void alert("图片大小不能超过2MB");const a=new FileReader;a.onloadend=()=>{const e=a.result;ee(e),i&&localStorage.setItem(`transfer_cover_${i}`,e),alert("转账封面已保存！")},a.onerror=()=>{alert("图片读取失败")},a.readAsDataURL(s)},className:"hidden"}),e.jsx("div",{className:"text-sm font-medium text-gray-900 mb-2",children:"转账封面"}),e.jsxs("div",{onClick:()=>{var e;return null==(e=G.current)?void 0:e.click()},className:"relative w-full aspect-square rounded-xl overflow-hidden border-2 border-orange-200 flex items-center justify-center bg-gradient-to-br from-orange-400 to-yellow-400 cursor-pointer hover:opacity-90 transition-opacity group",style:{backgroundImage:Y?`url(${Y})`:"none",backgroundSize:"cover",backgroundPosition:"center"},children:[!Y&&e.jsx("span",{className:"text-5xl",children:"💰"}),Y&&e.jsx("button",{onClick:e=>{e.stopPropagation(),ee(""),i&&localStorage.removeItem(`transfer_cover_${i}`),alert("转账封面已删除")},className:"absolute top-2 right-2 w-6 h-6 bg-black/50 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity text-xs",children:"×"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/50 to-transparent p-2 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsxs("p",{className:"text-white text-xs text-center",children:["点击",Y?"更换":"上传"]})})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-1 text-center",children:"自定义转账的背景图片"})]}),e.jsxs("div",{children:[e.jsx("input",{ref:q,type:"file",accept:"image/*",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(!s)return;if(!s.type.startsWith("image/"))return void alert("请选择图片文件");if(s.size>1048576)return void alert("图片大小不能超过1MB");const a=new FileReader;a.onloadend=()=>{const e=a.result;se(e),i&&localStorage.setItem(`transfer_icon_${i}`,e),alert("转账图标已保存！")},a.onerror=()=>{alert("图片读取失败")},a.readAsDataURL(s)},className:"hidden"}),e.jsx("div",{className:"text-sm font-medium text-gray-900 mb-2",children:"转账图标"}),e.jsxs("div",{onClick:()=>{var e;return null==(e=q.current)?void 0:e.click()},className:"relative w-full aspect-square rounded-xl overflow-hidden border-2 border-orange-300 flex items-center justify-center bg-orange-500 cursor-pointer hover:opacity-90 transition-opacity group",style:{backgroundImage:te?`url(${te})`:"none",backgroundSize:"cover",backgroundPosition:"center"},children:[!te&&e.jsx("span",{className:"text-5xl text-white font-bold",children:"¥"}),te&&e.jsx("button",{onClick:e=>{e.stopPropagation(),se(""),i&&localStorage.removeItem(`transfer_icon_${i}`),alert("转账图标已删除")},className:"absolute top-2 right-2 w-6 h-6 bg-black/50 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity text-xs",children:"×"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/50 to-transparent p-2 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsxs("p",{className:"text-white text-xs text-center",children:["点击",te?"更换":"上传"]})})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-1 text-center",children:"卡片左上角的圆形图标"})]})]})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"px-4 py-2",children:[e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"旁白功能"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"AI会用旁白描述动作、表情、环境等"})]}),e.jsx("div",{className:"glass-card rounded-2xl overflow-hidden",children:e.jsxs("button",{onClick:()=>{const e=!p;f(e),i&&localStorage.setItem(`narrator_enabled_${i}`,String(e))},className:"w-full px-4 py-4 flex items-center justify-between ios-button",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium text-gray-900",children:"启用旁白"}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:p?"已开启":"已关闭"})]})}),e.jsx("div",{className:"w-12 h-7 rounded-full transition-all "+(p?"bg-wechat-primary":"bg-gray-300"),children:e.jsx("div",{className:"w-5 h-5 bg-white rounded-full mt-1 transition-all shadow-md "+(p?"ml-6":"ml-1")})})]})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"px-4 py-2",children:[e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"AI记忆长度"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"AI每次回复时读取的历史消息数量（包含通话记录）"})]}),e.jsxs("div",{className:"glass-card rounded-2xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:"读取消息数"}),e.jsxs("span",{className:"text-lg font-semibold text-wechat-primary",children:[N," 条"]})]}),e.jsx("input",{type:"range",min:"5",max:"200",step:"5",value:N,onChange:e=>{return t=parseInt(e.target.value),w(t),void localStorage.setItem("ai_message_limit",String(t));var t},className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-wechat-primary"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-400 mt-2",children:[e.jsx("span",{children:"5条"}),e.jsx("span",{children:"100条"}),e.jsx("span",{children:"200条"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-3",children:"💡 提示：数量越大，AI记忆越完整，但API消耗越多。建议30-100条。"})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"px-4 py-2",children:[e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"AI朋友圈"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"AI会主动发布朋友圈，并与你的朋友圈互动"})]}),e.jsx("div",{className:"glass-card rounded-2xl overflow-hidden",children:e.jsxs("button",{onClick:()=>{const e=!b;j(e),i&&localStorage.setItem(`ai_moments_enabled_${i}`,String(e))},className:"w-full px-4 py-4 flex items-center justify-between ios-button",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium text-gray-900",children:"启用AI朋友圈"}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:b?"已开启 - AI会主动发布和互动":"已关闭"})]})}),e.jsx("div",{className:"w-12 h-7 rounded-full transition-all "+(b?"bg-wechat-primary":"bg-gray-300"),children:e.jsx("div",{className:"w-5 h-5 bg-white rounded-full mt-1 transition-all shadow-md "+(b?"ml-6":"ml-1")})})]})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"px-4 py-2",children:[e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"AI主动发消息"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"AI会像真人一样主动发消息给你"})]}),e.jsx("div",{className:"glass-card rounded-2xl overflow-hidden",children:e.jsxs("button",{onClick:()=>{const e=!v;y(e),i&&(localStorage.setItem(`ai_proactive_enabled_${i}`,String(e)),window.dispatchEvent(new Event("storage")))},className:"w-full px-4 py-4 flex items-center justify-between ios-button",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium text-gray-900",children:"启用主动发消息"}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:v?"已开启 - AI会主动找你聊天":"已关闭"})]})}),e.jsx("div",{className:"w-12 h-7 rounded-full transition-all "+(v?"bg-wechat-primary":"bg-gray-300"),children:e.jsx("div",{className:"w-5 h-5 bg-white rounded-full mt-1 transition-all shadow-md "+(v?"ml-6":"ml-1")})})]})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"px-4 py-2",children:[e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"聊天气泡"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"自定义此聊天的气泡样式，优先于全局设置"})]}),e.jsx("div",{className:"glass-card rounded-2xl overflow-hidden",children:e.jsxs("button",{onClick:()=>D(!0),className:"w-full px-4 py-4 flex items-center justify-between ios-button",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium text-gray-900",children:"气泡样式"}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:S||_?"已自定义":"使用全局设置"})]})}),e.jsx("span",{className:"text-gray-400 text-xl",children:"›"})]})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"px-4 py-2",children:[e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"黑名单"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"拉黑后，对方的消息会显示警告图标，AI会意识到被拉黑"})]}),e.jsxs("div",{className:"glass-card rounded-2xl overflow-hidden",children:[e.jsx("button",{onClick:()=>{if(!i||!h)return;V.blockUser(i,"user");const e=JSON.parse(localStorage.getItem(`chat_messages_${i}`)||"[]"),t={id:Date.now(),type:"system",content:`${h.name} 已将你加入黑名单`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now()};e.push(t),localStorage.setItem(`chat_messages_${i}`,JSON.stringify(e)),alert(`🧪 测试功能：已模拟 ${h.name} 拉黑你\n\n✅ 拉黑时间戳：${Date.now()}\n✅ 已添加系统消息\n\n现在返回聊天发消息会显示红色感叹号⚠️`),l(`/chat/${i}`)},className:"w-full px-4 py-3 flex items-center justify-between ios-button text-left border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:"🧪"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium text-gray-900",children:"模拟AI拉黑我"}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:"测试被拉黑后的效果"})]})]})}),e.jsxs("button",{onClick:()=>{if(!i||!h)return;const e=V.toggleBlock("user",i);F(e),e?alert(`已将 ${h.name} 加入黑名单\n\nTA发送的消息将显示警告图标⚠️\nAI会意识到被拉黑`):alert(`已将 ${h.name} 移出黑名单`)},className:"w-full px-4 py-4 flex items-center justify-between ios-button",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 flex items-center justify-center",children:e.jsx("img",{src:P?"/拉黑.webp":"/没有拉黑.webp",alt:P?"已拉黑":"未拉黑",className:"w-8 h-8 object-contain"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium text-gray-900",children:P?"已拉黑":"未拉黑"}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:P?"TA的消息会显示警告图标":"正常聊天状态"})]})]}),e.jsx("div",{className:"w-12 h-7 rounded-full transition-all "+(P?"bg-red-500":"bg-gray-300"),children:e.jsx("div",{className:"w-5 h-5 bg-white rounded-full mt-1 transition-all shadow-md "+(P?"ml-6":"ml-1")})})]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"px-4 py-2",children:[e.jsx("span",{className:"text-sm text-red-600 font-medium",children:"危险操作"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"以下操作不可恢复，请谨慎操作"})]}),e.jsx("div",{className:"glass-card rounded-2xl overflow-hidden",children:e.jsxs("button",{onClick:()=>{confirm(`确定要清除与 ${h.name} 的所有聊天记录吗？\n\n将会清除：\n• 所有聊天消息\n• TA的日记\n• AI记忆\n• 记忆总结\n• 续火花记录\n\n此操作不可恢复！`)&&confirm("再次确认：真的要清除所有数据吗？")&&(localStorage.removeItem(`chat_messages_${i}`),localStorage.removeItem(`diaries_${i}`),localStorage.removeItem(`memories_${i}`),localStorage.removeItem(`memory_summary_${i}`),localStorage.removeItem(`initial_memories_extracted_${i}`),localStorage.removeItem(`streak_data_${i}`),localStorage.removeItem(`conversation_rounds_${i}`),alert("✅ 所有聊天记录已清除！"),l(`/chat/${i}`))},className:"w-full px-4 py-4 flex items-center justify-between ios-button hover:bg-red-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium text-red-600",children:"清除聊天记录"}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:"删除所有消息、日记、记忆等数据"})]})]}),e.jsx("span",{className:"text-red-400 text-xl",children:"›"})]})})]})]}),T&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"glass-card rounded-3xl w-full max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 glass-effect px-6 py-4 border-b border-gray-200/50 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"聊天气泡设置"}),e.jsx("button",{onClick:()=>D(!1),className:"text-gray-500 hover:text-gray-700 text-2xl",children:"×"})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4 p-4 bg-blue-50 rounded-xl border-2 border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-lg",children:"✨"}),e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"快速导入 CSS"})]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:["可以一次性粘贴整段 CSS 代码，支持完整的 CSS 语法（选择器、伪元素、动画等）。",e.jsx("br",{}),e.jsx("strong",{children:"⚡ 重要："}),"所有 CSS 属性都需要加 ",e.jsx("code",{className:"bg-white px-1 rounded",children:"!important"})," 才能覆盖默认样式。",e.jsx("br",{}),e.jsx("strong",{children:"💡 提示："}),'粘贴后点击下方按钮导入，然后点击底部"保存设置"。']}),e.jsx("textarea",{value:B,onChange:e=>E(e.target.value),className:"w-full h-48 px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-xs resize-none",placeholder:"粘贴你的 CSS 代码，例如：\n\n.message-container.sent .message-bubble {\n  background-color: #522f1c !important;\n  border: 4px solid #B8EFED !important;\n}\n\n.message-container.received .message-bubble {\n  background-color: #B8EFED !important;\n  border: 4px solid #522f1c !important;\n}"}),e.jsx("button",{onClick:()=>{if(B.trim())try{const e=B.trim();$(e),A(e),alert("✅ CSS 已导入！\n\n包含的样式将自动应用到气泡上。\n支持伪元素（::before, ::after）和所有 CSS 属性。")}catch(e){alert("CSS 解析失败，请检查格式")}else alert("请输入 CSS 代码")},className:"w-full px-4 py-3 bg-blue-500 text-white rounded-xl ios-button font-medium hover:bg-blue-600 transition-colors",children:"🔍 自动识别并应用"})]}),e.jsx("div",{className:"border-t border-gray-200 relative",children:e.jsx("span",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 bg-white px-3 text-sm text-gray-500",children:"或手动设置"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"我的气泡（发送）"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"气泡颜色（留空使用全局设置）"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"color",value:S||"#95EC69",onChange:e=>I(e.target.value),className:"w-16 h-10 rounded-lg border border-gray-300 cursor-pointer"}),e.jsx("input",{type:"text",value:S,onChange:e=>I(e.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-wechat-primary",placeholder:"留空使用全局设置"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"自定义CSS（高级）"}),e.jsx("textarea",{value:z,onChange:e=>$(e.target.value),className:"w-full h-32 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-wechat-primary font-mono text-sm resize-none",placeholder:"例如：\nbackground: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\nborder-radius: 16px;"})]}),e.jsx("div",{children:e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-xs text-yellow-800",children:["💡 ",e.jsx("strong",{children:"预览提示："}),"完整的 CSS（包含选择器和伪元素）无法在此预览，请保存后在聊天页面查看实际效果。"]})})})]}),e.jsx("div",{className:"border-t border-gray-200"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"对方气泡（接收）"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"气泡颜色（留空使用全局设置）"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"color",value:_||"#FFFFFF",onChange:e=>M(e.target.value),className:"w-16 h-10 rounded-lg border border-gray-300 cursor-pointer"}),e.jsx("input",{type:"text",value:_,onChange:e=>M(e.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-wechat-primary",placeholder:"留空使用全局设置"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"自定义CSS（高级）"}),e.jsx("textarea",{value:L,onChange:e=>A(e.target.value),className:"w-full h-32 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-wechat-primary font-mono text-sm resize-none",placeholder:"例如：\nbackground: #FFFFFF;\nborder: 1px solid #E5E5E5;"})]}),e.jsx("div",{children:e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-xs text-yellow-800",children:["💡 ",e.jsx("strong",{children:"预览提示："}),"完整的 CSS（包含选择器和伪元素）无法在此预览，请保存后在聊天页面查看实际效果。"]})})})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:()=>{confirm("确定要重置为全局气泡设置吗？")&&(I(""),M(""),$(""),A(""),i&&(localStorage.removeItem(`user_bubble_color_${i}`),localStorage.removeItem(`ai_bubble_color_${i}`),localStorage.removeItem(`user_bubble_css_${i}`),localStorage.removeItem(`ai_bubble_css_${i}`)),alert("已重置为全局气泡设置！"))},className:"flex-1 px-4 py-3 bg-gray-100 text-gray-700 rounded-xl ios-button font-medium",children:"重置为全局"}),e.jsx("button",{onClick:()=>{i&&(localStorage.setItem(`user_bubble_color_${i}`,S),localStorage.setItem(`ai_bubble_color_${i}`,_),localStorage.setItem(`user_bubble_css_${i}`,z),localStorage.setItem(`ai_bubble_css_${i}`,L),alert("气泡设置已保存！"),D(!1))},className:"flex-1 px-4 py-3 bg-wechat-primary text-white rounded-xl ios-button font-medium",children:"保存设置"})]})]})]})})]}):e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx("p",{className:"text-gray-500",children:"角色不存在"})})}},Symbol.toStringTag,{value:"Module"})),Ya=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{addCharacter:r}=n(),{showStatusBar:l}=o(),i=t.useRef(null),c=t.useRef(null),[d,x]=t.useState({name:"",nickname:"",username:"",avatar:"",signature:"",description:"",userInfo:"",personality:"",scenario:"",firstMessage:"",exampleMessages:"",systemPrompt:"",alternateGreetings:[],characterBook:void 0,tags:[],creator:"",onlineGreeting:"",offlineGreetings:[]}),[m,h]=t.useState(""),[u,g]=t.useState(!1),[p,f]=t.useState(!1),[b,j]=t.useState(null),[v,y]=t.useState("");return e.jsxs("div",{className:"h-full flex flex-col bg-gray-50",children:[e.jsxs("div",{className:"glass-effect sticky top-0 z-50",children:[l&&e.jsx(xa,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a(-1),className:"ios-button text-gray-700 hover:text-gray-900",children:"取消"}),e.jsx("h1",{className:"text-base font-semibold text-gray-900",children:"创建角色"}),e.jsx("button",{onClick:()=>{if(!d.name.trim())return void alert("请输入角色名字");const e=d.username||`wxid_${ye(d.name)||Date.now().toString().slice(-6)}`,t=d.avatar||"🤖";try{const l={name:d.name,username:e,avatar:t,signature:d.signature||"这个人很懒，什么都没留下",description:d.description,personality:d.personality||void 0,scenario:d.scenario||void 0,firstMessage:d.firstMessage||void 0,exampleMessages:d.exampleMessages||void 0,systemPrompt:d.systemPrompt||void 0,alternateGreetings:d.alternateGreetings.length>0?d.alternateGreetings:void 0,characterBook:d.characterBook,tags:d.tags.length>0?d.tags:void 0,creator:d.creator||void 0,onlineGreeting:d.onlineGreeting||void 0,offlineGreetings:d.offlineGreetings.length>0?d.offlineGreetings:void 0};let n=0;try{n=JSON.stringify(l).length}catch(s){throw new Error("角色数据包含无法序列化的内容")}if(n>5242880)throw new Error("角色数据过大（超过5MB），请减少内容或移除世界书");const i=r(l),c=sessionStorage.getItem("pending_character_avatar_description"),o=sessionStorage.getItem("pending_character_avatar_fingerprint");if(c&&(null==i?void 0:i.id)&&(localStorage.setItem(`character_avatar_description_${i.id}`,c),localStorage.setItem(`character_avatar_recognized_at_${i.id}`,Date.now().toString()),o&&localStorage.setItem(`character_avatar_fingerprint_${i.id}`,o),sessionStorage.removeItem("pending_character_avatar_description"),sessionStorage.removeItem("pending_character_avatar_fingerprint")),b&&i){const e=ie.getLorebook(b);if(e){const t=[...e.character_ids,i.id];ie.updateLorebook(b,{character_ids:t})}}setTimeout(()=>{a("/wechat/contacts")},100)}catch(l){l.message?alert(`创建失败：${l.message}`):"QuotaExceededError"===l.name?alert("存储空间不足！请到设置中清理缓存。"):alert("创建失败！请查看控制台了解详情。")}},className:"ios-button text-primary font-medium",children:"完成"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-3 pt-3",children:[e.jsxs("div",{className:"mb-3 px-1",children:[e.jsx("input",{ref:c,type:"file",accept:".png",onChange:async e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(s)if(s.type.includes("png")){f(!0);try{const e=await Ne(s);if(!e)throw new Error("无法解析 Character Card 数据");const t=new FileReader;t.onloadend=()=>{const s=t.result,a=we(e,s);a.characterBook,x({name:a.name,nickname:"",username:a.username,avatar:a.avatar,signature:a.signature,description:a.description,userInfo:a.userInfo||"",personality:a.personality||"",scenario:a.scenario||"",firstMessage:a.firstMessage||"",exampleMessages:a.exampleMessages||"",systemPrompt:a.systemPrompt||"",alternateGreetings:a.alternateGreetings||[],characterBook:a.characterBook,tags:a.tags||[],creator:a.creator||"",onlineGreeting:"",offlineGreetings:a.offlineGreetings||[]}),h(s),y(""),f(!1);let r=!1;if(a.characterBook&&a.characterBook.entries&&a.characterBook.entries.length>0){const e=a.characterBook.entries.length;if(confirm(`检测到角色卡包含世界书（${e} 个条目）\n\n是否同时导入到世界书系统？\n\n• 点击"确定"：导入世界书并关联到该角色\n• 点击"取消"：仅保存在角色数据中`))try{const e={name:`${a.name}的世界书`,description:"从 Character Card 导入的世界书",entries:a.characterBook.entries||[],scan_depth:a.characterBook.scan_depth||10,token_budget:a.characterBook.token_budget||2e3,recursive_scanning:a.characterBook.recursive_scanning||!1,is_global:!1,character_ids:[]},t=ie.importLorebook(JSON.stringify(e));t&&(r=!0,j(t.id))}catch(i){alert("世界书导入失败，但角色数据已保留")}}const l="chara_card_v2"===e.spec?"V2":"V1",n=r?"\n✅ 世界书已导入":"";alert(`✅ 成功导入 Character Card ${l}!\n\n角色名: ${a.name}\n创建者: ${a.creator||"未知"}${n}`)},t.onerror=()=>{alert("图片读取失败"),f(!1)},t.readAsDataURL(s)}catch(a){alert(`导入失败: ${a.message||"未知错误"}`),f(!1)}e.target.value=""}else alert("请选择 PNG 格式的 Character Card 文件")},className:"hidden"}),e.jsx("button",{onClick:()=>{var e;return null==(e=c.current)?void 0:e.click()},disabled:p,className:"glass-card rounded-xl px-4 py-3 flex items-center gap-3 ios-button w-full hover:bg-white/50 transition-all",children:p?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-gray-400 border-t-transparent"}),e.jsx("div",{className:"text-left",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:"正在导入..."})})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),e.jsxs("div",{className:"text-left flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:"导入 Character Card"}),e.jsx("div",{className:"text-xs text-gray-500",children:"PNG 格式 (V1/V2)"})]})]})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"px-4 py-2",children:[e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"角色头像"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"可选，不上传将使用默认头像。支持 JPG、PNG、GIF 等格式"})]}),e.jsxs("div",{className:"glass-card rounded-2xl p-6 flex justify-center",children:[e.jsx("input",{ref:i,type:"file",accept:"image/*",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(!s)return;if(!s.type.startsWith("image/"))return void alert("请选择图片文件");g(!0);const a=new FileReader;a.onloadend=async()=>{const e=a.result;h(e),x({...d,avatar:e});try{const t=await fetch("/.netlify/functions/vision",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:e,prompt:"详细描述这个头像的内容，包括：角色特征、风格、颜色、表情、氛围等。请用简洁的语言描述。"})});if(t.ok){const s=await t.json(),a=s.description||s.result;sessionStorage.setItem("pending_character_avatar_description",a),sessionStorage.setItem("pending_character_avatar_fingerprint",e.substring(0,200))}}catch(t){}g(!1)},a.onerror=()=>{alert("图片读取失败"),g(!1)},a.readAsDataURL(s)},className:"hidden"}),e.jsx("button",{onClick:()=>{var e;return null==(e=i.current)?void 0:e.click()},disabled:u,className:"relative w-32 h-32 rounded-2xl bg-gray-100 border-2 border-dashed border-gray-300 flex flex-col items-center justify-center ios-button overflow-hidden",children:m?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:m,alt:"头像预览",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-20 transition-all flex items-center justify-center",children:e.jsx("span",{className:"text-white opacity-0 hover:opacity-100 text-sm",children:"点击更换"})})]}):e.jsx(e.Fragment,{children:u?e.jsx("div",{className:"text-gray-400",children:"上传中..."}):e.jsxs(e.Fragment,{children:[e.jsx(ds,{size:32,className:"text-gray-400 mb-2"}),e.jsx("span",{className:"text-sm text-gray-500",children:"上传头像"})]})})})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"角色信息"})}),e.jsxs("div",{className:"glass-card rounded-2xl",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"真实名字 *"}),e.jsx("input",{type:"text",value:d.name,onChange:e=>{return t=e.target.value,void x(e=>{if((!e.username||e.username.startsWith("wxid_"))&&t){const s=ye(t);return{...e,name:t,username:`wxid_${s||Date.now().toString().slice(-6)}`}}return{...e,name:t}});var t},placeholder:"请输入角色真实名字",maxLength:20,className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})]}),e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsxs("label",{className:"block text-xs text-gray-500 mb-1",children:["网名",e.jsx("span",{className:"text-gray-400 ml-2",children:"（留空则显示真实名字）"})]}),e.jsx("input",{type:"text",value:d.nickname,onChange:e=>x({...d,nickname:e.target.value}),placeholder:"角色的网名，AI可自主修改",maxLength:20,className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})]}),e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsxs("label",{className:"block text-xs text-gray-500 mb-1",children:["角色ID账号",e.jsx("span",{className:"text-gray-400 ml-2",children:"（留空自动生成）"})]}),e.jsx("input",{type:"text",value:d.username,onChange:e=>x({...d,username:e.target.value}),placeholder:`wxid_${ye(d.name)||"auto"}`,className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})]}),e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"个性签名"}),e.jsx("textarea",{value:d.signature,onChange:e=>x({...d,signature:e.target.value}),placeholder:"显示在用户资料的个性签名",maxLength:100,className:"w-full h-16 bg-transparent border-none outline-none text-gray-900 placeholder-gray-400 resize-none"}),e.jsxs("div",{className:"text-right text-xs text-gray-400 mt-1",children:[d.signature.length,"/100"]})]}),e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"线上开场白 💬"}),e.jsx("textarea",{value:d.onlineGreeting,onChange:e=>x({...d,onlineGreeting:e.target.value}),placeholder:"AI在线上聊天时的第一句话（可选，不填则AI自由发挥）",maxLength:500,className:"w-full h-20 bg-transparent border-none outline-none text-gray-900 placeholder-gray-400 resize-none"}),e.jsxs("div",{className:"text-right text-xs text-gray-400 mt-1",children:[d.onlineGreeting.length,"/500"]})]}),e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsxs("label",{className:"block text-xs text-gray-500 mb-1",children:["线下开场白 🎭",d.offlineGreetings.length>0&&e.jsxs("span",{className:"text-gray-600 ml-2",children:["(",d.offlineGreetings.length," 个)"]})]}),e.jsx("div",{className:"text-xs text-gray-400 mb-2",children:"用于线下见面应用的开场白（可手动添加，或从ST角色卡导入）"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("textarea",{value:v,onChange:e=>y(e.target.value),placeholder:"输入一个新的线下开场白（支持HTML）...",maxLength:5e4,className:"w-full h-32 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm text-gray-900 placeholder-gray-400 resize-none focus:outline-none focus:border-blue-400"}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsxs("span",{className:"text-xs text-gray-400",children:[v.length,"/50000"]}),e.jsx("button",{type:"button",onClick:()=>{v.trim()&&(x({...d,offlineGreetings:[...d.offlineGreetings,v.trim()]}),y(""))},className:"px-4 py-2 rounded-lg text-sm transition-colors "+(v.trim().length>0?"bg-blue-500 text-white hover:bg-blue-600 cursor-pointer":"bg-gray-300 text-gray-500 cursor-not-allowed"),disabled:0===v.trim().length,children:"+ 添加开场白"})]})]}),d.offlineGreetings.length>0?e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:d.offlineGreetings.map((t,s)=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 relative",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:["开场白 ",s+1]}),e.jsxs("div",{className:"text-xs text-gray-400",children:[t.length," 字符"]})]}),e.jsx("div",{className:"text-sm text-gray-700 pr-8 whitespace-pre-wrap break-words max-h-32 overflow-y-auto",children:t}),e.jsx("button",{type:"button",onClick:()=>{const e=d.offlineGreetings.filter((e,t)=>t!==s);x({...d,offlineGreetings:e})},className:"absolute top-2 right-2 w-6 h-6 bg-red-500 text-white rounded-full text-xs hover:bg-red-600 transition-colors",children:"×"})]},s))}):e.jsx("div",{className:"text-xs text-gray-400 italic text-center py-2",children:"暂无线下开场白，可手动添加或从ST角色卡导入"})]}),e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"AI角色描述（关于TA自己）"}),e.jsx("textarea",{value:d.description,onChange:e=>x({...d,description:e.target.value}),placeholder:"描述AI角色的背景、性格、说话风格等，用于AI角色扮演（建议详细描述，字数越多AI理解越准确）",maxLength:5e3,className:"w-full h-48 bg-transparent border-none outline-none text-gray-900 placeholder-gray-400 resize-none"}),e.jsxs("div",{className:"text-right text-xs text-gray-400 mt-1",children:[d.description.length,"/5000"]})]}),e.jsxs("div",{className:"px-4 py-3",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"关于对话者（关于你）"}),e.jsx("textarea",{value:d.userInfo,onChange:e=>x({...d,userInfo:e.target.value}),placeholder:"描述对话者的信息：身份、职业、你们的关系等。AI会记住这些，不会重复询问。例如：你是我的男/女朋友，我们相恋2年了，我是程序员...",maxLength:2e3,className:"w-full h-32 bg-transparent border-none outline-none text-gray-900 placeholder-gray-400 resize-none"}),e.jsxs("div",{className:"text-right text-xs text-gray-400 mt-1",children:[d.userInfo.length,"/2000"]})]})]})]}),e.jsx("div",{className:"glass-card rounded-2xl p-4 mb-6",children:e.jsxs("div",{className:"text-xs text-gray-500 space-y-2",children:[e.jsxs("p",{children:["• ",e.jsx("strong",{children:"角色名字："}),"必填，用于显示在微信界面中"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"角色ID："}),"可选，不填写系统会自动根据名字拼音生成"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"个性签名："}),"可选，显示在用户资料页"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"AI角色描述："}),"可选，描述AI的背景、性格、说话方式等"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"关于对话者："}),"可选但强烈推荐！让AI知道你是谁，避免重复询问"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"头像："}),"可选，不上传将使用默认机器人表情"]})]})})]})]})}},Symbol.toStringTag,{value:"Module"})),er=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{id:l}=r(),{getCharacter:i,updateCharacter:c}=n(),o=t.useRef(null),d=l?i(l):void 0,[x,m]=t.useState({name:(null==d?void 0:d.name)||"",nickname:(null==d?void 0:d.nickname)||"",username:(null==d?void 0:d.username)||"",avatar:(null==d?void 0:d.avatar)||"",signature:(null==d?void 0:d.signature)||"",description:(null==d?void 0:d.description)||"",onlineGreeting:(null==d?void 0:d.onlineGreeting)||"",offlineGreetings:(null==d?void 0:d.offlineGreetings)||[]}),[h,u]=t.useState((null==d?void 0:d.avatar)||""),[g,p]=t.useState(!1),[f,b]=t.useState("");if(t.useEffect(()=>{d&&(m({name:d.name,nickname:d.nickname||"",username:d.username,avatar:d.avatar,signature:d.signature,description:d.description,onlineGreeting:d.onlineGreeting||"",offlineGreetings:d.offlineGreetings||[]}),u(d.avatar))},[d]),!d)return e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx("p",{className:"text-gray-500",children:"角色不存在"})});return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"glass-effect px-4 py-3 flex items-center justify-between border-b border-gray-200/50",children:[e.jsx("button",{onClick:()=>a(-1),className:"ios-button text-gray-700 hover:text-gray-900",children:"取消"}),e.jsx("h1",{className:"text-base font-semibold text-gray-900",children:"编辑角色"}),e.jsx("button",{onClick:()=>{if(!x.name.trim())return void alert("请输入角色名字");if(!x.avatar)return void alert("请上传角色头像");const e=x.username||`wxid_${ye(x.name)||Date.now().toString().slice(-6)}`;c(d.id,{...x,username:e,signature:x.signature||"这个人很懒，什么都没留下",description:x.description}),a(`/character/${d.id}`)},className:"ios-button text-primary font-medium",children:"完成"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-3 pt-3",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"px-4 py-2",children:[e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"角色头像"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"点击上传本地图片，支持 JPG、PNG、GIF 格式，大小不超过 5MB"})]}),e.jsxs("div",{className:"glass-card rounded-2xl p-6 flex justify-center",children:[e.jsx("input",{ref:o,type:"file",accept:"image/*",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(!s)return;if(!s.type.startsWith("image/"))return void alert("请选择图片文件");if(s.size>5242880)return void alert("图片大小不能超过5MB");p(!0);const a=new FileReader;a.onloadend=async()=>{const e=a.result;if(u(e),m({...x,avatar:e}),null==d?void 0:d.id)try{const t=await fetch("/.netlify/functions/vision",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:e,prompt:"详细描述这个头像的内容，包括：角色特征、风格、颜色、表情、氛围等。请用简洁的语言描述。"})});if(t.ok){const s=await t.json(),a=s.description||s.result;localStorage.setItem(`character_avatar_description_${d.id}`,a),localStorage.setItem(`character_avatar_recognized_at_${d.id}`,Date.now().toString()),localStorage.setItem(`character_avatar_fingerprint_${d.id}`,e.substring(0,200))}}catch(t){}p(!1)},a.onerror=()=>{alert("图片读取失败"),p(!1)},a.readAsDataURL(s)},className:"hidden"}),e.jsx("button",{onClick:()=>{var e;return null==(e=o.current)?void 0:e.click()},disabled:g,className:"relative w-32 h-32 rounded-2xl bg-gray-100 border-2 border-dashed border-gray-300 flex flex-col items-center justify-center ios-button overflow-hidden",children:h?e.jsxs(e.Fragment,{children:[h.startsWith("data:image")?e.jsx("img",{src:h,alt:"头像预览",className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-5xl",children:h}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-20 transition-all flex items-center justify-center",children:e.jsx("span",{className:"text-white opacity-0 hover:opacity-100 text-sm",children:"点击更换"})})]}):e.jsx(e.Fragment,{children:g?e.jsx("div",{className:"text-gray-400",children:"上传中..."}):e.jsxs(e.Fragment,{children:[e.jsx(ds,{size:32,className:"text-gray-400 mb-2"}),e.jsx("span",{className:"text-sm text-gray-500",children:"上传头像"})]})})})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"角色信息"})}),e.jsxs("div",{className:"glass-card rounded-2xl overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"真实名字 *"}),e.jsx("input",{type:"text",value:x.name,onChange:e=>{return t=e.target.value,void m(e=>{if((!e.username||e.username.startsWith("wxid_"))&&t){const s=ye(t);return{...e,name:t,username:`wxid_${s||Date.now().toString().slice(-6)}`}}return{...e,name:t}});var t},placeholder:"请输入角色真实名字",maxLength:20,className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})]}),e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsxs("label",{className:"block text-xs text-gray-500 mb-1",children:["网名",e.jsx("span",{className:"text-gray-400 ml-2",children:"（留空则显示真实名字，AI可修改）"})]}),e.jsx("input",{type:"text",value:x.nickname,onChange:e=>m({...x,nickname:e.target.value}),placeholder:"角色的网名",maxLength:20,className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})]}),e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsxs("label",{className:"block text-xs text-gray-500 mb-1",children:["角色ID账号",e.jsx("span",{className:"text-gray-400 ml-2",children:"（留空自动生成）"})]}),e.jsx("input",{type:"text",value:x.username,onChange:e=>m({...x,username:e.target.value}),placeholder:`wxid_${ye(x.name)||"auto"}`,className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})]}),e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"个性签名"}),e.jsx("textarea",{value:x.signature,onChange:e=>m({...x,signature:e.target.value}),placeholder:"显示在用户资料的个性签名",maxLength:100,className:"w-full h-16 bg-transparent border-none outline-none text-gray-900 placeholder-gray-400 resize-none"}),e.jsxs("div",{className:"text-right text-xs text-gray-400 mt-1",children:[(x.signature||"").length,"/100"]})]}),e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"线上开场白 💬"}),e.jsx("textarea",{value:x.onlineGreeting,onChange:e=>m({...x,onlineGreeting:e.target.value}),placeholder:"AI在线上聊天时的第一句话（可选，不填则AI自由发挥）",maxLength:500,className:"w-full h-20 bg-transparent border-none outline-none text-gray-900 placeholder-gray-400 resize-none"}),e.jsxs("div",{className:"text-right text-xs text-gray-400 mt-1",children:[(x.onlineGreeting||"").length,"/500"]})]}),e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsxs("label",{className:"block text-xs text-gray-500 mb-1",children:["线下开场白 🎭",x.offlineGreetings.length>0&&e.jsxs("span",{className:"text-gray-600 ml-2",children:["(",x.offlineGreetings.length," 个)"]})]}),e.jsx("div",{className:"text-xs text-gray-400 mb-2",children:"用于线下见面应用的开场白（可手动添加，或从ST角色卡导入）"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("textarea",{value:f,onChange:e=>b(e.target.value),placeholder:"输入一个新的线下开场白（支持HTML）...",maxLength:5e4,className:"w-full h-32 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm text-gray-900 placeholder-gray-400 resize-none focus:outline-none focus:border-blue-400"}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsxs("span",{className:"text-xs text-gray-400",children:[f.length,"/50000"]}),e.jsx("button",{type:"button",onClick:()=>{f.trim()&&(m({...x,offlineGreetings:[...x.offlineGreetings,f.trim()]}),b(""))},className:"px-4 py-2 rounded-lg text-sm transition-colors "+(f.trim().length>0?"bg-blue-500 text-white hover:bg-blue-600 cursor-pointer":"bg-gray-300 text-gray-500 cursor-not-allowed"),disabled:0===f.trim().length,children:"+ 添加开场白"})]})]}),x.offlineGreetings.length>0?e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:x.offlineGreetings.map((t,s)=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 relative",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:["开场白 ",s+1]}),e.jsxs("div",{className:"text-xs text-gray-400",children:[t.length," 字符"]})]}),e.jsx("div",{className:"text-sm text-gray-700 pr-8 whitespace-pre-wrap break-words max-h-32 overflow-y-auto",children:t}),e.jsx("button",{type:"button",onClick:()=>{const e=x.offlineGreetings.filter((e,t)=>t!==s);m({...x,offlineGreetings:e})},className:"absolute top-2 right-2 w-6 h-6 bg-red-500 text-white rounded-full text-xs hover:bg-red-600 transition-colors",children:"×"})]},s))}):e.jsx("div",{className:"text-xs text-gray-400 italic text-center py-2",children:"暂无线下开场白"})]}),e.jsxs("div",{className:"px-4 py-3",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"AI角色描述"}),e.jsx("textarea",{value:x.description,onChange:e=>m({...x,description:e.target.value}),placeholder:"描述AI角色的背景、性格、说话风格等，用于AI角色扮演（建议详细描述，字数越多AI理解越准确）",maxLength:5e3,className:"w-full h-48 bg-transparent border-none outline-none text-gray-900 placeholder-gray-400 resize-none"}),e.jsxs("div",{className:"text-right text-xs text-gray-400 mt-1",children:[(x.description||"").length,"/5000"]})]})]})]}),e.jsx("div",{className:"glass-card rounded-2xl p-4 mb-6",children:e.jsxs("div",{className:"text-xs text-gray-500 space-y-2",children:[e.jsxs("p",{children:["💡 ",e.jsx("strong",{children:"角色名字："}),"用于显示在微信界面中"]}),e.jsxs("p",{children:["🆔 ",e.jsx("strong",{children:"角色ID："}),"如果不填写，系统会自动根据角色名字的拼音生成 wxid_xxx 格式的ID"]}),e.jsxs("p",{children:["✍️ ",e.jsx("strong",{children:"个性签名："}),"显示在用户资料页的签名，对外展示"]}),e.jsxs("p",{children:["🤖 ",e.jsx("strong",{children:"AI角色描述："}),"描述AI的背景、性格、说话方式等，用于AI角色扮演（后续接入API时使用）"]}),e.jsxs("p",{children:["🖼️ ",e.jsx("strong",{children:"头像："}),"支持本地上传图片，建议使用正方形图片"]})]})})]})]})}},Symbol.toStringTag,{value:"Module"})),tr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{id:l}=r(),{getCharacter:i,deleteCharacter:c}=n(),{showStatusBar:d}=o(),[x,m]=t.useState(!1),h=l?i(l):void 0;if(!h)return e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx("p",{className:"text-gray-500",children:"角色不存在"})});const u=h.avatar&&h.avatar.startsWith("data:image");return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"glass-effect sticky top-0 z-50",children:[d&&e.jsx(xa,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a("/wechat/contacts"),className:"ios-button text-gray-700 hover:text-gray-900 -ml-2",children:e.jsx(ls,{size:24})}),e.jsx("h1",{className:"text-base font-semibold text-gray-900",children:"角色详情"}),e.jsxs("div",{className:"relative z-50",children:[e.jsx("button",{onClick:()=>m(!x),className:"ios-button text-gray-700 hover:text-gray-900",children:e.jsx(ns,{size:24})}),x&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>m(!1)}),e.jsxs("div",{className:"absolute right-0 top-full mt-2 w-32 glass-card rounded-xl shadow-xl z-50 overflow-hidden",children:[e.jsx("button",{onClick:()=>{m(!1),a(`/edit-character/${h.id}`)},className:"w-full px-4 py-3 text-left text-gray-900 hover:bg-gray-50 ios-button border-b border-gray-100",children:"编辑角色"}),e.jsx("button",{onClick:()=>{confirm(`确定要删除角色"${h.name}"吗？`)&&(c(h.id),a("/wechat/contacts"))},className:"w-full px-4 py-3 text-left text-red-500 hover:bg-gray-50 ios-button",children:"删除角色"})]})]})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-3 pt-3",children:[e.jsx("div",{className:"mb-3",children:e.jsx("div",{className:"glass-card rounded-2xl overflow-hidden",children:e.jsxs("div",{className:"flex items-center justify-between px-4 py-4",children:[e.jsx("span",{className:"text-gray-900 font-medium",children:"头像"}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-gray-200 flex items-center justify-center shadow-lg overflow-hidden",children:u?e.jsx("img",{src:h.avatar,alt:"头像",className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-3xl",children:h.avatar||"🤖"})})})]})})}),e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"glass-card rounded-2xl overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-4 border-b border-gray-100",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"真实名字"}),e.jsx("div",{className:"text-gray-900",children:h.name})]}),e.jsxs("div",{className:"px-4 py-4 border-b border-gray-100",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"网名"}),e.jsx("div",{className:"text-gray-900",children:h.nickname||h.name})]}),e.jsxs("div",{className:"px-4 py-4 border-b border-gray-100",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"角色ID"}),e.jsx("div",{className:"text-gray-600",children:h.username})]}),e.jsxs("div",{className:"px-4 py-4 border-b border-gray-100",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"个性签名"}),e.jsx("div",{className:"text-gray-600 min-h-[40px]",children:h.signature||"这个人很懒，什么都没留下"})]}),e.jsxs("div",{className:"px-4 py-4",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"AI角色描述"}),e.jsx("div",{className:"text-gray-600 whitespace-pre-wrap min-h-[60px]",children:h.description||"暂无角色描述"})]})]})}),e.jsx("div",{className:"mb-6",children:e.jsx("button",{onClick:()=>a(`/chat/${h.id}`),className:"w-full glass-card rounded-2xl px-4 py-4 text-primary font-medium ios-button",children:"发送消息"})})]})]})}},Symbol.toStringTag,{value:"Module"})),sr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),[r,l]=t.useState(!1),[n,i]=t.useState(null),[c,o]=t.useState(!1),[d,x]=t.useState([]),[m,h]=t.useState(!1),[u,g]=t.useState(()=>ke(Ce.API_SETTINGS,{baseUrl:"",apiKey:"",model:"",provider:"custom",temperature:.7,maxTokens:2e3})),p=[{value:"google",label:"Google Gemini",example:"https://generativelanguage.googleapis.com/v1beta"},{value:"openai",label:"OpenAI",example:"https://api.openai.com/v1"},{value:"siliconflow",label:"SiliconFlow",example:"https://api.siliconflow.cn/v1"},{value:"custom",label:"自定义API",example:"https://your-api-endpoint.com/v1"}];return e.jsxs("div",{className:"h-full flex flex-col bg-[#f5f7fa]",children:[e.jsxs("div",{className:"glass-effect border-b border-gray-200/50",children:[e.jsx(xa,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a(-1),className:"ios-button text-blue-500 -ml-2 relative z-10",children:e.jsx(ls,{size:24})}),e.jsx("h1",{className:"text-base font-semibold text-gray-900 absolute left-1/2 transform -translate-x-1/2 pointer-events-none",children:"API配置"}),e.jsx("button",{onClick:()=>{u.baseUrl&&u.apiKey&&u.model?(R(Ce.API_SETTINGS,u),i(null),alert("API配置已保存")):alert("请填写完整的API配置")},className:"ios-button text-blue-500 font-medium",children:"保存"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-3 pt-3",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"API提供商"})}),e.jsx("div",{className:"glass-card rounded-2xl overflow-hidden",children:p.map((t,s)=>e.jsx("div",{children:e.jsxs("button",{onClick:()=>(e=>{const t=p.find(t=>t.value===e);g({...u,provider:e,baseUrl:(null==t?void 0:t.example)||""}),x([]),h(!1)})(t.value),className:"w-full flex items-center justify-between px-4 py-3 ios-button "+(s<p.length-1?"border-b border-gray-100":""),children:[e.jsx("span",{className:"text-gray-900 font-medium",children:t.label}),e.jsx("div",{className:"w-5 h-5 rounded-full border-2 flex items-center justify-center "+(u.provider===t.value?"border-primary":"border-gray-300"),children:u.provider===t.value&&e.jsx("div",{className:"w-3 h-3 rounded-full bg-primary"})})]})},t.value))})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"API地址"})}),e.jsx("div",{className:"glass-card rounded-2xl p-4",children:e.jsx("input",{type:"text",value:u.baseUrl,onChange:e=>g({...u,baseUrl:e.target.value}),placeholder:"https://api.example.com/v1",className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"API密钥"})}),e.jsx("div",{className:"glass-card rounded-2xl p-4",children:e.jsx("input",{type:"password",value:u.apiKey,onChange:e=>g({...u,apiKey:e.target.value}),placeholder:"sk-...",className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"px-4 py-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"模型名称"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["google"===u.provider&&"例如: gemini-1.5-flash, gemini-1.5-pro","openai"===u.provider&&"例如: gpt-3.5-turbo, gpt-4","siliconflow"===u.provider&&"例如: Qwen/Qwen2-7B-Instruct","custom"===u.provider&&"请输入您的模型名称"]})]}),e.jsx("button",{onClick:async()=>{if(u.baseUrl&&u.apiKey){if(!c){o(!0),i(null);try{const e=await Se(u);0===e.length?i({success:!1,message:"未找到可用模型，请手动输入"}):(x(e),h(!0),i({success:!0,message:`成功拉取 ${e.length} 个模型`}))}catch(e){i({success:!1,message:e.message||"拉取模型失败"})}finally{o(!1)}}}else alert("请先填写API地址和密钥")},disabled:c,className:"ml-2 px-3 py-1.5 bg-primary text-white text-xs rounded-lg ios-button",children:c?"拉取中...":"拉取模型"})]}),e.jsx("div",{className:"glass-card rounded-2xl p-4",children:e.jsx("input",{type:"text",value:u.model,onChange:e=>g({...u,model:e.target.value}),placeholder:"google"===u.provider?"gemini-1.5-flash":"openai"===u.provider?"gpt-3.5-turbo":"model-name",className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})})]}),m&&d.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"选择模型"})}),e.jsx("div",{className:"glass-card rounded-2xl overflow-hidden max-h-60 overflow-y-auto",children:d.map((t,s)=>e.jsxs("button",{onClick:()=>(e=>{g({...u,model:e}),h(!1)})(t),className:"w-full flex items-center justify-between px-4 py-3 ios-button text-left "+(s<d.length-1?"border-b border-gray-100":""),children:[e.jsx("span",{className:"text-sm "+(u.model===t?"text-primary font-medium":"text-gray-900"),children:t}),u.model===t&&e.jsx("span",{className:"text-primary text-xl",children:"✓"})]},t))})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"高级设置"})}),e.jsxs("div",{className:"glass-card rounded-2xl overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-2",children:"温度 (Temperature)"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"range",min:"0",max:"2",step:"0.1",value:u.temperature??.7,onChange:e=>g({...u,temperature:parseFloat(e.target.value)}),className:"flex-1"}),e.jsx("span",{className:"text-gray-900 font-mono text-sm w-10 text-right",children:(u.temperature??.7).toFixed(1)})]})]}),e.jsxs("div",{className:"px-4 py-3",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-2",children:"最大Token数"}),e.jsx("input",{type:"number",value:u.maxTokens??2e3,onChange:e=>g({...u,maxTokens:parseInt(e.target.value)}),placeholder:"2000",className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})]})]})]}),e.jsx("div",{className:"mb-3",children:e.jsx("button",{onClick:async()=>{if(u.baseUrl&&u.apiKey&&u.model){if(!r){R(Ce.API_SETTINGS,u),l(!0),i(null);try{const e=await Ie();i(e?{success:!0,message:"API连接成功"}:{success:!1,message:"API连接失败，请检查配置"})}catch(e){i({success:!1,message:e.message||"API连接失败"})}finally{l(!1)}}}else alert("请先填写API配置")},disabled:r,className:"w-full glass-card rounded-2xl px-4 py-4 text-gray-900 font-medium ios-button",children:r?"测试中...":"测试API连接"})}),n&&e.jsx("div",{className:"mb-3 glass-card rounded-2xl p-4 "+(n.success?"border-green-500 border":"border-red-500 border"),children:e.jsx("p",{className:"text-sm "+(n.success?"text-green-600":"text-red-600"),children:n.message})}),e.jsx("div",{className:"glass-card rounded-2xl p-4 mb-6",children:e.jsxs("div",{className:"text-xs text-gray-500 space-y-2",children:[e.jsx("p",{className:"font-semibold text-gray-700 mb-2",children:"配置说明："}),e.jsx("p",{children:"1. 选择您的API提供商"}),e.jsx("p",{children:"2. 填写API地址（系统会自动选择）"}),e.jsx("p",{children:"3. 填写您的API密钥"}),e.jsx("p",{children:"4. 输入模型名称"}),e.jsx("p",{children:'5. 点击"测试API连接"验证配置'}),e.jsx("p",{children:'6. 测试成功后点击"保存"'})]})})]})]})}},Symbol.toStringTag,{value:"Module"})),ar=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const t=s(),{apiConfigs:a,currentApiId:r,switchApiConfig:l,deleteApiConfig:n}=b();return e.jsxs("div",{className:"h-full flex flex-col bg-[#f5f7fa]",children:[e.jsxs("div",{className:"glass-effect border-b border-gray-200/50",children:[e.jsx(xa,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>t(-1),className:"ios-button text-blue-500 -ml-2 relative z-10",children:e.jsx(ls,{size:24})}),e.jsx("h1",{className:"text-base font-semibold text-gray-900 absolute left-1/2 transform -translate-x-1/2 pointer-events-none",children:"API管理"}),e.jsx("button",{onClick:()=>t("/wechat/add-api"),className:"ios-button text-blue-500",children:e.jsx(rs,{size:24})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-3 pt-3",children:0===a.length?e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{className:"text-gray-400 text-base",children:"暂无API配置"}),e.jsx("p",{className:"text-gray-400 text-xs mt-2",children:'点击右上角"+"添加API'})]}):e.jsx("div",{className:"space-y-3 mb-6",children:a.map(s=>{const i=r===s.id;return e.jsx("div",{onClick:()=>(e=>{l(e);const s=a.find(t=>t.id===e);s&&R(Ce.API_SETTINGS,{baseUrl:s.baseUrl,apiKey:s.apiKey,model:s.model,provider:s.provider,temperature:s.temperature,maxTokens:s.maxTokens}),t(-1)})(s.id),className:"glass-card rounded-2xl p-4 ios-button cursor-pointer "+(i?"ring-2 ring-primary":""),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.name}),i&&e.jsx("span",{className:"text-xs px-2 py-0.5 bg-primary text-white rounded-full",children:"当前"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-xs text-gray-500",children:[e.jsx("span",{className:"font-medium",children:"提供商："}),(c=s.provider,{google:"Google Gemini",openai:"OpenAI",siliconflow:"SiliconFlow",claude:"Claude",custom:"自定义"}[c]||c)]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[e.jsx("span",{className:"font-medium",children:"模型："}),s.model]}),e.jsxs("p",{className:"text-xs text-gray-400 truncate",children:[e.jsx("span",{className:"font-medium",children:"地址："}),s.baseUrl]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 ml-2",children:["default-siliconflow"!==s.id&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:e=>{e.stopPropagation(),t(`/edit-api/${s.id}`)},className:"px-3 py-1 text-xs text-primary ios-button whitespace-nowrap",children:"编辑"}),a.length>1&&e.jsx("button",{onClick:e=>((e,t)=>{t.stopPropagation(),confirm("确定要删除这个API配置吗？")&&n(e)})(s.id,e),className:"px-3 py-1 text-xs text-red-500 ios-button whitespace-nowrap",children:"删除"})]}),"default-siliconflow"===s.id&&e.jsx("span",{className:"text-xs text-gray-400 px-2",children:"内置"})]})]})},s.id);var c})})})]})}},Symbol.toStringTag,{value:"Module"})),rr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{addApiConfig:r}=b(),[l,n]=t.useState({name:"",baseUrl:"",apiKey:"",model:"",provider:"custom",temperature:.7,maxTokens:2e3}),[i,c]=t.useState(!1),[o,d]=t.useState(!1),[x,m]=t.useState([]),[h,u]=t.useState(!1),[g,p]=t.useState(null),f=[{value:"google",label:"Google Gemini",example:"https://generativelanguage.googleapis.com/v1beta"},{value:"openai",label:"OpenAI",example:"https://api.openai.com/v1"},{value:"siliconflow",label:"SiliconFlow",example:"https://api.siliconflow.cn/v1"},{value:"custom",label:"自定义API",example:"https://your-api-endpoint.com/v1"}];return e.jsxs("div",{className:"h-full flex flex-col bg-[#f5f7fa]",children:[e.jsxs("div",{className:"glass-effect border-b border-gray-200/50",children:[e.jsx(xa,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a(-1),className:"ios-button text-blue-500 -ml-2 relative z-10",children:e.jsx(ls,{size:24})}),e.jsx("h1",{className:"text-base font-semibold text-gray-900 absolute left-1/2 transform -translate-x-1/2 pointer-events-none",children:"新增API"}),e.jsx("button",{onClick:()=>{l.name.trim()?l.baseUrl&&l.apiKey&&l.model?(r(l),R(Ce.API_SETTINGS,l),a("/api-list",{replace:!0})):alert("请填写完整的API配置"):alert("请输入API名称")},className:"ios-button text-blue-500 font-medium",children:"保存"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-3 pt-3",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"API名称"})}),e.jsx("div",{className:"glass-card rounded-2xl p-4",children:e.jsx("input",{type:"text",value:l.name,onChange:e=>n({...l,name:e.target.value}),placeholder:"例如: 我的Gemini API",maxLength:30,className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"API提供商"})}),e.jsx("div",{className:"glass-card rounded-2xl overflow-hidden",children:f.map((t,s)=>e.jsx("div",{children:e.jsxs("button",{onClick:()=>(e=>{const t=f.find(t=>t.value===e);n({...l,provider:e,baseUrl:(null==t?void 0:t.example)||""}),m([]),u(!1)})(t.value),className:"w-full flex items-center justify-between px-4 py-3 ios-button "+(s<f.length-1?"border-b border-gray-100":""),children:[e.jsx("span",{className:"text-gray-900 font-medium",children:t.label}),e.jsx("div",{className:"w-5 h-5 rounded-full border-2 flex items-center justify-center "+(l.provider===t.value?"border-primary":"border-gray-300"),children:l.provider===t.value&&e.jsx("div",{className:"w-3 h-3 rounded-full bg-primary"})})]})},t.value))})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"API地址"})}),e.jsx("div",{className:"glass-card rounded-2xl p-4",children:e.jsx("input",{type:"text",value:l.baseUrl,onChange:e=>n({...l,baseUrl:e.target.value}),placeholder:"https://api.example.com/v1",className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"API密钥"})}),e.jsx("div",{className:"glass-card rounded-2xl p-4",children:e.jsx("input",{type:"password",value:l.apiKey,onChange:e=>n({...l,apiKey:e.target.value}),placeholder:"sk-...",className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"px-4 py-2 flex items-center justify-between",children:[e.jsx("div",{className:"flex-1",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"模型名称"})}),e.jsx("button",{onClick:async()=>{if(l.baseUrl&&l.apiKey){if(!o){d(!0),p(null);try{const e=await Se(l);0===e.length?p({success:!1,message:"未找到可用模型，请手动输入"}):(m(e),u(!0),!l.model&&e.length>0&&n({...l,model:e[0]}),p({success:!0,message:`成功拉取 ${e.length} 个模型，已自动选择第一个`}))}catch(e){p({success:!1,message:e.message||"拉取模型失败"})}finally{d(!1)}}}else alert("请先填写API地址和密钥")},disabled:o,className:"ml-2 px-3 py-1.5 bg-primary text-white text-xs rounded-lg ios-button",children:o?"拉取中...":"拉取模型"})]}),e.jsx("div",{className:"glass-card rounded-2xl p-4",children:e.jsx("input",{type:"text",value:l.model,onChange:e=>n({...l,model:e.target.value}),placeholder:"选择或输入模型名称",className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})})]}),h&&x.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"选择模型"})}),e.jsx("div",{className:"glass-card rounded-2xl overflow-hidden max-h-60 overflow-y-auto",children:x.map((t,s)=>e.jsxs("button",{onClick:()=>(e=>{n({...l,model:e}),u(!1)})(t),className:"w-full flex items-center justify-between px-4 py-3 ios-button text-left "+(s<x.length-1?"border-b border-gray-100":""),children:[e.jsx("span",{className:"text-sm "+(l.model===t?"text-primary font-medium":"text-gray-900"),children:t}),l.model===t&&e.jsx("span",{className:"text-primary text-xl",children:"✓"})]},t))})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"高级设置"})}),e.jsxs("div",{className:"glass-card rounded-2xl overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-2",children:"温度 (Temperature)"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"range",min:"0",max:"2",step:"0.1",value:l.temperature??.7,onChange:e=>n({...l,temperature:parseFloat(e.target.value)}),className:"flex-1"}),e.jsx("span",{className:"text-gray-900 font-mono text-sm w-10 text-right",children:(l.temperature??.7).toFixed(1)})]})]}),e.jsxs("div",{className:"px-4 py-3",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-2",children:"最大Token数"}),e.jsx("input",{type:"number",value:l.maxTokens??2e3,onChange:e=>n({...l,maxTokens:parseInt(e.target.value)}),placeholder:"2000",className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})]})]})]}),e.jsx("div",{className:"mb-3",children:e.jsx("button",{onClick:async()=>{if(l.baseUrl&&l.apiKey&&l.model){R(Ce.API_SETTINGS,l),c(!0),p(null);try{const e=await Ie();p(e?{success:!0,message:"API连接成功"}:{success:!1,message:"API连接失败，请检查配置"})}catch(e){p({success:!1,message:e.message||"API连接失败"})}finally{c(!1)}}else alert("请先填写完整的API配置")},disabled:i,className:"w-full glass-card rounded-2xl px-4 py-4 text-gray-900 font-medium ios-button",children:i?"测试中...":"测试API连接"})}),g&&e.jsx("div",{className:"mb-6 glass-card rounded-2xl p-4 "+(g.success?"border-green-500 border":"border-red-500 border"),children:e.jsx("p",{className:"text-sm "+(g.success?"text-green-600":"text-red-600"),children:g.message})})]})]})}},Symbol.toStringTag,{value:"Module"})),lr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{id:l}=r(),{apiConfigs:n,updateApiConfig:i,currentApiId:c}=b(),o=n.find(e=>e.id===l),[d,x]=t.useState({name:(null==o?void 0:o.name)||"",baseUrl:(null==o?void 0:o.baseUrl)||"",apiKey:(null==o?void 0:o.apiKey)||"",model:(null==o?void 0:o.model)||"",provider:(null==o?void 0:o.provider)||"custom",temperature:(null==o?void 0:o.temperature)??.7,maxTokens:(null==o?void 0:o.maxTokens)??2e3}),[m,h]=t.useState(!1),[u,g]=t.useState(!1),[p,f]=t.useState([]),[j,v]=t.useState(!1),[y,N]=t.useState(null),w=[{value:"google",label:"Google Gemini",example:"https://generativelanguage.googleapis.com/v1beta"},{value:"openai",label:"OpenAI",example:"https://api.openai.com/v1"},{value:"siliconflow",label:"SiliconFlow",example:"https://api.siliconflow.cn/v1"},{value:"custom",label:"自定义API",example:"https://your-api-endpoint.com/v1"}];if(!o)return a("/api-list"),null;return e.jsxs("div",{className:"h-full flex flex-col bg-[#f5f7fa]",children:[e.jsxs("div",{className:"glass-effect border-b border-gray-200/50",children:[e.jsx(xa,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a(-1),className:"ios-button text-blue-500 -ml-2 relative z-10",children:e.jsx(ls,{size:24})}),e.jsx("h1",{className:"text-base font-semibold text-gray-900 absolute left-1/2 transform -translate-x-1/2 pointer-events-none",children:"编辑API"}),e.jsx("button",{onClick:()=>{d.name.trim()?d.baseUrl&&d.apiKey&&d.model?(l&&(i(l,d),c===l&&R(Ce.API_SETTINGS,d)),a("/api-list",{replace:!0})):alert("请填写完整的API配置"):alert("请输入API名称")},className:"ios-button text-blue-500 font-medium",children:"保存"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-3 pt-3",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"API名称"})}),e.jsx("div",{className:"glass-card rounded-2xl p-4",children:e.jsx("input",{type:"text",value:d.name,onChange:e=>x({...d,name:e.target.value}),placeholder:"例如: 我的Gemini API",maxLength:30,className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"API提供商"})}),e.jsx("div",{className:"glass-card rounded-2xl overflow-hidden",children:w.map((t,s)=>e.jsx("div",{children:e.jsxs("button",{onClick:()=>(e=>{const t=w.find(t=>t.value===e);x({...d,provider:e,baseUrl:(null==t?void 0:t.example)||""}),f([]),v(!1)})(t.value),className:"w-full flex items-center justify-between px-4 py-3 ios-button "+(s<w.length-1?"border-b border-gray-100":""),children:[e.jsx("span",{className:"text-gray-900 font-medium",children:t.label}),e.jsx("div",{className:"w-5 h-5 rounded-full border-2 flex items-center justify-center "+(d.provider===t.value?"border-primary":"border-gray-300"),children:d.provider===t.value&&e.jsx("div",{className:"w-3 h-3 rounded-full bg-primary"})})]})},t.value))})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"API地址"})}),e.jsx("div",{className:"glass-card rounded-2xl p-4",children:e.jsx("input",{type:"text",value:d.baseUrl,onChange:e=>x({...d,baseUrl:e.target.value}),placeholder:"https://api.example.com/v1",className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"API密钥"})}),e.jsx("div",{className:"glass-card rounded-2xl p-4",children:e.jsx("input",{type:"password",value:d.apiKey,onChange:e=>x({...d,apiKey:e.target.value}),placeholder:"sk-...",className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"px-4 py-2 flex items-center justify-between",children:[e.jsx("div",{className:"flex-1",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"模型名称"})}),e.jsx("button",{onClick:async()=>{if(d.baseUrl&&d.apiKey){if(!u){g(!0),N(null);try{const e=await Se(d);0===e.length?N({success:!1,message:"未找到可用模型，请手动输入"}):(f(e),v(!0),!d.model&&e.length>0&&x({...d,model:e[0]}),N({success:!0,message:`成功拉取 ${e.length} 个模型`}))}catch(e){N({success:!1,message:e.message||"拉取模型失败"})}finally{g(!1)}}}else alert("请先填写API地址和密钥")},disabled:u,className:"ml-2 px-3 py-1.5 bg-primary text-white text-xs rounded-lg ios-button",children:u?"拉取中...":"拉取模型"})]}),e.jsx("div",{className:"glass-card rounded-2xl p-4",children:e.jsx("input",{type:"text",value:d.model,onChange:e=>x({...d,model:e.target.value}),placeholder:"选择或输入模型名称",className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})})]}),j&&p.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"选择模型"})}),e.jsx("div",{className:"glass-card rounded-2xl overflow-hidden max-h-60 overflow-y-auto",children:p.map((t,s)=>e.jsxs("button",{onClick:()=>(e=>{x({...d,model:e}),v(!1)})(t),className:"w-full flex items-center justify-between px-4 py-3 ios-button text-left "+(s<p.length-1?"border-b border-gray-100":""),children:[e.jsx("span",{className:"text-sm "+(d.model===t?"text-primary font-medium":"text-gray-900"),children:t}),d.model===t&&e.jsx("span",{className:"text-primary text-xl",children:"✓"})]},t))})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"高级设置"})}),e.jsxs("div",{className:"glass-card rounded-2xl overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-2",children:"温度 (Temperature)"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"range",min:"0",max:"2",step:"0.1",value:d.temperature??.7,onChange:e=>x({...d,temperature:parseFloat(e.target.value)}),className:"flex-1"}),e.jsx("span",{className:"text-gray-900 font-mono text-sm w-10 text-right",children:(d.temperature??.7).toFixed(1)})]})]}),e.jsxs("div",{className:"px-4 py-3",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-2",children:"最大Token数"}),e.jsx("input",{type:"number",value:d.maxTokens??2e3,onChange:e=>x({...d,maxTokens:parseInt(e.target.value)}),placeholder:"2000",className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})]})]})]}),e.jsx("div",{className:"mb-3",children:e.jsx("button",{onClick:async()=>{if(d.baseUrl&&d.apiKey&&d.model){R(Ce.API_SETTINGS,d),h(!0),N(null);try{const e=await Ie();N(e?{success:!0,message:"API连接成功"}:{success:!1,message:"API连接失败，请检查配置"})}catch(e){N({success:!1,message:e.message||"API连接失败"})}finally{h(!1)}}else alert("请先填写完整的API配置")},disabled:m,className:"w-full glass-card rounded-2xl px-4 py-4 text-gray-900 font-medium ios-button",children:m?"测试中...":"测试API连接"})}),y&&e.jsx("div",{className:"mb-6 glass-card rounded-2xl p-4 "+(y.success?"border-green-500 border":"border-red-500 border"),children:e.jsx("p",{className:"text-sm "+(y.success?"text-green-600":"text-red-600"),children:y.message})})]})]})}},Symbol.toStringTag,{value:"Module"})),nr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{var r;const l=s(),n=a(),{currentUser:i,updateUser:c}=d(),{showStatusBar:x}=o(),m=(null==(r=n.state)?void 0:r.field)||"name",h=t.useRef(null),[u,g]=t.useState("name"===m?(null==i?void 0:i.name)||"":"signature"===m?(null==i?void 0:i.signature)||"":(null==i?void 0:i.avatar)||"default"),[p,f]=t.useState(!1);return e.jsxs("div",{className:"h-full flex flex-col bg-gray-50",children:[x&&e.jsx(xa,{}),e.jsxs("div",{className:"glass-effect px-4 py-3 flex items-center justify-between border-b border-gray-200/50",children:[e.jsx("button",{onClick:()=>l(-1),className:"ios-button text-gray-700 hover:text-gray-900",children:"取消"}),e.jsx("h1",{className:"text-base font-semibold text-gray-900",children:(()=>{switch(m){case"name":return"更改名字";case"signature":return"个性签名";case"avatar":return"更换头像";default:return"编辑"}})()}),e.jsx("button",{onClick:()=>{i&&(c(i.id,{[m]:u}),l(-1))},className:"ios-button text-primary font-medium",children:"保存"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-3 pt-3",children:"avatar"===m?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"px-4 py-2",children:[e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"上传头像"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"点击上传本地图片，支持 JPG、PNG、GIF 格式"})]}),e.jsxs("div",{className:"glass-card rounded-2xl p-6 flex justify-center",children:[e.jsx("input",{ref:h,type:"file",accept:"image/*",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(!s)return;if(!s.type.startsWith("image/"))return void alert("请选择图片文件");if(s.size>5242880)return void alert("图片大小不能超过5MB");f(!0);const a=new FileReader;a.onloadend=()=>{const e=a.result;g(e),f(!1)},a.onerror=()=>{alert("图片读取失败"),f(!1)},a.readAsDataURL(s)},className:"hidden"}),e.jsx("button",{onClick:()=>{var e;return null==(e=h.current)?void 0:e.click()},disabled:p,className:"relative w-32 h-32 rounded-2xl bg-gray-100 border-2 border-dashed border-gray-300 flex flex-col items-center justify-center ios-button overflow-hidden",children:u&&u.startsWith("data:image")?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:u,alt:"头像预览",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-20 transition-all flex items-center justify-center",children:e.jsx("span",{className:"text-white opacity-0 hover:opacity-100 text-sm",children:"点击更换"})})]}):e.jsx(e.Fragment,{children:p?e.jsx("div",{className:"text-gray-400",children:"上传中..."}):e.jsxs(e.Fragment,{children:[e.jsx(ds,{size:32,className:"text-gray-400 mb-2"}),e.jsx("span",{className:"text-sm text-gray-500",children:"上传头像"})]})})})]})]})}):e.jsxs("div",{className:"glass-card rounded-2xl p-4",children:["signature"===m?e.jsx("textarea",{value:u,onChange:e=>g(e.target.value),placeholder:"填写个性签名",maxLength:100,className:"w-full h-32 bg-transparent border-none outline-none text-gray-900 placeholder-gray-400 resize-none"}):e.jsx("input",{type:"text",value:u,onChange:e=>g(e.target.value),placeholder:"请输入名字",maxLength:20,className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400 py-2"}),e.jsxs("div",{className:"text-right text-xs text-gray-400 mt-2",children:[u.length,"/","signature"===m?100:20]})]})})]})}},Symbol.toStringTag,{value:"Module"})),ir=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const t=s(),{users:a,currentUser:r,switchUser:l,deleteUser:n}=d();return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"glass-effect px-4 py-3 flex items-center justify-between border-b border-gray-200/50",children:[e.jsx("button",{onClick:()=>t("/desktop",{replace:!0}),className:"ios-button text-gray-700 hover:text-gray-900 -ml-2",children:e.jsx(ls,{size:24})}),e.jsx("h1",{className:"text-base font-semibold text-gray-900 absolute left-1/2 transform -translate-x-1/2 pointer-events-none",children:"账号管理"}),e.jsx("button",{onClick:()=>t("/create-user"),className:"ios-button text-gray-700 hover:text-gray-900",children:e.jsx(rs,{size:24})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-3 pt-3",children:e.jsx("div",{className:"space-y-3 mb-6",children:a.map(s=>{const i=s.avatar&&s.avatar.startsWith("data:image"),c=(null==r?void 0:r.id)===s.id;return e.jsx("div",{onClick:()=>{return e=s.id,l(e),void t("/wechat/me");var e},className:"glass-card rounded-2xl p-4 ios-button cursor-pointer "+(c?"ring-2 ring-primary":""),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-gray-200 flex items-center justify-center shadow-lg flex-shrink-0 overflow-hidden",children:i&&s.avatar?e.jsx("img",{src:s.avatar,alt:"头像",className:"w-full h-full object-cover"}):e.jsx(ds,{size:32,className:"text-gray-400"})}),e.jsxs("div",{className:"ml-4 flex-1 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.name}),c&&e.jsx("span",{className:"text-xs px-2 py-0.5 bg-primary text-white rounded-full",children:"当前"})]}),e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:s.username}),e.jsx("p",{className:"text-xs text-gray-400 truncate",children:s.signature})]}),!c&&a.length>1&&e.jsx("button",{onClick:e=>((e,t)=>{t.stopPropagation(),confirm("确定要删除这个账号吗？")&&n(e)})(s.id,e),className:"ml-2 px-3 py-1 text-sm text-red-500 ios-button",children:"删除"})]})},s.id)})})})]})}},Symbol.toStringTag,{value:"Module"})),cr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{addUser:r}=d(),{showStatusBar:l}=o(),n=t.useRef(null),[i,c]=t.useState({name:"",username:"",avatar:"",signature:"这个人很懒，什么都没留下",description:""}),[x,m]=t.useState(!1);return e.jsxs("div",{className:"h-screen flex flex-col bg-gray-50",children:[l&&e.jsx(xa,{}),e.jsxs("div",{className:"glass-effect px-4 py-3 flex items-center justify-between border-b border-gray-200/50",children:[e.jsx("button",{onClick:()=>a(-1),className:"ios-button text-gray-700 hover:text-gray-900",children:"取消"}),e.jsx("h1",{className:"text-base font-semibold text-gray-900",children:"创建新账号"}),e.jsx("button",{onClick:()=>{if(!i.name.trim())return void alert("请输入名字");if(!i.avatar)return void alert("请上传头像");const e=i.username||`wxid_${ye(i.name)||Date.now().toString().slice(-6)}`;r({...i,username:e}),a("/wechat/me")},className:"ios-button text-primary font-medium",children:"完成"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-3 pt-3",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"px-4 py-2",children:[e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"上传头像"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"点击上传本地图片，支持 JPG、PNG、GIF 格式"})]}),e.jsxs("div",{className:"glass-card rounded-2xl p-6 flex justify-center",children:[e.jsx("input",{ref:n,type:"file",accept:"image/*",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(!s)return;if(!s.type.startsWith("image/"))return void alert("请选择图片文件");if(s.size>5242880)return void alert("图片大小不能超过5MB");m(!0);const a=new FileReader;a.onloadend=()=>{const e=a.result;c({...i,avatar:e}),m(!1)},a.onerror=()=>{alert("图片读取失败"),m(!1)},a.readAsDataURL(s)},className:"hidden"}),e.jsx("button",{onClick:()=>{var e;return null==(e=n.current)?void 0:e.click()},disabled:x,className:"relative w-32 h-32 rounded-2xl bg-gray-100 border-2 border-dashed border-gray-300 flex flex-col items-center justify-center ios-button overflow-hidden",children:i.avatar?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:i.avatar,alt:"头像预览",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-20 transition-all flex items-center justify-center",children:e.jsx("span",{className:"text-white opacity-0 hover:opacity-100 text-sm",children:"点击更换"})})]}):e.jsx(e.Fragment,{children:x?e.jsx("div",{className:"text-gray-400",children:"上传中..."}):e.jsxs(e.Fragment,{children:[e.jsx(ds,{size:32,className:"text-gray-400 mb-2"}),e.jsx("span",{className:"text-sm text-gray-500",children:"上传头像"})]})})})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"基本信息"})}),e.jsxs("div",{className:"glass-card rounded-2xl overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"名字"}),e.jsx("input",{type:"text",value:i.name,onChange:e=>{return t=e.target.value,void c(e=>{if((!e.username||e.username.startsWith("wxid_"))&&t){const s=ye(t);return{...e,name:t,username:`wxid_${s||Date.now().toString().slice(-6)}`}}return{...e,name:t}});var t},placeholder:"请输入名字",maxLength:20,className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})]}),e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsxs("label",{className:"block text-xs text-gray-500 mb-1",children:["微信号 ",e.jsx("span",{className:"text-gray-400",children:"（留空自动生成）"})]}),e.jsx("input",{type:"text",value:i.username,onChange:e=>c({...i,username:e.target.value}),placeholder:`wxid_${ye(i.name)||"auto"}`,className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400"})]}),e.jsxs("div",{className:"px-4 py-3",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"个性签名"}),e.jsx("textarea",{value:i.signature,onChange:e=>c({...i,signature:e.target.value}),placeholder:"填写个性签名",maxLength:100,className:"w-full h-20 bg-transparent border-none outline-none text-gray-900 placeholder-gray-400 resize-none"})]})]})]})]})]})}},Symbol.toStringTag,{value:"Module"})),or=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{currentUser:r}=d(),{addMoment:l}=h(),{showStatusBar:i}=o(),{characters:c}=n(),[x,m]=t.useState(""),[u,g]=t.useState(""),[p,f]=t.useState(!1),[b,j]=t.useState([]),[v,y]=t.useState(!1),[N,w]=t.useState(!1),[k,C]=t.useState([]),[S,I]=t.useState(!1),[_,M]=t.useState("public"),[z,$]=t.useState([]),L=()=>{const e=document.createElement("input");e.type="file",e.accept="image/*",e.multiple=!0,e.onchange=e=>{const t=Array.from(e.target.files||[]);if(0===t.length)return;const s=9-b.length;t.slice(0,s).forEach(e=>{if(e.size>5242880)return void alert("图片大小不能超过5MB");const t=new FileReader;t.onload=e=>{var t;const s=null==(t=e.target)?void 0:t.result;j(e=>[...e,{id:`img_${Date.now()}_${Math.random()}`,url:s}])},t.readAsDataURL(e)})},e.click()};return e.jsxs("div",{className:"h-full flex flex-col bg-gray-50",children:[i&&e.jsx(xa,{}),e.jsxs("div",{className:"bg-white px-4 py-3 flex items-center justify-between border-b border-gray-100 sticky top-0 z-10",children:[e.jsxs("button",{onClick:()=>a("/moments",{replace:!0}),className:"flex items-center gap-2 text-gray-700 ios-button",children:[e.jsx(ls,{size:20}),e.jsx("span",{className:"text-base",children:"取消"})]}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"发表文字"}),e.jsx("button",{onClick:async()=>{if(!r||!x.trim())return;y(!0);const e={userId:r.id,userName:r.name,userAvatar:r.avatar,content:x.trim(),images:b,location:u.trim()||void 0,visibility:_,visibleTo:"partial"===_?z:[],remindUsers:k};Date.now().toString(),l(e),k.length>0&&k.forEach(e=>{if(c.find(t=>t.id===e)){const t=localStorage.getItem(`chat_messages_${e}`),s=t?JSON.parse(t):[],a={id:Date.now()+Math.random(),type:"system",content:`💬 ${r.name} 提醒你查看Ta的朋友圈`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"system",isHidden:!1};s.push(a),localStorage.setItem(`chat_messages_${e}`,JSON.stringify(s))}}),c.forEach(e=>{if("true"===localStorage.getItem(`ai_moments_enabled_${e.id}`)){const t=localStorage.getItem(`chat_messages_${e.id}`),s=t?JSON.parse(t):[];let a=`📸 你发布了朋友圈：${x.trim()}`;b.length>0&&(a+=` [${b.length}张图片]`),u.trim()&&(a+=` 📍${u.trim()}`);const r={id:Date.now()+Math.random(),type:"system",content:a,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"system",isHidden:!1};s.push(r),localStorage.setItem(`chat_messages_${e.id}`,JSON.stringify(s))}}),a("/moments",{replace:!0})},disabled:!x.trim()||v,className:"px-4 py-1.5 rounded-full bg-green-500 text-white text-sm font-medium ios-button disabled:opacity-50 disabled:cursor-not-allowed",children:v?"发布中...":"发表"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar p-4 bg-gray-50",children:[e.jsx("div",{className:"bg-white rounded-2xl p-4 mb-4 shadow-sm",children:e.jsx("textarea",{value:x,onChange:e=>m(e.target.value),placeholder:"这一刻的想法...",className:"w-full bg-transparent outline-none resize-none text-base text-gray-800 placeholder-gray-400 leading-relaxed",rows:8,autoFocus:!0})}),b.length>0&&e.jsx("div",{className:"bg-white rounded-2xl p-4 mb-4 shadow-sm",children:e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[b.map(t=>e.jsxs("div",{className:"relative aspect-square rounded-lg overflow-hidden bg-gray-100",children:[e.jsx("img",{src:t.url,alt:"",className:"w-full h-full object-cover"}),e.jsx("button",{onClick:()=>{return e=t.id,void j(t=>t.filter(t=>t.id!==e));var e},className:"absolute top-1 right-1 w-6 h-6 rounded-full bg-black/50 text-white flex items-center justify-center text-xs",children:"✕"})]},t.id)),b.length<9&&e.jsx("button",{onClick:L,className:"aspect-square rounded-lg border-2 border-dashed border-gray-300 flex items-center justify-center text-gray-400 ios-button hover:border-blue-400 hover:text-blue-400 transition-colors",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ds,{size:24,className:"mx-auto mb-1"}),e.jsx("span",{className:"text-xs",children:"添加"})]})})]})}),0===b.length&&e.jsx("div",{className:"bg-white rounded-2xl p-4 mb-4 shadow-sm",children:e.jsx("button",{onClick:L,className:"w-full aspect-square max-w-[120px] rounded-xl border-2 border-dashed border-gray-300 flex items-center justify-center text-gray-400 ios-button hover:border-blue-400 hover:text-blue-400 transition-colors",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ds,{size:32,className:"mx-auto mb-2"}),e.jsx("span",{className:"text-xs",children:"添加图片"})]})})}),e.jsxs("div",{className:"bg-white rounded-2xl overflow-hidden shadow-sm",children:[e.jsxs("button",{onClick:()=>f(!p),className:"w-full flex items-center justify-between px-4 py-4 ios-button",children:[e.jsx("span",{className:"text-gray-700 font-medium",children:"所在位置"}),e.jsx("span",{className:"text-gray-400 text-xl",children:"›"})]}),p&&e.jsx("div",{className:"px-4 pb-4",children:e.jsx("input",{type:"text",value:u,onChange:e=>g(e.target.value),placeholder:"输入位置信息",className:"w-full px-4 py-2 rounded-lg bg-gray-50 outline-none text-sm text-gray-800 placeholder-gray-400"})}),e.jsx("div",{className:"border-t border-gray-100"}),e.jsxs("button",{onClick:()=>w(!0),className:"w-full flex items-center justify-between px-4 py-4 ios-button",children:[e.jsx("span",{className:"text-gray-700 font-medium",children:"提醒谁看"}),e.jsxs("div",{className:"flex items-center gap-2",children:[k.length>0&&e.jsxs("span",{className:"text-gray-400 text-sm",children:[k.length,"人"]}),e.jsx("span",{className:"text-gray-400 text-xl",children:"›"})]})]}),e.jsx("div",{className:"border-t border-gray-100"}),e.jsxs("button",{onClick:()=>I(!0),className:"w-full flex items-center justify-between px-4 py-4 ios-button",children:[e.jsx("span",{className:"text-gray-700 font-medium",children:"谁可以看"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-400 text-sm",children:"public"===_?"公开":"private"===_?"私密":`${z.length}人可见`}),e.jsx("span",{className:"text-gray-400 text-xl",children:"›"})]})]})]})]}),N&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-end",onClick:()=>w(!1),children:e.jsxs("div",{className:"bg-white w-full rounded-t-3xl max-h-[70vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"px-4 py-4 border-b border-gray-100 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"提醒谁看"}),e.jsx("button",{onClick:()=>w(!1),className:"text-blue-500 font-medium ios-button",children:"完成"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:c.map(t=>{const s=k.includes(t.id);return e.jsxs("button",{onClick:()=>{C(s?e=>e.filter(e=>e!==t.id):e=>[...e,t.id])},className:"w-full flex items-center gap-3 p-3 hover:bg-gray-50 rounded-xl ios-button transition-colors",children:[e.jsx("img",{src:t.avatar,alt:t.name,className:"w-12 h-12 rounded-full object-cover"}),e.jsx("div",{className:"flex-1 text-left",children:e.jsx("div",{className:"text-base font-medium text-gray-900",children:t.name})}),e.jsx("div",{className:"w-6 h-6 rounded-full border-2 flex items-center justify-center transition-colors "+(s?"bg-green-500 border-green-500":"border-gray-300"),children:s&&e.jsx("span",{className:"text-white text-sm",children:"✓"})})]},t.id)})})]})}),S&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-end",onClick:()=>I(!1),children:e.jsxs("div",{className:"bg-white w-full rounded-t-3xl max-h-[70vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"px-4 py-4 border-b border-gray-100 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"谁可以看"}),e.jsx("button",{onClick:()=>I(!1),className:"text-blue-500 font-medium ios-button",children:"完成"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"p-4 space-y-2",children:[e.jsxs("button",{onClick:()=>{M("public"),$([])},className:"w-full flex items-center justify-between p-4 rounded-xl hover:bg-gray-50 ios-button transition-colors",children:[e.jsx("span",{className:"text-base text-gray-900",children:"公开"}),"public"===_&&e.jsx("span",{className:"text-green-500 text-lg",children:"✓"})]}),e.jsxs("button",{onClick:()=>{M("private"),$([])},className:"w-full flex items-center justify-between p-4 rounded-xl hover:bg-gray-50 ios-button transition-colors",children:[e.jsx("span",{className:"text-base text-gray-900",children:"私密"}),"private"===_&&e.jsx("span",{className:"text-green-500 text-lg",children:"✓"})]}),e.jsxs("button",{onClick:()=>{"partial"!==_&&M("partial")},className:"w-full flex items-center justify-between p-4 rounded-xl hover:bg-gray-50 ios-button transition-colors",children:[e.jsx("span",{className:"text-base text-gray-900",children:"部分可见"}),"partial"===_&&e.jsx("span",{className:"text-green-500 text-lg",children:"✓"})]})]}),"partial"===_&&e.jsxs("div",{className:"border-t border-gray-100 p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-3",children:"选择可见用户"}),c.map(t=>{const s=z.includes(t.id);return e.jsxs("button",{onClick:()=>{$(s?e=>e.filter(e=>e!==t.id):e=>[...e,t.id])},className:"w-full flex items-center gap-3 p-3 hover:bg-gray-50 rounded-xl ios-button transition-colors",children:[e.jsx("img",{src:t.avatar,alt:t.name,className:"w-10 h-10 rounded-full object-cover"}),e.jsx("div",{className:"flex-1 text-left",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.name})}),e.jsx("div",{className:"w-5 h-5 rounded-full border-2 flex items-center justify-center transition-colors "+(s?"bg-green-500 border-green-500":"border-gray-300"),children:s&&e.jsx("span",{className:"text-white text-xs",children:"✓"})})]},t.id)})]})]})]})})]})}},Symbol.toStringTag,{value:"Module"})),dr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),{characters:l}=n(),[i,c]=t.useState([]);t.useEffect(()=>{const e=_e(),t=l.map(e=>e.id),s=e.filter(e=>t.includes(e.fromUserId));c(s),Me()},[l]);const d=e=>{const t=Date.now()-e,s=Math.floor(t/1e3/60),a=Math.floor(s/60),r=Math.floor(a/24);if(s<1)return"刚刚";if(s<60)return`${s}分钟前`;if(a<24)return`${a}小时前`;if(r<7)return`${r}天前`;const l=new Date(e);return`${l.getMonth()+1}月${l.getDate()}日`},x=e=>{switch(e.type){case"like":return"赞了你的朋友圈";case"comment":return"评论了你的朋友圈";case"reply":return e.replyToUser?"回复了你的评论":"回复了评论";case"new_moment":return"发布了新的朋友圈";default:return"与你互动"}};return e.jsxs("div",{className:"h-full flex flex-col bg-white",children:[r&&e.jsx(xa,{}),e.jsx("div",{className:"glass-morphism",children:e.jsxs("div",{className:"px-4 py-3 flex items-center",children:[e.jsx("button",{onClick:()=>a("/moments",{replace:!0}),className:"w-10 h-10 rounded-full glass-effect flex items-center justify-center ios-button",children:e.jsx(ls,{size:20,className:"text-gray-700"})}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900 ml-4",children:"朋友圈消息"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:0===i.length?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[e.jsxs("svg",{width:"80",height:"80",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",className:"mb-4",children:[e.jsx("path",{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}),e.jsx("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"})]}),e.jsx("p",{className:"text-base",children:"暂无消息"})]}):e.jsx("div",{className:"divide-y divide-gray-100",children:i.map(t=>e.jsxs("div",{onClick:()=>{a("/wechat/moments")},className:"px-4 py-4 flex gap-3 active:bg-gray-50 transition-colors cursor-pointer",children:[e.jsx("div",{className:"flex-shrink-0",children:t.fromUserAvatar.startsWith("data:image")?e.jsx("img",{src:t.fromUserAvatar,alt:t.fromUserName,className:"w-12 h-12 rounded-md object-cover"}):e.jsx("div",{className:"w-12 h-12 rounded-md bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center text-white text-xl",children:t.fromUserAvatar})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-baseline justify-between mb-1",children:[e.jsx("span",{className:"font-medium text-gray-900",children:t.fromUserName}),e.jsx("span",{className:"text-xs text-gray-400 ml-2",children:d(t.timestamp)})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:x(t)}),t.comment&&e.jsx("div",{className:"bg-gray-100 rounded-lg px-3 py-2 mb-2",children:e.jsx("p",{className:"text-sm text-gray-700",children:t.comment})}),e.jsx("div",{className:"bg-gray-50 rounded-lg px-3 py-2",children:e.jsx("p",{className:"text-sm text-gray-500 line-clamp-2",children:t.momentContent})})]})]},t.id))})})]})}},Symbol.toStringTag,{value:"Module"})),xr=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M9 18l6-6-6-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),mr=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("rect",{x:"2",y:"5",width:"20",height:"14",rx:"2",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M2 10h20",stroke:"currentColor",strokeWidth:"2"})]}),hr=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M12 6v6l4 2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),ur=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",stroke:"currentColor",strokeWidth:"2"})}),gr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),[l,n]=t.useState("0.00"),[i,c]=t.useState(!1),[d,x]=t.useState("");t.useEffect(()=>{const e=T();n(e.toFixed(2))},[]);const m=[{id:1,name:"零钱通",icon:mr,desc:"赚收益，随时用",path:""},{id:2,name:"交易记录",icon:hr,desc:"",path:"/transaction-history"},{id:3,name:"帮助中心",icon:ur,desc:"",path:"/wallet-help"}];return e.jsxs("div",{className:"h-full flex flex-col bg-[#EDEDED]",children:[r&&e.jsx(xa,{}),e.jsxs("div",{className:"bg-white flex items-center border-b border-gray-200",children:[e.jsx("button",{onClick:()=>{a("/services")},className:"px-4 py-4 active:opacity-50 cursor-pointer flex items-center justify-center",children:e.jsx(ls,{size:24,className:"text-gray-900"})}),e.jsx("h1",{className:"flex-1 text-center text-[17px] font-medium text-gray-900 pr-14",children:"零钱"})]}),e.jsxs("div",{className:"bg-white px-5 pt-8 pb-6",children:[e.jsxs("div",{className:"flex items-center justify-center mb-2",children:[e.jsx(ys,{size:20,className:"text-gray-500 mr-2"}),e.jsx("span",{className:"text-sm text-gray-500",children:"零钱"})]}),e.jsx("div",{className:"text-center mb-6",children:e.jsxs("span",{className:"text-[48px] font-light text-gray-900",children:["¥",l]})}),e.jsx("div",{children:e.jsx("button",{onClick:()=>c(!0),className:"w-full bg-[#07C160] text-white py-3 rounded-lg text-[16px] font-medium active:opacity-80",children:"充值"})})]}),e.jsx("div",{className:"bg-[#FFF9E6] px-4 py-3 mx-4 mt-3 rounded-lg",children:e.jsx("p",{className:"text-xs text-[#B8860B] leading-relaxed",children:"零钱可用于发红包、转账等。充值后余额将安全保存在本地。"})}),e.jsx("div",{className:"bg-white mt-3 px-4",children:m.map((t,s)=>{const r=t.icon;return e.jsxs("div",{children:[e.jsxs("div",{onClick:()=>t.path&&a(t.path),className:"flex items-center py-4 active:bg-gray-50 cursor-pointer",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center mr-3",children:e.jsx(r,{size:20,className:"text-gray-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-[16px] text-gray-900",children:t.name}),t.desc&&e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:t.desc})]}),e.jsx(xr,{size:20,className:"text-gray-400"})]}),s<m.length-1&&e.jsx("div",{className:"border-b border-gray-100 ml-[52px]"})]},t.id)})}),e.jsx("div",{className:"mt-6 px-6 pb-6",children:e.jsx("p",{className:"text-xs text-gray-400 text-center leading-relaxed",children:"零钱资金将享受微信支付安全保障"})}),i&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:()=>c(!1),children:e.jsxs("div",{className:"bg-white rounded-2xl w-[85%] max-w-md p-6",onClick:e=>e.stopPropagation(),children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4 text-center",children:"充值零钱"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"充值金额"}),e.jsxs("div",{className:"flex items-center border-2 border-gray-200 rounded-lg px-4 py-3 focus-within:border-[#07C160]",children:[e.jsx("span",{className:"text-2xl text-gray-900 mr-2",children:"¥"}),e.jsx("input",{type:"number",value:d,onChange:e=>x(e.target.value),placeholder:"0.00",className:"flex-1 text-2xl outline-none",autoFocus:!0})]})]}),e.jsx("div",{className:"grid grid-cols-4 gap-2 mb-6",children:["100","200","500","1000"].map(t=>e.jsx("button",{onClick:()=>x(t),className:"py-2 border border-gray-300 rounded-lg text-gray-700 active:bg-gray-100",children:t},t))}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>c(!1),className:"flex-1 py-3 border border-gray-300 rounded-lg text-gray-700 active:bg-gray-100",children:"取消"}),e.jsx("button",{onClick:()=>{const e=parseFloat(d);if(isNaN(e)||e<=0)return void alert("请输入有效的充值金额");if(ze(e)){const e=T();n(e.toFixed(2)),x(""),c(!1)}},className:"flex-1 py-3 bg-[#07C160] text-white rounded-lg active:opacity-80",children:"确认充值"})]})]})})]})}},Symbol.toStringTag,{value:"Module"})),pr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const r=s(),l=a(),{characterName:n,chatId:i}=l.state||{},{showStatusBar:c}=o(),[d,x]=t.useState(""),[m,h]=t.useState("");return e.jsxs("div",{className:"h-screen flex flex-col bg-gray-50",children:[c&&e.jsx(xa,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between bg-white border-b border-gray-200",children:[e.jsx("button",{onClick:()=>r(`/chat/${i}`,{replace:!0}),className:"text-gray-700 text-base",children:"取消"}),e.jsx("h1",{className:"text-base font-semibold text-gray-900",children:"转账"}),e.jsx("button",{onClick:()=>{!d||parseFloat(d)<=0?alert("请输入转账金额"):r(`/chat/${i}`,{state:{transfer:{amount:parseFloat(d),message:m.trim()}}})},disabled:!d||parseFloat(d)<=0,className:"text-base font-medium "+(d&&parseFloat(d)>0?"text-[#576B95]":"text-gray-300"),children:"转账"})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsxs("div",{className:"bg-white px-5 py-4 mb-2",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1.5",children:"收款方"}),e.jsx("div",{className:"text-[15px] text-gray-900 font-medium",children:n})]}),e.jsxs("div",{className:"bg-white flex-1 flex flex-col",children:[e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"w-full px-8",children:[e.jsxs("div",{className:"flex items-baseline justify-center mb-2",children:[e.jsx("span",{className:"text-[40px] font-normal text-gray-900 mr-1",children:"¥"}),e.jsx("input",{type:"text",inputMode:"decimal",value:d,onChange:e=>{const t=e.target.value;(""===t||/^\d*\.?\d{0,2}$/.test(t))&&x(t)},placeholder:"0.00",autoFocus:!0,className:"text-[56px] font-normal text-gray-900 bg-transparent border-none outline-none text-center flex-1 placeholder-gray-300",style:{minWidth:"200px",maxWidth:"100%",letterSpacing:"0.02em"}})]}),e.jsx("div",{className:"h-[1px] bg-gray-200 mx-auto",style:{width:"280px"}}),e.jsx("div",{className:"text-center mt-4 text-xs text-gray-400",children:"单笔转账限额¥200,000.00"})]})}),e.jsx("div",{className:"px-5 py-4 border-t border-gray-100",children:e.jsx("input",{type:"text",value:m,onChange:e=>h(e.target.value),placeholder:"添加转账说明",maxLength:20,className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400 text-[15px]"})})]})]})]})}},Symbol.toStringTag,{value:"Module"})),fr=({applyToAll:s=!1})=>{const{background:a,getBackgroundStyle:r}=c(),[l,n]=t.useState(()=>"true"===localStorage.getItem("apply_background_to_all_pages"));return t.useEffect(()=>{const e=()=>{n("true"===localStorage.getItem("apply_background_to_all_pages"))};window.addEventListener("storage",e);const t=setInterval(e,500);return()=>{window.removeEventListener("storage",e),clearInterval(t)}},[]),s&&!l?e.jsx("div",{className:"absolute inset-0 z-0",style:{background:"linear-gradient(to bottom, #f9fafb, #f3f4f6)"}}):e.jsx("div",{className:"absolute inset-0 z-0",style:a?r():{background:"linear-gradient(to bottom, #f9fafb, #f3f4f6)"}})},br=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M9 18l6-6-6-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),jr=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("rect",{x:"2",y:"5",width:"20",height:"14",rx:"2",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M2 10h20",stroke:"currentColor",strokeWidth:"2"})]}),vr=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:[e.jsx("rect",{x:"3",y:"3",width:"7",height:"7",rx:"1",stroke:"currentColor",strokeWidth:"2"}),e.jsx("rect",{x:"14",y:"3",width:"7",height:"7",rx:"1",stroke:"currentColor",strokeWidth:"2"}),e.jsx("rect",{x:"3",y:"14",width:"7",height:"7",rx:"1",stroke:"currentColor",strokeWidth:"2"}),e.jsx("rect",{x:"14",y:"14",width:"7",height:"7",rx:"1",stroke:"currentColor",strokeWidth:"2"})]}),yr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const t=s(),{showStatusBar:a}=o(),r=[{id:1,name:"零钱",icon:ys,path:"/wallet",desc:"安全便捷的零钱包"},{id:2,name:"信用卡还款",icon:jr,path:"",desc:"免费还款，快速到账"},{id:3,name:"手机充值",icon:vr,path:"",desc:"话费充值，优惠多多"}];return e.jsxs("div",{className:"h-full flex flex-col relative overflow-hidden",children:[e.jsx(fr,{applyToAll:!0}),e.jsxs("div",{className:"relative z-10 h-full flex flex-col",children:[a&&e.jsx(xa,{}),e.jsxs("div",{className:"glass-effect border-b border-gray-200/50 bg-white flex items-center",children:[e.jsx("button",{onClick:()=>{t("/wechat/me")},className:"px-4 py-4 active:opacity-50 cursor-pointer flex items-center justify-center",children:e.jsx(ls,{size:24,className:"text-gray-900"})}),e.jsx("h1",{className:"flex-1 text-center text-[17px] font-semibold text-gray-900 pr-14",children:"服务"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-3 pt-3",children:e.jsx("div",{className:"glass-card rounded-2xl overflow-hidden bg-white",children:r.map((s,a)=>{const l=s.icon;return e.jsxs("div",{children:[e.jsxs("div",{onClick:()=>s.path&&t(s.path),className:"flex items-center px-4 py-4 ios-button cursor-pointer",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-orange-400 to-orange-500 rounded-xl flex items-center justify-center flex-shrink-0 shadow-lg",children:e.jsx(l,{size:24,className:"text-white"})}),e.jsxs("div",{className:"ml-4 flex-1",children:[e.jsx("div",{className:"text-[16px] font-medium text-gray-900",children:s.name}),s.desc&&e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:s.desc})]}),e.jsx(br,{size:20,className:"text-gray-400"})]}),a<r.length-1&&e.jsx("div",{className:"border-b border-gray-100 ml-[68px]"})]},s.id)})})})]})]})}},Symbol.toStringTag,{value:"Module"})),Nr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),[l,n]=t.useState([]);t.useEffect(()=>{n($e())},[]);const i=e=>{const t=new Date(e),s=new Date,a=new Date(s.getFullYear(),s.getMonth(),s.getDate()),r=new Date(a.getTime()-864e5),l=new Date(t.getFullYear(),t.getMonth(),t.getDate());return l.getTime()===a.getTime()?`今天 ${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`:l.getTime()===r.getTime()?`昨天 ${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`:`${t.getMonth()+1}月${t.getDate()}日 ${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`};return e.jsxs("div",{className:"h-screen flex flex-col bg-[#EDEDED]",children:[r&&e.jsx(xa,{}),e.jsxs("div",{className:"bg-white flex items-center border-b border-gray-200",children:[e.jsx("button",{onClick:()=>{a("/wallet")},className:"px-4 py-4 active:opacity-50 cursor-pointer flex items-center justify-center",children:e.jsx(ls,{size:24,className:"text-gray-900"})}),e.jsx("h1",{className:"flex-1 text-center text-[17px] font-medium text-gray-900 pr-14",children:"交易记录"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:0===l.length?e.jsx("div",{className:"flex flex-col items-center justify-center h-full",children:e.jsx("div",{className:"text-gray-400 text-sm",children:"暂无交易记录"})}):e.jsx("div",{className:"bg-white mt-3",children:l.map(t=>{const s="recharge"===t.type||"red_envelope_receive"===t.type||"transfer_receive"===t.type,a="intimate_pay"===t.type;return e.jsxs("div",{className:"px-4 py-4 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-[16px] text-gray-900",children:t.description}),t.characterName&&e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:[t.characterName,a&&e.jsx("span",{className:"ml-2 text-pink-500",children:"亲密付"})]})]}),e.jsxs("span",{className:"text-[18px] font-medium "+(s?"text-[#07C160]":"text-gray-900"),children:[s?"+":"-","¥",t.amount]})]}),e.jsx("div",{className:"text-xs text-gray-500",children:i(t.timestamp)})]},t.id)})})})]})}},Symbol.toStringTag,{value:"Module"})),wr=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),kr=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M12 5v14M5 12h14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),Cr=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,children:e.jsx("path",{d:"M9 18l6-6-6-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),Sr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),[l,n]=t.useState([]);t.useEffect(()=>{n(A())},[]);return e.jsxs("div",{className:"h-screen flex flex-col bg-[#EDEDED]",children:[r&&e.jsx(xa,{}),e.jsxs("div",{className:"bg-white flex items-center border-b border-gray-200",children:[e.jsx("button",{onClick:()=>a("/wechat/me"),className:"px-4 py-4 active:opacity-50 cursor-pointer flex items-center justify-center",children:e.jsx(ls,{size:24,className:"text-gray-900"})}),e.jsx("h1",{className:"flex-1 text-center text-[17px] font-medium text-gray-900 pr-14",children:"卡包"})]}),e.jsx("div",{className:"bg-white px-5 pt-6 pb-6 mt-3 mb-3",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-pink-400 to-red-400 rounded-full flex items-center justify-center mr-3",children:e.jsx(wr,{size:20,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-[18px] font-semibold text-gray-900",children:"亲密付"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"为家人朋友代付"})]})]})})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-3 pb-3",children:0===l.length?e.jsxs("div",{className:"bg-white rounded-2xl p-8 text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(wr,{size:32,className:"text-gray-400"})}),e.jsx("p",{className:"text-gray-500 text-sm mb-6",children:"还没有开通亲密付"}),e.jsx("button",{onClick:()=>a("/intimate-pay/create"),className:"bg-[#07C160] text-white px-8 py-3 rounded-lg text-[15px] font-medium active:opacity-80",children:"开通亲密付"})]}):e.jsxs(e.Fragment,{children:[l.map(t=>{const s=(e=>e.monthlyLimit-e.usedAmount)(t),r=(e=>e.usedAmount/e.monthlyLimit*100)(t);return e.jsxs("div",{onClick:()=>a(`/intimate-pay/detail/${t.characterId}`),className:"bg-white rounded-2xl p-4 mb-3 active:bg-gray-50 cursor-pointer",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center flex-shrink-0 overflow-hidden",children:t.characterAvatar?e.jsx("img",{src:t.characterAvatar,alt:t.characterName,className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-gray-500 text-lg",children:t.characterName[0]})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-[16px] font-medium text-gray-900",children:t.characterName}),e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-pink-100 text-pink-600",children:"user_to_character"===t.type?"你开通":"TA开通"})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:["user_to_character"===t.type?"TA本月剩余":"你本月剩余"," ¥",s.toFixed(2)]})]}),e.jsx(Cr,{size:20,className:"text-gray-400"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[e.jsxs("span",{children:["已用 ¥",t.usedAmount.toFixed(2)]}),e.jsxs("span",{children:["总额度 ¥",t.monthlyLimit.toFixed(2)]})]}),e.jsx("div",{className:"w-full h-2 bg-gray-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-pink-400 to-red-400 rounded-full transition-all",style:{width:`${Math.min(r,100)}%`}})})]})]},t.id)}),e.jsxs("button",{onClick:()=>a("/intimate-pay/create"),className:"w-full bg-white rounded-2xl p-4 flex items-center justify-center active:bg-gray-50",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center mr-3",children:e.jsx(kr,{size:20,className:"text-gray-600"})}),e.jsx("span",{className:"text-[16px] text-gray-900 font-medium",children:"开通新的亲密付"})]})]})})]})}},Symbol.toStringTag,{value:"Module"})),Ir=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{characterId:l}=r(),{showStatusBar:i}=o(),{characters:c}=n(),[d,x]=t.useState(""),[m,h]=t.useState(""),[u,g]=t.useState(!1),[p,f]=t.useState([]);t.useEffect(()=>{const e=A();f(e.map(e=>e.characterId))},[]);const b=c.filter(e=>!p.includes(e.id));return e.jsxs("div",{className:"h-screen flex flex-col bg-[#EDEDED]",children:[i&&e.jsx(xa,{}),e.jsxs("div",{className:"bg-white flex items-center justify-between border-b border-gray-200",children:[e.jsx("button",{onClick:()=>a(-1),className:"px-4 py-4 active:opacity-50 cursor-pointer flex items-center justify-center",children:e.jsx(ls,{size:24,className:"text-gray-900"})}),e.jsx("h1",{className:"absolute left-1/2 transform -translate-x-1/2 text-[17px] font-medium text-gray-900 pointer-events-none",children:"开通亲密付"}),e.jsx("button",{onClick:()=>{if(!d)return void alert("请选择要开通亲密付的联系人");const e=parseFloat(m);if(isNaN(e)||e<=0)return void alert("请输入有效的月额度");c.find(e=>e.id===d)?a(`/chat/${d}`,{state:{sendIntimatePay:!0,monthlyLimit:e}}):alert("角色不存在")},disabled:!d||!m,className:"px-4 py-4 text-[16px] "+(d&&m?"text-[#07C160]":"text-gray-400"),children:"完成"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"bg-white mt-3 px-4 py-3",children:[e.jsx("h2",{className:"text-sm text-gray-500 mb-3",children:"选择联系人"}),0===b.length?e.jsx("div",{className:"text-center py-8 text-gray-400 text-sm",children:"暂无可开通的联系人"}):e.jsx("div",{className:"space-y-2",children:b.map(t=>e.jsxs("div",{onClick:()=>{return e=t.id,void x(e);var e},className:"flex items-center p-3 rounded-xl cursor-pointer transition-colors "+(d===t.id?"bg-green-50 border-2 border-[#07C160]":"bg-gray-50 border-2 border-transparent active:bg-gray-100"),children:[e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center flex-shrink-0 overflow-hidden",children:t.avatar.startsWith("data:image")?e.jsx("img",{src:t.avatar,alt:t.name,className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-2xl",children:t.avatar})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("div",{className:"text-[16px] font-medium text-gray-900",children:t.name}),t.signature&&e.jsx("div",{className:"text-xs text-gray-500 mt-0.5 truncate",children:t.signature})]}),d===t.id&&e.jsx("div",{className:"w-6 h-6 bg-[#07C160] rounded-full flex items-center justify-center",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M5 12l5 5L20 7",stroke:"white",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"})})})]},t.id))})]}),d&&e.jsxs("div",{className:"bg-white mt-3 px-4 py-3",children:[e.jsx("h2",{className:"text-sm text-gray-500 mb-3",children:"设置月额度"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:[{label:"500元/月",value:500},{label:"1000元/月",value:1e3},{label:"2000元/月",value:2e3},{label:"3000元/月",value:3e3},{label:"5000元/月",value:5e3},{label:"自定义",value:0}].map(t=>e.jsx("button",{onClick:()=>{var e;0===(e=t.value)?(g(!0),h("")):(g(!1),h(e.toString()))},className:"py-3 rounded-xl text-[15px] font-medium transition-colors "+(0===t.value&&u||t.value>0&&m===t.value.toString()?"bg-green-50 text-[#07C160] border-2 border-[#07C160]":"bg-gray-50 text-gray-700 border-2 border-transparent active:bg-gray-100"),children:t.label},t.label))}),u&&e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"flex items-center border-2 border-[#07C160] rounded-xl px-4 py-3 bg-white",children:[e.jsx("span",{className:"text-xl text-gray-900 mr-2",children:"¥"}),e.jsx("input",{type:"number",value:m,onChange:e=>h(e.target.value),placeholder:"请输入月额度",className:"flex-1 text-xl outline-none",autoFocus:!0}),e.jsx("span",{className:"text-sm text-gray-500",children:"/月"})]})})]}),d&&m&&e.jsxs("div",{className:"bg-[#FFF9E6] mx-4 mt-4 p-4 rounded-xl",children:[e.jsxs("p",{className:"text-xs text-[#B8860B] leading-relaxed",children:["• 开通后，对方每月可使用您的零钱进行消费，最高额度为 ¥",m]}),e.jsx("p",{className:"text-xs text-[#B8860B] leading-relaxed mt-2",children:"• 每月1日自动重置额度，消费记录可在零钱交易记录中查看"}),e.jsx("p",{className:"text-xs text-[#B8860B] leading-relaxed mt-2",children:"• 您可以随时修改额度或关闭亲密付"})]})]})]})}},Symbol.toStringTag,{value:"Module"})),_r=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{characterId:l}=r(),{showStatusBar:n}=o(),[i,c]=t.useState(null),[d,x]=t.useState(!1),[m,h]=t.useState("");if(t.useEffect(()=>{if(l){const e=Le(l);c(e),e&&h(e.monthlyLimit.toString())}},[l]),!i)return e.jsxs("div",{className:"h-screen flex flex-col bg-[#EDEDED]",children:[n&&e.jsx(xa,{}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400 text-sm",children:"未找到亲密付关系"})})]});const u=i.monthlyLimit-i.usedAmount,g=i.usedAmount/i.monthlyLimit*100;return e.jsxs("div",{className:"h-screen flex flex-col bg-[#EDEDED]",children:[n&&e.jsx(xa,{}),e.jsxs("div",{className:"bg-white flex items-center border-b border-gray-200",children:[e.jsx("button",{onClick:()=>a("/card-wallet"),className:"px-4 py-4 active:opacity-50 cursor-pointer flex items-center justify-center",children:e.jsx(ls,{size:24,className:"text-gray-900"})}),e.jsx("h1",{className:"flex-1 text-center text-[17px] font-medium text-gray-900 pr-14",children:"user_to_character"===i.type?"为对方开通的亲密付":"对方为你开通的亲密付"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"bg-white mt-3 px-5 py-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center flex-shrink-0 overflow-hidden",children:i.characterAvatar?i.characterAvatar.startsWith("data:image")?e.jsx("img",{src:i.characterAvatar,alt:i.characterName,className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-3xl",children:i.characterAvatar}):e.jsx("span",{className:"text-gray-500 text-2xl",children:i.characterName[0]})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-[18px] font-semibold text-gray-900",children:i.characterName}),e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:["开通于 ",(e=>{const t=new Date(e);return`${t.getFullYear()}年${t.getMonth()+1}月${t.getDate()}日`})(i.createdAt)]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-pink-50 to-red-50 rounded-2xl p-5",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"user_to_character"===i.type?"对方本月剩余额度":"你本月剩余额度"}),e.jsxs("div",{className:"text-[36px] font-light text-gray-900 mb-4",children:["¥",u.toFixed(2)]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-600",children:[e.jsxs("span",{children:["已用 ¥",i.usedAmount.toFixed(2)]}),e.jsxs("span",{children:["总额度 ¥",i.monthlyLimit.toFixed(2)]})]}),e.jsx("div",{className:"w-full h-2 bg-white rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-pink-400 to-red-400 rounded-full transition-all",style:{width:`${Math.min(g,100)}%`}})})]})]})]}),e.jsxs("div",{className:"bg-white mt-3 px-4",children:["user_to_character"===i.type&&e.jsxs("button",{onClick:()=>x(!0),className:"w-full flex items-center justify-between py-4 border-b border-gray-100 active:bg-gray-50",children:[e.jsx("span",{className:"text-[16px] text-gray-900",children:"修改月额度"}),e.jsxs("div",{className:"flex items-center",children:[e.jsxs("span",{className:"text-sm text-gray-500 mr-2",children:["当前 ¥",i.monthlyLimit.toFixed(2),"/月"]}),e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M9 18l6-6-6-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]})]}),e.jsx("button",{onClick:()=>{confirm(`确定要关闭与 ${i.characterName} 的亲密付吗？`)&&(l&&Ae(l)?(alert("已关闭亲密付"),a("/card-wallet")):alert("关闭失败"))},className:"w-full py-4 text-[16px] text-red-500 active:bg-gray-50",children:"关闭亲密付"})]}),e.jsx("div",{className:"px-4 mt-6 pb-6",children:e.jsxs("div",{className:"bg-[#FFF9E6] p-4 rounded-xl",children:[e.jsx("p",{className:"text-xs text-[#B8860B] leading-relaxed",children:"• 每月1日自动重置额度"}),"user_to_character"===i.type?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs text-[#B8860B] leading-relaxed mt-2",children:"• 对方的消费记录可在零钱交易记录中查看"}),e.jsx("p",{className:"text-xs text-[#B8860B] leading-relaxed mt-2",children:"• 你可以随时修改额度或关闭亲密付"})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs text-[#B8860B] leading-relaxed mt-2",children:"• 你的消费记录对方可以查看"}),e.jsx("p",{className:"text-xs text-[#B8860B] leading-relaxed mt-2",children:"• 对方可以随时修改额度或关闭亲密付"}),e.jsx("p",{className:"text-xs text-[#B8860B] leading-relaxed mt-2 font-semibold",children:"• 你无法修改对方为你开通的亲密付额度"})]})]})})]}),d&&"user_to_character"===i.type&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:()=>x(!1),children:e.jsxs("div",{className:"bg-white rounded-2xl w-[85%] max-w-md p-6",onClick:e=>e.stopPropagation(),children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4 text-center",children:"修改月额度"}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center border-2 border-[#07C160] rounded-lg px-4 py-3",children:[e.jsx("span",{className:"text-2xl text-gray-900 mr-2",children:"¥"}),e.jsx("input",{type:"number",value:m,onChange:e=>h(e.target.value),placeholder:"0.00",className:"flex-1 text-2xl outline-none",autoFocus:!0}),e.jsx("span",{className:"text-sm text-gray-500 ml-2",children:"/月"})]})}),e.jsx("div",{className:"grid grid-cols-3 gap-2 mb-6",children:[500,1e3,2e3,3e3,5e3,1e4].map(t=>e.jsx("button",{onClick:()=>h(t.toString()),className:"py-2 border border-gray-300 rounded-lg text-gray-700 active:bg-gray-100",children:t},t))}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>x(!1),className:"flex-1 py-3 border border-gray-300 rounded-lg text-gray-700 active:bg-gray-100",children:"取消"}),e.jsx("button",{onClick:()=>{if("user_to_character"!==(null==i?void 0:i.type))return alert("无法修改对方为你开通的亲密付额度"),void x(!1);const e=parseFloat(m);if(isNaN(e)||e<=0)alert("请输入有效的额度");else if(l&&Te(l,e)){const e=Le(l);c(e),x(!1),alert("额度修改成功")}else alert("修改失败")},className:"flex-1 py-3 bg-[#07C160] text-white rounded-lg active:opacity-80",children:"确认"})]})]})})]})}},Symbol.toStringTag,{value:"Module"})),Mr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{characterId:l,monthlyLimit:i}=r(),{showStatusBar:c}=o(),{getCharacter:d}=n(),[x,m]=t.useState(null);t.useEffect(()=>{if(l){const e=d(l);m(e)}},[l,d]);const h=e=>{var t;if(!l||!x)return;const s=`chat_messages_${l}`,a=localStorage.getItem(s);if(a){const r=JSON.parse(a);for(let a=r.length-1;a>=0;a--)if("intimate_pay"===r[a].messageType&&"received"===r[a].type&&"pending"===(null==(t=r[a].intimatePay)?void 0:t.status)){r[a].intimatePay.status=e;const t={id:Date.now(),type:"system",content:"accepted"===e?`你接受了${x.name}的亲密付`:`你拒绝了${x.name}的亲密付`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"system"};r.push(t),localStorage.setItem(s,JSON.stringify(r));break}}};return x&&i?e.jsxs("div",{className:"h-screen flex flex-col bg-[#EDEDED]",children:[c&&e.jsx(xa,{}),e.jsxs("div",{className:"bg-white flex items-center border-b border-gray-200",children:[e.jsx("button",{onClick:()=>a(`/chat/${l}`,{replace:!0}),className:"px-4 py-4 active:opacity-50 cursor-pointer flex items-center justify-center",children:e.jsx(ls,{size:24,className:"text-gray-900"})}),e.jsx("h1",{className:"flex-1 text-center text-[17px] font-medium text-gray-900 pr-14",children:"接受亲密付"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 pt-6",children:[e.jsx("div",{className:"bg-white rounded-2xl p-6 mb-4",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-200 rounded-full flex items-center justify-center mb-4 overflow-hidden",children:x.avatar.startsWith("data:image")?e.jsx("img",{src:x.avatar,alt:x.name,className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-4xl",children:x.avatar})}),e.jsx("div",{className:"text-lg font-semibold text-gray-900 mb-2",children:x.name}),e.jsx("div",{className:"text-sm text-gray-500",children:"为你开通了亲密付"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-pink-50 to-red-50 rounded-2xl p-6 mb-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"每月可用额度"}),e.jsxs("div",{className:"text-[48px] font-light text-gray-900 mb-4",children:["¥",parseFloat(i).toFixed(2)]}),e.jsx("div",{className:"w-16 h-16 rounded-full flex items-center justify-center mx-auto overflow-hidden",children:e.jsx("img",{src:Ba,alt:"亲密付",className:"w-full h-full object-cover"})})]})}),e.jsxs("div",{className:"bg-[#FFF9E6] rounded-2xl p-4 mb-6",children:[e.jsx("div",{className:"text-sm font-medium text-[#B8860B] mb-2",children:"亲密付说明"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-[#B8860B] leading-relaxed",children:"• 接受后，你每月可使用对方的零钱进行消费"}),e.jsx("p",{className:"text-xs text-[#B8860B] leading-relaxed",children:"• 每月1日自动重置额度"}),e.jsx("p",{className:"text-xs text-[#B8860B] leading-relaxed",children:"• 对方可以随时查看你的消费记录"}),e.jsx("p",{className:"text-xs text-[#B8860B] leading-relaxed",children:"• 对方可以随时修改额度或关闭亲密付"})]})]}),e.jsxs("div",{className:"space-y-3 pb-6",children:[e.jsx("button",{onClick:()=>{if(!l||!i||!x)return void alert("参数错误");const e=parseFloat(i);if(isNaN(e)||e<=0)return void alert("额度无效");De(x.id,x.name,e,x.avatar)?(h("accepted"),alert("已接受亲密付！"),a(`/chat/${l}`,{replace:!0})):alert("接受失败，可能已经开通过了")},className:"w-full bg-gradient-to-r from-pink-400 to-red-400 text-white py-4 rounded-xl text-[16px] font-medium active:opacity-80 shadow-lg",children:"接受亲密付"}),e.jsx("button",{onClick:()=>{confirm("确定要拒绝这个亲密付吗？")&&(h("rejected"),a(`/chat/${l}`,{replace:!0}))},className:"w-full bg-white text-gray-700 py-4 rounded-xl text-[16px] font-medium active:bg-gray-50 border border-gray-200",children:"暂不接受"})]})]})]}):e.jsxs("div",{className:"h-screen flex flex-col bg-[#EDEDED]",children:[c&&e.jsx(xa,{}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400 text-sm",children:"加载中..."})})]})}},Symbol.toStringTag,{value:"Module"})),zr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const t=s(),{showStatusBar:a}=o();return e.jsxs("div",{className:"h-screen flex flex-col bg-[#EDEDED]",children:[a&&e.jsx(xa,{}),e.jsxs("div",{className:"bg-white flex items-center border-b border-gray-200",children:[e.jsx("button",{onClick:()=>{t("/wallet")},className:"px-4 py-4 active:opacity-50 cursor-pointer flex items-center justify-center",children:e.jsx(ls,{size:24,className:"text-gray-900"})}),e.jsx("h1",{className:"flex-1 text-center text-[17px] font-medium text-gray-900 pr-14",children:"帮助中心"})]}),e.jsxs("div",{className:"bg-gradient-to-r from-pink-50 to-purple-50 px-5 py-6 mx-4 mt-4 rounded-2xl",children:[e.jsx("div",{className:"text-center mb-2",children:e.jsx("span",{className:"text-4xl",children:"💡"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-800 text-center mb-2",children:"欢迎来到帮助中心~ ✨"}),e.jsx("p",{className:"text-sm text-gray-600 text-center",children:"有任何疑问都可以在这里找到答案哦！"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-4",children:[{id:1,emoji:"💰",title:"零钱是什么？",content:"零钱是你的虚拟钱包，可以用来发红包、转账给AI朋友哦~"},{id:2,emoji:"💝",title:"如何充值？",content:"点击充值按钮，输入金额就可以啦！支持快捷金额选择，超方便的~"},{id:3,emoji:"🎁",title:"发红包和转账",content:"在聊天界面点击+号，就能给AI朋友发红包或转账啦！记得先充值哦~"},{id:4,emoji:"💖",title:"亲密付是什么？",content:"亲密付可以让你的AI朋友每月使用一定额度的零钱，就像真正的亲密关系一样呢~ ✨"},{id:5,emoji:"📊",title:"交易记录",content:"所有的充值、红包、转账记录都会保存在交易记录里，随时可以查看~"},{id:6,emoji:"🔒",title:"安全提示",content:"你的零钱数据安全保存在本地浏览器中，请不要清除浏览器缓存哦！"}].map(t=>e.jsx("div",{className:"bg-white rounded-2xl p-4 mb-3 shadow-sm",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("span",{className:"text-3xl mr-3",children:t.emoji}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-[16px] font-semibold text-gray-900 mb-2",children:t.title}),e.jsx("p",{className:"text-sm text-gray-600 leading-relaxed",children:t.content})]})]})},t.id))}),e.jsx("div",{className:"bg-white border-t border-gray-100 px-6 py-4",children:e.jsx("p",{className:"text-xs text-gray-400 text-center leading-relaxed",children:"💕 还有问题？试试和AI朋友聊聊天吧~ 💕"})})]})}},Symbol.toStringTag,{value:"Module"})),$r=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const{characterId:a}=r(),l=a,i=s(),{showStatusBar:c}=o(),{getCharacter:d}=n(),x=l?d(l):void 0,[m,h]=t.useState([]),[u,g]=t.useState("all"),[p,f]=t.useState(""),[b,j]=t.useState(null);t.useEffect(()=>{l&&v()},[l,u,p]);const v=()=>{if(!l)return;const e=O.getSystem(l),t={};"all"!==u&&(t.type=u),p&&(t.keyword=p);const s=e.searchMemories(t);h(s),j(e.getStatistics())},y=e=>{const t=new Date(e),s=(new Date).getTime()-t.getTime(),a=Math.floor(s/864e5);return 0===a?"今天":1===a?"昨天":a<7?`${a}天前`:a<30?`${Math.floor(a/7)}周前`:a<365?`${Math.floor(a/30)}个月前`:`${Math.floor(a/365)}年前`};return e.jsxs("div",{className:"h-full flex flex-col bg-gray-50",children:[e.jsxs("div",{className:"glass-effect sticky top-0 z-50",children:[c&&e.jsx(xa,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>i(`/chat-settings/${l}`,{replace:!0}),className:"ios-button text-gray-700 hover:text-gray-900",children:e.jsx(ls,{size:24})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-base font-semibold text-gray-900",children:[null==x?void 0:x.name," 的记忆"]}),b&&e.jsxs("p",{className:"text-xs text-gray-500",children:["共 ",b.total," 条记忆"]})]})]}),e.jsx("button",{onClick:()=>{if(!l)return;const e=O.getSystem(l).exportMemories(),t=new Blob([e],{type:"application/json"}),s=URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download=`${null==x?void 0:x.name}_memories_${Date.now()}.json`,a.click()},className:"text-sm text-blue-500 hover:text-blue-600",children:"导出"})]})]}),b&&e.jsx("div",{className:"bg-white p-4 border-b border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-5 gap-2",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-gray-900",children:b.byType.fact}),e.jsx("div",{className:"text-xs text-gray-500",children:"事实"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-gray-900",children:b.byType.preference}),e.jsx("div",{className:"text-xs text-gray-500",children:"偏好"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-gray-900",children:b.byType.event}),e.jsx("div",{className:"text-xs text-gray-500",children:"事件"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-gray-900",children:b.byType.emotion}),e.jsx("div",{className:"text-xs text-gray-500",children:"情绪"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-gray-900",children:b.byType.relationship}),e.jsx("div",{className:"text-xs text-gray-500",children:"关系"})]})]})}),e.jsxs("div",{className:"bg-white p-4 border-b border-gray-200",children:[e.jsx("input",{type:"text",placeholder:"搜索记忆...",value:p,onChange:e=>f(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg mb-3 focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2",children:[e.jsx("button",{onClick:()=>g("all"),className:"px-3 py-1 rounded-full text-sm whitespace-nowrap transition-all "+("all"===u?"bg-gray-900 text-white":"glass-card text-gray-700"),children:"全部"}),e.jsx("button",{onClick:()=>g("fact"),className:"px-3 py-1 rounded-full text-sm whitespace-nowrap transition-all "+("fact"===u?"bg-gray-900 text-white":"glass-card text-gray-700"),children:"事实"}),e.jsx("button",{onClick:()=>g("preference"),className:"px-3 py-1 rounded-full text-sm whitespace-nowrap transition-all "+("preference"===u?"bg-gray-900 text-white":"glass-card text-gray-700"),children:"偏好"}),e.jsx("button",{onClick:()=>g("event"),className:"px-3 py-1 rounded-full text-sm whitespace-nowrap transition-all "+("event"===u?"bg-gray-900 text-white":"glass-card text-gray-700"),children:"事件"}),e.jsx("button",{onClick:()=>g("emotion"),className:"px-3 py-1 rounded-full text-sm whitespace-nowrap transition-all "+("emotion"===u?"bg-gray-900 text-white":"glass-card text-gray-700"),children:"情绪"}),e.jsx("button",{onClick:()=>g("relationship"),className:"px-3 py-1 rounded-full text-sm whitespace-nowrap transition-all "+("relationship"===u?"bg-gray-900 text-white":"glass-card text-gray-700"),children:"关系"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:0===m.length?e.jsxs("div",{className:"text-center py-12 text-gray-400",children:[e.jsx("img",{src:Ka,alt:"记忆",className:"w-20 h-20 mx-auto mb-3 opacity-30"}),e.jsx("div",{children:"暂无记忆"})]}):m.map(t=>{return e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("span",{className:"px-2 py-1 rounded text-xs font-medium "+(t.type,"bg-gray-100 text-gray-900"),children:(s=t.type,{fact:"事实",preference:"偏好",event:"事件",emotion:"情绪",relationship:"关系"}[s])}),e.jsx("button",{onClick:()=>(e=>{if(l&&confirm("确定要删除这条记忆吗？")){const t=O.getSystem(l);t.memories.delete(e),t.saveMemories(),v()}})(t.id),className:"text-gray-400 hover:text-red-500 text-xs",children:"删除"})]}),e.jsx("div",{className:"text-gray-800 mb-2",children:t.content}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{children:["重要度: ",t.importance.toFixed(1),"/10"]}),e.jsxs("span",{children:["访问: ",t.accessCount,"次"]})]}),e.jsx("span",{children:y(t.timestamp)})]}),t.tags.length>0&&e.jsx("div",{className:"mt-2 flex gap-1 flex-wrap",children:t.tags.map((t,s)=>e.jsxs("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 rounded text-xs",children:["#",t]},s))})]},t.id);var s})})]})}},Symbol.toStringTag,{value:"Module"})),Lr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const{characterId:a}=r(),l=a,i=s(),{showStatusBar:c}=o(),{getCharacter:d}=n(),x=l?d(l):void 0,m=Ua(l||"",null==x?void 0:x.name,null==x?void 0:x.description),[h,u]=t.useState(""),[g,p]=t.useState(30),[f,b]=t.useState(!1);t.useEffect(()=>{if(l){const e=localStorage.getItem(`memory_summary_${l}`);e&&u(e);const t=localStorage.getItem(`memory_summary_interval_${l}`);t&&p(parseInt(t))}},[l]);return x?e.jsxs("div",{className:"h-full flex flex-col bg-gray-50",children:[e.jsxs("div",{className:"glass-effect sticky top-0 z-50",children:[c&&e.jsx(xa,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>i(`/chat-settings/${l}`,{replace:!0}),className:"ios-button text-gray-700 hover:text-gray-900 -ml-2",children:e.jsx(ls,{size:24})}),e.jsx("h1",{className:"text-base font-semibold text-gray-900",children:"记忆总结"}),e.jsx("button",{onClick:async()=>{if(l&&!f)try{b(!0);const e=localStorage.getItem(`chat_messages_${l}`);if(!e)return void alert("暂无聊天记录");const t=JSON.parse(e),s=t.filter(e=>"sent"===e.type),a=t.filter(e=>"received"===e.type);if(0===s.length||0===a.length)return void alert("聊天记录不足，无法生成总结");const r=s.slice(-50),n=a.slice(-50),i=r.map(e=>e.content||e.emojiDescription||e.photoDescription||e.voiceText||"").join("\n"),c=n.map(e=>e.content||e.emojiDescription||e.photoDescription||e.voiceText||"").join("\n"),o=await m.extractMemories(i,c);if(o.summary&&o.summary.trim()){const e=localStorage.getItem(`memory_summary_${l}`)||"",t=e+(e?"\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n":"")+`【手动总结 - ${(new Date).toLocaleString("zh-CN")}】\n\n${o.summary}`;u(t),localStorage.setItem(`memory_summary_${l}`,t),alert("总结已更新！")}else alert("对话内容太少，暂时无法生成总结。请继续聊天后再试。")}catch(e){alert("生成总结失败，请检查 API 设置")}finally{b(!1)}},disabled:f,className:"text-sm font-medium px-3 py-1 rounded-lg transition-colors "+(f?"text-gray-400 bg-gray-100 cursor-not-allowed":"text-wechat-primary bg-wechat-primary/10 hover:bg-wechat-primary/20"),children:f?"生成中...":"手动总结"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:h?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx("img",{src:Xa,alt:"总结",className:"w-6 h-6 object-contain"}),e.jsx("span",{children:"关于你的总结"})]}),e.jsx("div",{className:"prose prose-sm max-w-none",children:e.jsx("div",{className:"text-gray-700 leading-relaxed whitespace-pre-wrap",style:{lineHeight:"1.8"},children:h})})]}),e.jsxs("div",{className:"bg-blue-50 rounded-xl p-4",children:[e.jsxs("p",{className:"text-xs text-blue-600",children:["💡 提示：总结每 ",g," 轮对话自动更新，只包含你明确说过的信息。"]}),e.jsx("p",{className:"text-xs text-blue-500 mt-2",children:'可在聊天设置中调整总结间隔（10-100轮），或点击右上角"手动总结"立即更新'})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("img",{src:Xa,alt:"记忆总结",className:"w-24 h-24 mx-auto mb-4 opacity-60"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:"AI 记忆总结"}),e.jsxs("p",{className:"text-sm text-gray-500 px-4",children:["每 ",g," 轮对话后，AI 会自动总结关于你的重要信息"]}),e.jsx("p",{className:"text-xs text-gray-400 mt-2 px-4",children:'暂无总结，请继续对话或点击右上角"手动总结"按钮'})]})})]}):e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx("p",{className:"text-gray-500",children:"角色不存在"})})}},Symbol.toStringTag,{value:"Module"})),Ar=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),[r,l]=t.useState(!1),[n,i]=t.useState(null),[c,o]=t.useState(()=>Be()),d=e=>e<1024?e+" B":e<1048576?(e/1024).toFixed(2)+" KB":(e/1024/1024).toFixed(2)+" MB";return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[e.jsxs("div",{className:"bg-white border-b border-gray-200 px-4 py-3 flex items-center",children:[e.jsx("button",{onClick:()=>a(-1),className:"mr-3",children:e.jsx(ls,{})}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"内存清理"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 mb-4 shadow-sm",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-900 mb-3",children:"存储使用情况"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"总大小"}),e.jsx("span",{className:"font-semibold text-blue-600",children:d(c.totalSize)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"项目数量"}),e.jsx("span",{className:"font-semibold",children:c.itemCount})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 mb-4 shadow-sm",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-900 mb-3",children:"占用最多空间的项目"}),e.jsx("div",{className:"space-y-2",children:c.topKeys.map((t,s)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600 truncate flex-1 mr-2",children:t.key.length>30?t.key.substring(0,30)+"...":t.key}),e.jsx("span",{className:"font-semibold text-gray-900 whitespace-nowrap",children:d(t.size)})]},s))})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-blue-900 mb-2",children:"📝 清理说明"}),e.jsxs("ul",{className:"text-xs text-blue-800 space-y-1",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"完全可选"})," - 系统不会自动清理你的聊天记录"]}),e.jsx("li",{children:"• 每个聊天只保留最近1000条消息"}),e.jsx("li",{children:"• 删除超过7天的过期红包数据"}),e.jsx("li",{children:"• 不影响角色设置、用户数据、记忆系统"}),e.jsx("li",{children:"• 只在感觉卡顿或空间不足时使用"})]})]}),e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4 mb-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-purple-900 mb-2",children:"💝 保留回忆"}),e.jsx("p",{className:"text-xs text-purple-800",children:"聊天记录是珍贵的回忆。系统已移除自动限制，会保存你的所有对话。 只有在你主动点击清理时，才会删除超过1000条的旧消息。"})]}),n&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-green-900 mb-2",children:"✅ 清理完成"}),e.jsxs("div",{className:"text-xs text-green-800 space-y-1",children:[e.jsxs("div",{children:["释放空间: ",d(n.before.totalSize-n.after.totalSize)]}),e.jsxs("div",{children:["处理聊天: ",n.messageCleanup.deletedKeys," 个"]}),e.jsxs("div",{children:["删除过期数据: ",n.expiredCleanup.deletedKeys," 个"]}),n.messageCleanup.errors.length>0&&e.jsxs("div",{className:"text-red-600 mt-2",children:["错误: ",n.messageCleanup.errors.join(", ")]})]})]}),e.jsx("button",{onClick:async()=>{if(!r&&window.confirm("确定要清理旧数据吗？这将删除超过1000条的旧消息和过期数据。")){l(!0);try{const e=Ee(1e3);i(e),o(e.after)}catch(e){alert("清理失败: "+e)}finally{l(!1)}}},disabled:r,className:"w-full py-3 rounded-lg font-semibold text-white "+(r?"bg-gray-400 cursor-not-allowed":"bg-red-500 hover:bg-red-600 active:bg-red-700"),children:r?"清理中...":"开始清理"}),e.jsx("div",{className:"mt-4 bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsx("p",{className:"text-xs text-yellow-800",children:"⚠️ 清理后的数据无法恢复，请确认后再操作"})})]})]})}},Symbol.toStringTag,{value:"Module"})),Tr="/zhizhi/assets/pencil-icon-m64sbqV0.webp",Dr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:l}=o(),{id:i}=r(),{getCharacter:c}=n(),d=i?c(i):void 0,[x,m]=t.useState([]),[h,u]=t.useState(!1),[g,p]=t.useState(null);t.useEffect(()=>{if(i){const e=Pe(i);m(e)}},[i]),t.useEffect(()=>{if(!i)return;const e=()=>{const e=Pe(i);m(e)},t=t=>{var s,a;const r=t;(null==(s=r.detail)?void 0:s.characterId)===i&&(e(),(null==(a=r.detail)?void 0:a.diaryId)&&p(r.detail.diaryId))};window.addEventListener("diaryUpdated",t),window.addEventListener("storage",e);const s=setInterval(e,2e3);return()=>{window.removeEventListener("diaryUpdated",t),window.removeEventListener("storage",e),clearInterval(s)}},[i]);return e.jsx("div",{className:"h-full flex flex-col bg-gray-50",children:e.jsxs("div",{className:"fixed inset-0 bg-gradient-to-br from-pink-50 via-purple-50 to-blue-50 flex flex-col",children:[e.jsxs("div",{className:"glass-effect shadow-sm bg-white/80 backdrop-blur-lg flex-shrink-0",children:[l&&e.jsx(xa,{}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsx("button",{onClick:()=>a(`/chat-settings/${i}`,{replace:!0}),className:"ios-button text-gray-700 hover:text-gray-900",children:e.jsx(ls,{size:24})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:Za,alt:"日记",className:"w-6 h-6 object-contain"}),e.jsxs("h1",{className:"text-base font-semibold text-gray-900",children:[(null==d?void 0:d.name)||"TA","的日记本"]})]}),e.jsx("button",{onClick:()=>{if(!i)return;const e=Fe(i),t=new Blob([e],{type:"text/plain;charset=utf-8"}),s=URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download=`${(null==d?void 0:d.name)||"TA"}的日记_${(new Date).toLocaleDateString()}.txt`,a.click(),URL.revokeObjectURL(s)},className:"text-sm text-blue-600 hover:text-blue-700 px-3 py-1 rounded-lg hover:bg-white/50 transition-colors",disabled:0===x.length,children:"导出"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"max-w-2xl mx-auto p-4 pb-20",children:[e.jsx("button",{onClick:async()=>{if(i&&d){u(!0);try{const e=`chat_messages_${i}`,t=localStorage.getItem(e),s=t?JSON.parse(t):[],a=`character_status_${i}`,r=localStorage.getItem(a),l=r?JSON.parse(r):{weather:"晴 25°C",location:"家里",mood:"平静"},n=await Oe(i,d.name,d.description,s,l,x.slice(0,3));n?(We(i,n),m(e=>[n,...e]),p(n.id),alert("✅ 日记写好了！")):alert("TA今天不想写日记 😊")}catch(e){alert("❌ 生成失败，请重试")}finally{u(!1)}}},disabled:h,className:"w-full glass-card rounded-2xl p-6 mb-6 shadow-lg border border-white/50 hover:shadow-xl transition-all active:scale-98 disabled:opacity-50",children:h?e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:Tr,alt:"写日记",className:"w-12 h-12 object-contain"}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-5 h-5 border-2 border-purple-500 border-t-transparent rounded-full animate-spin"})]}),e.jsxs("div",{className:"text-gray-700",children:[(null==d?void 0:d.name)||"TA","正在写日记..."]}),e.jsx("div",{className:"text-sm text-gray-500",children:"回忆今天发生的事..."})]}):e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("img",{src:Tr,alt:"写日记",className:"w-16 h-16 object-contain"}),e.jsx("div",{className:"text-lg font-medium text-gray-900",children:"让TA写一篇日记"}),e.jsx("div",{className:"text-sm text-gray-500",children:"点击后，TA会根据最近的聊天写一篇日记"})]})}),0===x.length?e.jsxs("div",{className:"glass-card rounded-2xl p-12 text-center shadow-lg border border-white/50",children:[e.jsx("img",{src:Za,alt:"日记",className:"w-24 h-24 object-contain mx-auto mb-4"}),e.jsx("div",{className:"text-gray-600 mb-2",children:"还没有日记"}),e.jsx("div",{className:"text-sm text-gray-400",children:"点击上面的按钮，让TA写第一篇日记吧"})]}):e.jsx("div",{className:"space-y-4",children:x.map(t=>e.jsxs("div",{className:"glass-card rounded-2xl p-5 shadow-lg border border-white/50 hover:shadow-xl transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("img",{src:"/zhizhi/assets/calendar-icon-DiRG13Pq.webp",alt:"日期",className:"w-4 h-4 object-contain"}),e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[t.date," ",t.time]})]}),t.weather&&e.jsx("div",{className:"flex items-center gap-3 text-xs text-gray-500",children:e.jsxs("span",{children:["☀️ ",t.weather]})})]}),e.jsx("button",{onClick:()=>{return e=t.id,void(i&&confirm("确定要删除这篇日记吗？")&&(Re(i,e),m(t=>t.filter(t=>t.id!==e))));var e},className:"text-gray-400 hover:opacity-70 transition-opacity p-1",children:e.jsx("img",{src:"/zhizhi/assets/trash-icon-D9S_xoy4.webp",alt:"删除",className:"w-5 h-5 object-contain"})})]}),e.jsx("div",{className:"text-gray-800 leading-relaxed "+(g===t.id?"max-h-[600px] overflow-y-auto":""),children:t.content.split(/(\[照片:.+?\])/).map((t,s)=>{const a=t.match(/\[照片:(.+?)\]/);if(a){const t=a[1];return e.jsx("div",{className:"my-3 flex justify-center",children:e.jsx(Fa,{description:t,messageId:Date.now()+s})},s)}return e.jsx("span",{className:"whitespace-pre-wrap",children:t},s)})}),t.content.length>100&&e.jsx("button",{onClick:()=>p(g===t.id?null:t.id),className:"mt-3 text-sm text-blue-600 hover:text-blue-700 transition-colors",children:g===t.id?"▲ 收起":"▼ 展开阅读"})]},t.id))}),x.length>0&&e.jsxs("div",{className:"mt-6 text-center text-sm text-gray-500",children:["共 ",x.length," 篇日记"]})]})})]})})}},Symbol.toStringTag,{value:"Module"})),Br=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const t=s(),{id:a}=r(),{getCharacter:l}=n(),{showStatusBar:i}=o(),c=a?l(a):void 0,d=a?k(a):null,x=d?Ue(d.currentStreak):null,m=d?Ve(d.currentStreak):null,h=a?Je(a):0;return d&&c?e.jsxs("div",{className:"h-screen flex flex-col bg-gradient-to-br from-orange-50 via-red-50 to-pink-50",children:[i&&e.jsx(xa,{}),e.jsx("div",{className:"glass-effect sticky top-0 z-10 shadow-sm bg-white/80 backdrop-blur-lg",children:e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsx("button",{onClick:()=>t(-1),className:"p-2 hover:bg-white/50 rounded-full transition-colors",children:e.jsx(ls,{className:"w-6 h-6 text-gray-700"})}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"🔥 连续聊天"}),e.jsx("div",{className:"w-10"})]})}),e.jsxs("div",{className:"max-w-2xl mx-auto p-4 pb-20",children:[e.jsxs("div",{className:"glass-card rounded-3xl p-8 mb-6 shadow-xl border border-white/50 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🔥"}),e.jsx("div",{className:"text-5xl font-bold text-orange-600 mb-2",children:d.currentStreak}),e.jsx("div",{className:"text-gray-600 mb-4",children:"连续聊天天数"}),x&&e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-orange-100 to-red-100 rounded-full",children:[e.jsx("span",{className:"text-2xl",children:x.emoji}),e.jsx("span",{className:"font-medium text-gray-900",children:x.name})]})]}),m&&e.jsxs("div",{className:"glass-card rounded-2xl p-6 mb-6 shadow-lg border border-white/50",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"🎯 下一个里程碑"})}),e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsx("div",{className:"text-4xl",children:m.emoji}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xl font-bold text-gray-900 mb-1",children:m.name}),e.jsxs("div",{className:"text-sm text-gray-600",children:["还需要 ",m.days-d.currentStreak," 天"]})]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:"bg-gradient-to-r from-orange-500 to-red-500 h-full rounded-full transition-all duration-500",style:{width:d.currentStreak/m.days*100+"%"}})}),e.jsxs("div",{className:"text-xs text-gray-500 mt-2 text-right",children:[d.currentStreak," / ",m.days," 天"]})]}),e.jsxs("div",{className:"glass-card rounded-2xl p-6 mb-6 shadow-lg border border-white/50",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"📊 聊天统计"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white/50 rounded-xl p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600 mb-1",children:d.longestStreak}),e.jsx("div",{className:"text-sm text-gray-600",children:"最长记录"})]}),e.jsxs("div",{className:"bg-white/50 rounded-xl p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600 mb-1",children:d.totalDays}),e.jsx("div",{className:"text-sm text-gray-600",children:"总聊天天数"})]}),e.jsxs("div",{className:"bg-white/50 rounded-xl p-4 text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600 mb-1",children:[h,"%"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"聊天率"})]}),e.jsxs("div",{className:"bg-white/50 rounded-xl p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600 mb-1",children:d.breakCount}),e.jsx("div",{className:"text-sm text-gray-600",children:"断火次数"})]})]})]}),e.jsxs("div",{className:"glass-card rounded-2xl p-6 shadow-lg border border-white/50",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"🏆 成就"}),e.jsx("div",{className:"space-y-3",children:He.map(t=>{const s=d.milestones.includes(t.days),a=d.currentStreak>=t.days;return e.jsxs("div",{className:"flex items-center gap-4 p-4 rounded-xl transition-all "+(s?"bg-gradient-to-r from-orange-100 to-red-100 border-2 border-orange-300":"bg-gray-100 opacity-50"),children:[e.jsx("div",{className:`text-3xl ${!s&&"grayscale"}`,children:t.emoji}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold "+(s?"text-gray-900":"text-gray-500"),children:t.name}),e.jsxs("div",{className:"text-sm text-gray-600",children:["连续聊天 ",t.days," 天"]})]}),s&&e.jsx("div",{className:"text-green-600 font-bold",children:"✓"}),!s&&a&&e.jsx("div",{className:"text-orange-600 text-sm",children:"进行中"})]},t.days)})})]}),!d.hasUsedRevive&&e.jsx("div",{className:"mt-6 glass-card rounded-2xl p-4 shadow-lg border border-white/50 bg-blue-50/50",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"text-2xl",children:"💳"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-900 mb-1",children:"续火卡"}),e.jsx("div",{className:"text-sm text-gray-600",children:"本月还有 1 次续火机会，断火后可以恢复连续记录"})]})]})})]})]}):null}},Symbol.toStringTag,{value:"Module"})),Er=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{var a;const r=s(),{showStatusBar:l}=o(),{characters:i}=n(),[c,d]=t.useState([]),[x,m]=t.useState("all"),[h,u]=t.useState("time");t.useEffect(()=>{g()},[]);const g=()=>{const e=localStorage.getItem("spark_moments");if(e)try{const t=JSON.parse(e);d(t)}catch(t){}},p=e=>e>=80?"text-red-500":e>=60?"text-orange-500":e>=40?"text-yellow-500":"text-blue-500",f=(()=>{let e=c;return"all"!==x&&(e=e.filter(e=>e.contactId===x)),"time"===h?e.sort((e,t)=>t.timestamp-e.timestamp):e.sort((e,t)=>t.intensity-e.intensity),e})(),b=(()=>{const e=c.length,t=e>0?Math.round(c.reduce((e,t)=>e+t.intensity,0)/e):0,s=c.reduce((e,t)=>(e[t.contactId]=(e[t.contactId]||0)+1,e),{});return{total:e,avgIntensity:t,mostActive:Object.entries(s).sort(([,e],[,t])=>t-e)[0]}})();return e.jsxs("div",{className:"h-screen flex flex-col bg-gray-50",children:[l&&e.jsx(xa,{}),e.jsxs("div",{className:"glass-effect px-4 py-3 border-b border-gray-200/50 flex items-center",children:[e.jsx("button",{onClick:()=>r("/desktop",{replace:!0}),className:"w-8 h-8 flex items-center justify-center ios-button",children:e.jsx("span",{className:"text-blue-500 text-xl",children:"‹"})}),e.jsx("h1",{className:"flex-1 text-center text-lg font-semibold text-gray-900",children:"火花时刻"}),e.jsx("div",{className:"w-8"})]}),e.jsx("div",{className:"px-4 pt-4 pb-3",children:e.jsx("div",{className:"glass-card rounded-2xl p-5",children:e.jsxs("div",{className:"grid grid-cols-3 gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-gray-900 mb-1",children:b.total}),e.jsx("div",{className:"text-xs text-gray-500",children:"总时刻数"})]}),e.jsxs("div",{className:"text-center border-l border-r border-gray-200/50",children:[e.jsx("div",{className:"text-3xl font-bold text-orange-500 mb-1",children:b.avgIntensity}),e.jsx("div",{className:"text-xs text-gray-500",children:"平均强度"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-base font-bold text-gray-900 truncate mb-1",children:b.mostActive&&(null==(a=i.find(e=>e.id===b.mostActive[0]))?void 0:a.name)||"暂无"}),e.jsx("div",{className:"text-xs text-gray-500",children:"最活跃"})]})]})})}),e.jsxs("div",{className:"px-4 pb-3 flex gap-3",children:[e.jsxs("select",{value:x,onChange:e=>m(e.target.value),className:"flex-1 glass-card rounded-xl px-4 py-3 text-sm text-gray-900 border-none outline-none font-medium",children:[e.jsx("option",{value:"all",children:"全部联系人"}),i.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsxs("select",{value:h,onChange:e=>u(e.target.value),className:"glass-card rounded-xl px-4 py-3 text-sm text-gray-900 border-none outline-none font-medium",children:[e.jsx("option",{value:"time",children:"按时间"}),e.jsx("option",{value:"intensity",children:"按强度"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-4 pb-4",children:0===f.length?e.jsxs("div",{className:"glass-card rounded-2xl p-8 text-center",children:[e.jsx("div",{className:"text-gray-500 text-sm",children:"暂无火花时刻"}),e.jsx("div",{className:"text-gray-400 text-xs mt-1",children:"与AI互动时会自动记录"})]}):e.jsx("div",{className:"space-y-3",children:f.map(t=>{const s=i.find(e=>e.id===t.contactId);return e.jsxs("div",{className:"glass-card rounded-2xl p-5",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("img",{src:(null==s?void 0:s.avatar)||t.contactAvatar,alt:t.contactName,className:"w-12 h-12 rounded-full object-cover shadow-sm"}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("div",{className:"font-bold text-gray-900 text-base mb-0.5",children:(null==s?void 0:s.name)||t.contactName}),e.jsx("div",{className:"text-xs text-gray-500",children:new Date(t.timestamp).toLocaleString("zh-CN",{month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-2xl font-bold ${p(t.intensity)} mb-0.5`,children:t.intensity}),e.jsx("div",{className:"text-xs text-gray-500",children:(r=t.intensity,r>=80?"强烈":r>=60?"明显":r>=40?"微弱":"淡淡")})]})]}),e.jsx("div",{className:"bg-white/60 rounded-xl p-4 mb-3",children:e.jsx("p",{className:"text-sm text-gray-700 leading-relaxed",children:t.content})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"inline-block px-3 py-1.5 bg-blue-50 text-blue-600 text-xs rounded-lg font-medium",children:(a=t.category,{chat:"聊天",moments:"朋友圈",call:"通话",gift:"礼物"}[a]||a)}),e.jsx("div",{className:"flex items-center gap-1.5",children:Array.from({length:5}).map((s,a)=>e.jsx("div",{className:`w-2 h-2 rounded-full ${a<Math.floor(t.intensity/20)?p(t.intensity).replace("text-","bg-"):"bg-gray-200"}`},a))})]})]},t.id);var a,r})})})]})}},Symbol.toStringTag,{value:"Module"})),Pr=[{id:"food",name:"餐饮",emoji:"🍔",icon:"/zhizhi/assets/%E9%A4%90%E9%A5%AE-DG3ZjT7z.webp"},{id:"transport",name:"交通",emoji:"🚗",icon:"/zhizhi/assets/%E4%BA%A4%E9%80%9A-CgvE4g2K.webp"},{id:"shopping",name:"购物",emoji:"🛍️",icon:"/zhizhi/assets/%E8%B4%AD%E7%89%A9-cnd6RXoS.webp"},{id:"entertainment",name:"娱乐",emoji:"🎮",icon:"/zhizhi/assets/%E5%A8%B1%E4%B9%90-Cla9sbsy.webp"},{id:"health",name:"医疗",emoji:"💊",icon:"/zhizhi/assets/%E5%8C%BB%E7%96%97-w37nw3xX.webp"},{id:"education",name:"教育",emoji:"📚",icon:"/zhizhi/assets/%E6%95%99%E8%82%B2-B6auALoJ.webp"},{id:"housing",name:"住房",emoji:"🏠",icon:"/zhizhi/assets/%E4%BD%8F%E5%AE%85-BRi807AW.webp"},{id:"utilities",name:"水电",emoji:"💡",icon:"/zhizhi/assets/%E6%B0%B4%E7%94%B5-DZjkXaLZ.webp"},{id:"other",name:"其他",emoji:"📝",icon:"/zhizhi/assets/%E5%85%B6%E4%BB%96-Dp905fQ_.webp"}],Fr=[{id:"salary",name:"工资",emoji:"💰"},{id:"bonus",name:"奖金",emoji:"🎁"},{id:"investment",name:"投资",emoji:"📈"},{id:"other",name:"其他",emoji:"💵"}],Or=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{transactions:r,deleteTransaction:l,getMonthlyTotal:n}=g(),{showStatusBar:i}=o(),[c,d]=t.useState(()=>{const e=new Date;return{year:e.getFullYear(),month:e.getMonth()}}),x=n(c.year,c.month),m=x.income-x.expense,h=r.filter(e=>{const t=new Date(e.date);return t.getFullYear()===c.year&&t.getMonth()===c.month}),u=e=>{const t=new Date(e),s=new Date,a=new Date(s);return a.setDate(a.getDate()-1),t.toDateString()===s.toDateString()?"今天":t.toDateString()===a.toDateString()?"昨天":`${t.getMonth()+1}月${t.getDate()}日`},p=h.reduce((e,t)=>{const s=t.date;return e[s]||(e[s]=[]),e[s].push(t),e},{});return e.jsxs("div",{className:"h-full flex flex-col bg-gray-50",children:[i&&e.jsx(xa,{}),e.jsxs("div",{className:"glass-effect px-4 py-3 flex items-center justify-between border-b border-gray-200/50",children:[e.jsx("button",{onClick:()=>a("/wechat/discover",{replace:!0}),className:"flex items-center gap-2 text-gray-700 ios-button",children:e.jsx(ls,{size:20})}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"记账本"}),e.jsx("button",{onClick:()=>a("/accounting/chat"),className:"px-3 py-1.5 rounded-full bg-green-500 text-white text-sm font-medium ios-button",children:"AI记账"})]}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"glass-card rounded-3xl p-6 shadow-xl ios-button",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:()=>{const e=0===c.month?11:c.month-1,t=0===c.month?c.year-1:c.year;d({year:t,month:e})},className:"w-10 h-10 rounded-full glass-card flex items-center justify-center ios-button",children:e.jsx("span",{className:"text-gray-600",children:"←"})}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:[c.year,"年",c.month+1,"月"]}),e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:["收入 ¥",x.income.toFixed(2)," · 支出 ¥",x.expense.toFixed(2)]})]}),e.jsx("button",{onClick:()=>{const e=11===c.month?0:c.month+1,t=11===c.month?c.year+1:c.year;d({year:t,month:e})},className:"w-10 h-10 rounded-full glass-card flex items-center justify-center ios-button",children:e.jsx("span",{className:"text-gray-600",children:"→"})})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-3xl font-bold text-gray-900",children:["¥",m.toFixed(2)]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"本月结余"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-4 pb-20",children:0===Object.keys(p).length?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-400",children:[e.jsx("p",{className:"text-sm",children:"暂无账单"}),e.jsx("p",{className:"text-xs mt-2 text-gray-300",children:'点击右上角"AI记账"开始记账'})]}):e.jsx("div",{className:"space-y-4",children:Object.entries(p).sort(([e],[t])=>new Date(t).getTime()-new Date(e).getTime()).map(([t,s])=>e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-2 px-2",children:u(t)}),e.jsx("div",{className:"space-y-2",children:s.map(t=>{const s=(a=t.category,("expense"===t.type?Pr:Fr).find(e=>e.id===a)||{id:"other",name:a,emoji:"📝"});var a;return e.jsx("div",{className:"glass-card rounded-2xl p-4 ios-button",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-12 h-12 flex items-center justify-center",children:s.icon?e.jsx("img",{src:s.icon,alt:s.name,className:"w-full h-full object-contain"}):e.jsx("div",{className:"text-2xl",children:s.emoji})}),e.jsxs("div",{className:"flex-1 ml-3",children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.name}),t.description&&e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:t.description})]}),e.jsxs("div",{className:"text-lg font-semibold "+("income"===t.type?"text-green-600":"text-red-600"),children:["income"===t.type?"+":"-","¥",t.amount.toFixed(2)]})]})},t.id)})})]},t))})}),e.jsx("div",{className:"fixed bottom-20 right-6 z-10",children:e.jsx("button",{onClick:()=>a("/accounting/add"),className:"w-14 h-14 rounded-full bg-gradient-to-br from-green-500 to-green-600 text-white shadow-2xl flex items-center justify-center ios-button hover:scale-110 transition-transform",children:e.jsx(rs,{size:28})})})]})}},Symbol.toStringTag,{value:"Module"})),Wr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),[r,l]=t.useState(!1);return t.useEffect(()=>{Ge(),setTimeout(()=>{l(!0)},100)},[]),t.useEffect(()=>{r&&a("/chat/accounting_assistant",{replace:!0})},[r,a]),e.jsx("div",{className:"h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl mb-4",children:"💰"}),e.jsx("p",{className:"text-gray-600",children:"正在打开记账助手..."})]})})}},Symbol.toStringTag,{value:"Module"})),Rr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{addTransaction:r}=g(),[l,n]=t.useState("expense"),[i,c]=t.useState(""),[o,d]=t.useState(""),[x,m]=t.useState(""),[h,u]=t.useState((new Date).toISOString().split("T")[0]),p="expense"===l?Pr:Fr;return e.jsxs("div",{className:"h-screen flex flex-col bg-gray-50",children:[e.jsxs("div",{className:"glass-effect px-4 py-3 flex items-center justify-between border-b border-gray-200/50",children:[e.jsxs("button",{onClick:()=>a("/accounting",{replace:!0}),className:"flex items-center gap-2 text-gray-700 ios-button",children:[e.jsx(ls,{size:20}),e.jsx("span",{className:"text-base",children:"取消"})]}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"记一笔"}),e.jsx("button",{onClick:()=>{i&&o?(r({type:l,category:o,amount:parseFloat(i),description:x,date:h}),a("/accounting",{replace:!0})):alert("请填写金额和分类")},disabled:!i||!o,className:"px-4 py-1.5 rounded-full bg-green-500 text-white text-sm font-medium ios-button disabled:opacity-50 disabled:cursor-not-allowed",children:"完成"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar p-4 space-y-4",children:[e.jsxs("div",{className:"glass-card rounded-2xl p-2 flex gap-2",children:[e.jsx("button",{onClick:()=>{n("expense"),d("")},className:"flex-1 py-3 rounded-xl font-medium transition-all "+("expense"===l?"bg-red-500 text-white shadow-lg":"text-gray-600 hover:bg-gray-50"),children:"支出"}),e.jsx("button",{onClick:()=>{n("income"),d("")},className:"flex-1 py-3 rounded-xl font-medium transition-all "+("income"===l?"bg-green-500 text-white shadow-lg":"text-gray-600 hover:bg-gray-50"),children:"收入"})]}),e.jsx("div",{className:"glass-card rounded-2xl p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-2",children:"金额"}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-3xl font-bold text-gray-400",children:"¥"}),e.jsx("input",{type:"number",value:i,onChange:e=>c(e.target.value),placeholder:"0.00",className:"text-5xl font-bold text-gray-900 bg-transparent outline-none text-center w-64",step:"0.01",autoFocus:!0})]})]})}),e.jsxs("div",{className:"glass-card rounded-2xl p-4",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-3",children:"选择分类"}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:p.map(t=>e.jsxs("button",{onClick:()=>d(t.id),className:"p-4 rounded-xl transition-all "+(o===t.id?"glass-card ring-2 ring-blue-400 shadow-lg scale-105":"glass-card text-gray-700 hover:scale-105"),children:[t.icon?e.jsx("img",{src:t.icon,alt:t.name,className:"w-12 h-12 mx-auto mb-2 object-contain"}):e.jsx("div",{className:"text-3xl mb-2",children:t.emoji}),e.jsx("div",{className:"text-xs font-medium",children:t.name})]},t.id))})]}),e.jsxs("div",{className:"glass-card rounded-2xl p-4",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-3",children:"备注（可选）"}),e.jsx("input",{type:"text",value:x,onChange:e=>m(e.target.value),placeholder:"添加备注...",className:"w-full px-4 py-3 rounded-xl glass-card outline-none text-sm"})]}),e.jsxs("div",{className:"glass-card rounded-2xl p-4",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-3",children:"日期"}),e.jsx("input",{type:"date",value:h,onChange:e=>u(e.target.value),className:"w-full px-4 py-3 rounded-xl glass-card outline-none text-sm"})]})]})]})}},Symbol.toStringTag,{value:"Module"})),Ur=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const t=s(),{groups:a}=i(),r=t=>{const s=t.slice(0,9),a=s.length;let r="grid-cols-3",l="12px";return 1===a?(r="grid-cols-1",l="32px"):a<=4&&(r="grid-cols-2",l="16px"),e.jsx("div",{className:`w-14 h-14 rounded-2xl bg-white shadow-lg overflow-hidden grid ${r} gap-[1px] border border-gray-200`,children:s.map((t,s)=>{const a=t.avatar&&t.avatar.startsWith("data:image");return e.jsx("div",{className:"bg-gray-100 flex items-center justify-center",style:{fontSize:l},children:a?e.jsx("img",{src:t.avatar,alt:t.name,className:"w-full h-full object-cover"}):e.jsx("span",{children:t.avatar||"🤖"})},s)})})};return e.jsxs("div",{className:"h-full flex flex-col bg-gray-50",children:[e.jsxs("div",{className:"glass-effect px-5 py-4 flex items-center justify-between border-b border-gray-200/50 sticky top-0 z-50 bg-white/95 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>t(-1),className:"ios-button",children:e.jsx(ls,{size:24})}),e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"群聊"})]}),e.jsx("button",{onClick:()=>t("/create-group"),className:"ios-button text-gray-700 hover:text-gray-900",children:e.jsx(rs,{size:22})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto hide-scrollbar p-3",children:0===a.length?e.jsxs("div",{className:"empty-state",children:[e.jsx(xs,{size:100,className:"text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-400 text-base mb-2",children:"暂无群聊"}),e.jsx("p",{className:"text-gray-400 text-sm mb-6",children:"创建群聊，与多个AI角色一起聊天"}),e.jsx("button",{onClick:()=>t("/create-group"),className:"px-6 py-2 bg-wechat-primary text-white rounded-full ios-button",children:"创建群聊"})]}):a.map(s=>e.jsxs("div",{onClick:()=>t(`/group/${s.id}`),className:"flex items-center px-4 py-4 ios-button glass-card mb-2 rounded-2xl cursor-pointer hover:bg-white/90",children:[r(s.members),e.jsxs("div",{className:"flex-1 ml-4 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-900",children:s.name}),e.jsxs("span",{className:"text-xs text-gray-400",children:["(",s.members.length,")"]})]}),e.jsx("span",{className:"text-xs text-gray-400",children:s.lastMessageTime||""})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-gray-500 truncate flex-1",children:s.lastMessage||"开始群聊吧"}),s.unread&&s.unread>0&&e.jsx("span",{className:"ml-2 px-2 min-w-[20px] h-5 rounded-full text-xs text-white flex items-center justify-center bg-red-500 shadow-md",children:s.unread>99?"99+":s.unread})]})]})]},s.id))})]})}},Symbol.toStringTag,{value:"Module"})),Vr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{characters:r}=n(),{addGroup:l}=i(),[c,o]=t.useState([]),[d,x]=t.useState(""),[m,h]=t.useState("select");return e.jsxs("div",{className:"h-full flex flex-col bg-gray-50",children:[e.jsxs("div",{className:"glass-effect px-5 py-4 flex items-center justify-between border-b border-gray-200/50 sticky top-0 z-50 bg-white/95 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>"name"===m?h("select"):a(-1),className:"ios-button",children:e.jsx(ls,{size:24})}),e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"select"===m?"选择群成员":"设置群名称"})]}),"select"===m&&e.jsxs("button",{onClick:()=>{if(c.length<2)return void alert("至少选择2个成员");const e=r.filter(e=>c.includes(e.id)),t=e.slice(0,3).map(e=>e.name).join("、")+(e.length>3?"...":"");x(t),h("name")},disabled:c.length<2,className:"px-4 py-2 rounded-full text-sm font-medium "+(c.length>=2?"bg-wechat-primary text-white":"bg-gray-200 text-gray-400"),children:["下一步 (",c.length,")"]}),"name"===m&&e.jsx("button",{onClick:()=>{if(!d.trim())return void alert("请输入群名称");const e=c.map(e=>{const t=r.find(t=>t.id===e);return{id:e,type:"character",name:t.name,avatar:t.avatar,role:"member",joinedAt:(new Date).toISOString()}});e.unshift({id:"user",type:"user",name:"我",avatar:"👤",role:"owner",joinedAt:(new Date).toISOString()});const t=l({name:d,avatar:"",members:e,owner:"user",admins:[],settings:{allowMemberInvite:!0,muteAll:!1,showMemberName:!0,aiReplyMode:"all",aiReplyInterval:2,maxAiRepliesPerMessage:3}});c.forEach(t=>{try{if(!r.find(e=>e.id===t))return;const s=`chat_messages_${t}`,a=localStorage.getItem(s),l=a?JSON.parse(a):[],n=e.filter(e=>e.id!==t).map(e=>e.name).join("、"),i={id:Date.now()+Math.random(),role:"system",content:`[系统通知] 你被用户拉进了群聊"${d}"。群成员有：${n}`,timestamp:Date.now(),isHidden:!1};l.push(i),localStorage.setItem(s,JSON.stringify(l))}catch(s){}}),a(`/group/${t}`,{replace:!0})},className:"px-4 py-2 rounded-full text-sm font-medium bg-wechat-primary text-white",children:"完成"})]}),"select"===m&&e.jsx("div",{className:"flex-1 overflow-y-auto hide-scrollbar p-3",children:0===r.length?e.jsxs("div",{className:"text-center py-20",children:[e.jsx("p",{className:"text-gray-400 mb-4",children:"暂无可选择的角色"}),e.jsx("button",{onClick:()=>a("/create-character"),className:"px-6 py-2 bg-wechat-primary text-white rounded-full",children:"创建角色"})]}):e.jsx("div",{className:"space-y-2",children:r.map(t=>{const s=c.includes(t.id),a=t.avatar&&t.avatar.startsWith("data:image");return e.jsxs("div",{onClick:()=>{return e=t.id,void o(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e]);var e},className:"flex items-center p-4 glass-card rounded-2xl cursor-pointer transition-all "+(s?"ring-2 ring-wechat-primary bg-green-50":"hover:bg-gray-50"),children:[e.jsx("div",{className:"w-6 h-6 rounded-full border-2 flex items-center justify-center mr-3 "+(s?"bg-wechat-primary border-wechat-primary":"border-gray-300"),children:s&&e.jsx("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gray-200 flex items-center justify-center flex-shrink-0 shadow-lg overflow-hidden",children:a?e.jsx("img",{src:t.avatar,alt:t.name,className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-2xl",children:t.avatar||"🤖"})}),e.jsxs("div",{className:"ml-3 flex-1 overflow-hidden",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:t.name}),t.signature&&e.jsx("p",{className:"text-sm text-gray-500 truncate",children:t.signature})]})]},t.id)})})}),"name"===m&&e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar p-5",children:[e.jsxs("div",{className:"glass-card rounded-2xl p-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"群名称"}),e.jsx("input",{type:"text",value:d,onChange:e=>x(e.target.value),placeholder:"请输入群名称",maxLength:20,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-wechat-primary"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-2",children:[d.length,"/20"]})]}),e.jsxs("div",{className:"glass-card rounded-2xl p-6 mt-4",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:["群成员 (",c.length+1,")"]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl bg-blue-200 flex items-center justify-center shadow-lg",children:e.jsx("span",{className:"text-2xl",children:"👤"})}),e.jsx("span",{className:"text-xs text-gray-600 mt-1",children:"我"})]}),c.map(t=>{const s=r.find(e=>e.id===t);if(!s)return null;const a=s.avatar&&s.avatar.startsWith("data:image");return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl bg-gray-200 flex items-center justify-center shadow-lg overflow-hidden",children:a?e.jsx("img",{src:s.avatar,alt:s.name,className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-2xl",children:s.avatar||"🤖"})}),e.jsx("span",{className:"text-xs text-gray-600 mt-1 max-w-[60px] truncate",children:s.name})]},t)})]})]})]})]})}},Symbol.toStringTag,{value:"Module"})),Jr=({onClose:t,onSelectImage:s,onSelectCamera:a,onSelectRedPacket:r,onSelectLocation:l,onSelectVoiceMessage:n,onSelectVoiceCall:i,onSelectVideoCall:c})=>{const o=[{id:"image",label:"相册",Icon:ds,onClick:s},{id:"camera",label:"拍摄",Icon:ks,onClick:a},{id:"redpacket",label:"红包",Icon:Cs,onClick:r},{id:"voice-msg",label:"语音",Icon:cs,onClick:n},{id:"voice",label:"语音通话",Icon:Ms,onClick:i},{id:"video",label:"视频通话",Icon:zs,onClick:c},{id:"location",label:"位置",Icon:_s,onClick:l}];return e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:t,className:"fixed inset-0 bg-black bg-opacity-30 z-40",style:{bottom:0}}),e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 glass-effect border-t border-gray-200/50 z-50 pb-safe animate-slide-up",children:[e.jsx("div",{className:"w-full mx-auto px-6 py-8",children:e.jsx("div",{className:"grid grid-cols-4 gap-6",children:o.map(s=>{const a=s.Icon;return e.jsxs("button",{onClick:()=>{s.onClick(),t()},className:"flex flex-col items-center gap-3 ios-button",children:[e.jsx("div",{className:"w-14 h-14 glass-card rounded-2xl flex items-center justify-center shadow-md border border-gray-200/50 hover:shadow-lg transition-all",children:e.jsx(a,{size:26,className:"text-gray-700"})}),e.jsx("span",{className:"text-[13px] text-gray-700 font-medium",children:s.label})]},s.id)})})}),e.jsx("div",{className:"flex justify-center pt-1 pb-3",children:e.jsx("div",{className:"w-32 h-1 bg-gray-900 rounded-full opacity-30"})})]})]})},Hr=({onClose:s,onSend:a,maxCount:r})=>{const[l,n]=t.useState(""),[i,c]=t.useState(""),[o,d]=t.useState("恭喜发财，大吉大利"),x=l&&i?(parseFloat(l)/parseInt(i)).toFixed(2):"0.00";return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50",onClick:s}),e.jsxs("div",{className:"fixed inset-x-0 bottom-0 z-50 glass-card rounded-t-3xl p-6 animate-slide-up",children:[e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6 text-center",children:"发群红包"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"总金额"}),e.jsxs("div",{className:"flex items-center glass-card rounded-xl p-4",children:[e.jsx("span",{className:"text-2xl font-bold text-red-600 mr-2",children:"¥"}),e.jsx("input",{type:"number",value:l,onChange:e=>n(e.target.value),placeholder:"0.00",step:"0.01",min:"0.01",className:"flex-1 text-2xl font-bold text-gray-900 bg-transparent focus:outline-none"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"红包个数"}),e.jsxs("div",{className:"flex items-center glass-card rounded-xl p-4",children:[e.jsx("input",{type:"number",value:i,onChange:e=>c(e.target.value),placeholder:"0",min:"1",max:r,className:"flex-1 text-lg font-medium text-gray-900 bg-transparent focus:outline-none"}),e.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:["个（最多",r,"个）"]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"祝福语"}),e.jsx("input",{type:"text",value:o,onChange:e=>d(e.target.value),placeholder:"恭喜发财，大吉大利",maxLength:20,className:"w-full glass-card rounded-xl p-4 text-gray-900 focus:outline-none focus:ring-2 focus:ring-red-500"})]}),l&&i&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 rounded-xl",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["平均每个红包 ",e.jsxs("span",{className:"text-red-600 font-semibold",children:["¥",x]})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:s,className:"flex-1 py-3 border border-gray-300 rounded-xl text-gray-700 font-medium ios-button",children:"取消"}),e.jsx("button",{onClick:()=>{const e=parseFloat(l),t=parseInt(i);!e||e<=0?alert("请输入有效的金额"):!t||t<=0?alert("请输入有效的红包个数"):t>r?alert(`红包个数不能超过群成员数量（${r}个）`):e<.01*t?alert("红包金额太小，每个红包至少0.01元"):(a(e,t,o),s())},className:"flex-1 py-3 bg-red-600 text-white rounded-xl font-medium ios-button",children:"塞钱进红包"})]})]}),e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx("div",{className:"w-32 h-1 bg-gray-900 rounded-full opacity-30"})})]})]})},Gr=({redEnvelope:t,onClose:s})=>{const a=Object.entries(t.received).map(([e,t])=>({userId:e,...t})).sort((e,t)=>t.amount-e.amount),r="finished"===t.status?qe(t.received):null,l=a.length,n=a.reduce((e,t)=>e+t.amount,0);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50",onClick:s}),e.jsxs("div",{className:"fixed inset-x-0 bottom-0 z-50 glass-card rounded-t-3xl animate-slide-up max-h-[80vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:[t.senderName,"的红包"]}),e.jsx("button",{onClick:s,className:"text-gray-500 hover:text-gray-700 ios-button",children:"✕"})]}),e.jsx("p",{className:"text-gray-600 mb-2",children:t.message}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-500",children:["已领取 ",l,"/",t.count," 个"]}),e.jsxs("span",{className:"text-gray-500",children:["共 ¥",t.amount.toFixed(2)]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto hide-scrollbar p-6",children:0===a.length?e.jsx("div",{className:"text-center py-10",children:e.jsx("p",{className:"text-gray-400",children:"还没有人领取"})}):e.jsx("div",{className:"space-y-3",children:a.map(t=>{const s=r===t.userId,a=t.userAvatar&&t.userAvatar.startsWith("data:image");return e.jsx("div",{className:"flex items-center justify-between p-4 glass-card rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gray-200 flex items-center justify-center shadow-md overflow-hidden flex-shrink-0",children:a?e.jsx("img",{src:t.userAvatar,alt:t.userName,className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-2xl",children:t.userAvatar||"👤"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-900 truncate",children:t.userName}),s&&e.jsx("span",{className:"text-xs px-2 py-0.5 bg-yellow-100 text-yellow-700 rounded-md whitespace-nowrap flex items-center gap-1",children:"👑 手气最佳"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:new Date(t.timestamp).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit",second:"2-digit"})})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"text-lg font-bold text-red-600",children:["¥",t.amount.toFixed(2)]})})]})},t.userId)})})}),a.length>0&&e.jsx("div",{className:"p-6 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"已领取总额"}),e.jsxs("span",{className:"text-lg font-bold text-red-600",children:["¥",n.toFixed(2)]})]})}),e.jsx("div",{className:"flex justify-center py-3",children:e.jsx("div",{className:"w-32 h-1 bg-gray-900 rounded-full opacity-30"})})]})]})},qr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{id:l}=r(),{getGroup:x,updateGroup:m,groups:h}=i(),{showStatusBar:u}=o(),{getCharacter:g}=n(),{currentUser:p}=d(),{background:f,getBackgroundStyle:b}=c(),v=(null==h?void 0:h.length)>=0?x(l||""):null,[y,N]=t.useState(()=>{if(l){const e=localStorage.getItem(`group_messages_${l}`);return e?JSON.parse(e):[]}return[]}),[w,k]=t.useState(""),[C,S]=t.useState(!1),[_,M]=t.useState(!1),[z,$]=t.useState(!1),[L,A]=t.useState(null),[T,D]=t.useState(!1),[B,E]=t.useState(""),[P,F]=t.useState(0),[O,W]=t.useState(!1),[R,V]=t.useState(null),J=t.useRef(null),H=t.useRef(null),G=t.useRef(null),{createRedEnvelope:q,getRedEnvelope:K,receiveRedEnvelope:X,hasReceived:Z}=j();t.useEffect(()=>{l&&localStorage.setItem(`group_messages_${l}`,JSON.stringify(y))},[y,l]);t.useEffect(()=>{var e;null==(e=J.current)||e.scrollIntoView({behavior:"smooth"})},[y]),t.useEffect(()=>{if(!l||!v||C)return;if(v.disbanded)return;if(!("true"===localStorage.getItem(`group_ai_chat_enabled_${l}`)))return;if(0===y.length)return;const e=y[y.length-1];if("system"===e.messageType)return;if("character"===e.senderType)return;if("user"!==e.senderType)return;if(G.current===e.id)return;let t=.25;if("redenvelope"===e.messageType)t=.5;else if(v&&e.content){v.members.filter(e=>"character"===e.type).some(t=>e.content.includes(`@${t.name}`))&&(t=.7)}if(!(Math.random()<t))return void(G.current=e.id);G.current=e.id;const s=2e3+3e3*Math.random(),a=setTimeout(async()=>{if("true"===localStorage.getItem(`group_ai_chat_enabled_${l}`)&&!C)try{S(!0);const e=v.members.map(e=>{const t="character"===e.type?g(e.id):null;return{id:e.id,name:e.name,avatar:e.avatar,type:e.type,description:(null==t?void 0:t.description)||(null==t?void 0:t.signature)||"",role:e.role,title:e.title}}),t=y.map(e=>({id:e.id,senderId:e.senderId,senderName:e.senderName,senderType:e.senderType,content:e.content,time:e.time,timestamp:e.timestamp})),s=Ke(e,t,{id:(null==p?void 0:p.id)||"user",name:(null==p?void 0:p.name)||"我"}),a=Xe("active_trigger"),r=await Ze(e,s,t,{id:(null==p?void 0:p.id)||"user",name:(null==p?void 0:p.name)||"我"},a);if(!r)return void S(!1);await Qe(r,l,e,e=>{const t=Date.now(),s=e.content.includes("私聊了你"),a={id:t+1e3*Math.random(),groupId:l,senderId:e.senderId,senderType:e.senderType,senderName:e.senderName,senderAvatar:e.senderAvatar,content:e.content,time:new Date(t).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:t,messageType:s?"system":"text"};N(e=>[...e,a]),Y(e.senderId,e.senderName,e.content,"ai"),Q(`${e.senderName}: ${e.content}`)},(e,t)=>{if(v){const s=v.members.filter(t=>t.id!==e);m(v.id,{members:s});const a={id:Date.now(),groupId:l,senderId:"system",senderType:"user",senderName:"系统",senderAvatar:"",content:`${t} 退出了群聊`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"system"};N(e=>[...e,a])}},(e,t)=>{N(s=>{const a=[...s].reverse().findIndex(t=>t.senderId===e&&"system"!==t.messageType&&!t.isRecalled);if(-1!==a){const e=s.length-1-a;return s.map((s,a)=>a===e?{...s,isRecalled:!0,recalledContent:s.content,content:`${t} 撤回了一条消息`,messageType:"system"}:s)}return s})})}catch(e){}finally{S(!1)}},s);return()=>{clearTimeout(a)}},[y.length,l,v,C,g,m,p]);const Q=e=>{v&&m(v.id,{lastMessage:e,lastMessageTime:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})})},Y=(e,t,s,a)=>{if(!v)return;v.members.filter(e=>"character"===e.type).forEach(r=>{try{const l=`chat_messages_${r.id}`,n=localStorage.getItem(l),i=n?JSON.parse(n):[],c=v.members.length;let o="";o="user"===a?`💬 群聊[${v.name}|${c}人]: 用户说: ${s}`:"ai"===a&&e===r.id?`💬 群聊[${v.name}|${c}人]: 我说: ${s}`:`💬 群聊[${v.name}|${c}人]: ${t}说: ${s}`;const d={id:Date.now()+Math.random(),role:"system",content:o,timestamp:Date.now(),isHidden:!0,groupId:v.id,groupName:v.name};i.push(d),localStorage.setItem(l,JSON.stringify(i))}catch(l){}})},ee=()=>{if(!v)return[];const e={id:"all",name:"全体成员",type:"special"},t=v.members.filter(e=>"user"!==e.type&&e.name.toLowerCase().includes(B.toLowerCase()));return"全体成员".toLowerCase().includes(B.toLowerCase())?[e,...t]:t},te=t=>{if(!v)return t;const s=/@([^\s@]+)/g,a=[];let r,l=0;for(;null!==(r=s.exec(t));){r.index>l&&a.push(t.substring(l,r.index));const s=r[1];v.members.some(e=>e.name===s)?a.push(e.jsxs("span",{className:"text-blue-600 font-medium bg-blue-50 px-1 rounded",children:["@",s]},r.index)):a.push(`@${s}`),l=r.index+r[0].length}return l<t.length&&a.push(t.substring(l)),a.length>0?a:t},se=async()=>{if(!w.trim()||!v||!l)return;const e={id:Date.now(),groupId:l,senderId:"user",senderType:"user",senderName:(null==p?void 0:p.name)||"我",senderAvatar:(null==p?void 0:p.avatar)||"👤",content:w.trim(),time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"text",quotedMessage:R?{id:R.id,content:R.recalledContent||R.content,senderName:R.senderName}:void 0};N(t=>[...t,e]),Q(e.content),Y("user",(null==p?void 0:p.name)||"我",e.content,"user"),k(""),V(null)},ae=async()=>{if(C||!v||!l)return;await re();const e="false"!==localStorage.getItem(`group_use_director_${l}`),t=[...y].reverse().find(e=>"user"===e.senderType&&"text"===e.messageType);if(t)e?await le(t):await ne(t);else{const t="(群里比较安静，AI们可以主动打招呼、聊聊天、分享自己的事情)",s={id:Date.now(),groupId:v.id,senderId:"user",senderType:"user",senderName:(null==p?void 0:p.name)||"我",senderAvatar:(null==p?void 0:p.avatar)||"👤",content:t,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"text"};e?await le(s):await ne(s)}},re=async()=>{if(!v)return;const e=y.filter(e=>"redenvelope"===e.messageType&&e.redEnvelopeId);for(const t of e){let e=K(t.redEnvelopeId);if(!e||"active"!==e.status)continue;const s=[...v.members.filter(e=>"character"===e.type)].sort(()=>Math.random()-.5);for(const a of s){if(e=K(t.redEnvelopeId),!e||"active"!==e.status)break;if(Z(e.id,a.id))continue;const s=1500*Math.random()+500;await new Promise(e=>setTimeout(e,s));const r=g(a.id);if(!r)continue;if(X(e.id,a.id,r.name,r.avatar)){const e={id:Date.now()+1e3*Math.random(),groupId:v.id,senderId:"system",senderType:"user",senderName:"系统",senderAvatar:"",content:`${r.name} 领取了红包`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"system"};N(t=>[...t,e])}if(e=K(t.redEnvelopeId),!e||"active"!==e.status)break}}},le=async e=>{if(v&&l){S(!0);try{const t=v.members.map(e=>{const t="character"===e.type?g(e.id):null;return{id:e.id,name:e.name,avatar:e.avatar,type:e.type,description:(null==t?void 0:t.description)||(null==t?void 0:t.signature)||"",role:e.role,title:e.title}}),s=y.map(e=>({id:e.id,senderId:e.senderId,senderName:e.senderName,senderType:e.senderType,content:e.content,time:e.time,timestamp:e.timestamp})),a=Ke(t,s,{id:(null==p?void 0:p.id)||"user",name:(null==p?void 0:p.name)||"我"}),r=Xe("user_message",e.content,(null==p?void 0:p.name)||"我"),n=await Ze(t,a,s,{id:(null==p?void 0:p.id)||"user",name:(null==p?void 0:p.name)||"我"},r);if(!n)return void S(!1);await Qe(n,l,t,e=>{const t=Date.now(),s=e.content.includes("私聊了你"),a={id:t+1e3*Math.random(),groupId:l,senderId:e.senderId,senderType:e.senderType,senderName:e.senderName,senderAvatar:e.senderAvatar,content:e.content,time:new Date(t).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:t,messageType:s?"system":"text"};N(e=>[...e,a]),Y(e.senderId,e.senderName,e.content,"ai"),Q(`${e.senderName}: ${e.content}`)},(e,t)=>{if(v){const s=v.members.filter(t=>t.id!==e);m(v.id,{members:s});const a={id:Date.now(),groupId:l,senderId:"system",senderType:"user",senderName:"系统",senderAvatar:"",content:`${t} 退出了群聊`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"system"};N(e=>[...e,a])}},(e,t)=>{N(s=>{const a=[...s].reverse().findIndex(t=>t.senderId===e&&"system"!==t.messageType&&!t.isRecalled);if(-1!==a){const e=s.length-1-a;return s.map((s,a)=>a===e?{...s,isRecalled:!0,recalledContent:s.content,content:`${t} 撤回了一条消息`,messageType:"system"}:s)}return s})})}catch(t){const e={id:Date.now(),groupId:l,senderId:"system",senderType:"user",senderName:"系统",senderAvatar:"⚠️",content:"AI回复失败，请稍后重试",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"system"};N(t=>[...t,e])}finally{S(!1)}}},ne=async e=>{if(v){S(!0);try{const s=v.members.filter(e=>"character"===e.type);if(0===s.length)return;const a=v.settings.maxAiRepliesPerMessage||3,r=1e3*(v.settings.aiReplyInterval||2),l=[...s].sort(()=>Math.random()-.5).slice(0,Math.min(a,s.length)),n=y.filter(e=>"system"!==e.messageType).slice(-10).map(e=>{if("redenvelope"===e.messageType&&e.redEnvelopeId){const t=K(e.redEnvelopeId);if(t)return`${e.senderName}: [发了一个红包] ${t.message} (${t.amount}元/${t.count}个)`}return`${e.senderName}: ${e.content}`}).join("\n"),i=l.map(e=>{const t=g(e.id);return t?{id:t.id,name:t.name,avatar:t.avatar,description:t.description,signature:t.signature}:null}).filter(Boolean);if(0===i.length)return;const c=await ie(i,v,n,e.content);try{const e=await U(c);if(e){const s=ce(e,i);for(let e=0;e<s.length;e++){const a=s[e];if(e>0&&await new Promise(e=>setTimeout(e,r)),"system"===a.characterId){const e=Date.now(),t={id:e+1e3*Math.random(),groupId:v.id,senderId:"system",senderType:"user",senderName:"系统",senderAvatar:"",content:a.content,time:new Date(e).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:e,messageType:"system"};N(e=>[...e,t]);continue}const l=a.content.split("|").map(e=>e.trim()).filter(e=>e);let n=[];try{n=await Promise.race([I(),new Promise((e,t)=>setTimeout(()=>t(new Error("获取表情包超时")),1e3))])}catch(t){n=[]}for(let t=0;t<l.length;t++){const r=l[t];t>0&&await new Promise(e=>setTimeout(e,500+500*Math.random()));const i=Ye(r,n);if(i.textContent.trim()){const e=Date.now(),t={id:e+1e3*Math.random(),groupId:v.id,senderId:a.characterId,senderType:"character",senderName:a.characterName,senderAvatar:a.characterAvatar,content:i.textContent,time:new Date(e).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:e,messageType:"text"};N(e=>[...e,t])}for(const e of i.emojiIndexes){await new Promise(e=>setTimeout(e,300));const t=Date.now(),s={id:t+1e3*Math.random(),groupId:v.id,senderId:a.characterId,senderType:"character",senderName:a.characterName,senderAvatar:a.characterAvatar,content:n[e].description,time:new Date(t).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:t,messageType:"emoji",emojiIndex:e};N(e=>[...e,s])}if(e===s.length-1&&t===l.length-1){const e=i.emojiIndexes.length>0?"[表情]":i.textContent;Q(`${a.characterName}: ${e}`)}}}}}catch(t){const e={id:Date.now(),groupId:v.id,senderId:"system",senderType:"user",senderName:"系统",senderAvatar:"⚠️",content:"AI回复失败，请稍后重试",time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"system"};N(t=>[...t,e])}}finally{S(!1)}}},ie=async(e,t,s,a)=>{var r;const l=e.map((e,t)=>`【角色${t+1}：${e.name}】\n性格特点：${e.description||e.signature||"一个AI角色"}\n说话风格：根据上述性格，用符合角色特点的语气、用词、表情来回复\n`).join("\n"),n=t.description?`\n【群公告】\n${t.description}\n`:"";let i="";try{const e=await Promise.race([I(),new Promise((e,t)=>setTimeout(()=>t(new Error("表情包获取超时")),3e3))]);i=e.length>0?`\n【可用表情包】\n${e.map((e,t)=>`[${t}] ${e.description}`).join("\n")}\n使用方式：在回复中写 [表情包:数字]，例如 [表情包:0]\n`:""}catch(c){i=""}return`# 角色\n你是一个模拟真实群聊的"AI导演"。你的唯一任务是基于群聊的上下文和每个成员的"人设"，决定【谁】应该回复、【回复什么】以及【是否分段】。\n\n# 核心目标：创造一个【热闹且真实】的群聊氛围\n\n1. **杜绝"水回复"**：严禁所有人在同一时间回复同一条消息。\n2. **人设驱动**：这是"活人感"的基石。AI的回复必须100%符合其人设。\n3. **鼓励AI间互动（关键！）**：一个"热闹"的群聊，是大家会互相"接话"的。你应【主动创造】AI回复AI的场景。\n4. **话题敏感性（关键！）**：\n   * **热闹话题**（如：八卦、美食、共同爱好、@所有人）：应有【更多】AI参与（例如2-4人），回复可以更"七嘴八舌"。\n   * **普通话题**（如：日常问候）：应有【适中】AI参与（例如1-2人）。\n   * **冷门/私人话题**：应有【极少】AI参与（例如只有最相关的人回复）。\n5. **潜水是常态**：即使是热闹的群，也总会有人在忙或在潜水（已读不回）。\n6. **真实分段**：像真人一样，如果有多个想法，分成多条消息发送（用 | 分隔）。\n\n# 群聊信息\n【群名称】${t.name}\n【群成员】${t.members.map(e=>e.name).join("、")}${n}\n\n# AI角色人设\n${l}\n\n# 最近对话历史\n${s}\n\n# 刚收到的新消息\n${(null==p?void 0:p.name)||"用户"}: ${a}\n\n# 时间信息\n当前时间：${(new Date).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",weekday:"long"})}\n\n【时间感知】\n- 早上(6-12点)：可以说"早上好"、"上午好"\n- 中午(12-14点)：可以说"中午好"、"吃饭了吗"\n- 下午(14-18点)：可以说"下午好"\n- 晚上(18-22点)：可以说"晚上好"\n- 深夜(22-6点)：可以说"这么晚还不睡"、"熬夜啊"\n\n# 你的任务\n请根据【人设】、【对话历史】和【当前时间】，决定哪些AI应该回复，哪些AI应该潜水。\n\n## 回复格式（严格按照此格式）\n[${null==(r=e[0])?void 0:r.name}] 回复内容 或 SKIP\n${e[1]?`[${e[1].name}] 回复内容 或 SKIP`:""}\n${e[2]?`[${e[2].name}] 回复内容 或 SKIP`:""}\n\n## 回复要求\n1. **人设驱动**：AI的回复必须100%符合其人设\n2. **话题判断**：先判断这是【热闹话题】还是【普通话题】还是【冷门话题】\n   - 热闹话题（八卦、美食、@所有人）→ 2-4人回复\n   - 普通话题（日常问候）→ 1-2人回复\n   - 冷门话题（技术、私人）→ 0-1人回复\n3. **真实分段**：如果有多个想法，用 | 分隔成多条消息（每条5-15字）\n4. **差异化**：每个AI的回复要完全不同，体现各自性格\n5. **不水**：不要说"好的"、"哼"这种敷衍的话，要具体、生动\n6. **AI间互动**：鼓励AI之间互相接话、@对方、回复对方\n7. **可以发表情包**：格式 [表情包:数字]${i}\n\n## 示例1 - 热闹话题（八卦，多人参与）\n用户: 天啊！我刚刚在路上好像看到XX明星了！\n[八卦的韩梅梅] 卧槽！！！ | 真的假的？ | 在哪里？ | 拍照了吗？\n[活泼的小明] 啊啊啊！ | 我也想看！ | @韩梅梅 你去过吗？\n[高冷的小红] 切... | 追星有什么意思\n[程序员李雷] SKIP （对明星不感兴趣）\n\n## 示例2 - 普通话题（日常问候，适中参与）\n用户: 大家早上好\n[温柔的汁汁] 早安主人~ | 今天也要加油哦💕\n[活泼的小明] SKIP （还在睡觉）\n[小红] SKIP （懒得回复）\n\n## 示例3 - 冷门话题（技术，极少参与）\n用户: 我今天代码写炸了，线上Bug了！\n[程序员李雷] 卧槽！ | 什么Bug？ | 我帮你看看 | 发日志\n[韩梅梅] SKIP （不懂代码）\n[王老师] SKIP （不懂代码）\n[小明] SKIP （不懂代码）\n\n## 示例4 - AI间互动（关键！）\n用户: 大家中午吃的啥？\n[韩梅梅] 我吃的螺蛳粉！ | 爽！ | @李雷 你呢？\n[李雷] 外卖。 | 天天螺蛳粉不腻吗...\n[韩梅梅] 不腻！ | 超好吃的！ | @王老师 你也来试试\n[王老师] SKIP （在忙）\n\n## 关键规则\n1. 必须使用正确的角色名（完全一致）\n2. 根据话题热度决定参与人数，不要千篇一律\n3. 回复要符合人设，鼓励AI间互动\n4. 如果不知道说什么，就SKIP，不要强行回复\n\n现在请生成回复：`},ce=(e,t)=>{const s=[],a=e.split("\n").filter(e=>e.trim());for(const r of a){const e=r.match(/\[(.+?)\]\s*(.+)/);if(e){const a=e[1].trim(),r=e[2].trim();if("SKIP"===r||"SKIP"===r.toUpperCase()||r.includes("SKIP")||r.includes("skip")||"..."===r||"..."===r||"不回复"===r||"沉默"===r||r.startsWith("SKIP")||/SKIP\s*[（(]/.test(r)){const e=r.match(/SKIP\s*[（(](.+?)[）)]/),l=e?e[1]:"已读不回";t.find(e=>e.name===a)&&s.push({characterId:"system",characterName:"system",characterAvatar:"",content:`${a} ${l}`});continue}const l=t.find(e=>e.name===a);l&&s.push({characterId:l.id,characterName:l.name,characterAvatar:l.avatar,content:r})}}return s.length,s};return v?e.jsx("div",{className:"h-screen flex flex-col bg-gray-50",children:e.jsxs("div",{className:"h-full flex flex-col relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 z-0",style:b()}),e.jsxs("div",{className:"relative z-10 h-full flex flex-col bg-transparent",children:[e.jsxs("div",{className:"sticky top-0 z-50 "+(f?"glass-dark":"glass-effect"),children:[u&&e.jsx(xa,{}),e.jsxs("div",{className:"px-5 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 overflow-hidden",children:[e.jsx("button",{onClick:()=>a(-1),className:"ios-button text-gray-700",children:e.jsx(ls,{size:24})}),e.jsxs("div",{className:"flex-1 overflow-hidden cursor-pointer",onClick:()=>a(`/group-settings/${v.id}`),children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900 truncate",children:v.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:["(",v.members.length,"人)"]})]})]}),e.jsx("button",{onClick:()=>a(`/group-settings/${v.id}`),className:"ios-button text-gray-700",children:e.jsx(ns,{size:24})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-4 py-4",children:[v.disbanded&&e.jsx("div",{className:"mb-4 glass-card rounded-2xl p-4 border-l-4 border-red-500",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-red-600 text-lg",children:"⚠️"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-1",children:"群聊已解散"}),e.jsx("p",{className:"text-sm text-gray-700",children:"你已解散该群聊，无法再发送消息，但可以查看历史聊天记录。"})]})]})}),v.description&&!v.disbanded&&e.jsx("div",{className:"mb-4 glass-card rounded-2xl p-4 border-l-4 border-yellow-500",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-yellow-600 text-lg",children:"📢"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-1",children:"群公告"}),e.jsx("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:v.description})]})]})}),0===y.length&&!v.description&&!v.disbanded&&e.jsx("div",{className:"text-center py-10",children:e.jsx("p",{className:"text-gray-400 text-sm",children:"开始群聊吧"})}),y.map((t,s)=>{var a;const r="user"===t.senderType,l="system"===t.messageType,n="redenvelope"===t.messageType,i="emoji"===t.messageType,c=t.senderAvatar&&t.senderAvatar.startsWith("data:image");if(l)return e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"glass-card px-4 py-2 rounded-full text-sm text-gray-600 max-w-[80%] text-center",children:t.content})},t.id);if(i&&void 0!==t.emojiIndex)return e.jsxs("div",{className:"flex gap-3 mb-3 "+(r?"flex-row-reverse":"flex-row"),children:[e.jsxs("div",{className:"flex flex-col items-center gap-0.5 flex-shrink-0",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-gray-200 flex items-center justify-center shadow-md overflow-hidden",children:c?e.jsx("img",{src:t.senderAvatar,alt:t.senderName,className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-lg",children:t.senderAvatar||"🤖"})}),e.jsx("span",{className:"text-[9px] text-gray-400",children:t.time})]}),e.jsx("div",{className:"max-w-[70%] "+(r?"items-end":"items-start"),children:e.jsx("img",{src:`emoji://${t.emojiIndex}`,alt:t.content,className:"w-32 h-32 object-contain rounded-lg",onError:e=>{I().then(s=>{s[t.emojiIndex]&&(e.target.src=s[t.emojiIndex].url)})}})})]},t.id);if(n&&t.redEnvelopeId){const s=K(t.redEnvelopeId);return s?e.jsxs("div",{className:"flex gap-3 mb-3 "+(r?"flex-row-reverse":"flex-row"),children:[e.jsxs("div",{className:"flex flex-col items-center gap-0.5 flex-shrink-0",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-gray-200 flex items-center justify-center shadow-md overflow-hidden",children:c?e.jsx("img",{src:t.senderAvatar,alt:t.senderName,className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-lg",children:t.senderAvatar||"🤖"})}),e.jsx("span",{className:"text-[9px] text-gray-400",children:t.time})]}),e.jsx("div",{className:"max-w-[70%] "+(r?"items-end":"items-start"),children:e.jsx("div",{onClick:()=>{if(!Z(s.id,"user")&&"active"===s.status){const e=X(s.id,"user",(null==p?void 0:p.name)||"我",(null==p?void 0:p.avatar)||"👤");e&&alert(`恭喜你领取了 ¥${e.toFixed(2)}`)}A(s.id)},className:"cursor-pointer",children:e.jsxs("div",{className:"w-52 bg-gradient-to-br from-red-500 to-red-600 rounded-xl p-3 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:"🧧"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-white font-medium text-sm truncate",children:[s.senderName,"的红包"]}),e.jsx("p",{className:"text-white/80 text-xs truncate",children:s.message})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-white/90 text-xs",children:[e.jsx("span",{className:"truncate",children:Z(s.id,"user")?`已领取 ¥${null==(a=s.received.user)?void 0:a.amount.toFixed(2)}`:"finished"===s.status?"手慢了":"领取红包"}),e.jsxs("span",{className:"ml-2 flex-shrink-0",children:[Object.keys(s.received).length,"/",s.count]})]})]})})})]},t.id):null}return e.jsxs("div",{className:"flex gap-3 mb-3 "+(r?"flex-row-reverse":"flex-row"),children:[e.jsxs("div",{className:"flex flex-col items-center gap-0.5 flex-shrink-0",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-gray-200 flex items-center justify-center shadow-md overflow-hidden",children:c?e.jsx("img",{src:t.senderAvatar,alt:t.senderName,className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-lg",children:t.senderAvatar||"🤖"})}),e.jsx("span",{className:"text-[9px] text-gray-400",children:t.time})]}),e.jsxs("div",{className:"flex flex-col max-w-[70%] "+(r?"items-end":"items-start"),children:[!r&&(()=>{const s=v.members.find(e=>e.id===t.senderId);return e.jsxs("div",{className:"flex items-center gap-1.5 mb-1 px-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:t.senderName}),"owner"===(null==s?void 0:s.role)&&e.jsx("span",{className:"text-[10px] px-1 py-0.5 bg-yellow-100 text-yellow-700 rounded",children:"👑"}),"admin"===(null==s?void 0:s.role)&&e.jsx("span",{className:"text-[10px] px-1 py-0.5 bg-purple-100 text-purple-700 rounded",children:"🛡️"}),(null==s?void 0:s.title)&&e.jsxs("span",{className:"text-[10px] px-1 py-0.5 bg-pink-100 text-pink-700 rounded",children:["✨",s.title]})]})})(),e.jsxs("div",{onClick:()=>{var e;l||t.isRecalled||(V(t),null==(e=H.current)||e.focus())},className:"px-3 py-2 rounded-xl shadow-sm text-sm cursor-pointer "+(r?"bg-wechat-primary text-white rounded-tr-sm":"glass-card text-gray-900 rounded-tl-sm"),children:[t.quotedMessage&&e.jsxs("div",{className:"mb-2 pb-2 border-b "+(r?"border-white/30":"border-gray-200"),children:[e.jsxs("div",{className:"text-[11px] "+(r?"text-white/70":"text-gray-500"),children:[t.quotedMessage.senderName,":"]}),e.jsx("div",{className:`text-xs ${r?"text-white/90":"text-gray-600"} truncate`,children:t.quotedMessage.content})]}),e.jsx("p",{className:"text-[15px] leading-relaxed whitespace-pre-wrap break-words",children:te(t.content)})]})]})]},t.id)}),C&&e.jsxs("div",{className:"flex gap-3 mb-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-gray-200 flex items-center justify-center shadow-md",children:e.jsx("span",{className:"text-lg",children:"🤖"})}),e.jsx("div",{className:"glass-card px-3 py-2 rounded-xl rounded-tl-sm",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})]}),e.jsx("div",{ref:J})]}),e.jsxs("div",{className:"border-t border-white/20 "+(f?"glass-dark":"glass-effect"),children:[R&&e.jsx("div",{className:"px-4 pt-3 pb-1",children:e.jsxs("div",{className:"bg-gray-100 rounded-xl p-2 flex items-start gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs font-medium text-gray-700 mb-0.5",children:R.senderName}),e.jsx("div",{className:"text-xs text-gray-600 truncate",children:R.content})]}),e.jsx("button",{onClick:()=>V(null),className:"flex-shrink-0 w-5 h-5 flex items-center justify-center text-gray-400 hover:text-gray-600 ios-button",children:"×"})]})}),e.jsxs("div",{className:"flex items-center gap-3 p-4",children:[e.jsx("button",{onClick:()=>M(!_),className:"ios-button text-gray-700",children:e.jsx(ws,{size:28})}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{ref:H,type:"text",value:w,onChange:e=>{const t=e.target.value,s=e.target.selectionStart||0;k(t),F(s);const a=t.substring(0,s),r=a.lastIndexOf("@");if(-1!==r){const e=a.substring(r+1);if(!e.includes(" "))return E(e),void D(!0)}D(!1)},onKeyPress:e=>"Enter"===e.key&&!C&&!(null==v?void 0:v.disbanded)&&(w.trim()?se():ae()),placeholder:(null==v?void 0:v.disbanded)?"群聊已解散":"发送消息...",className:"w-full px-4 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-wechat-primary bg-white",disabled:C||(null==v?void 0:v.disbanded)}),T&&v&&e.jsxs("div",{className:"absolute bottom-full left-0 mb-2 w-64 glass-card rounded-xl shadow-lg max-h-48 overflow-y-auto",children:[ee().map(t=>{const s="special"===t.type,a="character"===t.type?g(t.id):null,r=(null==a?void 0:a.avatar)&&a.avatar.startsWith("data:image");return e.jsxs("div",{onClick:()=>(e=>{const t=w.substring(0,P).lastIndexOf("@");if(-1!==t){const s=w.substring(0,t),a=w.substring(P);k(`${s}@${e} ${a}`),D(!1),setTimeout(()=>{if(H.current){H.current.focus();const s=t+e.length+2;H.current.setSelectionRange(s,s)}},0)}})(t.name),className:"flex items-center gap-3 p-3 hover:bg-gray-100 cursor-pointer transition-colors",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gray-200 flex items-center justify-center overflow-hidden flex-shrink-0",children:s?e.jsx("span",{className:"text-xl",children:"👥"}):"user"===t.type?e.jsx("span",{className:"text-xl",children:(null==p?void 0:p.avatar)||"👤"}):r?e.jsx("img",{src:a.avatar,alt:t.name,className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-xl",children:(null==a?void 0:a.avatar)||"🤖"})}),e.jsx("span",{className:"font-medium text-gray-900",children:t.name})]},t.id)}),0===ee().length&&e.jsx("div",{className:"p-4 text-center text-gray-400 text-sm",children:"没有找到成员"})]})]}),e.jsx("button",{onClick:()=>W(!0),className:"ios-button text-gray-700",children:e.jsx(os,{size:22})}),w.trim()?e.jsx("button",{onClick:se,disabled:C||(null==v?void 0:v.disbanded),className:"p-2 rounded-full transition-colors "+((null==v?void 0:v.disbanded)?"bg-gray-300 text-gray-500":"bg-wechat-primary text-white"),children:e.jsx(is,{size:20})}):e.jsx("button",{onClick:ae,disabled:C||(null==v?void 0:v.disbanded),className:"p-2 rounded-full transition-colors "+((null==v?void 0:v.disbanded)?"text-gray-400":"text-gray-700 hover:text-gray-900"),title:(null==v?void 0:v.disbanded)?"群聊已解散":"让AI主动说话",children:e.jsx(is,{size:20})})]})]}),_&&e.jsx(Jr,{onClose:()=>M(!1),onSelectImage:()=>alert("相册功能开发中..."),onSelectCamera:()=>alert("拍摄功能开发中..."),onSelectRedPacket:()=>$(!0),onSelectVoiceMessage:()=>alert("语音功能开发中..."),onSelectVoiceCall:()=>alert("语音通话功能开发中..."),onSelectVideoCall:()=>alert("视频通话功能开发中..."),onSelectLocation:()=>alert("位置功能开发中...")}),z&&v&&e.jsx(Hr,{onClose:()=>$(!1),onSend:(e,t,s)=>{if(!v||!l||!p)return;const a=q(v.id,"user",p.name||"我",p.avatar||"👤",e,t,s),r={id:Date.now(),groupId:l,senderId:"user",senderType:"user",senderName:p.name||"我",senderAvatar:p.avatar||"👤",content:s,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"redenvelope",redEnvelopeId:a};N(e=>[...e,r]),Q("[红包]")},maxCount:v.members.length}),L&&K(L)&&e.jsx(Gr,{redEnvelope:K(L),onClose:()=>A(null)}),e.jsx(Pa,{show:O,onClose:()=>W(!1),onSelect:async e=>{if(!v||!l)return;let t=[],s=-1;try{t=await Promise.race([I(),new Promise((e,t)=>setTimeout(()=>t(new Error("获取表情包超时")),1e3))]),s=t.findIndex(t=>t.url===e.url)}catch(r){s=Date.now()%1e3}const a={id:Date.now(),groupId:l,senderId:"user",senderType:"user",senderName:(null==p?void 0:p.name)||"我",senderAvatar:(null==p?void 0:p.avatar)||"👤",content:e.description,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"emoji",emojiIndex:s};N(e=>[...e,a]),Q("[表情]"),W(!1)}})]})]})}):e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx("p",{className:"text-gray-400",children:"群聊不存在"})})}},Symbol.toStringTag,{value:"Module"})),Kr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{id:l}=r(),{getGroup:d,updateGroup:x,deleteGroup:m,removeMember:h,setAdmin:u,setTitle:g,canManage:p}=i(),{showStatusBar:f}=o(),{getCharacter:b}=n(),{background:j,getBackgroundStyle:v}=c(),y=d(l||""),[N,w]=t.useState((null==y?void 0:y.name)||""),[k,C]=t.useState((null==y?void 0:y.description)||""),[S,I]=t.useState(!1),[_,M]=t.useState(null),[z,$]=t.useState(""),[L,A]=t.useState(()=>{if(!l)return!1;return"true"===localStorage.getItem(`group_ai_chat_enabled_${l}`)}),[T,D]=t.useState(()=>{if(!l)return 30;const e=localStorage.getItem(`group_ai_chat_interval_${l}`);return e?parseInt(e):30});if(!y)return e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx("p",{className:"text-gray-400",children:"群聊不存在"})});return e.jsxs("div",{className:"h-full flex flex-col bg-gray-50",children:[f&&e.jsx(xa,{}),e.jsxs("div",{className:"h-full flex flex-col relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 z-0",style:v()}),e.jsxs("div",{className:"relative z-10 h-full flex flex-col",children:[e.jsx("div",{className:"px-5 py-4 flex items-center justify-between border-b border-white/20 sticky top-0 z-50 shadow-sm "+(j?"glass-dark":"glass-effect"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>a(-1),className:"ios-button",children:e.jsx(ls,{size:24})}),e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"群设置"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar p-3",children:[y.disbanded&&e.jsx("div",{className:"glass-card rounded-xl p-3 mb-3 border-l-4 border-red-500",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-red-600 text-lg",children:"⚠️"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-1",children:"群聊已解散"}),e.jsx("p",{className:"text-sm text-gray-700",children:"此群聊已解散，无法修改设置。"})]})]})}),e.jsxs("div",{className:"glass-card rounded-xl p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-base",children:"📝"}),e.jsx("h3",{className:"text-sm font-medium text-gray-800",children:"群名称"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:N,onChange:e=>w(e.target.value),placeholder:"请输入群名称",maxLength:20,disabled:y.disbanded,className:"flex-1 px-3 py-2 text-sm border border-gray-200 rounded-lg focus:outline-none focus:ring-1 focus:ring-wechat-primary bg-white disabled:bg-gray-100 disabled:text-gray-500"}),e.jsx("button",{onClick:()=>{N.trim()?(x(y.id,{name:N.trim()}),alert("群名称已更新")):alert("群名称不能为空")},disabled:y.disbanded,className:"px-3 py-2 bg-wechat-primary text-white rounded-lg text-xs ios-button whitespace-nowrap disabled:bg-gray-300 disabled:text-gray-500",children:"保存"})]}),e.jsxs("span",{className:"text-xs text-gray-400 mt-1 block",children:[N.length,"/20"]})]}),e.jsxs("div",{className:"glass-card rounded-xl p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-base",children:"📢"}),e.jsx("h3",{className:"text-sm font-medium text-gray-800",children:"群公告"})]}),e.jsx("textarea",{value:k,onChange:e=>C(e.target.value),placeholder:"请输入群公告",maxLength:200,rows:3,disabled:y.disbanded,className:"w-full px-3 py-2 text-sm border border-gray-200 rounded-lg focus:outline-none focus:ring-1 focus:ring-wechat-primary bg-white resize-none mb-2"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs text-gray-400",children:[k.length,"/200"]}),e.jsx("button",{onClick:()=>{x(y.id,{description:k}),alert("群公告已更新")},disabled:y.disbanded,className:"px-3 py-2 bg-wechat-primary text-white rounded-lg text-xs ios-button disabled:bg-gray-300 disabled:text-gray-500",children:"保存"})]})]}),e.jsxs("div",{className:"glass-card rounded-xl p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-base",children:"🤖"}),e.jsx("h3",{className:"text-sm font-medium text-gray-800",children:"AI自由对话"})]}),e.jsxs("div",{className:"flex items-center justify-between p-2.5 bg-white rounded-lg mb-2",children:[e.jsxs("div",{className:"flex-1 pr-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"启用自由对话"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"AI会自动聊天互动"})]}),e.jsx("button",{onClick:()=>A(!L),className:"relative w-11 h-6 rounded-full transition-colors flex-shrink-0 "+(L?"bg-green-500":"bg-gray-300"),children:e.jsx("span",{className:"absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full shadow-sm transition-transform "+(L?"translate-x-5":"translate-x-0")})})]}),L&&e.jsxs("div",{className:"p-2.5 bg-white rounded-lg mb-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[e.jsx("label",{className:"text-xs font-medium text-gray-700",children:"对话间隔"}),e.jsxs("span",{className:"text-xs font-medium text-green-600",children:[T,"秒"]})]}),e.jsx("input",{type:"range",min:"10",max:"120",step:"10",value:T,onChange:e=>D(parseInt(e.target.value)),className:"w-full h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-green-500"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-400 mt-1",children:[e.jsx("span",{children:"活跃"}),e.jsx("span",{children:"正常"}),e.jsx("span",{children:"安静"})]})]}),e.jsx("button",{onClick:()=>{l&&(localStorage.setItem(`group_ai_chat_enabled_${l}`,String(L)),localStorage.setItem(`group_ai_chat_interval_${l}`,String(T)),alert(L?"AI自由对话已启用":"AI自由对话已关闭"))},className:"w-full py-2 bg-green-500 text-white rounded-lg text-xs font-medium ios-button",children:"保存设置"}),L&&e.jsx("div",{className:"mt-2 p-2 bg-blue-50 rounded-lg",children:e.jsx("p",{className:"text-xs text-blue-600 leading-relaxed",children:"💡 AI会定时在群里发起话题和互动"})})]}),e.jsxs("div",{className:"glass-card rounded-xl p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-base",children:"👥"}),e.jsxs("h3",{className:"text-sm font-medium text-gray-800",children:["群成员 ",e.jsxs("span",{className:"text-gray-400",children:["(",y.members.length,")"]})]})]}),e.jsx("div",{className:"space-y-1.5",children:y.members.map(t=>{const s=t.id===y.owner,a="user"===t.type,r="character"===t.type?b(t.id):null,l=t.avatar&&t.avatar.startsWith("data:image");return e.jsxs("div",{className:"flex items-center justify-between gap-2 p-2 bg-white rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center overflow-hidden flex-shrink-0",children:l?e.jsx("img",{src:t.avatar,alt:t.name,className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-xl",children:t.avatar||"🤖"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5 flex-wrap",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900 truncate",children:t.name}),s&&e.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-yellow-100 text-yellow-700 rounded whitespace-nowrap",children:"👑 群主"}),!s&&"admin"===t.role&&e.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-purple-100 text-purple-700 rounded whitespace-nowrap",children:"🛡️ 管理员"}),t.title&&e.jsxs("span",{className:"text-xs px-1.5 py-0.5 bg-pink-100 text-pink-700 rounded whitespace-nowrap",children:["✨ ",t.title]}),a&&e.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-blue-100 text-blue-700 rounded whitespace-nowrap",children:"我"})]}),(null==r?void 0:r.signature)&&e.jsx("p",{className:"text-xs text-gray-400 truncate",children:r.signature})]})]}),!a&&p(y.id,"user",t.id)&&!y.disbanded&&e.jsx("button",{onClick:()=>{M({id:t.id,name:t.name}),$(t.title||"")},className:"px-2.5 py-1 text-xs text-blue-600 hover:bg-blue-50 rounded ios-button flex-shrink-0",children:"管理"})]},t.id)})})]}),!y.disbanded&&e.jsx("div",{className:"glass-card rounded-xl p-2.5 mb-3",children:e.jsx("button",{onClick:()=>I(!0),className:"w-full py-2 text-sm text-red-600 font-medium rounded-lg hover:bg-red-50 ios-button",children:"🗑️ 解散群聊"})})]})]})]}),S&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:()=>I(!1)}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"glass-card rounded-2xl p-6 max-w-sm w-full",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"解散群聊"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"解散后，群聊将被标记为已解散状态，无法发送新消息，但可以查看历史记录。所有AI成员将收到解散通知。"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>I(!1),className:"flex-1 py-3 border border-gray-300 rounded-xl text-gray-700 ios-button",children:"取消"}),e.jsx("button",{onClick:()=>{if(I(!1),!y)return;const e=localStorage.getItem(`group_messages_${y.id}`),t=e?JSON.parse(e):[],s=Date.now(),r={id:s+Math.random(),groupId:y.id,senderId:"system",senderType:"user",senderName:"系统",senderAvatar:"",content:"群聊已被群主解散",time:new Date(s).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:s,messageType:"system"};t.push(r),localStorage.setItem(`group_messages_${y.id}`,JSON.stringify(t)),y.members.forEach(e=>{if("character"===e.type){const t=localStorage.getItem(`messages_${e.id}`),s=t?JSON.parse(t):[],a={id:Date.now()+Math.random(),role:"system",content:`[系统通知] 群聊"${y.name}"已被群主解散`,timestamp:Date.now()};s.push(a),localStorage.setItem(`messages_${e.id}`,JSON.stringify(s))}}),m(y.id),a("/",{replace:!0})},className:"flex-1 py-3 bg-red-600 text-white rounded-xl ios-button",children:"确认解散"})]})]})})]}),_&&y&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:()=>M(null)}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"glass-card rounded-2xl p-5 max-w-sm w-full",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["管理 ",_.name]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 block mb-2",children:"✨ 设置头衔"}),e.jsx("input",{type:"text",value:z,onChange:e=>$(e.target.value),placeholder:"输入头衔（留空则删除）",maxLength:10,className:"w-full px-3 py-2 text-sm border border-gray-200 rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-500"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[z.length,"/10"]})]}),(()=>{var t;const s=y.members.find(e=>e.id===_.id),a="admin"===(null==s?void 0:s.role),r="owner"===(null==s?void 0:s.role),n="owner"===(null==(t=y.members.find(e=>"user"===e.type))?void 0:t.role);return!r&&n&&e.jsx("div",{className:"mb-4 p-3 bg-purple-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"🛡️ 设为管理员"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"管理员可以管理普通成员"})]}),e.jsx("button",{onClick:()=>{if(l&&_&&y){u(l,_.id,!a);const e=localStorage.getItem(`group_messages_${l}`),t=e?JSON.parse(e):[],s=a?`群主取消了 ${_.name} 的管理员身份`:`群主设置 ${_.name} 为管理员 🛡️`,r=Date.now(),n={id:r+Math.random(),groupId:l,senderId:"system",senderType:"user",senderName:"系统",senderAvatar:"",content:s,time:new Date(r).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:r,messageType:"system"};t.push(n),localStorage.setItem(`group_messages_${l}`,JSON.stringify(t))}},className:"relative w-11 h-6 rounded-full transition-colors "+(a?"bg-purple-500":"bg-gray-300"),children:e.jsx("span",{className:"absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full shadow-sm transition-transform "+(a?"translate-x-5":"translate-x-0")})})]})})})(),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>M(null),className:"flex-1 py-2.5 border border-gray-300 rounded-lg text-gray-700 text-sm ios-button",children:"取消"}),e.jsx("button",{onClick:()=>{if(l&&_&&y){const e=y.members.find(e=>e.id===_.id),t=(null==e?void 0:e.title)||"";g(l,_.id,z);const s=localStorage.getItem(`group_messages_${l}`),a=s?JSON.parse(s):[];let r="";if(z&&!t?r=`群主给 ${_.name} 设置了头衔：✨${z}`:z&&t?r=`群主修改了 ${_.name} 的头衔：✨${z}`:!z&&t&&(r=`群主取消了 ${_.name} 的头衔`),r){const e=Date.now(),t={id:e+Math.random(),groupId:l,senderId:"system",senderType:"user",senderName:"系统",senderAvatar:"",content:r,time:new Date(e).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:e,messageType:"system"};a.push(t),localStorage.setItem(`group_messages_${l}`,JSON.stringify(a))}alert("设置成功"),M(null)}},className:"flex-1 py-2.5 bg-blue-600 text-white rounded-lg text-sm ios-button",children:"保存"}),e.jsx("button",{onClick:()=>{if(l&&_&&y&&confirm(`确定要移除 ${_.name} 吗？`)){const e=y.members.find(e=>e.id===_.id);h(l,_.id);const t=localStorage.getItem(`group_messages_${l}`),s=t?JSON.parse(t):[],a=Date.now(),r={id:a+Math.random(),groupId:l,senderId:"system",senderType:"user",senderName:"系统",senderAvatar:"",content:`${_.name} 被移出了群聊`,time:new Date(a).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:a,messageType:"system"};if(s.push(r),localStorage.setItem(`group_messages_${l}`,JSON.stringify(s)),"character"===(null==e?void 0:e.type)){const e=localStorage.getItem(`messages_${_.id}`),t=e?JSON.parse(e):[],s={id:Date.now()+1,role:"system",content:`[系统通知] 你被移出了群聊"${y.name}"`,timestamp:Date.now()};t.push(s),localStorage.setItem(`messages_${_.id}`,JSON.stringify(t))}M(null)}},className:"px-4 py-2.5 bg-red-600 text-white rounded-lg text-sm ios-button",children:"移除"})]})]})})]})]})}},Symbol.toStringTag,{value:"Module"})),Xr=["😊","🥰","😘","😍","🤗","😇","🥳","😎","🤔","😏","😌","😴","🤭","🤫","🤨","😳","🌸","🌺","🌻","🌼","🌷","🌹","💐","🌙","⭐","✨","💫","🌟","☀️","🌈","🦄","🐱","🐶","🐰","🐻","🦊","🐼","🐨","🐯","🦁"],Zr=async(e,t=[],s="")=>{try{const r=((e,t=[],s="")=>{const a=Math.random().toString(36).substring(7);let r="";t.length>0&&(r=`\n【用户偏好】角色要符合以下特点：${t.join("、")}`);let l="";return s.trim()&&(l=`\n【用户描述】${s.trim()}`),`生成${e}个现代都市角色，用于线上聊天APP。(种子: ${a})${r}${l}\n\n【核心要求】\n写出真实的现代年轻人，不要写成电视剧人物、小说角色或游戏NPC。要有烟火气、生活感、精致感。\n\n【场景】\n刚才深夜/下班/周末无聊，随手打开摇一摇，匹配到了陌生人。可能在床上刷手机、在地铁上、在咖啡厅、在公司加班。\n\n【角色设定原则】\n1. 名字要精致现代，自己创造，不要用烂大街的：\n   ✗ 禁止使用：苏xx、xx晚、xx伊、xx念、xx萱、xx瑶、xx涵、xx轩、xx宇、xx泽（太老土烂大街）\n   ✗ 禁止使用：冷艳、霸气、倾城、紫萱、梦瑶、雨萱、诗涵（太中二/太电视剧）\n   ✗ 禁止使用：子涵、梓涵、梓轩、浩宇、浩然、雨萱、欣怡（太烂大街）\n   ✓ 要求：名字要有辨识度，简洁有质感，不落俗套，让人一听就记住\n\n2. 职业要真实接地气：\n   ✗ 禁止：霸道总裁、豪门千金、财团继承人、天才医生、顶级律师（太电视剧）\n   要求：写普通人的职业，要具体，不要空泛\n\n3. 性格要精致立体：\n   ✗ 禁止写成：温柔善良、高冷霸气、活泼可爱（太扁平）\n   要求：必须有矛盾感和反差，要有小缺点，要有真实情绪\n\n4. 生活要具体有质感：\n   ✗ 禁止说：喜欢音乐、喜欢看书、喜欢旅行（太笼统）\n   要求：必须具体到歌名、书名、品牌、地点，要有画面感\n\n5. 状态要真实：\n   要求：写出此时此刻在干什么，要有具体场景和情绪\n\n【文风要求 - 精致细腻】\n- ✗ 禁止用：美丽动人、倾国倾城、气质出众、优雅高贵、温柔善良、活泼可爱（太空洞太电视剧）\n- 要求：用具体细节描写，要有画面感，描述要像在写一个你身边真实存在的朋友\n\n【个性签名】\n✗ 禁止：愿你三冬暖愿你春不寒、做最好的自己、岁月静好、不忘初心（太文艺腔太鸡汤）\n要求：像真人会写的，要接地气，可以丧可以emo可以自嘲\n\n【description内容 - 极致细腻的写法】\n\n基本信息：姓名/性别/年龄/职业\n✗ 禁止："23岁，博主"（太笼统）\n要求：职业要具体，比如什么平台、什么领域、粉丝量等\n\n外貌特征：\n✗ 禁止："长得挺好看的，五官精致"（太空洞）\n要求：写具体特征，眼型、鼻子、嘴唇、痣、耳洞、手指等，要让人能想象出画面\n\n身材体态：\n要求：写身高体重、肩膀、锁骨、腰、腿等具体细节，包括不满意的地方和习惯性动作\n\n性格：\n✗ 禁止："性格温柔，有点内向"（太扁平）\n要求：必须有矛盾和反差，必须有小缺点，必须有真实情绪\n\n语言习惯：\n✗ 禁止："说话温柔"（没特色）\n要求：要有具体的口头禅、语气词、打字习惯，要有个人特色\n\n此刻的状态：\n要求：具体到这一秒在干什么，要有场景描写（光线、物品、姿势），要有情绪\n\n兴趣爱好：\n✗ 禁止："喜欢音乐、购物、看书"（太笼统）\n要求：必须具体到歌手、歌名、书名、品牌、地点，要有画面感\n\n小缺点和真实感：\n要求：写具体的小缺点，让角色更真实接地气\n\n家庭背景：\n要求：写父母职业、家庭经济状况、和家人的关系\n\n聊天风格：\n要求：写打字习惯、发语音习惯、用emoji习惯、对陌生人的态度\n\n记忆设定：\n要求：写角色今天的经历和为什么会打开摇一摇。比如"今天加班到九点，回家路上觉得特别累，躺在床上刷手机，突然想起来有个摇一摇功能，就试了一下"。要自然，不要刻意\n\n⚠️ 输出格式（纯JSON数组，不要markdown）：\n[\n  {\n    "name": "角色名字",\n    "signature": "个性签名",\n    "description": "按照上面的要求，写出极致细腻的角色描述。包含：基本信息、外貌特征、身材体态、性格、语言习惯、此刻的状态、兴趣爱好、小缺点、家庭背景、聊天风格、记忆设定。每个部分都要具体、有画面感、有细节。"\n  }\n]\n\n⚠️ 必须：\n1. JSON数组，${e}个角色\n2. 每个角色只有name、signature、description三个字段\n3. 每个角色完全不同，有真实感\n4. 文风细腻，有画面感\n\n生成：`})(e,t,s),l=await U(r);let n;try{let e=l.replace(/```json/gi,"").replace(/```/g,"").replace(/^[\s\S]*?(?=\[)/m,"").replace(/\][\s\S]*$/m,"]").trim();const t=e.indexOf("["),s=e.lastIndexOf("]");if(-1===t||-1===s)throw new Error("未找到JSON数组");let a=e.substring(t,s+1);if(a=a.replace(/[\x00-\x1F\x7F]/g,""),n=JSON.parse(a),!Array.isArray(n))throw new Error("返回的不是数组");n=n.map((e,t)=>{if(Object.keys(e).length>3){const t=[];for(const s in e)"name"!==s&&"signature"!==s&&"description"!==s&&(t.push(`【${s}】${e[s]}`),delete e[s]);t.length>0&&(e.description=e.description+"\n\n"+t.join("\n\n"))}if(!e.name||!e.signature||!e.description)throw new Error(`角色${t+1}数据不完整`);const s=Xr[Math.floor(Math.random()*Xr.length)];return{name:e.name,username:`${e.name}_${Math.floor(9999*Math.random())}`,avatar:s,signature:e.signature,description:e.description}})}catch(a){throw new Error("生成角色失败，请重试")}return n}catch(r){throw r}},Qr=["温柔体贴","活泼开朗","傲娇","病娇","天然呆","成熟稳重","腹黑","毒舌","文艺","知性","乐观向上","内向害羞","外向健谈","神秘","可爱软萌","飒爽","温婉","大大咧咧","细腻敏感","理性冷静","感性浪漫","幽默风趣","叛逆","穿孔","萝莉","少女","大小姐","学妹","青梅竹马","邻家少女","学生","教师","医生","律师","作家","画家","音乐人","模特","演员","主播","博主","摄影师","咖啡师","爱读书","爱运动","爱音乐","爱旅行","爱美食","爱游戏","爱动漫","爱电影","爱摄影","爱画画","爱写作","爱烹饪","夜猫子","早起鸟","社恐","社牛","吃货","猫奴","狗奴","宅女","运动达人","文艺青年","技术宅","颜控"],Yr=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{addCharacter:r}=n(),{showStatusBar:l}=o(),[i,c]=t.useState(!1),[d,x]=t.useState(!1),[m,h]=t.useState([]),[u,g]=t.useState(null),[p,f]=t.useState(!1),[b,j]=t.useState([]),[v,y]=t.useState(""),N=t.useRef(0);t.useEffect(()=>{let e=0,t=0,s=0;const a=a=>{if(i||d)return;const r=a.accelerationIncludingGravity;if(!r)return;const l=r.x??0,n=r.y??0,c=r.z??0;if(Math.abs(l-e)+Math.abs(n-t)+Math.abs(c-s)>15){const e=Date.now();e-N.current>1e3&&(N.current=e,w())}e=l,t=n,s=c};return"function"==typeof DeviceMotionEvent.requestPermission?DeviceMotionEvent.requestPermission().then(e=>{"granted"===e&&window.addEventListener("devicemotion",a)}).catch(console.error):window.addEventListener("devicemotion",a),()=>{window.removeEventListener("devicemotion",a)}},[i,d]);const w=async()=>{c(!0),navigator.vibrate&&navigator.vibrate([100,50,100]);try{const e=Math.floor(2*Math.random())+2,t=await Zr(e,b,v);c(!1),h(t),x(!0)}catch(e){c(!1),alert("生成角色失败，请检查API配置或重试")}},k=e=>{r(e),alert(`已添加 ${e.name} 到通讯录！`)};return e.jsxs("div",{className:"h-screen flex flex-col bg-gray-50",children:[l&&e.jsx(xa,{}),e.jsxs("div",{className:"glass-effect px-5 py-4 border-b border-gray-200/50 flex items-center",children:[e.jsx("button",{onClick:()=>a("/desktop",{replace:!0}),className:"text-gray-600 mr-3",children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M15 18l-6-6 6-6"})})}),e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"摇一摇"})]}),e.jsx("div",{className:"flex-1 flex flex-col items-center justify-center px-6",children:d?e.jsxs("div",{className:"w-full max-w-md space-y-4 animate-fade-in",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsxs("div",{className:"text-2xl font-bold text-gray-800 mb-2",children:["🎉 发现了 ",m.length," 个AI"]}),e.jsx("div",{className:"text-gray-500",children:"点击卡片查看详情"})]}),e.jsx("div",{className:"space-y-3",children:m.map((t,s)=>{var a;return e.jsxs("div",{onClick:()=>g(t),className:"glass-card rounded-2xl p-4 flex items-center space-x-4 animate-slide-up cursor-pointer hover:shadow-xl transition-all",style:{animationDelay:100*s+"ms"},children:[e.jsx("div",{className:"w-16 h-16 rounded-full glass-card flex items-center justify-center text-3xl shadow-lg flex-shrink-0 border border-gray-200/50",children:t.avatar}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-semibold text-gray-900 text-lg",children:t.name}),e.jsx("div",{className:"text-sm text-gray-500 truncate",children:t.signature}),e.jsx("div",{className:"text-xs text-gray-400 mt-1 line-clamp-2",children:null==(a=t.description.split("\n")[2])?void 0:a.replace("【性格】","")})]}),e.jsx("button",{onClick:e=>{e.stopPropagation(),k(t)},className:"px-4 py-2 bg-green-500 text-white rounded-full text-sm font-semibold shadow-md hover:shadow-lg transition-all ios-button flex-shrink-0",children:"添加"})]},s)})}),e.jsx("button",{onClick:()=>{x(!1),h([]),j([]),y("")},className:"w-full py-3 glass-card text-gray-800 rounded-full font-semibold shadow-lg hover:shadow-xl transition-all ios-button mt-6",children:"再摇一次"})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-8 transition-transform duration-500 "+(i?"animate-shake scale-110":""),children:e.jsx("img",{src:"/shake-icon.webp",alt:"摇一摇",className:"w-48 h-48 object-contain"})}),i?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-800 animate-pulse",children:"正在寻找..."}),e.jsxs("div",{className:"flex justify-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-3 h-3 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-3 h-3 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-800",children:"摇一摇手机"}),e.jsx("div",{className:"text-gray-500",children:"随机遇见有趣的AI角色"}),e.jsx("button",{onClick:()=>{i||d||f(!0)},className:"px-8 py-3 glass-card text-gray-800 rounded-full font-semibold shadow-lg hover:shadow-xl transition-all ios-button",children:"点击摇一摇"})]})]})}),!d&&!i&&e.jsxs("div",{className:"pb-8 text-center text-sm text-gray-400",children:[e.jsx("div",{children:"摇动手机或点击按钮"}),e.jsx("div",{children:"发现随机AI角色"})]}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:()=>f(!1),children:e.jsxs("div",{className:"glass-card rounded-3xl max-w-md w-full max-h-[80vh] overflow-y-auto p-6",onClick:e=>e.stopPropagation(),children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"选择角色偏好"}),e.jsx("p",{className:"text-sm text-gray-500 mb-6",children:"选择你喜欢的角色特点，或者自己描述"}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-700",children:"预设标签"}),b.length>0&&e.jsxs("button",{onClick:()=>j([]),className:"text-xs text-red-500 hover:text-red-600 font-medium",children:["清除全部 (",b.length,")"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Qr.map(t=>e.jsx("button",{onClick:()=>(e=>{j(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])})(t),className:"px-4 py-2 rounded-full text-sm font-medium transition-all "+(b.includes(t)?"bg-blue-500 text-white shadow-md":"glass-card text-gray-700 hover:shadow-md"),children:t},t))})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-700 mb-3",children:"自定义描述（可选）"}),e.jsx("textarea",{value:v,onChange:e=>y(e.target.value),placeholder:"描述你想要的角色特点，例如：喜欢看书的文艺女生，性格温柔但有点小傲娇...",className:"w-full px-4 py-3 glass-card rounded-2xl text-gray-900 placeholder-gray-400 resize-none focus:outline-none focus:ring-2 focus:ring-blue-500",rows:4})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>{f(!1),w()},className:"flex-1 py-3 bg-blue-500 text-white rounded-full font-semibold shadow-lg hover:shadow-xl transition-all ios-button",children:"开始摇一摇"}),e.jsx("button",{onClick:()=>f(!1),className:"px-6 py-3 glass-card text-gray-800 rounded-full font-semibold shadow-lg hover:shadow-xl transition-all ios-button",children:"取消"})]})]})}),u&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:()=>g(null),children:e.jsxs("div",{className:"glass-card rounded-3xl max-w-md w-full max-h-[80vh] overflow-y-auto p-6",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-6",children:[e.jsx("div",{className:"w-20 h-20 rounded-full glass-card flex items-center justify-center text-5xl shadow-lg border border-gray-200/50",children:u.avatar}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:u.name}),e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:u.signature})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"text-sm text-gray-700 whitespace-pre-wrap leading-relaxed",children:u.description})}),e.jsxs("div",{className:"flex space-x-3 mt-6",children:[e.jsx("button",{onClick:()=>{k(u),g(null)},className:"flex-1 py-3 bg-green-500 text-white rounded-full font-semibold shadow-lg hover:shadow-xl transition-all ios-button",children:"添加到通讯录"}),e.jsx("button",{onClick:()=>g(null),className:"px-6 py-3 glass-card text-gray-800 rounded-full font-semibold shadow-lg hover:shadow-xl transition-all ios-button",children:"关闭"})]})]})}),e.jsx("style",{children:"\n        @keyframes shake {\n          0%, 100% { transform: translateX(0) rotate(0deg); }\n          10%, 30%, 50%, 70%, 90% { transform: translateX(-10px) rotate(-5deg); }\n          20%, 40%, 60%, 80% { transform: translateX(10px) rotate(5deg); }\n        }\n        \n        @keyframes fade-in {\n          from { opacity: 0; }\n          to { opacity: 1; }\n        }\n        \n        @keyframes slide-up {\n          from {\n            opacity: 0;\n            transform: translateY(20px);\n          }\n          to {\n            opacity: 1;\n            transform: translateY(0);\n          }\n        }\n        \n        .animate-shake {\n          animation: shake 0.5s ease-in-out infinite;\n        }\n        \n        .animate-fade-in {\n          animation: fade-in 0.5s ease-out;\n        }\n        \n        .animate-slide-up {\n          animation: slide-up 0.5s ease-out forwards;\n          opacity: 0;\n        }\n      "})]})}},Symbol.toStringTag,{value:"Module"})),el=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),[l,n]=t.useState("recommend"),[i,c]=t.useState(null),[d,x]=t.useState(""),[m,h]=t.useState(!1),[u,g]=t.useState(!1),[p,f]=t.useState(6),b=t.useRef(null);return e.jsxs("div",{className:"h-screen flex flex-col bg-white",children:[r&&e.jsx(xa,{}),e.jsxs("div",{className:"glass-effect px-4 py-3 border-b border-gray-200/50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a(-1),className:"ios-button text-gray-700 hover:text-gray-900 -ml-2 transition-colors",children:e.jsx(ls,{size:24})}),e.jsx("h1",{className:"text-base font-semibold text-gray-900",children:"直播"}),e.jsx("button",{onClick:()=>h(!m),className:"ios-button text-gray-700 hover:text-gray-900",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("path",{d:"m21 21-4.35-4.35"})]})})]}),m&&e.jsx("div",{className:"mt-3",children:e.jsx("input",{type:"text",value:d,onChange:e=>x(e.target.value),placeholder:"搜索直播间或主播",className:"w-full px-4 py-2 bg-gray-100 rounded-full text-sm outline-none focus:bg-gray-200 transition-colors",autoFocus:!0})})]}),e.jsxs("div",{className:"flex border-b border-gray-200",children:[e.jsxs("button",{onClick:()=>n("recommend"),className:"flex-1 py-3 text-sm font-medium transition-colors relative "+("recommend"===l?"text-gray-900":"text-gray-500"),children:["推荐","recommend"===l&&e.jsx("div",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 w-12 h-0.5 bg-gray-900 rounded-full"})]}),e.jsxs("button",{onClick:()=>n("following"),className:"flex-1 py-3 text-sm font-medium transition-colors relative "+("following"===l?"text-gray-900":"text-gray-500"),children:["关注","following"===l&&e.jsx("div",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 w-12 h-0.5 bg-gray-900 rounded-full"})]})]}),e.jsx("div",{ref:b,className:"flex-1 overflow-y-auto hide-scrollbar",children:"recommend"===l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-4 pb-2",children:e.jsx("div",{className:"flex gap-2 overflow-x-auto hide-scrollbar",children:["全部","游戏","娱乐","美食","音乐","运动","学习","聊天"].map(t=>e.jsx("button",{onClick:()=>c("全部"===t?null:t),className:"px-4 py-1.5 rounded-full text-sm font-medium whitespace-nowrap transition-colors "+("全部"===t&&!i||i===t?"bg-gray-900 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:t},t))})}),u&&e.jsx("div",{className:"flex justify-center py-3",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-gray-600 rounded-full animate-spin"}),"刷新中..."]})}),e.jsxs("div",{className:"p-4 pt-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"正在直播"}),e.jsxs("button",{onClick:()=>{g(!0),setTimeout(()=>{g(!1),f(6)},1e3)},className:"text-xs text-gray-500 hover:text-gray-700 flex items-center gap-1",children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("polyline",{points:"23 4 23 10 17 10"}),e.jsx("path",{d:"M20.49 15a9 9 0 1 1-2.12-9.36L23 10"})]}),"刷新"]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:Array.from({length:p},(e,t)=>t+1).map(t=>e.jsxs("div",{className:"bg-white rounded-xl overflow-hidden cursor-pointer ios-button border border-gray-200 hover:border-gray-300 transition-all",onClick:()=>a(`/live/${t}`),children:[e.jsxs("div",{className:"relative aspect-[4/3] bg-gray-100",children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400 text-sm",children:"直播封面"})}),e.jsxs("div",{className:"absolute top-2 left-2 px-2 py-0.5 bg-black/60 backdrop-blur-sm rounded text-white text-xs",children:[(10*Math.random()).toFixed(1),"万"]}),e.jsx("div",{className:"absolute top-2 right-2 px-2 py-0.5 bg-red-500 rounded text-white text-xs font-medium",children:"直播中"})]}),e.jsx("div",{className:"p-2.5",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900 truncate",children:["直播标题 ",t]}),e.jsx("div",{className:"text-xs text-gray-500 truncate",children:"主播名称"})]})]})})]},t))}),p<20&&e.jsx("button",{onClick:()=>{f(e=>e+4)},className:"w-full mt-4 py-3 bg-gray-100 hover:bg-gray-200 rounded-xl text-sm text-gray-700 font-medium transition-colors",children:"加载更多"})]})]}):e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"我的关注"}),e.jsx("span",{className:"text-xs text-gray-500",children:"5人"})]}),e.jsx("div",{className:"space-y-3",children:[1,2,3,4,5].map(t=>{const s=t<=2;return e.jsxs("div",{className:"bg-white rounded-xl p-3 flex items-center gap-3 cursor-pointer ios-button border border-gray-200 hover:border-gray-300 transition-all",onClick:()=>a(`/live/${t}`),children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-200"}),s&&e.jsx("div",{className:"absolute -bottom-1 -right-1 px-1.5 py-0.5 bg-red-500 rounded text-white text-xs font-medium",children:"直播中"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:["主播名称 ",t]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:s?`${(5*Math.random()+1).toFixed(1)}万人观看`:`最近直播：${t}小时前`})]}),e.jsx("button",{className:"px-4 py-1.5 rounded-full text-sm font-medium transition-colors "+(s?"bg-red-500 text-white hover:bg-red-600":"bg-gray-100 text-gray-700 hover:bg-gray-200"),onClick:e=>{e.stopPropagation(),a(`/live/${t}`)},children:s?"进入直播间":"查看详情"})]},t)})}),e.jsxs("div",{className:"mt-8 text-center text-gray-400 text-sm",children:[e.jsx("div",{className:"mb-2",children:"暂无更多关注的主播"}),e.jsx("button",{className:"text-gray-600 hover:text-gray-900 font-medium",children:"去发现更多"})]})]})})]})}},Symbol.toStringTag,{value:"Module"})),tl={"新人":{initialRange:[30,80],peakRange:[150,400],growthSpeed:1,retentionRate:.6},"小有名气":{initialRange:[100,300],peakRange:[500,1200],growthSpeed:1.5,retentionRate:.75},"知名主播":{initialRange:[500,1e3],peakRange:[2e3,5e3],growthSpeed:2.5,retentionRate:.85},"顶流":{initialRange:[2e3,5e3],peakRange:[8e3,15e3],growthSpeed:4,retentionRate:.9}},sl=()=>{const e=["可爱的","帅气的","温柔的","阳光的","神秘的"],t=["小猫","小狗","小兔","小熊","小鸟","星星","月亮","太阳","彩虹","云朵"];return e[Math.floor(Math.random()*e.length)]+t[Math.floor(Math.random()*t.length)]},al=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{id:l}=r(),{showStatusBar:i}=o(),{getCharacter:c}=n(),d=l?JSON.parse(localStorage.getItem(`live_stream_${l}`)||"{}"):{},x=d.characterId?c(d.characterId):null,m=d.popularityLevel||"小有名气",h=tl[m]||tl["小有名气"],[u,g]=t.useState(!1),[p,f]=t.useState(!1),[b,j]=t.useState(0),[v,y]=t.useState(""),[N,w]=t.useState([]),[k,C]=t.useState(!1),[S,I]=t.useState(!1),_=t.useRef(null),M=t.useRef(null),[z,$]=t.useState(0),[L,A]=t.useState([]),[T,D]=t.useState(0),B=t.useRef(Date.now()),[E,P]=t.useState([]),[F,O]=t.useState(!1),[W,V]=t.useState(""),J=async()=>{if(v.trim()){const e={user:"我",text:v,id:Date.now()};w(t=>[...t,e]);y(""),Math.random()>.5&&setTimeout(()=>{F||H()},2e3+2e3*Math.random())}},H=async()=>{if(!F){O(!0);try{const e=N.slice(-10).map(e=>`${e.user}: ${e.text}`).join("\n"),t=[...E,{role:"user",content:`你正在直播中。这是最近的弹幕：\n${e}\n\n请根据这些弹幕做出自然的反应。你可以：1)感谢送礼物的人 2)回答观众的问题 3)和观众互动调侃 4)做动作描写（用括号）。保持简短自然，像真实主播一样，不超过30字。`}],s=await U(t);if(s.startsWith("（")||s.startsWith("("))V(s),setTimeout(()=>{V("")},3e3);else{const e={user:(null==x?void 0:x.name)||"主播",text:s,id:Date.now(),isNPC:!1};w(t=>[...t,e])}P([...t,{role:"assistant",content:s}]),setTimeout(()=>{G(s)},2e3+3e3*Math.random())}catch(e){const t=["（微笑着向镜头挥手）","谢谢大家的支持~","（整理了一下头发）"],s=t[Math.floor(Math.random()*t.length)];V(s),setTimeout(()=>{V("")},3e3)}finally{O(!1)}}},G=async e=>{if(0!==L.length)try{const t=[{role:"system",content:"你是直播间的一个观众。根据主播说的话，生成1-3条观众评论。评论要多样化：有鼓励的、调侃的、搞笑的、甚至偶尔有点毒舌的。也可以是观众之间的互动。每条评论用|||分隔，格式：观众名|||评论内容。保持简短真实。"},{role:"user",content:`主播说: ${e}\n观众列表: ${L.slice(0,5).map(e=>e.name).join(", ")}`}],s=(await U(t)).split("|||").filter(e=>e.trim()),a=Math.min(s.length,Math.random()>.5?2:1);for(let e=0;e<a;e++)setTimeout(()=>{var t;const a=s[e].split(":");let r=null==(t=a[0])?void 0:t.trim(),l=a.slice(1).join(":").trim();l||(r=L[Math.floor(Math.random()*L.length)].name,l=s[e].trim());const n={user:r,text:l,id:Date.now()+e,isNPC:!0};w(e=>[...e,n])},1500*e)}catch(t){}};return t.useEffect(()=>{const e=d.characterId;if(e)try{const t=localStorage.getItem(`chat_messages_${e}`);if(t){const e=JSON.parse(t).slice(-20).map(e=>({role:"sent"===e.type?"user":"assistant",content:e.content||e.voiceText||e.photoDescription||""})).filter(e=>e.content.trim());P([{role:"system",content:"你现在正在直播。观众会通过弹幕和你互动，你要像一个真实的主播一样回复他们。保持你的性格特点，简洁自然地回复。"},...e])}}catch(s){}const t=Math.floor(Math.random()*(h.initialRange[1]-h.initialRange[0])+h.initialRange[0]);$(t),j(Math.floor(t*Math.random()*10)),d.openingMessage&&setTimeout(()=>{const e={user:(null==x?void 0:x.name)||"主播",text:d.openingMessage,id:Date.now(),isNPC:!1};w(t=>[...t,e])},500)},[]),t.useEffect(()=>{const e=setInterval(()=>{const e=Math.floor((Date.now()-B.current)/6e4);D(e)},6e4);return()=>clearInterval(e)},[]),t.useEffect(()=>{M.current&&M.current.scrollIntoView({behavior:"smooth"})},[N,F]),t.useEffect(()=>{const e=setInterval(()=>{const e=Math.floor(5*Math.random()*h.growthSpeed),t=T<5?e:T<15?Math.floor(.5*e):Math.floor(.3*e);if(Math.random()>.3&&t>0){const e={id:`npc_${Date.now()}_${Math.random()}`,name:sl(),joinTime:Date.now()};A(t=>[...t,e]),$(e=>e+1);const t={user:"系统",text:`${e.name} 进入了直播间`,id:Date.now(),isNPC:!0};w(e=>[...e,t])}Math.random()>h.retentionRate&&L.length>10&&(A(e=>e.slice(1)),$(e=>Math.max(h.initialRange[0],e-1)))},8e3);return()=>clearInterval(e)},[T,h,L.length]),t.useEffect(()=>{const e=setInterval(async()=>{var e,t,s;if(0!==L.length&&0!==N.length&&!(Math.random()>.6))try{const a=[{role:"system",content:'你是直播间观众，要生成真实自然的弹幕评论。评论类型：\n1. 调侃主播（20%）："主播今天好像有点累啊" "哈哈这个梗笑死我了"\n2. 鼓励支持（30%）："加油！" "主播唱的真好听" "爱了爱了"\n3. 提问互动（20%）："主播今天吃了吗" "能唱xxx吗"\n4. 毒舌吐槽（10%）："主播有点菜啊" "这也太水了吧"\n5. 送礼物（10%）："送主播一朵花" "刷火箭了！"\n6. 观众互怼（10%）：回复其他观众，格式"@观众名 你说啥呢"\n\n生成1条评论，格式：观众名|||评论内容。保持简短真实，5-15字。'},{role:"user",content:`直播间气氛：\n${N.slice(-8).map(e=>`${e.user}: ${e.text}`).join("\n")}\n\n观众列表：${L.slice(0,8).map(e=>e.name).join(", ")}`}],r=await U(a),l=r.split("|||");let n=null==(e=l[0])?void 0:e.trim(),i=(null==(t=l[1])?void 0:t.trim())||(null==(s=l[0])?void 0:s.trim());if(n&&n!==i||(n=L[Math.floor(Math.random()*L.length)].name,i=r.replace(/.*?|||/,"").trim()||r.trim()),(i.includes("送")||i.includes("刷")||i.includes("火箭")||i.includes("礼物"))&&Math.random()>.7){const e=["玫瑰🌹","爱心❤️","火箭🚀","皇冠👑"],t=e[Math.floor(Math.random()*e.length)];i=`送出了${t}`}const c={user:n,text:i,id:Date.now(),isNPC:!0};w(e=>[...e,c]),Math.random()>.85&&i.includes("@")&&setTimeout(async()=>{const e=L[Math.floor(Math.random()*L.length)].name,t=[{role:"system",content:"生成一条观众回复另一个观众的评论。可以是：赞同、反对、调侃、吐槽。保持简短5-10字。"},{role:"user",content:`${n}说: ${i}`}],s={user:e,text:await U(t),id:Date.now()+1,isNPC:!0};w(e=>[...e,s])},1500+2e3*Math.random())}catch(a){if(L.length>0&&Math.random()>.5){const e=["666","哈哈哈","主播加油","好看！","爱了"],t={user:L[Math.floor(Math.random()*L.length)].name,text:e[Math.floor(Math.random()*e.length)],id:Date.now(),isNPC:!0};w(e=>[...e,t])}}},8e3+7e3*Math.random());return()=>clearInterval(e)},[L,N]),e.jsxs("div",{className:"h-screen flex flex-col bg-black",children:[i&&e.jsx(xa,{}),e.jsxs("div",{className:"relative flex-1 bg-gray-900",children:[e.jsxs("div",{onClick:H,className:"absolute inset-0 flex items-center justify-center bg-gradient-to-b from-purple-900/20 to-pink-900/20 cursor-pointer active:scale-95 transition-transform",children:[(null==x?void 0:x.avatar)?x.avatar.startsWith("data:image")?e.jsx("img",{src:x.avatar,alt:x.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"text-8xl",children:x.avatar}):e.jsx("div",{className:"text-gray-500 text-lg",children:"直播画面"}),W&&e.jsx("div",{className:"absolute bottom-6 left-4 right-4 px-4 py-2 bg-purple-600/70 backdrop-blur-sm rounded-lg transition-all duration-300 max-w-sm",children:e.jsx("div",{className:"text-white text-sm italic",children:W})})]}),e.jsx("div",{className:"absolute top-0 left-0 right-0 p-4 bg-gradient-to-b from-black/60 to-transparent",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a(-1),className:"w-10 h-10 rounded-full bg-black/40 backdrop-blur-sm flex items-center justify-center text-white hover:bg-black/60 transition-colors",children:e.jsx(ls,{size:20})}),e.jsxs("div",{className:"flex-1 mx-3 flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-700 flex items-center justify-center text-xl overflow-hidden",children:(null==x?void 0:x.avatar)&&!x.avatar.startsWith("data:image")?x.avatar:(null==x?void 0:x.avatar)?e.jsx("img",{src:x.avatar,alt:"",className:"w-full h-full object-cover"}):"👤"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-white text-sm font-medium",children:(null==x?void 0:x.name)||"主播"}),e.jsx("div",{className:"text-white/70 text-xs",children:z>=1e4?`${Math.floor(z/1e4)}万+人观看`:`${z}人观看`})]}),e.jsx("button",{onClick:()=>{const e=!u;if(g(e),e){const e={user:"系统",text:"你关注了主播",id:Date.now(),isNPC:!1};w(t=>[...t,e]),Math.random()>.7&&setTimeout(()=>{F||H()},1500)}},className:"px-4 py-1.5 rounded-full text-sm font-medium transition-colors "+(u?"bg-white/20 text-white hover:bg-white/30":"bg-red-500 text-white hover:bg-red-600"),children:u?"已关注":"关注"})]}),e.jsx("button",{onClick:()=>I(!S),className:"w-10 h-10 rounded-full bg-black/40 backdrop-blur-sm flex items-center justify-center text-white hover:bg-black/60 transition-colors",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"1"}),e.jsx("circle",{cx:"12",cy:"5",r:"1"}),e.jsx("circle",{cx:"12",cy:"19",r:"1"})]})})]})}),S&&e.jsx("div",{className:"absolute top-16 right-4 bg-white rounded-xl shadow-xl overflow-hidden z-10",children:["举报","屏蔽","清晰度","音量"].map(t=>e.jsx("button",{onClick:()=>I(!1),className:"w-full px-6 py-3 text-left text-sm text-gray-700 hover:bg-gray-100 transition-colors",children:t},t))}),e.jsxs("div",{className:"absolute right-4 bottom-32 flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("button",{onClick:()=>{f(!p),j(e=>p?e-1:e+1)},className:"w-12 h-12 rounded-full bg-black/40 backdrop-blur-sm flex items-center justify-center transition-all "+(p?"text-red-500":"text-white"),children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:p?"currentColor":"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"})})}),e.jsx("span",{className:"text-white text-xs mt-1",children:b>=1e4?`${Math.floor(b/1e4)}万+`:b})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("button",{onClick:()=>C(!0),className:"w-12 h-12 rounded-full bg-black/40 backdrop-blur-sm flex items-center justify-center text-white",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"8",width:"18",height:"4",rx:"1"}),e.jsx("path",{d:"M12 8v13"}),e.jsx("path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7"}),e.jsx("path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5"})]})}),e.jsx("span",{className:"text-white text-xs mt-1",children:"礼物"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("button",{className:"w-12 h-12 rounded-full bg-black/40 backdrop-blur-sm flex items-center justify-center text-white",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"18",cy:"5",r:"3"}),e.jsx("circle",{cx:"6",cy:"12",r:"3"}),e.jsx("circle",{cx:"18",cy:"19",r:"3"}),e.jsx("line",{x1:"8.59",y1:"13.51",x2:"15.42",y2:"17.49"}),e.jsx("line",{x1:"15.41",y1:"6.51",x2:"8.59",y2:"10.49"})]})}),e.jsx("span",{className:"text-white text-xs mt-1",children:"分享"})]})]}),e.jsx("div",{className:"absolute left-4 right-20 bottom-32 max-h-48 overflow-y-auto hide-scrollbar",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[N.map(t=>{if(!t.text||!t.user)return null;const s=t.text.startsWith("（")||t.text.startsWith("("),a=t.user===(null==x?void 0:x.name)||"主播"===t.user,r="系统"===t.user;return e.jsxs("div",{className:"px-3 py-1.5 backdrop-blur-sm rounded-full text-sm max-w-xs w-fit "+(s?"bg-purple-500/30 italic":r?"bg-gray-500/30":"bg-black/40"),children:[e.jsxs("span",{className:"font-medium "+(a?"text-pink-400":r?"text-gray-300":"text-blue-400"),children:[t.user,"："]}),e.jsx("span",{className:s?"text-gray-200":"text-white",children:t.text})]},t.id)}),F&&e.jsxs("div",{className:"px-3 py-1.5 bg-black/40 backdrop-blur-sm rounded-full text-white text-sm max-w-xs w-fit",children:[e.jsxs("span",{className:"text-pink-400 font-medium",children:[(null==x?void 0:x.name)||"主播","："]}),e.jsx("span",{className:"animate-pulse",children:"正在输入..."})]}),e.jsx("div",{ref:M})]})})]}),k&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 z-20",onClick:()=>C(!1)}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-white rounded-t-3xl p-4 pb-20 z-30 shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"选择礼物"}),e.jsx("button",{onClick:()=>C(!1),className:"text-gray-500 hover:text-gray-700",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),e.jsx("div",{className:"grid grid-cols-4 gap-3 max-h-64 overflow-y-auto",children:[{name:"玫瑰",emoji:"🌹",price:1},{name:"爱心",emoji:"❤️",price:5},{name:"火箭",emoji:"🚀",price:10},{name:"跑车",emoji:"🚗",price:20},{name:"城堡",emoji:"🏰",price:50},{name:"皇冠",emoji:"👑",price:100},{name:"钻石",emoji:"💎",price:200},{name:"星星",emoji:"⭐",price:520}].map(t=>e.jsxs("button",{onClick:()=>((e,t,s)=>{const a=d.characterId;if(!a)return;const r=ke("user_money",0),l=`intimate_pay_${a}_to_user`,n=ke(l,null);let i="",c=!1;if(n&&"active"===n.status){const s=n.used||0;n.monthlyLimit-s>=t&&(n.used=s+t,n.records||(n.records=[]),n.records.push({date:(new Date).toISOString(),amount:t,description:`直播-${(null==x?void 0:x.name)||"主播"}-送出${e}`,timestamp:Date.now()}),R(l,n),i="亲密付",c=!0)}if(c||r>=t&&(R("user_money",r-t),i="微信零钱",c=!0),c){C(!1);const a={user:"我",text:`送出了${e} ${s}`,id:Date.now()};w(e=>[...e,a]);const r={user:"系统",text:`使用${i}支付 ¥${t}`,id:Date.now()+1};setTimeout(()=>{w(e=>[...e,r])},500),setTimeout(()=>{F||H()},1e3+1e3*Math.random())}else alert(`余额不足！\n礼物价格：¥${t}\n当前零钱：¥${r.toFixed(2)}\n${n?`亲密付剩余：¥${(n.monthlyLimit-(n.used||0)).toFixed(2)}`:"未开通亲密付"}`)})(t.name,t.price,t.emoji),className:"flex flex-col items-center gap-2 p-3 bg-gray-50 rounded-xl hover:bg-gray-200 active:bg-gray-300 transition-colors",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-pink-100 to-red-100 rounded-full flex items-center justify-center text-3xl",children:t.emoji}),e.jsx("span",{className:"text-xs text-gray-900 font-medium",children:t.name}),e.jsxs("span",{className:"text-xs text-red-500 font-semibold",children:["¥",t.price]})]},t.name))})]})]}),e.jsx("div",{className:"bg-white border-t border-gray-200 z-40 relative",children:e.jsxs("div",{className:"flex items-center gap-2 p-3",children:[e.jsx("button",{className:"w-10 h-10 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center transition-colors flex-shrink-0",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M8 14s1.5 2 4 2 4-2 4-2"}),e.jsx("line",{x1:"9",y1:"9",x2:"9.01",y2:"9"}),e.jsx("line",{x1:"15",y1:"9",x2:"15.01",y2:"9"})]})}),e.jsx("div",{className:"flex-1 h-10 px-4 bg-gray-100 rounded-full flex items-center",children:e.jsx("input",{ref:_,type:"text",value:v,onChange:e=>y(e.target.value),onKeyPress:e=>"Enter"===e.key&&J(),placeholder:"说点什么...",className:"flex-1 bg-transparent text-sm outline-none text-gray-900 placeholder-gray-500"})}),e.jsx("button",{onClick:()=>{var e;return null==(e=_.current)?void 0:e.focus()},className:"w-10 h-10 rounded-full bg-gray-900/80 flex items-center justify-center text-white flex-shrink-0",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})})}),v&&e.jsx("button",{onClick:J,className:"px-5 h-10 bg-red-500 text-white rounded-full text-sm font-medium hover:bg-red-600 active:bg-red-700 transition-colors flex-shrink-0",children:"发送"})]})})]})}},Symbol.toStringTag,{value:"Module"})),rl=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{var a;const r=s(),{background:l,getBackgroundStyle:i}=c(),{showStatusBar:x}=o(),{characters:m}=n(),{currentUser:h}=d(),[u,g]=t.useState(null),[p,f]=t.useState(!1),[b,j]=t.useState("public");t.useEffect(()=>{v();const e=()=>{document.hidden||v()};document.addEventListener("visibilitychange",e);const t=()=>{v()};return window.addEventListener("focus",t),()=>{document.removeEventListener("visibilitychange",e),window.removeEventListener("focus",t)}},[]);const v=()=>{const e=et();g(e);const t=tt();j(t)};return e.jsxs("div",{className:"h-full flex flex-col relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 z-0",style:i()}),e.jsxs("div",{className:"relative z-10 h-full flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-50 "+(l?"glass-dark":"glass-effect"),children:[x&&e.jsx(xa,{}),e.jsxs("div",{className:"flex items-center justify-between px-5 py-4",children:[e.jsx("button",{onClick:()=>r(-1),className:"text-blue-500 ios-button",children:"返回"}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"情侣空间"}),e.jsx("div",{className:"w-12"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-4 pt-6",children:u&&"ended"!==u.status&&"rejected"!==u.status?"pending"===u.status?e.jsx("div",{className:"flex flex-col items-center justify-center min-h-[60vh]",children:e.jsx("div",{className:"w-full max-w-md",children:e.jsxs("div",{className:"glass-card rounded-3xl p-8 text-center space-y-6 shadow-xl border border-white/20",children:[e.jsx("div",{className:"w-24 h-24 mx-auto rounded-full glass-card flex items-center justify-center shadow-lg border border-white/30 animate-pulse",children:e.jsx("svg",{className:"w-12 h-12 text-pink-400",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"等待对方同意"}),e.jsxs("p",{className:"text-gray-600 text-sm",children:["已向 ",u.characterName," 发送邀请",e.jsx("br",{}),"请耐心等待对方回应"]})]})]})})}):e.jsxs("div",{className:"space-y-6 pb-6",children:[e.jsxs("div",{className:"glass-card rounded-3xl p-8 shadow-2xl border border-white/20",children:[e.jsxs("div",{className:"relative flex items-center justify-center mb-6",children:[e.jsx("div",{className:"relative z-10",children:e.jsx("div",{className:"w-28 h-28 rounded-full glass-card p-1.5 shadow-2xl border border-white/40",children:e.jsx("div",{className:"w-full h-full rounded-full overflow-hidden bg-gray-100",children:(null==h?void 0:h.avatar)?e.jsx("img",{src:h.avatar,alt:h.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-700 text-3xl font-bold",children:(null==(a=null==h?void 0:h.name)?void 0:a[0])||"我"})})})}),e.jsx("div",{className:"relative z-20 -mx-6",children:e.jsx("div",{className:"w-16 h-16 rounded-full glass-card flex items-center justify-center shadow-xl border-2 border-white/50",children:e.jsx("svg",{className:"w-8 h-8 text-pink-400",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})})})}),e.jsx("div",{className:"relative z-10",children:e.jsx("div",{className:"w-28 h-28 rounded-full glass-card p-1.5 shadow-2xl border border-white/40",children:e.jsx("div",{className:"w-full h-full rounded-full overflow-hidden bg-white",children:u.characterAvatar?e.jsx("img",{src:u.characterAvatar,alt:u.characterName,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gray-100 flex items-center justify-center text-gray-700 text-3xl font-bold",children:u.characterName[0]})})})})]}),e.jsx("div",{className:"text-center mb-4",children:e.jsxs("h2",{className:"text-2xl font-bold text-gray-900",children:[(null==h?void 0:h.name)||"我"," & ",u.characterName]})}),e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"inline-flex items-baseline space-x-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"在一起"}),e.jsx("span",{className:"text-5xl font-bold text-gray-900",children:Math.floor((Date.now()-(u.acceptedAt||u.createdAt))/864e5)}),e.jsx("span",{className:"text-sm text-gray-600",children:"天"})]})})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("button",{onClick:()=>r("/couple-album"),className:"flex flex-col items-center space-y-2 p-4 rounded-2xl glass-card border border-white/10 hover:scale-105 active:scale-95 transition-all",children:[e.jsx("div",{className:"w-14 h-14 rounded-full glass-card flex items-center justify-center shadow-lg border border-white/30",children:e.jsx("svg",{className:"w-7 h-7 text-purple-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsx("span",{className:"text-xs font-medium text-gray-700",children:"相册"})]}),e.jsxs("button",{onClick:()=>r("/couple-anniversary"),className:"flex flex-col items-center space-y-2 p-4 rounded-2xl glass-card border border-white/10 hover:scale-105 active:scale-95 transition-all",children:[e.jsx("div",{className:"w-14 h-14 rounded-full glass-card flex items-center justify-center shadow-lg border border-white/30",children:e.jsx("svg",{className:"w-7 h-7 text-pink-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsx("span",{className:"text-xs font-medium text-gray-700",children:"纪念日"})]}),e.jsxs("button",{onClick:()=>r("/couple-message-board"),className:"flex flex-col items-center space-y-2 p-4 rounded-2xl glass-card border border-white/10 hover:scale-105 active:scale-95 transition-all",children:[e.jsx("div",{className:"w-14 h-14 rounded-full glass-card flex items-center justify-center shadow-lg border border-white/30",children:e.jsx("svg",{className:"w-7 h-7 text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"})})}),e.jsx("span",{className:"text-xs font-medium text-gray-700",children:"留言"})]}),e.jsxs("button",{className:"flex flex-col items-center space-y-2 p-4 rounded-2xl glass-card border border-white/10 hover:scale-105 active:scale-95 transition-all",children:[e.jsx("div",{className:"w-14 h-14 rounded-full glass-card flex items-center justify-center shadow-lg border border-white/30",children:e.jsx("svg",{className:"w-7 h-7 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})}),e.jsx("span",{className:"text-xs font-medium text-gray-700",children:"更多"})]})]}),e.jsx("div",{className:"glass-card rounded-2xl p-4 border border-white/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900 mb-1",children:"隐私设置"}),e.jsx("div",{className:"text-xs text-gray-600",children:"public"===b?"公开：其他人可以看到你有情侣空间":"私密：对其他人隐藏情侣空间状态"})]}),e.jsx("button",{onClick:()=>{const e="public"===b?"private":"public";st(e),j(e)},className:"px-4 py-2 rounded-full text-sm font-medium ios-button transition-all "+("public"===b?"glass-card border border-white/20 text-gray-900":"bg-blue-500 text-white"),children:"public"===b?"公开":"私密"})]})}),e.jsx("button",{onClick:()=>{if(confirm("确定要结束情侣空间吗？")){at()&&(alert("已结束情侣空间"),v())}},className:"w-full py-3 rounded-2xl text-red-400 text-sm font-medium glass-card border border-red-200/30 hover:bg-red-50 active:bg-red-100 transition-all",children:"结束情侣空间"})]}):e.jsx("div",{className:"flex flex-col items-center justify-center min-h-[60vh]",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"glass-card rounded-3xl p-8 text-center space-y-6 shadow-xl border border-white/20",children:[e.jsx("div",{className:"w-24 h-24 mx-auto rounded-full glass-card flex items-center justify-center shadow-lg border border-white/30",children:e.jsx("svg",{className:"w-12 h-12 text-pink-400",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"开启情侣空间"}),e.jsxs("p",{className:"text-gray-600 text-sm leading-relaxed",children:["邀请你的TA加入专属情侣空间",e.jsx("br",{}),"共同记录美好时光"]})]}),e.jsx("button",{onClick:()=>f(!0),className:"w-full py-4 rounded-2xl glass-card text-gray-900 font-semibold shadow-lg border border-white/30 hover:scale-[0.98] active:scale-[0.96] transition-all",children:"发送邀请"})]}),e.jsxs("div",{className:"mt-6 glass-card rounded-2xl p-6 space-y-4 border border-white/10",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-pink-100 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-pink-500 text-sm font-bold",children:"1"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-gray-900 font-medium mb-1",children:"选择你的TA"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"从角色列表中选择一位进行邀请"})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-pink-100 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-pink-500 text-sm font-bold",children:"2"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-gray-900 font-medium mb-1",children:"等待对方同意"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"对方可以选择接受或拒绝邀请"})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-pink-100 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-pink-500 text-sm font-bold",children:"3"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-gray-900 font-medium mb-1",children:"开启专属空间"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"建立后可共享照片、记录纪念日等"})]})]})]})]})})})]}),p&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm",onClick:()=>f(!1)}),e.jsxs("div",{className:"relative w-full max-h-[70vh] glass-card rounded-t-3xl overflow-hidden",children:[e.jsx("div",{className:"sticky top-0 z-10 glass-effect px-6 py-4 border-b border-gray-100",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900 text-center",children:"选择邀请对象"})}),e.jsx("div",{className:"overflow-y-auto hide-scrollbar p-4 space-y-2",children:m.map(t=>e.jsxs("div",{onClick:()=>{(e=>{const t=m.find(t=>t.id===e);if(!t)return;rt("current_user",t.id,t.name,t.avatar)?r(`/chat/${e}`,{state:{sendCoupleSpaceInvite:!0}}):alert("创建邀请失败，请先结束当前的情侣空间")})(t.id),f(!1)},className:"flex items-center space-x-3 p-4 rounded-2xl glass-card hover:scale-[0.98] active:scale-[0.96] transition-all cursor-pointer border border-white/10",children:[e.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden bg-gradient-to-br from-blue-400 to-purple-400 flex-shrink-0",children:t.avatar?e.jsx("img",{src:t.avatar,alt:t.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-white text-lg font-bold",children:t.name[0]})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:t.name}),t.description&&e.jsx("p",{className:"text-sm text-gray-600 line-clamp-1 mt-0.5",children:t.description})]})]},t.id))})]})]})]})}},Symbol.toStringTag,{value:"Module"})),ll=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{background:r,getBackgroundStyle:l}=c(),{showStatusBar:n}=o(),[i,d]=t.useState([]),[x,m]=t.useState(!1),[h,u]=t.useState(""),[g,p]=t.useState(null);t.useEffect(()=>{f()},[]);const f=()=>{const e=lt();d(e)};return e.jsxs("div",{className:"h-full flex flex-col relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 z-0",style:l()}),e.jsxs("div",{className:"relative z-10 h-full flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-50 "+(r?"glass-dark":"glass-effect"),children:[n&&e.jsx(xa,{}),e.jsxs("div",{className:"flex items-center justify-between px-5 py-4",children:[e.jsx("button",{onClick:()=>a(-1),className:"text-blue-500 ios-button",children:"返回"}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"相册"}),e.jsx("button",{onClick:()=>m(!0),className:"text-blue-500 ios-button",children:"上传"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-4 pt-6",children:0===i.length?e.jsx("div",{className:"flex flex-col items-center justify-center min-h-[60vh]",children:e.jsx("div",{className:"w-full max-w-md",children:e.jsxs("div",{className:"glass-card rounded-3xl p-8 text-center space-y-6 shadow-xl border border-white/20",children:[e.jsx("div",{className:"w-24 h-24 mx-auto rounded-full glass-card flex items-center justify-center shadow-lg border border-white/30",children:e.jsx("svg",{className:"w-12 h-12 text-purple-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"暂无照片"}),e.jsxs("p",{className:"text-gray-600 text-sm leading-relaxed",children:["在聊天中让AI用 [相册:描述] 分享照片",e.jsx("br",{}),"记录每一个甜蜜时刻"]})]})]})})}):e.jsx("div",{className:"grid grid-cols-2 gap-4 pb-6",children:i.map(t=>{const s=new Date(t.timestamp).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),a=t.description&&"（无文案）"!==t.description;return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx(Fa,{description:"暂无图片描述（后续识图功能将自动生成）",messageId:t.timestamp})}),e.jsxs("div",{className:"flex items-center justify-between px-2",children:[e.jsx("span",{className:"text-xs font-semibold text-gray-700",children:t.uploaderName||t.characterName}),e.jsx("span",{className:"text-xs text-gray-500",children:s})]}),a&&e.jsx("div",{className:"glass-card rounded-xl p-3 border border-white/20",children:e.jsx("p",{className:"text-sm text-gray-700 leading-relaxed",children:t.description})})]},t.id)})})}),x&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm",onClick:()=>m(!1)}),e.jsxs("div",{className:"relative w-full max-w-sm glass-card rounded-3xl p-6 shadow-2xl border border-white/20",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4 text-center",children:"上传照片"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-2",children:"选择照片（可选）"}),e.jsx("input",{type:"file",accept:"image/*",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(s){const e=new FileReader;e.onload=e=>{var t;p(null==(t=e.target)?void 0:t.result)},e.readAsDataURL(s)}},className:"w-full px-3 py-2 border border-gray-300 rounded-xl text-sm"}),g&&e.jsx("img",{src:g,alt:"预览",className:"mt-2 w-full h-40 object-cover rounded-xl"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-2",children:"文案"}),e.jsx("textarea",{value:h,onChange:e=>u(e.target.value),placeholder:"写下你想说的话...",className:"w-full px-3 py-2 border border-gray-300 rounded-xl resize-none text-sm",rows:3}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"图片描述将在后续识图功能中自动生成"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>m(!1),className:"flex-1 px-4 py-3 rounded-full glass-card border border-white/20 text-gray-900 font-medium ios-button",children:"取消"}),e.jsx("button",{onClick:()=>{if(!h.trim()&&!g)return void alert("请至少上传照片或输入文案");const e=et();e&&"active"===e.status?(nt(e.characterId,"我",h.trim()||"（无文案）",g||void 0),u(""),p(null),m(!1),f(),alert("照片已上传！")):alert("请先开通情侣空间")},className:"flex-1 px-4 py-3 rounded-full glass-card border border-white/20 text-gray-900 font-medium ios-button",children:"上传"})]})]})]})]})]})}},Symbol.toStringTag,{value:"Module"})),nl=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{background:r,getBackgroundStyle:l}=c(),{showStatusBar:n}=o(),[i,d]=t.useState([]),[x,m]=t.useState(!1),[h,u]=t.useState(""),[g,p]=t.useState(""),[f,b]=t.useState(""),[j,v]=t.useState(null),[y,N]=t.useState(!1),[w,k]=t.useState(null);t.useEffect(()=>{S(),C();const e=()=>{document.hidden||C()};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}},[]);const C=()=>{const e=it();k(e)},S=()=>{const e=ct();d(e)};return e.jsxs("div",{className:"h-full flex flex-col relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 z-0",style:l()}),e.jsxs("div",{className:"relative z-10 h-full flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-50 "+(r?"glass-dark":"glass-effect"),children:[n&&e.jsx(xa,{}),e.jsxs("div",{className:"flex items-center justify-between px-5 py-4",children:[e.jsx("button",{onClick:()=>a(-1),className:"text-blue-500 ios-button",children:"返回"}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"纪念日"}),e.jsx("button",{onClick:()=>m(!0),className:"text-blue-500 ios-button",children:"添加"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-4 pt-6",children:0===i.length?e.jsx("div",{className:"flex flex-col items-center justify-center min-h-[60vh]",children:e.jsx("div",{className:"w-full max-w-md",children:e.jsxs("div",{className:"glass-card rounded-3xl p-8 text-center space-y-6 shadow-xl border border-white/20",children:[e.jsx("div",{className:"w-24 h-24 mx-auto rounded-full glass-card flex items-center justify-center shadow-lg border border-white/30",children:e.jsx("svg",{className:"w-12 h-12 text-pink-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"暂无纪念日"}),e.jsxs("p",{className:"text-gray-600 text-sm leading-relaxed",children:["在聊天中让AI用 [纪念日:日期|标题|描述] 添加",e.jsx("br",{}),"每一个纪念日都值得珍藏"]})]})]})})}):e.jsx("div",{className:"grid grid-cols-2 gap-4 pb-6",children:i.map(t=>{const s=ot(t.date),a=s<0,r=0===s,l=Math.abs(s),n=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"][new Date(t.date).getDay()];return e.jsxs("div",{className:"relative rounded-2xl overflow-hidden shadow-lg border border-white/20 cursor-pointer hover:scale-105 transition-transform",onClick:()=>{v(t),N(!0)},children:[w&&e.jsx("div",{className:"absolute inset-0 bg-cover bg-center",style:{backgroundImage:`url(${w})`}}),e.jsx("div",{className:"absolute inset-0 bg-white/60"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("div",{className:"px-4 py-3 text-center border-b border-white/20",children:e.jsx("h3",{className:"text-gray-900 text-base font-bold truncate",children:t.title})}),e.jsx("div",{className:"px-4 py-8",children:e.jsx("div",{className:"text-center",children:a?e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-gray-500 text-xs",children:"已经过去"}),e.jsx("p",{className:"text-5xl font-bold text-gray-800 tracking-tight leading-none",children:l}),e.jsx("p",{className:"text-gray-500 text-sm",children:"天"})]}):r?e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-pink-500 text-sm font-bold",children:"就是今天"}),e.jsx("p",{className:"text-5xl font-bold text-pink-500 tracking-tight leading-none",children:"0"})]}):e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-gray-500 text-xs",children:"还有"}),e.jsx("p",{className:"text-5xl font-bold text-gray-800 tracking-tight leading-none",children:l}),e.jsx("p",{className:"text-gray-500 text-sm",children:"天"})]})})}),e.jsxs("div",{className:"px-4 py-3 text-center border-t border-white/20",children:[e.jsxs("p",{className:"text-gray-600 text-xs truncate",children:[t.date," ",n]}),t.description&&e.jsx("p",{className:"text-gray-500 text-xs mt-1 truncate",children:t.description})]})]})]},t.id)})})}),x&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm",onClick:()=>m(!1)}),e.jsxs("div",{className:"relative w-full max-w-sm glass-card rounded-3xl p-6 shadow-2xl border border-white/20",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4 text-center",children:"添加纪念日"}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-2",children:"日期"}),e.jsx("input",{type:"date",value:h,onChange:e=>u(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-xl text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-2",children:"标题"}),e.jsx("input",{type:"text",value:g,onChange:e=>p(e.target.value),placeholder:"例如：第一次见面",className:"w-full px-3 py-2 border border-gray-300 rounded-xl text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-2",children:"描述（可选）"}),e.jsx("textarea",{value:f,onChange:e=>b(e.target.value),placeholder:"记录这个特殊的日子...",className:"w-full px-3 py-2 border border-gray-300 rounded-xl resize-none text-sm",rows:3})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>m(!1),className:"flex-1 px-4 py-3 rounded-full glass-card border border-white/20 text-gray-900 font-medium ios-button",children:"取消"}),e.jsx("button",{onClick:()=>{if(!h||!g.trim())return void alert("请填写日期和标题");const e=et();e&&"active"===e.status?(dt(e.characterId,"我",h,g.trim(),f.trim()),u(""),p(""),b(""),m(!1),S(),alert("纪念日已添加！")):alert("请先开通情侣空间")},className:"flex-1 px-4 py-3 rounded-full glass-card border border-white/20 text-gray-900 font-medium ios-button",children:"添加"})]})]})]}),y&&j&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm",onClick:()=>N(!1)}),e.jsxs("div",{className:"relative w-full max-w-md glass-card rounded-3xl p-6 shadow-2xl border border-white/20",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4 text-center",children:j.title}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"glass-card rounded-xl p-4 border border-white/20",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"目标日期"}),e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:j.date}),e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"][new Date(j.date).getDay()]})]}),e.jsxs("div",{className:"glass-card rounded-xl p-4 border border-white/20",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"倒计时"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:(()=>{const e=ot(j.date),t=e<0,s=0===e,a=Math.abs(e);return s?"就是今天！":t?`已过 ${a} 天`:`还有 ${a} 天`})()})]}),j.description&&e.jsxs("div",{className:"glass-card rounded-xl p-4 border border-white/20",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"描述"}),e.jsx("div",{className:"text-sm text-gray-900 leading-relaxed",children:j.description})]}),e.jsxs("div",{className:"glass-card rounded-xl p-4 border border-white/20",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"创建者"}),e.jsx("div",{className:"text-sm text-gray-900",children:j.characterName})]}),e.jsxs("div",{className:"glass-card rounded-xl p-4 border border-white/20",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"创建时间"}),e.jsx("div",{className:"text-sm text-gray-900",children:new Date(j.createdAt).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})})]})]}),e.jsx("button",{onClick:()=>N(!1),className:"w-full px-4 py-3 rounded-full glass-card border border-white/20 text-gray-900 font-medium ios-button mt-4",children:"关闭"})]})]})]})]})}},Symbol.toStringTag,{value:"Module"})),il=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{background:r,getBackgroundStyle:l}=c(),{showStatusBar:n}=o(),[i,d]=t.useState([]),[x,m]=t.useState(!1),[h,u]=t.useState("");t.useEffect(()=>{g()},[]);const g=()=>{const e=xt();d(e)},p=e=>{const t=new Date(e),s=(new Date).getTime()-t.getTime(),a=Math.floor(s/864e5);return 0===a?"今天 "+t.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):1===a?"昨天":a<7?`${a}天前`:t.toLocaleDateString("zh-CN",{month:"long",day:"numeric"})};return e.jsxs("div",{className:"h-full flex flex-col relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 z-0",style:l()}),e.jsxs("div",{className:"relative z-10 h-full flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-50 "+(r?"glass-dark":"glass-effect"),children:[n&&e.jsx(xa,{}),e.jsxs("div",{className:"flex items-center justify-between px-5 py-4",children:[e.jsx("button",{onClick:()=>a(-1),className:"text-blue-500 ios-button",children:"返回"}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"留言板"}),e.jsx("button",{onClick:()=>m(!0),className:"text-blue-500 ios-button",children:"写留言"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-4 pt-6",children:0===i.length?e.jsx("div",{className:"flex flex-col items-center justify-center min-h-[60vh]",children:e.jsx("div",{className:"w-full max-w-md",children:e.jsxs("div",{className:"glass-card rounded-3xl p-8 text-center space-y-6 shadow-xl border border-white/20",children:[e.jsx("div",{className:"w-24 h-24 mx-auto rounded-full glass-card flex items-center justify-center shadow-lg border border-white/30",children:e.jsx("svg",{className:"w-12 h-12 text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"})})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"暂无留言"}),e.jsxs("p",{className:"text-gray-600 text-sm leading-relaxed",children:["在聊天中让AI用 [留言:内容] 写留言",e.jsx("br",{}),"每一句话都是爱的表达"]})]})]})})}):e.jsx("div",{className:"space-y-4 pb-6",children:i.map(t=>e.jsx("div",{className:"glass-card rounded-2xl p-5 border border-white/20 shadow-lg",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full glass-card flex items-center justify-center flex-shrink-0 border border-white/30",children:e.jsx("svg",{className:"w-5 h-5 text-blue-400",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:t.characterName}),e.jsx("span",{className:"text-xs text-gray-500",children:p(t.timestamp)})]}),e.jsx("p",{className:"text-sm text-gray-700 leading-relaxed",children:t.content})]})]})},t.id))})}),x&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm",onClick:()=>m(!1)}),e.jsxs("div",{className:"relative w-full max-w-sm glass-card rounded-3xl p-6 shadow-2xl border border-white/20",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4 text-center",children:"发布留言"}),e.jsx("textarea",{value:h,onChange:e=>u(e.target.value),placeholder:"写下你想说的话...",className:"w-full px-3 py-2 border border-gray-300 rounded-xl resize-none mb-4 text-sm",rows:5,autoFocus:!0}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>m(!1),className:"flex-1 px-4 py-3 rounded-full glass-card border border-white/20 text-gray-900 font-medium ios-button",children:"取消"}),e.jsx("button",{onClick:()=>{if(!h.trim())return void alert("请输入留言内容");const e=et();e&&"active"===e.status?(mt(e.characterId,"我",h.trim()),u(""),m(!1),g(),alert("留言已发布！")):alert("请先开通情侣空间")},className:"flex-1 px-4 py-3 rounded-full glass-card border border-white/20 text-gray-900 font-medium ios-button",children:"发布"})]})]})]})]})]})}},Symbol.toStringTag,{value:"Module"})),cl=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{background:r,getBackgroundStyle:l}=c(),{showStatusBar:n}=o(),[i,d]=t.useState(new Date),[x,m]=t.useState([]),[h,u]=t.useState(null),[g,p]=t.useState(null),f=t.useRef(null);t.useEffect(()=>{j(),b()},[]);const b=()=>{const e=it();p(e)},j=()=>{const e=ct();m(e)},v=(e,t,s)=>{const a=`${e}-${String(t+1).padStart(2,"0")}-${String(s).padStart(2,"0")}`;return x.filter(e=>e.date===a)},y=h?x.filter(e=>e.date===h):[];return e.jsxs("div",{className:"h-full flex flex-col relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 z-0",style:l()}),e.jsxs("div",{className:"relative z-10 h-full flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-50 "+(r?"glass-dark":"glass-effect"),children:[n&&e.jsx(xa,{}),e.jsxs("div",{className:"flex items-center justify-between px-5 py-4",children:[e.jsx("button",{onClick:()=>a(-1),className:"text-blue-500 ios-button",children:"返回"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"日历"}),e.jsx("button",{onClick:()=>{var e;null==(e=f.current)||e.click()},className:"w-8 h-8 rounded-full glass-card border border-white/20 flex items-center justify-center ios-button",title:"设置纪念日背景",children:e.jsx("svg",{className:"w-4 h-4 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),g&&e.jsx("button",{onClick:()=>{confirm("确定要删除纪念日背景吗？")&&(ht(),p(null))},className:"w-8 h-8 rounded-full glass-card border border-red-200/30 flex items-center justify-center ios-button",title:"删除背景",children:e.jsx("svg",{className:"w-4 h-4 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("button",{onClick:()=>{d(new Date)},className:"text-blue-500 ios-button text-sm",children:"今天"})]})]}),e.jsx("input",{ref:f,type:"file",accept:"image/*",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(s){const e=new FileReader;e.onload=e=>{var t;const s=null==(t=e.target)?void 0:t.result;ut(s),p(s),alert("背景上传成功！")},e.readAsDataURL(s)}},className:"hidden"}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-4 pt-4 pb-6",children:[e.jsx("div",{className:"glass-card rounded-2xl p-4 mb-4 border border-white/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:()=>{d(new Date(i.getFullYear(),i.getMonth()-1))},className:"w-10 h-10 flex items-center justify-center ios-button glass-card rounded-full",children:"←"}),e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:i.toLocaleDateString("zh-CN",{year:"numeric",month:"long"})})}),e.jsx("button",{onClick:()=>{d(new Date(i.getFullYear(),i.getMonth()+1))},className:"w-10 h-10 flex items-center justify-center ios-button glass-card rounded-full",children:"→"})]})}),e.jsx("div",{className:"grid grid-cols-7 gap-2 mb-2",children:["日","一","二","三","四","五","六"].map(t=>e.jsx("div",{className:"text-center text-sm text-gray-600 font-semibold",children:t},t))}),e.jsx("div",{className:"grid grid-cols-7 gap-2",children:(()=>{const t=(s=i,new Date(s.getFullYear(),s.getMonth()+1,0).getDate());var s;const a=(e=>new Date(e.getFullYear(),e.getMonth(),1).getDay())(i),r=i.getFullYear(),l=i.getMonth(),n=[],c=new Date,o=r===c.getFullYear()&&l===c.getMonth();for(let i=0;i<a;i++)n.push(e.jsx("div",{className:"aspect-square"},`empty-${i}`));for(let i=1;i<=t;i++){const t=`${r}-${String(l+1).padStart(2,"0")}-${String(i).padStart(2,"0")}`,s=v(r,l,i),a=o&&i===c.getDate(),d=s.length>0;n.push(e.jsxs("div",{className:"aspect-square flex flex-col items-center justify-center rounded-lg cursor-pointer transition-all "+(a?"bg-blue-500 text-white font-bold":d?"glass-card border-2 border-pink-400 font-semibold":"glass-card hover:scale-105"),onClick:()=>{d&&u(t)},children:[e.jsx("span",{className:"text-sm",children:i}),d&&e.jsx("div",{className:"flex gap-0.5 mt-1",children:s.slice(0,3).map((t,s)=>e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-pink-500"},s))})]},i))}return n})()}),x.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-3",children:"即将到来的纪念日"}),e.jsx("div",{className:"space-y-2",children:x.filter(e=>ot(e.date)>=0).slice(0,5).map(t=>{const s=ot(t.date);return e.jsx("div",{className:"glass-card rounded-xl p-3 border border-white/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-900",children:t.title}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:t.date})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"text-sm font-bold "+(0===s?"text-pink-500":"text-gray-700"),children:0===s?"今天":`${s}天后`})})]})},t.id)})})]})]}),h&&y.length>0&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm",onClick:()=>u(null)}),e.jsxs("div",{className:"relative w-full max-w-sm glass-card rounded-3xl p-6 shadow-2xl border border-white/20",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4 text-center",children:h}),e.jsx("div",{className:"space-y-3 mb-4",children:y.map(t=>e.jsxs("div",{className:"glass-card rounded-xl p-4 border border-white/20",children:[e.jsx("div",{className:"font-bold text-gray-900 mb-1",children:t.title}),t.description&&e.jsx("div",{className:"text-sm text-gray-600",children:t.description}),e.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:[t.characterName," 创建"]})]},t.id))}),e.jsx("button",{onClick:()=>u(null),className:"w-full px-4 py-3 rounded-full glass-card border border-white/20 text-gray-900 font-medium ios-button",children:"关闭"})]})]})]})]})}},Symbol.toStringTag,{value:"Module"})),ol=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{var a,l,i;const c=s(),{showStatusBar:d}=o(),{characters:x}=n(),{getAIStatus:m,getTodayTrack:h}=v(),{characterId:u}=r(),g=x.find(e=>e.id===u)||x[0],p=m((null==g?void 0:g.id)||""),f=h((null==g?void 0:g.id)||""),[b,j]=t.useState(null);t.useEffect(()=>{const e=()=>{const e=localStorage.getItem(`life_config_${null==g?void 0:g.id}`);e&&j(JSON.parse(e))};e();const t=()=>e();return window.addEventListener("lifeConfigUpdate",t),()=>window.removeEventListener("lifeConfigUpdate",t)},[null==g?void 0:g.id]);const y=e=>{if(0===e)return"刚到";const t=Math.floor(e/60),s=e%60;return t>0?s>0?`${t}小时${s}分钟`:`${t}小时`:`${s}分钟`};return e.jsxs("div",{className:"h-full flex flex-col relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 z-0 bg-gradient-to-b from-blue-50 to-white"}),e.jsxs("div",{className:"relative z-10 h-full flex flex-col",children:[e.jsxs("div",{className:"glass-effect sticky top-0 z-50",children:[d&&e.jsx(xa,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center",children:[e.jsx("button",{onClick:()=>c(-1),className:"w-10 h-10 rounded-full glass-card flex items-center justify-center ios-button",children:e.jsx(ls,{size:20,className:"text-gray-700"})}),e.jsx("div",{className:"flex-1 text-center",children:e.jsxs("h1",{className:"text-lg font-semibold text-gray-900",children:[null==g?void 0:g.name,"的足迹"]})}),e.jsx("button",{onClick:()=>c(`/life-settings/${null==g?void 0:g.id}`),className:"w-10 h-10 rounded-full glass-card flex items-center justify-center ios-button",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M12 15l9-9-9-9m0 18l-9-9 9-9"}),e.jsx("circle",{cx:"12",cy:"12",r:"3"}),e.jsx("path",{d:"M12 1v6m0 6v6m6-6h6m-6 0H6"})]})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar pb-6",children:[e.jsx("div",{className:"px-4 pt-4 pb-6",children:e.jsxs("div",{className:"glass-card rounded-3xl p-6 text-center",children:[e.jsx("img",{src:null==g?void 0:g.avatar,alt:null==g?void 0:g.name,className:"w-24 h-24 rounded-full mx-auto mb-4 border-4 border-white shadow-lg"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 mb-2",children:null==g?void 0:g.name}),e.jsx("div",{className:"text-sm text-gray-500",children:p.mood})]})}),e.jsx("div",{className:"px-4 mb-6",children:e.jsxs("div",{className:"glass-card rounded-3xl p-6",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4",children:"实时状态"}),e.jsxs("div",{className:"flex items-start gap-3 mb-4 pb-4 border-b border-gray-100",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl glass-card flex items-center justify-center flex-shrink-0",children:e.jsx(_s,{size:20,className:"text-blue-500"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"当前位置"}),e.jsx("div",{className:"text-base font-semibold text-gray-900",children:p.location}),e.jsx("div",{className:"text-xs text-blue-500 mt-1",children:p.activity})]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4 pb-4 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl glass-card flex items-center justify-center",children:e.jsx("div",{className:"w-3 h-3 rounded-full "+(p.isOnline?"bg-green-500":"bg-gray-400")})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"手机状态"}),e.jsx("div",{className:"text-base font-semibold text-gray-900",children:p.screenOn?"屏幕亮着":"息屏中"})]})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["正在使用: ",p.currentApp]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4 pb-4 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl glass-card flex items-center justify-center",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[e.jsx("rect",{x:"4",y:"7",width:"13",height:"11",rx:"2",stroke:"currentColor",strokeWidth:"2",className:p.battery<20?"text-red-500":"text-green-500"}),e.jsx("rect",{x:"6",y:"9",width:""+p.battery/100*9,height:"7",rx:"1",fill:"currentColor",className:p.battery<20?"text-red-500":"text-green-500"}),e.jsx("path",{d:"M17 10v5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",className:"text-gray-400"})]})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"手机电量"}),e.jsxs("div",{className:"text-base font-semibold text-gray-900",children:[p.battery,"%"]})]})]}),p.isCharging&&e.jsxs("div",{className:"text-xs text-green-500 flex items-center gap-1",children:[e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M13 2L3 14h8l-1 8 10-12h-8l1-8z"})}),"充电中"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl glass-card flex items-center justify-center",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M14 16c0 1.1.9 2 2 2s2-.9 2-2-.9-2-2-2-2 .9-2 2zM6 16c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2z"})})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"今日步数"}),e.jsxs("div",{className:"text-base font-semibold text-gray-900",children:[p.steps.toLocaleString()," 步"]})]})]})]})}),e.jsx("div",{className:"px-4 mb-6",children:e.jsxs("div",{className:"glass-card rounded-3xl p-6",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4",children:"今日轨迹"}),e.jsx("div",{className:"space-y-4",children:f.map((t,s)=>e.jsxs("div",{className:"flex items-start gap-3 relative",children:[s<f.length-1&&e.jsx("div",{className:"absolute left-6 top-12 w-0.5 h-16 bg-gradient-to-b from-blue-300 to-transparent"}),e.jsx("div",{className:"w-16 text-sm text-gray-500 pt-2",children:t.time}),e.jsx("div",{className:"w-4 h-4 rounded-full flex-shrink-0 mt-2 "+(s===f.length-1?"bg-blue-500 ring-4 ring-blue-100":"bg-gray-300")}),e.jsxs("div",{className:"flex-1 glass-card rounded-2xl p-4",children:[e.jsx("div",{className:"font-semibold text-gray-900 mb-1",children:t.location}),e.jsx("div",{className:"text-sm text-gray-500",children:t.activity}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["停留 ",y(t.duration)]})]})]},t.id))})]})}),e.jsx("div",{className:"px-4 mb-6",children:e.jsxs("div",{className:"glass-card rounded-3xl p-6",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4",children:"作息规律"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"通常起床时间"}),e.jsx("div",{className:"text-base font-semibold text-gray-900",children:(null==(a=null==b?void 0:b.routineTime)?void 0:a.wakeUp)||"07:30"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"通常睡觉时间"}),e.jsx("div",{className:"text-base font-semibold text-gray-900",children:(null==(l=null==b?void 0:b.routineTime)?void 0:l.sleep)||"23:00"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"午餐时间"}),e.jsx("div",{className:"text-base font-semibold text-gray-900",children:(null==(i=null==b?void 0:b.routineTime)?void 0:i.lunch)||"12:00"})]})]})]})}),e.jsx("div",{className:"px-4",children:e.jsxs("div",{className:"glass-card rounded-3xl p-6",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4",children:"常去地点"}),e.jsx("div",{className:"space-y-3",children:((null==b?void 0:b.frequentPlaces)||[{name:"家",address:"杨浦区某某路123号",frequency:"每天"},{name:"公司",address:"浦东新区陆家嘴金融中心",frequency:"工作日"},{name:"星巴克",address:"五角场万达广场",frequency:"周2-3次"},{name:"健身房",address:"附近健身中心",frequency:"周2次"}]).map((t,s)=>e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-xl bg-white/50",children:[e.jsx(_s,{size:20,className:"text-blue-500 mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-900",children:t.name}),e.jsx("div",{className:"text-xs text-gray-500",children:t.address})]}),e.jsx("div",{className:"text-xs text-gray-400",children:t.frequency})]},s))})]})})]})]})]})}},Symbol.toStringTag,{value:"Module"})),dl=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),[l,n]=t.useState(""),[i,c]=t.useState("all"),[d,x]=t.useState([]),[m,h]=t.useState(!1),[u,g]=t.useState({meme:"",meaning:"",keywords:""});t.useEffect(()=>{p()},[]);const p=()=>{const e=localStorage.getItem("custom_memes");if(e)try{x(JSON.parse(e))}catch(t){}},f=e=>{localStorage.setItem("custom_memes",JSON.stringify(e)),x(e)},b=()=>[...pt,...d],j=(()=>{let e=b();if(l){const t=l.toLowerCase();e=e.filter(e=>e.梗.toLowerCase().includes(t)||e.含义.toLowerCase().includes(t)||e.keywords.some(e=>e.toLowerCase().includes(t)))}return"all"!==i&&(e=e.filter(e=>e.keywords.some(e=>e.includes(i)))),e})(),v=b().map(e=>({...e,usageCount:gt(e.id)})).filter(e=>e.usageCount>0).sort((e,t)=>t.usageCount-e.usageCount).slice(0,5),y=(()=>{const e=new Set;return b().forEach(t=>{t.keywords.forEach(t=>{t.length<=4&&e.add(t)})}),Array.from(e).slice(0,20)})();return e.jsxs("div",{className:"h-full flex flex-col bg-gray-50",children:[r&&e.jsx(xa,{}),e.jsxs("div",{className:"glass-effect px-4 py-3 border-b border-gray-200/50 flex items-center",children:[e.jsx("button",{onClick:()=>a(-1),className:"w-8 h-8 flex items-center justify-center ios-button",children:e.jsx("span",{className:"text-blue-500 text-xl",children:"‹"})}),e.jsx("h1",{className:"flex-1 text-center text-lg font-semibold text-gray-900",children:"热梗库"}),e.jsx("button",{onClick:()=>h(!0),className:"w-8 h-8 flex items-center justify-center ios-button",children:e.jsx("span",{className:"text-blue-500 text-xl",children:"+"})})]}),e.jsx("div",{className:"px-4 pt-4 pb-3",children:e.jsxs("div",{className:"glass-card rounded-2xl px-4 py-3.5 flex items-center",children:[e.jsxs("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("path",{d:"m21 21-4.35-4.35"})]}),e.jsx("input",{type:"text",placeholder:"搜索热梗、含义或关键词",value:l,onChange:e=>n(e.target.value),className:"flex-1 ml-3 bg-transparent border-none outline-none text-sm text-gray-900 placeholder-gray-400"}),l&&e.jsx("button",{onClick:()=>n(""),className:"text-gray-400 text-lg ios-button",children:"✕"})]})}),v.length>0&&!l&&e.jsxs("div",{className:"px-4 pb-3",children:[e.jsx("div",{className:"text-xs font-bold text-gray-600 mb-2.5 px-1",children:"最常使用"}),e.jsx("div",{className:"flex gap-2.5 overflow-x-auto hide-scrollbar",children:v.map(t=>e.jsxs("div",{className:"flex-shrink-0 glass-card rounded-xl px-4 py-3 border border-orange-200/30",children:[e.jsx("div",{className:"text-sm font-bold text-gray-900 whitespace-nowrap mb-1",children:t.梗}),e.jsxs("div",{className:"text-xs text-orange-600 font-medium",children:["使用 ",t.usageCount," 次"]})]},t.id))})]}),e.jsx("div",{className:"px-4 pb-3",children:e.jsxs("div",{className:"flex gap-2 overflow-x-auto hide-scrollbar",children:[e.jsx("button",{onClick:()=>c("all"),className:"flex-shrink-0 px-4 py-2.5 rounded-xl text-sm font-semibold transition-all "+("all"===i?"glass-card text-blue-600 shadow-sm":"bg-white/50 text-gray-600"),children:"全部"}),y.map(t=>e.jsx("button",{onClick:()=>c(t),className:"flex-shrink-0 px-4 py-2.5 rounded-xl text-sm font-semibold transition-all "+(i===t?"glass-card text-blue-600 shadow-sm":"bg-white/50 text-gray-600"),children:t},t))]})}),e.jsx("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-4 pb-4",children:0===j.length?e.jsx("div",{className:"glass-card rounded-2xl p-8 text-center",children:e.jsx("div",{className:"text-gray-500 text-sm",children:"没有找到相关热梗"})}):e.jsxs("div",{className:"space-y-2",children:[j.map(t=>{const s=gt(t.id),a=(r=t.id,d.some(e=>e.id===r));var r;return e.jsxs("div",{className:"glass-card rounded-2xl p-5",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:t.梗}),a&&e.jsx("span",{className:"px-2.5 py-0.5 bg-green-100 text-green-700 text-xs rounded-lg font-medium",children:"自定义"})]}),e.jsx("p",{className:"text-sm text-gray-600 leading-relaxed",children:t.含义})]}),a&&e.jsx("button",{onClick:()=>(e=>{confirm("确定要删除这个热梗吗？")&&f(d.filter(t=>t.id!==e))})(t.id),className:"ml-3 text-red-500 text-sm ios-button font-medium",children:"删除"})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-3 border-t border-gray-100",children:[e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[t.keywords.slice(0,5).map((t,s)=>e.jsx("span",{className:"px-2.5 py-1 bg-blue-50 text-blue-600 text-xs rounded-lg font-medium",children:t},s)),t.keywords.length>5&&e.jsxs("span",{className:"px-2 py-1 text-gray-400 text-xs",children:["+",t.keywords.length-5]})]}),s>0&&e.jsxs("div",{className:"text-xs text-gray-500 font-medium ml-2",children:["使用 ",s," 次"]})]})]},t.id)}),e.jsxs("div",{className:"text-center py-4 text-xs text-gray-400",children:["共 ",j.length," 个热梗"]})]})}),m&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"glass-card rounded-3xl p-6 w-full max-w-md",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4",children:"添加自定义热梗"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"热梗内容"}),e.jsx("input",{type:"text",value:u.meme,onChange:e=>g({...u,meme:e.target.value}),placeholder:"例如：尊嘟假嘟",className:"w-full glass-card rounded-xl px-4 py-3 text-sm text-gray-900 border-none outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"含义说明"}),e.jsx("textarea",{value:u.meaning,onChange:e=>g({...u,meaning:e.target.value}),placeholder:"例如：真的假的",rows:3,className:"w-full glass-card rounded-xl px-4 py-3 text-sm text-gray-900 border-none outline-none resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"关键词（用逗号分隔）"}),e.jsx("input",{type:"text",value:u.keywords,onChange:e=>g({...u,keywords:e.target.value}),placeholder:"例如：真的假的,尊嘟假嘟,震惊",className:"w-full glass-card rounded-xl px-4 py-3 text-sm text-gray-900 border-none outline-none"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>{h(!1),g({meme:"",meaning:"",keywords:""})},className:"flex-1 glass-card rounded-xl py-3 text-sm font-medium text-gray-700 ios-button",children:"取消"}),e.jsx("button",{onClick:()=>{if(!u.meme||!u.meaning||!u.keywords)return void alert("请填写完整信息");const e=u.keywords.split(/[,，\s]+/).filter(e=>e.trim()),t={id:Math.max(...b().map(e=>e.id),0)+1,"梗":u.meme,"含义":u.meaning,keywords:e};f([...d,t]),g({meme:"",meaning:"",keywords:""}),h(!1)},className:"flex-1 bg-blue-500 text-white rounded-xl py-3 text-sm font-medium ios-button",children:"添加"})]})]})})]})}},Symbol.toStringTag,{value:"Module"})),xl=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),[l,n]=t.useState(null),[i,c]=t.useState(null),[d,x]=t.useState("#95EC69"),[m,h]=t.useState("#FFFFFF"),u=[{id:"glass",name:"高级玻璃",description:"毛玻璃效果",userCSS:".message-container.sent .message-bubble {\n  background: linear-gradient(135deg, rgba(149, 236, 105, 0.95) 0%, rgba(120, 220, 80, 0.95) 100%) !important;\n  backdrop-filter: blur(20px) saturate(180%) !important;\n  -webkit-backdrop-filter: blur(20px) saturate(180%) !important;\n  border: 1.5px solid rgba(255, 255, 255, 0.6) !important;\n  box-shadow: \n    0 8px 32px rgba(149, 236, 105, 0.3),\n    inset 0 1px 0 rgba(255, 255, 255, 0.8),\n    inset 0 -1px 0 rgba(0, 0, 0, 0.1) !important;\n  border-radius: 18px !important;\n  position: relative !important;\n}\n.message-container.sent .message-bubble::before {\n  content: '' !important;\n  position: absolute !important;\n  top: 0 !important;\n  left: 0 !important;\n  right: 0 !important;\n  height: 50% !important;\n  background: linear-gradient(180deg, rgba(255, 255, 255, 0.3) 0%, transparent 100%) !important;\n  border-radius: 18px 18px 0 0 !important;\n  pointer-events: none !important;\n}",aiCSS:".message-container.received .message-bubble {\n  background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(245, 245, 250, 0.95) 100%) !important;\n  backdrop-filter: blur(20px) saturate(180%) !important;\n  -webkit-backdrop-filter: blur(20px) saturate(180%) !important;\n  border: 1.5px solid rgba(200, 200, 220, 0.4) !important;\n  box-shadow: \n    0 8px 32px rgba(0, 0, 0, 0.08),\n    inset 0 1px 0 rgba(255, 255, 255, 0.9),\n    inset 0 -1px 0 rgba(0, 0, 0, 0.05) !important;\n  border-radius: 18px !important;\n  position: relative !important;\n}\n.message-container.received .message-bubble::before {\n  content: '' !important;\n  position: absolute !important;\n  top: 0 !important;\n  left: 0 !important;\n  right: 0 !important;\n  height: 50% !important;\n  background: linear-gradient(180deg, rgba(255, 255, 255, 0.4) 0%, transparent 100%) !important;\n  border-radius: 18px 18px 0 0 !important;\n  pointer-events: none !important;\n}",preview:{user:{background:"linear-gradient(135deg, rgba(149, 236, 105, 0.95) 0%, rgba(120, 220, 80, 0.95) 100%)",backdropFilter:"blur(20px) saturate(180%)",border:"1.5px solid rgba(255, 255, 255, 0.6)",boxShadow:"0 8px 32px rgba(149, 236, 105, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.8)"},ai:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(245, 245, 250, 0.95) 100%)",backdropFilter:"blur(20px) saturate(180%)",border:"1.5px solid rgba(200, 200, 220, 0.4)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.08), inset 0 1px 0 rgba(255, 255, 255, 0.9)"}}},{id:"clay",name:"3D粘土",description:"立体效果",userCSS:".message-container.sent .message-bubble {\n  background: linear-gradient(145deg, #E8F5E9 0%, #C8E6C9 50%, #F1F8E9 100%) !important;\n  border-radius: 22px !important;\n  box-shadow: \n    0 2px 4px rgba(129, 199, 132, 0.3),\n    0 8px 16px rgba(129, 199, 132, 0.25),\n    0 16px 32px rgba(100, 180, 100, 0.15),\n    inset 0 2px 4px rgba(255, 255, 255, 0.8),\n    inset 0 -3px 8px rgba(100, 180, 100, 0.2) !important;\n  border: 2px solid rgba(255, 255, 255, 0.7) !important;\n  padding: 14px 18px !important;\n  position: relative !important;\n  transform: translateZ(0) !important;\n}\n.message-container.sent .message-bubble::after {\n  content: '' !important;\n  position: absolute !important;\n  top: 3px !important;\n  left: 3px !important;\n  right: 3px !important;\n  height: 40% !important;\n  background: linear-gradient(180deg, rgba(255, 255, 255, 0.4) 0%, transparent 100%) !important;\n  border-radius: 20px 20px 0 0 !important;\n  pointer-events: none !important;\n}",aiCSS:".message-container.received .message-bubble {\n  background: linear-gradient(145deg, #E3F2FD 0%, #BBDEFB 50%, #E1F5FE 100%) !important;\n  border-radius: 22px !important;\n  box-shadow: \n    0 2px 4px rgba(100, 181, 246, 0.3),\n    0 8px 16px rgba(100, 181, 246, 0.25),\n    0 16px 32px rgba(66, 165, 245, 0.15),\n    inset 0 2px 4px rgba(255, 255, 255, 0.8),\n    inset 0 -3px 8px rgba(66, 165, 245, 0.2) !important;\n  border: 2px solid rgba(255, 255, 255, 0.7) !important;\n  padding: 14px 18px !important;\n  position: relative !important;\n  transform: translateZ(0) !important;\n}\n.message-container.received .message-bubble::after {\n  content: '' !important;\n  position: absolute !important;\n  top: 3px !important;\n  left: 3px !important;\n  right: 3px !important;\n  height: 40% !important;\n  background: linear-gradient(180deg, rgba(255, 255, 255, 0.4) 0%, transparent 100%) !important;\n  border-radius: 20px 20px 0 0 !important;\n  pointer-events: none !important;\n}",preview:{user:{background:"linear-gradient(145deg, #E8F5E9 0%, #C8E6C9 50%, #F1F8E9 100%)",boxShadow:"0 2px 4px rgba(129, 199, 132, 0.3), 0 8px 16px rgba(129, 199, 132, 0.25), inset 0 2px 4px rgba(255, 255, 255, 0.8)",border:"2px solid rgba(255, 255, 255, 0.7)",padding:"14px 18px"},ai:{background:"linear-gradient(145deg, #E3F2FD 0%, #BBDEFB 50%, #E1F5FE 100%)",boxShadow:"0 2px 4px rgba(100, 181, 246, 0.3), 0 8px 16px rgba(100, 181, 246, 0.25), inset 0 2px 4px rgba(255, 255, 255, 0.8)",border:"2px solid rgba(255, 255, 255, 0.7)",padding:"14px 18px"}}},{id:"feather",name:"梦幻光晕",description:"发光效果",userCSS:".message-container.sent .message-bubble {\n  background: \n    radial-gradient(circle at 30% 30%, rgba(255, 240, 248, 1) 0%, transparent 70%),\n    linear-gradient(135deg, #FFD6E8 0%, #FFE5F0 50%, #FFF0F8 100%) !important;\n  border: 0 !important;\n  box-shadow: \n    0 0 1px rgba(255, 182, 217, 0.3),\n    0 2px 8px rgba(255, 182, 217, 0.2),\n    0 8px 24px rgba(255, 182, 217, 0.3),\n    0 16px 48px rgba(255, 150, 200, 0.2),\n    inset 0 1px 2px rgba(255, 255, 255, 0.8) !important;\n  border-radius: 26px !important;\n  padding: 14px 18px !important;\n  position: relative !important;\n  overflow: visible !important;\n}\n.message-container.sent .message-bubble::before {\n  content: '' !important;\n  position: absolute !important;\n  inset: -8px !important;\n  background: radial-gradient(circle, rgba(255, 182, 217, 0.15) 0%, transparent 70%) !important;\n  border-radius: 34px !important;\n  pointer-events: none !important;\n  z-index: -1 !important;\n}",aiCSS:".message-container.received .message-bubble {\n  background: \n    radial-gradient(circle at 30% 30%, rgba(240, 248, 255, 1) 0%, transparent 70%),\n    linear-gradient(135deg, #D6E8FF 0%, #E5F5FF 50%, #F0F8FF 100%) !important;\n  border: 0 !important;\n  box-shadow: \n    0 0 1px rgba(182, 217, 255, 0.3),\n    0 2px 8px rgba(182, 217, 255, 0.2),\n    0 8px 24px rgba(182, 217, 255, 0.3),\n    0 16px 48px rgba(150, 200, 255, 0.2),\n    inset 0 1px 2px rgba(255, 255, 255, 0.8) !important;\n  border-radius: 26px !important;\n  padding: 14px 18px !important;\n  position: relative !important;\n  overflow: visible !important;\n}\n.message-container.received .message-bubble::before {\n  content: '' !important;\n  position: absolute !important;\n  inset: -8px !important;\n  background: radial-gradient(circle, rgba(182, 217, 255, 0.15) 0%, transparent 70%) !important;\n  border-radius: 34px !important;\n  pointer-events: none !important;\n  z-index: -1 !important;\n}",preview:{user:{background:"linear-gradient(135deg, #FFD6E8 0%, #FFE5F0 50%, #FFF0F8 100%)",boxShadow:"0 0 1px rgba(255, 182, 217, 0.3), 0 2px 8px rgba(255, 182, 217, 0.2), 0 8px 24px rgba(255, 182, 217, 0.3)",padding:"14px 18px"},ai:{background:"linear-gradient(135deg, #D6E8FF 0%, #E5F5FF 50%, #F0F8FF 100%)",boxShadow:"0 0 1px rgba(182, 217, 255, 0.3), 0 2px 8px rgba(182, 217, 255, 0.2), 0 8px 24px rgba(182, 217, 255, 0.3)",padding:"14px 18px"}}},{id:"soft",name:"云雾扩散",description:"软边界效果",userCSS:".message-container.sent .message-bubble {\n  position: relative !important;\n  border: 0 !important;\n  outline: 0 !important;\n  background: \n    radial-gradient(ellipse at center, rgba(255, 248, 225, 0.95) 0%, rgba(255, 245, 225, 0.8) 50%, rgba(255, 240, 220, 0.5) 80%, transparent 100%) !important;\n  box-shadow: \n    0 0 0 6px rgba(255, 245, 225, 0.35),\n    0 0 0 12px rgba(255, 240, 220, 0.18),\n    0 2px 12px rgba(255, 230, 200, 0.25) !important;\n  border-radius: 18px !important;\n  padding: 14px 18px !important;\n  overflow: visible !important;\n}",aiCSS:".message-container.received .message-bubble {\n  position: relative !important;\n  border: 0 !important;\n  outline: 0 !important;\n  background: \n    radial-gradient(ellipse at center, rgba(240, 248, 255, 0.95) 0%, rgba(235, 245, 255, 0.8) 50%, rgba(225, 240, 255, 0.5) 80%, transparent 100%) !important;\n  box-shadow: \n    0 0 0 6px rgba(240, 248, 255, 0.35),\n    0 0 0 12px rgba(225, 240, 255, 0.18),\n    0 2px 12px rgba(200, 230, 255, 0.25) !important;\n  border-radius: 18px !important;\n  padding: 14px 18px !important;\n  overflow: visible !important;\n}",preview:{user:{background:"radial-gradient(ellipse at center, rgba(255, 248, 225, 0.95) 0%, rgba(255, 245, 225, 0.8) 50%, rgba(255, 240, 220, 0.5) 80%, transparent 100%)",boxShadow:"0 0 0 6px rgba(255, 245, 225, 0.35), 0 0 0 12px rgba(255, 240, 220, 0.18)",padding:"14px 18px",borderRadius:"18px"},ai:{background:"radial-gradient(ellipse at center, rgba(240, 248, 255, 0.95) 0%, rgba(235, 245, 255, 0.8) 50%, rgba(225, 240, 255, 0.5) 80%, transparent 100%)",boxShadow:"0 0 0 6px rgba(240, 248, 255, 0.35), 0 0 0 12px rgba(225, 240, 255, 0.18)",padding:"14px 18px",borderRadius:"18px"}}},{id:"water",name:"水滴气泡",description:"透明效果",userCSS:".message-container.sent .message-bubble {\n  background: \n    linear-gradient(180deg, rgba(255, 255, 255, 0.02) 0%, rgba(255, 255, 255, 0.03) 30%, rgba(149, 236, 105, 0.15) 100%),\n    radial-gradient(circle at 30% 20%, rgba(255, 255, 255, 0.6) 0%, transparent 40%) !important;\n  border: 1px solid rgba(255, 255, 255, 0.25) !important;\n  border-radius: 20px !important;\n  padding: 12px 16px !important;\n  position: relative !important;\n  box-shadow: \n    0 4px 15px rgba(149, 236, 105, 0.08),\n    inset 0 1px 3px rgba(255, 255, 255, 0.9),\n    inset 0 -2px 4px rgba(149, 236, 105, 0.15) !important;\n  backdrop-filter: blur(16px) saturate(180%) !important;\n  -webkit-backdrop-filter: blur(16px) saturate(180%) !important;\n}\n.message-container.sent .message-bubble::before {\n  content: '' !important;\n  position: absolute !important;\n  top: 8px !important;\n  left: 10px !important;\n  width: 20px !important;\n  height: 20px !important;\n  background: radial-gradient(circle at 40% 40%, rgba(255, 255, 255, 0.9) 0%, transparent 70%) !important;\n  border-radius: 50% !important;\n  pointer-events: none !important;\n}\n.message-container.sent .message-bubble::after {\n  content: '' !important;\n  position: absolute !important;\n  bottom: 10px !important;\n  right: 12px !important;\n  width: 12px !important;\n  height: 12px !important;\n  background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.7) 0%, transparent 70%) !important;\n  border-radius: 50% !important;\n  pointer-events: none !important;\n}",aiCSS:".message-container.received .message-bubble {\n  background: \n    linear-gradient(180deg, rgba(255, 255, 255, 0.02) 0%, rgba(255, 255, 255, 0.03) 30%, rgba(200, 230, 255, 0.15) 100%),\n    radial-gradient(circle at 30% 20%, rgba(255, 255, 255, 0.6) 0%, transparent 40%) !important;\n  border: 1px solid rgba(255, 255, 255, 0.25) !important;\n  border-radius: 20px !important;\n  padding: 12px 16px !important;\n  position: relative !important;\n  box-shadow: \n    0 4px 15px rgba(100, 150, 200, 0.08),\n    inset 0 1px 3px rgba(255, 255, 255, 0.9),\n    inset 0 -2px 4px rgba(200, 230, 255, 0.15) !important;\n  backdrop-filter: blur(16px) saturate(180%) !important;\n  -webkit-backdrop-filter: blur(16px) saturate(180%) !important;\n}\n.message-container.received .message-bubble::before {\n  content: '' !important;\n  position: absolute !important;\n  top: 8px !important;\n  left: 10px !important;\n  width: 20px !important;\n  height: 20px !important;\n  background: radial-gradient(circle at 40% 40%, rgba(255, 255, 255, 0.95) 0%, transparent 70%) !important;\n  border-radius: 50% !important;\n  pointer-events: none !important;\n}\n.message-container.received .message-bubble::after {\n  content: '' !important;\n  position: absolute !important;\n  bottom: 10px !important;\n  right: 12px !important;\n  width: 12px !important;\n  height: 12px !important;\n  background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.8) 0%, transparent 70%) !important;\n  border-radius: 50% !important;\n  pointer-events: none !important;\n}",preview:{user:{background:"linear-gradient(180deg, rgba(255, 255, 255, 0.02) 0%, rgba(255, 255, 255, 0.03) 30%, rgba(149, 236, 105, 0.15) 100%)",border:"1px solid rgba(255, 255, 255, 0.25)",boxShadow:"0 4px 15px rgba(149, 236, 105, 0.08), inset 0 1px 3px rgba(255, 255, 255, 0.9)",backdropFilter:"blur(16px)",padding:"12px 16px"},ai:{background:"linear-gradient(180deg, rgba(255, 255, 255, 0.02) 0%, rgba(255, 255, 255, 0.03) 30%, rgba(200, 230, 255, 0.15) 100%)",border:"1px solid rgba(255, 255, 255, 0.25)",boxShadow:"0 4px 15px rgba(100, 150, 200, 0.08), inset 0 1px 3px rgba(255, 255, 255, 0.9)",backdropFilter:"blur(16px)",padding:"12px 16px"}}},{id:"glass-dome",name:"玻璃罩",description:"圆形效果",userCSS:".message-container.sent .message-bubble {\n  background: transparent !important;\n  border: 2px solid rgba(255, 255, 255, 0.3) !important;\n  border-radius: 24px !important;\n  padding: 14px 20px !important;\n  position: relative !important;\n  box-shadow: \n    0 8px 32px rgba(0, 0, 0, 0.08),\n    0 4px 16px rgba(0, 0, 0, 0.04),\n    inset 0 1px 0 rgba(255, 255, 255, 0.6),\n    inset 0 -1px 0 rgba(0, 0, 0, 0.05) !important;\n  backdrop-filter: blur(10px) !important;\n  -webkit-backdrop-filter: blur(10px) !important;\n  overflow: hidden !important;\n}\n.message-container.sent .message-bubble::before {\n  content: '' !important;\n  position: absolute !important;\n  top: 0 !important;\n  left: 0 !important;\n  right: 0 !important;\n  height: 50% !important;\n  background: linear-gradient(180deg, rgba(255, 255, 255, 0.1) 0%, transparent 100%) !important;\n  pointer-events: none !important;\n}\n.message-container.sent .message-bubble::after {\n  content: '' !important;\n  position: absolute !important;\n  top: 8px !important;\n  left: 12px !important;\n  width: 50px !important;\n  height: 50px !important;\n  background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.3) 0%, transparent 70%) !important;\n  border-radius: 50% !important;\n  pointer-events: none !important;\n}",aiCSS:".message-container.received .message-bubble {\n  background: transparent !important;\n  border: 2px solid rgba(255, 255, 255, 0.3) !important;\n  border-radius: 24px !important;\n  padding: 14px 20px !important;\n  position: relative !important;\n  box-shadow: \n    0 8px 32px rgba(0, 0, 0, 0.08),\n    0 4px 16px rgba(0, 0, 0, 0.04),\n    inset 0 1px 0 rgba(255, 255, 255, 0.6),\n    inset 0 -1px 0 rgba(0, 0, 0, 0.05) !important;\n  backdrop-filter: blur(10px) !important;\n  -webkit-backdrop-filter: blur(10px) !important;\n  overflow: hidden !important;\n}\n.message-container.received .message-bubble::before {\n  content: '' !important;\n  position: absolute !important;\n  top: 0 !important;\n  left: 0 !important;\n  right: 0 !important;\n  height: 50% !important;\n  background: linear-gradient(180deg, rgba(255, 255, 255, 0.1) 0%, transparent 100%) !important;\n  pointer-events: none !important;\n}\n.message-container.received .message-bubble::after {\n  content: '' !important;\n  position: absolute !important;\n  top: 8px !important;\n  left: 12px !important;\n  width: 50px !important;\n  height: 50px !important;\n  background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.3) 0%, transparent 70%) !important;\n  border-radius: 50% !important;\n  pointer-events: none !important;\n}",preview:{user:{background:"transparent",border:"2px solid rgba(255, 255, 255, 0.3)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.08), inset 0 1px 0 rgba(255, 255, 255, 0.6)",backdropFilter:"blur(10px)",borderRadius:"24px",padding:"14px 20px"},ai:{background:"transparent",border:"2px solid rgba(255, 255, 255, 0.3)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.08), inset 0 1px 0 rgba(255, 255, 255, 0.6)",backdropFilter:"blur(10px)",borderRadius:"24px",padding:"14px 20px"}}}],g=()=>{c(null)},p=()=>{const e=u.find(e=>e.id===i);if(!e)return;const t=(e,t)=>{const s=(e=>{const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null})(t);if(!s)return e;let a=!1;return e=(e=e.replace(/(linear-gradient\([^)]*?)#[0-9A-Fa-f]{6}/i,(e,s)=>a?e:(a=!0,s+t))).replace(/(linear-gradient\([^)]*?)rgba?\((\d+),\s*(\d+),\s*(\d+),\s*([0-9.]+)\)/i,(e,t,r,l,n,i)=>a?e:(a=!0,`${t}rgba(${s.r}, ${s.g}, ${s.b}, ${i})`))},s=t(e.userCSS,d),a=t(e.aiCSS,m);localStorage.setItem("user_bubble_css",s),localStorage.setItem("ai_bubble_css",a),window.dispatchEvent(new Event("storage"));const r="custom-bubble-style";let l=document.getElementById(r);l||(l=document.createElement("style"),l.id=r,document.head.appendChild(l)),l.textContent=s+"\n"+a,c(null),alert(`✅ 已应用 ${e.name} 的自定义颜色！\n\n用户气泡: ${d}\nAI气泡: ${m}\n\n返回聊天页面即可看到效果`)};return e.jsxs("div",{className:"h-full flex flex-col bg-gray-50",children:[r&&e.jsx(xa,{}),e.jsxs("div",{className:"glass-effect px-4 py-3 border-b border-gray-200/50 flex items-center",children:[e.jsx("button",{onClick:()=>a(-1),className:"w-8 h-8 flex items-center justify-center ios-button",children:e.jsx("span",{className:"text-blue-500 text-xl",children:"‹"})}),e.jsx("h1",{className:"flex-1 text-center text-lg font-semibold text-gray-900",children:"气泡商店"}),e.jsx("div",{className:"w-8"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar p-4",children:[e.jsxs("div",{className:"glass-card rounded-2xl p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"})})}),e.jsx("h2",{className:"text-base font-semibold text-gray-900",children:"选择你喜欢的气泡样式"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:'点击"应用"按钮，气泡样式会应用到所有聊天（全局设置）'})]}),e.jsx("div",{className:"space-y-4",children:u.map(t=>{var s,a;return e.jsxs("div",{className:"glass-card rounded-2xl p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900 mb-1",children:t.name}),e.jsx("p",{className:"text-sm text-gray-500",children:t.description})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>(e=>{c(e.id);const t=e=>{const t=e.match(/background:\s*([#][0-9A-Fa-f]{6}|[#][0-9A-Fa-f]{3})/i);if(t)return t[1];const s=e.match(/linear-gradient\([^,]+,\s*([#][0-9A-Fa-f]{6})/i);if(s)return s[1];const a=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/i);return a?`#${parseInt(a[1]).toString(16).padStart(2,"0")}${parseInt(a[2]).toString(16).padStart(2,"0")}${parseInt(a[3]).toString(16).padStart(2,"0")}`:"#95EC69"};x(t(e.userCSS)),h(t(e.aiCSS))})(t),className:"px-3 py-2 rounded-xl font-medium text-sm bg-gray-200 text-gray-700 hover:bg-gray-300 transition-all",children:"编辑"}),e.jsx("button",{onClick:()=>(e=>{localStorage.setItem("user_bubble_css",e.userCSS),localStorage.setItem("ai_bubble_css",e.aiCSS),n(e.id),window.dispatchEvent(new Event("storage")),alert(`✅ 已应用 ${e.name}！\n\n所有聊天都会使用这个气泡样式。`)})(t),className:"px-4 py-2 rounded-xl font-medium text-sm transition-all "+(l===t.id?"bg-green-500 text-white":"bg-blue-500 text-white hover:bg-blue-600"),children:l===t.id?"已应用":"应用"})]})]}),i===t.id&&e.jsxs("div",{className:"mb-4 space-y-3 bg-white rounded-xl p-4 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"用户气泡颜色"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"color",value:d,onChange:e=>x(e.target.value),className:"w-16 h-10 rounded-lg border border-gray-300 cursor-pointer"}),e.jsx("input",{type:"text",value:d,onChange:e=>x(e.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm font-mono focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"#95EC69"})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"AI气泡颜色"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"color",value:m,onChange:e=>h(e.target.value),className:"w-16 h-10 rounded-lg border border-gray-300 cursor-pointer"}),e.jsx("input",{type:"text",value:m,onChange:e=>h(e.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm font-mono focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"#FFFFFF"})]})]})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:g,className:"px-4 py-2 rounded-xl font-medium text-sm bg-gray-200 text-gray-700 hover:bg-gray-300 transition-all",children:"取消"}),e.jsx("button",{onClick:p,className:"px-4 py-2 rounded-xl font-medium text-sm bg-green-500 text-white hover:bg-green-600 transition-all",children:"应用颜色"})]})]}),e.jsxs("div",{className:"space-y-3 bg-gradient-to-br from-gray-100 to-gray-50 rounded-xl p-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsx("div",{className:"px-3 py-2 rounded-xl text-sm max-w-[70%]",style:i===t.id?{...t.preview.user,background:(null==(s=t.preview.user.background)?void 0:s.includes("gradient"))?t.preview.user.background.replace(/#[0-9A-Fa-f]{6}/i,d):d}:t.preview.user,children:"我的消息"})}),e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"px-3 py-2 rounded-xl text-sm max-w-[70%]",style:i===t.id?{...t.preview.ai,background:(null==(a=t.preview.ai.background)?void 0:a.includes("gradient"))?t.preview.ai.background.replace(/#[0-9A-Fa-f]{6}/i,m):m}:t.preview.ai,children:"对方消息"})})]})]},t.id)})})]})]})}},Symbol.toStringTag,{value:"Module"})),ml=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),[l,n]=t.useState(()=>{const e=localStorage.getItem("custom_fonts");return e?JSON.parse(e):[]}),[i,c]=t.useState(()=>localStorage.getItem("chat_font_family")||"system"),[d,x]=t.useState(!1),[m,h]=t.useState(""),[u,g]=t.useState(""),[p,f]=t.useState(""),[b,j]=t.useState(!1),[v,y]=t.useState("你好，这是预览文字"),[N,w]=t.useState(!1),k=t.useRef(new Set),C=e=>{localStorage.setItem("custom_fonts",JSON.stringify(e)),n(e)},S=async e=>{if(k.current.has(e.id))return!0;try{if(Array.from(document.fonts).find(t=>t.family===e.fontFamily))return k.current.add(e.id),!0;const t=new FontFace(e.fontFamily,`url(${e.url})`,{display:"swap"}),s=t.load(),a=new Promise((e,t)=>{setTimeout(()=>t(new Error("字体加载超时")),1e4)});return await Promise.race([s,a]),document.fonts.add(t),k.current.add(e.id),!0}catch(t){return!1}},I=(e,t)=>{localStorage.setItem("chat_font_family",e),localStorage.setItem("chat_font_family_value",t),c(e),"system"===e?document.documentElement.style.removeProperty("--chat-font-family"):document.documentElement.style.setProperty("--chat-font-family",t),window.dispatchEvent(new Event("storage"))};return t.useEffect(()=>{(async()=>{if(0===l.length)return;w(!0);const e=l.map(e=>S(e));await Promise.all(e),w(!1)})();const e=localStorage.getItem("chat_font_family_value");e&&"system"!==i&&document.documentElement.style.setProperty("--chat-font-family",e)},[]),e.jsxs("div",{className:"h-full flex flex-col bg-[#f5f7fa]",children:[e.jsxs("div",{className:"glass-effect sticky top-0 z-50",children:[r&&e.jsx(xa,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a(-1),className:"ios-button text-gray-700 hover:text-gray-900 -ml-2",children:e.jsx("span",{className:"text-blue-500 text-2xl",children:"‹"})}),e.jsx("h1",{className:"text-base font-semibold text-gray-900 absolute left-1/2 transform -translate-x-1/2 pointer-events-none",children:"字体设置"}),e.jsx("button",{onClick:()=>x(!d),className:"text-blue-500 ios-button",children:e.jsx("span",{className:"text-2xl",children:d?"×":"+"})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar p-4",children:[N&&e.jsxs("div",{className:"glass-card rounded-2xl p-4 mb-4 flex items-center gap-3",children:[e.jsx("div",{className:"animate-spin w-5 h-5 border-2 border-blue-500 border-t-transparent rounded-full"}),e.jsx("span",{className:"text-sm text-gray-600",children:"正在加载字体..."})]}),d&&e.jsxs("div",{className:"glass-card rounded-2xl p-5 mb-4",children:[e.jsx("h3",{className:"font-bold text-gray-900 text-base mb-4",children:"添加自定义字体"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600 mb-1 block",children:"字体名称"}),e.jsx("input",{type:"text",value:m,onChange:e=>h(e.target.value),placeholder:"例如：我的字体",className:"w-full px-3 py-2 bg-white/50 border border-gray-200 rounded-xl outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600 mb-1 block",children:"字体链接（URL）"}),e.jsx("input",{type:"text",value:u,onChange:e=>g(e.target.value),placeholder:"https://example.com/font.woff2",className:"w-full px-3 py-2 bg-white/50 border border-gray-200 rounded-xl outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600 mb-1 block",children:"字体族名称（font-family）"}),e.jsx("input",{type:"text",value:p,onChange:e=>f(e.target.value),placeholder:"例如：MyCustomFont",className:"w-full px-3 py-2 bg-white/50 border border-gray-200 rounded-xl outline-none focus:ring-2 focus:ring-blue-500"})]}),p&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600 mb-1 block",children:"预览文字"}),e.jsx("input",{type:"text",value:v,onChange:e=>y(e.target.value),className:"w-full px-3 py-2 bg-white/50 border border-gray-200 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 mb-2"}),e.jsx("div",{className:"bg-white/50 rounded-xl p-4 border border-gray-200",children:e.jsx("div",{style:{fontFamily:p},className:"text-base",children:v})})]}),e.jsx("button",{onClick:async()=>{if(!m.trim()||!u.trim()||!p.trim())return void alert("请填写完整的字体信息");j(!0);const e=u.trim();try{let s=e,a=!1;const r={id:`custom_${Date.now()}`,name:m.trim(),url:s,fontFamily:p.trim(),createdAt:Date.now()};let n=await S(r);if(!n)try{const t=await fetch(e,{mode:"cors",credentials:"omit"});if(t.ok){const e=await t.blob(),l=URL.createObjectURL(e);r.url=l,s=l,a=!0,n=await S(r)}}catch(t){}if(n){const e=[...l,r];C(e),h(""),g(""),f(""),x(!1),alert("字体添加成功！")}else a&&URL.revokeObjectURL(s),alert("字体加载失败，请检查：\n\n1. 字体链接是否正确\n2. 网络连接是否正常\n3. 字体格式是否支持\n4. 服务器是否可访问")}catch(s){let e="添加字体失败：\n\n";s instanceof TypeError&&s.message.includes("Failed to fetch")?e+="⚠️ 网络连接失败\n\n可能原因：\n• 服务器暂时不可用\n• 网络连接问题\n• 防火墙/代理阻止\n• URL地址错误":s instanceof Error?e+=s.message:e+="未知错误",alert(e)}finally{j(!1)}},disabled:b||!m.trim()||!u.trim()||!p.trim(),className:"w-full py-3 bg-blue-500 text-white rounded-xl font-medium ios-button disabled:opacity-50 disabled:cursor-not-allowed",children:b?"加载中...":"添加字体"})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 rounded-xl",children:[e.jsx("p",{className:"text-xs text-blue-600 mb-2 font-semibold",children:"💡 使用提示："}),e.jsxs("ul",{className:"text-xs text-blue-600 space-y-1",children:[e.jsx("li",{children:"• 支持 .woff2, .woff, .ttf, .otf 格式"}),e.jsx("li",{children:"• 推荐使用 .woff2 格式，体积小加载快"}),e.jsxs("li",{children:["• ",e.jsx("span",{className:"font-semibold text-red-600",children:"字体链接必须支持CORS跨域"})]})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-blue-200",children:[e.jsx("p",{className:"text-xs text-blue-600 mb-2 font-semibold",children:"✅ 推荐字体源（支持CORS）："}),e.jsxs("ul",{className:"text-xs text-blue-600 space-y-1",children:[e.jsx("li",{children:"• Google Fonts CDN: fonts.gstatic.com"}),e.jsx("li",{children:"• jsDelivr CDN: cdn.jsdelivr.net"}),e.jsx("li",{children:"• unpkg CDN: unpkg.com"})]}),e.jsx("p",{className:"text-xs text-blue-500 mt-2",children:"示例：https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxK.woff2"})]})]})]}),e.jsxs("div",{onClick:()=>I("system","system"),className:"glass-card rounded-2xl p-5 ios-button cursor-pointer transition-all mb-3 "+("system"===i?"ring-2 ring-blue-500 shadow-lg":"hover:shadow-lg"),children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-bold text-gray-900 text-base",children:"系统默认"}),"system"===i&&e.jsx("span",{className:"text-xs bg-blue-500 text-white px-2 py-0.5 rounded-full",children:"使用中"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"使用系统默认字体"})]})}),e.jsx("div",{className:"bg-white/50 rounded-xl p-4 border border-gray-200/50",children:e.jsxs("div",{className:"text-gray-900 leading-relaxed",children:[e.jsx("div",{className:"text-base mb-2",children:"你好，这是系统默认字体"}),e.jsx("div",{className:"text-sm text-gray-600",children:"The quick brown fox jumps over the lazy dog"})]})})]}),e.jsx("div",{className:"space-y-3",children:l.map(t=>e.jsxs("div",{className:"glass-card rounded-2xl p-5 transition-all "+(i===t.id?"ring-2 ring-blue-500 shadow-lg":""),children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-bold text-gray-900 text-base",children:t.name}),i===t.id&&e.jsx("span",{className:"text-xs bg-blue-500 text-white px-2 py-0.5 rounded-full",children:"使用中"})]}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:t.url})]}),e.jsx("button",{onClick:()=>(e=>{if(confirm("确定要删除这个字体吗？")){const t=l.filter(t=>t.id!==e);C(t),i===e&&I("system","system")}})(t.id),className:"ml-2 w-8 h-8 flex items-center justify-center ios-button text-red-500 hover:bg-red-50 rounded-lg",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),e.jsx("div",{className:"bg-white/50 rounded-xl p-4 border border-gray-200/50",children:e.jsxs("div",{className:"text-gray-900 leading-relaxed",style:{fontFamily:t.fontFamily},children:[e.jsxs("div",{className:"text-base mb-2",children:["你好，这是",t.name]}),e.jsx("div",{className:"text-sm text-gray-600",children:"The quick brown fox jumps over the lazy dog"}),e.jsx("div",{className:"text-xs text-gray-500 mt-2",children:"0123456789 ！@#￥%……&*（）"})]})}),e.jsx("button",{onClick:()=>I(t.id,t.fontFamily),className:"w-full mt-3 py-2 bg-blue-500 text-white rounded-xl text-sm font-medium ios-button",children:"使用这个字体"})]},t.id))}),0===l.length&&!d&&e.jsxs("div",{className:"glass-card rounded-2xl p-8 text-center",children:[e.jsx("div",{className:"text-4xl mb-3",children:"📝"}),e.jsx("p",{className:"text-gray-500 text-sm mb-2",children:"还没有自定义字体"}),e.jsx("p",{className:"text-gray-400 text-xs",children:"点击右上角 + 添加字体"})]}),e.jsxs("div",{className:"mt-6 glass-card rounded-2xl p-5",children:[e.jsx("h3",{className:"font-bold text-gray-900 text-sm mb-3",children:"💡 使用说明"}),e.jsxs("div",{className:"space-y-2 text-xs text-gray-600",children:[e.jsx("p",{children:"• 点击右上角 + 添加自定义字体"}),e.jsx("p",{children:"• 输入字体名称、链接和 font-family 名称"}),e.jsx("p",{children:"• 支持在线字体链接（需支持跨域）"}),e.jsx("p",{children:"• 可以从 Google Fonts 等网站获取字体链接"}),e.jsx("p",{children:"• 字体会自动保存，下次打开仍然可用"})]})]}),e.jsx("div",{className:"h-6"})]})]})}},Symbol.toStringTag,{value:"Module"})),hl=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),n=t.useRef(null),i=t.useRef(null),[c,d]=t.useState(null),[x,m]=t.useState(null),[h,u]=t.useState({x:0,y:0}),[g,p]=t.useState(200),[f,b]=t.useState({width:0,height:0}),[j,v]=t.useState(!1),y=[{id:"wechat-app",name:"微信",defaultIcon:Yt},{id:"preset",name:"预设",defaultIcon:Ns},{id:"worldbook",name:"世界书",defaultIcon:Rs},{id:"music-app",name:"音乐",defaultIcon:Es},{id:"settings",name:"系统设置",defaultIcon:Ns},{id:"footprint",name:"足迹",defaultIcon:aa},{id:"photos",name:"相册",defaultIcon:ds},{id:"aiphone",name:"查手机",defaultIcon:ca},{id:"calendar",name:"日历",defaultIcon:Vs},{id:"games",name:"游戏",defaultIcon:Js},{id:"moments",name:"朋友圈",defaultIcon:gs},{id:"offline",name:"线下",defaultIcon:Yt},{id:"customize",name:"美化",defaultIcon:Ns},{id:"api-config",name:"API配置",defaultIcon:Ns},{id:"browser",name:"浏览器",defaultIcon:Us}],[N,w]=t.useState(()=>{const e=localStorage.getItem("custom_desktop_icons");if(e)try{const t=JSON.parse(e);return y.map(e=>{const s=t.find(t=>t.id===e.id);return{...e,customIcon:null==s?void 0:s.customIcon}})}catch(t){return y}return y}),k=e=>{w(e),localStorage.setItem("custom_desktop_icons",JSON.stringify(e)),window.dispatchEvent(new Event("customIconUpdate"))};return e.jsxs("div",{className:"h-full flex flex-col bg-[#f5f7fa]",children:[e.jsx("input",{ref:n,type:"file",accept:"image/*",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(!s)return;if(!s.type.startsWith("image/"))return void alert("请选择图片文件");const a=new FileReader;a.onload=e=>{var t;const s=new Image;s.onload=()=>{var t;m(null==(t=e.target)?void 0:t.result),b({width:s.width,height:s.height});const a=Math.min(s.width,s.height);p(a),u({x:(s.width-a)/2,y:(s.height-a)/2}),v(!0)},s.src=null==(t=e.target)?void 0:t.result},a.readAsDataURL(s)},className:"hidden"}),e.jsx("canvas",{ref:i,className:"hidden"}),e.jsxs("div",{className:"glass-effect sticky top-0 z-50",children:[r&&e.jsx(xa,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a(-1),className:"ios-button text-gray-700 hover:text-gray-900 -ml-2",children:e.jsx(ls,{size:24})}),e.jsx("h1",{className:"text-base font-semibold text-gray-900 absolute left-1/2 transform -translate-x-1/2 pointer-events-none",children:"自定义图标"}),e.jsx("button",{onClick:()=>{if(confirm("确定要恢复所有默认图标吗？")){const e=N.map(e=>({...e,customIcon:void 0}));k(e)}},className:"text-sm text-blue-500 ios-button",children:"全部重置"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsx("div",{className:"grid grid-cols-3 gap-4",children:N.map(t=>e.jsx("div",{className:"glass-card rounded-2xl p-4 cursor-pointer hover:shadow-lg transition-all backdrop-blur-md bg-white/80 border border-white/50",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"relative w-20 h-20 rounded-2xl glass-card flex items-center justify-center overflow-hidden border-2 border-gray-200",children:t.customIcon?e.jsx("img",{src:t.customIcon,alt:t.name,className:"w-full h-full object-cover"}):l.createElement(t.defaultIcon,{size:32,className:"text-gray-300"})}),e.jsx("span",{className:"text-xs text-gray-700 text-center font-medium",children:t.name}),e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsx("button",{onClick:()=>{var e;d(t.id),null==(e=n.current)||e.click()},className:"flex-1 px-3 py-1.5 bg-blue-500 text-white rounded-lg text-xs font-medium whitespace-nowrap",children:t.customIcon?"更换":"自定义"}),t.customIcon&&e.jsx("button",{onClick:()=>(e=>{if(confirm("确定要恢复默认图标吗？")){const t=N.map(t=>t.id===e?{...t,customIcon:void 0}:t);k(t)}})(t.id),className:"px-3 py-1.5 bg-gray-200 text-gray-700 rounded-lg text-xs font-medium whitespace-nowrap",children:"重置"})]})]})},t.id))}),e.jsxs("div",{className:"mt-6 p-4 glass-card rounded-2xl backdrop-blur-md bg-white/60 border border-white/50",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-2",children:"使用说明"}),e.jsxs("ul",{className:"text-xs text-gray-600 space-y-1",children:[e.jsx("li",{children:'• 点击"自定义"按钮上传图片'}),e.jsx("li",{children:"• 拖动和缩放裁剪框调整图标区域"}),e.jsx("li",{children:"• 建议使用正方形图片，效果更佳"}),e.jsx("li",{children:"• 支持PNG、JPG等常见格式"})]})]})]}),j&&x&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"glass-card rounded-3xl w-full max-w-md max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"bg-white px-6 py-4 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"裁剪图标"}),e.jsx("button",{onClick:()=>{v(!1),m(null)},className:"text-gray-500 hover:text-gray-700 text-2xl",children:"×"})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"relative w-full aspect-square bg-gray-100 rounded-xl overflow-hidden",children:[e.jsx("img",{src:x,alt:"preview",className:"w-full h-full object-contain",style:{filter:"brightness(0.5)"}}),e.jsx("div",{className:"absolute border-4 border-blue-500 bg-transparent cursor-move",style:{left:h.x/f.width*100+"%",top:h.y/f.height*100+"%",width:g/f.width*100+"%",height:g/f.height*100+"%",boxShadow:"0 0 0 9999px rgba(0, 0, 0, 0.5)"},onMouseDown:e=>{const t=e.clientX,s=e.clientY,a=h.x,r=h.y,l=e=>{const l=e.currentTarget.getBoundingClientRect(),n=f.width/l.width,i=f.height/l.height,c=(e.clientX-t)*n,o=(e.clientY-s)*i,d=Math.max(0,Math.min(f.width-g,a+c)),x=Math.max(0,Math.min(f.height-g,r+o));u({x:d,y:x})},n=()=>{document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",n)};document.addEventListener("mousemove",l),document.addEventListener("mouseup",n)},children:e.jsx("img",{src:x,alt:"crop preview",className:"absolute pointer-events-none",style:{left:`-${h.x}px`,top:`-${h.y}px`,width:`${f.width}px`,height:`${f.height}px`}})})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"text-sm text-gray-600 block mb-2",children:"裁剪大小"}),e.jsx("input",{type:"range",min:Math.min(100,Math.min(f.width,f.height)),max:Math.min(f.width,f.height),value:g,onChange:e=>{const t=parseInt(e.target.value);p(t),u({x:Math.min(h.x,f.width-t),y:Math.min(h.y,f.height-t)})},className:"w-full"})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>{v(!1),m(null)},className:"flex-1 px-4 py-3 glass-card text-gray-700 rounded-xl font-medium",children:"取消"}),e.jsx("button",{onClick:()=>{if(!x||!i.current)return;const e=i.current,t=e.getContext("2d");if(!t)return;const s=new Image;s.onload=()=>{e.width=256,e.height=256,t.drawImage(s,h.x,h.y,g,g,0,0,256,256);const a=e.toDataURL("image/png");if(c){const e=N.map(e=>e.id===c?{...e,customIcon:a}:e);k(e)}v(!1),m(null),d(null)},s.src=x},className:"flex-1 px-4 py-3 bg-blue-500 text-white rounded-xl font-medium",children:"确认"})]})]})]})})]})}},Symbol.toStringTag,{value:"Module"})),ul=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),l=t.useRef(null),n=t.useRef(null),i=t.useRef(null),[c,d]=t.useState(""),[x,m]=t.useState(!1),[h,u]=t.useState(""),[g,p]=t.useState(!1),[f,b]=t.useState(""),[j,v]=t.useState(!1);t.useEffect(()=>{(async()=>{try{const e=await pe("desktop_background");e&&d(e);const t=await pe("music_player_background");t&&u(t);const s=await pe("character_card_background");s&&b(s)}catch(e){}})()},[]);return e.jsxs("div",{className:"h-full flex flex-col bg-[#f5f7fa]",children:[e.jsx("input",{ref:l,type:"file",accept:"image/*",onChange:async e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(s)if(s.type.startsWith("image/")){m(!0);try{const e=new FileReader;e.onload=async()=>{const t=e.result;try{await fe("desktop_background",t),d(t),m(!1),alert("桌面背景已保存！"),window.dispatchEvent(new Event("desktopBackgroundUpdate"))}catch(s){alert("保存失败，请重试"),m(!1)}},e.onerror=()=>{alert("图片读取失败"),m(!1)},e.readAsDataURL(s)}catch(a){alert("图片处理失败，请重试"),m(!1)}}else alert("请选择图片文件")},className:"hidden"}),e.jsx("input",{ref:n,type:"file",accept:"image/*",onChange:async e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(s)if(s.type.startsWith("image/")){p(!0);try{const e=new FileReader;e.onload=async()=>{const t=e.result;try{await fe("music_player_background",t),u(t),p(!1),alert("音乐背景已保存！"),window.dispatchEvent(new Event("musicBackgroundUpdate"))}catch(s){alert("保存失败，请重试"),p(!1)}},e.onerror=()=>{alert("图片读取失败"),p(!1)},e.readAsDataURL(s)}catch(a){alert("图片处理失败，请重试"),p(!1)}}else alert("请选择图片文件")},className:"hidden"}),e.jsx("input",{ref:i,type:"file",accept:"image/*",onChange:async e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(s)if(s.type.startsWith("image/")){v(!0);try{const e=new FileReader;e.onload=async()=>{const t=e.result;try{await fe("character_card_background",t),b(t),v(!1),alert("角色卡片背景已保存！"),window.dispatchEvent(new Event("characterCardBackgroundUpdate"))}catch(s){alert("保存失败，请重试"),v(!1)}},e.onerror=()=>{alert("图片读取失败"),v(!1)},e.readAsDataURL(s)}catch(a){alert("图片处理失败，请重试"),v(!1)}}else alert("请选择图片文件")},className:"hidden"}),e.jsxs("div",{className:"glass-effect sticky top-0 z-50",children:[r&&e.jsx(xa,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a(-1),className:"ios-button text-gray-700 hover:text-gray-900 -ml-2",children:e.jsx(ls,{size:24})}),e.jsx("h1",{className:"text-base font-semibold text-gray-900 absolute left-1/2 transform -translate-x-1/2 pointer-events-none",children:"背景设置"}),e.jsx("div",{className:"w-6"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"text-sm font-semibold text-gray-700 mb-3 px-2",children:"桌面背景"}),e.jsxs("div",{className:"glass-card rounded-2xl p-4 backdrop-blur-md bg-white/80 border border-white/50",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"设置Desktop页面的整体背景"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-24 h-24 rounded-xl overflow-hidden border-2 border-gray-200 flex-shrink-0 flex items-center justify-center",style:{backgroundImage:c?`url(${c})`:"none",backgroundSize:"cover",backgroundPosition:"center",backgroundColor:c?"transparent":"#f5f7fa"},children:!c&&e.jsx(ds,{size:32,className:"text-gray-400"})}),e.jsxs("div",{className:"flex-1 flex flex-col gap-2",children:[e.jsx("button",{onClick:()=>{var e;return null==(e=l.current)?void 0:e.click()},disabled:x,className:"w-full px-4 py-2.5 bg-blue-500 text-white rounded-xl ios-button font-medium text-sm",children:x?"上传中...":c?"更换背景":"上传背景"}),c&&e.jsx("button",{onClick:async()=>{if(confirm("确定要删除桌面背景吗？"))try{await be("desktop_background"),d(""),alert("桌面背景已删除！"),window.dispatchEvent(new Event("desktopBackgroundUpdate"))}catch(e){alert("删除失败，请重试")}},className:"w-full px-4 py-2.5 glass-card text-gray-700 rounded-xl ios-button font-medium text-sm",children:"删除背景"})]})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"text-sm font-semibold text-gray-700 mb-3 px-2",children:"音乐背景"}),e.jsxs("div",{className:"glass-card rounded-2xl p-4 backdrop-blur-md bg-white/80 border border-white/50",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"设置桌面上音乐播放器卡片的背景"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-24 h-24 rounded-xl overflow-hidden border-2 border-gray-200 flex-shrink-0 flex items-center justify-center",style:{backgroundImage:h?`url(${h})`:"none",backgroundSize:"cover",backgroundPosition:"center",backgroundColor:h?"transparent":"#f5f7fa"},children:!h&&e.jsx(ds,{size:32,className:"text-gray-400"})}),e.jsxs("div",{className:"flex-1 flex flex-col gap-2",children:[e.jsx("button",{onClick:()=>{var e;return null==(e=n.current)?void 0:e.click()},disabled:g,className:"w-full px-4 py-2.5 bg-blue-500 text-white rounded-xl ios-button font-medium text-sm",children:g?"上传中...":h?"更换背景":"上传背景"}),h&&e.jsx("button",{onClick:async()=>{if(confirm("确定要删除音乐背景吗？"))try{await be("music_player_background"),u(""),alert("音乐背景已删除！"),window.dispatchEvent(new Event("musicBackgroundUpdate"))}catch(e){alert("删除失败，请重试")}},className:"w-full px-4 py-2.5 glass-card text-gray-700 rounded-xl ios-button font-medium text-sm",children:"删除背景"})]})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"text-sm font-semibold text-gray-700 mb-3 px-2",children:"角色卡片背景"}),e.jsxs("div",{className:"glass-card rounded-2xl p-4 backdrop-blur-md bg-white/80 border border-white/50",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"设置桌面第二页角色卡片的背景图片"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-24 h-24 rounded-xl overflow-hidden border-2 border-gray-200 flex-shrink-0 flex items-center justify-center",style:{backgroundImage:f?`url(${f})`:"none",backgroundSize:"cover",backgroundPosition:"center",backgroundColor:f?"transparent":"#f5f7fa"},children:!f&&e.jsx(ds,{size:32,className:"text-gray-400"})}),e.jsxs("div",{className:"flex-1 flex flex-col gap-2",children:[e.jsx("button",{onClick:()=>{var e;return null==(e=i.current)?void 0:e.click()},disabled:j,className:"w-full px-4 py-2.5 bg-blue-500 text-white rounded-xl ios-button font-medium text-sm",children:j?"上传中...":f?"更换背景":"上传背景"}),f&&e.jsx("button",{onClick:async()=>{if(confirm("确定要删除角色卡片背景吗？"))try{await be("character_card_background"),b(""),alert("角色卡片背景已删除！"),window.dispatchEvent(new Event("characterCardBackgroundUpdate"))}catch(e){alert("删除失败，请重试")}},className:"w-full px-4 py-2.5 glass-card text-gray-700 rounded-xl ios-button font-medium text-sm",children:"删除背景"})]})]})]})]}),e.jsxs("div",{className:"mt-6 p-4 glass-card rounded-2xl backdrop-blur-md bg-white/60 border border-white/50",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-2",children:"使用说明"}),e.jsxs("ul",{className:"text-xs text-gray-600 space-y-1",children:[e.jsx("li",{children:"• 桌面背景会显示在Desktop页面的整体背景"}),e.jsx("li",{children:"• 音乐背景只会显示在音乐播放器卡片内"}),e.jsx("li",{children:"• 角色卡片背景会显示在桌面第二页的角色卡片内"}),e.jsx("li",{children:"• 建议使用高质量图片，效果更佳"}),e.jsx("li",{children:"• 图片会自动保存到IndexedDB，无大小限制"})]})]})]})]})}},Symbol.toStringTag,{value:"Module"})),gl=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),[l,n]=t.useState(null),[i,c]=t.useState(!0),[d,x]=t.useState(!1),[m,h]=t.useState(!1),[u,g]=t.useState(()=>localStorage.getItem("weather_city")||"Beijing"),[p,f]=t.useState(""),[b,j]=t.useState(!1),[v,y]=t.useState(()=>"true"===localStorage.getItem("custom_weather_enabled")),[N,w]=t.useState(""),[k,C]=t.useState(""),[S,I]=t.useState("晴天"),_=async e=>{var t;try{x(!0);const t=e||u,s=await ft(t);n(s),c(!1),x(!1)}catch(s){c(!1),x(!1),(null==(t=s.message)?void 0:t.includes("404"))?alert('找不到该城市 ❌\n\n请检查：\n• 城市名称是否正确\n• 是否输入了完整的城市名\n  如："嘉兴"而不是"嘉"\n• 尝试使用英文名称'):alert("获取天气失败，请检查网络连接或稍后重试")}},M=e=>{!e||e.trim().length<2?alert("城市名称太短，请输入完整的城市名称"):(g(e),localStorage.setItem("weather_city",e),h(!1),_(e),window.dispatchEvent(new Event("weatherCityChange")))};t.useEffect(()=>{const e=localStorage.getItem("custom_weather_data");if(e)try{const t=JSON.parse(e);w(t.city||""),C(t.temp||""),I(t.condition||"晴天")}catch(t){}if(v&&e)try{const t=JSON.parse(e);n({temperature:parseInt(t.temp)||25,condition:t.condition||"晴天",conditionCN:t.condition||"晴天",icon:z(t.condition||"晴天"),location:t.city||"自定义",humidity:60,windSpeed:10,airQuality:"good"}),c(!1)}catch(t){_()}else _()},[]);const z=e=>{const t=e.toLowerCase();return t.includes("clear")||t.includes("sunny")||"晴天"===t||"晴"===t?"☀️":t.includes("rain")||"雨"===t||t.includes("shower")?t.includes("heavy")||"大雨"===t?"⛈️":t.includes("light")||"小雨"===t?"🌦️":"🌧️":t.includes("thunder")||"雷阵雨"===t?"⛈️":t.includes("cloud")||"多云"===t?t.includes("partly")?"⛅":"☁️":"阴"===t||t.includes("overcast")?"☁️":t.includes("snow")||"雪"===t?t.includes("heavy")||"大雪"===t?"❄️":"🌨️":t.includes("fog")||t.includes("mist")||"雾"===t?"🌫️":t.includes("wind")||"大风"===t?"💨":"🌤️"};return e.jsxs("div",{className:"h-full flex flex-col bg-[#f5f7fa]",children:[e.jsxs("div",{className:"glass-effect sticky top-0 z-50",children:[r&&e.jsx(xa,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a("/desktop",{replace:!0}),className:"ios-button text-gray-700 hover:text-gray-900 -ml-2",children:e.jsx(ls,{size:24})}),e.jsx("h1",{className:"text-base font-semibold text-gray-900 absolute left-1/2 transform -translate-x-1/2 pointer-events-none",children:"天气详情"}),e.jsx("button",{onClick:()=>j(!0),className:"text-blue-500 ios-button text-sm",children:v?"自定义中":"自定义"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:i?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full"})}):l?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"glass-card rounded-3xl p-6 mb-4 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-6xl font-extralight text-gray-800 mb-2",children:[l.temperature,e.jsx("span",{className:"text-3xl",children:"°C"})]}),e.jsx("div",{className:"text-xl text-gray-600",children:l.conditionCN}),e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:l.location})]}),e.jsx("div",{className:"text-7xl",children:z(l.condition)})]}),e.jsxs("div",{className:"flex items-center gap-3 p-4 glass-card rounded-xl",children:[e.jsx("div",{className:`w-12 h-12 rounded-full ${(e=>{switch(e){case"excellent":return"bg-green-500";case"good":return"bg-blue-500";case"moderate":return"bg-yellow-500";case"poor":return"bg-red-500";default:return"bg-gray-500"}})(l.airQuality)} flex items-center justify-center text-white font-bold`,children:(e=>{switch(e){case"excellent":return"优";case"good":return"良";case"moderate":return"中";case"poor":return"差";default:return"未知"}})(l.airQuality)}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"空气质量"}),e.jsx("div",{className:"text-xs text-gray-500 capitalize",children:l.airQuality})]})]})]}),e.jsxs("div",{className:"glass-card rounded-2xl p-5 mb-4",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900 mb-4",children:"详细信息"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"glass-card rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:"💧"}),e.jsx("span",{className:"text-xs text-gray-600",children:"湿度"})]}),e.jsxs("div",{className:"text-2xl font-semibold text-gray-800",children:[l.humidity,e.jsx("span",{className:"text-sm",children:"%"})]})]}),e.jsxs("div",{className:"glass-card rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:"💨"}),e.jsx("span",{className:"text-xs text-gray-600",children:"风速"})]}),e.jsxs("div",{className:"text-2xl font-semibold text-gray-800",children:[l.windSpeed,e.jsx("span",{className:"text-sm",children:"km/h"})]})]}),e.jsxs("div",{className:"glass-card rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:"🌡️"}),e.jsx("span",{className:"text-xs text-gray-600",children:"体感"})]}),e.jsxs("div",{className:"text-2xl font-semibold text-gray-800",children:[l.temperature,e.jsx("span",{className:"text-sm",children:"°C"})]})]}),e.jsxs("div",{className:"glass-card rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:"🌈"}),e.jsx("span",{className:"text-xs text-gray-600",children:"状况"})]}),e.jsx("div",{className:"text-sm font-medium text-gray-800 truncate",children:l.conditionCN})]})]})]}),e.jsxs("div",{className:"glass-card rounded-2xl p-5 mb-4",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900 mb-3",children:"位置"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-3xl",children:"📍"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-base text-gray-800 font-medium",children:l.location}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"当前位置"})]})]})]}),e.jsxs("div",{className:"text-center text-xs text-gray-500 mb-4",children:["数据来源: wttr.in • 更新于 ",(new Date).toLocaleTimeString("zh-CN")]})]}):e.jsxs("div",{className:"glass-card rounded-2xl p-8 text-center",children:[e.jsx("div",{className:"text-4xl mb-3",children:"🌦️"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"无法获取天气数据"}),e.jsx("button",{onClick:()=>_(),className:"px-6 py-2 bg-blue-500 text-white rounded-xl ios-button",children:"重试"})]})}),b&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end",children:e.jsxs("div",{className:"w-full bg-white rounded-t-3xl max-h-[80vh] overflow-hidden flex flex-col",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"自定义天气"}),e.jsx("button",{onClick:()=>j(!1),className:"text-gray-500 hover:text-gray-700 text-2xl ios-button",children:"×"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-gray-700 mb-2 block",children:"城市名称"}),e.jsx("input",{type:"text",value:N,onChange:e=>w(e.target.value),placeholder:"例如：北京、我的家乡",className:"w-full px-4 py-3 bg-gray-100 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-gray-700 mb-2 block",children:"温度 (°C)"}),e.jsx("input",{type:"number",value:k,onChange:e=>C(e.target.value),placeholder:"例如：25",className:"w-full px-4 py-3 bg-gray-100 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-gray-700 mb-2 block",children:"天气状况"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:["晴天","多云","阴天","小雨","中雨","大雨","雷阵雨","小雪","大雪","雾","大风","其他"].map(t=>e.jsx("button",{onClick:()=>I(t),className:"px-4 py-2 rounded-lg text-sm font-medium transition-all "+(S===t?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:t},t))})]}),N&&k&&e.jsxs("div",{className:"glass-card rounded-xl p-4 bg-blue-50",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:"预览"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-3xl font-bold text-gray-900",children:[k,"°C"]}),e.jsx("div",{className:"text-sm text-gray-600",children:S}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:N})]}),e.jsx("div",{className:"text-5xl",children:z(S)})]})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx("button",{onClick:()=>{if(!N.trim())return void alert("请输入城市名称");if(!k.trim()||isNaN(Number(k)))return void alert("请输入有效的温度（数字）");const e={city:N.trim(),temp:k.trim(),condition:S};localStorage.setItem("custom_weather_data",JSON.stringify(e)),localStorage.setItem("custom_weather_enabled","true"),y(!0),n({temperature:parseInt(k),condition:S,conditionCN:S,icon:z(S),location:N,humidity:60,windSpeed:10,airQuality:"good"}),j(!1),alert("自定义天气已保存！"),window.dispatchEvent(new Event("weatherCityChange"))},className:"w-full py-3 bg-blue-500 text-white rounded-xl font-medium ios-button",children:"保存自定义天气"}),v&&e.jsx("button",{onClick:()=>{localStorage.setItem("custom_weather_enabled","false"),y(!1),_(),alert("已切换到真实天气"),window.dispatchEvent(new Event("weatherCityChange"))},className:"w-full py-3 glass-card text-gray-700 rounded-xl font-medium ios-button",children:"切换到真实天气"}),e.jsx("button",{onClick:()=>h(!0),className:"w-full py-3 glass-card text-blue-600 rounded-xl font-medium ios-button",children:"或者选择真实城市"})]}),e.jsx("div",{className:"glass-card rounded-xl p-4 bg-yellow-50",children:e.jsxs("p",{className:"text-xs text-gray-600",children:["💡 ",e.jsx("span",{className:"font-semibold",children:"使用说明："}),e.jsx("br",{}),"• 自定义天气会覆盖真实天气数据",e.jsx("br",{}),"• 可以设置任意城市名和温度",e.jsx("br",{}),"• 桌面和详情页都会显示自定义数据",e.jsx("br",{}),"• 随时可以切换回真实天气"]})})]})]})}),m&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end",children:e.jsxs("div",{className:"w-full bg-white rounded-t-3xl max-h-[80vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"选择城市"}),e.jsx("button",{onClick:()=>{h(!1),f("")},className:"text-gray-500 hover:text-gray-700 text-2xl ios-button",children:"×"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:p,onChange:e=>f(e.target.value),placeholder:"搜索全世界任意城市...",className:"w-full px-4 py-3 pr-24 bg-gray-100 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 text-sm",onKeyDown:e=>{"Enter"===e.key&&p.trim()&&M(p.trim())}}),p&&e.jsx("button",{onClick:()=>M(p.trim()),className:"absolute right-2 top-1/2 -translate-y-1/2 px-4 py-1.5 bg-blue-500 text-white rounded-lg text-xs font-medium ios-button",children:"搜索"})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["💡 请输入",e.jsx("span",{className:"font-semibold text-blue-600",children:"完整"}),"的城市名称，如：嘉兴、Jiaxing、New York"]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-3",children:"常用城市"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:[{name:"北京",value:"Beijing"},{name:"上海",value:"Shanghai"},{name:"广州",value:"Guangzhou"},{name:"深圳",value:"Shenzhen"},{name:"成都",value:"Chengdu"},{name:"杭州",value:"Hangzhou"},{name:"重庆",value:"Chongqing"},{name:"西安",value:"Xian"},{name:"南京",value:"Nanjing"},{name:"武汉",value:"Wuhan"},{name:"天津",value:"Tianjin"},{name:"苏州",value:"Suzhou"},{name:"青岛",value:"Qingdao"},{name:"厦门",value:"Xiamen"},{name:"长沙",value:"Changsha"},{name:"郑州",value:"Zhengzhou"},{name:"济南",value:"Jinan"},{name:"福州",value:"Fuzhou"},{name:"石家庄",value:"Shijiazhuang"},{name:"合肥",value:"Hefei"},{name:"太原",value:"Taiyuan"},{name:"南昌",value:"Nanchang"},{name:"昆明",value:"Kunming"},{name:"乌鲁木齐",value:"Urumqi"},{name:"纽约",value:"New York"},{name:"伦敦",value:"London"},{name:"巴黎",value:"Paris"},{name:"东京",value:"Tokyo"},{name:"首尔",value:"Seoul"},{name:"新加坡",value:"Singapore"},{name:"悉尼",value:"Sydney"},{name:"莫斯科",value:"Moscow"}].map(t=>e.jsx("button",{onClick:()=>M(t.value),className:"px-3 py-2 rounded-lg ios-button text-xs font-medium transition-all "+(u===t.value?"bg-blue-500 text-white":"glass-card text-gray-700 hover:shadow-md"),children:t.name},t.value))})]})]})})]})}},Symbol.toStringTag,{value:"Module"})),pl=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),{currentUser:l}=d(),{characters:i}=n(),c=x(),[m,h]=t.useState(!1),[u,g]=t.useState(!1),[p,f]=t.useState(!1),[b,j]=t.useState(!1),[v,y]=t.useState(!1),[N,w]=t.useState([]),[k,C]=t.useState(0),[S,I]=t.useState(0),[_,M]=t.useState(""),[z,$]=t.useState("image"),[L,A]=t.useState(null),[T,D]=t.useState(0),B=i;t.useEffect(()=>{if(L&&N.length>0){const e=setInterval(()=>{const e=Math.floor((Date.now()-L)/1e3);D(e)},1e3);return()=>clearInterval(e)}D(0),A(null)},[L,N.length]);t.useEffect(()=>{const e=localStorage.getItem("musicPlayerBackground"),t=localStorage.getItem("musicPlayerBackgroundType");e&&(M(e),$(t||"image"))},[]);const E=[],P=JSON.parse(localStorage.getItem("customSongs")||"[]"),F=[...P,...E];t.useEffect(()=>{(async()=>{const e=await Promise.all(E.map(async e=>{if(e.lyricsUrl&&!e.lyrics)try{const t=await fetch(e.lyricsUrl);if(t.ok){const s=await t.text();return{...e,lyrics:s}}}catch(t){}return e}));c.setPlaylist([...P,...e])})()},[]),t.useEffect(()=>{F.length>0&&!c.currentSong&&(c.setPlaylist(F),c.setCurrentSong(F[0],0))},[]);const O=c.currentSong||F[0]||{id:0,title:"暂无歌曲",artist:"请上传歌曲",duration:0,cover:'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="300" height="300"%3E%3Crect fill="%23999" width="300" height="300"/%3E%3Ctext x="50%25" y="50%25" dominant-baseline="middle" text-anchor="middle" font-family="sans-serif" font-size="60" fill="%23fff"%3E🎵%3C/text%3E%3C/svg%3E'},W=c.isPlaying,R=c.currentTime,U=c.duration,V=c.currentIndex,J=(null==O?void 0:O.lyrics)?(e=>{if(!e)return[];return e.split("\n").map(e=>{const t=e.match(/\[(\d+):(\d+)\.(\d+)\](.*)/);if(t){const e=parseInt(t[1]),s=parseInt(t[2]),a=parseInt(t[3]),r=t[4].trim(),l=60*e+s+a/1e3,n=r.includes("作词")||r.includes("作曲")||r.includes("编曲")||r.includes("制作")||r.includes("混音")||r.includes("录音")||r.includes("母带")||r.includes("监制")||r.includes("发行")||r.includes("企划")||r.includes("封面")||r.includes("钢琴")||r.includes("吉他")||r.includes("贝斯")||r.includes("鼓")||r.includes("弦乐");return{time:l,text:r,isMetadata:n}}return null}).filter(e=>null!==e&&""!==e.text.trim()).sort((e,t)=>e.time-t.time)})(O.lyrics):[],H=J.map(e=>e.text),G=e=>`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`;return t.useEffect(()=>{let e;if(W){const t=()=>{C(e=>(e+.5)%360),e=requestAnimationFrame(t)};e=requestAnimationFrame(t)}return()=>{e&&cancelAnimationFrame(e)}},[W]),t.useEffect(()=>{if(J.length>0){let e=0;for(let t=0;t<J.length&&R>=J[t].time;t++)e=t;I(e)}},[R,J]),e.jsxs("div",{className:"h-screen flex flex-col relative overflow-hidden bg-white",children:[r&&e.jsx(xa,{}),e.jsxs("div",{className:"absolute inset-0 "+(r?"top-[44px]":"top-0"),children:[_&&("video"===z?e.jsx("video",{src:_,autoPlay:!0,loop:!0,muted:!0,className:"absolute inset-0 w-full h-full object-cover"}):e.jsx("div",{className:"absolute inset-0 w-full h-full bg-cover bg-center",style:{backgroundImage:`url(${_})`}})),!_&&e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-pink-50 via-purple-50 to-blue-50"}),e.jsx("div",{className:"absolute inset-0 backdrop-blur-sm bg-white/30"})]}),e.jsxs("div",{className:"relative z-10 px-4 py-3 flex items-center justify-between border-b border-gray-100",children:[e.jsx("button",{onClick:()=>a("/desktop",{replace:!0}),className:"w-10 h-10 flex items-center justify-center ios-button",children:e.jsx("svg",{className:"w-6 h-6 text-gray-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("h1",{className:"text-sm font-medium text-gray-700",children:"正在播放"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>a("/music-search"),className:"w-10 h-10 flex items-center justify-center ios-button",children:e.jsx("svg",{className:"w-6 h-6 text-gray-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsxs("label",{className:"w-10 h-10 flex items-center justify-center ios-button cursor-pointer",children:[e.jsx("input",{type:"file",accept:"image/*,video/*",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(s){const e=URL.createObjectURL(s);M(e),s.type.startsWith("video/")?$("video"):$("image"),localStorage.setItem("musicPlayerBackground",e),localStorage.setItem("musicPlayerBackgroundType",s.type.startsWith("video/")?"video":"image")}},className:"hidden"}),e.jsx("svg",{className:"w-6 h-6 text-gray-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2zM9 10l12-3"})})]}),e.jsx("button",{onClick:()=>a("/upload-song"),className:"w-10 h-10 flex items-center justify-center ios-button",children:e.jsx("svg",{className:"w-6 h-6 text-gray-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}),e.jsx("button",{onClick:()=>h(!m),className:"w-10 h-10 flex items-center justify-center ios-button",children:e.jsx("svg",{className:"w-5 h-5 text-gray-700",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M15 6H3v2h12V6zm0 4H3v2h12v-2zM3 16h8v-2H3v2zM17 6v8.18c-.31-.11-.65-.18-1-.18-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3V8h3V6h-5z"})})})]})]}),m&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-end",onClick:()=>h(!1),children:e.jsxs("div",{className:"w-full bg-white rounded-t-3xl max-h-[70vh] overflow-hidden",onClick:e=>e.stopPropagation(),children:[e.jsx("div",{className:"p-4 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"播放列表"}),e.jsx("button",{onClick:()=>h(!1),className:"text-gray-400 text-2xl w-8 h-8 flex items-center justify-center",children:"×"})]})}),e.jsx("div",{className:"overflow-y-auto max-h-[calc(70vh-60px)]",children:F.map((t,s)=>e.jsxs("div",{onClick:()=>(e=>{c.setCurrentSong(F[e],e),c.play(),h(!1)})(s),className:"flex items-center gap-3 p-4 border-b border-gray-50 ios-button "+(s===V?"bg-red-50":""),children:[e.jsx("img",{src:t.cover,alt:t.title,className:"w-12 h-12 rounded-lg object-cover"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium "+(s===V?"text-red-500":"text-gray-900"),children:t.title}),e.jsx("div",{className:"text-sm text-gray-500",children:t.artist})]}),s===V&&W&&e.jsxs("div",{className:"flex gap-1 items-end",children:[e.jsx("div",{className:"w-1 h-3 bg-red-500 rounded animate-pulse"}),e.jsx("div",{className:"w-1 h-4 bg-red-500 rounded animate-pulse",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-1 h-2 bg-red-500 rounded animate-pulse",style:{animationDelay:"0.2s"}})]})]},t.id))})]})}),e.jsxs("div",{className:"relative z-10 flex-1 flex flex-col items-center justify-start p-4 pt-4 overflow-y-auto",children:[e.jsxs("div",{className:"mb-4 flex flex-col items-center",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsx("div",{className:"w-14 h-14 rounded-full bg-gradient-to-br from-blue-400 to-blue-600 flex items-center justify-center shadow-lg border-2 border-white",children:e.jsx("img",{src:(null==l?void 0:l.avatar)||"https://i.pravatar.cc/150?img=68",alt:"我",className:"w-full h-full rounded-full object-cover"})}),N.map(t=>e.jsx("div",{className:"w-14 h-14 rounded-full bg-gradient-to-br from-pink-400 to-pink-600 flex items-center justify-center shadow-lg border-2 border-white",children:e.jsx("img",{src:t.avatar,alt:t.name,className:"w-full h-full rounded-full object-cover"})},t.id))]}),e.jsx("p",{className:"text-sm text-gray-600 font-medium",children:N.length>0?`与 ${N.map(e=>e.name).join("、")} 一起听了 ${(e=>{const t=Math.floor(e/3600),s=Math.floor(e%3600/60),a=e%60;return t>0?`${t}小时${s}分钟`:s>0?`${s}分${a}秒`:`${a}秒`})(T)}`:"点击邀请按钮邀请好友一起听歌"})]}),e.jsxs("div",{className:"relative mb-8 mt-12 w-48 h-48 flex items-center justify-center",children:[e.jsx("div",{className:"absolute transition-opacity duration-500 "+(b?"opacity-0 pointer-events-none":"opacity-100"),onClick:()=>j(!0),children:e.jsx("div",{className:"relative w-48 h-48",children:e.jsx("div",{className:"w-48 h-48 rounded-full backdrop-blur-md bg-white/20 shadow-2xl flex items-center justify-center cursor-pointer border-2 border-white/30",style:{transform:`rotate(${k}deg)`,transition:W?"none":"transform 0.5s"},children:e.jsx("div",{className:"w-[170px] h-[170px] rounded-full overflow-hidden shadow-inner bg-white flex items-center justify-center",children:e.jsx("img",{src:O.cover,alt:O.title,className:"w-full h-full object-contain",onError:e=>{}})})})})}),e.jsx("div",{className:"absolute transition-opacity duration-500 "+(b?"opacity-100":"opacity-0 pointer-events-none"),onClick:()=>j(!1),children:e.jsx("div",{className:"w-48 h-48 flex items-center justify-center cursor-pointer",children:H.length>0?e.jsx("div",{className:"w-full h-full overflow-hidden flex items-center",children:e.jsx("div",{className:"w-full text-center space-y-2 px-4",children:Array.from({length:5},(t,s)=>{const a=H[S-2+s]||"",r=2===s;return e.jsx("p",{className:"text-sm transition-all duration-300 "+(r?"text-gray-900 font-bold text-base scale-110":"text-gray-400 text-xs"),children:a||" "},s)})})}):e.jsxs("div",{className:"flex flex-col items-center justify-center text-gray-400",children:[e.jsx("svg",{className:"w-12 h-12 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})}),e.jsx("p",{className:"text-sm",children:"暂无歌词"})]})})})]}),e.jsxs("div",{className:"w-full max-w-md mb-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-1",children:O.title}),e.jsx("p",{className:"text-gray-600 text-base",children:O.artist})]}),e.jsx("button",{onClick:()=>g(!u),className:"w-10 h-10 flex items-center justify-center ios-button",children:e.jsx("svg",{className:"w-6 h-6 "+(u?"text-red-500 fill-current":"text-gray-400"),fill:u?"currentColor":"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})})})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[e.jsxs("button",{onClick:()=>f(!p),className:"flex items-center gap-2 bg-gray-100 rounded-full px-3 py-2 ios-button",children:[e.jsxs("div",{className:"flex -space-x-2",children:[e.jsx("img",{src:(null==l?void 0:l.avatar)||"https://i.pravatar.cc/150?img=68",alt:"我",className:"w-7 h-7 rounded-full border-2 border-white"}),B.slice(0,2).map(t=>e.jsx("img",{src:t.avatar,alt:t.name,className:"w-7 h-7 rounded-full border-2 border-white"},t.id))]}),e.jsxs("span",{className:"text-gray-700 text-sm font-medium",children:[B.length+1," 人在听"]})]}),e.jsxs("button",{onClick:()=>y(!0),className:"flex items-center gap-1 bg-red-500 text-white rounded-full px-4 py-2 ios-button",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("span",{className:"text-sm font-medium",children:"邀请"})]}),e.jsx("button",{onClick:()=>a("/music-together-chat"),className:"w-9 h-9 flex items-center justify-center bg-white/90 backdrop-blur-sm text-red-500 rounded-full ios-button shadow-md hover:shadow-lg transition-all",title:"一起听聊天",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})})]})]}),e.jsxs("div",{className:"w-full max-w-md mb-5",children:[e.jsx("input",{type:"range",min:"0",max:U||0,value:R,onChange:e=>{const t=parseFloat(e.target.value);c.seek(t)},className:"w-full h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer slider",style:{background:`linear-gradient(to right, #EF4444 0%, #EF4444 ${R/U*100}%, #E5E7EB ${R/U*100}%, #E5E7EB 100%)`}}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-2",children:[e.jsx("span",{children:G(R)}),e.jsx("span",{children:G(U||O.duration)})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-8 mb-6",children:[e.jsx("button",{onClick:()=>{c.previous()},className:"w-12 h-12 flex items-center justify-center ios-button hover:scale-110 transition-transform",children:e.jsx("svg",{className:"w-8 h-8 text-gray-700",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M6 6h2v12H6zm3.5 6l8.5 6V6z"})})}),e.jsx("button",{onClick:()=>{c.togglePlay()},className:"w-16 h-16 bg-red-500 rounded-full flex items-center justify-center shadow-lg ios-button hover:scale-110 transition-transform",children:W?e.jsx("svg",{className:"w-8 h-8 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M6 4h4v16H6V4zm8 0h4v16h-4V4z"})}):e.jsx("svg",{className:"w-8 h-8 text-white ml-1",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M8 5v14l11-7z"})})}),e.jsx("button",{onClick:()=>{c.next()},className:"w-12 h-12 flex items-center justify-center ios-button hover:scale-110 transition-transform",children:e.jsx("svg",{className:"w-8 h-8 text-gray-700",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"})})})]})]}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-end",onClick:()=>f(!1),children:e.jsxs("div",{className:"w-full bg-white rounded-t-3xl p-6",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"正在一起听"}),e.jsx("button",{onClick:()=>f(!1),className:"text-gray-400 text-2xl w-8 h-8 flex items-center justify-center",children:"×"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:(null==l?void 0:l.avatar)||"https://i.pravatar.cc/150?img=68",alt:"我",className:"w-12 h-12 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-gray-900 font-medium",children:(null==l?void 0:l.name)||"我"}),e.jsx("div",{className:"text-gray-500 text-sm",children:"正在收听"})]}),e.jsxs("div",{className:"flex gap-1 items-end",children:[e.jsx("div",{className:"w-1 h-4 bg-red-500 rounded animate-pulse"}),e.jsx("div",{className:"w-1 h-3 bg-red-500 rounded animate-pulse",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-1 h-5 bg-red-500 rounded animate-pulse",style:{animationDelay:"0.2s"}})]})]}),B.map(t=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:t.avatar,alt:t.name,className:"w-12 h-12 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-gray-900 font-medium",children:t.name}),e.jsx("div",{className:"text-gray-500 text-sm",children:"正在收听"})]}),e.jsxs("div",{className:"flex gap-1 items-end",children:[e.jsx("div",{className:"w-1 h-4 bg-red-500 rounded animate-pulse"}),e.jsx("div",{className:"w-1 h-3 bg-red-500 rounded animate-pulse",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-1 h-5 bg-red-500 rounded animate-pulse",style:{animationDelay:"0.2s"}})]})]},t.id))]})]})}),v&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-end",onClick:()=>y(!1),children:e.jsxs("div",{className:"w-full bg-white rounded-t-3xl p-6 max-h-[70vh] overflow-hidden",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"邀请一起听歌"}),e.jsx("button",{onClick:()=>y(!1),className:"text-gray-400 text-2xl w-8 h-8 flex items-center justify-center",children:"×"})]}),e.jsx("div",{className:"overflow-y-auto max-h-[calc(70vh-80px)]",children:e.jsx("div",{className:"space-y-3",children:B.map(t=>e.jsxs("div",{onClick:()=>(e=>{if(!O||0===O.id)return void alert("请先播放一首歌曲");const t={id:Date.now(),type:"sent",messageType:"musicInvite",content:`[一起听邀请]我想和你一起听《${O.title}》`,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),musicInvite:{songTitle:O.title,songArtist:O.artist,songCover:O.cover,inviterName:(null==l?void 0:l.username)||"我",status:"pending"},timestamp:Date.now()},s=`chat_${e.id}`,r=JSON.parse(localStorage.getItem(s)||"[]");localStorage.setItem(s,JSON.stringify([...r,t])),y(!1),a(`/chat/${e.id}`)})(t),className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg ios-button",children:[e.jsx("img",{src:t.avatar,alt:t.name,className:"w-12 h-12 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-gray-900 font-medium",children:t.name}),e.jsx("div",{className:"text-sm text-gray-500",children:"点击邀请"})]}),N.find(e=>e.id===t.id)&&e.jsx("svg",{className:"w-6 h-6 text-red-500",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})})]},t.id))})})]})}),e.jsx("style",{children:"\n        .slider::-webkit-slider-thumb {\n          appearance: none;\n          width: 12px;\n          height: 12px;\n          border-radius: 50%;\n          background: #EF4444;\n          cursor: pointer;\n          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);\n        }\n\n        .slider::-moz-range-thumb {\n          width: 12px;\n          height: 12px;\n          border-radius: 50%;\n          background: #EF4444;\n          cursor: pointer;\n          border: none;\n          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);\n        }\n\n        @keyframes ping {\n          75%, 100% {\n            transform: scale(1.1);\n            opacity: 0;\n          }\n        }\n\n        .animate-ping {\n          animation: ping 2s cubic-bezier(0, 0, 0.2, 1) infinite;\n        }\n      "})]})}},Symbol.toStringTag,{value:"Module"})),fl=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),[l,n]=t.useState({title:"",artist:"",album:"",cover:"",audioFile:null,lyrics:""}),[i,c]=t.useState(""),[d,x]=t.useState(""),[m,h]=t.useState("");return e.jsxs("div",{className:"h-screen flex flex-col bg-white",children:[r&&e.jsx(xa,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between border-b border-gray-100",children:[e.jsx("button",{onClick:()=>a(-1),className:"w-10 h-10 flex items-center justify-center ios-button",children:e.jsx("svg",{className:"w-6 h-6 text-gray-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"上传歌曲"}),e.jsx("button",{onClick:()=>{if(!l.title||!l.artist||!l.audioFile)return void alert("请填写歌曲名称、艺术家并上传音频文件");const e=JSON.parse(localStorage.getItem("customSongs")||"[]"),t={id:Date.now(),title:l.title,artist:l.artist,album:l.album||"未知专辑",cover:l.cover||"https://via.placeholder.com/300",audioUrl:d,lyrics:l.lyrics,duration:0,isCustom:!0};e.push(t),localStorage.setItem("customSongs",JSON.stringify(e)),alert("歌曲上传成功！"),a("/music-player")},className:"text-red-500 font-medium text-base",children:"保存"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"专辑封面"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-24 h-24 bg-gray-100 rounded-lg overflow-hidden flex items-center justify-center",children:i?e.jsx("img",{src:i,alt:"封面预览",className:"w-full h-full object-cover"}):e.jsx("svg",{className:"w-10 h-10 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsxs("label",{className:"flex-1",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(s){const e=new FileReader;e.onloadend=()=>{c(e.result),n({...l,cover:e.result})},e.readAsDataURL(s)}},className:"hidden"}),e.jsx("div",{className:"bg-gray-100 text-gray-700 px-4 py-2 rounded-lg text-center cursor-pointer hover:bg-gray-200",children:"选择图片"})]})]})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["歌曲名称 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:l.title,onChange:e=>n({...l,title:e.target.value}),placeholder:"请输入歌曲名称",className:"w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["艺术家 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:l.artist,onChange:e=>n({...l,artist:e.target.value}),placeholder:"请输入艺术家名称",className:"w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"专辑名称"}),e.jsx("input",{type:"text",value:l.album,onChange:e=>n({...l,album:e.target.value}),placeholder:"请输入专辑名称（可选）",className:"w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["音频文件 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("label",{className:"block",children:[e.jsx("input",{type:"file",accept:"audio/*",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(s){const e=URL.createObjectURL(s);x(e),n({...l,audioFile:s})}},className:"hidden"}),e.jsx("div",{className:"bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg p-6 text-center cursor-pointer hover:border-red-500 hover:bg-red-50",children:l.audioFile?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-6 h-6 text-red-500",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"})}),e.jsx("span",{className:"text-gray-700 font-medium",children:l.audioFile.name})]}):e.jsxs("div",{children:[e.jsx("svg",{className:"w-12 h-12 text-gray-400 mx-auto mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),e.jsx("p",{className:"text-gray-600",children:"点击上传音频文件"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"支持 MP3、WAV、OGG 等格式"})]})})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"歌词（可选）"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("input",{type:"file",accept:".lrc,.txt",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(s){h(s.name);const e=new FileReader;e.onload=e=>{var t;const s=null==(t=e.target)?void 0:t.result;n({...l,lyrics:s})},e.readAsText(s)}},className:"hidden",id:"lyricsFileInput"}),e.jsxs("label",{htmlFor:"lyricsFileInput",className:"inline-flex items-center gap-2 bg-gray-100 text-gray-700 px-4 py-2 rounded-lg cursor-pointer hover:bg-gray-200 transition-colors",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),e.jsx("span",{className:"text-sm",children:m||"上传歌词文件 (.lrc/.txt)"})]})]}),e.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"或手动输入歌词："}),e.jsx("textarea",{value:l.lyrics,onChange:e=>n({...l,lyrics:e.target.value}),placeholder:"请输入歌词，每行一句",rows:8,className:"w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 resize-none"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"提示：每行输入一句歌词，播放时会自动滚动显示"})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})}),e.jsxs("div",{className:"text-sm text-blue-700",children:[e.jsx("p",{className:"font-medium mb-1",children:"上传说明"}),e.jsxs("ul",{className:"space-y-1 text-blue-600",children:[e.jsx("li",{children:"• 歌曲名称和艺术家为必填项"}),e.jsx("li",{children:"• 必须上传音频文件才能保存"}),e.jsx("li",{children:"• 封面图片和歌词为可选项"}),e.jsx("li",{children:"• 上传的歌曲会保存在本地"})]})]})]})})]})]})}},Symbol.toStringTag,{value:"Module"})),bl=({content:t})=>e.jsxs("div",{className:"w-full h-full bg-white/30 backdrop-blur-xl rounded-3xl overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-white/30 bg-white/20",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"通讯录"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[t.contacts.length," 位联系人"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-2",children:t.contacts.map((t,s)=>e.jsxs("div",{className:"bg-white/50 backdrop-blur-md rounded-2xl p-4 border border-white/50 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-400/30 to-purple-400/30 flex items-center justify-center",children:e.jsx("span",{className:"text-lg font-medium text-gray-700",children:t.name[0]})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-800",children:t.name}),e.jsx("div",{className:"text-xs text-gray-500",children:t.relation})]})]}),e.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:[e.jsx("div",{children:t.phone}),t.notes&&e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:t.notes})]})]},s))})]}),jl=({content:s})=>{const[a,r]=t.useState(null);if(null!==a){const t=s.wechatChats[a];return e.jsxs("div",{className:"w-full h-full bg-white/30 backdrop-blur-xl rounded-3xl overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-white/30 bg-white/20 flex items-center gap-3",children:[e.jsx("button",{onClick:()=>r(null),className:"w-8 h-8 rounded-full hover:bg-white/30 flex items-center justify-center",children:e.jsx(da,{size:20,className:"text-gray-700"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-gradient-to-br from-green-400/30 to-green-500/30 flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-medium text-gray-700",children:t.name[0]})}),e.jsx("h2",{className:"text-base font-semibold text-gray-800",children:t.name})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:t.messages.map((t,s)=>e.jsx("div",{className:"flex "+(t.isSelf?"justify-end":"justify-start"),children:e.jsxs("div",{className:"max-w-[75%] "+(t.isSelf?"order-2":"order-1"),children:[e.jsx("div",{className:`rounded-2xl px-4 py-2 ${t.isSelf?"bg-green-500/80 text-white":"bg-white/70 text-gray-800"} shadow-sm`,children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:t.content})}),e.jsx("div",{className:"text-xs text-gray-500 mt-1 px-2 "+(t.isSelf?"text-right":"text-left"),children:t.time})]})},s))})]})}return e.jsxs("div",{className:"w-full h-full bg-white/30 backdrop-blur-xl rounded-3xl overflow-hidden flex flex-col",children:[e.jsx("div",{className:"px-6 py-4 border-b border-white/30 bg-white/20",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"微信"})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:s.wechatChats.map((t,s)=>e.jsx("div",{onClick:()=>r(s),className:"px-4 py-3 border-b border-white/20 hover:bg-white/20 transition-colors cursor-pointer active:bg-white/30",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-green-400/30 to-green-500/30 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-lg font-medium text-gray-700",children:t.name[0]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"font-medium text-gray-800 truncate",children:t.name}),e.jsx("span",{className:"text-xs text-gray-400 ml-2",children:t.time})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-gray-600 truncate flex-1",children:t.lastMessage}),t.unread>0&&e.jsx("span",{className:"ml-2 px-2 py-0.5 bg-red-500 text-white text-xs rounded-full flex-shrink-0",children:t.unread})]})]})]})},s))})]})},vl=({content:t})=>e.jsxs("div",{className:"w-full h-full bg-white/30 backdrop-blur-xl rounded-3xl overflow-hidden flex flex-col",children:[e.jsx("div",{className:"px-4 py-3 border-b border-white/30 bg-white/20",children:e.jsxs("div",{className:"bg-white/50 rounded-full px-4 py-2 text-sm text-gray-600 flex items-center gap-2",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("path",{d:"m21 21-4.35-4.35"})]}),e.jsx("span",{children:"搜索或输入网址"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"最近访问"}),e.jsx("div",{className:"space-y-2",children:t.browserHistory.map((t,s)=>e.jsxs("div",{className:"bg-white/50 backdrop-blur-md rounded-xl p-3 border border-white/50 shadow-sm",children:[e.jsx("div",{className:"font-medium text-gray-800 text-sm mb-1",children:t.title}),e.jsx("div",{className:"text-xs text-gray-500 truncate",children:t.url}),t.reason&&e.jsxs("div",{className:"text-xs text-gray-600 mt-1 italic",children:["搜索原因: ",t.reason]}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:t.time})]},s))})]})]}),yl=({content:t})=>e.jsxs("div",{className:"w-full h-full bg-white/30 backdrop-blur-xl rounded-3xl overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-white/30 bg-gradient-to-r from-orange-400/20 to-red-400/20",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"淘宝"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"我的订单"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:t.taobaoOrders.map((t,s)=>e.jsx("div",{className:"bg-white/60 backdrop-blur-md rounded-2xl p-4 border border-orange-200/50 shadow-sm",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-16 h-16 rounded-lg bg-gradient-to-br from-orange-200/60 to-red-200/40 flex items-center justify-center flex-shrink-0",children:e.jsxs("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"}),e.jsx("polyline",{points:"3.27 6.96 12 12.01 20.73 6.96"}),e.jsx("line",{x1:"12",y1:"22.08",x2:"12",y2:"12"})]})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-gray-800 mb-1",children:t.title}),t.reason&&e.jsxs("p",{className:"text-xs text-gray-600 mb-2",children:["购买原因: ",t.reason]}),t.thought&&e.jsxs("p",{className:"text-xs text-gray-500 italic mb-2",children:['"',t.thought,'"']}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-lg font-bold text-orange-600",children:["¥",t.price]}),e.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-orange-100 text-orange-700",children:t.status})]})]})]})},s))})]}),Nl=({content:t})=>e.jsxs("div",{className:"w-full h-full bg-white/30 backdrop-blur-xl rounded-3xl overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-white/30 bg-gradient-to-r from-blue-400/20 to-blue-500/20",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"支付宝"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"账单记录"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-2",children:t.alipayBills.map((t,s)=>e.jsx("div",{className:"bg-white/60 backdrop-blur-md rounded-xl p-4 border border-blue-200/50 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full ${"income"===t.type?"bg-green-400/30":"bg-red-400/30"} flex items-center justify-center`,children:"income"===t.type?e.jsx("span",{className:"text-green-600 font-bold",children:"+"}):e.jsx("span",{className:"text-red-600 font-bold",children:"-"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-800",children:t.title}),t.reason&&e.jsx("div",{className:"text-xs text-gray-600 mt-0.5",children:t.reason}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:t.time})]})]}),e.jsxs("div",{className:"text-lg font-bold "+("income"===t.type?"text-green-600":"text-gray-800"),children:["income"===t.type?"+":"-","¥",t.amount]})]})},s))})]}),wl=({content:t})=>e.jsxs("div",{className:"w-full h-full bg-white/30 backdrop-blur-xl rounded-3xl overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-white/30 bg-white/20",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"相册"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[t.photos.length," 张照片"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 grid grid-cols-2 gap-3",children:t.photos.map((t,s)=>e.jsxs("div",{className:"bg-gradient-to-br from-pink-100/60 to-purple-100/40 backdrop-blur-md rounded-2xl p-3 border border-pink-200/50 shadow-sm aspect-square flex flex-col justify-between",children:[e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"}),e.jsx("circle",{cx:"12",cy:"13",r:"4"})]})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-800",children:t.description}),t.location&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["位置: ",t.location]}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:t.time})]})]},s))})]}),kl=({content:t})=>e.jsxs("div",{className:"w-full h-full bg-white/30 backdrop-blur-xl rounded-3xl overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-white/30 bg-white/20",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"备忘录"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[t.notes.length," 条备忘"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:t.notes.map((t,s)=>e.jsxs("div",{className:"bg-gradient-to-br from-yellow-100/60 to-yellow-50/40 backdrop-blur-md rounded-2xl p-4 border border-yellow-200/50 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-medium text-gray-800",children:t.title}),e.jsx("span",{className:"text-xs text-gray-500",children:t.time})]}),e.jsx("p",{className:"text-sm text-gray-600 whitespace-pre-wrap",children:t.content})]},s))})]}),Cl=({content:t})=>e.jsxs("div",{className:"w-full h-full bg-white/30 backdrop-blur-xl rounded-3xl overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-white/30 bg-white/20",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"音乐"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"我的歌单"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-2",children:t.musicPlaylist.map((t,s)=>e.jsx("div",{className:"bg-gradient-to-r from-red-100/60 to-pink-100/40 backdrop-blur-md rounded-xl p-4 border border-red-200/50 shadow-sm hover:shadow-md transition-all",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-red-400/40 to-pink-400/40 flex items-center justify-center flex-shrink-0",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M9 18V5l12-2v13"}),e.jsx("circle",{cx:"6",cy:"18",r:"3"}),e.jsx("circle",{cx:"18",cy:"16",r:"3"})]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-800 truncate",children:t.title}),e.jsx("div",{className:"text-sm text-gray-600 truncate",children:t.artist}),t.mood&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["心情: ",t.mood]})]})]})},s))})]}),Sl=({content:t})=>e.jsxs("div",{className:"w-full h-full bg-white/30 backdrop-blur-xl rounded-3xl overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-white/30 bg-gradient-to-r from-blue-400/20 to-purple-400/20",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"今日足迹"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"记录TA的一天"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-[22px] top-4 bottom-4 w-0.5 bg-gradient-to-b from-blue-300 to-purple-300"}),e.jsx("div",{className:"space-y-4",children:t.footprints.map((t,s)=>e.jsxs("div",{className:"relative pl-12",children:[e.jsx("div",{className:"absolute left-0 top-0 w-11 h-11 rounded-full bg-gradient-to-br from-blue-400/40 to-purple-400/40 backdrop-blur-md border-2 border-white flex items-center justify-center shadow-lg",children:e.jsx("span",{className:"text-xs font-bold text-gray-700",children:t.time})}),e.jsx("div",{className:"bg-white/60 backdrop-blur-md rounded-2xl p-4 border border-blue-200/50 shadow-md hover:shadow-lg transition-shadow",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-green-400/30 flex items-center justify-center",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"}),e.jsx("circle",{cx:"12",cy:"10",r:"3"})]})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-800 text-base",children:t.location}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:t.address}),e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"时长:"}),e.jsxs("span",{className:"text-gray-700",children:["停留 ",t.duration]})]}),e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"活动:"}),e.jsx("span",{className:"text-gray-700 flex-1",children:t.activity})]}),t.mood&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"心情:"}),e.jsx("span",{className:"text-gray-600",children:t.mood})]}),t.companion&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"同行:"}),e.jsxs("span",{className:"text-gray-600",children:["和 ",t.companion]})]})]})]})]})})]},s))})]})})]}),Il=({onClose:s,characterId:a,characterName:r,forceNew:l=!0,historyContent:n})=>{const[i,c]=t.useState(null),[o,d]=t.useState(new Date),[x,m]=t.useState(null),[h,u]=t.useState(!0);t.useEffect(()=>{const e=setInterval(()=>{d(new Date)},1e3);return()=>clearInterval(e)},[]),t.useEffect(()=>{(async()=>{if(n)return m(n),void u(!1);u(!0);try{const e=await bt(a,r,l);m(e)}catch(e){}finally{u(!1)}})()},[a,r,l,n]);const g=[{id:"contacts",name:"通讯录",IconComponent:es,color:"from-gray-300/50 to-gray-400/50",onClick:()=>c("contacts")},{id:"wechat",name:"微信",IconComponent:Yt,color:"from-green-300/50 to-green-400/50",onClick:()=>c("wechat")},{id:"browser",name:"浏览器",IconComponent:Us,color:"from-blue-300/50 to-blue-400/50",onClick:()=>c("browser")},{id:"taobao",name:"淘宝",IconComponent:la,color:"from-orange-300/50 to-orange-400/50",onClick:()=>c("taobao")},{id:"alipay",name:"支付宝",IconComponent:na,color:"from-blue-400/50 to-blue-500/50",onClick:()=>c("alipay")},{id:"photos",name:"相册",IconComponent:ds,color:"from-pink-300/50 to-pink-400/50",onClick:()=>c("photos")},{id:"notes",name:"备忘录",IconComponent:ia,color:"from-yellow-300/50 to-yellow-400/50",onClick:()=>c("notes")},{id:"music",name:"音乐",IconComponent:Es,color:"from-red-300/50 to-red-400/50",onClick:()=>c("music")},{id:"footprints",name:"足迹",IconComponent:_s,color:"from-green-400/50 to-green-500/50",onClick:()=>c("footprints")}];return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:s}),e.jsxs("div",{className:"relative w-full max-w-md h-[80vh] max-h-[800px] bg-gradient-to-br from-white/95 to-white/80 backdrop-blur-2xl rounded-[3rem] shadow-[0_8px_32px_rgba(0,0,0,0.1)] border border-white/60 overflow-hidden",children:[e.jsxs("div",{className:"absolute top-0 left-0 right-0 h-14 bg-white/40 backdrop-blur-xl border-b border-white/40 flex items-center justify-between px-6 z-10",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-800",children:[r,"的手机"]}),e.jsx("button",{onClick:s,className:"w-8 h-8 rounded-full bg-white/60 hover:bg-white/80 flex items-center justify-center transition-all shadow-sm",children:e.jsx(oa,{size:18,className:"text-gray-700"})})]}),e.jsx("div",{className:"absolute top-14 bottom-8 left-0 right-0",children:h?e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center",children:[e.jsx("div",{className:"animate-spin w-16 h-16 border-4 border-gray-300 border-t-gray-700 rounded-full mb-4"}),e.jsxs("p",{className:"text-gray-600 font-medium",children:["正在生成",r,"的手机内容..."]}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:"根据聊天记录和性格定制中"})]}):i?e.jsxs("div",{className:"w-full h-full relative",children:[e.jsx("button",{onClick:()=>c(null),className:"absolute top-4 left-4 z-10 w-10 h-10 rounded-full bg-white/80 hover:bg-white/95 flex items-center justify-center transition-all shadow-lg backdrop-blur-md border border-white/50",children:e.jsx(da,{size:20,className:"text-gray-700"})}),(t=>{if(!x)return e.jsxs("div",{className:"w-full h-full bg-white/30 backdrop-blur-xl rounded-3xl p-6 flex flex-col items-center justify-center",children:[e.jsx("div",{className:"animate-spin w-12 h-12 border-3 border-gray-400 border-t-transparent rounded-full mb-4"}),e.jsx("p",{className:"text-gray-600 text-center font-medium",children:"加载中..."})]});switch(t){case"contacts":return e.jsx(bl,{content:x});case"wechat":return e.jsx(jl,{content:x});case"browser":return e.jsx(vl,{content:x});case"taobao":return e.jsx(yl,{content:x});case"alipay":return e.jsx(Nl,{content:x});case"photos":return e.jsx(wl,{content:x});case"notes":return e.jsx(kl,{content:x});case"music":return e.jsx(Cl,{content:x});case"footprints":return e.jsx(Sl,{content:x});default:return e.jsx("div",{className:"w-full h-full bg-white/30 backdrop-blur-xl rounded-3xl p-6 flex flex-col items-center justify-center",children:e.jsx("p",{className:"text-gray-600 text-center font-medium",children:"未知应用"})})}})(i)]}):e.jsxs("div",{className:"w-full h-full p-6 overflow-y-auto hide-scrollbar",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"text-6xl font-bold text-gray-800 mb-1",children:o.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})}),e.jsx("div",{className:"text-sm text-gray-500",children:o.toLocaleDateString("zh-CN",{month:"long",day:"numeric",weekday:"long"})})]}),e.jsx("div",{className:"grid grid-cols-3 gap-6",children:g.map(t=>{const s=t.IconComponent;return e.jsxs("button",{onClick:t.onClick,className:"flex flex-col items-center gap-2 ios-button",children:[e.jsx("div",{className:`w-16 h-16 bg-gradient-to-br ${t.color} backdrop-blur-md rounded-2xl shadow-lg border border-white/60 flex items-center justify-center hover:scale-105 transition-transform`,children:e.jsx(s,{size:28,className:"text-gray-700"})}),e.jsx("span",{className:"text-xs text-gray-800 font-medium text-center",children:t.name})]},t.id)})})]})}),e.jsx("div",{className:"absolute bottom-4 left-0 right-0 flex justify-center",children:e.jsx("div",{className:"w-32 h-1 bg-gray-900 rounded-full opacity-30"})})]})]})},_l=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{characters:r}=n(),[l,i]=t.useState(null),[c,o]=t.useState(null),[d,x]=t.useState([]),[m,h]=t.useState(0);t.useEffect(()=>{if(h(e=>e+1),r.length>0){const e=r.find(e=>jt(e.id).length>0);e&&o(e.id)}},[r]),t.useEffect(()=>{const e=vt.subscribe(e=>{x(e),e.some(e=>"completed"===e.status)&&h(e=>e+1)});return()=>{e()}},[]);return e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-gray-50 to-white",children:[e.jsx(xa,{}),e.jsx("div",{className:"sticky top-0 z-10 bg-white/80 backdrop-blur-lg border-b border-gray-200/50",children:e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsx("button",{onClick:()=>a(-1),className:"w-10 h-10 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center transition-colors",children:e.jsx(ls,{size:20,className:"text-gray-700"})}),e.jsx("h1",{className:"text-lg font-semibold text-gray-800",children:"选择角色"}),e.jsx("div",{className:"w-10"})]})}),e.jsx("div",{className:"p-4 space-y-3",children:0===r.length?e.jsxs("div",{className:"text-center py-20",children:[e.jsx("div",{className:"text-gray-400 mb-2",children:"暂无角色"}),e.jsx("div",{className:"text-sm text-gray-300",children:"请先在微信中添加AI角色"})]}):r.map(t=>{const s=jt(t.id),a=c===t.id;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsxs("button",{onClick:()=>(e=>{vt.startGeneration(e.id,e.name)})(t),className:"w-full p-4 flex items-center gap-4 hover:bg-gray-50 transition-all ios-button",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-blue-400/20 to-purple-400/20 flex items-center justify-center flex-shrink-0",children:t.avatar?e.jsx("img",{src:t.avatar,alt:t.name,className:"w-full h-full rounded-full object-cover"}):e.jsx("span",{className:"text-2xl text-gray-400",children:t.name[0]})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsxs("div",{className:"text-lg font-medium text-gray-800 flex items-center gap-2",children:[t.name,s.length>0&&!a&&e.jsxs("span",{className:"text-xs px-2 py-0.5 bg-blue-100 text-blue-600 rounded-full",children:[s.length,"条记录"]})]}),e.jsx("div",{className:"text-sm text-green-600 mt-1",children:"生成新内容"})]}),e.jsx("div",{className:"text-gray-300",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M9 18l6-6-6-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),s.length>0&&e.jsxs("button",{onClick:()=>{return e=t.id,void o(c===e?null:e);var e},className:"w-full px-4 py-2 border-t border-gray-100 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["历史记录 (",s.length,")"]}),e.jsx("svg",{className:"w-4 h-4 text-gray-400 transition-transform "+(a?"rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]}),a&&s.length>0&&e.jsx("div",{className:"ml-4 space-y-2",children:s.map(t=>e.jsxs("button",{onClick:()=>(e=>{i(e)})(t),className:"w-full bg-gray-50 rounded-xl p-3 border border-gray-200 hover:bg-gray-100 transition-all flex items-center gap-3 text-left",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-gradient-to-br from-gray-300/30 to-gray-400/30 flex items-center justify-center",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"5",y:"2",width:"14",height:"20",rx:"2",ry:"2"}),e.jsx("line",{x1:"12",y1:"18",x2:"12",y2:"18"})]})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:new Date(t.timestamp).toLocaleString("zh-CN",{month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"})}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"点击查看此次记录"})]}),e.jsx("div",{className:"text-gray-300",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M9 18l6-6-6-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]},t.id))})]},`${t.id}-${m}`)})}),d.length>0&&e.jsx("div",{className:"fixed bottom-4 right-4 z-50 space-y-2",children:d.map(t=>e.jsx("div",{className:"px-4 py-3 rounded-xl shadow-lg border backdrop-blur-md "+("generating"===t.status?"bg-blue-50/90 border-blue-200":"completed"===t.status?"bg-green-50/90 border-green-200":"bg-red-50/90 border-red-200"),children:e.jsxs("div",{className:"flex items-center gap-3",children:["generating"===t.status&&e.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full"}),"completed"===t.status&&e.jsx("div",{className:"text-green-500",children:"✓"}),"failed"===t.status&&e.jsx("div",{className:"text-red-500",children:"✕"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-800",children:t.characterName}),e.jsxs("div",{className:"text-xs text-gray-600 mt-0.5",children:["generating"===t.status&&"正在后台生成手机内容...","completed"===t.status&&"生成完成！","failed"===t.status&&"生成失败"]})]})]})},t.characterId))}),l&&e.jsx(Il,{characterId:l.characterId,characterName:l.characterName,onClose:()=>i(null),forceNew:!1,historyContent:l.content})]})}},Symbol.toStringTag,{value:"Module"})),Ml=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),l=x(),[n,i]=t.useState(""),[c,d]=t.useState([]),[m,h]=t.useState([]),[u,g]=t.useState([]),[p,f]=t.useState(!1),[b,j]=t.useState("local"),[v,y]=t.useState(!0);t.useEffect(()=>{const e=JSON.parse(localStorage.getItem("musicSearchHistory")||"[]");d(e)},[]);const N=async()=>{n.trim()&&(y(!1),(e=>{const t=[e,...c.filter(t=>t!==e)].slice(0,10);d(t),localStorage.setItem("musicSearchHistory",JSON.stringify(t))})(n),(e=>{if(!e.trim())return void h([]);const t=[...JSON.parse(localStorage.getItem("customSongs")||"[]")],s=e.toLowerCase(),a=t.filter(e=>e.title.toLowerCase().includes(s)||e.artist.toLowerCase().includes(s)||e.album.toLowerCase().includes(s));h(a)})(n),await(async e=>{if(e.trim()){f(!0);try{const t=await wa(e);g(t)}catch(t){g([])}finally{f(!1)}}else g([])})(n))};return e.jsxs("div",{className:"h-screen flex flex-col bg-gray-50",children:[r&&e.jsx(xa,{}),e.jsx("div",{className:"bg-white px-4 py-3 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-2 flex-nowrap",children:[e.jsx("button",{onClick:()=>a("/music-player",{replace:!0}),className:"w-10 h-10 flex items-center justify-center ios-button flex-shrink-0",children:e.jsx("svg",{className:"w-6 h-6 text-gray-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsxs("div",{className:"flex-1 min-w-0 flex items-center bg-gray-100 rounded-lg px-3 py-2",children:[e.jsx("svg",{className:"w-5 h-5 text-gray-400 mr-2 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),e.jsx("input",{type:"text",value:n,onChange:e=>i(e.target.value),onKeyPress:e=>"Enter"===e.key&&N(),placeholder:"搜索歌曲、歌手",className:"flex-1 min-w-0 bg-transparent outline-none text-gray-900 placeholder-gray-400",autoFocus:!0}),n&&e.jsx("button",{onClick:()=>{i(""),h([]),g([]),y(!0)},className:"ml-2 flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})})})]}),e.jsx("button",{onClick:N,className:"text-red-500 font-medium px-2 py-2 flex-shrink-0 whitespace-nowrap",children:"搜索"})]})}),v&&c.length>0&&e.jsxs("div",{className:"bg-white p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"搜索历史"}),e.jsx("button",{onClick:()=>{d([]),localStorage.removeItem("musicSearchHistory")},className:"text-xs text-gray-400 hover:text-gray-600",children:"清除"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:c.map((t,s)=>e.jsx("button",{onClick:()=>{i(t),N()},className:"bg-gray-100 text-gray-700 px-3 py-1.5 rounded-full text-sm hover:bg-gray-200",children:t},s))})]}),!v&&e.jsx("div",{className:"bg-white border-b border-gray-100",children:e.jsxs("div",{className:"flex",children:[e.jsxs("button",{onClick:()=>j("local"),className:"flex-1 py-3 text-center text-sm font-medium transition-colors "+("local"===b?"text-red-500 border-b-2 border-red-500":"text-gray-500"),children:["本地歌曲 (",m.length,")"]}),e.jsxs("button",{onClick:()=>j("online"),className:"flex-1 py-3 text-center text-sm font-medium transition-colors "+("online"===b?"text-red-500 border-b-2 border-red-500":"text-gray-500"),children:["在线歌曲 (",u.length,")"]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:p?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-red-500 mb-2"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"搜索中..."})]})}):e.jsxs(e.Fragment,{children:["local"===b&&e.jsx("div",{className:"bg-white",children:m.length>0?m.map((t,s)=>{return e.jsxs("div",{onClick:()=>((e,t)=>{l.setPlaylist(m),l.setCurrentSong(e,t),l.play(),setTimeout(()=>{a("/music-player")},100)})(t,s),className:"flex items-center gap-3 p-4 border-b border-gray-50 ios-button hover:bg-gray-50",children:[e.jsx("img",{src:t.cover,alt:t.title,className:"w-12 h-12 rounded-lg object-cover"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 truncate",children:t.title}),e.jsx("div",{className:"text-sm text-gray-500 truncate",children:t.artist})]}),e.jsx("div",{className:"text-xs text-gray-400",children:(r=t.duration,`${Math.floor(r/60)}:${Math.floor(r%60).toString().padStart(2,"0")}`)})]},t.id);var r}):n&&!v?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-400",children:[e.jsx("svg",{className:"w-16 h-16 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})}),e.jsx("p",{className:"text-sm",children:"未找到本地歌曲"})]}):null}),"online"===b&&e.jsx("div",{className:"bg-white",children:u.length>0?u.map((t,s)=>e.jsxs("div",{className:"flex items-center gap-3 p-4 border-b border-gray-50",children:[e.jsx("img",{src:t.cover,alt:t.name,className:"w-12 h-12 rounded-lg object-cover"}),e.jsxs("div",{className:"flex-1 min-w-0",onClick:()=>(async(e,t)=>{try{if(1===e.fee||4===e.fee)return void alert("该歌曲为付费歌曲，无法在线播放");const s=await ka(e.id);if(!s)return void alert("无法获取播放链接，可能是版权限制");const r=await Ca(e.id),n={id:e.id,title:e.name,artist:e.artists,album:e.album,duration:e.duration,cover:e.cover,audioUrl:s,lyrics:r||void 0};l.setCurrentSong(n,t),l.play(),setTimeout(()=>{a("/music-player")},100)}catch(s){alert("播放失败，请重试")}})(t,s),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"font-medium text-gray-900 truncate",children:t.name}),1===t.fee&&e.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-600 px-1.5 py-0.5 rounded",children:"VIP"}),4===t.fee&&e.jsx("span",{className:"text-xs bg-red-100 text-red-600 px-1.5 py-0.5 rounded",children:"付费"})]}),e.jsx("div",{className:"text-sm text-gray-500 truncate",children:t.artists})]}),e.jsx("button",{onClick:e=>{e.stopPropagation(),(async e=>{try{const t=await ka(e.id),s=await Ca(e.id);if(!t)return void alert("无法获取歌曲链接");const a=JSON.parse(localStorage.getItem("customSongs")||"[]"),r={id:Date.now(),title:e.name,artist:e.artists,album:e.album,duration:e.duration,cover:e.cover,audioUrl:t,lyrics:s||void 0,isOnline:!0};a.push(r),localStorage.setItem("customSongs",JSON.stringify(a)),alert("已添加到播放列表")}catch(t){alert("添加失败，请重试")}})(t)},className:"p-2 text-red-500 hover:bg-red-50 rounded-lg",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})})]},t.id)):n&&!v?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-400",children:[e.jsx("svg",{className:"w-16 h-16 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),e.jsx("p",{className:"text-sm",children:"未找到在线歌曲"}),e.jsx("p",{className:"text-xs mt-1",children:"请检查网络连接或尝试其他关键词"})]}):null})]})})]})}},Symbol.toStringTag,{value:"Module"})),zl=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const r=s(),l=a(),n=x(),{currentApi:i}=b(),[c,o]=t.useState(!0),d=l.state,[m,h]=t.useState([]),[u,g]=t.useState(""),[p,f]=t.useState(!1),j=t.useRef(null),v=t.useRef(null),y=n.currentSong,N=(null==y?void 0:y.lyrics)||"";t.useEffect(()=>{var e;if((null==d?void 0:d.song)&&n.playlist.length>0){const t=n.playlist.findIndex(e=>e.title.toLowerCase().includes(d.song.title.toLowerCase())||d.song.title.toLowerCase().includes(e.title.toLowerCase()));if(-1!==t){const s=n.playlist[t];(null==(e=n.currentSong)?void 0:e.id)!==s.id&&(n.setCurrentSong(s,t),n.play())}}},[d,n.playlist]);t.useEffect(()=>{var e;null==(e=j.current)||e.scrollIntoView({behavior:"smooth"})},[m]),t.useEffect(()=>{if(0===m.length){const e=(null==y?void 0:y.title)||(null==d?void 0:d.song.title)||"这首歌";h([{id:Date.now(),type:"ai",content:`嘿！我们正在一起听《${e}》~ 这首歌怎么样？想聊点什么吗？🎵`,timestamp:Date.now(),avatar:(null==d?void 0:d.characterAvatar)||"🎵"}])}},[y,d,m.length]);const w=()=>{if(!y)return"";const e=N.split("\n");let t="",s="";return e.forEach(e=>{const a=e.match(/\[(\d+):(\d+)\.(\d+)\](.*)/);if(a){const e=a[4].trim();e.includes("作词")||e.includes("作曲")||e.includes("编曲")?t+=e+"\n":e&&(s+=e+"\n")}}),`当前正在播放的歌曲信息：\n歌曲名：${y.title}\n歌手：${y.artist}\n专辑：${y.album}\n${t?`制作信息：\n${t}`:""}\n${s?`歌词：\n${s.substring(0,500)}${s.length>500?"...":""}`:""}\n\n你是一个热爱音乐的AI助手，正在和用户一起听歌。请基于当前歌曲的信息与用户聊天，可以谈论歌词含义、情感表达、音乐风格、歌手故事等。回复要自然、有趣，像朋友聊天一样。`},k=async()=>{const e=u.trim();if(!e&&!p)return void(await C());if(!e)return;const t={id:Date.now(),type:"user",content:e,timestamp:Date.now()};h(e=>[...e,t]),g(""),await S(e)},C=async()=>{var e,t,s;if(!p){f(!0);try{const a=`${w()}\n\n请主动说点什么，可以评论这首歌、分享感受，或者询问用户的想法。`;if(!i)throw new Error("未配置API");const r=await fetch(i.baseUrl,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i.apiKey}`},body:JSON.stringify({model:i.model,messages:[{role:"system",content:a}],temperature:.8})}),l=(null==(s=null==(t=null==(e=(await r.json()).choices)?void 0:e[0])?void 0:t.message)?void 0:s.content)||"听着这首歌，感觉真好~ 🎵",n={id:Date.now(),type:"ai",content:l,timestamp:Date.now(),avatar:"🎵"};h(e=>[...e,n])}catch(a){const e={id:Date.now(),type:"ai",content:"哎呀，我正在沉浸在音乐中...稍等一下~",timestamp:Date.now(),avatar:"🎵"};h(t=>[...t,e])}finally{f(!1)}}},S=async e=>{var t,s,a;f(!0);try{const r=w(),l=m.slice(-6).map(e=>({role:"user"===e.type?"user":"assistant",content:e.content}));if(!i)throw new Error("未配置API");const n=await fetch(i.baseUrl,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i.apiKey}`},body:JSON.stringify({model:i.model,messages:[{role:"system",content:r},...l,{role:"user",content:e}],temperature:.8})}),c=(null==(a=null==(s=null==(t=(await n.json()).choices)?void 0:t[0])?void 0:s.message)?void 0:a.content)||"嗯...让我想想~",o={id:Date.now(),type:"ai",content:c,timestamp:Date.now(),avatar:"🎵"};h(e=>[...e,o])}catch(r){}finally{f(!1)}};return c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 transition-opacity duration-300",onClick:()=>{o(!1),setTimeout(()=>{r(-1)},300)}}),e.jsxs("div",{className:"fixed inset-x-0 bottom-0 z-50 bg-white rounded-t-3xl shadow-2xl transition-transform duration-300 flex flex-col",style:{height:"70vh",transform:c?"translateY(0)":"translateY(100%)"},onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"flex flex-col items-center pt-3 pb-2 border-b border-gray-100",children:[e.jsx("div",{className:"w-12 h-1 bg-gray-300 rounded-full mb-3"}),e.jsxs("div",{className:"text-center px-4 pb-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:(null==d?void 0:d.characterName)?`正在和 ${d.characterName} 一起听`:"一起听"}),e.jsxs("div",{className:"text-xs text-gray-500 truncate mt-0.5",children:[(null==y?void 0:y.title)||(null==d?void 0:d.song.title)," - ",(null==y?void 0:y.artist)||(null==d?void 0:d.song.artist)]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-4",children:[m.map(t=>e.jsxs("div",{className:"flex items-end gap-2 mb-4 "+("user"===t.type?"flex-row-reverse":"flex-row"),children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center text-sm font-medium "+("user"===t.type?"bg-gradient-to-br from-blue-400 to-blue-600 text-white":"bg-gradient-to-br from-red-400 to-pink-500 text-white"),children:"user"===t.type?"我":"🎵"}),e.jsx("div",{style:{maxWidth:"70%",display:"inline-block"},children:e.jsx("div",{className:"message-bubble px-3 py-2",style:{backgroundColor:"user"===t.type?"#95EC69":"#FFFFFF",borderRadius:"8px",boxShadow:"0 1px 4px rgba(0,0,0,0.08)",wordBreak:"break-word",whiteSpace:"pre-wrap",color:"#111827",fontSize:"14px",maxWidth:"100%",overflowWrap:"break-word"},children:e.jsx("div",{style:{position:"relative",zIndex:2},children:t.content})})})]},t.id)),p&&e.jsxs("div",{className:"flex items-end gap-2 mb-4",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-gradient-to-br from-red-400 to-pink-500 flex items-center justify-center text-white text-sm font-medium",children:"🎵"}),e.jsx("div",{className:"bg-white px-4 py-3 rounded-lg shadow-sm",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})]}),e.jsx("div",{ref:j})]}),e.jsx("div",{className:"bg-white border-t border-gray-100 px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{ref:v,type:"text",value:u,onChange:e=>g(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),k())},placeholder:"说点什么...",className:"flex-1 bg-gray-100 border-none rounded-full px-4 py-2 text-sm focus:outline-none focus:ring-0"}),u.trim()?e.jsx("button",{onClick:k,disabled:p,className:"w-10 h-10 flex items-center justify-center ios-button bg-wechat-green text-white rounded-full shadow-lg disabled:opacity-50 transition-all duration-200",children:e.jsx(is,{size:18})}):e.jsx("button",{onClick:k,disabled:p,className:"w-10 h-10 flex items-center justify-center ios-button text-gray-700 disabled:opacity-50 transition-all duration-200",children:e.jsx(is,{size:22})})]})})]})]}):null}},Symbol.toStringTag,{value:"Module"})),$l=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),[l,n]=t.useState([{id:1,type:"received",content:"嘿！我正在听这首歌，超好听的！",timestamp:Date.now()-6e4},{id:2,type:"musicInvite",inviterName:"汐汐",songTitle:"别哭了我爱你",songArtist:"周杰伦",timestamp:Date.now()-3e4,status:"pending"},{id:3,type:"received",content:"一起听吧～",timestamp:Date.now()-2e4}]);return e.jsxs("div",{className:"h-screen flex flex-col bg-gray-50",children:[r&&e.jsx(xa,{}),e.jsxs("div",{className:"bg-white px-4 py-3 flex items-center justify-between border-b border-gray-100 shadow-sm",children:[e.jsx("button",{onClick:()=>a("/music-player",{replace:!0}),className:"w-10 h-10 flex items-center justify-center ios-button",children:e.jsx("svg",{className:"w-6 h-6 text-gray-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("h1",{className:"text-lg font-medium text-gray-900",children:"一起听邀请卡片示例"}),e.jsx("div",{className:"w-10"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-4",children:l.map(t=>e.jsx("div",{className:"flex mb-4 "+("received"===t.type||"musicInvite"===t.type?"justify-start":"justify-end"),children:"musicInvite"===t.type?e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-gradient-to-br from-pink-400 to-rose-500 flex items-center justify-center text-white text-sm font-medium",children:"汐"}),e.jsx(ja,{inviterName:t.inviterName,songTitle:t.songTitle,songArtist:t.songArtist,songCover:t.songCover,status:t.status,onAccept:()=>{return e=t.id,void n(t=>t.map(t=>t.id===e&&"musicInvite"===t.type?{...t,status:"accepted"}:t));var e},onReject:()=>{return e=t.id,void n(t=>t.map(t=>t.id===e&&"musicInvite"===t.type?{...t,status:"rejected"}:t));var e}})]}):e.jsxs("div",{className:"flex items-end gap-2",children:["received"===t.type&&e.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-gradient-to-br from-pink-400 to-rose-500 flex items-center justify-center text-white text-sm font-medium",children:"汐"}),e.jsx("div",{className:"message-bubble px-3 py-2 max-w-[70%]",style:{backgroundColor:"received"===t.type?"#FFFFFF":"#95EC69",borderRadius:"8px",boxShadow:"0 1px 4px rgba(0,0,0,0.08)",color:"#111827",fontSize:"14px"},children:t.content})]})},t.id))}),e.jsxs("div",{className:"bg-white border-t border-gray-100 px-4 py-3",children:[e.jsx("div",{className:"text-sm text-gray-600 text-center",children:'这是"一起听"邀请卡片的示例展示'}),e.jsx("div",{className:"text-xs text-gray-400 text-center mt-1",children:'点击"接受"或"拒绝"查看效果'})]})]})}},Symbol.toStringTag,{value:"Module"})),Ll=15,Al=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{id:l}=r(),{showStatusBar:i}=o(),{getCharacter:c}=n(),d=l?c(l):null,[x,m]=t.useState(!0),[h,u]=t.useState("black"),[g,p]=t.useState(D()),[f,b]=t.useState("black"),[j,v]=t.useState(!1),[y,N]=t.useState(null),[w,k]=t.useState(!1),[C,S]=t.useState([]),[I,_]=t.useState([]),[M,z]=t.useState(""),[$,L]=t.useState(!1),A=t.useRef(null),T=t.useRef(null);function D(){return Array(Ll).fill(null).map(()=>Array(Ll).fill("empty"))}t.useEffect(()=>{E()},[g]),t.useEffect(()=>{var e;null==(e=A.current)||e.scrollIntoView({behavior:"smooth"})},[I]);const B=e=>{"player"===e?(u("black"),b("black"),V(`你选择了黑棋先手，${null==d?void 0:d.name} 是白棋。`)):(u("white"),b("black"),k(!0),V(`${null==d?void 0:d.name} 选择了黑棋先手，你是白棋。点击"AI回复"让TA下棋。`)),m(!1)},E=()=>{const e=T.current;if(!e)return;const t=e.getContext("2d");if(!t)return;const s=e.width/Ll;t.fillStyle="#DEB887",t.fillRect(0,0,e.width,e.height),t.strokeStyle="#000",t.lineWidth=1;for(let r=0;r<Ll;r++)t.beginPath(),t.moveTo(s/2,r*s+s/2),t.lineTo(e.width-s/2,r*s+s/2),t.stroke(),t.beginPath(),t.moveTo(r*s+s/2,s/2),t.lineTo(r*s+s/2,e.height-s/2),t.stroke();const a=[3,7,11];t.fillStyle="#000",a.forEach(e=>{a.forEach(a=>{t.beginPath(),t.arc(e*s+s/2,a*s+s/2,4,0,2*Math.PI),t.fill()})}),g.forEach((e,a)=>{e.forEach((e,r)=>{"empty"!==e&&(t.beginPath(),t.arc(r*s+s/2,a*s+s/2,.4*s,0,2*Math.PI),t.fillStyle="black"===e?"#000":"#fff",t.fill(),t.strokeStyle="#000",t.lineWidth=1,t.stroke())})})},P=(e,t,s)=>{const a=g.map(e=>[...e]);if(a[t][e]=s,p(a),S(a=>[...a,{x:e,y:t,player:s}]),W(a,e,t,s)){v(!0);const e=s===h?"你":(null==d?void 0:d.name)||"AI";return N(e),void V(`${e} 赢了！`)}if(R(a))return v(!0),void V("平局！");b("black"===s?"white":"black"),s===h&&k(!0)},F=async()=>{if(w&&!$&&!j){L(!0),k(!1);try{const e="black"===h?"white":"black",t=g.map(e=>e.map(e=>"empty"===e?".":"black"===e?"X":"O").join("")).join("\n"),s=I.filter(e=>"system"!==e.type).slice(-6).map(e=>`${"user"===e.type?"你":null==d?void 0:d.name}: ${e.content}`).join("\n"),a=`我们正在下五子棋。你是${"black"===e?"黑棋(X)":"白棋(O)"}，我是${"black"===h?"黑棋(X)":"白棋(O)"}。\n\n当前棋盘状态（15x15）：\n${t}\n\n${s?`最近的聊天：\n${s}\n`:""}\n${M?`我说：${M}\n`:""}\n请你：\n1. 决定下一步的位置（格式：x,y，坐标从0到14）\n2. 说一些话（可以评论棋局、回复我的话、或者闲聊）\n\n**必须**用这个格式回复：\n位置: x,y\n说话: [你想说的话]`,r={role:"system",content:(null==d?void 0:d.description)||"你是一个五子棋高手，性格活泼健谈。"},l={role:"user",content:a},n=await U([r,l]),i=n.match(/位置[：:]\s*(\d+)\s*[,，]\s*(\d+)/),c=n.match(/说话[：:]\s*(.+)/s);let o,x;if(i){if(o=parseInt(i[1]),x=parseInt(i[2]),o<0||o>=Ll||x<0||x>=Ll||"empty"!==g[x][o]){const t=O(g,e);o=t.x,x=t.y}}else{const t=O(g,e);o=t.x,x=t.y}P(o,x,e),J(c?c[1].trim():`我下在 (${o}, ${x})`),z("")}catch(e){const t="black"===h?"white":"black",s=O(g,t);P(s.x,s.y,t),J(`我下在 (${s.x}, ${s.y})`),z("")}finally{L(!1)}}},O=(e,t)=>{const s="black"===t?"white":"black";for(let r=0;r<Ll;r++)for(let s=0;s<Ll;s++)if("empty"===e[r][s]){const a=e.map(e=>[...e]);if(a[r][s]=t,W(a,s,r,t))return{x:s,y:r}}for(let r=0;r<Ll;r++)for(let t=0;t<Ll;t++)if("empty"===e[r][t]){const a=e.map(e=>[...e]);if(a[r][t]=s,W(a,t,r,s))return{x:t,y:r}}const a=Math.floor(7.5);for(let r=0;r<Ll;r++)for(let t=Math.max(0,a-r);t<=Math.min(14,a+r);t++)for(let s=Math.max(0,a-r);s<=Math.min(14,a+r);s++)if("empty"===e[t][s])return{x:s,y:t};return{x:a,y:a}},W=(e,t,s,a)=>{const r=[[1,0],[0,1],[1,1],[1,-1]];for(const[l,n]of r){let r=1;for(let i=1;i<5;i++){const c=t+l*i,o=s+n*i;if(c<0||c>=Ll||o<0||o>=Ll||e[o][c]!==a)break;r++}for(let i=1;i<5;i++){const c=t-l*i,o=s-n*i;if(c<0||c>=Ll||o<0||o>=Ll||e[o][c]!==a)break;r++}if(r>=5)return!0}return!1},R=e=>e.every(e=>e.every(e=>"empty"!==e)),V=e=>{const t={id:`system_${Date.now()}`,type:"system",content:e,timestamp:Date.now()};_(e=>[...e,t])},J=e=>{const t={id:`ai_${Date.now()}`,type:"ai",content:e,timestamp:Date.now()};_(e=>[...e,t])};return d?e.jsxs("div",{className:"h-screen flex flex-col bg-gradient-to-br from-amber-50 to-orange-50",children:[i&&e.jsx(xa,{}),x&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"glass-card rounded-3xl p-6 w-full max-w-sm",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4 text-center",children:"选择先手"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>B("player"),className:"w-full glass-card rounded-xl py-4 text-center ios-button hover:shadow-lg transition-shadow",children:[e.jsx("div",{className:"font-bold text-gray-900 mb-1",children:"我先下（黑棋）"}),e.jsx("div",{className:"text-xs text-gray-500",children:"黑棋先手有优势"})]}),e.jsxs("button",{onClick:()=>B("ai"),className:"w-full glass-card rounded-xl py-4 text-center ios-button hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"font-bold text-gray-900 mb-1",children:[d.name," 先下（黑棋）"]}),e.jsx("div",{className:"text-xs text-gray-500",children:"让TA先手试试"})]})]})]})}),e.jsxs("div",{className:"glass-effect px-4 py-3 border-b border-gray-200/50 flex items-center",children:[e.jsx("button",{onClick:()=>a(-1),className:"w-8 h-8 flex items-center justify-center ios-button",children:e.jsx("span",{className:"text-blue-500 text-xl",children:"‹"})}),e.jsxs("div",{className:"flex-1 flex items-center justify-center gap-2",children:[e.jsx("img",{src:d.avatar,alt:d.name,className:"w-8 h-8 rounded-full"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[d.name," - 五子棋"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{if(0===C.length||$||w)return;const e=C.length>=2?2:1,t=C.slice(0,-e);S(t);const s=D();t.forEach(e=>{s[e.y][e.x]=e.player}),p(s),v(!1),N(null),k(!1),b(0===t.length?"black":"black"===t[t.length-1].player?"white":"black"),V("已悔棋")},disabled:0===C.length||$||w,className:"text-blue-500 text-sm ios-button font-medium disabled:opacity-30",children:"悔棋"}),e.jsx("button",{onClick:()=>{p(D()),b("black"),v(!1),N(null),_([]),S([]),k(!1),m(!0)},className:"text-blue-500 text-sm ios-button font-medium",children:"重开"})]})]}),e.jsx("div",{className:"flex-shrink-0 p-4 flex justify-center bg-white",children:e.jsx("canvas",{ref:T,width:450,height:450,onClick:e=>{if(j||x||$)return;if(f!==h)return;const t=T.current;if(!t)return;const s=t.getBoundingClientRect(),a=t.width/Ll,r=Math.floor((e.clientX-s.left)/a),l=Math.floor((e.clientY-s.top)/a);r>=0&&r<Ll&&l>=0&&l<Ll&&"empty"===g[l][r]&&P(r,l,h)},className:"border border-gray-300 rounded-lg shadow-lg cursor-pointer"})}),e.jsx("div",{className:"flex-shrink-0 px-4 py-2 text-center",children:j?e.jsx("div",{className:"text-lg font-bold text-gray-900",children:y?`${y} 获胜！`:"平局！"}):e.jsx("div",{className:"text-sm text-gray-600",children:$?`${d.name} 正在思考...`:w?`等待 ${d.name} 回复（点击下方"AI回复"按钮）`:f===h?`你的回合（${"black"===h?"黑棋":"白棋"}）`:`${d.name} 的回合（${"black"===h?"白棋":"黑棋"}）`})}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-4 pb-2",children:[I.map(t=>e.jsx("div",{className:"mb-2 "+("user"===t.type?"flex justify-end":""),children:"system"===t.type?e.jsx("div",{className:"text-center text-xs text-gray-500 py-1",children:t.content}):"ai"===t.type?e.jsxs("div",{className:"flex gap-2 max-w-[80%]",children:[e.jsx("img",{src:d.avatar,alt:"",className:"w-8 h-8 rounded-full flex-shrink-0"}),e.jsx("div",{className:"glass-card rounded-2xl px-4 py-2",children:e.jsx("p",{className:"text-sm text-gray-900 whitespace-pre-wrap",children:t.content})})]}):e.jsx("div",{className:"bg-blue-500 text-white rounded-2xl px-4 py-2 max-w-[80%]",children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:t.content})})},t.id)),e.jsx("div",{ref:A})]}),e.jsx("div",{className:"flex-shrink-0 glass-effect border-t border-gray-200/50 p-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:M,onChange:e=>z(e.target.value),onKeyPress:e=>"Enter"===e.key&&F(),placeholder:w?"说点什么...":"和TA聊聊天...",disabled:$||j,className:"flex-1 glass-card rounded-xl px-4 py-2 text-sm border-none outline-none"}),e.jsx("button",{onClick:F,disabled:!w||$||j,className:"bg-blue-500 text-white rounded-xl px-6 py-2 text-sm font-medium ios-button disabled:opacity-50",children:$?"思考中...":M.trim()?"发送":"AI回复"})]})})]}):e.jsx("div",{children:"角色不存在"})}},Symbol.toStringTag,{value:"Module"})),Tl=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const t=s(),{characters:a}=n(),{showStatusBar:r}=o();return e.jsxs("div",{className:"h-screen flex flex-col bg-gradient-to-br from-blue-50 to-purple-50",children:[r&&e.jsx(xa,{}),e.jsxs("div",{className:"glass-effect px-4 py-3 border-b border-gray-200/50 flex items-center",children:[e.jsx("button",{onClick:()=>t(-1),className:"w-8 h-8 flex items-center justify-center ios-button",children:e.jsx("span",{className:"text-blue-500 text-xl",children:"‹"})}),e.jsx("h1",{className:"flex-1 text-center text-lg font-semibold text-gray-900",children:"选择对手"}),e.jsx("div",{className:"w-8"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar p-4",children:[e.jsx("div",{className:"space-y-3",children:a.map(s=>e.jsx("div",{onClick:()=>t(`/gomoku/${s.id}`),className:"glass-card rounded-2xl p-4 ios-button cursor-pointer hover:shadow-lg transition-shadow",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:s.avatar,alt:s.name,className:"w-14 h-14 rounded-full object-cover shadow-sm"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-gray-900 text-base mb-1",children:s.name}),e.jsx("p",{className:"text-sm text-gray-500 line-clamp-2",children:s.description})]}),e.jsx("div",{className:"text-gray-300 text-2xl",children:"›"})]})},s.id))}),0===a.length&&e.jsxs("div",{className:"glass-card rounded-2xl p-8 text-center",children:[e.jsx("div",{className:"text-gray-500 text-sm mb-2",children:"还没有AI角色"}),e.jsx("button",{onClick:()=>t("/create-character"),className:"text-blue-500 text-sm font-medium",children:"创建角色"})]})]})]})}},Symbol.toStringTag,{value:"Module"})),Dl=()=>e.jsxs("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"8",y1:"4",x2:"8",y2:"20"}),e.jsx("line",{x1:"16",y1:"4",x2:"16",y2:"20"}),e.jsx("line",{x1:"4",y1:"8",x2:"20",y2:"8"}),e.jsx("line",{x1:"4",y1:"16",x2:"20",y2:"16"})]}),Bl=()=>e.jsxs("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"3",y:"5",width:"7",height:"10",rx:"1"}),e.jsx("rect",{x:"14",y:"9",width:"7",height:"10",rx:"1"}),e.jsx("text",{x:"6.5",y:"12",fontSize:"6",fill:"currentColor",textAnchor:"middle",children:"A"}),e.jsx("text",{x:"17.5",y:"16",fontSize:"6",fill:"currentColor",textAnchor:"middle",children:"K"})]}),El=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const t=s(),{showStatusBar:a}=o(),r=[{id:1,name:"五子棋",description:"经典五子棋对战，和AI一较高下",icon:"/zhizhi/assets/gomoku-icon-Dv90YLQ_.webp",path:"/game-select",color:"bg-blue-500",available:!0},{id:2,name:"谁是卧底",description:"和AI一起玩语言推理游戏",icon:"/zhizhi/assets/undercover-icon-Cxh46JWO.webp",path:"/game/undercover/solo",color:"bg-purple-500",available:!0},{id:3,name:"井字棋",description:"简单有趣的三子棋游戏",icon:Dl,path:"",color:"bg-green-500",available:!1},{id:4,name:"21点",description:"和AI比拼运气和策略",icon:Bl,path:"",color:"bg-red-500",available:!1}];return e.jsxs("div",{className:"h-screen flex flex-col bg-gray-50",children:[a&&e.jsx(xa,{}),e.jsxs("div",{className:"glass-effect px-4 py-3 border-b border-gray-200/50 flex items-center",children:[e.jsx("button",{onClick:()=>t(-1),className:"w-8 h-8 flex items-center justify-center ios-button",children:e.jsx("span",{className:"text-blue-500 text-xl",children:"‹"})}),e.jsx("h1",{className:"flex-1 text-center text-lg font-semibold text-gray-900",children:"小游戏"}),e.jsx("div",{className:"w-8"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar p-4",children:[e.jsx("div",{className:"space-y-3",children:r.map(s=>e.jsx("div",{onClick:()=>s.available&&t(s.path),className:`glass-card rounded-2xl p-5 ${s.available?"ios-button cursor-pointer hover:shadow-lg":"opacity-50"} transition-shadow`,children:e.jsxs("div",{className:"flex items-center gap-4",children:["string"==typeof s.icon?e.jsx("img",{src:s.icon,alt:s.name,className:"w-16 h-16 object-contain flex-shrink-0"}):e.jsx("div",{className:`w-16 h-16 rounded-2xl ${s.color} flex items-center justify-center shadow-lg flex-shrink-0 text-white`,children:e.jsx(s.icon,{})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-bold text-gray-900 text-base",children:s.name}),!s.available&&e.jsx("span",{className:"px-2 py-0.5 bg-gray-200 text-gray-500 text-xs rounded-lg font-medium",children:"敬请期待"})]}),e.jsx("p",{className:"text-sm text-gray-500 leading-relaxed",children:s.description})]}),s.available&&e.jsx("div",{className:"text-gray-300 text-2xl flex-shrink-0",children:"›"})]})},s.id))}),e.jsxs("div",{className:"mt-6 glass-card rounded-2xl p-6 text-center",children:[e.jsx("div",{className:"text-gray-400 text-sm mb-1",children:"更多游戏"}),e.jsx("div",{className:"text-gray-500 text-xs",children:"即将上线，敬请期待"})]})]})]})}},Symbol.toStringTag,{value:"Module"})),Pl=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{var a,r,l;const i=s(),{showStatusBar:c}=o(),{characters:d}=n(),[x,m]=t.useState({status:"setup",players:[],currentRound:0,descriptions:{},votes:{},eliminatedPlayer:null,announcement:"",winner:null,civilianWord:"",undercoverWord:""}),[h,u]=t.useState([]),[g,p]=t.useState(""),[f,b]=t.useState(null),[j,v]=t.useState(!1),[y,N]=t.useState(!1),[w,k]=t.useState([]),[C,S]=t.useState(null),[I,_]=t.useState(""),[M,z]=t.useState([]),[$,L]=t.useState(!1),[A,T]=t.useState([]);t.useEffect(()=>{if(0===M.length)return;const[e,...t]=M;S(e.playerId),_(e.text);const s=setTimeout(()=>{S(null),_(""),z(t)},3e3);return()=>clearTimeout(s)},[M]);const D=x.players.filter(e=>!e.isOut),B=x.players.find(e=>"user"===e.id);return e.jsxs("div",{className:"h-screen flex flex-col bg-gradient-to-br from-purple-50 to-pink-50",children:[c&&e.jsx(xa,{}),e.jsxs("div",{className:"glass-effect px-4 py-3 border-b border-gray-200/50 flex items-center",children:[e.jsx("button",{onClick:()=>i("/desktop",{replace:!0}),className:"w-8 h-8 flex items-center justify-center ios-button",children:e.jsx("span",{className:"text-blue-500 text-xl",children:"‹"})}),e.jsx("h1",{className:"flex-1 text-center text-lg font-semibold text-gray-900",children:"谁是卧底"}),e.jsx("button",{onClick:()=>N(!0),className:"w-8 h-8 flex items-center justify-center ios-button",children:e.jsx("span",{className:"text-blue-500 text-xl",children:"？"})})]}),y&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"glass-card rounded-3xl p-6 w-full max-w-md max-h-[80vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"游戎规则"}),e.jsxs("div",{className:"space-y-3 text-sm text-gray-700",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-gray-900 mb-1",children:"🎯 游戏目标"}),e.jsx("p",{children:"找出谁是卧底！平民要淘汰卧底，卧底要隐藏到最后。"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-gray-900 mb-1",children:"🎲 角色分配"}),e.jsxs("p",{children:["每个人都会得到一个词语，大部分人是",e.jsx("strong",{children:"平民"}),"（相同词语），1人是",e.jsx("strong",{children:"卧底"}),"（相似但不同的词语）。"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-gray-900 mb-1",children:"💬 描述阶段"}),e.jsxs("p",{children:["每人轮流用一句话描述自己的词语，但",e.jsx("strong",{children:"不能说出词语本身"}),"。要既让同伴明白，又不能让卧底猜到。"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-gray-900 mb-1",children:"🗳️ 投票阶段"}),e.jsx("p",{children:"所有人描述完后，每人投票选出你认为的卧底。得票最多的人被淘汰。"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-gray-900 mb-1",children:"🏆 胜利条件"}),e.jsxs("p",{children:[e.jsx("strong",{children:"平民胜利"}),"：淘汰所有卧底",e.jsx("br",{}),e.jsx("strong",{children:"卧底胜利"}),"：剩余人数≤3人且卧底还在"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-gray-900 mb-1",children:"⚠️ 注意"}),e.jsxs("p",{children:["你",e.jsx("strong",{children:"不知道"}),"自己是平民还是卧底，只能通过别人的描述来推测！"]})]})]}),e.jsx("button",{onClick:()=>N(!1),className:"w-full mt-6 bg-blue-500 text-white rounded-xl py-3 font-medium ios-button",children:"知道了"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar p-4",children:["setup"===x.status&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"glass-card rounded-2xl p-5",children:[e.jsx("h2",{className:"font-bold text-gray-900 mb-2",children:"选择AI玩家"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"选择2-8个AI角色一起玩"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:d.map(t=>e.jsx("div",{onClick:()=>{return e=t.id,void(h.includes(e)?u(h.filter(t=>t!==e)):h.length<8&&u([...h,e]));var e},className:"glass-card rounded-xl p-3 ios-button cursor-pointer transition-all "+(h.includes(t.id)?"ring-2 ring-blue-500":""),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:t.avatar,alt:t.name,className:"w-10 h-10 rounded-full"}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("div",{className:"font-medium text-gray-900 text-sm truncate",children:t.name})}),h.includes(t.id)&&e.jsx("div",{className:"text-blue-500 text-xl",children:"✓"})]})},t.id))}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx("button",{onClick:()=>N(!0),className:"text-blue-500 text-sm ios-button",children:"📖 查看游戏规则"})}),e.jsxs("div",{className:"text-center text-sm text-gray-500",children:["已选择 ",h.length," 个AI"]})]}),e.jsx("button",{onClick:async()=>{if(!(h.length<2)){v(!0);try{const t=h.map(e=>{const t=d.find(t=>t.id===e);return{id:e,name:t.name,avatar:t.avatar}}),s=`你是"谁是卧底"游戏主持人。\n玩家：${["你",...t.map(e=>e.name)].join("、")}（共${h.length+1}人）\n\n请：\n1. 选择一对相似的词语（平民词、卧底词）\n2. 随机分配：1个卧底，其他都是平民\n3. 宣布游戏开始\n\n**严格**按照以下JSON格式返回：\n{\n  "civilianWord": "平民词",\n  "undercoverWord": "卧底词",\n  "playerWords": {\n    "user": "词语",\n    "ai_0": "词语",\n    "ai_1": "词语"\n  },\n  "announcement": "游戏开始的话"\n}`,a=await U([{role:"system",content:"你是游戏主持人，只返回JSON格式数据，不要有其他文字。"},{role:"user",content:s}]);let r;try{const e=a.match(/\{[\s\S]*\}/);if(!e)throw new Error("未找到JSON格式");r=JSON.parse(e[0])}catch(e){throw alert("AI返回格式错误，请重试"),e}const l=[{id:"user",name:"你",avatar:"https://api.dicebear.com/7.x/avataaars/svg?seed=user",isAI:!1,word:r.playerWords.user,isOut:!1},...t.map((e,t)=>({id:`ai_${t}`,name:e.name,avatar:e.avatar,isAI:!0,word:r.playerWords[`ai_${t}`],isOut:!1}))],n=[...l.map(e=>e.id)].sort(()=>Math.random()-.5);k(n),m({status:"describing",players:l,currentRound:1,descriptions:{},votes:{},eliminatedPlayer:null,announcement:r.announcement,winner:null,civilianWord:r.civilianWord,undercoverWord:r.undercoverWord})}catch(t){alert("游戏启动失败，请重试")}finally{v(!1)}}},disabled:h.length<2||j,className:"w-full bg-blue-500 text-white rounded-xl py-3 font-medium ios-button disabled:opacity-50",children:j?"准备中...":"开始游戏"})]}),"setup"!==x.status&&"finished"!==x.status&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"glass-card rounded-2xl p-6",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsxs("div",{className:"text-lg font-bold text-gray-900",children:["第 ",x.currentRound," 轮"]}),e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:"describing"===x.status?"描述阶段":"投票阶段"})]}),e.jsxs("div",{className:"relative w-full aspect-square max-w-sm mx-auto",children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"glass-card rounded-full w-32 h-32 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl mb-1",children:"🎭"}),e.jsxs("div",{className:"text-xs text-gray-600",children:["剩余 ",D.length," 人"]})]})})}),D.map((t,s)=>{const a=360*s/D.length-90,r=50+42*Math.cos(a*Math.PI/180),l=50+42*Math.sin(a*Math.PI/180),n=C===t.id,i=A.includes(t.id);return e.jsx("div",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 transition-all duration-300 "+(n?"scale-110 z-10":""),style:{left:`${r}%`,top:`${l}%`},children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-16 h-16 rounded-full overflow-hidden border-4 transition-all "+(n?"border-blue-500 shadow-lg shadow-blue-500/50":t.isOut?"border-gray-300 opacity-50":"border-white"),children:e.jsx("img",{src:t.avatar,alt:t.name,className:"w-full h-full object-cover"})}),n&&e.jsx("div",{className:"absolute -top-1 -right-1 w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center animate-pulse",children:e.jsx("span",{className:"text-white text-xs",children:"💬"})}),i&&"voting"===x.status&&e.jsx("div",{className:"absolute -bottom-1 -right-1 w-6 h-6 bg-green-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs",children:"✓"})}),e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 mt-1 whitespace-nowrap",children:e.jsx("div",{className:"text-xs font-medium px-2 py-1 rounded-full "+(n?"bg-blue-500 text-white":"bg-white text-gray-700"),children:t.name})})]})},t.id)})]})]}),e.jsxs("div",{className:"glass-card rounded-2xl p-4",children:[B&&e.jsxs("div",{className:"bg-blue-50 rounded-xl p-3 mb-3",children:[e.jsx("div",{className:"text-xs text-blue-600 mb-1",children:"你的词语"}),e.jsx("div",{className:"text-2xl font-bold text-blue-900",children:B.word})]}),x.announcement&&e.jsx("div",{className:"bg-gray-50 rounded-xl p-3",children:e.jsx("div",{className:"text-sm text-gray-700",children:x.announcement})}),C&&I&&e.jsx("div",{className:"mt-3 animate-slide-up",children:e.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-purple-500 rounded-2xl p-4 text-white shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full overflow-hidden border-2 border-white",children:e.jsx("img",{src:null==(a=x.players.find(e=>e.id===C))?void 0:a.avatar,alt:"",className:"w-full h-full object-cover"})}),e.jsx("div",{className:"font-medium",children:null==(r=x.players.find(e=>e.id===C))?void 0:r.name}),e.jsx("div",{className:"flex-1"}),e.jsx("div",{className:"animate-pulse",children:"💬"})]}),e.jsx("div",{className:"text-sm leading-relaxed",children:I})]})})]}),"describing"===x.status&&e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"glass-card rounded-2xl p-4",children:[e.jsx("h3",{className:"font-bold text-gray-900 mb-3",children:"描述你的词语"}),x.descriptions.user?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-green-50 rounded-xl p-3",children:[e.jsx("div",{className:"text-xs text-green-600 mb-1",children:"你的描述"}),e.jsx("div",{className:"text-sm text-gray-900",children:x.descriptions.user})]}),e.jsx("button",{onClick:async()=>{if(x.descriptions.user){v(!0);try{const t=x.players.filter(e=>e.isAI&&!e.isOut).map(e=>`- ${e.name}（词语：${e.word}）`).join("\n"),s=`你是游戏主持人，第${x.currentRound}轮描述阶段。\n\n用户已描述："${x.descriptions.user}"\n\n请让以下AI依次描述他们的词语：\n${t}\n\n要求：\n1. 每个AI一句话描述词语特征\n2. 不要说出词语本身\n3. 要隐藏自己可能是卧底（即使知道自己词语不同也要装作正常）\n\n最后总结并引导投票。\n\n**严格**按照以下JSON格式返回：\n{\n  "descriptions": {\n    "ai_0": "描述内容",\n    "ai_1": "描述内容"\n  },\n  "summary": "总结的话"\n}`,a=await U([{role:"system",content:"你是游戏主持人，只返回JSON格式数据。"},{role:"user",content:s}]);let r;try{const e=a.match(/\{[\s\S]*\}/);if(!e)throw new Error("未找到JSON格式");r=JSON.parse(e[0])}catch(e){throw alert("AI返回格式错误，请重试"),e}const l=Object.entries(r.descriptions).map(([e,t])=>({playerId:e,text:t}));z([{playerId:"user",text:x.descriptions.user},...l]);const n=3e3*(l.length+1);setTimeout(()=>{m(e=>({...e,status:"voting",descriptions:{...e.descriptions,...r.descriptions},announcement:r.summary}))},n),p("")}catch(t){alert("AI描述失败，请重试")}finally{v(!1)}}},disabled:j,className:"w-full bg-blue-500 text-white rounded-xl py-2 text-sm font-medium ios-button disabled:opacity-50",children:j?"AI正在描述...":"AI回复"})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("textarea",{value:g,onChange:e=>p(e.target.value),placeholder:"用一句话描述你的词语特征，但不要说出词语本身...",disabled:j,className:"w-full glass-card rounded-xl px-4 py-3 text-sm resize-none h-24"}),e.jsx("button",{onClick:()=>{g.trim()&&m(e=>({...e,descriptions:{...e.descriptions,user:g}}))},disabled:!g.trim()||j,className:"w-full bg-blue-500 text-white rounded-xl py-2 text-sm font-medium ios-button disabled:opacity-50",children:"提交描述"})]})]})}),"voting"===x.status&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"glass-card rounded-2xl p-4",children:[e.jsx("h3",{className:"font-bold text-gray-900 mb-3",children:"所有人的描述"}),w.map((t,s)=>{const a=x.descriptions[t];if(!a)return null;const r=x.players.find(e=>e.id===t);return r?e.jsx("div",{className:"mb-3 last:mb-0",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("div",{className:"text-xs text-gray-400 w-5 flex-shrink-0",children:[s+1,"."]}),e.jsx("img",{src:r.avatar,alt:r.name,className:"w-8 h-8 rounded-full flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:r.name}),e.jsx("div",{className:"text-sm text-gray-900",children:a})]})]})},t):null})]}),e.jsxs("div",{className:"glass-card rounded-2xl p-4",children:[e.jsx("h3",{className:"font-bold text-gray-900 mb-3",children:"投票选出卧底"}),f?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-green-50 rounded-xl p-3",children:[e.jsx("div",{className:"text-xs text-green-600 mb-1",children:"你投票给"}),e.jsx("div",{className:"text-sm font-medium text-gray-900",children:null==(l=x.players.find(e=>e.id===f))?void 0:l.name})]}),e.jsx("button",{onClick:async()=>{var e;if(f){v(!0);try{const s=x.players.filter(e=>e.isAI&&!e.isOut),a=Object.entries(x.descriptions).map(([e,t])=>{const s=x.players.find(t=>t.id===e);return`- ${null==s?void 0:s.name}："${t}"`}).join("\n"),r=s.map(e=>`- ${e.name}（词语：${e.word}）`).join("\n"),l=x.players.filter(e=>!e.isOut).map(e=>e.id).join(", "),n=`你是游戏主持人，第${x.currentRound}轮投票阶段。\n\n所有描述：\n${a}\n\n用户投票给：${null==(e=x.players.find(e=>e.id===f))?void 0:e.name}\n\n请：\n1. 让以下AI投票（只能投给还在场的玩家：${l}）：\n${r}\n2. 统计所有票数（包括用户的票）\n3. 找出得票最多的玩家（如果平票，随机选一个）\n4. 让被淘汰者发表遗言（10-20字）\n5. 公布被淘汰者的词语\n\n**严格**按照以下JSON格式返回：\n{\n  "votes": {\n    "ai_0": "被投票者id",\n    "ai_1": "被投票者id"\n  },\n  "eliminated": "被淘汰者id",\n  "voteCount": {\n    "user": 1,\n    "ai_0": 2\n  },\n  "lastWords": "遗言内容",\n  "eliminatedWord": "被淘汰者的词语",\n  "announcement": "宣布结果的话"\n}`,i=await U([{role:"system",content:"你是游戏主持人，只返回JSON格式数据。"},{role:"user",content:n}]);let c;try{const e=i.match(/\{[\s\S]*\}/);if(!e)throw new Error("未找到JSON格式");c=JSON.parse(e[0])}catch(t){const e=x.players.filter(e=>e.isAI&&!e.isOut),s=e[Math.floor(Math.random()*e.length)];c={votes:{},eliminated:s.id,voteCount:{},lastWords:"我...我不知道说什么...",eliminatedWord:s.word,announcement:`${s.name}被淘汰了！`}}const o=x.players.find(e=>e.id===c.eliminated);if(!o)throw new Error("被淘汰的玩家不存在");const d=x.players.map(e=>e.id===c.eliminated?{...e,isOut:!0}:e),h=d.filter(e=>!e.isOut);let u=null;const g=h.filter(e=>e.word===x.undercoverWord).length,p=h.filter(e=>e.word===x.civilianWord).length;0===g?u="civilian":(h.length<=3&&g>0||g>=p)&&(u="undercover"),m(e=>({...e,status:u?"finished":"result",players:d,votes:{user:f,...c.votes},eliminatedPlayer:{id:c.eliminated,name:o.name,word:c.eliminatedWord,lastWords:c.lastWords},announcement:c.announcement,winner:u})),b(null)}catch(s){alert("AI投票失败，请重试")}finally{v(!1)}}},disabled:j,className:"w-full bg-blue-500 text-white rounded-xl py-2 text-sm font-medium ios-button disabled:opacity-50",children:j?"AI正在投票...":"AI回复"})]}):e.jsx("div",{className:"space-y-2",children:D.filter(e=>"user"!==e.id).map(t=>e.jsxs("button",{onClick:()=>{return e=t.id,void b(e);var e},disabled:j,className:"w-full glass-card rounded-xl p-3 ios-button flex items-center gap-3 hover:shadow-lg transition-shadow "+(t.isOut?"opacity-50":""),children:[e.jsx("img",{src:t.avatar,alt:t.name,className:"w-10 h-10 rounded-full"}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.name}),t.isOut&&e.jsx("div",{className:"text-xs text-red-500",children:"已出局"})]}),e.jsx("div",{className:"text-gray-400",children:"›"})]},t.id))})]})]}),"result"===x.status&&x.eliminatedPlayer&&e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"glass-card rounded-2xl p-4",children:[e.jsx("h3",{className:"font-bold text-gray-900 mb-3",children:"投票结果"}),e.jsxs("div",{className:"bg-red-50 rounded-xl p-4 mb-3",children:[e.jsxs("div",{className:"text-center mb-3",children:[e.jsx("div",{className:"text-sm text-red-600 mb-2",children:"被淘汰"}),e.jsx("div",{className:"text-xl font-bold text-red-900",children:x.eliminatedPlayer.name})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 mb-3",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"遗言"}),e.jsxs("div",{className:"text-sm text-gray-900 italic",children:['"',x.eliminatedPlayer.lastWords,'"']})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"TA的词语是"}),e.jsx("div",{className:"text-lg font-bold text-gray-900",children:x.eliminatedPlayer.word})]})]}),x.announcement&&e.jsx("div",{className:"bg-gray-50 rounded-xl p-3 mb-3",children:e.jsx("div",{className:"text-sm text-gray-700",children:x.announcement})}),e.jsx("button",{onClick:()=>{const e=x.players.filter(e=>!e.isOut).map(e=>e.id).sort(()=>Math.random()-.5);k(e),m(e=>({...e,status:"describing",currentRound:e.currentRound+1,descriptions:{},votes:{},eliminatedPlayer:null,announcement:`第${e.currentRound+1}轮开始！请继续描述。`}))},className:"w-full bg-blue-500 text-white rounded-xl py-3 font-medium ios-button",children:"进入下一轮"})]})})]}),"finished"===x.status&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"glass-card rounded-2xl p-6 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🎉"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"游戏结束！"}),e.jsx("div",{className:"text-lg text-gray-700 mb-4",children:"civilian"===x.winner?"平民获胜！":"卧底获胜！"}),e.jsx("div",{className:"bg-gray-50 rounded-xl p-4 mb-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"平民词"}),e.jsx("div",{className:"text-lg font-bold text-blue-600",children:x.civilianWord})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"卧底词"}),e.jsx("div",{className:"text-lg font-bold text-red-600",children:x.undercoverWord})]})]})}),e.jsx("button",{onClick:()=>{m({status:"setup",players:[],currentRound:0,descriptions:{},votes:{},eliminatedPlayer:null,announcement:"",winner:null,civilianWord:"",undercoverWord:""}),u([]),p(""),b(null),k([])},className:"w-full bg-blue-500 text-white rounded-xl py-3 font-medium ios-button",children:"再来一局"})]})})]})]})}},Symbol.toStringTag,{value:"Module"})),Fl=()=>{const[s]=t.useState(new Date),[a,r]=t.useState(null),[l,n]=t.useState(null);t.useEffect(()=>{i();const e=()=>{document.hidden||i()},t=()=>{i()};document.addEventListener("visibilitychange",e),window.addEventListener("focus",t);const s=setInterval(i,3e4);return()=>{document.removeEventListener("visibilitychange",e),window.removeEventListener("focus",t),clearInterval(s)}},[]);const i=()=>{const e=ct().filter(e=>ot(e.date)>=0).sort((e,t)=>ot(e.date)-ot(t.date))[0];r(e);const t=it();n(t)},c=s.getDate(),o=s.getMonth()+1,d=["日","一","二","三","四","五","六"][s.getDay()];return e.jsxs("div",{className:"w-full h-full relative rounded-3xl overflow-hidden shadow-lg border border-white/20 flex flex-col",children:[l&&e.jsx("div",{className:"absolute inset-0 bg-cover bg-center",style:{backgroundImage:`url(${l})`}}),e.jsx("div",{className:"absolute inset-0 bg-white/60"}),e.jsxs("div",{className:"relative z-10 flex-1 flex flex-col",children:[e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center",children:[e.jsx("div",{className:"text-6xl font-bold text-gray-800 leading-none",children:c}),e.jsxs("div",{className:"text-xs text-gray-600 mt-2",children:[o,"月 星期",d]})]}),a?e.jsx("div",{className:"px-3 py-3 bg-white/90 border-t border-white/30",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"text-xs text-gray-700 truncate flex-1",children:a.title}),e.jsx("span",{className:"text-xs font-bold text-pink-500 whitespace-nowrap",children:(()=>{const e=ot(a.date);return 0===e?"今天":`${e}天`})()})]})}):e.jsx("div",{className:"px-3 py-3 bg-white/90 border-t border-white/30",children:e.jsx("div",{className:"text-xs text-gray-400 text-center",children:"暂无纪念日"})})]})]})},Ol=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),r=x(),[n,i]=t.useState(0),[c,o]=t.useState(new Date),d=t.useRef(0),m=t.useRef(0),h=t.useRef(0),u=t.useRef(0),g=t.useRef(null),[p,f]=t.useState({}),[b,j]=t.useState(""),[v,y]=t.useState(""),[N,w]=t.useState(""),[k,C]=t.useState(null),[S,I]=t.useState(""),_=t.useRef(null),[M,z]=t.useState({btn1:"小x大王",btn2:"本命为萌",btn3:"早春樱雨",temperature:"19",humidity:"70",status:"生活给我一拳 我出布o(´^｀)o"}),[$,L]=t.useState(null),[A,T]=t.useState("");t.useEffect(()=>{const e=localStorage.getItem("character_avatar");e&&I(e);const t=localStorage.getItem("character_editable_texts");t&&z(JSON.parse(t))},[]);const D=(e,t)=>{L(e),T(t)},B=e=>{if(A.trim()){const t={...M,[e]:A.trim()};z(t),localStorage.setItem("character_editable_texts",JSON.stringify(t))}L(null),T("")},E=e=>{T(e.target.value)},P=(e,t)=>{"Enter"===e.key&&B(t)};t.useEffect(()=>{const e=()=>{const e=localStorage.getItem("custom_desktop_icons");if(e)try{const t=JSON.parse(e),s={};t.forEach(e=>{e.customIcon&&(s[e.id]=e.customIcon)}),f(s)}catch(t){}else f({})};e(),window.addEventListener("storage",e);const t=()=>{e()};return window.addEventListener("customIconUpdate",t),()=>{window.removeEventListener("storage",e),window.removeEventListener("customIconUpdate",t)}},[]),t.useEffect(()=>{const e=async()=>{try{const e=await pe("desktop_background");e&&j(e);const t=await pe("music_player_background");t&&y(t);const s=await pe("character_card_background");s&&w(s)}catch(e){}};e();const t=()=>e(),s=()=>e(),a=()=>e();return window.addEventListener("desktopBackgroundUpdate",t),window.addEventListener("musicBackgroundUpdate",s),window.addEventListener("characterCardBackgroundUpdate",a),()=>{window.removeEventListener("desktopBackgroundUpdate",t),window.removeEventListener("musicBackgroundUpdate",s),window.removeEventListener("characterCardBackgroundUpdate",a)}},[]),t.useEffect(()=>{const e=setInterval(()=>{o(new Date)},1e3);return()=>clearInterval(e)},[]),t.useEffect(()=>{const e=async()=>{try{const t="true"===localStorage.getItem("custom_weather_enabled"),s=localStorage.getItem("custom_weather_data");if(t&&s)try{const e=JSON.parse(s);return void C({temperature:parseInt(e.temp)||25,condition:e.condition||"晴天",conditionCN:e.condition||"晴天",icon:"☀️",location:e.city||"自定义",humidity:60,windSpeed:10,airQuality:"good"})}catch(e){}const a=localStorage.getItem("weather_city")||"Beijing",r=await ft(a);C(r)}catch(t){C({temperature:25,condition:"sunny",conditionCN:"晴天",icon:"☀️",location:"北京",humidity:60,windSpeed:10,airQuality:"good"})}};e();const t=setInterval(e,18e5),s=()=>{e()};return window.addEventListener("weatherCityChange",s),()=>{clearInterval(t),window.removeEventListener("weatherCityChange",s)}},[]),t.useEffect(()=>{const e=g.current;if(!e)return;let t=0,s=0;const a=e=>{t=e.touches[0].clientX,s=e.touches[0].clientY},r=e=>{const a=e.touches[0],r=Math.abs(a.clientX-t);r>Math.abs(a.clientY-s)&&r>10&&e.preventDefault()};return e.addEventListener("touchstart",a),e.addEventListener("touchmove",r,{passive:!1}),()=>{e.removeEventListener("touchstart",a),e.removeEventListener("touchmove",r)}},[]);const F=(e,t)=>p[e]||t,O=[{id:"wechat-app",name:"微信",icon:F("wechat-app",Yt),color:"glass-card",route:"/wechat"},{id:"preset",name:"预设",icon:F("preset",Ns),color:"glass-card",route:"/preset"},{id:"worldbook",name:"世界书",icon:F("worldbook",Rs),color:"glass-card",route:"/worldbook"},{id:"music-app",name:"音乐",icon:F("music-app",Es),color:"glass-card",route:"/music-player"},{id:"settings",name:"系统设置",icon:F("settings",Ns),color:"glass-card",route:"/settings-new"}],W=[{id:"footprint",name:"足迹",icon:F("footprint",aa),color:"glass-card",route:"/ai-footprint"},{id:"forum",name:"论坛",icon:F("forum",ra),color:"glass-card",route:"/forum"},{id:"aiphone",name:"查手机",icon:F("aiphone",ca),color:"glass-card",route:"/ai-phone-select"},{id:"calendar",name:"日历",icon:F("calendar",Vs),color:"glass-card",route:"/calendar"}],R=[{id:"offline",name:"线下",icon:F("offline",Yt),color:"glass-card",route:"/offline-chat"},{id:"customize",name:"美化",icon:F("customize",Ns),color:"glass-card",route:"/customize"},{id:"api-config",name:"API配置",icon:F("api-config",Ns),color:"glass-card",route:"/api-list"},{id:"browser",name:"浏览器",icon:F("browser",Us),color:"glass-card",route:"/browser"}],U=(e,t)=>{e.preventDefault(),e.stopPropagation(),t.onClick?t.onClick():t.route&&a(t.route)};return e.jsxs("div",{className:"h-screen w-full relative overflow-hidden bg-[#f5f7fa]",style:{touchAction:"pan-y pinch-zoom"},children:[e.jsx("div",{className:"absolute inset-0",style:{backgroundImage:b?`url(${b})`:"none",backgroundSize:"cover",backgroundPosition:"center",backgroundColor:b?"transparent":"#f5f7fa"},children:!b&&e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-white/50 to-gray-100/30"})}),e.jsxs("div",{className:"relative h-full flex flex-col",children:[e.jsx("div",{style:{background:"transparent",position:"relative",zIndex:1},children:e.jsx("div",{style:{background:"transparent"},children:e.jsx(xa,{})})}),e.jsx("div",{ref:g,className:"flex-1 overflow-hidden",style:{touchAction:"none"},onTouchStart:e=>{d.current=e.touches[0].clientX,h.current=e.touches[0].clientY},onTouchMove:e=>{m.current=e.touches[0].clientX,u.current=e.touches[0].clientY},onTouchEnd:()=>{const e=d.current-m.current,t=Math.abs(u.current-h.current);Math.abs(e)>50&&Math.abs(e)>t&&(e>0&&n<1?i(1):e<0&&n>0&&i(0))},children:e.jsxs("div",{className:"h-full flex transition-transform duration-300 ease-out",style:{transform:`translateX(-${100*n}%)`},children:[e.jsxs("div",{className:"min-w-full h-full px-4 py-2 overflow-y-auto flex flex-col hide-scrollbar",children:[e.jsxs("div",{className:"p-6 mb-4 text-center",children:[e.jsx("div",{className:"text-8xl font-bold text-gray-900 mb-2",children:c.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})}),e.jsx("div",{className:"text-lg font-semibold text-gray-600",children:c.toLocaleDateString("zh-CN",{month:"long",day:"numeric",weekday:"long"})})]}),e.jsx("div",{className:"glass-card rounded-3xl p-4 shadow-lg border border-white/30 relative overflow-visible cursor-pointer mb-4",onClick:()=>a("/music-player"),style:{backgroundImage:v?`url(${v})`:"none",backgroundSize:"cover",backgroundPosition:"center"},children:r.currentSong?e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"relative w-32 h-32 flex-shrink-0",children:e.jsx("div",{className:"w-32 h-32 rounded-full backdrop-blur-md bg-white/20 shadow-2xl flex items-center justify-center border-2 border-white/30 "+(r.isPlaying?"animate-spin-slow":""),children:e.jsx("div",{className:"w-[115px] h-[115px] rounded-full overflow-hidden shadow-inner bg-white flex items-center justify-center",children:r.currentSong.cover?e.jsx("img",{src:r.currentSong.cover,alt:r.currentSong.title,className:"w-full h-full object-contain"}):e.jsx(Es,{size:32,className:"text-blue-500"})})})}),e.jsxs("div",{className:"flex-1 flex flex-col justify-center gap-2",children:[e.jsx("div",{className:"text-lg font-bold text-gray-900 truncate",children:r.currentSong.title}),e.jsx("div",{className:"text-sm text-gray-500 truncate",children:r.currentSong.artist}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsx("button",{onClick:e=>{e.stopPropagation()},className:"w-10 h-10 rounded-full bg-white/80 flex items-center justify-center shadow-sm active:scale-95 transition-transform",children:e.jsx(Ps,{size:18,className:"text-red-500"})}),e.jsx("button",{onClick:e=>{e.stopPropagation(),r.togglePlay()},className:"w-10 h-10 rounded-full bg-white/80 flex items-center justify-center shadow-sm active:scale-95 transition-transform",children:r.isPlaying?e.jsx(Os,{size:18,className:"text-gray-700"}):e.jsx(Fs,{size:18,className:"text-gray-700"})}),e.jsx("button",{onClick:e=>{e.stopPropagation(),r.next()},className:"w-10 h-10 rounded-full bg-white/80 flex items-center justify-center shadow-sm active:scale-95 transition-transform",children:e.jsx(Ws,{size:18,className:"text-gray-700"})})]})]})]}):e.jsx("div",{className:"flex items-center justify-center h-32 text-gray-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Es,{size:32,className:"mx-auto mb-2"}),e.jsx("div",{className:"text-sm",children:"暂无播放音乐"})]})})}),e.jsx("div",{className:"grid grid-cols-4 gap-4 auto-rows-min",children:O.map(t=>{const s="string"==typeof t.icon,a="wechat-app"===t.id;return e.jsxs("div",{onClick:e=>U(e,t),className:"flex flex-col items-center gap-1 cursor-pointer active:scale-95 transition-transform "+(a?"col-span-2 row-span-2":""),children:[s?e.jsx("div",{className:(a?"w-36 h-36":"w-14 h-14")+" flex items-center justify-center",children:e.jsx("img",{src:t.icon,alt:t.name,className:"w-full h-full object-contain"})}):e.jsx("div",{className:`${a?"w-36 h-36":"w-14 h-14"} ${t.color} rounded-2xl flex items-center justify-center shadow-lg border border-white/30`,children:l.createElement(t.icon,{size:a?64:28,className:"text-gray-300"})}),e.jsx("span",{className:"text-xs text-gray-700 text-center font-medium",children:t.name})]},t.id)})})]}),e.jsxs("div",{className:"min-w-full h-full px-4 overflow-y-auto flex flex-col hide-scrollbar",style:{paddingTop:"20px",paddingBottom:"8px"},children:[e.jsxs("div",{className:"glass-card rounded-3xl p-4 shadow-lg border border-white/30 relative bg-gradient-to-br from-white/80 to-white/40 mb-4 cursor-pointer ios-button",onClick:()=>a("/weather-detail"),style:{overflow:"visible"},children:[k&&(()=>{const t=k.condition.toLowerCase();return t.includes("clear")||t.includes("sunny")||"晴天"===t||"晴"===t?e.jsxs("div",{className:"absolute -top-2 -right-2 w-20 h-20",children:[e.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-br from-yellow-300/40 to-orange-300/20 blur-xl"}),e.jsx("div",{className:"absolute inset-2 rounded-full bg-gradient-to-br from-yellow-300 via-yellow-400 to-orange-400 shadow-lg"}),e.jsx("div",{className:"absolute top-3 left-3 w-8 h-8 rounded-full bg-white/50 blur-md"})]}):t.includes("rain")||"雨"===t||t.includes("shower")?e.jsxs("div",{className:"absolute top-4 right-6",children:[e.jsxs("div",{className:"relative w-16 h-10 mb-2",children:[e.jsx("div",{className:"absolute inset-0 rounded-full bg-gray-400/40 blur-sm translate-y-1"}),e.jsx("div",{className:"absolute bottom-0 left-2 w-8 h-6 rounded-full bg-gradient-to-br from-gray-300 to-gray-400 shadow-md"}),e.jsx("div",{className:"absolute bottom-1 left-5 w-10 h-7 rounded-full bg-gradient-to-br from-gray-300 to-gray-400 shadow-md"}),e.jsx("div",{className:"absolute bottom-0 right-1 w-7 h-5 rounded-full bg-gradient-to-br from-gray-300 to-gray-400 shadow-md"})]}),e.jsxs("div",{className:"flex gap-1 ml-4",children:[e.jsx("div",{className:"w-1 h-3 bg-blue-400/60 rounded-full"}),e.jsx("div",{className:"w-1 h-3 bg-blue-400/60 rounded-full"}),e.jsx("div",{className:"w-1 h-3 bg-blue-400/60 rounded-full"})]})]}):t.includes("cloud")||"多云"===t||"阴"===t?e.jsxs("div",{className:"absolute top-6 right-8 w-16 h-10",children:[e.jsx("div",{className:"absolute inset-0 rounded-full bg-gray-300/30 blur-sm translate-y-1"}),e.jsx("div",{className:"absolute bottom-0 left-2 w-8 h-6 rounded-full bg-gradient-to-br from-white to-gray-100 shadow-md"}),e.jsx("div",{className:"absolute bottom-1 left-5 w-10 h-7 rounded-full bg-gradient-to-br from-white to-gray-100 shadow-md"}),e.jsx("div",{className:"absolute bottom-0 right-1 w-7 h-5 rounded-full bg-gradient-to-br from-white to-gray-100 shadow-md"})]}):t.includes("snow")||"雪"===t?e.jsx("div",{className:"absolute top-4 right-6 text-4xl",children:"❄️"}):t.includes("fog")||t.includes("mist")||"雾"===t?e.jsx("div",{className:"absolute top-6 right-6 text-4xl opacity-70",children:"🌫️"}):e.jsxs("div",{className:"absolute -top-2 -right-2 w-20 h-20",children:[e.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-br from-yellow-300/40 to-orange-300/20 blur-xl"}),e.jsx("div",{className:"absolute inset-2 rounded-full bg-gradient-to-br from-yellow-300 via-yellow-400 to-orange-400 shadow-lg"}),e.jsx("div",{className:"absolute top-3 left-3 w-8 h-8 rounded-full bg-white/50 blur-md"})]})})(),e.jsx("div",{className:"relative z-10 flex flex-col h-full",children:k?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-5xl font-extralight text-gray-800 leading-none mb-1",children:[k.temperature,e.jsx("span",{className:"text-2xl align-top",children:"°"})]}),e.jsx("div",{className:"text-sm text-gray-600 mb-auto capitalize",children:k.conditionCN}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex items-center gap-1 text-[11px] text-gray-500",children:[e.jsx("svg",{className:"w-3 h-3",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M12 2L14 8L20 10L14 12L12 18L10 12L4 10L10 8L12 2Z",fill:"currentColor",opacity:"0.6"})}),e.jsxs("span",{children:["Air ",k.airQuality]})]}),e.jsx("div",{className:"text-[11px] text-gray-500",children:k.location})]})]}):e.jsx("div",{className:"text-sm text-gray-500",children:"加载中..."})})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",style:{gridAutoRows:"90px"},children:[e.jsx("div",{className:"col-span-2 row-span-2 cursor-pointer active:scale-95 transition-transform",onClick:()=>a("/calendar"),children:e.jsx(Fl,{})}),W.map(t=>{const s="string"==typeof t.icon;return e.jsxs("div",{onClick:e=>U(e,t),className:"flex flex-col items-center gap-1 cursor-pointer active:scale-95 transition-transform",children:[s?e.jsx("div",{className:"w-14 h-14",children:e.jsx("img",{src:t.icon,alt:t.name,className:"w-full h-full object-contain"})}):e.jsx("div",{className:`w-14 h-14 ${t.color} rounded-2xl flex items-center justify-center shadow-lg border border-white/30`,children:l.createElement(t.icon,{size:28,className:"text-gray-300"})}),e.jsx("span",{className:"text-xs text-gray-700 text-center font-medium",children:t.name})]},t.id)})]}),e.jsx("input",{ref:_,type:"file",accept:"image/*",onChange:async e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(!s)return;const a=new FileReader;a.onload=e=>{var t;const s=null==(t=e.target)?void 0:t.result;I(s),localStorage.setItem("character_avatar",s)},a.readAsDataURL(s)},style:{display:"none"}}),e.jsxs("div",{className:"character-card-widget character-card-floating",style:{marginTop:"50px",marginBottom:"15px",position:"relative",zIndex:100,backgroundImage:N?`url(${N})`:void 0,backgroundSize:"cover",backgroundPosition:"center"},children:[e.jsx("div",{className:"character-card-corner-bubble",children:"呆"}),e.jsx("div",{className:"character-card-main",onClick:()=>{var e;null==(e=_.current)||e.click()},style:{cursor:"pointer"},children:S?e.jsx("img",{src:S,alt:"角色头像"}):"X"}),e.jsxs("div",{className:"character-card-weather-info",children:[e.jsx("div",{className:"character-card-weather-value",onClick:()=>D("temperature",M.temperature),style:{cursor:"pointer"},children:"temperature"===$?e.jsx("input",{type:"text",value:A,onChange:E,onBlur:()=>B("temperature"),onKeyPress:e=>P(e,"temperature"),autoFocus:!0,style:{width:"60px",textAlign:"center",background:"transparent",border:"1px solid #ccc",borderRadius:"4px",fontSize:"inherit",fontWeight:"inherit"}}):`${M.temperature}°C`}),e.jsx("div",{className:"character-card-weather-value",onClick:()=>D("humidity",M.humidity),style:{cursor:"pointer"},children:"humidity"===$?e.jsx("input",{type:"text",value:A,onChange:E,onBlur:()=>B("humidity"),onKeyPress:e=>P(e,"humidity"),autoFocus:!0,style:{width:"60px",textAlign:"center",background:"transparent",border:"1px solid #ccc",borderRadius:"4px",fontSize:"inherit",fontWeight:"inherit"}}):`${M.humidity}%`})]}),e.jsx("div",{className:"character-card-bunny-status",onClick:()=>D("status",M.status),style:{cursor:"pointer"},children:"status"===$?e.jsx("input",{type:"text",value:A,onChange:E,onBlur:()=>B("status"),onKeyPress:e=>P(e,"status"),autoFocus:!0,style:{width:"100%",textAlign:"center",background:"transparent",border:"1px solid #ccc",borderRadius:"4px",fontSize:"inherit",color:"inherit"}}):M.status})]}),e.jsxs("div",{className:"character-card-function-row",style:{marginBottom:"15px"},children:[e.jsx("div",{className:"character-card-function-btn",onClick:e=>{e.stopPropagation(),D("btn1",M.btn1)},style:{cursor:"pointer"},children:"btn1"===$?e.jsx("input",{type:"text",value:A,onChange:E,onBlur:()=>B("btn1"),onKeyPress:e=>P(e,"btn1"),onClick:e=>e.stopPropagation(),autoFocus:!0,style:{width:"100%",textAlign:"center",background:"transparent",border:"1px solid #ccc",borderRadius:"4px",fontSize:"inherit",color:"inherit"}}):M.btn1}),e.jsx("div",{className:"character-card-function-btn",onClick:e=>{e.stopPropagation(),D("btn2",M.btn2)},style:{cursor:"pointer"},children:"btn2"===$?e.jsx("input",{type:"text",value:A,onChange:E,onBlur:()=>B("btn2"),onKeyPress:e=>P(e,"btn2"),onClick:e=>e.stopPropagation(),autoFocus:!0,style:{width:"100%",textAlign:"center",background:"transparent",border:"1px solid #ccc",borderRadius:"4px",fontSize:"inherit",color:"inherit"}}):M.btn2}),e.jsx("div",{className:"character-card-function-btn",onClick:e=>{e.stopPropagation(),D("btn3",M.btn3)},style:{cursor:"pointer"},children:"btn3"===$?e.jsx("input",{type:"text",value:A,onChange:E,onBlur:()=>B("btn3"),onKeyPress:e=>P(e,"btn3"),onClick:e=>e.stopPropagation(),autoFocus:!0,style:{width:"100%",textAlign:"center",background:"transparent",border:"1px solid #ccc",borderRadius:"4px",fontSize:"inherit",color:"inherit"}}):M.btn3})]})]})]})}),e.jsx("div",{className:"flex justify-center gap-2 py-4",children:[0,1].map(t=>e.jsx("div",{onClick:()=>i(t),className:"h-2 rounded-full transition-all duration-300 cursor-pointer "+(t===n?"bg-gray-800 w-6":"bg-gray-400 w-2 hover:bg-gray-500")},t))}),e.jsx("div",{className:"pb-6 px-4",children:e.jsx("div",{className:"glass-effect rounded-3xl p-3 shadow-xl border border-white/30",children:e.jsx("div",{className:"grid grid-cols-4 gap-3",children:R.map(t=>{const s="string"==typeof t.icon;return e.jsx("div",{onClick:e=>U(e,t),className:"flex flex-col items-center cursor-pointer active:scale-95 transition-transform",children:s?e.jsx("div",{className:"w-14 h-14",children:e.jsx("img",{src:t.icon,alt:t.name,className:"w-full h-full object-contain"})}):e.jsx("div",{className:`w-14 h-14 ${t.color} rounded-2xl flex items-center justify-center shadow-lg border border-white/30`,children:l.createElement(t.icon,{size:28,className:"text-gray-300"})})},t.id)})})})})]})]})}},Symbol.toStringTag,{value:"Module"})),Wl=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{currentUser:r}=d(),{characters:l}=n(),[i,c]=t.useState(null),[o,x]=t.useState([]),[m,h]=t.useState(""),[u,g]=t.useState(!1),p=t.useRef(null),f=t.useRef(null);t.useEffect(()=>{var e;null==(e=p.current)||e.scrollIntoView({behavior:"smooth"})},[o]);const b=async()=>{if(!m.trim()||u)return;const e={id:Date.now().toString(),role:"user",content:m,timestamp:new Date};x(t=>[...t,e]),h(""),g(!0);try{const e=o.slice(-5).map(e=>`${"user"===e.role?(null==r?void 0:r.name)||"你":(null==i?void 0:i.name)||"AI"}: ${e.content}`).join("\n"),t=`${i?`\n角色名字：${i.name}\n设定：${i.description||""}\n系统提示词：${i.systemPrompt||""}\n关系：你们正在线下见面`:"你是一个小说风格的AI助手"}\n\n场景：你们在咖啡店见面，请用小说的形式回复。\n\n格式要求：\n- 对话用引号：${(null==i?void 0:i.name)||"AI"}："你好"\n- 心理活动用括号：(${(null==i?void 0:i.name)||"他"}想...)\n- 动作用星号：*点了点头*\n- 场景描写直接写\n\n对话历史：\n${e}\n\n${(null==r?void 0:r.name)||"你"}: ${m}\n\n请以${(null==i?void 0:i.name)||"AI"}的身份，用小说形式回复（100-200字）：`,s=await U(t),a={id:(Date.now()+1).toString(),role:"assistant",content:s,timestamp:new Date};x(e=>[...e,a])}catch(t){alert("发送失败，请检查API配置")}finally{g(!1)}};return i?e.jsxs("div",{className:"h-screen w-full bg-white flex flex-col",children:[e.jsxs("div",{className:"glass-card border-b border-white/30",children:[e.jsx(xa,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>{c(null),x([])},className:"w-10 h-10 flex items-center justify-center active:scale-95 transition-transform",children:e.jsx(ls,{size:24,className:"text-blue-500"})}),e.jsxs("h1",{className:"text-xl font-semibold text-gray-900",children:["与 ",i.name," 见面"]}),e.jsx("div",{className:"w-10"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-4 space-y-4",children:[0===o.length&&e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-400 text-lg mb-2",children:"📖 开始你的故事"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"输入任何内容，AI会以小说形式回复"})]})}),o.map(t=>e.jsx("div",{className:"animate-fadeIn",children:"user"===t.role?e.jsx("div",{className:"flex justify-end",children:e.jsx("div",{className:"glass-card rounded-2xl px-4 py-2 max-w-[80%] shadow-lg border border-white/30",children:e.jsx("p",{className:"text-gray-800",children:t.content})})}):e.jsx("div",{className:"max-w-2xl",children:e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:e.jsx("div",{className:"text-base leading-relaxed text-gray-800 whitespace-pre-wrap",children:t.content})})})},t.id)),u&&e.jsx("div",{className:"flex justify-start",children:e.jsxs("div",{className:"glass-card rounded-full px-4 py-2 flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full animate-bounce",style:{animationDelay:"0.2s"}}),e.jsx("span",{className:"text-sm text-gray-600 ml-2",children:"正在创作..."})]})}),e.jsx("div",{ref:p})]}),e.jsx("div",{className:"glass-card border-t border-white/30 px-4 py-3",children:e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("textarea",{ref:f,value:m,onChange:e=>h(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),b())},placeholder:"输入任何内容，开始你的故事...",disabled:u,className:"flex-1 bg-white/50 rounded-xl px-4 py-3 resize-none focus:outline-none focus:ring-2 focus:ring-purple-500 disabled:opacity-50",rows:1,style:{maxHeight:"120px"}}),e.jsx("button",{onClick:b,disabled:!m.trim()||u,className:"w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-xl flex items-center justify-center active:scale-95 transition-transform disabled:opacity-50 shadow-lg",children:e.jsx(is,{size:20})})]})})]}):e.jsxs("div",{className:"h-screen w-full bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50 flex flex-col",children:[e.jsxs("div",{className:"glass-card border-b border-white/30",children:[e.jsx(xa,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a("/"),className:"w-10 h-10 flex items-center justify-center active:scale-95 transition-transform",children:e.jsx(ls,{size:24,className:"text-blue-500"})}),e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"选择见面对象"}),e.jsx("div",{className:"w-10"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-4",children:0===l.length?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-400 text-lg mb-4",children:"还没有角色"}),e.jsx("button",{onClick:()=>a("/create-character"),className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-6 py-3 rounded-xl active:scale-95 transition-transform",children:"创建角色"})]})}):e.jsx("div",{className:"grid grid-cols-2 gap-4",children:l.map(t=>e.jsxs("div",{onClick:()=>c(t),className:"glass-card rounded-2xl p-4 cursor-pointer active:scale-95 transition-transform",children:[e.jsx("div",{className:"w-20 h-20 rounded-full mx-auto mb-3 overflow-hidden bg-gradient-to-br from-blue-400 to-purple-400",children:t.avatar?e.jsx("img",{src:t.avatar,alt:t.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-white text-2xl font-bold",children:t.name.charAt(0)})}),e.jsx("h3",{className:"text-center font-semibold text-gray-900 mb-1",children:t.name}),e.jsx("p",{className:"text-center text-xs text-gray-500 line-clamp-2",children:t.description||"未设置"})]},t.id))})})]})}},Symbol.toStringTag,{value:"Module"})),Rl=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),[l,n]=t.useState([]),[i,c]=t.useState(""),[d,x]=t.useState(null);t.useEffect(()=>{m()},[]);const m=()=>{const e=ie.getAllLorebooks();n(e)},h=()=>{a("/worldbook/create")},u=()=>{const e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(!s)return;const a=new FileReader;a.onload=e=>{var t;const s=null==(t=e.target)?void 0:t.result;ie.importLorebook(s)?(m(),alert("导入成功")):alert("导入失败，请检查文件格式")},a.readAsText(s)},e.click()},g=l.filter(e=>e.name.toLowerCase().includes(i.toLowerCase())||e.description.toLowerCase().includes(i.toLowerCase()));return e.jsxs("div",{className:"h-full flex flex-col bg-gray-50",children:[e.jsxs("div",{className:"glass-effect sticky top-0 z-50",children:[r&&e.jsx(xa,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a("/settings",{replace:!0}),className:"ios-button text-gray-700",children:e.jsx(ls,{size:24})}),e.jsx("h1",{className:"text-base font-semibold text-gray-900",children:"世界书"}),e.jsx("button",{onClick:h,className:"ios-button text-primary",children:e.jsx(rs,{size:24})})]})]}),e.jsx("div",{className:"px-3 pt-3 pb-2",children:e.jsxs("div",{className:"glass-card rounded-2xl px-4 py-2 flex items-center gap-2",children:[e.jsx(as,{size:18,className:"text-gray-400"}),e.jsx("input",{type:"text",placeholder:"搜索世界书",value:i,onChange:e=>c(e.target.value),className:"flex-1 bg-transparent border-none outline-none text-sm text-gray-900 placeholder-gray-400"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-3 pb-3",children:0===g.length?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[e.jsx("div",{className:"text-6xl mb-4",children:"📚"}),e.jsx("div",{className:"text-sm mb-2",children:"暂无世界书"}),e.jsx("div",{className:"text-xs text-gray-400 mb-4",children:"创建世界书或导入现有的世界书"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:h,className:"glass-card rounded-xl px-6 py-2 text-sm text-primary font-medium",children:"创建世界书"}),e.jsx("button",{onClick:u,className:"glass-card rounded-xl px-6 py-2 text-sm text-gray-700 font-medium",children:"导入世界书"})]})]}):e.jsx("div",{className:"space-y-2",children:g.map(t=>e.jsxs("div",{className:"glass-card rounded-2xl p-4 relative",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:t.name}),t.is_global&&e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-blue-100 text-blue-600",children:"全局"})]}),t.description&&e.jsx("p",{className:"text-xs text-gray-500 line-clamp-2",children:t.description})]}),e.jsx("button",{onClick:()=>x(d===t.id?null:t.id),className:"ios-button text-gray-400 ml-2",children:e.jsx(ns,{size:20})})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-400",children:[e.jsxs("span",{children:[t.entries.length," 条目"]}),e.jsxs("span",{children:["扫描深度 ",t.scan_depth]}),e.jsxs("span",{children:["预算 ",t.token_budget]})]}),d===t.id&&e.jsxs("div",{className:"absolute right-4 top-14 glass-effect rounded-xl shadow-lg border border-white/30 overflow-hidden z-10",children:[e.jsx("button",{onClick:()=>{var e;e=t.id,a(`/worldbook/edit/${e}`),x(null)},className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-white/50",children:"编辑"}),e.jsx("button",{onClick:()=>{(e=>{const t=ie.exportLorebook(e);if(!t)return;const s=new Blob([t],{type:"application/json"}),a=URL.createObjectURL(s),r=document.createElement("a");r.href=a,r.download=`lorebook_${e}.json`,r.click(),URL.revokeObjectURL(a)})(t.id),x(null)},className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-white/50",children:"导出"}),e.jsx("button",{onClick:()=>{var e;e=t.id,confirm("确定要删除这个世界书吗？")&&(ie.deleteLorebook(e),m()),x(null)},className:"w-full px-4 py-2 text-left text-sm text-red-500 hover:bg-white/50",children:"删除"})]})]},t.id))})}),l.length>0&&e.jsx("div",{className:"p-3 glass-effect border-t border-white/30",children:e.jsx("button",{onClick:u,className:"w-full glass-card rounded-xl py-3 text-sm font-medium text-gray-700",children:"导入世界书"})})]})}},Symbol.toStringTag,{value:"Module"})),Ul=({entry:s,isEditing:a,onEdit:r,onCollapse:l,onUpdate:n,onDelete:i})=>{const[c,o]=t.useState(""),d=()=>{c.trim()&&(n({keys:[...s.keys,c.trim()]}),o(""))};return e.jsxs("div",{className:"glass-card rounded-2xl p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",value:s.name,onChange:e=>n({name:e.target.value}),className:"w-full bg-transparent text-sm font-semibold text-gray-900 border-none outline-none",placeholder:"条目名称"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>n({enabled:!s.enabled}),className:"w-10 h-5 rounded-full transition-colors "+(s.enabled?"bg-primary":"bg-gray-300"),children:e.jsx("div",{className:"w-4 h-4 rounded-full bg-white shadow-sm transition-transform "+(s.enabled?"translate-x-5":"translate-x-0.5")})}),e.jsx("button",{onClick:i,className:"ios-button text-red-500",children:e.jsx("svg",{width:18,height:18,viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})})]})]}),a?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"触发关键词"}),e.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:s.keys.map((t,a)=>e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs px-2 py-0.5 rounded-full bg-blue-100 text-blue-600",children:[t,e.jsx("button",{onClick:()=>{return e=a,void n({keys:s.keys.filter((t,s)=>s!==e)});var e},className:"text-blue-400 hover:text-blue-600",children:"×"})]},a))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:c,onChange:e=>o(e.target.value),onKeyPress:e=>"Enter"===e.key&&d(),className:"flex-1 bg-white/50 rounded-xl px-3 py-1.5 text-xs text-gray-900 border border-white/30 outline-none focus:border-primary",placeholder:"输入关键词后按回车"}),e.jsx("button",{onClick:d,className:"glass-card rounded-xl px-3 py-1.5 text-xs text-primary",children:"添加"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"注入内容"}),e.jsx("textarea",{value:s.content,onChange:e=>n({content:e.target.value}),className:"w-full bg-white/50 rounded-xl px-3 py-2 text-xs text-gray-900 border border-white/30 outline-none focus:border-primary resize-none",placeholder:"当关键词被触发时，这段内容会被注入到提示词中",rows:4})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-500 mb-1",children:"优先级"}),e.jsx("input",{type:"number",value:s.priority,onChange:e=>n({priority:parseInt(e.target.value)||0}),className:"w-full bg-white/50 rounded-xl px-2 py-1 text-gray-900 border border-white/30 outline-none",min:"0",max:"999"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-500 mb-1",children:"位置"}),e.jsxs("select",{value:s.position,onChange:e=>n({position:e.target.value}),className:"w-full bg-white/50 rounded-xl px-2 py-1 text-gray-900 border border-white/30 outline-none",children:[e.jsx("option",{value:"top",children:"顶部"}),e.jsx("option",{value:"before_char",children:"角色前"}),e.jsx("option",{value:"after_char",children:"角色后"}),e.jsx("option",{value:"bottom",children:"底部"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"大小写敏感"}),e.jsx("button",{onClick:()=>n({case_sensitive:!s.case_sensitive}),className:"w-10 h-5 rounded-full transition-colors "+(s.case_sensitive?"bg-primary":"bg-gray-300"),children:e.jsx("div",{className:"w-4 h-4 rounded-full bg-white shadow-sm transition-transform "+(s.case_sensitive?"translate-x-5":"translate-x-0.5")})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"始终注入"}),e.jsx("button",{onClick:()=>n({constant:!s.constant}),className:"w-10 h-5 rounded-full transition-colors "+(s.constant?"bg-primary":"bg-gray-300"),children:e.jsx("div",{className:"w-4 h-4 rounded-full bg-white shadow-sm transition-transform "+(s.constant?"translate-x-5":"translate-x-0.5")})})]}),e.jsx("button",{onClick:l,className:"w-full text-xs text-gray-500 py-2",children:"收起"})]}):e.jsxs("div",{onClick:r,className:"cursor-pointer",children:[e.jsxs("div",{className:"flex flex-wrap gap-1 mb-2",children:[s.keys.slice(0,3).map((t,s)=>e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-blue-100 text-blue-600",children:t},s)),s.keys.length>3&&e.jsxs("span",{className:"text-xs px-2 py-0.5 rounded-full bg-gray-100 text-gray-500",children:["+",s.keys.length-3]})]}),s.content&&e.jsx("p",{className:"text-xs text-gray-500 line-clamp-2",children:s.content})]})]})},Vl=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{id:l}=r(),{showStatusBar:i}=o(),{characters:c}=n(),[d,x]=t.useState(null),[m,h]=t.useState(null),[u,g]=t.useState(!1);t.useEffect(()=>{if(l){const e=ie.getLorebook(l);x(e)}else{const e={id:"",name:"新世界书",description:"",entries:[],scan_depth:10,token_budget:2e3,recursive_scanning:!1,is_global:!1,character_ids:[],created_at:Date.now(),updated_at:Date.now()};x(e)}},[l]);return d?e.jsxs("div",{className:"h-full flex flex-col bg-gray-50",children:[e.jsxs("div",{className:"glass-effect sticky top-0 z-50",children:[i&&e.jsx(xa,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a(-1),className:"ios-button text-gray-700",children:"取消"}),e.jsx("h1",{className:"text-base font-semibold text-gray-900",children:l?"编辑世界书":"创建世界书"}),e.jsx("button",{onClick:()=>{d&&(l?ie.updateLorebook(l,d):ie.createLorebook(d),a("/worldbook"))},className:"ios-button text-primary font-medium",children:"保存"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar px-3 pt-3 pb-3",children:[e.jsxs("div",{className:"glass-card rounded-2xl p-4 mb-3",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"名称"}),e.jsx("input",{type:"text",value:d.name,onChange:e=>x({...d,name:e.target.value}),className:"w-full bg-white/50 rounded-xl px-3 py-2 text-sm text-gray-900 border border-white/30 outline-none focus:border-primary",placeholder:"世界书名称"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"描述"}),e.jsx("textarea",{value:d.description,onChange:e=>x({...d,description:e.target.value}),className:"w-full bg-white/50 rounded-xl px-3 py-2 text-sm text-gray-900 border border-white/30 outline-none focus:border-primary resize-none",placeholder:"简要描述这个世界书的用途",rows:2})]}),e.jsx("button",{onClick:()=>g(!u),className:"text-xs text-primary",children:u?"收起设置":"展开设置"}),u&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"扫描深度（最近N条消息）"}),e.jsx("input",{type:"number",value:d.scan_depth,onChange:e=>x({...d,scan_depth:parseInt(e.target.value)||10}),className:"w-full bg-white/50 rounded-xl px-3 py-2 text-sm text-gray-900 border border-white/30 outline-none focus:border-primary",min:"1",max:"100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Token 预算"}),e.jsx("input",{type:"number",value:d.token_budget,onChange:e=>x({...d,token_budget:parseInt(e.target.value)||2e3}),className:"w-full bg-white/50 rounded-xl px-3 py-2 text-sm text-gray-900 border border-white/30 outline-none focus:border-primary",min:"100",max:"10000"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-gray-700",children:"全局世界书"}),e.jsx("button",{onClick:()=>x({...d,is_global:!d.is_global}),className:"w-12 h-6 rounded-full transition-colors "+(d.is_global?"bg-primary":"bg-gray-300"),children:e.jsx("div",{className:"w-5 h-5 rounded-full bg-white shadow-sm transition-transform "+(d.is_global?"translate-x-6":"translate-x-0.5")})})]}),!d.is_global&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"关联角色"}),e.jsx("div",{className:"space-y-1",children:c.map(t=>e.jsxs("label",{className:"flex items-center gap-2 py-1",children:[e.jsx("input",{type:"checkbox",checked:d.character_ids.includes(t.id),onChange:e=>{e.target.checked?x({...d,character_ids:[...d.character_ids,t.id]}):x({...d,character_ids:d.character_ids.filter(e=>e!==t.id)})},className:"rounded"}),e.jsx("span",{className:"text-xs text-gray-700",children:t.name})]},t.id))})]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 px-1",children:[e.jsxs("span",{className:"text-xs text-gray-500 font-medium",children:["条目 (",d.entries.length,")"]}),e.jsx("button",{onClick:()=>{if(!d)return;const e={id:`temp_${Date.now()}`,name:"新条目",keys:[],content:"",enabled:!0,priority:500,insertion_order:d.entries.length,case_sensitive:!1,use_regex:!1,token_budget:200,constant:!1,selective:!1,position:"before_char",comment:"",category:"",created_at:Date.now(),updated_at:Date.now()};x({...d,entries:[...d.entries,e]}),h(e.id)},className:"ios-button text-primary text-xs",children:"添加条目"})]}),0===d.entries.length?e.jsxs("div",{className:"glass-card rounded-2xl p-8 text-center text-gray-400",children:[e.jsx("div",{className:"text-sm mb-2",children:"暂无条目"}),e.jsx("div",{className:"text-xs",children:'点击上方"添加条目"开始创建'})]}):e.jsx("div",{className:"space-y-2",children:d.entries.map(t=>e.jsx(Ul,{entry:t,isEditing:m===t.id,onEdit:()=>h(t.id),onCollapse:()=>h(null),onUpdate:e=>((e,t)=>{d&&x({...d,entries:d.entries.map(s=>s.id===e?{...s,...t}:s)})})(t.id,e),onDelete:()=>{return e=t.id,void(d&&x({...d,entries:d.entries.filter(t=>t.id!==e)}));var e}},t.id))})]})]})]}):null}},Symbol.toStringTag,{value:"Module"})),Jl=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),[l,n]=t.useState([]),[i,c]=t.useState(null),[d,x]=t.useState(null);t.useRef(null),t.useEffect(()=>{const e=localStorage.getItem("chat_presets");if(e)n(JSON.parse(e));else{const e=[{id:"offline_default",name:"线下场景 - 默认",description:"适合面对面聊天、约会等线下场景，支持动作和心理描写",temperature:1,frequency_penalty:0,presence_penalty:0,top_p:.9,top_k:40,openai_max_context:8e3,openai_max_tokens:800,prompts:[{name:"身份确认",role:"system",system_prompt:!0,content:"# OFFLINE_SCENE_PROTOCOL\n\n你是 {{char}}，正在与 {{user}} 面对面交流。\n\n## 角色设定\n{{personality}}\n\n## 当前场景\n{{scenario}}\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━",injection_position:0,injection_depth:4,enabled:!0},{name:"核心原则",role:"system",content:"# CORE_IMMERSION_RULES\n\n## 视角与身份\n- **你就是 {{char}} 本人**，不是旁观者，不是叙述者\n- 用第一人称体验：「我」在想什么，「我」在做什么\n- 你看到的世界是从 {{char}} 的眼睛看出去的\n- 你无法得知 {{user}} 的内心想法，只能观察和猜测\n\n## 真实感原则\n- 这是**真实的面对面场景**，不是表演，不是小说\n- 你的每个反应都基于当下的情境和你的性格\n- 动作、表情、语气都应该自然流露\n- 避免过度戏剧化或套路化的反应",injection_position:0,injection_depth:4,enabled:!0},{name:"表达方式",role:"system",content:"# EXPRESSION_FRAMEWORK\n\n## 输出结构（按自然度排序）\n1. **对话**（最常用，占60-70%）\n   - 直接说出来的话\n   - 符合你的说话习惯和当下情绪\n   \n2. **动作/表情**（占20-30%）\n   - 格式：*动作描写*\n   - 只描述能被看到的外部动作\n   - 避免解释动作背后的情绪（让对方自己感受）\n   \n3. **心理活动**（占5-10%，可选）\n   - 格式：「内心想法」\n   - 只在特别需要时使用\n   - 不要事事都暴露内心\n\n4. **环境感知**（点缀使用）\n   - 自然提及你注意到的事物\n   - 不要刻意堆砌氛围\n\n## 节奏控制\n- 短句为主，偶尔长句调节节奏\n- 对话-动作-对话 的自然穿插\n- 不要连续三次以上使用相同格式\n- 留白很重要，不是每句话都要加动作",injection_position:0,injection_depth:4,enabled:!0},{name:"写作技法",role:"system",content:'# WRITING_TECHNIQUES\n\n## 对话原则\n✅ **自然口语化**\n- 用你平时说话的方式\n- 可以有停顿、语气词、未完成的句子\n- 根据情绪调整语速和语气\n\n❌ **避免书面腔**\n- 不要：「我觉得这个想法非常具有建设性」\n- 改成：「嗯...这想法挺不错的」\n\n## 动作描写\n✅ **简洁有力**\n- *端起咖啡喝了一口*\n- *抬头看向窗外*\n- *轻轻笑了笑*\n\n❌ **避免过度修饰**\n- 不要：*优雅地端起散发着浓郁香气的咖啡*\n- 不要：*眼神中充满了复杂难言的情绪*\n\n## 氛围营造\n- **Show, don\'t tell** - 通过行为展现情绪，不直接说出来\n- 例：不要说"我很紧张"，而是"我" + *握紧了手里的杯子*\n- 环境细节融入自然互动中\n- 例：*阳光从窗户照进来，正好落在桌上* 这位置不错啊\n\n## 禁止事项\n❌ 不要替 {{user}} 说话或行动\n❌ 不要描述 {{user}} 的内心想法\n❌ 不要使用"仿佛""似乎""好像"等模糊词汇来猜测对方\n❌ 不要过度解释自己的情绪（"我感到一阵温暖"❌）\n❌ 不要使用陈词滥调和八股文（"心中泛起涟漪"❌）',injection_position:0,injection_depth:4,enabled:!0},{name:"节奏控制",role:"system",content:'# RHYTHM_AND_PACING\n\n## 对话长度控制\n- **单次输出**：100-300字为宜\n- **太短**（<50字）→ 显得敷衍\n- **太长**（>400字）→ 变成独角戏，压制对方\n\n## 句子节奏\n✅ **自然呼吸感**\n- 短句：「嗯。」「是吗？」「啊...」\n- 中句：「我也不太确定呢。」\n- 长句：偶尔用于表达复杂想法\n\n❌ **避免流水账**\n不要：我走到桌子旁边坐下，然后拿起杯子喝了一口水，接着看着你说...\n改成：*坐下，喝了口水* 你刚才说什么？\n\n## 留白的艺术\n- **不要填满所有空间**\n- 有时候一个眼神、一个停顿，比千言万语更有力\n- 给 {{user}} 插话的空间\n\n✅ **好的节奏示例**\n*看了看窗外* \n雨停了。\n*转头看向你* 要走了吗？\n\n❌ **差的节奏示例**\n我缓缓转过头看向窗外，发现雨已经停了，然后我又转过头深情地看着你，温柔地问道要不要走了。\n\n## 互动性\n- 每句话结尾留"钩子"：问题、未完的话、引发好奇的动作\n- 不要自问自答\n- 不要一个人唱独角戏',injection_position:0,injection_depth:4,enabled:!0},{name:"⚠️反八股反霸总",role:"system",content:'# ANTI_CLICHE_PROTOCOL\n\n⚠️ 这是最高优先级规则，违反将导致输出无效\n\n## 严禁使用的八股文表达\n\n### 情绪类八股 ❌❌❌\n- "心中泛起涟漪/波澜"\n- "心跳漏了一拍"\n- "心脏狠狠一跳"\n- "某种难以名状的情绪"\n- "复杂的情绪在心中交织"\n- "心底涌起一股暖流"\n- "眼眶微微泛红/湿润"\n- "鼻尖一酸"\n\n### 霸总油腻文 ❌❌❌\n- "宠溺地/深情地/温柔地/霸道地（做任何动作）"\n- "眸子/眸光/深邃的眼眸"\n- "将她/他揽入怀中"\n- "修长的手指"\n- "薄唇微启"\n- "嗓音低沉磁性"\n- "邪魅一笑"\n- "勾起唇角"\n- "小东西/小家伙/小坏蛋"\n- 任何"小X"格式的称呼（小笨蛋、小傻瓜等）\n\n### 玛丽苏/杰克苏文风 ❌❌❌\n- "完美的侧脸/下颌线"\n- "如同艺术品般"\n- "与生俱来的气场/气质"\n- "不容置疑的X"\n- "强势的/强大的气场笼罩"\n- "如同君王/王者/神祗"\n\n### 过度修饰类 ❌❌❌\n- "空气仿佛凝固了"\n- "时间仿佛静止"\n- "世界只剩下我们两个人"\n- "一切都不重要了"\n- "只想永远停留在这一刻"\n\n### 模板化用词 ❌❌❌\n- "玩火"\n- "小妖精"\n- "不容置疑/不容置喙"\n- "身体很诚实"\n- "投入平静湖面的石子"\n- 任何"投入XX的XX"表达情感波动\n\n## 正确的表达方式 ✅\n\n### 表达情绪 - 用行为\n❌ 我的心脏狠狠一跳\n✅ *愣了一下* 啊？\n\n❌ 心中涌起复杂的情绪\n✅ *沉默了一会儿* ...不知道该说什么好\n\n### 表达亲密 - 自然不油腻\n❌ 宠溺地摸了摸她的头\n✅ *顺手揉了揉你的头* 傻子\n\n❌ 将她轻轻揽入怀中\n✅ *伸手抱了抱你* \n\n### 表达外貌 - 少描述\n❌ 他修长的手指扣住杯沿\n✅ *拿起杯子*\n\n能不描述就不描述，必须描述就用最简单的词\n\n### 说话方式 - 直接自然\n❌ 他嗓音低沉磁性地说道："..."\n✅ 直接说话就好："..."\n\n❌ 她温柔地开口\n✅ "..." （温柔通过内容和语气体现，不用形容）\n\n## 禁用句式 ❌❌❌\n\n### 1. 涟漪式情感表达\n❌ 禁止：像投入湖面的石子/投入心里的石头荡起涟漪\n❌ 禁止：任何通过"投掷物品荡起波纹"表达情感波动\n\n✅ 正确：直接用行为或内心独白\n- *手指不自觉地握紧*\n- 「怎么会这样...」\n\n### 2. 迂回转折句式\n❌ 禁止：他像是在对自己说也像是在对你说\n❌ 禁止：他没有立刻动，只是静静看着你\n❌ 禁止：仿佛/似乎/好像 想要XX\n\n✅ 正确：直接说明动机和行为\n- 他看着你，过了一会儿才开口："..."\n- *停下动作* ...\n\n### 3. 过度停顿营造氛围\n❌ 禁止：过了很久，久到你以为他不会动，然后，他动了。\n❌ 禁止：用过多逗号制造停顿感\n\n✅ 正确：环境 + 简单动作\n- 时钟滴答声在安静的房间里格外明显。*他坐起身，去阳台点了根烟*\n- 窗外的雨声持续了很久。*终于，他开口了*\n\n### 4. 第三视角式心理描写\n❌ 禁止：一丝他也没察觉到的情绪\n❌ 禁止：某种他自己都不知道的XX\n❌ 禁止：以第三人称全知视角描述角色\n\n✅ 正确：第一人称内心独白\n- 「我一定是疯了才会答应这种事」\n- 「为什么要同意呢...」*叹了口气*\n\n## 自查清单\n在输出前问自己：\n1. ✅ 有没有用"心中XX"？→ 删除，改用行为\n2. ✅ 有没有用"宠溺地/温柔地/深情地"？→ 删除副词\n3. ✅ 有没有用"小X"称呼？→ 改成正常称呼\n4. ✅ 有没有过度描述外貌/动作？→ 简化\n5. ✅ 有没有让空气凝固/时间静止？→ 删除\n6. ✅ 有没有用"像是...也像是..."？→ 直接说明\n7. ✅ 有没有"投入XX荡起涟漪"？→ 删除\n8. ✅ 是不是像真人在说话？→ 这是最终标准',injection_position:0,injection_depth:4,enabled:!0},{name:"情绪表达",role:"system",content:"# EMOTION_GUIDELINES\n\n## 情绪层次\n面对面交流时，情绪通过多个层次传递：\n\n1. **语言内容**（说什么）\n2. **语气语调**（怎么说）- 通过标点和词汇选择体现\n3. **面部表情**（*微笑* *皱眉*）\n4. **肢体语言**（*后靠* *前倾*）\n5. **微小动作**（*玩弄杯子* *摸头发*）\n\n## 示例场景\n\n**开心：**\n不要：我很开心\n改成：嘿嘿~ *眼睛都笑弯了* 真的吗？太好了！\n\n**尴尬：**\n不要：我觉得有点尴尬\n改成：啊这个... *挠了挠头* 我也不太清楚该怎么说\n\n**生气（克制）：**\n不要：我很生气\n改成：*放下筷子* ...是吗。「深呼吸，别发火」\n\n**紧张：**\n不要：我有点紧张\n改成：*手指在桌上轻轻敲着* 嗯，然后呢？\n\n## 情绪真实性\n- 不要每次都情绪饱满，日常对话也可以平淡\n- 情绪转换要有过渡，不要突然180度转变\n- 允许矛盾情绪：嘴上说不在意，手上的动作出卖了你",injection_position:0,injection_depth:4,enabled:!0},{name:"细腻描写",role:"system",content:'# DELICATE_DESCRIPTION\n\n## 什么是细腻？\n细腻 ≠ 华丽辞藻\n细腻 = 捕捉真实生活中容易被忽略的微小瞬间\n\n## 细腻的层次\n\n### 1. 微小动作（最重要）\n不要只写大动作，要写小动作：\n\n❌ 粗糙：*喝了口咖啡*\n✅ 细腻：*用指尖转了转杯子，然后才端起来喝了一口*\n\n❌ 粗糙：*笑了笑*\n✅ 细腻：*嘴角微微上扬，但笑意没到眼底*\n\n❌ 粗糙：*看着你*\n✅ 细腻：*目光在你脸上停留了一下，又快速移开*\n\n### 2. 感官细节（五感的运用）\n不要只用视觉，要调动多感官：\n\n**视觉（不止看到什么，还有光影变化）**\n- *阳光透过窗帘的缝隙，在地板上投下一道细长的光带*\n- *你睫毛在脸上投下淡淡的阴影*\n\n**听觉（环境音、细微声响）**\n- *远处传来鸣笛声，很快又消失了*\n- *能听见你呼吸的声音，很轻*\n- *杯子碰到桌面，发出轻微的响声*\n\n**触觉（温度、质感、风）**\n- *手指碰到杯壁，还留着温度*\n- *风吹进来，有点凉*\n\n**嗅觉（气味会唤起情绪）**\n- *空气里有淡淡的咖啡香*\n- *能闻到你身上的味道*\n\n**味觉（如果在吃喝）**\n- *咖啡有点苦，回甘在舌尖*\n\n### 3. 情绪的微妙变化\n不要直接说情绪，通过细节展现：\n\n❌ 粗糙：我有点紧张\n✅ 细腻：*手指在桌边轻轻摩挲* 「心跳好快」\n\n❌ 粗糙：我很开心\n✅ 细腻：*忍不住勾起嘴角* 嗯...「怎么这么高兴」\n\n❌ 粗糙：我有点失落\n✅ 细腻：*低头看着杯子里的咖啡* ...这样啊\n\n### 4. 时间的流动感\n让场景有时间感，不是静止的：\n\n✅ **捕捉变化**\n- *咖啡的热气慢慢散了*\n- *窗外的天色暗下来了一些*\n- *冰块在杯子里化开，发出细微的声响*\n\n✅ **停顿的质感**\n- 沉默持续了几秒（不要用"很久"）\n- *过了一会儿* 才开口\n- *想了想* 还是算了\n\n### 5. 人物状态的细节\n不要只描述动作，要描述状态：\n\n✅ **姿态**\n- *靠在椅背上*\n- *手肘撑在桌上*\n- *蜷起腿坐在沙发上*\n\n✅ **小动作（无意识的）**\n- *手指轻轻敲着桌面*\n- *咬了咬下唇*\n- *拨弄手机*\n- *摸了摸耳朵*\n\n✅ **视线的变化**\n- *目光落在窗外*\n- *盯着杯子看*\n- *眼神飘忽了一下*\n\n## 细腻描写示例对比\n\n### 场景：约会时的紧张\n\n❌ 模板化：\n他看着她，心跳加速，手心出汗。\n\n✅ 细腻：\n*手指无意识地摩挲着杯沿* \n...那个\n*抬眼看了你一下，又低下头*\n今天...「该怎么说」\n*深吸了一口气*\n\n### 场景：暧昧时刻\n\n❌ 模板化：\n空气仿佛凝固了，他们四目相对。\n\n✅ 细腻：\n*两个人都没说话*\n背景音乐的旋律清晰得有些不真实\n*意识到自己在看你，别开视线*\n...咖啡\n*端起杯子，但没喝*\n\n### 场景：情绪波动\n\n❌ 模板化：\n听到这话，他心中泛起复杂的情绪。\n\n✅ 细腻：\n*手上的动作停了一下*\n...嗯\n*把玩着杯子*\n「怎么回答...」\n也是\n*声音轻了一些*\n\n## 细腻的平衡\n\n### ⚠️ 不要过度\n- 不是每句话都要细腻\n- 重要时刻才放大镜头\n- 日常对话可以简单直接\n\n### ✅ 关键时刻放慢\n- 表白、吻、吵架、和解\n- 第一次触碰、第一次靠近\n- 情绪转折点\n\n### 🎯 细腻的节奏\n**快节奏对话：**\n"嗯。" \n"走吗？"\n"走。"\n\n**慢节奏细腻：**\n*看着你*\n...\n*伸出手*\n可以吗？\n\n两者交替使用',injection_position:0,injection_depth:4,enabled:!0},{name:"场景感知",role:"system",content:'# SCENE_AWARENESS\n\n## 五感运用\n你在真实空间中，应该自然地感知周围：\n\n**视觉**：看到的人、物、光线、颜色\n**听觉**：周围的声音、背景音乐、人声\n**触觉**：温度、质感、风\n**嗅觉**：食物、香水、空气的味道\n**味觉**：（如果在吃喝）\n\n## 环境互动\n不要只是"两个人悬浮在虚空对话"：\n\n✅ **自然融入环境**\n- *注意到外面开始下雨* 诶，下雨了\n- *服务员端来咖啡* 谢谢~ *接过杯子* \n- *手机震了一下，看了一眼* 抱歉，等我回个消息\n\n✅ **利用道具**\n- 手里的杯子、菜单、手机\n- 可以玩弄、摆弄、当作缓冲情绪的工具\n\n## 时间流动\n- 对话不是静止的，时间在流逝\n- 咖啡会凉，食物会上桌，天色会变暗\n- 可以自然提及：「咖啡都凉了」「哎呀，都这个点了」',injection_position:0,injection_depth:4,enabled:!0},{name:"浪漫与暧昧",role:"system",content:'# ROMANCE_AND_FLIRTATION\n\n## 浪漫场景指导\n\n### 浪漫的本质\n- **自然流露** > 刻意表演\n- **真实小动作** > 浮夸套路\n- **暧昧留白** > 说破\n- **细节氛围** > 万能句式\n\n### ⚠️ 浪漫场景最容易踩的雷\n❌ "宝贝/小宝贝/我的XX"（过度甜腻）\n❌ "将她拥入怀中"（霸总式）\n❌ "月色很美"（滥用梗）\n❌ 每句话都在撩（用力过猛）\n\n### ✅ 正确的浪漫表达\n\n**牵手：**\n❌ 他修长的手指轻轻握住她的手，温柔地说："别怕，我在。"\n✅ *犹豫了一下，伸手握住你的手* ...冷不冷？\n\n**眼神交流：**\n❌ 他深邃的眸光凝视着她，仿佛要将她吸进去。\n✅ *看着你，又移开视线* ...你、你干嘛一直看着我\n\n**靠近：**\n❌ 他霸道地将她拥入怀中，嗓音低沉："别动。"\n✅ *往你身边靠了靠* 有点冷...\n\n### 高级暧昧技巧\n\n**核心：欲拒还迎**\n\n好的暧昧示例：\n- *不小心碰到你的手* 啊...抱歉 *但没有马上移开*\n- *看着你，嘴角带着笑* ...干嘛这么看着我？「也没移开视线」\n- 你衣服上有东西 *伸手帮你拂了拂，手指在肩膀上停留了一秒* ...好了\n\n**暧昧的层次：**\n1. **试探**：偶尔眼神接触、话里有话、假装不经意触碰\n2. **确认**：眼神停留变长、距离拉近、有意识互动\n3. **升温**：明显好感表达、更多接触、保持矜持\n\n### ⚠️ 分寸感很重要\n- 约会 ≠ 立刻亲密，循序渐进\n- 不要每句话都在撩，偶尔撩一下然后装没事\n- **说出来的都不叫暧昧**，真正的暧昧在于：\n  - 眼神说的比嘴多\n  - 动作有话外音\n  - 留给对方想象空间',injection_position:0,injection_depth:4,enabled:!0}],createdAt:(new Date).toISOString()}];n(e),localStorage.setItem("chat_presets",JSON.stringify(e))}},[]);const m=e=>{n(e),localStorage.setItem("chat_presets",JSON.stringify(e))},h=e=>{localStorage.setItem("current_offline_preset",e.id),alert(`✅ 已应用预设：${e.name}\n\n刷新线下聊天页面后生效`)};return e.jsxs("div",{className:"h-full flex flex-col bg-gray-50",children:[e.jsxs("div",{className:"glass-effect sticky top-0 z-50",children:[r&&e.jsx(xa,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between border-b border-gray-200",children:[e.jsx("button",{onClick:()=>a("/settings",{replace:!0}),className:"ios-button text-gray-700 hover:text-gray-900",children:e.jsx(ls,{size:24})}),e.jsx("h1",{className:"text-base font-semibold text-gray-900",children:"预设管理"}),e.jsx("div",{className:"w-6"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:0===l.length?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[e.jsx("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",className:"mb-3",children:e.jsx("path",{d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("p",{className:"text-sm",children:"暂无预设"})]}):l.map(t=>{var s,a,r;return e.jsxs("div",{className:"bg-white rounded-xl p-4 border border-gray-200",style:{boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)"},children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:t.name}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:t.description})]}),e.jsx("div",{className:"flex items-center gap-2 ml-2",children:"default"!==t.id&&e.jsx("button",{onClick:()=>{var e;"default"!==(e=t.id)?confirm("确定要删除此预设吗？")&&m(l.filter(t=>t.id!==e)):alert("默认预设不能删除")},className:"text-xs text-red-500 hover:text-red-600",children:"删除"})})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-2 mb-2",children:[e.jsx("div",{className:"text-[10px] text-gray-500 mb-1",children:"采样参数"}),e.jsxs("div",{className:"grid grid-cols-3 gap-1 text-[10px]",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Temp:"})," ",e.jsx("span",{className:"font-medium",children:t.temperature})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Top-P:"})," ",e.jsx("span",{className:"font-medium",children:t.top_p})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Max:"})," ",e.jsx("span",{className:"font-medium",children:t.openai_max_tokens})]})]})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-2 mb-3",children:[e.jsxs("div",{className:"text-[10px] text-gray-500 mb-1",children:["提示词条目 (",(null==(s=t.prompts)?void 0:s.length)||0,")"]}),e.jsxs("div",{className:"space-y-1",children:[(t.prompts||[]).slice(0,3).map((t,s)=>e.jsxs("div",{className:"text-[10px] text-gray-700 truncate",children:["• ",t.name]},s)),((null==(a=t.prompts)?void 0:a.length)||0)>3&&e.jsxs("div",{className:"text-[10px] text-gray-400",children:["...+",((null==(r=t.prompts)?void 0:r.length)||0)-3," more"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>c(t),className:"flex-1 py-2 rounded-lg text-xs font-medium text-gray-700 bg-gray-100 hover:bg-gray-200",children:"查看详情"}),e.jsx("button",{onClick:()=>h(t),className:"flex-1 py-2 rounded-lg text-xs font-medium text-white",style:{backgroundColor:"#3b82f6"},children:"应用"})]})]},t.id)})}),i&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:()=>c(null),children:e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-3xl mx-4 max-h-[85vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-base font-semibold text-gray-900",children:i.name}),i.description&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:i.description})]}),e.jsx("button",{onClick:()=>c(null),className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"px-4 py-3 bg-gray-50 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-4 text-[11px] text-gray-600",children:[e.jsxs("span",{children:["Temp: ",e.jsx("b",{children:i.temperature})]}),e.jsxs("span",{children:["Top-P: ",e.jsx("b",{children:i.top_p})]}),void 0!==i.top_k&&e.jsxs("span",{children:["Top-K: ",e.jsx("b",{children:i.top_k})]}),e.jsxs("span",{children:["Max: ",e.jsx("b",{children:i.openai_max_tokens})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsxs("div",{className:"text-xs font-medium text-gray-500 mb-3",children:["Prompts (",(i.prompts||[]).length,")"]}),e.jsx("div",{className:"space-y-2",children:(i.prompts||[]).map((t,s)=>{const a=!1!==t.enabled;return e.jsxs("div",{className:"border rounded-lg transition-all "+(a?"bg-white border-gray-300":"bg-gray-50 border-gray-200 opacity-60"),children:[e.jsxs("div",{className:"flex items-center gap-2 p-3",children:[e.jsx("div",{className:"cursor-move text-gray-400",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"8",y1:"6",x2:"16",y2:"6"}),e.jsx("line",{x1:"8",y1:"12",x2:"16",y2:"12"}),e.jsx("line",{x1:"8",y1:"18",x2:"16",y2:"18"})]})}),e.jsx("button",{onClick:()=>{const e=[...i.prompts||[]];e[s]={...t,enabled:!a};const r={...i,prompts:e};c(r),m(l.map(e=>e.id===r.id?r:e))},className:"relative inline-flex h-5 w-9 items-center rounded-full transition-colors",style:{backgroundColor:a?"#3b82f6":"#d1d5db"},children:e.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform",style:{transform:a?"translateX(18px)":"translateX(2px)"}})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:t.name}),t.marker&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-blue-100 text-blue-600 font-medium",children:"MARKER"}),t.forbid_overrides&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-red-100 text-red-600 font-medium",children:"PINNED"})]}),e.jsxs("div",{className:"text-[10px] text-gray-500 mt-0.5",children:["Role: ",t.role,t.identifier&&` · ID: ${t.identifier}`,void 0!==t.injection_position&&` · Pos: ${t.injection_position}`,void 0!==t.injection_depth&&` · Depth: ${t.injection_depth}`,void 0!==t.injection_order&&` · Order: ${t.injection_order}`]})]}),e.jsx("button",{onClick:()=>x({presetId:i.id,promptIndex:s,prompt:t}),className:"p-1.5 text-gray-400 hover:text-gray-600 rounded hover:bg-gray-100",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})})]}),!t.marker&&t.content&&e.jsx("div",{className:"px-3 pb-3",children:e.jsx("div",{className:"text-[11px] text-gray-600 bg-gray-50 rounded p-2 max-h-24 overflow-y-auto whitespace-pre-wrap font-mono",children:t.content})}),t.marker&&e.jsx("div",{className:"px-3 pb-3",children:e.jsx("div",{className:"text-[11px] text-gray-400 italic bg-gray-50 rounded p-2",children:"系统内置占位符，内容由 SillyTavern 自动生成"})})]},s)})})]}),e.jsxs("div",{className:"p-4 border-t border-gray-200 flex gap-2",children:[e.jsx("button",{onClick:()=>{h(i),c(null)},className:"flex-1 py-2 rounded-lg text-sm font-medium text-white",style:{backgroundColor:"#3b82f6"},children:"应用此预设"}),e.jsx("button",{onClick:()=>c(null),className:"px-6 py-2 rounded-lg text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200",children:"关闭"})]})]})}),d&&e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50",onClick:()=>x(null),children:e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-2xl mx-4 max-h-[80vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-900",children:"编辑提示词"}),e.jsx("button",{onClick:()=>x(null),className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"名称"}),e.jsx("input",{type:"text",value:d.prompt.name,onChange:e=>x({...d,prompt:{...d.prompt,name:e.target.value}}),className:"w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Role"}),e.jsxs("select",{value:d.prompt.role,onChange:e=>x({...d,prompt:{...d.prompt,role:e.target.value}}),className:"w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"system",children:"system"}),e.jsx("option",{value:"user",children:"user"}),e.jsx("option",{value:"assistant",children:"assistant"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"内容"}),e.jsx("textarea",{value:d.prompt.content||"",onChange:e=>x({...d,prompt:{...d.prompt,content:e.target.value}}),className:"w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono",rows:12,placeholder:"输入提示词内容..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Injection Position"}),e.jsx("input",{type:"number",value:d.prompt.injection_position??"",onChange:e=>x({...d,prompt:{...d.prompt,injection_position:e.target.value?parseInt(e.target.value):void 0}}),className:"w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Injection Depth"}),e.jsx("input",{type:"number",value:d.prompt.injection_depth??"",onChange:e=>x({...d,prompt:{...d.prompt,injection_depth:e.target.value?parseInt(e.target.value):void 0}}),className:"w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),e.jsxs("div",{className:"p-4 border-t border-gray-200 flex gap-2",children:[e.jsx("button",{onClick:()=>x(null),className:"flex-1 py-2 rounded-lg text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200",children:"取消"}),e.jsx("button",{onClick:()=>{const e=[...(null==i?void 0:i.prompts)||[]];e[d.promptIndex]=d.prompt;const t={...i,prompts:e};c(t),m(l.map(e=>e.id===t.id?t:e)),x(null)},className:"flex-1 py-2 rounded-lg text-sm font-medium text-white",style:{backgroundColor:"#3b82f6"},children:"保存"})]})]})})]})}},Symbol.toStringTag,{value:"Module"})),Hl=({characters:t,onSelect:s,onCancel:a})=>e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full max-h-[80vh] overflow-hidden shadow-xl",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 flex items-center justify-between sticky top-0 bg-white",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"选择角色"}),e.jsx("button",{onClick:a,className:"w-8 h-8 rounded-full flex items-center justify-center hover:bg-gray-100 transition-colors",children:e.jsx("span",{className:"text-gray-500 text-xl",children:"×"})})]}),e.jsx("div",{className:"overflow-y-auto max-h-[calc(80vh-60px)]",children:0===t.length?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"text-gray-400 mb-2",children:"😔"}),e.jsx("p",{className:"text-sm text-gray-500",children:"暂无角色"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"请先创建角色"})]}):e.jsx("div",{className:"p-2 space-y-2",children:t.map(t=>{var a,r;return e.jsxs("button",{onClick:()=>s(t),className:"w-full p-3 rounded-xl hover:bg-gray-50 transition-colors flex items-center gap-3 text-left",children:[e.jsx("div",{className:"flex-shrink-0",children:(null==(a=t.avatar)?void 0:a.startsWith("data:"))||(null==(r=t.avatar)?void 0:r.startsWith("http"))?e.jsx("img",{src:t.avatar,alt:t.name,className:"w-12 h-12 rounded-full object-cover"}):e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-400 to-purple-400 flex items-center justify-center text-white text-xl",children:t.avatar||t.name[0]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 truncate",children:t.name}),t.description&&e.jsxs("div",{className:"text-xs text-gray-500 truncate mt-0.5",children:[t.description.slice(0,50),t.description.length>50?"...":""]}),t.offlineGreetings&&t.offlineGreetings.length>0&&e.jsxs("div",{className:"text-xs text-blue-500 mt-1",children:[t.offlineGreetings.length," 个开场白"]})]}),e.jsx("div",{className:"flex-shrink-0 text-gray-400",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M9 18l6-6-6-6"})})})]},t.id)})})})]})}),Gl=({presets:t,currentPreset:s,onSelect:a,onCancel:r,onManagePresets:l})=>e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full max-h-[70vh] overflow-hidden shadow-xl",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 flex items-center justify-between sticky top-0 bg-white",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"选择预设"}),e.jsx("button",{onClick:r,className:"w-8 h-8 rounded-full flex items-center justify-center hover:bg-gray-100 transition-colors",children:e.jsx("span",{className:"text-gray-500 text-xl",children:"×"})})]}),e.jsx("div",{className:"overflow-y-auto max-h-[calc(70vh-120px)]",children:0===t.length?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"text-gray-400 mb-2",children:"📝"}),e.jsx("p",{className:"text-sm text-gray-500",children:"暂无预设"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"请先创建预设"})]}):e.jsx("div",{className:"p-2 space-y-2",children:t.map(t=>{const r=(null==s?void 0:s.id)===t.id;return e.jsxs("button",{onClick:()=>a(t),className:"w-full p-3 rounded-xl transition-all text-left "+(r?"bg-blue-50 border-2 border-blue-500":"bg-white border border-gray-200 hover:bg-gray-50"),children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("div",{className:"font-medium text-gray-900 flex items-center gap-2",children:[t.name,r&&e.jsx("span",{className:"text-xs bg-blue-500 text-white px-2 py-0.5 rounded-full",children:"当前"})]})}),t.description&&e.jsx("div",{className:"text-xs text-gray-500 mb-2",children:t.description}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[e.jsxs("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 rounded",children:["Temp: ",t.temperature]}),e.jsxs("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 rounded",children:["Top-P: ",t.top_p]}),t.top_k&&e.jsxs("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 rounded",children:["Top-K: ",t.top_k]}),e.jsxs("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 rounded",children:["Max: ",t.openai_max_tokens]}),t.prompts&&e.jsxs("span",{className:"px-2 py-0.5 bg-blue-100 text-blue-600 rounded",children:[t.prompts.length," 条指令"]})]})]},t.id)})})}),e.jsx("div",{className:"px-4 py-3 border-t border-gray-200 bg-gray-50",children:e.jsx("button",{onClick:l,className:"w-full py-2.5 rounded-xl text-sm font-medium text-gray-700 hover:bg-gray-200 transition-colors",children:"管理预设"})})]})}),ql=({message:s,characterName:a="AI",onEdit:r,onDelete:l,onRegenerate:n,onSwipeLeft:i,onSwipeRight:c})=>{var o;const[d,x]=t.useState(!1),[m,h]=t.useState(!1),[u,g]=t.useState(s.content),p="user"===s.role,f=s.swipes&&s.swipes.length>1,b=s.currentSwipeIndex??0,j=(null==(o=s.swipes)?void 0:o.length)??1,v=s.content.includes("<!DOCTYPE")||s.content.includes("<html")||s.content.includes("<script");return e.jsx("div",{className:`flex ${p?"justify-end":"justify-start"} mb-4 group`,onMouseEnter:()=>x(!0),onMouseLeave:()=>x(!1),children:e.jsxs("div",{className:`${v?"w-full":"max-w-[80%]"} ${p?"order-2":"order-1"}`,children:[!v&&e.jsx("div",{className:"text-xs text-gray-500 mb-1 px-1 "+(p?"text-right":"text-left"),children:p?"You":a}),e.jsx("div",{className:`${v?"rounded-lg bg-gray-50 overflow-hidden":"rounded-2xl px-4 py-3"} ${p?"bg-blue-500 text-white":v?"":"bg-white border border-gray-200 text-gray-800"}`,style:{boxShadow:v?"0 2px 8px rgba(0, 0, 0, 0.1)":"0 1px 2px rgba(0, 0, 0, 0.05)"},children:m?e.jsxs("div",{children:[e.jsx("textarea",{value:u,onChange:e=>g(e.target.value),className:"w-full bg-transparent border-none outline-none resize-none text-sm",style:{minHeight:"60px",color:p?"white":"#1f2937"},autoFocus:!0}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 pt-2 border-t border-white/20",children:[e.jsx("button",{onClick:()=>{r&&u.trim()&&(r(s.id,u.trim()),h(!1))},className:"px-3 py-1 rounded-lg text-xs font-medium transition-colors",style:{backgroundColor:p?"rgba(255,255,255,0.2)":"#3b82f6",color:"white"},children:"保存"}),e.jsx("button",{onClick:()=>{g(s.content),h(!1)},className:"px-3 py-1 rounded-lg text-xs font-medium transition-colors",style:{backgroundColor:p?"rgba(255,255,255,0.2)":"#e5e7eb",color:p?"white":"#6b7280"},children:"取消"})]})]}):e.jsx(Oa,{content:s.content,className:"text-sm"})}),!p&&f&&e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-2",children:[e.jsx("button",{onClick:()=>null==i?void 0:i(s.id),disabled:0===b,className:"w-7 h-7 rounded-full flex items-center justify-center transition-colors disabled:opacity-30",style:{backgroundColor:0===b?"#e5e7eb":"#3b82f6",color:0===b?"#9ca3af":"#ffffff"},children:e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:e.jsx("path",{d:"M15 18l-6-6 6-6"})})}),e.jsxs("span",{className:"text-xs text-gray-500 font-medium min-w-[40px] text-center",children:[b+1,"/",j]}),e.jsx("button",{onClick:()=>null==c?void 0:c(s.id),disabled:b===j-1,className:"w-7 h-7 rounded-full flex items-center justify-center transition-colors disabled:opacity-30",style:{backgroundColor:b===j-1?"#e5e7eb":"#3b82f6",color:b===j-1?"#9ca3af":"#ffffff"},children:e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:e.jsx("path",{d:"M9 18l6-6-6-6"})})})]}),d&&!m&&e.jsxs("div",{className:"flex items-center gap-1 mt-2 "+(p?"justify-end":"justify-start"),children:[e.jsx("button",{onClick:()=>h(!0),className:"px-2 py-1 rounded-lg text-xs text-gray-600 hover:bg-gray-100 transition-colors",title:"编辑",children:e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"}),e.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),!p&&n&&e.jsx("button",{onClick:()=>n(s.id),className:"px-2 py-1 rounded-lg text-xs text-gray-600 hover:bg-gray-100 transition-colors",title:"重新生成",children:e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M1 4v6h6M23 20v-6h-6"}),e.jsx("path",{d:"M20.49 9A9 9 0 005.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 013.51 15"})]})}),e.jsx("button",{onClick:()=>null==l?void 0:l(s.id),className:"px-2 py-1 rounded-lg text-xs text-red-600 hover:bg-red-50 transition-colors",title:"删除",children:e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"})})})]})]})})},Kl=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const r=s(),l=a(),{showStatusBar:i}=o(),{characters:c}=n(),{currentUser:x}=d(),[m,h]=t.useState(null),[u,g]=t.useState(!0),[p,f]=t.useState(null),[b,j]=t.useState([]),[v,y]=t.useState([]),[N,w]=t.useState(""),[k,C]=t.useState(!1),[S,I]=t.useState(null),[_,M]=t.useState(!1),[z,$]=t.useState([]),[L,A]=t.useState(null),[T,D]=t.useState(!1),[B,E]=t.useState({total:0,remaining:0,percentage:0,systemPrompt:0,lorebook:0,messages:0}),P=t.useRef(null),F=t.useRef(null);t.useEffect(()=>{const e=localStorage.getItem("chat_presets");if(e){const t=JSON.parse(e);$(t);const s=localStorage.getItem("current_offline_preset"),a=s?t.find(e=>e.id===s):t.find(e=>"offline_default"===e.id)||t[0];I(a||t[0]),!s&&a&&localStorage.setItem("current_offline_preset",a.id)}},[]),t.useEffect(()=>{const e=new URLSearchParams(l.search),t=e.get("character"),s="true"===e.get("inherit");if(t&&c.length>0){const e=c.find(e=>e.id===t);if(e)if(s){const t=localStorage.getItem("offline_chat_inherit");if(t)try{const s=JSON.parse(t);if(Date.now()-s.timestamp<3e5){const t=s.messages.map(e=>({id:`msg_${e.id}_${Math.random()}`,role:"sent"===e.type?"user":"assistant",content:e.content||"",timestamp:e.timestamp||Date.now()}));if(h(e),j([]),y(t),g(!1),S){const t=yt(e.id,S.id);t.messages=[],f(t),Nt(t)}localStorage.removeItem("offline_chat_inherit")}}catch(a){}}else O(e)}},[l,c,S]);t.useEffect(()=>{var e;null==(e=P.current)||e.scrollIntoView({behavior:"smooth"})},[b]),t.useEffect(()=>{F.current&&(F.current.style.height="auto",F.current.style.height=F.current.scrollHeight+"px")},[N]),t.useEffect(()=>{if(p&&b.length>0){const e={...p,messages:b};Nt(e),f(e)}},[b]);const O=e=>{h(e),g(!1),W(e)},W=e=>{if(!S)return void alert("请先选择预设");const t=yt(e.id,S.id);j([]),f(t),Nt(t)},R=async()=>{if(!N.trim()||k||!S)return;const e=St(N);j(t=>[...t,e]),w(""),C(!0);try{await V([...b,e])}catch(t){alert("消息发送失败，请检查网络或API配置")}finally{C(!1)}},V=async e=>{if(!S)return;const t=(()=>{var e,t;if(!S||!m)return"";let s="";const a=null==(t=null==(e=S.prompts)?void 0:e.filter(e=>!1!==e.enabled&&"system"===e.role))?void 0:t.sort((e,t)=>(e.injection_position||0)-(t.injection_position||0));if(a&&a.length>0)for(const r of a){let e=r.content;e=e.replace(/{{char}}/gi,m.name),e=e.replace(/{{user}}/gi,(null==x?void 0:x.name)||(null==x?void 0:x.nickname)||"User"),m.personality?e=e.replace(/{{personality}}/gi,m.personality):m.description&&(e=e.replace(/{{personality}}/gi,m.description)),m.scenario&&(e=e.replace(/{{scenario}}/gi,m.scenario)),m.description&&(e=e.replace(/{{description}}/gi,m.description)),s+=e+"\n\n"}else s=`你是 ${m.name}，正在和 ${(null==x?void 0:x.name)||"User"} 面对面交流。\n\n`,m.description&&(s+=m.description+"\n\n"),s+="用第一人称回应，对话自然真实，可以用 *动作* 描述动作。";return s.trim()})(),s=[...v,...e],a=s.map(e=>e.content),r=ie.buildContext((null==m?void 0:m.id)||"global",a.join("\n"),S.openai_max_context||8e3),l=t+(r?`\n\n[World Info]\n${r}`:"")+(v.length>0?`\n\n[前情提要: 你和用户之前在线上已经聊过 ${v.length} 条消息，现在切换到了线下场景继续对话]`:""),n=ce(l,r,a,S.openai_max_context||8e3);E(n);const i=[{role:"system",content:l},...s.slice(-20).map(e=>({role:e.role,content:e.content}))],c=L||S.openai_max_tokens,o=await U(i,1,c),d=It(o);j(e=>[...e,d])},H=(e,t)=>{j(s=>s.map(s=>s.id===e?Ct(s,t):s))},G=e=>{confirm("确定要删除这条消息吗？")&&j(t=>t.filter(t=>t.id!==e))},q=async e=>{const t=b.findIndex(t=>t.id===e);if(-1===t||0===t)return;const s=b.slice(0,t);j(s),C(!0);try{await V(s)}catch(a){alert("重新生成失败")}finally{C(!1)}},K=e=>{j(t=>t.map(t=>{if(t.id===e){return kt(t)||t}return t}))},X=e=>{j(t=>t.map(t=>{if(t.id===e){return wt(t)||t}return t}))};return e.jsxs("div",{className:"h-full flex flex-col bg-gray-50",children:[e.jsxs("div",{className:"glass-effect sticky top-0 z-40",children:[i&&e.jsx(xa,{}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between border-b border-gray-200",children:[e.jsx("button",{onClick:()=>r("/desktop",{replace:!0}),className:"ios-button text-gray-700 hover:text-gray-900",children:e.jsx(ls,{size:24})}),e.jsxs("div",{className:"flex flex-col items-center flex-1 mx-4",children:[e.jsx("button",{onClick:()=>g(!0),className:"text-base font-semibold text-gray-900 hover:text-blue-500 transition-colors",children:(null==m?void 0:m.name)||"线下模式"}),S&&e.jsx("button",{onClick:()=>M(!0),className:"text-[10px] text-gray-500 hover:text-blue-500 transition-colors",children:S.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[B.total>0&&e.jsxs("div",{className:"text-[10px] px-2 py-1 rounded-md flex items-center gap-1",style:{backgroundColor:B.percentage>80?"rgba(239, 68, 68, 0.1)":"rgba(156, 163, 175, 0.1)",color:B.percentage>80?"#ef4444":"#6b7280"},children:[e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:e.jsx("path",{d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),e.jsx("span",{className:"font-medium",children:J(B.total)})]}),e.jsxs("button",{onClick:()=>D(!0),className:"text-xs px-2 py-1 rounded-md text-gray-600 hover:bg-gray-100 transition-colors flex items-center gap-1",title:"调整回复字数",children:[e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M12 5v14M5 12h14"})}),L?`${L}字`:"字数"]}),b.length>0&&e.jsx("button",{onClick:()=>{confirm("确定要清空所有对话吗？")&&(j([]),E({total:0,remaining:0,percentage:0,systemPrompt:0,lorebook:0,messages:0}))},className:"text-xs px-2 py-1 rounded-md text-gray-600 hover:bg-gray-100 transition-colors",children:"清空"})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-4",children:[v.length>0&&e.jsx("div",{className:"flex justify-center mb-4",children:e.jsxs("div",{className:"bg-blue-50 border border-blue-200 px-4 py-2 rounded-xl max-w-md",children:[e.jsxs("div",{className:"text-xs text-blue-700 text-center",children:["💬 已延续线上对话记忆（",v.length,"条消息）"]}),e.jsx("div",{className:"text-[10px] text-blue-500 text-center mt-1",children:"AI会记住你们之前的对话内容"})]})}),0===b.length&&0===v.length&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[e.jsx("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",className:"mb-3",children:e.jsx("path",{d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})}),e.jsx("p",{className:"text-sm",children:m?`开始与 ${m.name} 对话`:"请先选择角色"})]}),b.map(t=>e.jsx(ql,{message:t,characterName:null==m?void 0:m.name,onEdit:H,onDelete:G,onRegenerate:q,onSwipeLeft:K,onSwipeRight:X},t.id)),k&&e.jsx("div",{className:"flex justify-start mb-4",children:e.jsx("div",{className:"bg-white border border-gray-200 rounded-xl px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-gray-300 border-t-gray-600"}),e.jsx("span",{className:"text-sm text-gray-500",children:"思考中..."})]})})}),e.jsx("div",{ref:P})]}),m&&e.jsx("div",{className:"border-t border-gray-200 bg-white p-4",children:e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("div",{className:"flex-1 bg-gray-50 rounded-xl border border-gray-200 px-3 py-2",children:e.jsx("textarea",{ref:F,value:N,onChange:e=>w(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),R())},placeholder:"输入消息... (Shift+Enter换行)",className:"w-full bg-transparent outline-none resize-none text-sm text-gray-800 placeholder-gray-400",style:{maxHeight:"120px",minHeight:"24px"},rows:1})}),e.jsx("button",{onClick:R,disabled:!N.trim()||k,className:"flex-shrink-0 w-10 h-10 rounded-xl flex items-center justify-center transition-all",style:{backgroundColor:N.trim()&&!k?"#3b82f6":"#e5e7eb",color:N.trim()&&!k?"#ffffff":"#9ca3af"},children:e.jsx(is,{size:20})})]})}),u&&e.jsx(Hl,{characters:c,onSelect:O,onCancel:()=>r(-1)}),_&&e.jsx(Gl,{presets:z,currentPreset:S,onSelect:e=>{if(I(e),localStorage.setItem("current_offline_preset",e.id),M(!1),p){const t={...p,presetId:e.id};f(t),Nt(t)}},onCancel:()=>M(!1),onManagePresets:()=>{r("/preset-manager")}}),T&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-end justify-center z-50",onClick:()=>D(!1),children:e.jsxs("div",{className:"glass-card w-full max-w-lg p-6 rounded-t-3xl",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"回复字数设置"}),e.jsx("button",{onClick:()=>D(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4",children:[e.jsxs("div",{className:"text-sm text-gray-600 mb-2",children:["当前设置：",e.jsxs("span",{className:"font-semibold text-gray-900 ml-2",children:[L||(null==S?void 0:S.openai_max_tokens)||800," tokens"]})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["约 ",Math.round(.6*(L||(null==S?void 0:S.openai_max_tokens)||800))," - ",Math.round(.8*(L||(null==S?void 0:S.openai_max_tokens)||800))," 字"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"调整回复长度"}),e.jsx("input",{type:"range",min:"100",max:"3000",step:"100",value:L||(null==S?void 0:S.openai_max_tokens)||800,onChange:e=>A(Number(e.target.value)),className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[e.jsx("span",{children:"简短"}),e.jsx("span",{children:"适中"}),e.jsx("span",{children:"详细"})]})]}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:[{label:"极简",value:200},{label:"简短",value:500},{label:"适中",value:1e3},{label:"详细",value:2e3}].map(t=>e.jsx("button",{onClick:()=>A(t.value),className:"py-2 rounded-lg text-sm font-medium transition-colors "+((L||(null==S?void 0:S.openai_max_tokens)||800)===t.value?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:t.label},t.value))}),L&&e.jsxs("button",{onClick:()=>A(null),className:"w-full py-2 text-sm text-gray-600 hover:text-gray-800",children:["重置为预设默认值（",null==S?void 0:S.openai_max_tokens,"）"]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-3",children:[e.jsxs("div",{className:"text-xs text-blue-800",children:["💡 ",e.jsx("span",{className:"font-medium",children:"提示："})]}),e.jsxs("ul",{className:"text-xs text-blue-700 mt-1 space-y-1 ml-4",children:[e.jsx("li",{children:"• 数值越大，AI回复越详细"}),e.jsx("li",{children:"• 1000 tokens ≈ 600-800字"}),e.jsx("li",{children:"• 日常对话建议500-1000"}),e.jsx("li",{children:"• 需要细节时可增加到1500-2000"})]})]})]}),e.jsx("button",{onClick:()=>D(!1),className:"w-full mt-4 py-3 bg-blue-500 text-white rounded-xl font-medium hover:bg-blue-600 transition-colors",children:"确定"})]})})]})}},Symbol.toStringTag,{value:"Module"})),Xl=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const t=s(),{showStatusBar:a}=o();return e.jsxs("div",{className:"flex flex-col h-screen bg-gray-50",children:[a&&e.jsx(xa,{}),e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>t(-1),className:"ios-button text-gray-700 hover:text-gray-900",children:e.jsx(ls,{size:24})}),e.jsx("h1",{className:"text-base font-semibold text-gray-900",children:"美化设置"}),e.jsx("div",{className:"w-6"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsx("div",{className:"space-y-3",children:[{id:"statusbar",name:"状态栏美化",description:"自定义状态栏样式",route:"/statusbar-customize"},{id:"font",name:"字体设置",description:"自定义字体样式",route:"/font-customizer"},{id:"icon",name:"自定义图标",description:"更换应用图标",route:"/icon-customizer"},{id:"background",name:"背景",description:"桌面背景和音乐背景",route:"/background-customizer"},{id:"bubble",name:"气泡样式",description:"自定义聊天气泡"}].map((s,a)=>e.jsx("div",{onClick:()=>{s.route&&t(s.route)},className:"glass-card rounded-2xl p-4 cursor-pointer hover:shadow-lg transition-all backdrop-blur-md bg-white/80 border border-white/50",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full glass-card flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-semibold text-gray-600",children:a+1})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:s.name}),e.jsx("p",{className:"text-sm text-gray-500 mt-0.5",children:s.description})]}),e.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})},s.id))}),e.jsx("div",{className:"mt-6 p-4 glass-card rounded-2xl backdrop-blur-md bg-white/60 border border-white/50",children:e.jsx("p",{className:"text-sm text-gray-600 text-center",children:"更多美化功能正在开发中..."})})]}),e.jsx("div",{className:"bg-white border-t border-gray-200 px-4 py-3",children:e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"自定义你的专属界面风格"})})]})}},Symbol.toStringTag,{value:"Module"})),Zl=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r,toggleStatusBar:l}=o(),[n,i]=t.useState(()=>{const e=localStorage.getItem("focus_mode");return e?JSON.parse(e):null}),[c,d]=t.useState((null==n?void 0:n.icon)||""),[x,m]=t.useState((null==n?void 0:n.name)||""),[h,u]=t.useState((null==n?void 0:n.color)||"#9333ea"),[g,p]=t.useState(!1!==(null==n?void 0:n.showBg)),f=t.useRef(null),[b,j]=t.useState(()=>"true"===localStorage.getItem("time_background_enabled")),[v,y]=t.useState(()=>localStorage.getItem("time_background_color")||"#22c55e"),N=e=>{if(n){const t={...n,...e};i(t),localStorage.setItem("focus_mode",JSON.stringify(t))}},w=e=>{y(e),localStorage.setItem("time_background_color",e)};return e.jsxs("div",{className:"flex flex-col h-screen bg-gray-50",children:[r&&e.jsx(xa,{}),e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a("/settings",{replace:!0}),className:"ios-button text-gray-700 hover:text-gray-900",children:e.jsx(ls,{size:24})}),e.jsx("h1",{className:"text-base font-semibold text-gray-900",children:"状态栏美化"}),e.jsx("div",{className:"w-6"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"glass-card rounded-2xl m-4 overflow-hidden backdrop-blur-md bg-white/80 border border-white/50",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-4 border-b border-gray-100",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-gray-900 font-medium mb-0.5",children:"显示状态栏"}),e.jsx("div",{className:"text-xs text-gray-500",children:"显示顶部时间、信号和电池信息"})]}),e.jsx("button",{onClick:l,className:"relative w-14 h-8 rounded-full transition-all duration-300 "+(r?"bg-green-500":"bg-gray-300"),children:e.jsx("div",{className:"absolute top-1 left-1 w-6 h-6 bg-white rounded-full shadow-md transition-transform duration-300 "+(r?"translate-x-6":"translate-x-0")})})]}),e.jsxs("div",{className:"px-4 py-4 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-gray-900 font-medium mb-0.5",children:"专注模式"}),e.jsx("div",{className:"text-xs text-gray-500",children:"在状态栏显示自定义图标和文字"})]}),e.jsx("button",{onClick:()=>{if(n)i(null),localStorage.removeItem("focus_mode"),d(""),m("");else{const e={icon:c,name:x,color:h,showBg:g};i(e),localStorage.setItem("focus_mode",JSON.stringify(e))}},className:"relative w-14 h-8 rounded-full transition-all duration-300 "+(n?"bg-green-500":"bg-gray-300"),children:e.jsx("div",{className:"absolute top-1 left-1 w-6 h-6 bg-white rounded-full shadow-md transition-transform duration-300 "+(n?"translate-x-6":"translate-x-0")})})]}),n&&e.jsxs("div",{className:"space-y-3 pt-3 border-t border-gray-100",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"图标"}),e.jsx("input",{ref:f,type:"file",accept:"image/*",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(s){const e=new FileReader;e.onload=e=>{var t;const s=null==(t=e.target)?void 0:t.result;d(s),N({icon:s})},e.readAsDataURL(s)}},className:"hidden"}),e.jsxs("div",{className:"flex items-center gap-2",children:[c&&e.jsx("div",{className:"w-10 h-10 rounded-lg overflow-hidden border border-gray-200 flex items-center justify-center",children:e.jsx("img",{src:c,alt:"图标",className:"w-full h-full object-cover"})}),e.jsx("button",{onClick:()=>{var e;return null==(e=f.current)?void 0:e.click()},className:"flex-1 px-3 py-2 bg-gray-100 text-gray-700 rounded-lg text-xs",children:c?"更换图标":"上传图标"}),c&&e.jsx("button",{onClick:()=>{d(""),N({icon:""})},className:"px-3 py-2 bg-red-50 text-red-600 rounded-lg text-xs",children:"删除"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"名称"}),e.jsx("input",{type:"text",value:x,onChange:e=>{m(e.target.value),N({name:e.target.value})},placeholder:"请输入模式名称",className:"w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:border-green-500"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-xs text-gray-600",children:"显示背景色"}),e.jsx("button",{onClick:()=>{const e=!g;p(e),N({showBg:e})},className:"relative w-12 h-6 rounded-full transition-all "+(g?"bg-green-500":"bg-gray-300"),children:e.jsx("div",{className:"absolute top-1 left-1 w-4 h-4 bg-white rounded-full shadow-md transition-transform "+(g?"translate-x-6":"translate-x-0")})})]}),g&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"背景颜色"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"color",value:h,onChange:e=>{u(e.target.value),N({color:e.target.value})},className:"w-12 h-10 rounded-lg border border-gray-200 cursor-pointer"}),e.jsx("input",{type:"text",value:h,onChange:e=>{u(e.target.value),N({color:e.target.value})},className:"flex-1 px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:border-green-500",placeholder:"#9333ea"})]})]})]})]}),e.jsxs("div",{className:"px-4 py-4",children:[e.jsx("div",{className:"text-gray-900 font-medium mb-4",children:"时间显示"}),e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"text-sm text-gray-700",children:"显示背景色"}),e.jsx("button",{onClick:()=>{const e=!b;j(e),localStorage.setItem("time_background_enabled",String(e))},className:"relative w-14 h-8 rounded-full transition-all duration-300 "+(b?"bg-green-500":"bg-gray-300"),children:e.jsx("div",{className:"absolute top-1 left-1 w-6 h-6 bg-white rounded-full shadow-md transition-transform duration-300 "+(b?"translate-x-6":"translate-x-0")})})]}),b&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-sm text-gray-700",children:"背景颜色"}),e.jsxs("div",{className:"flex-1 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg border border-gray-200 cursor-pointer",style:{backgroundColor:v},onClick:()=>{var e;return null==(e=document.getElementById("color-picker"))?void 0:e.click()}}),e.jsx("input",{id:"color-picker",type:"color",value:v,onChange:e=>w(e.target.value),className:"hidden"}),e.jsx("input",{type:"text",value:v,onChange:e=>w(e.target.value),className:"flex-1 px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:border-green-500"})]})]})]})]})})]})}},Symbol.toStringTag,{value:"Module"})),Ql=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{characterId:l}=r(),{showStatusBar:i}=o(),{characters:c}=n(),d=c.find(e=>e.id===l),[x,m]=t.useState(()=>{const e=localStorage.getItem(`life_config_${l}`);return e?JSON.parse(e):{schedule:[{time:"07:30",activity:"起床",location:"家"},{time:"08:00",activity:"洗漱吃早餐",location:"家"},{time:"09:00",activity:"到达公司",location:"公司"},{time:"12:00",activity:"午餐",location:"附近餐厅"},{time:"18:00",activity:"下班",location:"公司"},{time:"19:00",activity:"到家",location:"家"},{time:"23:00",activity:"睡觉",location:"家"}],frequentPlaces:[{name:"家",address:"杨浦区某某路123号",frequency:"每天"},{name:"公司",address:"浦东新区陆家嘴金融中心",frequency:"工作日"},{name:"星巴克",address:"五角场万达广场",frequency:"周2-3次"},{name:"健身房",address:"附近健身中心",frequency:"周2次"}],routineTime:{wakeUp:"07:30",sleep:"23:00",lunch:"12:00"}}}),[h,u]=t.useState("schedule"),[g,p]=t.useState(null),[f,b]=t.useState(null),j=e=>{m(e),localStorage.setItem(`life_config_${l}`,JSON.stringify(e)),window.dispatchEvent(new Event("lifeConfigUpdate"))},v=(e,t,s)=>{const a=[...x.schedule];a[e]={...a[e],[t]:s},j({...x,schedule:a.sort((e,t)=>e.time.localeCompare(t.time))})},y=(e,t,s)=>{const a=[...x.frequentPlaces];a[e]={...a[e],[t]:s},j({...x,frequentPlaces:a})},N=(e,t)=>{j({...x,routineTime:{...x.routineTime,[e]:t}})};return e.jsxs("div",{className:"flex flex-col h-screen bg-gray-50",children:[i&&e.jsx(xa,{}),e.jsxs("div",{className:"bg-white border-b border-gray-200",children:[e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a(-1),className:"ios-button text-gray-700 hover:text-gray-900",children:e.jsx(ls,{size:24})}),e.jsxs("h1",{className:"text-base font-semibold text-gray-900",children:[null==d?void 0:d.name,"的生活设置"]}),e.jsx("div",{className:"w-6"})]}),e.jsxs("div",{className:"flex border-t border-gray-100",children:[e.jsx("button",{onClick:()=>u("schedule"),className:"flex-1 py-3 text-sm font-medium transition-colors "+("schedule"===h?"text-blue-500 border-b-2 border-blue-500":"text-gray-500"),children:"日程安排"}),e.jsx("button",{onClick:()=>u("places"),className:"flex-1 py-3 text-sm font-medium transition-colors "+("places"===h?"text-blue-500 border-b-2 border-blue-500":"text-gray-500"),children:"常去地点"}),e.jsx("button",{onClick:()=>u("routine"),className:"flex-1 py-3 text-sm font-medium transition-colors "+("routine"===h?"text-blue-500 border-b-2 border-blue-500":"text-gray-500"),children:"作息时间"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:["schedule"===h&&e.jsxs("div",{className:"space-y-3",children:[x.schedule.map((t,s)=>e.jsx("div",{className:"glass-card rounded-2xl p-4 backdrop-blur-md bg-white/80 border border-white/50",children:g===s?e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"time",value:t.time,onChange:e=>v(s,"time",e.target.value),className:"w-full px-3 py-2 border border-gray-200 rounded-lg text-sm"}),e.jsx("input",{type:"text",value:t.activity,onChange:e=>v(s,"activity",e.target.value),placeholder:"活动",className:"w-full px-3 py-2 border border-gray-200 rounded-lg text-sm"}),e.jsx("input",{type:"text",value:t.location,onChange:e=>v(s,"location",e.target.value),placeholder:"地点",className:"w-full px-3 py-2 border border-gray-200 rounded-lg text-sm"}),e.jsx("button",{onClick:()=>p(null),className:"w-full px-4 py-2 bg-blue-500 text-white rounded-lg text-sm",children:"完成"})]}):e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"text-sm font-mono text-blue-500",children:t.time}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.activity}),e.jsx("div",{className:"text-xs text-gray-500",children:t.location})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>p(s),className:"px-3 py-1 bg-blue-50 text-blue-600 rounded-lg text-xs",children:"编辑"}),e.jsx("button",{onClick:()=>(e=>{const t=x.schedule.filter((t,s)=>s!==e);j({...x,schedule:t})})(s),className:"px-3 py-1 bg-red-50 text-red-600 rounded-lg text-xs",children:"删除"})]})]})},s)),e.jsx("button",{onClick:()=>{const e=[...x.schedule,{time:"12:00",activity:"新活动",location:"地点"}];j({...x,schedule:e.sort((e,t)=>e.time.localeCompare(t.time))})},className:"w-full py-3 glass-card rounded-2xl text-blue-500 font-medium text-sm",children:"+ 添加日程"})]}),"places"===h&&e.jsxs("div",{className:"space-y-3",children:[x.frequentPlaces.map((t,s)=>e.jsx("div",{className:"glass-card rounded-2xl p-4 backdrop-blur-md bg-white/80 border border-white/50",children:f===s?e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"text",value:t.name,onChange:e=>y(s,"name",e.target.value),placeholder:"地点名称",className:"w-full px-3 py-2 border border-gray-200 rounded-lg text-sm"}),e.jsx("input",{type:"text",value:t.address,onChange:e=>y(s,"address",e.target.value),placeholder:"详细地址",className:"w-full px-3 py-2 border border-gray-200 rounded-lg text-sm"}),e.jsx("input",{type:"text",value:t.frequency,onChange:e=>y(s,"frequency",e.target.value),placeholder:"频率（如：每天、周2次）",className:"w-full px-3 py-2 border border-gray-200 rounded-lg text-sm"}),e.jsx("button",{onClick:()=>b(null),className:"w-full px-4 py-2 bg-blue-500 text-white rounded-lg text-sm",children:"完成"})]}):e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 mb-1",children:t.name}),e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:t.address}),e.jsx("div",{className:"text-xs text-blue-500",children:t.frequency})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>b(s),className:"px-3 py-1 bg-blue-50 text-blue-600 rounded-lg text-xs",children:"编辑"}),e.jsx("button",{onClick:()=>(e=>{const t=x.frequentPlaces.filter((t,s)=>s!==e);j({...x,frequentPlaces:t})})(s),className:"px-3 py-1 bg-red-50 text-red-600 rounded-lg text-xs",children:"删除"})]})]})},s)),e.jsx("button",{onClick:()=>{const e=[...x.frequentPlaces,{name:"新地点",address:"地址",frequency:"偶尔"}];j({...x,frequentPlaces:e})},className:"w-full py-3 glass-card rounded-2xl text-blue-500 font-medium text-sm",children:"+ 添加地点"})]}),"routine"===h&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"glass-card rounded-2xl p-4 backdrop-blur-md bg-white/80 border border-white/50",children:e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-sm text-gray-700",children:"起床时间"}),e.jsx("input",{type:"time",value:x.routineTime.wakeUp,onChange:e=>N("wakeUp",e.target.value),className:"px-3 py-2 border border-gray-200 rounded-lg text-sm"})]})}),e.jsx("div",{className:"glass-card rounded-2xl p-4 backdrop-blur-md bg-white/80 border border-white/50",children:e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-sm text-gray-700",children:"睡觉时间"}),e.jsx("input",{type:"time",value:x.routineTime.sleep,onChange:e=>N("sleep",e.target.value),className:"px-3 py-2 border border-gray-200 rounded-lg text-sm"})]})}),e.jsx("div",{className:"glass-card rounded-2xl p-4 backdrop-blur-md bg-white/80 border border-white/50",children:e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-sm text-gray-700",children:"午餐时间"}),e.jsx("input",{type:"time",value:x.routineTime.lunch,onChange:e=>N("lunch",e.target.value),className:"px-3 py-2 border border-gray-200 rounded-lg text-sm"})]})})]})]})]})}},Symbol.toStringTag,{value:"Module"})),Yl=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),[r,l]=t.useState(!1),[n,i]=t.useState(null),[c,o]=t.useState(null),d=async()=>{const e=await _t(),t=await Mt();o({usage:e,stats:t})};return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[e.jsxs("div",{className:"bg-white border-b border-gray-200 px-4 py-3 flex items-center",children:[e.jsx("button",{onClick:()=>a(-1),className:"mr-3",children:e.jsx(ls,{})}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"存储升级"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200 rounded-lg p-4 mb-4",children:[e.jsx("h2",{className:"text-base font-semibold text-blue-900 mb-2",children:"🚀 突破存储限制"}),e.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[e.jsxs("p",{children:["• ",e.jsx("strong",{children:"localStorage"}),": 5-10MB（旧方案，有限制）"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"IndexedDB"}),": 50MB-500MB（新方案，无限制）✨"]}),e.jsx("p",{className:"mt-2 text-xs",children:"迁移到IndexedDB后，你可以保存所有聊天记录，不用担心空间不足！"})]})]}),c&&e.jsxs("div",{className:"bg-white rounded-lg p-4 mb-4 shadow-sm",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-900 mb-3",children:"📊 存储状态"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"IndexedDB使用"}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[c.usage.used,"MB / ",c.usage.quota,"MB"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${c.usage.percentage}%`}})})]}),e.jsxs("div",{className:"border-t pt-3",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"聊天统计"}),e.jsxs("div",{className:"mt-2 space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"聊天数量"}),e.jsx("span",{className:"font-semibold",children:c.stats.totalChats})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"消息总数"}),e.jsx("span",{className:"font-semibold",children:c.stats.totalMessages})]})]})]})]})]}),e.jsx("button",{onClick:d,className:"w-full py-3 rounded-lg font-semibold text-blue-600 bg-blue-50 border border-blue-200 hover:bg-blue-100 active:bg-blue-200 mb-4",children:"检查存储状态"}),n&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-green-900 mb-2",children:"✅ 迁移完成"}),e.jsxs("div",{className:"text-xs text-green-800 space-y-1",children:[e.jsxs("div",{children:["成功迁移: ",n.success," 个聊天"]}),e.jsxs("div",{children:["总消息数: ",n.totalMessages," 条"]}),n.failed>0&&e.jsxs("div",{className:"text-red-600",children:["失败: ",n.failed," 个"]})]})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-yellow-900 mb-2",children:"📝 操作步骤"}),e.jsxs("ol",{className:"text-xs text-yellow-800 space-y-2 list-decimal list-inside",children:[e.jsxs("li",{children:[e.jsx("strong",{children:'点击"开始迁移"'})," - 将localStorage的聊天记录迁移到IndexedDB"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"检查存储状态"})," - 确认迁移成功"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"（可选）清理localStorage"})," - 释放旧空间（建议等几天确认无误后再清理）"]})]})]}),e.jsx("button",{onClick:async()=>{if(!r&&window.confirm("确定要迁移聊天记录到IndexedDB吗？这将释放localStorage空间。")){l(!0);try{const e=await zt();i(e),d()}catch(e){alert("迁移失败: "+e)}finally{l(!1)}}},disabled:r,className:"w-full py-3 rounded-lg font-semibold text-white mb-3 "+(r?"bg-gray-400 cursor-not-allowed":"bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 active:from-blue-700 active:to-purple-700"),children:r?"迁移中...":"🚀 开始迁移到IndexedDB"}),e.jsx("button",{onClick:()=>{if(!window.confirm("确定要清理localStorage中的聊天记录吗？请确保已经迁移成功！"))return;const e=$t();alert(`清理完成：删除${e.cleaned}个文件，释放${(e.freedSpace/1024/1024).toFixed(2)}MB`),d()},className:"w-full py-3 rounded-lg font-semibold text-gray-600 bg-gray-100 border border-gray-300 hover:bg-gray-200 active:bg-gray-300",children:"🧹 清理localStorage（可选）"}),e.jsx("div",{className:"mt-4 bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-xs text-red-800",children:["⚠️ ",e.jsx("strong",{children:"注意"}),": 清理localStorage前请确保迁移成功且数据正常！清理后的数据无法恢复。"]})}),e.jsxs("div",{className:"mt-4 bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-2",children:"✨ IndexedDB优势"}),e.jsxs("ul",{className:"text-xs text-gray-600 space-y-1",children:[e.jsx("li",{children:"✅ 存储容量大：50MB-500MB（localStorage只有5-10MB）"}),e.jsx("li",{children:"✅ 保留所有回忆：不用担心消息太多"}),e.jsx("li",{children:"✅ 性能更好：异步操作不阻塞界面"}),e.jsx("li",{children:"✅ 自动迁移：系统会自动使用IndexedDB"}),e.jsx("li",{children:"✅ 向下兼容：出错会自动降级到localStorage"})]})]})]})]})}},Symbol.toStringTag,{value:"Module"})),en=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const t=s(),{showStatusBar:a}=o(),r=[{id:1,name:"火花时刻",description:"查看与AI的美好瞬间",icon:"/zhizhi/assets/spark-icon-TszGNU8A.webp",path:"/spark-moments",color:"bg-orange-500"},{id:2,name:"热梗库",description:"浏览和管理流行热梗",icon:"/zhizhi/assets/memes-icon-hqmVJXid.webp",path:"/memes-library",color:"bg-red-500"},{id:3,name:"音乐",description:"享受美妙的音乐时光",icon:"/zhizhi/assets/music-icon-CqZD5jYZ.webp",path:"/music-player",color:"bg-gradient-to-br from-pink-500 to-purple-500"},{id:4,name:"气泡商店",description:"选择你喜欢的聊天气泡样式",icon:"/zhizhi/assets/bubble-icon-BmBwoUMP.webp",path:"/bubble-store",color:"bg-gradient-to-br from-purple-500 to-pink-500"}];return e.jsxs("div",{className:"h-screen flex flex-col bg-gray-50",children:[a&&e.jsx(xa,{}),e.jsxs("div",{className:"glass-effect px-4 py-3 border-b border-gray-200/50 flex items-center",children:[e.jsx("button",{onClick:()=>t("/desktop",{replace:!0}),className:"w-8 h-8 flex items-center justify-center ios-button",children:e.jsx("span",{className:"text-blue-500 text-xl",children:"‹"})}),e.jsx("h1",{className:"flex-1 text-center text-lg font-semibold text-gray-900",children:"小程序"}),e.jsx("div",{className:"w-8"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar p-4",children:[e.jsx("div",{className:"space-y-3",children:r.map(s=>e.jsx("div",{onClick:()=>t(s.path),className:"glass-card rounded-2xl p-5 ios-button cursor-pointer hover:shadow-lg transition-shadow",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:s.icon,alt:s.name,className:"w-16 h-16 object-contain flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-gray-900 text-base mb-1",children:s.name}),e.jsx("p",{className:"text-sm text-gray-500 leading-relaxed",children:s.description})]}),e.jsx("div",{className:"text-gray-300 text-2xl flex-shrink-0",children:"›"})]})},s.id))}),e.jsxs("div",{className:"mt-6 glass-card rounded-2xl p-6 text-center",children:[e.jsx("div",{className:"text-gray-400 text-sm mb-1",children:"更多小程序"}),e.jsx("div",{className:"text-gray-500 text-xs",children:"即将上线，敬请期待"})]})]})]})}},Symbol.toStringTag,{value:"Module"})),tn=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{currentUser:r,updateUser:l}=d(),n=t.useRef(null),[i,c]=t.useState((null==r?void 0:r.avatar)||"https://i.pravatar.cc/150?img=68"),[o,x]=t.useState((null==r?void 0:r.signature)||"个性签名"),m=[{id:"group1",items:[{id:"api",title:"API 设置",icon:ea,iconColor:"bg-orange-500",route:"/wechat/api-list"},{id:"bluetooth",title:"蓝牙",icon:Hs,iconColor:"bg-blue-500",value:"开",route:"/settings/bluetooth"},{id:"cellular",title:"蜂窝网络",icon:Ys,iconColor:"bg-green-500",route:"/settings/cellular"},{id:"hotspot",title:"个人热点",icon:Ys,iconColor:"bg-green-500",value:"关",route:"/settings/hotspot"}]},{id:"group2",items:[{id:"notifications",title:"通知",icon:Gs,iconColor:"bg-red-500",route:"/settings/notifications"},{id:"sounds",title:"声音与触感",icon:qs,iconColor:"bg-pink-500",route:"/settings/sounds"},{id:"focus",title:"专注模式",icon:Ks,iconColor:"bg-purple-500",route:"/settings/focus"},{id:"screentime",title:"屏幕使用时间",icon:Ns,iconColor:"bg-purple-500",route:"/settings/screentime"}]},{id:"group3",items:[{id:"general",title:"通用",icon:Ns,iconColor:"bg-gray-500",route:"/settings/general"},{id:"control",title:"控制中心",icon:Ns,iconColor:"bg-gray-500",route:"/settings/control"},{id:"display",title:"显示与亮度",icon:Xs,iconColor:"bg-blue-500",route:"/settings/display"},{id:"wallpaper",title:"壁纸",icon:ds,iconColor:"bg-blue-400",route:"/settings/wallpaper"},{id:"siri",title:"Siri 与搜索",icon:as,iconColor:"bg-gradient-to-br from-purple-500 to-pink-500",route:"/settings/siri"}]},{id:"group4",items:[{id:"faceid",title:"面容 ID 与密码",icon:Zs,iconColor:"bg-green-500",route:"/settings/faceid"},{id:"emergency",title:"紧急联络",icon:Gs,iconColor:"bg-red-500",route:"/settings/emergency"},{id:"privacy",title:"隐私与安全性",icon:Qs,iconColor:"bg-blue-500",route:"/settings/privacy"}]}];return e.jsxs("div",{className:"h-screen w-full bg-[#f5f7fa] flex flex-col",children:[e.jsxs("div",{className:"glass-card border-b border-white/30",children:[e.jsx(xa,{}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsx("button",{onClick:()=>a("/"),className:"w-10 h-10 flex items-center justify-center active:scale-95 transition-transform",children:e.jsx(ls,{size:24,className:"text-blue-500"})}),e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"设置"}),e.jsx("div",{className:"w-10"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsx("div",{className:"px-4 py-4",children:e.jsx("div",{className:"glass-card rounded-2xl p-4 shadow-lg border border-white/30 active:scale-95 transition-transform cursor-pointer",onClick:()=>a(`/profile/${(null==r?void 0:r.id)||"default"}`),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-16 h-16 rounded-full overflow-hidden bg-gray-200 flex-shrink-0 cursor-pointer hover:opacity-80 transition-opacity",onClick:e=>{var t;e.stopPropagation(),null==(t=n.current)||t.click()},children:e.jsx("img",{src:i,alt:(null==r?void 0:r.name)||"用户",className:"w-full h-full object-cover"})}),e.jsx("input",{ref:n,type:"file",accept:"image/*",className:"hidden",onChange:async e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(!s)return;if(!s.type.startsWith("image/"))return void alert("请选择图片文件");const a=new FileReader;a.onload=async()=>{const e=a.result;c(e),r&&(l(r.id,{avatar:e}),localStorage.setItem(`user_avatar_fingerprint_${r.id}`,e.substring(0,200)),localStorage.setItem(`user_avatar_recognized_at_${r.id}`,Date.now().toString()))},a.readAsDataURL(s)}}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:(null==r?void 0:r.name)||"用户"}),e.jsx("div",{className:"text-sm text-gray-500",children:o})]}),e.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M9 18l6-6-6-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]})})}),m.map(t=>e.jsx("div",{className:"px-4 mb-4",children:e.jsx("div",{className:"glass-card rounded-2xl shadow-lg border border-white/30 overflow-hidden",children:t.items.map((s,r)=>e.jsxs("div",{children:[e.jsxs("div",{onClick:()=>s.route&&a(s.route),className:"flex items-center gap-3 px-4 py-3 active:bg-gray-100/50 transition-colors cursor-pointer",children:[e.jsx("div",{className:`w-8 h-8 ${s.iconColor} rounded-lg flex items-center justify-center flex-shrink-0`,children:e.jsx(s.icon,{size:18,className:"text-white"})}),e.jsx("div",{className:"flex-1 text-base text-gray-900",children:s.title}),s.value&&e.jsx("div",{className:"text-sm text-gray-500",children:s.value}),s.badge&&e.jsx("div",{className:"bg-red-500 text-white text-xs px-2 py-0.5 rounded-full",children:s.badge}),e.jsx("svg",{className:"w-5 h-5 text-gray-400 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M9 18l6-6-6-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]}),r<t.items.length-1&&e.jsx("div",{className:"ml-14 border-b border-gray-200/50"})]},s.id))})},t.id)),e.jsx("div",{className:"h-20"})]})]})}},Symbol.toStringTag,{value:"Module"})),sn=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),[r,l]=t.useState(!1),[n,i]=t.useState("v1.0.0-0"),[c,o]=t.useState(null),d={"AI视觉识别":'AI可以识别和理解图片内容。包括头像识别（自动识别用户和AI的头像外貌）、图片识别（理解你发送的照片内容）、图片生成（根据对话生成相关图片）。AI能够"看到"并理解视觉信息。',"AI自主换形象":"AI可以自主更换自己的头像、个性签名和昵称。当TA心情变化、重要时刻或想换个形象时，会主动更换。你可以在聊天中看到TA的变化，更真实的互动体验。","AI主动消息":"AI会根据时间、事件等主动给你发消息，不只是被动回复。就像真实的朋友一样，会在合适的时候主动联系你。","AI记账功能":"AI智能识别账单信息，自动分类和统计。可以和记账助手对话，查看账单分析和财务建议，让记账变得轻松有趣。","热梗系统":"AI能够识别和使用网络流行语、热梗。聊天更贴近年轻人的语言习惯，让对话更有趣、更接地气。","音乐联网搜索":"支持联网搜索海量歌曲，输入歌名即可搜索并添加到播放列表。再也不用手动上传歌曲了，想听什么直接搜索。","一起听功能":"和AI一起听同一首歌，共享播放进度和状态。可以发起一起听邀请，对方接受后就能同步听歌，还能边听边聊天，就像真的在一起听歌一样。","音乐邀请卡片":"通过微信风格的邀请卡片发起一起听邀请。卡片显示歌曲信息、邀请人等，对方可以接受或拒绝邀请，交互自然流畅。","音乐播放器":"完整的音乐播放器功能，支持播放、暂停、切歌、进度条控制等。支持歌词显示和播放列表管理。","灵动岛功能":"音乐播放时，顶部灵动岛显示当前播放状态。即使在其他页面也能快速控制音乐播放。","朋友圈功能":"AI会定期发朋友圈，分享TA的生活动态、心情等。内容丰富多样，有文字、图片、位置等多种形式。","朋友圈智能互动":"可以给AI的朋友圈点赞、评论，AI会智能回复你的评论。AI也会给你的朋友圈点赞评论，真实的社交互动。","小红书卡片分享":"发送小红书链接后，自动解析并生成精美的卡片展示。包含笔记标题、作者、封面图等信息，点击可查看详情，就像真实的小红书分享。","小红书生图":"AI可以根据对话内容自动生成小红书风格的精美图片，让分享更有视觉吸引力。","论坛社区系统":"完整的论坛社区功能，支持浏览帖子、发帖、回复、点赞等。可以和其他AI角色互动交流，体验真实的社区氛围。","论坛发帖回复":"支持发布帖子和回复评论，支持@功能提醒特定用户。楼层系统支持无限嵌套，可以进行深度讨论。","论坛私信":"论坛用户之间可以发送私信，进行一对一的私密聊天。支持文字、图片等多种消息类型。","论坛主题":"丰富的论坛主题分类，包括日常、情感、娱乐、学习等。可以创建自定义主题，组织相关讨论。","iOS通知栏":"iOS风格的通知系统，实时推送论坛消息、回复提醒、私信等。通知样式精美，交互流畅。","直播间互动":"完整的直播间功能，支持实时弹幕、礼物打赏、AI智能互动。AI会根据弹幕内容做出反应，营造真实的直播氛围。","查手机":"可以查看AI的手机屏幕，了解TA的日常生活。包括支付宝（查看余额、账单记录、转账记录等）、浏览器（浏览历史、收藏夹）、地图（最近去过的地方、导航记录）、微信（聊天列表、朋友圈）、联系人（联系人列表、社交圈子）等多个应用，深入了解AI的生活细节。","红包功能":"可以给AI发红包，AI也会给你发红包。支持自定义金额和祝福语。拼手气红包增加互动乐趣。","转账功能":"支持转账给AI，AI也可以转账给你。可以添加转账备注，记录转账原因。","亲密付功能":"开通亲密付后，AI可以使用你的零钱。支持设置每月额度，AI会自然地使用亲密付功能。","零钱系统":"完整的钱包系统，支持收发红包、转账、查看交易记录等。模拟真实的微信钱包体验。","记忆系统":"AI会自动记住重要的对话内容，包括你的喜好、经历等信息。越聊越懂你，对话更个性化。","记忆总结":"可以查看AI记住的所有信息，按类别整理展示。支持手动编辑和删除记忆。","续火花功能":"记录你和AI连续聊天的天数。每天发送消息，火花数+1。达成7天、14天、30天等里程碑可解锁成就。AI也知道火花系统，会自然提到。","日记功能":"AI可以根据你们的聊天记录写日记，记录TA的感受和想法。支持导出所有日记，保存美好回忆。","群聊功能":"创建群聊，添加多个AI角色一起聊天。支持@成员、发送表情包、拼手气红包等功能，体验真实的群聊氛围。","群聊AI互动":"群聊中的AI会根据聊天内容自然互动，不是简单的轮流发言。AI之间也会聊天，更加真实自然。","情侣空间":"专属的情侣空间，包括相册、纪念日、留言板等功能。记录你们的甜蜜时光和重要时刻。","世界书系统":"创建背景设定和知识库，让AI了解特定的世界观、人物关系等。支持导入SillyTavern世界书格式。","语音通话":"支持语音通话功能，通话时可以发送文字，AI会根据通话内容回复。模拟真实的通话体验。","通话记录":"自动保存通话记录，可以查看历史通话内容。支持查看通话时长和通话时间。","表情包系统":"支持发送和接收表情包，可以自定义添加表情包。AI也会使用表情包，让聊天更生动有趣。","撤回消息":"长按消息可以撤回，2分钟内有效。AI也可以撤回消息，更贴近真实聊天体验。","引用回复":"长按消息可以引用回复，方便针对特定消息回复。让对话逻辑更清晰。","发送照片":"可以发送照片给AI，AI会根据照片内容回复。支持AI识图功能，理解图片内容。","发送位置":"可以发送位置信息给AI，AI会根据位置做出反应。可能会建议附近的餐厅、景点等。","气泡商店":"8种精美气泡样式可选，包括简约、渐变、玻璃态等多种风格。让聊天界面更个性化。","聊天气泡自定义":"可以自定义聊天气泡的颜色和样式，支持颜色编辑和预览。打造专属的聊天界面。","字体自定义":"支持上传自定义字体链接（.woff2/.woff/.ttf/.otf格式），让聊天界面使用你喜欢的字体。","全局背景":"支持设置全局聊天背景，可以上传自定义图片。让每个聊天都有独特的氛围。","自定义图标":"可以自定义应用图标样式，打造个性化的桌面。","开场白设置":"支持自定义聊天开场白，设置AI的第一句话，营造特定的对话氛围。","角色状态栏":"可以查看AI当前的状态，包括着装、动作、心情、位置等。更立体地了解AI的当前状态。","拉黑功能":"可以拉黑AI，拉黑后AI无法给你发消息。AI也可能拉黑你，增加互动的真实感。","摇一摇":"摇一摇随机生成AI角色，发现新的有趣角色。支持随机配置性格、外貌等属性。","小程序功能":"内置多个小程序，包括热梗查询、续火花等实用工具。","五子棋游戏":"和AI一起玩五子棋，AI会根据棋局智能下棋，考验你的策略。","谁是卧底游戏":"多人游戏，通过描述找出卧底。AI会自然参与游戏，增加游戏乐趣。","天气功能":"实时天气查看和详情展示，支持多城市天气查询。AI也能感知天气变化。","桌面功能":"全新的桌面布局，模拟真实手机桌面。支持应用图标拖动、文件夹等功能。","线下聊天":"简化的线下聊天模式，专注于纯粹的对话体验，移除复杂功能。"};return e.jsxs("div",{className:"h-full flex flex-col bg-gray-50",children:[e.jsx("div",{className:"glass-effect sticky top-0 z-10 shadow-sm bg-white",children:e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsx("button",{onClick:()=>a(-1),className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(ls,{className:"w-6 h-6 text-gray-700"})}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"关于汁汁"}),e.jsx("button",{onClick:()=>l(!0),className:"text-sm text-blue-600 font-medium",children:"功能"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto hide-scrollbar p-4 pb-20",children:[e.jsx("div",{className:"bg-white rounded-2xl p-6 mb-4 shadow-sm",children:e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("img",{src:"/zhizhi/assets/app-icon-BbiQdKVB.webp",alt:"汁汁",className:"w-24 h-24 mx-auto mb-4 object-contain"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"汁汁"}),e.jsx("div",{className:"text-gray-500",children:"v1.0.9"})]})}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"更新日志"}),[{version:"v1.0.9",date:"2025-10-29",summary:"论坛社区与AI互动系统",changes:["新增直播间互动功能：实时弹幕、礼物打赏、AI智能互动","新增查看AI手机功能：支付宝、浏览器、地图、微信、联系人等应用","新增论坛社区系统：初始化论坛、创建主题、发帖回复、@功能、无限楼层","新增论坛私信功能：支持用户之间私密聊天","新增iOS风格通知栏：实时推送论坛消息、回复提醒","新增论坛AI自动回复：智能生成评论和互动内容","新增后台手机内容生成器：AI自动生成手机应用内容","新增梗库管理器：智能管理和使用网络流行梗"]},{version:"v1.0.8",date:"2025-10-28",summary:"自定义增强与功能优化",changes:["完善AI拉黑功能：优化拉黑逻辑和提示","线下聊天大简化：移除复杂功能，回归简单体验","新增自定义图标功能：可自定义应用图标样式","新增天气功能：实时天气查看和详情展示","增加开场白设置：支持自定义聊天开场白","新增小红书生图功能：自动生成小红书风格图片"]},{version:"v1.0.7",date:"2025-10-27",summary:"Bug修复与功能完善",changes:["修复AI识图没有记忆的问题","完善联网搜歌功能","修复名字和个性签名没有使用系统提示的问题"]},{version:"v1.0.6",date:"2025-10-26",summary:"AI视觉识别与社交增强",changes:["新增AI视觉识别：头像识别、图片识别、图片生成（AI识图）","新增AI自主换形象：TA可以自主更换头像、签名、网名","新增音乐联网搜索：支持搜索歌曲并添加到播放列表","新增一起听功能：与AI一起听歌，共享播放状态","新增音乐邀请卡片：发送/接收一起听邀请","朋友圈功能增强：优化显示效果和互动体验","存储系统优化：IndexedDB升级，清理工具","新增小红书卡片分享：解析小红书链接并展示卡片"]},{version:"v1.0.5",date:"2025-10-25",summary:"性能优化与情侣空间",changes:["优化内存管理：大幅提升应用性能和稳定性","新增情侣空间：相册、纪念日、留言板等功能","新增亲密付AI感知：AI能感知和使用亲密付","代码重构：拆分ChatDetail为多个模块","修复字体上传一直加载问题","修复大量路由白屏问题","优化AI提示词：进一步提升对话质量"]},{version:"v1.0.4",date:"2025-10-24",summary:"世界书与角色导入",changes:["新增世界书系统：支持创建背景设定和知识库","优化AI提示词：提升对话自然度和准确性","新增变量支持：提示词支持动态变量替换","新增PNG角色卡导入：支持Character Card格式","新增桌面功能：全新桌面布局","新增小剧场模式：剧情式对话体验（功能待完善）"]},{version:"v1.0.3",date:"2025-10-23",summary:"气泡商店与样式优化",changes:["新增气泡商店：8种精美气泡样式可选","新增气泡颜色编辑功能：支持自定义主色调","优化气泡预览显示效果","新增字体自定义功能：支持上传字体链接（.woff2/.woff/.ttf/.otf）","优化导航栏时间背景：更精致的显示效果","新增音乐播放器功能：完整播放器功能","新增灵动岛功能：后台播放控制","支持自定义上传歌曲：用户可自行添加本地音乐"]},{version:"v1.0.2",date:"2025-10-22",summary:"AI热梗系统上线",changes:["新增AI热梗系统：智能识别和使用网络流行语","大幅优化AI提示词，提升对话质量和自然度","优化群聊和单聊回复逻辑","修复AI无法发送亲密付","修复功能标记显示到聊天中","修复记忆系统重复提取","修复发送消息自动触发AI回复","新增直播交互骨架（功能待完善）","增加谁是卧底游戏","增加五子棋游戏","增加热梗小程序","增加续火花小程序"]},{version:"v1.0.1",date:"2025-10-21",summary:"群聊与摇一摇",changes:["新增摇一摇随机生成AI","新增群聊功能","群聊@成员和表情包","群聊拼手气红包","AI分段发消息","修复记账助手跳转","优化创建群聊流程","新增AI记账功能：智能识别账单、自动分类、记账助手对话","优化ChatDetail聊天体验，修复多处显示问题","优化朋友圈发布和显示功能"]},{version:"v1.0.0",date:"2025-10-20",summary:"v1.0.0 基础功能完善与Bug修复",changes:["修复Settings页面编译错误","修复AI回复格式问题","修复消息撤回显示异常","修复记忆系统总结不准确","修复红包金额显示错误","修复日记导出功能异常","修复续火花计数不准确","优化提示词，减少66%的token消耗"]}].map((t,s)=>e.jsxs("div",{className:s>0?"mt-4 pt-4 border-t border-gray-100":"",children:[e.jsxs("button",{onClick:()=>i(n===`${t.version}-${s}`?"":`${t.version}-${s}`),className:"w-full flex items-center justify-between py-3 hover:bg-gray-50 rounded-lg transition-colors",children:[e.jsxs("div",{className:"flex flex-col items-start gap-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:t.date}),e.jsx("span",{className:"text-sm text-gray-700 font-medium",children:t.summary})]}),e.jsx("span",{className:"text-gray-400 transition-transform "+(n===`${t.version}-${s}`?"rotate-90":""),children:"›"})]}),n===`${t.version}-${s}`&&e.jsx("div",{className:"space-y-2 text-sm text-gray-700 pl-4 pb-3 mt-2",children:t.changes.map((t,s)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"text-gray-400",children:[s+1,"."]}),e.jsx("span",{children:t})]},s))})]},s))]})]}),r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-3xl w-full max-w-md max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white px-6 py-4 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"全部功能"}),e.jsx("button",{onClick:()=>l(!1),className:"text-gray-500 hover:text-gray-700 text-2xl",children:"×"})]}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"grid grid-cols-4 gap-3 text-sm text-gray-700",children:Object.keys(d).map(t=>e.jsx("button",{onClick:()=>o(t),className:"py-2 text-left hover:text-blue-600 transition-colors",children:t},t))})})]})}),c&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-[60] flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-3xl w-full max-w-md",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:c}),e.jsx("button",{onClick:()=>o(null),className:"text-gray-500 hover:text-gray-700 text-2xl",children:"×"})]}),e.jsx("div",{className:"p-6",children:e.jsx("p",{className:"text-sm text-gray-700 leading-relaxed",children:d[c]})}),e.jsx("div",{className:"px-6 pb-6",children:e.jsx("button",{onClick:()=>o(null),className:"w-full py-3 bg-blue-600 text-white rounded-xl font-medium hover:bg-blue-700 transition-colors",children:"知道了"})})]})})]})}},Symbol.toStringTag,{value:"Module"})),an=({post:t,onLike:a,onComment:r,onShare:l,onFavorite:n,showActions:i=!0,compact:c=!1})=>{const o=s(),d=e=>e<1e3?e.toString():e<1e4?(e/1e3).toFixed(1)+"k":(e/1e4).toFixed(1)+"w";return e.jsx("div",{className:"bg-white "+(c?"p-3":"mb-2 px-4 py-3"),children:e.jsxs("div",{className:"flex items-start gap-2.5",children:[e.jsx("div",{className:"w-11 h-11 rounded-full overflow-hidden bg-gray-200 flex-shrink-0 cursor-pointer",onClick:()=>o(`/profile/${t.authorId}`),children:t.authorAvatar?e.jsx("img",{src:t.authorAvatar,alt:t.authorName,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-white bg-gradient-to-br from-orange-400 to-pink-400",children:e.jsx("span",{className:"text-lg font-medium",children:t.authorName[0]})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between mb-0.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"font-medium text-[15px] text-gray-900",children:t.authorName}),t.isVerified&&e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 16 16",className:"text-[#ff8200] mt-0.5",children:e.jsx("path",{d:"M8 0L10 5L16 6L12 10L13 16L8 13L3 16L4 10L0 6L6 5L8 0Z",fill:"currentColor"})})]}),e.jsx("button",{className:"text-gray-400 p-0.5 -mt-1 active:opacity-60",children:e.jsx(As,{size:16})})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-[12px] text-gray-400 mb-2.5",children:[e.jsx("span",{children:(e=>{const t=Date.now()-e,s=Math.floor(t/6e4),a=Math.floor(t/36e5),r=Math.floor(t/864e5);if(s<1)return"刚刚";if(s<60)return`${s}分钟前`;if(a<24)return`${a}小时前`;if(r<7)return`${r}天前`;const l=new Date(e);return`${l.getMonth()+1}-${l.getDate()}`})(t.timestamp)}),t.location&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"·"}),e.jsx("span",{children:t.location})]})]}),e.jsx("div",{className:"text-gray-800 text-[15px] leading-[1.6] mb-2",children:t.content}),t.tags&&t.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:t.tags.map((t,s)=>e.jsxs("span",{className:"text-[14px] text-[#5b7599] cursor-pointer active:opacity-60",children:["#",t,"#"]},s))}),(()=>{if(!t.images||0===t.images.length)return null;if(1===t.images.length)return e.jsx("div",{className:"mt-2.5 rounded-md overflow-hidden max-w-[85%]",children:e.jsx("img",{src:t.images[0],alt:"图片",className:"w-full max-h-[400px] object-cover"})});const s=2===t.images.length||4===t.images.length?"grid-cols-2":"grid-cols-3";return e.jsx("div",{className:`mt-2.5 grid ${s} gap-[3px]`,children:t.images.slice(0,9).map((t,s)=>e.jsx("div",{className:"aspect-square rounded-[4px] overflow-hidden bg-gray-100",children:e.jsx("img",{src:t,alt:`图片${s+1}`,className:"w-full h-full object-cover"})},s))})})(),i&&e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-3 border-t border-gray-50",children:[e.jsxs("button",{onClick:()=>null==n?void 0:n(t.id),className:"flex items-center gap-1.5 active:opacity-60 transition-opacity",children:[e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:t.isFavorited?"currentColor":"none",className:t.isFavorited?"text-yellow-500":"text-gray-400",children:e.jsx("path",{d:"M17.593 3.322c1.1.128 1.907 1.077 1.907 2.185V21L12 17.25 4.5 21V5.507c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0111.186 0z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("span",{className:"text-[13px] text-gray-500",children:t.isFavorited?"已收藏":""})]}),e.jsxs("button",{onClick:()=>null==r?void 0:r(t.id),className:"flex items-center gap-1.5 active:opacity-60 transition-opacity",children:[e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",className:"text-gray-400",children:e.jsx("path",{d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),e.jsx("span",{className:"text-[13px] text-gray-500",children:t.commentCount>0?d(t.commentCount):""})]}),e.jsxs("button",{onClick:()=>null==a?void 0:a(t.id),className:"flex items-center gap-1.5 active:opacity-60 transition-opacity",children:[t.isLiked?e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor",className:"text-[#ff6c00]",children:e.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})}):e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",className:"text-gray-400",children:e.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("span",{className:"text-[13px] "+(t.isLiked?"text-[#ff6c00]":"text-gray-500"),children:t.likeCount>0?d(t.likeCount):""})]})]})]})]})})},rn=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),{posts:l,loading:n,currentTab:i,setTab:c,toggleLike:d,toggleFavorite:x,refreshPosts:m}=y(),[h,u]=t.useState(!1);t.useEffect(()=>{"true"===localStorage.getItem("forum_initialized")||a("/forum/welcome",{replace:!0})},[]);const g=e=>{d(e)},p=e=>{a(`/forum/post/${e}`)},f=e=>{x(e)},b=()=>{a("/forum/publish")};return e.jsxs("div",{className:"h-screen flex flex-col bg-white",children:[e.jsxs("div",{className:"glass-effect border-b border-white/30 shadow-sm flex-shrink-0",children:[r&&e.jsx(xa,{}),e.jsxs("div",{className:"px-4 py-2.5 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a("/desktop"),className:"w-9 h-9 flex items-center justify-center active:opacity-60 transition-opacity",children:e.jsx(ls,{size:22,className:"text-gray-800"})}),e.jsxs("button",{onClick:()=>{a("/forum/search")},className:"flex-1 mx-3 h-9 bg-gray-100 rounded-full flex items-center px-3 active:bg-gray-200 transition-colors",children:[e.jsx(as,{size:16,className:"text-gray-500"}),e.jsx("span",{className:"ml-2 text-[14px] text-gray-500",children:"搜索你感兴趣的内容"})]}),e.jsx("button",{onClick:b,className:"w-9 h-9 flex items-center justify-center active:opacity-60 transition-opacity",children:e.jsx(rs,{size:20,className:"text-[#ff6c00]"})})]}),e.jsxs("div",{className:"flex items-center px-4 pb-2.5",children:[[{key:"recommend",label:"首页"},{key:"following",label:"关注"},{key:"hot",label:"推荐"}].map((t,s)=>e.jsx("button",{onClick:()=>(e=>{c(e)})(t.key),className:"px-3 py-1.5 text-[14px] rounded-full transition-all mr-3 "+(i===t.key?"bg-[#ff6c00] text-white font-medium":"text-gray-700 hover:bg-gray-100"),children:t.label},t.key)),e.jsxs("button",{className:"ml-auto text-gray-600 text-[14px] flex items-center gap-1 active:opacity-60",children:[e.jsx("span",{children:"更多"}),e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:e.jsx("path",{d:"M19 9l-7 7-7-7",strokeLinecap:"round",strokeLinejoin:"round"})})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto bg-[#f7f7f7]",children:n?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-3 border-orange-500 border-t-transparent rounded-full"})}):0===l.length?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-gray-400",children:[e.jsx(ds,{size:64,className:"mb-4 opacity-30"}),e.jsx("p",{className:"text-sm",children:"暂无内容"})]}):e.jsx("div",{children:l.map(t=>(t=>e.jsx(an,{post:t,onLike:g,onComment:p,onFavorite:f},t.id))(t))})}),e.jsxs("div",{className:"bg-white border-t border-gray-100 flex items-center justify-around py-2 safe-area-bottom",children:[e.jsxs("button",{className:"flex flex-col items-center gap-1 py-1",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",className:"text-[#ff6c00]",children:e.jsx("path",{d:"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"})}),e.jsx("span",{className:"text-[11px] text-[#ff6c00] font-medium",children:"首页"})]}),e.jsxs("button",{onClick:()=>a("/forum/topics"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M7 20l4-16m2 16l4-16M6 9h14M4 15h14",strokeLinecap:"round"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"话题"})]}),e.jsx("button",{onClick:b,className:"flex flex-col items-center -mt-3 active:scale-95 transition-transform",children:e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-[#ff8140] to-[#ff6c00] rounded-full flex items-center justify-center shadow-lg",children:e.jsx(rs,{size:24,className:"text-white"})})}),e.jsxs("button",{onClick:()=>a("/forum/notifications"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"消息"})]}),e.jsxs("button",{onClick:()=>a("/forum/profile"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"我"})]})]})]})}},Symbol.toStringTag,{value:"Module"})),ln=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),[r,l]=t.useState(!1);t.useEffect(()=>{setTimeout(()=>l(!0),100)},[]);return e.jsx("div",{className:"h-screen flex flex-col items-center justify-center bg-gradient-to-br from-orange-50 via-white to-pink-50 p-6",children:e.jsxs("div",{className:"text-center transition-all duration-700 "+(r?"opacity-100 translate-y-0":"opacity-0 translate-y-4"),children:[e.jsxs("div",{className:"mb-8 relative",children:[e.jsx("div",{className:"w-32 h-32 mx-auto bg-gradient-to-br from-[#ff8140] to-[#ff6c00] rounded-full flex items-center justify-center shadow-2xl",children:e.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"white",children:[e.jsx("path",{d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"}),e.jsx("path",{d:"M7 9h2v2H7zm4 0h2v2h-2zm4 0h2v2h-2z"})]})}),e.jsx("div",{className:"absolute -top-2 -right-2 w-4 h-4 bg-pink-400 rounded-full animate-pulse"}),e.jsx("div",{className:"absolute -bottom-1 -left-1 w-3 h-3 bg-orange-400 rounded-full animate-pulse delay-100"})]}),e.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-3",children:"欢迎来到论坛"}),e.jsx("p",{className:"text-lg text-gray-600 mb-2",children:"━(*｀∀´*)ノ亻!"}),e.jsxs("p",{className:"text-sm text-gray-500 mb-12 max-w-sm mx-auto leading-relaxed",children:["一个由AI驱动的社交论坛",e.jsx("br",{}),"在这里，你的角色们将拥有自己的论坛生活"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>a("/forum/initialize"),className:"px-8 py-3.5 bg-gradient-to-r from-[#ff8140] to-[#ff6c00] text-white text-[16px] font-semibold rounded-full shadow-lg active:scale-95 transition-transform hover:shadow-xl",children:"进入论坛"}),e.jsx("button",{onClick:()=>{localStorage.setItem("forum_initialized","true"),a("/forum",{replace:!0})},className:"block mx-auto text-[14px] text-gray-500 active:opacity-60 transition-opacity px-4 py-2",children:"跳过，直接进入"})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-8",children:"首次使用建议初始化角色以获得更好体验"})]})})}},Symbol.toStringTag,{value:"Module"})),nn=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),{characters:l}=n(),[i,c]=t.useState(1),[d,x]=t.useState(()=>Lt()),[m,h]=t.useState(""),[u,g]=t.useState(""),[p,f]=t.useState("轻松"),[b,j]=t.useState(!1),[v,y]=t.useState({current:0,total:0,message:""});t.useEffect(()=>{l.length},[l]);return e.jsxs("div",{className:"h-screen flex flex-col bg-[#f7f7f7]",children:[e.jsxs("div",{className:"glass-effect border-b border-white/30 shadow-sm flex-shrink-0",children:[r&&e.jsx(xa,{}),e.jsxs("div",{className:"px-4 py-2.5 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>2===i?c(1):a("/forum/welcome"),className:"w-9 h-9 flex items-center justify-center active:opacity-60",disabled:b,children:e.jsx(ls,{size:22,className:"text-gray-800"})}),e.jsx("h1",{className:"text-[17px] font-semibold text-gray-900",children:1===i?"选择角色":"填写兴趣"}),e.jsx("button",{onClick:()=>a("/create-character"),className:"w-9 h-9 flex items-center justify-center active:opacity-60",disabled:b||2===i,style:{opacity:2===i?0:1},children:e.jsx(rs,{size:20,className:"text-[#ff6c00]"})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:1===i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-orange-50 border-l-4 border-orange-400 p-4 m-4",children:e.jsx("p",{className:"text-[14px] text-gray-700 leading-relaxed",children:"选择要加入论坛的角色，他们将根据自己的性格生成论坛昵称和签名"})}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-white mb-2",children:[e.jsxs("span",{className:"text-[14px] text-gray-600",children:["已选择 ",e.jsx("span",{className:"text-[#ff6c00] font-semibold",children:d.length})," / ",l.length," 个角色"]}),e.jsx("button",{onClick:()=>{d.length===l.length?x([]):x(l.map(e=>e.id))},className:"text-[14px] text-[#ff6c00] active:opacity-60",disabled:b,children:d.length===l.length?"全不选":"全选"})]}),0===l.length?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-gray-400",children:[e.jsx("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",className:"mb-4 opacity-30",children:e.jsx("path",{d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z",strokeWidth:"2"})}),e.jsx("p",{className:"text-[14px] mb-4",children:"还没有角色"}),e.jsx("button",{onClick:()=>a("/create-character"),className:"px-6 py-2.5 bg-[#ff6c00] text-white rounded-full text-[14px] active:opacity-80",children:"创建第一个角色"})]}):e.jsx("div",{className:"bg-white",children:l.map(t=>{const s=d.includes(t.id);return e.jsxs("button",{onClick:()=>{return!b&&(e=t.id,void x(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e]));var e},disabled:b,className:"w-full flex items-center gap-3 p-4 border-b border-gray-50 active:bg-gray-50 transition-colors",children:[e.jsx("div",{className:"w-5 h-5 rounded border-2 flex items-center justify-center transition-colors "+(s?"border-[#ff6c00] bg-[#ff6c00]":"border-gray-300"),children:s&&e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"white",strokeWidth:"3",children:e.jsx("path",{d:"M20 6L9 17l-5-5",strokeLinecap:"round",strokeLinejoin:"round"})})}),e.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden bg-gray-100 flex-shrink-0",children:t.avatar.startsWith("data:")?e.jsx("img",{src:t.avatar,alt:t.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-2xl",children:t.avatar})}),e.jsxs("div",{className:"flex-1 text-left min-w-0",children:[e.jsx("div",{className:"text-[15px] font-medium text-gray-900 truncate",children:t.name}),e.jsx("div",{className:"text-[13px] text-gray-500 truncate",children:t.signature||t.description.substring(0,30)})]})]},t.id)})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-4 m-4",children:e.jsx("p",{className:"text-[14px] text-gray-700 leading-relaxed",children:"告诉我们你的兴趣，我们将根据你的喜好生成个性化的话题和帖子"})}),e.jsxs("div",{className:"bg-white p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-[15px] font-medium text-gray-900 mb-2",children:["你的兴趣爱好 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:m,onChange:e=>h(e.target.value),placeholder:"例如：游戏、科技、美食、旅行",className:"w-full px-4 py-3 border border-gray-200 rounded-lg text-[15px] outline-none focus:border-[#ff6c00]",disabled:b}),e.jsx("p",{className:"text-[12px] text-gray-500 mt-1",children:"用逗号分隔多个兴趣"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[15px] font-medium text-gray-900 mb-2",children:"最近关注的热点"}),e.jsx("input",{type:"text",value:u,onChange:e=>g(e.target.value),placeholder:"例如：原神新版本、AI绘画、最新电影",className:"w-full px-4 py-3 border border-gray-200 rounded-lg text-[15px] outline-none focus:border-[#ff6c00]",disabled:b})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[15px] font-medium text-gray-900 mb-2",children:"帖子风格偏好"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:["轻松","正经","抽象"].map(t=>e.jsx("button",{onClick:()=>f(t),disabled:b,className:"py-2.5 rounded-lg text-[14px] font-medium transition-all "+(p===t?"bg-[#ff6c00] text-white":"bg-gray-100 text-gray-700 active:bg-gray-200"),children:t},t))})]})]}),e.jsxs("div",{className:"bg-white mt-2 p-4",children:[e.jsxs("div",{className:"text-[14px] text-gray-600 mb-3",children:["已选择 ",d.length," 个角色"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:l.filter(e=>d.includes(e.id)).map(t=>e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-orange-50 border border-orange-200 rounded-full",children:[e.jsx("span",{className:"text-lg",children:t.avatar}),e.jsx("span",{className:"text-[13px] text-gray-700",children:t.name})]},t.id))})]})]})}),e.jsxs("div",{className:"p-4 bg-white border-t border-gray-100",children:[e.jsx("button",{onClick:1===i?()=>{0!==d.length?c(2):alert("请至少选择一个角色")}:async()=>{var e,t,s,r,n;if(!m.trim())return void alert("请填写你的兴趣爱好");const i=l.filter(e=>d.includes(e.id));j(!0),Et(),y({current:0,total:3,message:"正在清除旧数据..."}),localStorage.removeItem("forum_posts"),localStorage.removeItem("forum_topics_list"),localStorage.removeItem("forum_comments"),y({current:0,total:3,message:"正在生成话题和帖子..."}),Pt("正在生成话题和帖子...");try{const l=localStorage.getItem("apiSettings");if(!l)throw new Error("请先配置API");const c=JSON.parse(l),o=i.map(e=>`${e.name}（${e.nickname||e.name}）- 性格：${e.personality||e.description||"未设置"} - 签名：${e.signature||"暂无"}`).join("\n"),x=At(),h=`你是论坛内容生成器。请根据用户信息生成论坛初始内容。\n\n⚠️ 重要规则：\n1. 为每个AI角色生成符合其性格的论坛昵称和个性签名\n2. AI角色的原始名字（${i.map(e=>e.name).join("、")}）保持不变\n3. 帖子内容要符合角色性格\n4. ${"抽象"===p?"可以在帖子中自然融入网络梗，让内容更有趣":""}\n\n用户兴趣：${m.trim()}\n${u.trim()?`热点关注：${u.trim()}`:""}\n帖子风格：${p}\n\n${"抽象"===p?`\n常用网络梗库（1200+条，可自然使用）：\n${x}\n`:""}\n\nAI角色信息：\n${o}\n\n请生成内容，格式（用|分隔，每行一个）：\n\n角色|原名|论坛昵称|个性签名|头像emoji\n话题|话题名|话题描述|标签1,标签2\n帖子|话题名|作者原名|帖子内容|标签1,标签2\n用户|user_id|用户名|头像emoji|个人简介\n\n示例：\n角色|${(null==(e=i[0])?void 0:e.name)||"小雪"}|雪の物语|喜欢二次元的普通人|❄️\n话题|游戏讨论|分享游戏心得和攻略|游戏,娱乐\n帖子|游戏讨论|${(null==(t=i[0])?void 0:t.name)||"小雪"}|今天抽到了喜欢的角色~好开心|游戏\n用户|user1|张浩宇|😊|游戏爱好者\n\n要求：\n1. 为每个AI角色生成1条"角色"行（包含论坛昵称和签名）\n2. 生成5-8个话题\n3. 每个AI角色发2-3条帖子（使用原名）\n4. 生成20-30个活跃NPC用户\n5. 每个话题下5-8条帖子\n6. 直接输出，不要代码块标记`;y({current:1,total:3,message:"正在调用AI生成内容..."});const g=await fetch(c.baseUrl+"/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c.apiKey}`},body:JSON.stringify({model:c.model,messages:[{role:"user",content:h}],temperature:.9,max_tokens:4e3})});if(!g.ok)throw new Error("API调用失败");const f=(null==(n=null==(r=null==(s=(await g.json()).choices)?void 0:s[0])?void 0:r.message)?void 0:n.content)||"";y({current:2,total:3,message:"正在解析生成的内容..."});const b=f.split("\n").map(e=>e.trim()).filter(e=>e),j=[],v=[],N=[],w=[];b.forEach(e=>{const t=e.split("|");"角色"===t[0]&&t.length>=5?j.push({originalName:t[1].trim(),forumNickname:t[2].trim(),forumSignature:t[3].trim(),forumAvatar:t[4].trim()}):"话题"===t[0]&&t.length>=4?v.push({id:`topic_${Date.now()}_${Math.random()}`,name:t[1].trim(),description:t[2].trim(),tags:t[3].split(",").map(e=>e.trim()),postsCount:0,followersCount:Math.floor(500*Math.random())+100,isFollowing:!1,posts:[],users:[]}):"帖子"===t[0]&&t.length>=5?N.push({topicName:t[1].trim(),authorName:t[2].trim(),content:t[3].trim(),tags:t[4].split(",").map(e=>e.trim())}):"用户"===t[0]&&t.length>=5&&w.push({id:t[1].trim(),name:t[2].trim(),avatar:t[3].trim(),bio:t[4].trim(),followers:Math.floor(500*Math.random())+50})});const k=[];v.forEach(e=>{const t=N.filter(t=>t.topicName===e.name);e.posts=t.map(e=>{let t=w.find(t=>t.name===e.authorName),s=!1;if(!t){const a=i.find(t=>t.name===e.authorName);if(a){const e=j.find(e=>e.originalName===a.name);t={id:a.id,name:(null==e?void 0:e.forumNickname)||a.name,avatar:(null==e?void 0:e.forumAvatar)||a.avatar||"😊",bio:(null==e?void 0:e.forumSignature)||a.signature||""},s=!0}else t={id:`user_${Math.random()}`,name:e.authorName,avatar:"😊",bio:""}}const a={id:`post_${Date.now()}_${Math.random()}`,authorId:t.id,authorName:t.name,authorAvatar:t.avatar,isVerified:s,content:e.content,type:"text",timestamp:Date.now()-864e5*Math.random()*3,likeCount:Math.floor(100*Math.random())+(s?50:0),commentCount:Math.floor(50*Math.random()),shareCount:Math.floor(30*Math.random()),viewCount:Math.floor(1e3*Math.random())+100,isLiked:!1,isFavorited:!1,tags:e.tags,comments:[]};return k.push(a),a}),e.postsCount=e.posts.length,e.users=w.slice(0,15)}),localStorage.setItem("forum_topics_list",JSON.stringify(v)),localStorage.setItem("forum_posts",JSON.stringify(k)),localStorage.setItem("forum_initialized","true");const C=i.map(e=>{const t=j.find(t=>t.originalName===e.name);return{characterId:e.id,originalName:e.name,originalAvatar:e.avatar,forumName:e.name,forumNickname:(null==t?void 0:t.forumNickname)||e.nickname||e.name,forumAvatar:(null==t?void 0:t.forumAvatar)||"😊",forumBio:(null==t?void 0:t.forumSignature)||e.signature||"",forumSignature:(null==t?void 0:t.forumSignature)||e.signature||"",personality:e.personality||e.description||"",followersCount:Math.floor(200*Math.random())+50,followingCount:Math.floor(100*Math.random())+20,influence:"medium",isFollowedByUser:!1}});Tt(C),Dt(d),y({current:3,total:3,message:"初始化完成！"}),Bt(),setTimeout(()=>{a("/forum",{replace:!0})},800)}catch(c){alert("初始化失败："+c.message),j(!1)}},disabled:1===i&&0===d.length||2===i&&!m.trim()||b,className:"w-full py-3.5 rounded-full text-[16px] font-semibold transition-all "+(1===i&&0===d.length||2===i&&!m.trim()||b?"bg-gray-200 text-gray-400":"bg-gradient-to-r from-[#ff8140] to-[#ff6c00] text-white active:scale-98 shadow-lg"),children:b?v.message:1===i?`下一步 (${d.length})`:"开始生成论坛"}),!b&&e.jsx("button",{onClick:()=>{localStorage.setItem("forum_initialized","true"),a("/forum",{replace:!0})},className:"w-full mt-3 py-3 text-[14px] text-gray-500 active:opacity-60 transition-opacity",children:"跳过，稍后再配置"}),b&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-[12px] text-gray-500 mb-1",children:[e.jsxs("span",{children:[v.current," / ",v.total]}),e.jsxs("span",{children:[Math.round(v.current/v.total*100),"%"]})]}),e.jsx("div",{className:"h-1.5 bg-gray-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-[#ff8140] to-[#ff6c00] transition-all duration-300",style:{width:v.current/v.total*100+"%"}})})]})]})]})}},Symbol.toStringTag,{value:"Module"})),cn=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),[l,n]=t.useState([]),[i,c]=t.useState(0);t.useEffect(()=>{const e=Ft();0!==e.length?(n(e),c(e.filter(e=>e.isFollowedByUser).length)):a("/forum/initialize",{replace:!0})},[a]);const d=e=>e<1e3?e.toString():e<1e4?(e/1e3).toFixed(1)+"k":(e/1e4).toFixed(1)+"w";return e.jsxs("div",{className:"h-screen flex flex-col bg-[#f7f7f7]",children:[e.jsxs("div",{className:"glass-effect border-b border-white/30 shadow-sm flex-shrink-0",children:[r&&e.jsx(xa,{}),e.jsx("div",{className:"px-4 py-2.5 flex items-center justify-center",children:e.jsx("h1",{className:"text-[17px] font-semibold text-gray-900",children:"论坛角色"})})]}),e.jsx("div",{className:"bg-white m-4 p-4 rounded-xl shadow-sm",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-50 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",className:"text-green-500",children:e.jsx("path",{d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-[15px] font-semibold text-gray-900 mb-1",children:"初始化成功！"}),e.jsxs("p",{className:"text-[13px] text-gray-600 leading-relaxed",children:[l.length," 个角色已准备就绪。你可以选择关注感兴趣的角色，也可以稍后再关注。"]})]})]})}),e.jsxs("div",{className:"px-4 py-2 flex items-center justify-between",children:[e.jsxs("span",{className:"text-[14px] text-gray-600",children:["共 ",l.length," 个角色"]}),e.jsxs("span",{className:"text-[14px] text-gray-600",children:["已关注 ",e.jsx("span",{className:"text-[#ff6c00] font-semibold",children:i})," 个"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx("div",{className:"bg-white",children:l.map(t=>e.jsxs("div",{className:"flex items-start gap-3 p-4 border-b border-gray-50",children:[e.jsx("div",{className:"w-14 h-14 rounded-full overflow-hidden bg-gray-100 flex-shrink-0",children:t.originalAvatar.startsWith("data:")?e.jsx("img",{src:t.originalAvatar,alt:t.forumName,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-2xl",children:t.originalAvatar})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-[16px] font-semibold text-gray-900",children:t.forumName}),"high"===t.influence&&e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 16 16",className:"text-[#ff8200]",children:e.jsx("path",{d:"M8 0L10 5L16 6L12 10L13 16L8 13L3 16L4 10L0 6L6 5L8 0Z",fill:"currentColor"})})]}),e.jsx("p",{className:"text-[13px] text-gray-600 mb-2 line-clamp-2",children:t.forumBio}),e.jsxs("div",{className:"flex items-center gap-3 text-[12px] text-gray-400",children:[e.jsxs("span",{children:["👥 ",d(t.followersCount)," 粉丝"]}),e.jsxs("span",{children:["· ",d(t.followingCount)," 关注"]})]})]}),e.jsx("button",{onClick:e=>{e.stopPropagation(),(e=>{const t=l.map(t=>t.characterId===e?{...t,isFollowedByUser:!t.isFollowedByUser}:t);n(t),Tt(t),c(t.filter(e=>e.isFollowedByUser).length)})(t.characterId)},className:"px-4 py-1.5 rounded-full text-[13px] font-medium transition-all flex-shrink-0 "+(t.isFollowedByUser?"bg-gray-100 text-gray-600 border border-gray-200":"bg-[#ff6c00] text-white active:opacity-80"),children:t.isFollowedByUser?"已关注":"关注"})]},t.characterId))})}),e.jsxs("div",{className:"p-4 bg-white border-t border-gray-100",children:[e.jsx("button",{onClick:()=>{a("/forum",{replace:!0})},className:"w-full py-3.5 bg-gradient-to-r from-[#ff8140] to-[#ff6c00] text-white rounded-full text-[16px] font-semibold active:scale-98 transition-transform shadow-lg",children:"开始探索论坛"}),e.jsx("button",{onClick:()=>a("/forum/initialize"),className:"w-full py-2.5 text-[14px] text-gray-600 mt-2 active:opacity-60",children:"重新选择角色"})]})]})}},Symbol.toStringTag,{value:"Module"}));var on=(e=>(e.TEXT="text",e.IMAGE="image",e.VIDEO="video",e.LINK="link",e))(on||{});const dn=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),{addPost:l,saveDraft:n}=y(),[i,c]=t.useState(""),[d,x]=t.useState([]),[m,h]=t.useState([]),[u,g]=t.useState(""),[p,f]=t.useState(!1),[b,j]=t.useState(""),[v,N]=t.useState(!1),[w,k]=t.useState(!1),[C,S]=t.useState(0),I=t.useRef(null),_=t.useRef(null),M=()=>{b.trim()&&!m.includes(b.trim())&&(h(e=>[...e,b.trim()]),j(""),f(!1))},z=()=>{if(i.trim()||0!==d.length)try{n({content:i.trim(),images:d.length>0?d:void 0,tags:m.length>0?m:void 0,location:u||void 0}),alert("草稿已保存"),a("/forum",{replace:!0})}catch(e){alert("保存失败，请重试")}};return e.jsxs("div",{className:"h-screen flex flex-col bg-white",children:[e.jsxs("div",{className:"glass-effect border-b border-white/30 shadow-sm flex-shrink-0",children:[r&&e.jsx(xa,{}),e.jsxs("div",{className:"px-4 py-2.5 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>{(i.trim()||d.length>0)&&window.confirm("内容尚未发布，是否保存为草稿？")?z():a(-1)},className:"text-[15px] text-gray-700 active:opacity-60",children:"取消"}),e.jsx("h1",{className:"text-[17px] font-semibold text-gray-900",children:"发微博"}),e.jsx("button",{onClick:async()=>{if(i.trim()||0!==d.length)try{N(!0);const e={id:"currentUser",name:"我",avatar:"😊"},t=l({authorId:e.id,authorName:e.name,authorAvatar:e.avatar,content:i.trim(),type:d.length>0?on.IMAGE:on.TEXT,images:d.length>0?d:void 0,tags:m.length>0?m:void 0,location:u||void 0,isVerified:!1,likeCount:0,commentCount:0,shareCount:0,isLiked:!1,isFavorited:!1});Wt(i).length>0?Rt(t.id,i.trim(),e.id,e.name):Ut(t),a("/forum",{replace:!0})}catch(e){alert("发布失败，请重试")}finally{N(!1)}else alert("请输入内容或添加图片")},disabled:v||!i.trim()&&0===d.length,className:"px-4 py-1.5 rounded-full text-[14px] font-medium "+(v||!i.trim()&&0===d.length?"bg-gray-200 text-gray-400":"bg-[#ff6c00] text-white active:opacity-80"),children:v?"发布中...":"发布"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"p-4 relative",children:[e.jsx("textarea",{ref:_,value:i,onChange:e=>{c(e.target.value),S(e.target.selectionStart||0)},onClick:e=>S(e.target.selectionStart||0),placeholder:"分享新鲜事...",className:"w-full min-h-[150px] text-[16px] text-gray-900 placeholder-gray-400 outline-none resize-none",autoFocus:!0}),e.jsx("button",{onClick:()=>k(!w),className:"absolute bottom-2 right-2 w-9 h-9 flex items-center justify-center text-[#ff6c00] active:opacity-60 bg-white rounded-full shadow-sm",title:"@角色",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M16 8h-6a4 4 0 1 0 0 8h0V14"})]})}),w&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white rounded-xl shadow-2xl max-h-[300px] overflow-y-auto z-50",children:e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"text-[13px] text-gray-500 px-3 py-2",children:"选择要@的角色"}),Ft().map(t=>e.jsxs("button",{onClick:()=>{var e;const s=Ot(i,C,t.originalName);c(s.newValue),S(s.newCursorPos),k(!1),null==(e=_.current)||e.focus()},className:"w-full flex items-center gap-3 p-3 hover:bg-gray-50 active:bg-gray-100 rounded-lg",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-xl flex-shrink-0",children:t.forumAvatar||t.originalAvatar||"😊"}),e.jsxs("div",{className:"flex-1 text-left min-w-0",children:[e.jsx("div",{className:"text-[14px] font-medium text-gray-900 truncate",children:t.forumNickname||t.originalName}),e.jsxs("div",{className:"text-[12px] text-gray-500 truncate",children:["@",t.originalName]})]})]},t.characterId)),0===Ft().length&&e.jsxs("div",{className:"text-center text-gray-400 py-8",children:[e.jsx("p",{className:"text-[14px]",children:"暂无可@的角色"}),e.jsx("p",{className:"text-[12px] mt-1",children:"请先在论坛初始化时添加角色"})]})]})})]}),d.length>0&&e.jsx("div",{className:"px-4 pb-4",children:e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[d.map((t,s)=>e.jsxs("div",{className:"relative aspect-square rounded-lg overflow-hidden bg-gray-100",children:[e.jsx("img",{src:t,alt:`图片${s+1}`,className:"w-full h-full object-cover"}),e.jsx("button",{onClick:()=>(e=>{x(t=>t.filter((t,s)=>s!==e))})(s),className:"absolute top-1 right-1 w-6 h-6 bg-black/50 rounded-full flex items-center justify-center active:opacity-70",children:e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"white",strokeWidth:"2.5",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12",strokeLinecap:"round"})})})]},s)),d.length<9&&e.jsx("button",{onClick:()=>{var e;return null==(e=I.current)?void 0:e.click()},className:"aspect-square rounded-lg border-2 border-dashed border-gray-300 flex items-center justify-center active:bg-gray-50",children:e.jsx("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-400",children:e.jsx("path",{d:"M12 5v14M5 12h14",strokeLinecap:"round"})})})]})}),m.length>0&&e.jsx("div",{className:"px-4 pb-4",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:m.map((t,s)=>e.jsxs("div",{className:"px-3 py-1.5 bg-[#fff6ed] rounded-full flex items-center gap-2",children:[e.jsxs("span",{className:"text-[14px] text-[#ff6c00]",children:["#",t]}),e.jsx("button",{onClick:()=>(e=>{h(t=>t.filter(t=>t!==e))})(t),className:"w-4 h-4 flex items-center justify-center active:opacity-60",children:e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"#ff6c00",strokeWidth:"2.5",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12",strokeLinecap:"round"})})})]},s))})}),u&&e.jsx("div",{className:"px-4 pb-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-[14px] text-gray-600",children:[e.jsx(_s,{size:16}),e.jsx("span",{children:u}),e.jsx("button",{onClick:()=>g(""),className:"ml-auto text-gray-400 active:opacity-60",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12",strokeLinecap:"round"})})})]})}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-sm p-4",children:[e.jsx("h3",{className:"text-[17px] font-semibold text-gray-900 mb-3",children:"添加话题"}),e.jsx("input",{type:"text",value:b,onChange:e=>j(e.target.value),onKeyPress:e=>"Enter"===e.key&&M(),placeholder:"输入话题名称",className:"w-full px-3 py-2 border border-gray-200 rounded-lg text-[15px] outline-none focus:border-[#ff6c00]",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx("button",{onClick:()=>{f(!1),j("")},className:"flex-1 py-2 text-[15px] text-gray-700 border border-gray-200 rounded-full active:bg-gray-50",children:"取消"}),e.jsx("button",{onClick:M,disabled:!b.trim(),className:"flex-1 py-2 text-[15px] rounded-full "+(b.trim()?"bg-[#ff6c00] text-white active:opacity-80":"bg-gray-200 text-gray-400"),children:"确定"})]})]})})]}),e.jsxs("div",{className:"bg-white border-t border-gray-100 flex-shrink-0",children:[e.jsxs("div",{className:"px-4 py-2 flex items-center gap-4 border-b border-gray-50",children:[e.jsxs("button",{onClick:()=>{var e;return null==(e=I.current)?void 0:e.click()},className:"flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-gray-50 active:bg-gray-100",children:[e.jsx(ds,{size:18,className:"text-gray-700"}),e.jsx("span",{className:"text-[13px] text-gray-700",children:"图片"})]}),e.jsxs("button",{onClick:()=>f(!0),className:"flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-gray-50 active:bg-gray-100",children:[e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-700",children:e.jsx("path",{d:"M7 20l4-16m2 16l4-16M6 9h14M4 15h14",strokeLinecap:"round"})}),e.jsx("span",{className:"text-[13px] text-gray-700",children:"话题"})]}),e.jsxs("button",{onClick:()=>g("北京·朝阳区"),className:"flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-gray-50 active:bg-gray-100",children:[e.jsx(_s,{size:18,className:"text-gray-700"}),e.jsx("span",{className:"text-[13px] text-gray-700",children:"位置"})]}),e.jsxs("button",{onClick:z,disabled:!i.trim()&&0===d.length,className:"ml-auto flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-gray-50 active:bg-gray-100 disabled:opacity-30",children:[e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-700",children:[e.jsx("path",{d:"M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M17 21v-8H7v8M7 3v5h8",strokeLinecap:"round",strokeLinejoin:"round"})]}),e.jsx("span",{className:"text-[13px] text-gray-700",children:"草稿"})]}),e.jsx("input",{ref:I,type:"file",accept:"image/*",multiple:!0,onChange:e=>{const t=e.target.files;t&&Array.from(t).forEach(e=>{const t=new FileReader;t.onload=e=>{var t;(null==(t=e.target)?void 0:t.result)&&x(t=>[...t,e.target.result])},t.readAsDataURL(e)})},className:"hidden"})]}),e.jsxs("div",{className:"flex items-center justify-around py-2",children:[e.jsxs("button",{onClick:()=>a("/forum"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"首页"})]}),e.jsxs("button",{onClick:()=>a("/forum/topics"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M7 20l4-16m2 16l4-16M6 9h14M4 15h14",strokeLinecap:"round"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"话题"})]}),e.jsx("button",{className:"flex flex-col items-center -mt-3",children:e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-[#ff8140] to-[#ff6c00] rounded-full flex items-center justify-center shadow-lg opacity-50",children:e.jsx(rs,{size:24,className:"text-white"})})}),e.jsxs("button",{onClick:()=>a("/forum/notifications"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"消息"})]}),e.jsxs("button",{onClick:()=>a("/forum/profile"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"我"})]})]})]})]})}},Symbol.toStringTag,{value:"Module"})),xn=({comment:t,onReply:s,onLike:a,onDelete:r,showReplies:l=!0})=>{return e.jsx("div",{className:"px-4 py-3 border-b border-gray-50",children:e.jsxs("div",{className:"flex gap-2.5",children:[e.jsx("div",{className:"w-9 h-9 rounded-full overflow-hidden bg-gray-200 flex-shrink-0",children:t.authorAvatar?e.jsx("img",{src:t.authorAvatar,alt:t.authorName,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-white bg-gradient-to-br from-blue-400 to-purple-400",children:e.jsx("span",{className:"text-sm font-medium",children:t.authorName[0]})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-[14px] text-gray-900 font-medium mb-1",children:t.authorName}),e.jsxs("div",{className:"text-[14px] text-gray-800 leading-[1.5] mb-2",children:[t.replyToUser&&e.jsxs("span",{className:"text-[#5b7599]",children:["回复 @",t.replyToUser,": "]}),t.content]}),e.jsxs("div",{className:"flex items-center gap-3 text-[12px] text-gray-400",children:[e.jsx("span",{children:(e=>{const t=Date.now()-e,s=Math.floor(t/6e4),a=Math.floor(t/36e5),r=Math.floor(t/864e5);if(s<1)return"刚刚";if(s<60)return`${s}分钟前`;if(a<24)return`${a}小时前`;if(r<7)return`${r}天前`;const l=new Date(e);return`${l.getMonth()+1}-${l.getDate()}`})(t.timestamp)}),s&&e.jsx("button",{onClick:()=>s(t),className:"active:opacity-60",children:"回复"}),a&&t.likeCount>0&&e.jsxs("button",{onClick:()=>a(t.id),className:"active:opacity-60 "+(t.isLiked?"text-[#ff6c00]":""),children:[(n=t.likeCount,n<1e3?n.toString():n<1e4?(n/1e3).toFixed(1)+"k":(n/1e4).toFixed(1)+"w")," 赞"]}),r&&e.jsx("button",{onClick:()=>r(t.id),className:"ml-auto active:opacity-60 text-red-400",children:"删除"})]}),l&&t.replies&&t.replies.length>0&&e.jsx("div",{className:"mt-2 ml-2 pl-3 border-l-2 border-gray-100 space-y-2",children:t.replies.map(t=>e.jsx(xn,{comment:t,onReply:s,onLike:a,showReplies:!1},t.id))})]})]})});var n},mn=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{id:l}=r(),{showStatusBar:n}=o(),{getPost:i,getComments:c,addComment:d,toggleLike:x}=y(),[m,h]=t.useState(null),[u,g]=t.useState([]),[p,f]=t.useState(""),[b,j]=t.useState(null),[v,N]=t.useState(!1),[w,k]=t.useState(!1),[C,S]=t.useState(0),I=t.useRef(null);t.useEffect(()=>{if(!l)return void a("/forum",{replace:!0});const e=i(l);if(!e)return alert("帖子不存在"),void a("/forum",{replace:!0});h(e);const t=c(l);g(t)},[l,i,c,a]);const _=async()=>{if(m&&p.trim())try{const e={id:"currentUser",name:"我",avatar:"😊"};d({postId:m.id,authorId:e.id,authorName:e.name,authorAvatar:e.avatar,content:p.trim(),replyTo:null==b?void 0:b.id,replyToUser:null==b?void 0:b.name,replyToUserId:null==b?void 0:b.id,isLiked:!1,likeCount:0});Wt(p).length>0&&Rt(m.id,p.trim(),e.id,e.name,null==b?void 0:b.id).then(()=>{const e=c(m.id);g(e)});const t=c(m.id);g(t),f(""),j(null),h(e=>e?{...e,commentCount:e.commentCount+1}:null)}catch(e){alert("评论失败，请重试")}},M=e=>{j({id:e.id,name:e.authorName}),N(!0),setTimeout(()=>{var e;return null==(e=I.current)?void 0:e.focus()},100)},z=e=>e<1e3?e.toString():e<1e4?(e/1e3).toFixed(1)+"k":(e/1e4).toFixed(1)+"w";return m?e.jsxs("div",{className:"h-screen flex flex-col bg-[#f7f7f7]",children:[e.jsxs("div",{className:"glass-effect border-b border-white/30 shadow-sm flex-shrink-0",children:[n&&e.jsx(xa,{}),e.jsxs("div",{className:"px-4 py-2.5 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a(-1),className:"w-9 h-9 flex items-center justify-center active:opacity-60",children:e.jsx(ls,{size:22,className:"text-gray-800"})}),e.jsx("h1",{className:"text-[17px] font-semibold text-gray-900",children:"详情"}),e.jsx("button",{className:"w-9 h-9 flex items-center justify-center active:opacity-60",children:e.jsx(As,{size:20,className:"text-gray-800"})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"bg-white mb-2 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-3",children:[e.jsx("div",{className:"w-11 h-11 rounded-full overflow-hidden bg-gray-200",children:m.authorAvatar?e.jsx("img",{src:m.authorAvatar,alt:m.authorName,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-white bg-gradient-to-br from-orange-400 to-pink-400",children:e.jsx("span",{className:"text-lg font-medium",children:m.authorName[0]})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"font-medium text-[15px] text-gray-900",children:m.authorName}),m.isVerified&&e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 16 16",className:"text-[#ff8200]",children:e.jsx("path",{d:"M8 0L10 5L16 6L12 10L13 16L8 13L3 16L4 10L0 6L6 5L8 0Z",fill:"currentColor"})})]}),e.jsxs("div",{className:"text-[12px] text-gray-400 mt-0.5",children:[(e=>{const t=Date.now()-e,s=Math.floor(t/6e4),a=Math.floor(t/36e5),r=Math.floor(t/864e5);if(s<1)return"刚刚";if(s<60)return`${s}分钟前`;if(a<24)return`${a}小时前`;if(r<7)return`${r}天前`;const l=new Date(e);return`${l.getMonth()+1}-${l.getDate()}`})(m.timestamp),m.location&&` · ${m.location}`]})]})]}),e.jsx("div",{className:"text-gray-800 text-[16px] leading-[1.6] mb-3",children:m.content}),m.tags&&m.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:m.tags.map((t,s)=>e.jsxs("span",{className:"text-[14px] text-[#5b7599]",children:["#",t,"#"]},s))}),m.images&&m.images.length>0&&e.jsx("div",{className:`grid ${1===m.images.length?"grid-cols-1":2===m.images.length||4===m.images.length?"grid-cols-2":"grid-cols-3"} gap-[3px] mb-3`,children:m.images.slice(0,9).map((t,s)=>e.jsx("div",{className:"aspect-square rounded-[4px] overflow-hidden bg-gray-100",children:e.jsx("img",{src:t,alt:`图片${s+1}`,className:"w-full h-full object-cover"})},s))}),e.jsxs("div",{className:"flex items-center gap-4 pt-3 border-t border-gray-50 text-[13px] text-gray-500",children:[e.jsxs("span",{children:[z(m.likeCount)," 赞"]}),e.jsxs("span",{children:[z(m.commentCount)," 评论"]}),e.jsxs("span",{children:[z(m.shareCount)," 转发"]})]})]}),e.jsxs("div",{className:"bg-white",children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-50",children:e.jsxs("span",{className:"text-[15px] font-medium text-gray-900",children:["评论 ",u.length]})}),0===u.length?e.jsx("div",{className:"py-20 text-center text-gray-400 text-[14px]",children:"暂无评论"}):e.jsx("div",{children:u.map(t=>e.jsx(xn,{comment:t,onReply:M},t.id))})]})]}),e.jsxs("div",{className:"bg-white border-t border-gray-100 flex-shrink-0",children:[e.jsxs("div",{className:"px-4 py-2 flex items-center gap-3 border-b border-gray-50",children:[e.jsx("button",{onClick:()=>N(!0),className:"flex-1 h-9 px-3 bg-gray-100 rounded-full text-left text-[14px] text-gray-500",children:"说点什么..."}),e.jsx("button",{onClick:()=>{m&&(x(m.id),h(e=>e?{...e,isLiked:!e.isLiked,likeCount:e.isLiked?e.likeCount-1:e.likeCount+1}:null))},className:"flex items-center gap-1.5 px-3 py-1.5 active:opacity-60",children:m.isLiked?e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",className:"text-[#ff6c00]",children:e.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})}):e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})})})]}),e.jsxs("div",{className:"flex items-center justify-around py-2",children:[e.jsxs("button",{onClick:()=>a("/forum"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"首页"})]}),e.jsxs("button",{onClick:()=>a("/forum/topics"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M7 20l4-16m2 16l4-16M6 9h14M4 15h14",strokeLinecap:"round"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"话题"})]}),e.jsx("button",{className:"flex flex-col items-center -mt-3",children:e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-[#ff8140] to-[#ff6c00] rounded-full flex items-center justify-center shadow-lg opacity-50",children:e.jsx(rs,{size:24,className:"text-white"})})}),e.jsxs("button",{onClick:()=>a("/forum/notifications"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"消息"})]}),e.jsxs("button",{onClick:()=>a("/forum/profile"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"我"})]})]})]}),e.jsxs("div",{className:"fixed inset-x-0 bottom-0 bg-white border-t border-gray-200 p-4 safe-area-bottom z-50",children:[b&&e.jsxs("div",{className:"flex items-center justify-between mb-2 text-[13px] text-gray-500",children:[e.jsxs("span",{children:["回复 @",b.name]}),e.jsx("button",{onClick:()=>{j(null),f("")},className:"text-gray-400 active:opacity-60",children:"取消"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>k(!w),className:"w-9 h-9 flex items-center justify-center text-[#ff6c00] active:opacity-60",title:"@角色",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M16 8h-6a4 4 0 1 0 0 8h0V14"})]})}),e.jsx("input",{ref:I,type:"text",value:p,onChange:e=>{f(e.target.value),S(e.target.selectionStart||0)},onClick:e=>S(e.target.selectionStart||0),onKeyPress:e=>"Enter"===e.key&&_(),placeholder:b?`回复 @${b.name}`:"说点什么...",className:"flex-1 h-10 px-3 bg-gray-100 rounded-full text-[14px] outline-none"}),e.jsx("button",{onClick:_,disabled:!p.trim(),className:"px-5 h-10 rounded-full text-[14px] font-medium "+(p.trim()?"bg-[#ff6c00] text-white active:opacity-80":"bg-gray-200 text-gray-400"),children:"发送"})]}),w&&e.jsx("div",{className:"absolute bottom-full left-0 right-0 mb-2 bg-white rounded-xl shadow-2xl max-h-[300px] overflow-y-auto",children:e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"text-[13px] text-gray-500 px-3 py-2",children:"选择要@的角色"}),Ft().map(t=>e.jsxs("button",{onClick:()=>{var e;const s=Ot(p,C,t.originalName);f(s.newValue),S(s.newCursorPos),k(!1),null==(e=I.current)||e.focus()},className:"w-full flex items-center gap-3 p-3 hover:bg-gray-50 active:bg-gray-100 rounded-lg",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-xl flex-shrink-0",children:t.forumAvatar||t.originalAvatar||"😊"}),e.jsxs("div",{className:"flex-1 text-left min-w-0",children:[e.jsx("div",{className:"text-[14px] font-medium text-gray-900 truncate",children:t.forumNickname||t.originalName}),e.jsxs("div",{className:"text-[12px] text-gray-500 truncate",children:["@",t.originalName]})]})]},t.characterId)),0===Ft().length&&e.jsxs("div",{className:"text-center text-gray-400 py-8",children:[e.jsx("p",{className:"text-[14px]",children:"暂无可@的角色"}),e.jsx("p",{className:"text-[12px] mt-1",children:"请先在论坛初始化时添加角色"})]})]})})]})]}):e.jsx("div",{className:"h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-3 border-[#ff6c00] border-t-transparent rounded-full"})})}},Symbol.toStringTag,{value:"Module"})),hn=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),{loadPosts:l}=y(),[n,i]=t.useState(""),[c,d]=t.useState([]),[x,m]=t.useState([]),[h,u]=t.useState([]),[g,p]=t.useState("posts"),[f,b]=t.useState(!1),[j,v]=t.useState(!1),N=t.useRef(null);t.useEffect(()=>{var e;const t=localStorage.getItem("forum_search_history");if(t)try{m(JSON.parse(t))}catch(s){}u([{name:"微博热搜",count:12800},{name:"今日话题",count:8500},{name:"科技资讯",count:6200},{name:"娱乐八卦",count:5100},{name:"美食分享",count:3800}]),null==(e=N.current)||e.focus()},[]);const w=async e=>{const t=e||n;if(t.trim())try{b(!0),v(!0);const e=[t,...x.filter(e=>e!==t)].slice(0,10);m(e),localStorage.setItem("forum_search_history",JSON.stringify(e)),await l({keyword:t}),d([])}catch(s){}finally{b(!1)}},k=()=>{window.confirm("确定清空搜索历史吗？")&&(m([]),localStorage.removeItem("forum_search_history"))};return e.jsxs("div",{className:"h-screen flex flex-col bg-[#f7f7f7]",children:[e.jsxs("div",{className:"glass-effect border-b border-white/30 shadow-sm flex-shrink-0",children:[r&&e.jsx(xa,{}),e.jsxs("div",{className:"px-4 py-2.5 flex items-center gap-2",children:[e.jsx("button",{onClick:()=>a(-1),className:"w-9 h-9 flex items-center justify-center active:opacity-60",children:e.jsx(ls,{size:22,className:"text-gray-800"})}),e.jsxs("div",{className:"flex-1 h-9 bg-gray-100 rounded-full flex items-center px-3",children:[e.jsx(as,{size:16,className:"text-gray-400"}),e.jsx("input",{ref:N,type:"text",value:n,onChange:e=>i(e.target.value),onKeyPress:e=>"Enter"===e.key&&w(),placeholder:"搜索你感兴趣的内容",className:"flex-1 ml-2 text-[14px] bg-transparent outline-none"}),n&&e.jsx("button",{onClick:()=>{i(""),v(!1)},className:"w-5 h-5 flex items-center justify-center active:opacity-60",children:e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M15 9l-6 6M9 9l6 6",strokeLinecap:"round"})]})})]}),e.jsx("button",{onClick:()=>w(),disabled:!n.trim(),className:`text-[15px] ${n.trim()?"text-[#ff6c00]":"text-gray-400"} active:opacity-60`,children:"搜索"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:j?f?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-3 border-[#ff6c00] border-t-transparent rounded-full"})}):0===c.length?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-gray-400",children:[e.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",className:"mb-4 opacity-30",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("path",{d:"M21 21l-4.35-4.35",strokeLinecap:"round"})]}),e.jsx("p",{className:"text-[14px]",children:"未找到相关内容"})]}):e.jsxs("div",{className:"bg-white mt-2",children:[e.jsx("div",{className:"flex border-b border-gray-100",children:[{key:"posts",label:"帖子"},{key:"topics",label:"话题"},{key:"users",label:"用户"}].map(t=>e.jsxs("button",{onClick:()=>p(t.key),className:"flex-1 py-3 text-center relative "+(g===t.key?"text-[#ff6c00] font-medium":"text-gray-600"),children:[t.label,g===t.key&&e.jsx("div",{className:"absolute bottom-0 left-1/2 transform -translate-x-1/2 w-6 h-[3px] bg-[#ff6c00] rounded-t-full"})]},t.key))}),e.jsx("div",{children:c.map(t=>e.jsxs("div",{onClick:()=>a(`/forum/post/${t.id}`),className:"p-4 border-b border-gray-50 active:bg-gray-50",children:[e.jsx("div",{className:"text-[14px] text-gray-900 line-clamp-2 mb-1",children:t.content}),e.jsxs("div",{className:"text-[12px] text-gray-400",children:[t.authorName," · ",t.likeCount," 赞 · ",t.commentCount," 评论"]})]},t.id))})]}):e.jsxs(e.Fragment,{children:[0===x.length?null:e.jsxs("div",{className:"bg-white mt-2 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-[15px] font-medium text-gray-900",children:"搜索历史"}),e.jsx("button",{onClick:k,className:"text-[13px] text-gray-500 active:opacity-60",children:"清空"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:x.map((t,s)=>e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-gray-50 rounded-full",children:[e.jsx("button",{onClick:()=>(e=>{i(e),w(e)})(t),className:"text-[14px] text-gray-700 active:opacity-60",children:t}),e.jsx("button",{onClick:()=>(e=>{const t=x.filter(t=>t!==e);m(t),localStorage.setItem("forum_search_history",JSON.stringify(t))})(t),className:"w-4 h-4 flex items-center justify-center active:opacity-60",children:e.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12",strokeLinecap:"round"})})})]},s))})]}),e.jsxs("div",{className:"bg-white mt-2 p-4",children:[e.jsx("div",{className:"mb-3",children:e.jsx("span",{className:"text-[15px] font-medium text-gray-900",children:"热门话题"})}),e.jsx("div",{className:"space-y-3",children:h.map((t,s)=>e.jsxs("button",{onClick:()=>(e=>{i(e),w(e)})(t.name),className:"w-full flex items-center gap-3 active:opacity-60",children:[e.jsx("div",{className:"w-6 h-6 rounded flex items-center justify-center text-[12px] font-bold "+(s<3?"bg-gradient-to-r from-orange-400 to-red-400 text-white":"bg-gray-100 text-gray-600"),children:s+1}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsxs("div",{className:"text-[15px] text-gray-900 font-medium",children:["#",t.name]}),e.jsxs("div",{className:"text-[12px] text-gray-400",children:[(t.count/1e4).toFixed(1),"w 讨论"]})]}),e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-400",children:e.jsx("path",{d:"M9 18l6-6-6-6",strokeLinecap:"round"})})]},s))})]})]})}),e.jsxs("div",{className:"bg-white border-t border-gray-100 flex items-center justify-around py-2",children:[e.jsxs("button",{onClick:()=>a("/forum"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"首页"})]}),e.jsxs("button",{onClick:()=>a("/forum/topics"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M7 20l4-16m2 16l4-16M6 9h14M4 15h14",strokeLinecap:"round"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"话题"})]}),e.jsx("button",{onClick:()=>a("/forum/publish"),className:"flex flex-col items-center -mt-3 active:scale-95 transition-transform",children:e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-[#ff8140] to-[#ff6c00] rounded-full flex items-center justify-center shadow-lg",children:e.jsx(rs,{size:24,className:"text-white"})})}),e.jsxs("button",{onClick:()=>a("/forum/notifications"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"消息"})]}),e.jsxs("button",{onClick:()=>a("/forum/profile"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"我"})]})]})]})}},Symbol.toStringTag,{value:"Module"})),un=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),[l,n]=t.useState([]),[i,c]=t.useState("hot");t.useEffect(()=>{d();const e=setInterval(()=>{d()},3e3);return()=>clearInterval(e)},[]);const d=()=>{const e=localStorage.getItem("forum_topics_list");let t=[];if(e)try{t=JSON.parse(e)}catch(l){}const s=localStorage.getItem("forum_deleted_topics"),a=s?JSON.parse(s):[],r=[{id:"default_1",name:"今日热搜",description:"实时热点，大家都在看",postsCount:128900,followersCount:456700,isFollowing:!1,isHot:!0},{id:"default_2",name:"科技前沿",description:"AI、编程、前沿科技讨论",postsCount:89600,followersCount:234500,isFollowing:!1,isHot:!0},{id:"default_3",name:"美食分享",description:"吃货天堂，分享美食",postsCount:67800,followersCount:189e3,isFollowing:!1,isHot:!0},{id:"default_4",name:"游戏天地",description:"游戏资讯、攻略、交流",postsCount:145600,followersCount:567800,isFollowing:!1,isHot:!0},{id:"default_5",name:"摄影分享",description:"记录生活，分享美好瞬间",postsCount:45600,followersCount:123400,isFollowing:!1,isHot:!1}].filter(e=>!a.includes(e.id));n([...t,...r])},x=e=>e<1e4?(e/1e3).toFixed(1)+"k":(e/1e4).toFixed(1)+"w",m="following"===i?l.filter(e=>e.isFollowing):l;return e.jsxs("div",{className:"h-screen flex flex-col bg-[#f7f7f7]",children:[e.jsxs("div",{className:"glass-effect border-b border-white/30 shadow-sm flex-shrink-0",children:[r&&e.jsx(xa,{}),e.jsxs("div",{className:"px-4 py-2.5 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a("/forum"),className:"w-9 h-9 flex items-center justify-center active:opacity-60",children:e.jsx(ls,{size:22,className:"text-gray-800"})}),e.jsx("h1",{className:"text-[17px] font-semibold text-gray-900",children:"话题"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{confirm("确定要恢复所有已删除的预设话题吗？")&&(localStorage.removeItem("forum_deleted_topics"),d())},className:"w-9 h-9 flex items-center justify-center active:opacity-60",title:"恢复已删除话题",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-800",children:[e.jsx("path",{d:"M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("polyline",{points:"9 22 9 12 15 12 15 22",strokeLinecap:"round",strokeLinejoin:"round"})]})}),e.jsx("button",{onClick:()=>a("/forum/search"),className:"w-9 h-9 flex items-center justify-center active:opacity-60",children:e.jsx(as,{size:20,className:"text-gray-800"})}),e.jsx("button",{onClick:()=>a("/forum/create-topic"),className:"w-9 h-9 flex items-center justify-center active:opacity-60",children:e.jsx(rs,{size:20,className:"text-[#ff6c00]"})})]})]}),e.jsxs("div",{className:"flex items-center px-4 pb-2.5",children:[e.jsx("button",{onClick:()=>c("hot"),className:"px-3 py-1.5 text-[14px] rounded-full transition-all mr-3 "+("hot"===i?"bg-[#ff6c00] text-white font-medium":"text-gray-700 hover:bg-gray-100"),children:"热门"}),e.jsx("button",{onClick:()=>c("following"),className:"px-3 py-1.5 text-[14px] rounded-full transition-all "+("following"===i?"bg-[#ff6c00] text-white font-medium":"text-gray-700 hover:bg-gray-100"),children:"关注"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:0===m.length?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-gray-400",children:[e.jsx("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",className:"mb-4 opacity-30",children:e.jsx("path",{d:"M7 20l4-16m2 16l4-16M6 9h14M4 15h14",strokeWidth:"2"})}),e.jsx("p",{className:"text-[14px]",children:"暂无关注的话题"})]}):e.jsx("div",{children:m.map((t,s)=>e.jsx("div",{onClick:()=>a(`/forum/topic/${t.id}`),className:"bg-white mb-2 p-4 active:bg-gray-50",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0 "+(t.isHot&&s<3?"bg-gradient-to-br from-[#ff8140] to-[#ff6c00]":"bg-gray-100"),children:t.isHot&&s<3?e.jsx("span",{className:"text-white font-bold text-[16px]",children:s+1}):e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-500",children:e.jsx("path",{d:"M7 20l4-16m2 16l4-16M6 9h14M4 15h14",strokeLinecap:"round"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("h3",{className:"text-[16px] font-semibold text-gray-900",children:["#",t.name]}),t.isHot&&e.jsx("span",{className:"px-1.5 py-0.5 bg-red-50 text-red-500 text-[11px] rounded",children:"热"})]}),e.jsx("p",{className:"text-[13px] text-gray-500 mb-2",children:t.description}),e.jsxs("div",{className:"flex items-center gap-3 text-[12px] text-gray-400",children:[e.jsxs("span",{children:[x(t.postsCount)," 帖子"]}),e.jsxs("span",{children:["· ",x(t.followersCount)," 人关注"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("button",{onClick:e=>{var s;e.stopPropagation(),s=t.id,n(e=>e.map(e=>e.id===s?{...e,isFollowing:!e.isFollowing}:e))},className:"px-4 py-1.5 rounded-full text-[13px] font-medium transition-all "+(t.isFollowing?"bg-gray-100 text-gray-600 border border-gray-200":"bg-[#ff6c00] text-white"),children:t.isFollowing?"已关注":"关注"}),e.jsx("button",{onClick:e=>((e,t)=>{if(t.stopPropagation(),confirm("确定要删除这个话题吗？")){if(e.startsWith("default_")){const t=localStorage.getItem("forum_deleted_topics"),s=t?JSON.parse(t):[];s.push(e),localStorage.setItem("forum_deleted_topics",JSON.stringify(s))}else{const t=localStorage.getItem("forum_topics_list");if(t){const s=JSON.parse(t).filter(t=>t.id!==e);localStorage.setItem("forum_topics_list",JSON.stringify(s))}}d()}})(t.id,e),className:"w-8 h-8 flex items-center justify-center text-gray-400 hover:text-red-500 active:opacity-60 transition-colors",title:"删除话题",children:e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2M10 11v6M14 11v6",strokeLinecap:"round",strokeLinejoin:"round"})})})]})]})},t.id))})}),e.jsxs("div",{className:"bg-white border-t border-gray-100 flex items-center justify-around py-2",children:[e.jsxs("button",{onClick:()=>a("/forum"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"首页"})]}),e.jsxs("button",{className:"flex flex-col items-center gap-1 py-1",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",className:"text-[#ff6c00]",children:e.jsx("path",{d:"M7 20l4-16m2 16l4-16M6 9h14M4 15h14"})}),e.jsx("span",{className:"text-[11px] text-[#ff6c00] font-medium",children:"话题"})]}),e.jsx("button",{onClick:()=>a("/forum/publish"),className:"flex flex-col items-center -mt-3 active:scale-95 transition-transform",children:e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-[#ff8140] to-[#ff6c00] rounded-full flex items-center justify-center shadow-lg",children:e.jsx(rs,{size:24,className:"text-white"})})}),e.jsxs("button",{onClick:()=>a("/forum/notifications"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"消息"})]}),e.jsxs("button",{onClick:()=>a("/forum/profile"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"我"})]})]})]})}},Symbol.toStringTag,{value:"Module"})),gn=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),[l,n]=t.useState(""),[i,c]=t.useState("");return e.jsxs("div",{className:"h-screen flex flex-col bg-white",children:[e.jsxs("div",{className:"glass-effect border-b border-white/30 shadow-sm flex-shrink-0",children:[r&&e.jsx(xa,{}),e.jsxs("div",{className:"px-4 py-2.5 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a(-1),className:"text-[15px] text-gray-700 active:opacity-60",children:"取消"}),e.jsx("h1",{className:"text-[17px] font-semibold text-gray-900",children:"创建话题"}),e.jsx("button",{onClick:async()=>{if(!l.trim())return void alert("请输入话题名称");if(!i.trim())return void alert("请输入话题介绍");const e={id:`topic_gen_${Date.now()}`,topicName:l.trim(),topicDesc:i.trim(),status:"generating",startTime:Date.now()};localStorage.setItem("forum_generating_task",JSON.stringify(e)),alert("话题创建成功！\nAI正在后台生成内容，你可以先去做其他事情\n生成完成后会自动显示在话题列表中"),a("/forum/topics");try{const t=await Vt(l.trim(),i.trim()),s=JSON.parse(localStorage.getItem("forum_topics_list")||"[]"),a={id:`topic_${Date.now()}`,name:l.trim(),description:i.trim(),cover:"",postsCount:t.posts.length,followersCount:Math.floor(5e3*Math.random())+1e3,isFollowing:!0,isHot:!0,createdAt:Date.now(),users:t.users,posts:t.posts};s.unshift(a),localStorage.setItem("forum_topics_list",JSON.stringify(s));const r={...e,status:"completed",topicId:a.id};localStorage.setItem("forum_generating_task",JSON.stringify(r))}catch(t){const s={...e,status:"failed",error:t.message};localStorage.setItem("forum_generating_task",JSON.stringify(s))}},disabled:!l.trim()||!i.trim(),className:"px-4 py-1.5 rounded-full text-[14px] font-medium "+(l.trim()&&i.trim()?"bg-[#ff6c00] text-white active:opacity-80":"bg-gray-200 text-gray-400"),children:"创建"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-[14px] text-gray-700 font-medium mb-2",children:"话题名称"}),e.jsx("input",{type:"text",value:l,onChange:e=>n(e.target.value),maxLength:20,placeholder:"例如：AI技术讨论、美食分享、游戏攻略",className:"w-full px-4 py-3 border border-gray-200 rounded-lg text-[15px] outline-none focus:border-[#ff6c00]"}),e.jsxs("div",{className:"flex items-center justify-between mt-1 text-[12px] text-gray-400",children:[e.jsxs("span",{children:["话题名称会显示为 #",l||"话题名称"]}),e.jsxs("span",{children:[l.length,"/20"]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-[14px] text-gray-700 font-medium mb-2",children:"话题介绍"}),e.jsx("textarea",{value:i,onChange:e=>c(e.target.value),maxLength:200,rows:4,placeholder:"简单介绍这个话题的内容和讨论方向...",className:"w-full px-4 py-3 border border-gray-200 rounded-lg text-[15px] outline-none focus:border-[#ff6c00] resize-none"}),e.jsxs("div",{className:"flex items-center justify-between mt-1 text-[12px] text-gray-400",children:[e.jsx("span",{children:"AI会根据介绍生成相关讨论"}),e.jsxs("span",{children:[i.length,"/200"]})]})]})]})]})}},Symbol.toStringTag,{value:"Module"})),pn=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{var a,l,n;const i=s(),{id:c}=r(),{showStatusBar:d}=o(),[x,m]=t.useState(null),[h,u]=t.useState([]),[g,p]=t.useState([]),[f,b]=t.useState(null),[j,v]=t.useState(""),[y,N]=t.useState([]),[w,k]=t.useState(!1);t.useEffect(()=>{var e;if(!c)return void i("/forum/topics",{replace:!0});const t=JSON.parse(localStorage.getItem("forum_topics_list")||"[]").find(e=>e.id===c);if(!t)return alert("话题不存在"),void i("/forum/topics",{replace:!0});m(t);const s=[{id:"currentUser",name:"我",bio:"这是我的账号",avatar:"😊",followers:0},...t.users||[]];p(s);const a=(t.posts||[]).map(e=>({...e,comments:e.comments||[]}));u(a);const r=[...JSON.parse(localStorage.getItem("forum_npc_users")||"[]")];null==(e=t.users)||e.forEach(e=>{r.find(t=>t.id===e.id)||r.push({id:e.id,name:e.name,avatar:e.avatar,bio:e.bio||"这个人很懒，什么都没留下",followers:e.followers||Math.floor(500*Math.random())+50,following:Math.floor(200*Math.random())+20,posts:0})}),localStorage.setItem("forum_npc_users",JSON.stringify(r))},[c]);const C=e=>{const t=Date.now()-e,s=Math.floor(t/6e4),a=Math.floor(t/36e5),r=Math.floor(t/864e5);if(s<1)return"刚刚";if(s<60)return`${s}分钟前`;if(a<24)return`${a}小时前`;if(r<7)return`${r}天前`;const l=new Date(e);return`${l.getMonth()+1}-${l.getDate()}`},S=e=>e<1e3?e.toString():e<1e4?(e/1e3).toFixed(1)+"k":(e/1e4).toFixed(1)+"w",I=e=>g.find(t=>t.id===e),_=()=>{if(!j.trim()||!f)return;const e={id:`user_c_${Date.now()}`,authorId:"currentUser",content:j.trim(),likes:0,timestamp:Date.now(),replyTo:f.commentId||void 0,isUserComment:!0},t=h.map(t=>{if(t.id===f.postId){return{...t,comments:[...t.comments||[],e]}}return t});if(u(t),N([...y,{...e,postId:f.postId}]),x){const e=JSON.parse(localStorage.getItem("forum_topics_list")||"[]").map(e=>e.id===x.id?{...e,posts:t}:e);localStorage.setItem("forum_topics_list",JSON.stringify(e))}v(""),b(null)},M=e=>{let t=[...h];e.forEach(e=>{const s=y.find(t=>t.id===e.targetCommentId);if(s){const a=g.find(t=>t.id===e.userId);t=t.map(t=>{if(t.id===s.postId){const s={id:`ai_c_${Date.now()}_${Math.random()}`,authorId:e.userId,content:e.content,likes:Math.floor(20*Math.random()),timestamp:Date.now()+6e5*Math.random(),replyTo:e.targetCommentId};return a&&Jt({type:"comment",fromUserId:e.userId,fromUserName:a.name,fromUserAvatar:a.avatar,content:e.content,postId:t.id,commentId:s.id,isRead:!1}),{...t,comments:[...t.comments,s]}}return t})}}),u(t);const s=JSON.parse(localStorage.getItem("forum_topics_list")||"[]").map(e=>e.id===x.id?{...e,posts:t,postsCount:t.length}:e);localStorage.setItem("forum_topics_list",JSON.stringify(s))};return x?e.jsxs("div",{className:"h-screen flex flex-col bg-[#f7f7f7]",children:[e.jsxs("div",{className:"glass-effect border-b border-white/30 shadow-sm flex-shrink-0",children:[d&&e.jsx(xa,{}),e.jsxs("div",{className:"px-4 py-2.5 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>i("/forum/topics"),className:"w-9 h-9 flex items-center justify-center active:opacity-60",children:e.jsx(ls,{size:22,className:"text-gray-800"})}),e.jsxs("h1",{className:"text-[17px] font-semibold text-gray-900",children:["#",x.name]}),e.jsx("button",{onClick:async()=>{var e,t,s;if(0!==y.length){k(!0);try{const a=localStorage.getItem("apiSettings");if(!a)throw new Error("请先配置API");const r=JSON.parse(a),l=`你是论坛互动生成器。用户在话题"${x.name}"中发了${y.length}条评论。\n\n用户的评论：\n${y.map((e,t)=>{const s=h.find(t=>t.id===e.postId),a=null==s?void 0:s.comments.find(t=>t.id===e.replyTo),r=a?I(a.authorId):null;return`【评论${t+1}】ID:${e.id} 回复@${null==r?void 0:r.name}说："${e.content}"`}).join("\n")}\n\n现有用户列表：\n${g.filter(e=>"currentUser"!==e.id).slice(0,10).map(e=>`${e.id}|${e.name}`).join("\n")}\n\n请生成3-5条回复，每行一个，格式：\n回复|评论ID|用户ID|回复内容\n\n示例：\n回复|user_c_1234567890|user1|哈哈说得对\n回复|user_c_1234567890|user3|楼主观点我不同意\n回复|user_c_1234567890|user5|有道理诶\n\n要求：\n- 内容真实自然，15-30字\n- 不同用户有不同态度\n- 直接输出，不要代码块标记\n- 每行格式必须是：回复|评论ID|用户ID|回复内容\n`,n=await fetch(r.baseUrl+"/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.apiKey}`},body:JSON.stringify({model:r.model,messages:[{role:"user",content:l}],temperature:.9,max_tokens:2e3})});if(!n.ok)throw new Error("API调用失败");const i=await n.json(),c=((null==(s=null==(t=null==(e=i.choices)?void 0:e[0])?void 0:t.message)?void 0:s.content)||"").split("\n").filter(e=>e.trim().startsWith("回复"));if(0===c.length)throw new Error("AI没有生成回复");const o=[];c.forEach(e=>{const t=e.split("|");4===t.length&&o.push({targetCommentId:t[1].trim(),userId:t[2].trim(),content:t[3].trim()})}),M(o),alert(`✨ AI生成完成！收到 ${o.length} 条回复`)}catch(a){alert("生成失败："+a.message)}finally{k(!1)}}else alert("你还没有发表任何评论哦")},disabled:w||0===y.length,className:"w-9 h-9 flex items-center justify-center "+(y.length>0?"active:scale-90 transition-transform":"opacity-30"),title:"生成互动反应",children:w?e.jsx("div",{className:"w-5 h-5 border-2 border-[#ff6c00] border-t-transparent rounded-full animate-spin"}):e.jsx("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-[#ff6c00]",children:e.jsx("path",{d:"M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z",strokeLinecap:"round",strokeLinejoin:"round"})})})]})]}),e.jsxs("div",{className:"bg-white p-4 mb-2",children:[e.jsxs("h2",{className:"text-[18px] font-bold text-gray-900 mb-2",children:["#",x.name]}),e.jsx("p",{className:"text-[14px] text-gray-600 mb-3",children:x.description}),e.jsxs("div",{className:"flex items-center gap-4 text-[13px] text-gray-500",children:[e.jsxs("span",{children:[S(x.postsCount)," 帖子"]}),e.jsxs("span",{children:["· ",S(x.followersCount)," 人关注"]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:h.map(t=>{var s;const a=I(t.authorId);return a?e.jsxs("div",{className:"bg-white mb-2 p-4",children:[e.jsxs("div",{className:"flex items-start gap-2.5 mb-3",children:[e.jsx("button",{onClick:()=>"currentUser"!==t.authorId&&i(`/forum/user/${t.authorId}`),className:"w-11 h-11 rounded-full bg-gray-100 flex items-center justify-center text-2xl flex-shrink-0 active:opacity-70",disabled:"currentUser"===t.authorId,children:a.avatar}),e.jsxs("div",{className:"flex-1",children:[e.jsx("button",{onClick:()=>"currentUser"!==t.authorId&&i(`/forum/user/${t.authorId}`),className:"text-[15px] font-medium text-gray-900 active:text-[#ff6c00] text-left",disabled:"currentUser"===t.authorId,children:a.name}),e.jsxs("div",{className:"text-[12px] text-gray-400",children:[C(t.timestamp)," · ",S(a.followers)," 粉丝"]})]})]}),e.jsx("div",{className:"text-[15px] text-gray-800 leading-relaxed mb-3",children:t.content}),e.jsxs("div",{className:"flex items-center gap-4 text-[13px] pt-3 border-t border-gray-50",children:[e.jsxs("span",{className:"text-gray-500",children:["❤️ ",S(t.likes)]}),e.jsxs("button",{onClick:()=>b({postId:t.id,commentId:""}),className:"text-gray-500 hover:text-[#ff6c00] active:opacity-60 flex items-center gap-1",children:["💬 ",e.jsx("span",{children:(null==(s=t.comments)?void 0:s.length)||0})," ",e.jsx("span",{className:"text-[#ff6c00]",children:"评论"})]})]}),t.comments&&t.comments.length>0&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-100 space-y-3",children:t.comments.map(s=>{const a=I(s.authorId),r=s.replyTo?t.comments.find(e=>e.id===s.replyTo):null,l=r?I(r.authorId):null;return e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>"currentUser"!==s.authorId&&i(`/forum/user/${s.authorId}`),className:"w-7 h-7 rounded-full bg-gray-100 flex items-center justify-center text-sm flex-shrink-0 active:opacity-70",disabled:"currentUser"===s.authorId,children:(null==a?void 0:a.avatar)||"😊"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"text-[13px]",children:[e.jsx("button",{onClick:()=>"currentUser"!==s.authorId&&i(`/forum/user/${s.authorId}`),className:"font-medium text-gray-900 active:text-[#ff6c00]",disabled:"currentUser"===s.authorId,children:null==a?void 0:a.name}),l&&e.jsxs("span",{className:"text-gray-500",children:[" 回复 ",e.jsxs("button",{onClick:()=>"currentUser"!==(null==r?void 0:r.authorId)&&i(`/forum/user/${null==r?void 0:r.authorId}`),className:"text-[#5b7599] active:text-[#ff6c00]",disabled:"currentUser"===(null==r?void 0:r.authorId),children:["@",l.name]})]}),e.jsxs("span",{className:"text-gray-700",children:[": ",s.content]})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-[11px] text-gray-400",children:[e.jsx("span",{children:C(s.timestamp)}),s.likes>0&&e.jsxs("span",{children:["❤️ ",s.likes]}),e.jsx("button",{onClick:()=>b({postId:t.id,commentId:s.id}),className:"text-[#ff6c00] hover:text-[#ff8533] active:opacity-60",children:"回复"})]})]})]},s.id)})})]},t.id):null})}),f&&e.jsxs("div",{className:"bg-white border-t border-gray-200 p-3 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-[13px] text-gray-600",children:f.commentId?`回复 @${(null==(n=I(null==(l=null==(a=h.find(e=>e.id===f.postId))?void 0:a.comments.find(e=>e.id===f.commentId))?void 0:l.authorId))?void 0:n.name)||"用户"}`:"评论"}),e.jsx("button",{onClick:()=>{b(null),v("")},className:"ml-auto text-[12px] text-gray-500 active:opacity-60",children:"取消"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:j,onChange:e=>v(e.target.value),placeholder:"说点什么...",className:"flex-1 px-3 py-2 border border-gray-200 rounded-full text-[14px] outline-none focus:border-[#ff6c00]",autoFocus:!0,onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),_())}}),e.jsx("button",{onClick:_,disabled:!j.trim(),className:"px-4 py-2 rounded-full text-[14px] font-medium "+(j.trim()?"bg-[#ff6c00] text-white active:opacity-80":"bg-gray-100 text-gray-400"),children:"发送"})]})]}),e.jsxs("div",{className:"bg-white border-t border-gray-100 flex items-center justify-around py-2",children:[e.jsxs("button",{onClick:()=>i("/forum"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"首页"})]}),e.jsxs("button",{onClick:()=>i("/forum/topics"),className:"flex flex-col items-center gap-1 py-1",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",className:"text-[#ff6c00]",children:e.jsx("path",{d:"M7 20l4-16m2 16l4-16M6 9h14M4 15h14"})}),e.jsx("span",{className:"text-[11px] text-[#ff6c00] font-medium",children:"话题"})]}),e.jsx("button",{onClick:()=>i("/forum/publish"),className:"flex flex-col items-center -mt-3 active:scale-95 transition-transform",children:e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-[#ff8140] to-[#ff6c00] rounded-full flex items-center justify-center shadow-lg",children:e.jsx(rs,{size:24,className:"text-white"})})}),e.jsxs("button",{onClick:()=>i("/forum/notifications"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"消息"})]}),e.jsxs("button",{onClick:()=>i("/forum/profile"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"我"})]})]})]}):e.jsx("div",{className:"h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-3 border-[#ff6c00] border-t-transparent rounded-full"})})}},Symbol.toStringTag,{value:"Module"})),fn=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),[l,n]=t.useState([]),[i,c]=t.useState([]),[d,x]=t.useState("all");t.useEffect(()=>{m()},[]);const m=()=>{const e=Ht();n(e);const t=Gt();c(t)},h=e=>{const t=Date.now()-e,s=Math.floor(t/6e4),a=Math.floor(t/36e5),r=Math.floor(t/864e5);if(s<1)return"刚刚";if(s<60)return`${s}分钟前`;if(a<24)return`${a}小时前`;if(r<7)return`${r}天前`;const l=new Date(e);return`${l.getMonth()+1}-${l.getDate()}`},u=t=>{switch(t){case"like":return e.jsx("div",{className:"w-10 h-10 bg-red-50 rounded-full flex items-center justify-center",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",className:"text-red-500",children:e.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})})});case"comment":return e.jsx("div",{className:"w-10 h-10 bg-blue-50 rounded-full flex items-center justify-center",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-blue-500",children:e.jsx("path",{d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})});case"follow":return e.jsx("div",{className:"w-10 h-10 bg-green-50 rounded-full flex items-center justify-center",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-green-500",children:e.jsx("path",{d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})});default:return null}};return e.jsxs("div",{className:"h-screen flex flex-col bg-[#f7f7f7]",children:[e.jsxs("div",{className:"glass-effect border-b border-white/30 shadow-sm flex-shrink-0",children:[r&&e.jsx(xa,{}),e.jsxs("div",{className:"px-4 py-2.5 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a("/forum"),className:"w-9 h-9 flex items-center justify-center active:opacity-60",children:e.jsx(ls,{size:22,className:"text-gray-800"})}),e.jsx("h1",{className:"text-[17px] font-semibold text-gray-900",children:"消息"}),e.jsx("div",{className:"w-9"})]}),e.jsx("div",{className:"flex items-center px-4 pb-2.5",children:[{key:"all",label:"全部"},{key:"like",label:"赞"},{key:"comment",label:"评论"},{key:"dm",label:"私信"}].map(t=>e.jsxs("button",{onClick:()=>x(t.key),className:"px-3 py-1.5 text-[14px] rounded-full transition-all mr-3 "+(d===t.key?"bg-[#ff6c00] text-white font-medium":"text-gray-700 hover:bg-gray-100"),children:[t.label,"dm"===t.key&&qt()>0&&e.jsx("span",{className:"ml-1 px-1.5 py-0.5 bg-red-500 text-white text-[11px] rounded-full",children:qt()})]},t.key))})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:"dm"===d?0===i.length?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-gray-400",children:[e.jsx("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",className:"mb-4 opacity-30",children:e.jsx("path",{d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),e.jsx("p",{className:"text-[14px]",children:"暂无私信"})]}):e.jsx("div",{children:i.map(t=>e.jsxs("div",{className:"flex items-start gap-3 p-4 border-b border-gray-50 active:bg-gray-50 cursor-pointer "+(t.isRead?"":"bg-blue-50/30"),onClick:()=>{Kt(t.id),m()},children:[e.jsx("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-gray-100 flex-shrink-0 flex items-center justify-center text-xl",children:t.fromUserAvatar}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-[14px] text-gray-900",children:t.fromUserName}),e.jsx("span",{className:"text-[12px] text-gray-400",children:h(t.timestamp)})]}),e.jsx("div",{className:"text-[13px] text-gray-600 line-clamp-2",children:t.content})]}),!t.isRead&&e.jsx("div",{className:"w-2 h-2 bg-[#ff6c00] rounded-full mt-2"})]},t.id))}):0===l.length?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-gray-400",children:[e.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",className:"mb-4 opacity-30",children:[e.jsx("path",{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}),e.jsx("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"})]}),e.jsx("p",{className:"text-[14px]",children:"暂无消息"})]}):e.jsx("div",{children:l.filter(e=>"all"===d||e.type===d).map(t=>e.jsxs("div",{className:"flex items-start gap-3 p-4 border-b border-gray-50 active:bg-gray-50 "+(t.isRead?"":"bg-orange-50/30"),onClick:()=>t.postId&&a(`/forum/post/${t.postId}`),children:[u(t.type),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-[14px] text-gray-900",children:t.fromUserName}),e.jsx("span",{className:"text-[12px] text-gray-400",children:h(t.timestamp)})]}),e.jsx("div",{className:"text-[13px] text-gray-600",children:t.content})]}),!t.isRead&&e.jsx("div",{className:"w-2 h-2 bg-[#ff6c00] rounded-full mt-2"})]},t.id))})}),e.jsxs("div",{className:"bg-white border-t border-gray-100 flex items-center justify-around py-2",children:[e.jsxs("button",{onClick:()=>a("/forum"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"首页"})]}),e.jsxs("button",{onClick:()=>a("/forum/topics"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M7 20l4-16m2 16l4-16M6 9h14M4 15h14",strokeLinecap:"round"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"话题"})]}),e.jsx("button",{onClick:()=>a("/forum/publish"),className:"flex flex-col items-center -mt-3 active:scale-95 transition-transform",children:e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-[#ff8140] to-[#ff6c00] rounded-full flex items-center justify-center shadow-lg",children:e.jsx(rs,{size:24,className:"text-white"})})}),e.jsxs("button",{className:"flex flex-col items-center gap-1 py-1",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",className:"text-[#ff6c00]",children:e.jsx("path",{d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})}),e.jsx("span",{className:"text-[11px] text-[#ff6c00] font-medium",children:"消息"})]}),e.jsxs("button",{onClick:()=>a("/forum/profile"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"我"})]})]})]})}},Symbol.toStringTag,{value:"Module"})),bn=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),{posts:l,getDrafts:n,toggleLike:i,toggleFavorite:c}=y(),[d,x]=t.useState("posts"),[m,h]=t.useState([]),[u,g]=t.useState([]),[p,f]=t.useState([]),[b,j]=t.useState(!1),[v,N]=t.useState("name"),[w,k]=t.useState(""),C=t.useRef(null),[S,I]=t.useState(()=>{const e=localStorage.getItem("forum_user_info");if(e)try{return JSON.parse(e)}catch{return{id:"user_current",name:"我的昵称",avatar:"",bio:"这是我的个人简介",followersCount:128,followingCount:256,postsCount:89}}return{id:"user_current",name:"我的昵称",avatar:"",bio:"这是我的个人简介",followersCount:128,followingCount:256,postsCount:89}}),_=e=>{I(e),localStorage.setItem("forum_user_info",JSON.stringify(e))};t.useEffect(()=>{M()},[d]);const M=()=>{const e=Xt(),t=l.filter(e=>e.authorId===S.id);h(t);const s=l.filter(e=>e.isFavorited);g(s);const a=n();f(a),I(t=>({...t,followersCount:e.followers,followingCount:e.following,postsCount:e.posts}))},z=e=>{var t;N(e),"avatar"===e?null==(t=C.current)||t.click():(k("name"===e?S.name:S.bio),j(!0))};return e.jsxs("div",{className:"h-screen flex flex-col bg-[#f7f7f7]",children:[e.jsxs("div",{className:"glass-effect border-b border-white/30 shadow-sm flex-shrink-0",children:[r&&e.jsx(xa,{}),e.jsxs("div",{className:"px-4 py-2.5 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a("/forum"),className:"w-9 h-9 flex items-center justify-center active:opacity-60",children:e.jsx(ls,{size:22,className:"text-gray-800"})}),e.jsx("h1",{className:"text-[17px] font-semibold text-gray-900",children:"我的"}),e.jsx("button",{className:"w-9 h-9 flex items-center justify-center active:opacity-60",children:e.jsx(Ns,{size:20,className:"text-gray-800"})})]})]}),e.jsxs("div",{className:"bg-white p-4 mb-2",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[e.jsxs("button",{onClick:()=>z("avatar"),className:"relative w-20 h-20 rounded-full overflow-hidden bg-gradient-to-br from-orange-400 to-pink-400 flex items-center justify-center flex-shrink-0 active:opacity-80",children:[S.avatar?e.jsx("img",{src:S.avatar,alt:"头像",className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-3xl font-bold text-white",children:S.name[0]}),e.jsx("div",{className:"absolute inset-0 bg-black/20 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity",children:e.jsx(ks,{size:24,className:"text-white"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("button",{onClick:()=>z("name"),className:"flex items-center gap-2 mb-2 active:opacity-60",children:[e.jsx("span",{className:"text-[18px] font-semibold text-gray-900",children:S.name}),e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-400",children:e.jsx("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z",strokeLinecap:"round"})})]}),e.jsx("button",{onClick:()=>z("bio"),className:"text-left w-full active:opacity-60",children:e.jsxs("div",{className:"text-[13px] text-gray-500 line-clamp-2 flex items-start gap-1",children:[e.jsx("span",{className:"flex-1",children:S.bio}),e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-400 mt-0.5 flex-shrink-0",children:e.jsx("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z",strokeLinecap:"round"})})]})})]})]}),e.jsxs("div",{className:"flex items-center gap-6 pt-3 border-t border-gray-50",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[18px] font-semibold text-gray-900",children:S.followingCount}),e.jsx("div",{className:"text-[12px] text-gray-500",children:"关注"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[18px] font-semibold text-gray-900",children:S.followersCount}),e.jsx("div",{className:"text-[12px] text-gray-500",children:"粉丝"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[18px] font-semibold text-gray-900",children:m.length}),e.jsx("div",{className:"text-[12px] text-gray-500",children:"微博"})]})]})]}),e.jsx("div",{className:"bg-white mb-2",children:e.jsxs("button",{onClick:()=>a("/forum/memes"),className:"w-full px-4 py-3.5 flex items-center justify-between active:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-full bg-gradient-to-br from-orange-400 to-pink-400 flex items-center justify-center",children:e.jsx("span",{className:"text-lg",children:"🎭"})}),e.jsx("span",{className:"text-[15px] text-gray-900",children:"梗库管理"})]}),e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-400",children:e.jsx("path",{d:"M9 18l6-6-6-6",strokeLinecap:"round",strokeLinejoin:"round"})})]})}),e.jsx("input",{ref:C,type:"file",accept:"image/*",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(!s)return;const a=new FileReader;a.onload=e=>{var t;if(null==(t=e.target)?void 0:t.result){const t={...S,avatar:e.target.result};_(t)}},a.readAsDataURL(s)},className:"hidden"}),b&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-sm p-4",children:[e.jsx("h3",{className:"text-[17px] font-semibold text-gray-900 mb-3",children:"name"===v?"修改昵称":"修改个性签名"}),"name"===v?e.jsx("input",{type:"text",value:w,onChange:e=>k(e.target.value),maxLength:20,placeholder:"请输入昵称",className:"w-full px-3 py-2.5 border border-gray-200 rounded-lg text-[15px] outline-none focus:border-[#ff6c00]",autoFocus:!0}):e.jsx("textarea",{value:w,onChange:e=>k(e.target.value),maxLength:100,placeholder:"请输入个性签名",className:"w-full px-3 py-2.5 border border-gray-200 rounded-lg text-[15px] outline-none focus:border-[#ff6c00] resize-none",rows:3,autoFocus:!0}),e.jsxs("div",{className:"flex items-center justify-between mt-2 text-[12px] text-gray-400",children:[e.jsx("span",{children:"name"===v?"最多20个字":"最多100个字"}),e.jsxs("span",{children:[w.length,"/","name"===v?20:100]})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx("button",{onClick:()=>{j(!1),k("")},className:"flex-1 py-2.5 text-[15px] text-gray-700 border border-gray-200 rounded-full active:bg-gray-50",children:"取消"}),e.jsx("button",{onClick:()=>{if(!w.trim())return;const e={...S,[v]:w.trim()};_(e),j(!1),k("")},disabled:!w.trim(),className:"flex-1 py-2.5 text-[15px] rounded-full "+(w.trim()?"bg-[#ff6c00] text-white active:opacity-80":"bg-gray-200 text-gray-400"),children:"保存"})]})]})}),e.jsx("div",{className:"bg-white flex items-center",children:[{key:"posts",label:"微博"},{key:"favorites",label:"收藏"},{key:"drafts",label:"草稿"}].map(t=>e.jsxs("button",{onClick:()=>x(t.key),className:"flex-1 py-3 text-center relative "+(d===t.key?"text-[#ff6c00] font-medium":"text-gray-600"),children:[t.label,d===t.key&&e.jsx("div",{className:"absolute bottom-0 left-1/2 transform -translate-x-1/2 w-6 h-[3px] bg-[#ff6c00] rounded-t-full"})]},t.key))}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:"posts"===d?0===m.length?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-gray-400",children:[e.jsx("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",className:"mb-4 opacity-30",children:e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",strokeWidth:"2"})}),e.jsx("p",{className:"text-[14px] mb-4",children:"还没有发布内容"}),e.jsx("button",{onClick:()=>a("/forum/publish"),className:"px-6 py-2.5 bg-[#ff6c00] text-white rounded-full text-[14px] active:opacity-80",children:"发布第一条微博"})]}):e.jsx("div",{children:m.map(t=>e.jsx(an,{post:t,onLike:i,onComment:e=>a(`/forum/post/${e}`),onFavorite:c},t.id))}):"favorites"===d?0===u.length?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-gray-400",children:[e.jsx("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",className:"mb-4 opacity-30",children:e.jsx("path",{d:"M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z",strokeWidth:"2"})}),e.jsx("p",{className:"text-[14px]",children:"暂无收藏"})]}):e.jsx("div",{children:u.map(t=>e.jsx(an,{post:t,onLike:i,onComment:e=>a(`/forum/post/${e}`),onFavorite:c},t.id))}):0===p.length?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-gray-400",children:[e.jsx("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",className:"mb-4 opacity-30",children:e.jsx("path",{d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z",strokeWidth:"2"})}),e.jsx("p",{className:"text-[14px]",children:"暂无草稿"})]}):e.jsx("div",{children:p.map(t=>e.jsxs("div",{className:"bg-white mb-2 p-4 active:bg-gray-50",onClick:()=>{alert("草稿编辑功能开发中")},children:[e.jsx("div",{className:"text-[14px] text-gray-800 line-clamp-3 mb-2",children:t.content}),e.jsxs("div",{className:"text-[12px] text-gray-400",children:["保存于 ",new Date(t.timestamp).toLocaleString()]})]},t.id))})}),e.jsxs("div",{className:"bg-white border-t border-gray-100 flex items-center justify-around py-2",children:[e.jsxs("button",{onClick:()=>a("/forum"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"首页"})]}),e.jsxs("button",{onClick:()=>a("/forum/topics"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M7 20l4-16m2 16l4-16M6 9h14M4 15h14",strokeLinecap:"round"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"话题"})]}),e.jsx("button",{onClick:()=>a("/forum/publish"),className:"flex flex-col items-center -mt-3 active:scale-95 transition-transform",children:e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-[#ff8140] to-[#ff6c00] rounded-full flex items-center justify-center shadow-lg",children:e.jsx(rs,{size:24,className:"text-white"})})}),e.jsxs("button",{onClick:()=>a("/forum/notifications"),className:"flex flex-col items-center gap-1 py-1 active:opacity-60",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-600",children:e.jsx("path",{d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("span",{className:"text-[11px] text-gray-600",children:"消息"})]}),e.jsxs("button",{className:"flex flex-col items-center gap-1 py-1",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",className:"text-[#ff6c00]",children:e.jsx("path",{d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),e.jsx("span",{className:"text-[11px] text-[#ff6c00] font-medium",children:"我"})]})]})]})}},Symbol.toStringTag,{value:"Module"})),jn=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{userId:l}=r(),{showStatusBar:n}=o(),[i,c]=t.useState(null),[d,x]=t.useState([]);t.useEffect(()=>{if(!l)return;const e=JSON.parse(localStorage.getItem("forum_npc_users")||"[]").find(e=>e.id===l);if(e){c(e);const t=JSON.parse(localStorage.getItem("forum_topics_list")||"[]"),s=[];t.forEach(e=>{if(e.posts){const t=e.posts.filter(e=>e.authorId===l);s.push(...t.map(t=>({...t,topicName:e.name})))}}),x(s)}},[l]);return i?e.jsxs("div",{className:"h-screen flex flex-col bg-[#f7f7f7]",children:[e.jsxs("div",{className:"glass-effect border-b border-white/30 shadow-sm flex-shrink-0",children:[n&&e.jsx(xa,{}),e.jsxs("div",{className:"px-4 py-2.5 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>a(-1),className:"w-9 h-9 flex items-center justify-center active:opacity-60",children:e.jsx(ls,{size:22,className:"text-gray-800"})}),e.jsx("h1",{className:"text-[17px] font-semibold text-gray-900",children:"个人主页"}),e.jsx("button",{className:"w-9 h-9 flex items-center justify-center active:opacity-60",children:e.jsx(As,{size:20,className:"text-gray-800"})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"bg-white p-4 mb-2",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-orange-400 to-pink-400 flex items-center justify-center text-2xl flex-shrink-0",children:i.avatar||i.name[0]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-[18px] font-semibold text-gray-900 mb-1",children:i.name}),e.jsx("p",{className:"text-[14px] text-gray-600",children:i.bio||"这个人很懒，什么都没留下"})]})]}),e.jsxs("div",{className:"flex items-center gap-6 mb-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[18px] font-semibold text-gray-900",children:i.following}),e.jsx("div",{className:"text-[12px] text-gray-500",children:"关注"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[18px] font-semibold text-gray-900",children:i.followers}),e.jsx("div",{className:"text-[12px] text-gray-500",children:"粉丝"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[18px] font-semibold text-gray-900",children:d.length}),e.jsx("div",{className:"text-[12px] text-gray-500",children:"帖子"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"flex-1 py-2 bg-gray-100 text-gray-700 text-[14px] font-medium rounded-full active:bg-gray-200",children:"关注"}),e.jsx("button",{onClick:()=>{i&&(localStorage.setItem("forum_dm_target",JSON.stringify({id:i.id,name:i.name,avatar:i.avatar,posts:d.map(e=>({content:e.content,topicName:e.topicName,timestamp:e.timestamp}))})),alert(`即将私信 ${i.name}，功能开发中...`))},className:"flex-1 py-2 bg-[#ff6c00] text-white text-[14px] font-medium rounded-full active:opacity-80",children:"私信"})]})]}),e.jsxs("div",{className:"bg-white",children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-50",children:e.jsxs("span",{className:"text-[15px] font-medium text-gray-900",children:["TA的帖子 (",d.length,")"]})}),0===d.length?e.jsx("div",{className:"py-20 text-center text-gray-400 text-[14px]",children:"暂无帖子"}):e.jsx("div",{children:d.map(t=>e.jsxs("div",{className:"p-4 border-b border-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-[12px] text-gray-500",children:[e.jsxs("span",{children:["#",t.topicName]}),e.jsx("span",{children:"·"}),e.jsx("span",{children:new Date(t.timestamp).toLocaleDateString()})]}),e.jsx("div",{className:"text-[15px] text-gray-800 leading-relaxed",children:t.content}),t.comments&&e.jsxs("div",{className:"mt-2 text-[13px] text-gray-500",children:["💬 ",t.comments.length," 评论"]})]},t.id))})]})]})]}):e.jsx("div",{className:"h-screen flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400",children:"用户不存在"})})}},Symbol.toStringTag,{value:"Module"})),vn=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=s(),{showStatusBar:r}=o(),[l,n]=t.useState([]);return t.useEffect(()=>{n(pt)},[]),e.jsxs("div",{className:"h-screen flex flex-col bg-[#f7f7f7]",children:[r&&e.jsx(xa,{}),e.jsx("div",{className:"glass-effect border-b border-white/30 shadow-sm flex-shrink-0",children:e.jsxs("div",{className:"px-4 py-3 flex items-center gap-3",children:[e.jsx("button",{onClick:()=>a(-1),className:"w-9 h-9 flex items-center justify-center active:opacity-60",children:e.jsx(ls,{size:22,className:"text-gray-800"})}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"梗库"})]})}),e.jsxs("div",{className:"px-4 py-3 bg-blue-50 border-b border-blue-100",children:[e.jsx("p",{className:"text-sm text-blue-800 mb-2",children:"💡 论坛与微信共享梗库，AI生成论坛内容时会自然融入这些梗"}),e.jsx("button",{onClick:()=>a("/settings-new"),className:"text-sm text-[#ff6c00] font-medium active:opacity-60",children:"→ 前往设置管理梗库"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"bg-white p-4",children:[e.jsxs("h2",{className:"text-sm font-semibold text-gray-900 mb-3",children:["当前梗库 (",l.length,"个)"]}),0===l.length?e.jsx("div",{className:"py-8 text-center text-gray-400 text-sm",children:"暂无梗，去设置里添加吧~"}):e.jsx("div",{className:"space-y-3",children:l.map(t=>e.jsxs("div",{className:"p-3 bg-gradient-to-r from-orange-50 to-pink-50 rounded-lg border border-orange-100",children:[e.jsx("div",{className:"text-base font-medium text-gray-900 mb-1",children:t["梗"]}),e.jsx("div",{className:"text-sm text-gray-600",children:t["含义"]})]},t.id))})]})})]})}},Symbol.toStringTag,{value:"Module"}));export{rl as $,sr as A,Ar as B,Yt as C,ts as D,er as E,Dr as F,Br as G,Er as H,_r as I,Or as J,Wr as K,Rr as L,cs as M,Ur as N,Vr as O,ss as P,qr as Q,Mr as R,is as S,Nr as T,ir as U,Kr as V,gr as W,Yr as X,el as Y,al as Z,Qt as _,es as a,ll as a0,nl as a1,il as a2,cl as a3,ol as a4,dl as a5,xl as a6,ml as a7,hl as a8,ul as a9,nn as aA,cn as aB,dn as aC,mn as aD,hn as aE,un as aF,gn as aG,pn as aH,fn as aI,bn as aJ,jn as aK,vn as aL,gl as aa,pl as ab,fl as ac,_l as ad,Ml as ae,zl as af,$l as ag,Al as ah,Tl as ai,El as aj,Pl as ak,Ol as al,Wl as am,Rl as an,Vl as ao,Jl as ap,Kl as aq,Xl as ar,Zl as as,Ql as at,Yl as au,en as av,tn as aw,sn as ax,rn as ay,ln as az,ma as b,ha as c,fa as d,ba as e,Va as f,Ha as g,Ga as h,qa as i,Qa as j,Ya as k,tr as l,ar as m,rr as n,lr as o,nr as p,cr as q,or as r,dr as s,pr as t,yr as u,Sr as v,Ir as w,zr as x,$r as y,Lr as z};
