var e=Object.defineProperty,t=(t,n,r)=>((t,n,r)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r)(t,"symbol"!=typeof n?n+"":n,r);import"./react-vendor-D8ofYTc3.js";import{_ as n}from"./pages-CWX6yoiT.js";"undefined"!=typeof window&&(window.clearAllAvatarCache=function(){const e=[];for(let t=0;t<localStorage.length;t++){const n=localStorage.key(t);n&&(n.includes("avatar_description")||n.includes("avatar_fingerprint")||n.includes("avatar_recognized_at"))&&e.push(n)}return e.forEach(e=>{localStorage.removeItem(e)}),e.length},window.clearUserAvatarCache=function(e){localStorage.removeItem(`user_avatar_description_${e}`),localStorage.removeItem(`user_avatar_fingerprint_${e}`),localStorage.removeItem(`user_avatar_recognized_at_${e}`)},window.clearCharacterAvatarCache=function(e){localStorage.removeItem(`character_avatar_description_${e}`),localStorage.removeItem(`character_avatar_fingerprint_${e}`),localStorage.removeItem(`character_avatar_recognized_at_${e}`)});const r={MOMENTS:"moments",CHAT_MESSAGES:"chat_messages",GROUP_MESSAGES:"group_messages",EMOJIS:"emojis",SETTINGS:"settings"};let a=null;async function o(){return a||new Promise((e,t)=>{const n=indexedDB.open("WeChatAppDB",3);let o=!1;const s=setTimeout(()=>{o||(o=!0,t(new Error("IndexedDB åˆå§‹åŒ–è¶…æ—¶")))},1e4);n.onerror=()=>{o||(o=!0,clearTimeout(s),t(n.error))},n.onblocked=()=>{},n.onsuccess=()=>{o||(o=!0,clearTimeout(s),a=n.result,e(a))},n.onupgradeneeded=e=>{const t=e.target.result;e.oldVersion;if(!t.objectStoreNames.contains(r.MOMENTS)){const e=t.createObjectStore(r.MOMENTS,{keyPath:"id"});e.createIndex("createdAt","createdAt",{unique:!1}),e.createIndex("userId","userId",{unique:!1})}if(!t.objectStoreNames.contains(r.CHAT_MESSAGES)){t.createObjectStore(r.CHAT_MESSAGES,{keyPath:"key"}).createIndex("characterId","characterId",{unique:!1})}if(!t.objectStoreNames.contains(r.GROUP_MESSAGES)){t.createObjectStore(r.GROUP_MESSAGES,{keyPath:"key"}).createIndex("groupId","groupId",{unique:!1})}if(!t.objectStoreNames.contains(r.EMOJIS)){t.createObjectStore(r.EMOJIS,{keyPath:"id"}).createIndex("addTime","addTime",{unique:!1})}t.objectStoreNames.contains(r.SETTINGS)||t.createObjectStore(r.SETTINGS,{keyPath:"key"})}})}async function s(e,t){try{const n=(await o()).transaction([e],"readwrite");return n.objectStore(e).put(t),new Promise((e,t)=>{n.oncomplete=()=>{e(!0)},n.onerror=()=>{t(n.error)}})}catch(n){return!1}}async function i(e,t){try{const n=(await o()).transaction([e],"readonly"),r=n.objectStore(e).get(t);return new Promise((e,t)=>{r.onsuccess=()=>{e(r.result||null)},r.onerror=()=>{t(r.error)}})}catch(n){return null}}async function c(){try{if("storage"in navigator&&"estimate"in navigator.storage){const e=await navigator.storage.estimate(),t=e.usage||0,n=e.quota||0,r=n>0?t/n*100:0;return{used:Math.round(t/1024/1024),quota:Math.round(n/1024/1024),percentage:Math.round(r)}}}catch(e){}return{used:0,quota:0,percentage:0}}async function l(){try{const e=await o(),t=e.transaction([r.CHAT_MESSAGES],"readwrite").objectStore(r.CHAT_MESSAGES),n=await t.getAll();for(const r of n)r.messages&&r.messages.length>2e3&&(r.messages=r.messages.slice(-2e3),await t.put(r));const a=e.transaction([r.GROUP_MESSAGES],"readwrite").objectStore(r.GROUP_MESSAGES),s=await a.getAll();for(const r of s)r.messages&&r.messages.length>1e3&&(r.messages=r.messages.slice(-1e3),await a.put(r))}catch(e){}}const u=Object.freeze(Object.defineProperty({__proto__:null,STORES:r,cleanupOldIndexedDBData:l,getIndexedDBItem:i,getIndexedDBUsage:c,initDB:o,initPeriodicCleanup:function(){const e=6048e5,t=localStorage.getItem("last_indexeddb_cleanup"),n=Date.now();if(!t||n-parseInt(t)>e)l().then(()=>{localStorage.setItem("last_indexeddb_cleanup",n.toString())}).catch(e=>{});else{parseInt(t)}},setIndexedDBItem:s},Symbol.toStringTag,{value:"Module"}));"undefined"!=typeof window&&(window.emergencyCleanup=async function(){try{const t=localStorage.getItem("chatList");if(t)try{const e=JSON.parse(t);await s(r.SETTINGS,{key:"chatList",chats:e}),localStorage.removeItem("chatList")}catch(e){}const n=[];for(let e=0;e<localStorage.length;e++){const t=localStorage.key(e);t&&t.startsWith("group_messages_")&&n.push(t)}for(const c of n)try{const e=localStorage.getItem(c);if(e){const t=JSON.parse(e),n=c.replace("group_messages_",""),a=t.slice(-500);await s(r.GROUP_MESSAGES,{key:c,groupId:n,messages:a,lastUpdated:Date.now()}),localStorage.removeItem(c)}}catch(e){}const a=[];for(let e=0;e<localStorage.length;e++){const t=localStorage.key(e);t&&t.startsWith("chat_messages_")&&a.push(t)}for(const c of a)try{const e=localStorage.getItem(c);if(e){const t=JSON.parse(e),n=c.replace("chat_messages_",""),a=t.slice(-1e3);await s(r.CHAT_MESSAGES,{key:c,characterId:n,messages:a}),localStorage.removeItem(c)}}catch(e){}let o=0;for(let e=0;e<localStorage.length;e++){const t=localStorage.key(e);if(t){const e=localStorage.getItem(t);e&&(o+=t.length+e.length)}}const i=(o/1024/1024).toFixed(2);alert(`âœ… æ¸…ç†å®Œæˆï¼\n\nå·²è¿ç§»æ•°æ®åˆ° IndexedDB\nlocalStorage ä½¿ç”¨: ${i} MB\n\nè¯·åˆ·æ–°é¡µé¢`)}catch(e){alert("âŒ æ¸…ç†å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°")}}),"undefined"!=typeof window&&(window.checkStorage=function(){let e=0;const t=[];for(let n=0;n<localStorage.length;n++){const r=localStorage.key(n);if(r){const n=localStorage.getItem(r);if(n){const a=r.length+n.length;e+=a,t.push({key:r,size:a})}}}t.sort((e,t)=>t.size-e.size),t.slice(0,10).forEach((e,t)=>{(e.size/1024/1024).toFixed(2)})});const m=new class{constructor(){t(this,"listeners",new Set),t(this,"currentNotification",null)}show(e){const t={id:`notification_${Date.now()}`,...e};return this.currentNotification=t,this.notifyListeners(),t.id}close(){this.currentNotification=null,this.notifyListeners()}getCurrent(){return this.currentNotification}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}notifyListeners(){this.listeners.forEach(e=>e(this.currentNotification))}};let d=[],h=null;function g(e){for(h=e;d.length>0;){const t=d.shift();t&&e(t)}}function p(e){h?h(e):d.push(e)}function f(){p({title:"è®ºå›",subtitle:"æ­£åœ¨åˆå§‹åŒ–",message:"æ­£åœ¨ç”Ÿæˆè®ºå›å†…å®¹ï¼Œè¯·ç¨å€™...",type:"init"})}function y(e){p({title:"è®ºå›",subtitle:"åˆå§‹åŒ–ä¸­",message:e,type:"init"})}function w(){p({title:"è®ºå›",subtitle:"åˆå§‹åŒ–å®Œæˆ",message:"è®ºå›å·²å‡†å¤‡å°±ç»ªï¼Œå¿«å»çœ‹çœ‹å§ï¼",type:"system"})}const S={API_SETTINGS:"apiSettings"},I=(e,t)=>{try{const n=localStorage.getItem(e);return n?JSON.parse(n):t}catch{return t}},_=async(e,t)=>{const r=JSON.stringify(t);try{return localStorage.setItem(e,r),!0}catch(a){if(a instanceof Error&&"QuotaExceededError"===a.name){v();try{return localStorage.setItem(e,r),!0}catch(o){try{const{setIndexedDBItem:r}=await n(async()=>{const{setIndexedDBItem:e}=await Promise.resolve().then(()=>u);return{setIndexedDBItem:e}},void 0);let a="settings";return e.startsWith("chat_messages_")?a="chat_messages":e.startsWith("group_messages_")?a="group_messages":"moments"===e&&(a="moments"),await r(a,{key:e,value:t}),sessionStorage.getItem("indexeddb_fallback_notified")||sessionStorage.setItem("indexeddb_fallback_notified","true"),!0}catch(s){return alert("å­˜å‚¨ç©ºé—´ä¸¥é‡ä¸è¶³ï¼\n\nè¯·æ¸…ç†æµè§ˆå™¨æ•°æ®æˆ–åˆ é™¤ä¸€äº›èŠå¤©è®°å½•ã€‚"),!1}}}return!1}},k=()=>{try{let t=0;const n=Date.now(),r=36e5,a=["temp_","cache_","preview_"];for(let o=localStorage.length-1;o>=0;o--){const s=localStorage.key(o);if(s&&a.some(e=>s.startsWith(e)))try{const e=localStorage.getItem(s);if(e){const a=JSON.parse(e);a.timestamp&&n-a.timestamp>r?(localStorage.removeItem(s),t++):a.timestamp||(localStorage.removeItem(s),t++)}}catch(e){localStorage.removeItem(s),t++}}}catch(t){}};let $=0;const v=()=>{try{const e=b();e.percentage;const t=Date.now();e.percentage>90&&t-$>3e4&&($=t,k())}catch(e){}},b=()=>{let e=0;try{for(let t=0;t<localStorage.length;t++){const n=localStorage.key(t);if(n){const t=localStorage.getItem(n);t&&(e+=n.length+t.length)}}}catch(r){}const t=52428800,n=e/t*100;return{used:Math.round(e/1024),total:Math.round(51200),percentage:Math.round(10*n)/10}},A=()=>{k();try{const e=[];for(let t=0;t<localStorage.length;t++){const n=localStorage.key(t);n&&(n.includes("moments")||n.includes("ai_moments"))&&e.push(n)}e.forEach(e=>{try{const t=JSON.parse(localStorage.getItem(e)||"[]");if(Array.isArray(t)&&t.length>200){const n=t.slice(-200);localStorage.setItem(e,JSON.stringify(n))}}catch(t){}})}catch(e){}},N=()=>{try{for(let t=0;t<localStorage.length;t++){const n=localStorage.key(t);if(n&&n.startsWith("chat_messages_"))try{const e=JSON.parse(localStorage.getItem(n)||"[]").map(e=>({id:e.id,content:e.content,sender:e.sender,timestamp:e.timestamp,type:e.type||"text"}));localStorage.setItem(n,JSON.stringify(e))}catch(e){}}}catch(t){}},O={CHARACTERS:"characters",CHATS:"chats",MESSAGES:"messages",SETTINGS:"settings",LOREBOOKS:"lorebooks",MOMENTS:"moments",GROUPS:"groups",EMOJIS:"emojis"};function x(){return new Promise((e,t)=>{const n=indexedDB.open("WeChatAppDB",1);n.onerror=()=>t(n.error),n.onsuccess=()=>e(n.result),n.onupgradeneeded=e=>{const t=e.target.result;if(!t.objectStoreNames.contains(O.CHARACTERS)){t.createObjectStore(O.CHARACTERS,{keyPath:"id"}).createIndex("name","name",{unique:!1})}if(!t.objectStoreNames.contains(O.CHATS)){const e=t.createObjectStore(O.CHATS,{keyPath:"id"});e.createIndex("characterId","characterId",{unique:!1}),e.createIndex("lastMessageTime","lastMessageTime",{unique:!1})}if(!t.objectStoreNames.contains(O.MESSAGES)){const e=t.createObjectStore(O.MESSAGES,{keyPath:"id"});e.createIndex("chatId","chatId",{unique:!1}),e.createIndex("timestamp","timestamp",{unique:!1})}if(t.objectStoreNames.contains(O.SETTINGS)||t.createObjectStore(O.SETTINGS,{keyPath:"key"}),!t.objectStoreNames.contains(O.LOREBOOKS)){t.createObjectStore(O.LOREBOOKS,{keyPath:"id"}).createIndex("name","name",{unique:!1})}if(!t.objectStoreNames.contains(O.MOMENTS)){const e=t.createObjectStore(O.MOMENTS,{keyPath:"id"});e.createIndex("characterId","characterId",{unique:!1}),e.createIndex("timestamp","timestamp",{unique:!1})}if(t.objectStoreNames.contains(O.GROUPS)||t.createObjectStore(O.GROUPS,{keyPath:"id"}),!t.objectStoreNames.contains(O.EMOJIS)){t.createObjectStore(O.EMOJIS,{keyPath:"id"}).createIndex("addTime","addTime",{unique:!1})}}})}let M=null;async function C(){return M||(M=await x(),M)}async function E(e,t){const n=await C();return new Promise((r,a)=>{const o=n.transaction(e,"readwrite").objectStore(e).put(t);o.onsuccess=()=>r(),o.onerror=()=>a(o.error)})}async function D(e){const t=await C();return new Promise((n,r)=>{const a=t.transaction(e,"readonly").objectStore(e).getAll();a.onsuccess=()=>n(a.result||[]),a.onerror=()=>r(a.error)})}async function j(e,t){const n=await C();return new Promise((r,a)=>{const o=n.transaction(e,"readwrite").objectStore(e).delete(t);o.onsuccess=()=>r(),o.onerror=()=>a(o.error)})}async function T(e){const t=await C();return new Promise((n,r)=>{const a=t.transaction(e,"readwrite").objectStore(e).clear();a.onsuccess=()=>n(),a.onerror=()=>r(a.error)})}const P=Object.freeze(Object.defineProperty({__proto__:null,STORES:O,clearStore:T,deleteItem:j,getAllItems:D,getItem:async function(e,t){const n=await C();return new Promise((r,a)=>{const o=n.transaction(e,"readonly").objectStore(e).get(t);o.onsuccess=()=>r(o.result||null),o.onerror=()=>a(o.error)})},initDB:x,setItem:E},Symbol.toStringTag,{value:"Module"})),J=new Map;async function B(e,t,n=3e4){try{const e=t.body?JSON.parse(t.body):{};if(e.max_tokens&&e.max_tokens>2e3&&(n=6e4),e.messages&&Array.isArray(e.messages)){e.messages.some(e=>Array.isArray(e.content)&&e.content.some(e=>"image_url"===e.type))&&(n=6e4)}}catch(o){}const r=new AbortController,a=setTimeout(()=>r.abort(),n);try{const n=await fetch(e,{...t,signal:r.signal});return clearTimeout(a),n}catch(s){if(clearTimeout(a),"AbortError"===s.name)throw new Error(`è¯·æ±‚è¶…æ—¶ (${n}ms)`);throw s}}async function L(e,t){let n=t.baseUrl.replace(/\/$/,"");const r=n.endsWith("/v1")?"/chat/completions":"/v1/chat/completions",a=`${n}${r}`,o=await B(a,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.apiKey}`},body:JSON.stringify({model:t.model||"gpt-3.5-turbo",messages:e,temperature:t.temperature??.7,max_tokens:t.maxTokens||2e3})},3e5);if(!o.ok){const e=await o.text();if(401===o.status||403===o.status)throw new Error(`APIè®¤è¯å¤±è´¥ (${o.status})ï¼Œè¯·æ£€æŸ¥APIå¯†é’¥`);if(400===o.status&&(e.includes("VLM")||e.includes("Vision")||e.includes("image")||e.includes("multimodal")))throw new Error("VISION_NOT_SUPPORTED");throw new Error(`APIè°ƒç”¨å¤±è´¥ (${o.status})`)}const s=await o.json();if(!s.choices||!s.choices[0]||!s.choices[0].message)throw new Error("APIå“åº”æ ¼å¼é”™è¯¯");return s.choices[0].message.content}async function z(e,t){let n=t.model||"gemini-1.5-flash",r=t.baseUrl.replace(/\/$/,"");const a=r.includes("workers.dev")||r.includes("cloudflare")||r.includes("netlify/functions");a||r.includes("/v1")||r.endsWith("v1beta")||(r=`${r}/v1beta`),n.startsWith("models/")&&(n=n.replace("models/",""));const o=a?`${r}/v1beta/models/${n}:generateContent`:`${r}/models/${n}:generateContent?key=${t.apiKey}`,s=[];let i="";for(const m of e){if("system"===m.role){i="string"==typeof m.content?m.content:"";continue}const e=[];if(i&&"user"===m.role&&(e.push({text:i}),i=""),"string"==typeof m.content)e.push({text:m.content});else if(Array.isArray(m.content))for(const t of m.content)if("text"===t.type&&t.text)e.push({text:t.text});else if("image_url"===t.type&&t.image_url){const n=t.image_url.url;if(n.startsWith("data:image")){const t=n.match(/data:image\/(\w+);base64,(.+)/);t&&e.push({inline_data:{mime_type:`image/${t[1]}`,data:t[2]}})}else n.startsWith("http")&&e.push({text:"[å›¾ç‰‡é“¾æ¥: "+n+"]"})}s.push({role:"assistant"===m.role?"model":"user",parts:e})}const c=await B(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:s,generationConfig:{temperature:t.temperature??.7,maxOutputTokens:t.maxTokens||2e3}})},3e5);if(!c.ok){await c.text();if(401===c.status||403===c.status)throw new Error(`Google APIè®¤è¯å¤±è´¥ (${c.status})ï¼Œè¯·æ£€æŸ¥APIå¯†é’¥`);if(429===c.status)throw new Error("Google APIé…é¢è¶…é™ (429)");throw new Error(`Google APIè°ƒç”¨å¤±è´¥ (${c.status})`)}const l=await c.json();if(!l.candidates||!l.candidates[0]||!l.candidates[0].content)throw new Error("Google APIå“åº”æ ¼å¼é”™è¯¯");const u=l.candidates[0].content.parts;if(!u||0===u.length)throw new Error("Google APIå“åº”å†…å®¹ä¸ºç©º");return u[0].text}async function U(e,t=1,n){var r;const a=I(S.API_SETTINGS,{});n&&(a.maxTokens=n);const o=JSON.stringify({messages:Array.isArray(e)?e:[{role:"user",content:e}],maxTokens:n||a.maxTokens,model:a.model});if(J.has(o))return J.get(o);if(!a.baseUrl||!a.apiKey)throw new Error("è¯·å…ˆé…ç½®API");const s=a.baseUrl||"";let i=a.provider||"custom";s.includes("generativelanguage.googleapis.com")||s.includes("zhizhi.2373922440jhj.workers.dev")||s.includes("netlify/functions/gemini-proxy")?i="google":s.includes("api.openai.com")?i="openai":s.includes("api.anthropic.com")?i="claude":s.includes("api.siliconflow.cn")?i="siliconflow":(s.includes("hiapi.online")||s.includes("jiubanai.com"))&&(i="openai"),a.provider=i;const c=Array.isArray(e)?e:[{role:"user",content:e}],l=null==(r=c[c.length-1])?void 0:r.content;"string"==typeof l&&l.substring(0,100);let u=null;const m=(async()=>{try{for(let n=0;n<=t;n++)try{n>0&&await new Promise(e=>setTimeout(e,Math.min(500*n,2e3)));const e=Date.now();let t;t="google"===i?await z(c,a):await L(c,a);Date.now();return t}catch(e){if(u=e,(e.message.includes("Failed to fetch")||e.message.includes("NetworkError")||e.message.includes("è¯·æ±‚è¶…æ—¶"))&&n<t)continue;if(e.message.includes("è®¤è¯å¤±è´¥")||e.message.includes("è¯·å…ˆé…ç½®API"))throw e}throw u||new Error("APIè°ƒç”¨å¤±è´¥")}finally{J.delete(o)}})();return J.set(o,m),m}async function R(){try{return await U("ä½ å¥½"),!0}catch{return!1}}async function G(e){const{baseUrl:t,apiKey:n,provider:r}=e;if(!t||!n)throw new Error("è¯·å…ˆå¡«å†™APIåœ°å€å’Œå¯†é’¥");try{if("google"===r){let e=t.replace(/\/$/,"");e.includes("/v1")||e.endsWith("v1beta")||(e=`${e}/v1beta`);const r=`${e}/models?key=${n}`,a=await B(r,{method:"GET",headers:{"Content-Type":"application/json"}},1e4);if(!a.ok){await a.text();if(401===a.status||403===a.status)throw new Error("Google APIè®¤è¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥APIå¯†é’¥æ˜¯å¦æ­£ç¡®");return["gemini-2.0-flash-exp","gemini-1.5-flash","gemini-1.5-flash-8b","gemini-1.5-pro","gemini-pro"]}const o=await a.json();if(o.models&&Array.isArray(o.models)){const e=o.models.filter(e=>{var t;return e.name&&(null==(t=e.supportedGenerationMethods)?void 0:t.includes("generateContent"))}).map(e=>e.name.replace("models/",""));return e.length>0?e:["gemini-2.0-flash-exp","gemini-1.5-flash","gemini-1.5-flash-8b","gemini-1.5-pro","gemini-pro"]}return["gemini-2.0-flash-exp","gemini-1.5-flash","gemini-1.5-flash-8b","gemini-1.5-pro","gemini-pro"]}{const e=t.endsWith("/v1")?`${t}/models`:`${t}/v1/models`,r=await B(e,{method:"GET",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}},1e4);if(!r.ok)throw new Error(`æ‹‰å–æ¨¡å‹å¤±è´¥ (${r.status})`);const a=await r.json();if(a.data&&Array.isArray(a.data)){return a.data.map(e=>e.id).sort()}throw new Error("APIå“åº”æ ¼å¼é”™è¯¯")}}catch(a){throw new Error(a.message||"æ‹‰å–æ¨¡å‹åˆ—è¡¨å¤±è´¥")}}const q=Object.freeze(Object.defineProperty({__proto__:null,callAI:U,fetchModels:G,testApiConnection:R},Symbol.toStringTag,{value:"Module"}));async function F(e,t,n,r){const a=t.filter(e=>e.id!==n.id).map(e=>{let t=e.description||"";return e.personality&&(t+=`\næ€§æ ¼ï¼š${e.personality}`),e.scenario&&(t+=`\nåœºæ™¯ï¼š${e.scenario}`),e.userInfo&&(t+=`\nå¯¹è¯è€…å…³ç³»ï¼š${e.userInfo}`),e.signature&&(t+=`\nä¸ªæ€§ç­¾åï¼š${e.signature}`),{id:e.id,name:e.name,description:t.trim(),relationship_with_author:r(e.id,n.name)}}),o=e.comments||[],s=e.likes||[],i=o.length>0?`\n\n### 3. å·²æœ‰äº’åŠ¨ï¼ˆä½ éœ€è¦åŸºäºæ­¤ç»§ç»­ç¼–æ’ï¼‰\n**è¯„è®ºåŒºç°çŠ¶ï¼š**\n${o.map(e=>`- ${e.userName}: ${e.content}`).join("\n")}\n\n**ç‚¹èµåˆ—è¡¨ï¼š** ${s.map(e=>e.userName).join("ã€")||"æš‚æ— "}`:"",c=`\n    ## è§’è‰²å®šä½\n    ä½ æ˜¯ä¸€ä½é¡¶çº§çš„ç”µå½±ç¼–å‰§å’Œå¯¼æ¼”ï¼Œæ“…é•¿é€šè¿‡ç®€çŸ­çš„ç¤¾äº¤åª’ä½“äº’åŠ¨æ¥å±•ç°äººç‰©æ€§æ ¼ã€æ¿€åŒ–æˆå‰§å†²çªã€‚\n\n    ## åœºæ™¯è®¾å®š\n    - **å¹³å°**: æ‰‹æœºå¾®ä¿¡æœ‹å‹åœˆ\n    - **å½“å‰æ—¶é—´**: ${(new Date).toLocaleString("zh-CN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}\n    - **äº’åŠ¨æ–¹å¼**: ç‚¹èµã€è¯„è®ºã€æ¥¼ä¸­æ¥¼å¯¹è¯\n\n    ## åˆ›ä½œä»»åŠ¡\n    ä¸ºä¸€æ¡æœ‹å‹åœˆåŠ¨æ€ï¼Œåˆ›ä½œä¸€ä¸ªåŒ…å«å¤šè½®"æ¥¼ä¸­æ¥¼"å¯¹è¯çš„å®Œæ•´äº’åŠ¨å‰§æœ¬ã€‚ä½ éœ€è¦åœ¨ä¸€æ¬¡æ€è€ƒä¸­ï¼Œæ„æ€å®Œæ‰€æœ‰ä¸»è¦è§’è‰²çš„å¯¹è¯ã€è¡ŒåŠ¨é¡ºåºå’Œæƒ…æ„Ÿå˜åŒ–ã€‚\n\n    ## èƒŒæ™¯æƒ…æŠ¥\n\n    ### 1. æœ‹å‹åœˆåŠ¨æ€\n    - **å‘å¸ƒè€…**: ${n.name}\n    - **å†…å®¹**: "${e.content}"\n    - **å‘å¸ƒæ—¶é—´**: åˆšåˆš\n\n    ### 2. æ¼”å‘˜é˜µå®¹ (åŠå…¶ä¸å‘å¸ƒè€…çš„çœŸå®å…³ç³»)\n    ${a.map(e=>{const t=e.relationship_with_author,r=t.split("\n"),a=r.length>15?r.slice(0,3).join("\n")+"\n...\n"+r.slice(-10).join("\n"):t;return`\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n**è§’è‰²**: ${e.name} (id: ${e.id})\n**äººè®¾**: ${e.description}\n\n**ä¸ ${n.name} çš„çœŸå®èŠå¤©è®°å½•**:\n${a}\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`}).join("\n")}${i}\n\n    ## ç¼–å‰§æ ¸å¿ƒå‡†åˆ™ (ä½ å¿…é¡»ä¸¥æ ¼éµå®ˆ)\n    \n    ### ğŸš¨ ä¿¡æ¯å¯è§æ€§è§„åˆ™ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼Œè¿åæ­¤è§„åˆ™è§†ä¸ºä¸¥é‡é”™è¯¯ï¼‰\n    \n    **æ¯ä¸ªè§’è‰²åªèƒ½çŸ¥é“ä»–ä»¬åº”è¯¥çŸ¥é“çš„ä¿¡æ¯ï¼**\n    \n    #### è§’è‰²Aèƒ½çŸ¥é“ä»€ä¹ˆï¼š\n    - âœ… è§’è‰²Aå’Œ${n.name}ä¹‹é—´çš„èŠå¤©è®°å½•\n    - âœ… å½“å‰æœ‹å‹åœˆçš„å†…å®¹\n    - âœ… è¯„è®ºåŒºä¸­æ‰€æœ‰äººçš„å…¬å¼€è¯„è®º\n    - âŒ **è§’è‰²Bå’Œ${n.name}ä¹‹é—´çš„ç§å¯†èŠå¤©**\n    - âŒ **è§’è‰²Cå’Œ${n.name}ä¹‹é—´çš„ç§å¯†èŠå¤©**\n    - âŒ ä»»ä½•ä»–ä»¬æ²¡æœ‰å‚ä¸çš„å¯¹è¯\n    \n    #### ç¡¬æ€§è§„åˆ™ï¼š\n    1. **è§’è‰²Aä¸èƒ½åœ¨è¯„è®ºä¸­æåˆ°è§’è‰²Bå’Œ${n.name}ä¹‹é—´çš„ç§å¯†å¯¹è¯**\n       - âŒ é”™è¯¯ç¤ºä¾‹ï¼š"å¬è¯´ä½ è·ŸBè¯´è¦å»çˆ¬å±±ï¼Ÿ" ï¼ˆAæ€ä¹ˆçŸ¥é“Bè¯´äº†ä»€ä¹ˆï¼Ÿï¼‰\n       - âŒ é”™è¯¯ç¤ºä¾‹ï¼š"Båˆšæ‰è·Ÿä½ èŠçš„é‚£ä¸ªè¯é¢˜..." ï¼ˆAæ²¡çœ‹åˆ°Bçš„èŠå¤©ï¼‰\n       - âœ… æ­£ç¡®ç¤ºä¾‹ï¼š"å‘¨æœ«æœ‰ç©ºå—ï¼Ÿ" ï¼ˆåŸºäºAè‡ªå·±å’Œå‘å¸ƒè€…çš„å…³ç³»ï¼‰\n    \n    2. **æ¯ä¸ªè§’è‰²åªèƒ½åŸºäºè‡ªå·±çš„èŠå¤©è®°å½•åšå‡ºååº”**\n       - è§’è‰²Açš„è¯„è®º = åŸºäº"è§’è‰²Açš„èŠå¤©è®°å½•" + "æœ‹å‹åœˆå†…å®¹" + "è¯„è®ºåŒº"\n       - è§’è‰²Bçš„è¯„è®º = åŸºäº"è§’è‰²Bçš„èŠå¤©è®°å½•" + "æœ‹å‹åœˆå†…å®¹" + "è¯„è®ºåŒº"\n       - å®ƒä»¬å½¼æ­¤ç‹¬ç«‹ï¼\n    \n    3. **è¯„è®ºåŒºæ˜¯å”¯ä¸€çš„å…¬å…±ä¿¡æ¯**\n       - è§’è‰²å¯ä»¥çœ‹åˆ°å¹¶å›å¤è¯„è®ºåŒºçš„å†…å®¹\n       - è§’è‰²å¯ä»¥åŸºäºè¯„è®ºåŒºæ¨æµ‹å…³ç³»ï¼ˆå¦‚çœ‹åˆ°Aå¯¹å‘å¸ƒè€…å¾ˆäº²å¯†ï¼ŒBå¯èƒ½åƒé†‹ï¼‰\n       - ä½†ä¸èƒ½ç›´æ¥å¼•ç”¨åˆ«äººçš„ç§å¯†èŠå¤©å†…å®¹\n    \n    ### âš ï¸ çœŸå®æ‰®æ¼”åŸåˆ™ï¼ˆç¬¬äºŒä¼˜å…ˆçº§ï¼‰\n    - **å¿…é¡»ä»”ç»†é˜…è¯»èŠå¤©è®°å½•**: æ¯ä¸ªè§’è‰²çš„è¯„è®ºå¿…é¡»**ä»…åŸºäºä»–ä»¬è‡ªå·±**ä¸å‘å¸ƒè€…çš„çœŸå®èŠå¤©è®°å½•ã€‚å¦‚æœèŠå¤©è®°å½•æ˜¾ç¤ºä»–ä»¬å…³ç³»äº²å¯†ï¼Œè¯„è®ºè¦ä½“ç°äº²å¯†ï¼›å¦‚æœèŠå¤©è®°å½•æ˜¾ç¤ºæœ‰çŸ›ç›¾ï¼Œè¯„è®ºè¦ä½“ç°å¼ åŠ›ã€‚\n    - **ä¸¥ç¦ç¼–é€ ä¸å­˜åœ¨çš„äº‹å®**: ä¸è¦è™šæ„"1å°æ—¶å‰å‘ç”Ÿçš„äº‹"ã€"æ˜¨å¤©çš„å¯¹è¯"ã€"ä¹‹å‰çš„æ´»åŠ¨"ç­‰ã€‚\n    - **åªèƒ½åŸºäºå·²æä¾›çš„çœŸå®ä¿¡æ¯**: ä»…ä½¿ç”¨ä¸Šæ–¹æä¾›çš„"è¯¥è§’è‰²è‡ªå·±çš„èŠå¤©è®°å½•"å’Œ"å½“å‰æœ‹å‹åœˆå†…å®¹"ä½œä¸ºäº‹å®ä¾æ®ã€‚\n    - **å¼ åŠ›æ¥è‡ªå¯¹è¯æœ¬èº«**: å†²çªåº”é€šè¿‡è§’è‰²çš„è¯­æ°”ã€æ€åº¦ã€ç«‹åœºå·®å¼‚æ¥ä½“ç°ï¼Œè€Œéä¾èµ–è™šæ„çš„è¿‡å¾€äº‹ä»¶æˆ–å…¶ä»–äººçš„èŠå¤©å†…å®¹ã€‚\n    - **ç¬¦åˆæ‰‹æœºæœ‹å‹åœˆåœºæ™¯**: è¿™æ˜¯åœ¨æ‰‹æœºå¾®ä¿¡ä¸Šçš„å®æ—¶äº’åŠ¨ï¼Œè§’è‰²åªèƒ½çœ‹åˆ°å½“å‰æœ‹å‹åœˆçš„å†…å®¹å’Œè¯„è®ºåŒºã€‚\n    - **ä½“ç°èŠå¤©è®°å½•ä¸­çš„å…³ç³»**: å¦‚æœèŠå¤©è®°å½•æ˜¾ç¤ºè§’è‰²Aç»å¸¸å…³å¿ƒå‘å¸ƒè€…ï¼Œé‚£è¯„è®ºä¹Ÿåº”è¯¥ä½“ç°å…³å¿ƒï¼›å¦‚æœèŠå¤©è®°å½•æ˜¾ç¤ºè§’è‰²Bå¾ˆæ¯’èˆŒï¼Œé‚£è¯„è®ºä¹Ÿåº”è¯¥æ¯’èˆŒã€‚\n    \n    ### åˆ›ä½œè¦ç‚¹\n    1.  **åˆ›é€ å†²çªï¼Œæ‹’ç»å¹³åº¸**: å¯»æ‰¾è§’è‰²å…³ç³»ä¸­çš„å¼ åŠ›ç‚¹ï¼ˆå¦‚æƒ…æ•Œã€è¯¯ä¼šã€å«‰å¦’ï¼‰ï¼Œé€šè¿‡å¯¹è¯å’Œæ€åº¦å±•å¼€å‰§æƒ…ã€‚ä¸è¦å†™"ä½ å¥½æˆ‘å¥½"çš„æ— èŠè¯„è®ºã€‚\n    2.  **å•æ¬¡ç”Ÿæˆå®Œæ•´å¯¹è¯**: ä¸€æ¬¡æ€§æ„æ€å®Œä¸€åœºå®Œæ•´çš„"å¯¹è¯æˆ˜"ã€‚ç«™åœ¨ä¸Šå¸è§†è§’ï¼Œä¸ºæ¯ä¸ªè§’è‰²å†™å¥½ä»–ä»¬åœ¨æ¥¼ä¸­æ¥¼é‡Œçš„æ¯ä¸€å¥å°è¯ã€‚\n    3.  **ç¬¦åˆäººè®¾**: æ¯ä¸ªè§’è‰²çš„å°è¯å¿…é¡»å’Œä»–çš„äººè®¾ã€æƒ…ç»ªå’ŒåŠ¨æœºé«˜åº¦ä¸€è‡´ã€‚å‚è€ƒ"æœ€è¿‘çš„çœŸå®èŠå¤©è®°å½•"æ¥æŠŠæ¡è§’è‰²æ€§æ ¼ã€‚\n    4.  **èŠ‚å¥æ„Ÿ**: è®¾è®¡å¥½è§’è‰²çš„å‡ºåœºé¡ºåºå’Œå»¶è¿Ÿã€‚å†²çªéœ€è¦é“ºå«ã€çˆ†å‘å’Œæ”¶åœºã€‚å®‰æ’"åƒç“œç¾¤ä¼—"åœ¨åˆé€‚çš„æ—¶æœºå…¥åœºã€‚\n    5.  **ä¿æŒç®€æ´**: åœºæ™¯æ•°é‡æ§åˆ¶åœ¨2-4ä¸ªï¼Œæ¯ä¸ªå¯¹è¯æ¥¼æ§åˆ¶åœ¨3-6æ¡è¯„è®ºã€‚é¿å…å‰§æœ¬è¿‡é•¿ã€‚\n    6.  ${o.length>0?"**åŸºäºç°æœ‰äº’åŠ¨ç»§ç»­ç¼–æ’**: è¯„è®ºåŒºå·²ç»æœ‰äººäº’åŠ¨äº†ã€‚ä½ éœ€è¦è®©å…¶ä»–AIè§’è‰²å¯¹ç°æœ‰è¯„è®ºåšå‡ºååº”ï¼ˆæ¯”å¦‚å›å¤ã€ç‚¹èµã€åŠ å…¥è®¨è®ºï¼‰ã€‚ä¸è¦é‡å¤å·²æœ‰çš„è¯„è®ºå†…å®¹ã€‚":"**ä»é›¶å¼€å§‹ç¼–æ’**: è¿™æ˜¯ä¸€æ¡å…¨æ–°çš„æœ‹å‹åœˆï¼Œä½ å¯ä»¥è‡ªç”±å®‰æ’AIè§’è‰²çš„é¦–æ¬¡äº’åŠ¨ã€‚"}\n\n    ## å‰§æœ¬è¾“å‡ºæ ¼å¼ (ç®€å•æ–‡æœ¬æ ¼å¼)\n    ä½ å¿…é¡»æŒ‰ç…§ä»¥ä¸‹ç®€å•æ ¼å¼è¾“å‡ºå‰§æœ¬ï¼Œæ¯ä¸€è¡Œä»£è¡¨ä¸€ä¸ªåŠ¨ä½œï¼š\n\n    **æ ¼å¼è¯´æ˜ï¼š**\n    - \`(è§’è‰²å è¯„è®º: è¯„è®ºå†…å®¹)\` - å‘è¡¨é¡¶å±‚è¯„è®º\n    - \`(è§’è‰²å å›å¤ ç›®æ ‡è§’è‰²å: å›å¤å†…å®¹)\` - å›å¤æŸäººçš„è¯„è®º\n    - \`(è§’è‰²å ç‚¹èµ)\` - ç‚¹èµè¿™æ¡æœ‹å‹åœˆ\n\n    **ç¤ºä¾‹ï¼ˆæ­£ç¡®ï¼‰- éµå®ˆä¿¡æ¯å¯è§æ€§è§„åˆ™ï¼š**\n    \`\`\`\n    å‰§æƒ…æ¦‚è¦ï¼šAåŸºäºè‡ªå·±å’Œå‘å¸ƒè€…çš„äº²å¯†å…³ç³»è¯„è®ºï¼ŒBçœ‹åˆ°è¯„è®ºååƒé†‹ï¼Œä¸¤äººäº§ç”Ÿå¼ åŠ›ã€‚\n    \n    (è§’è‰²A è¯„è®º: å®è´ï¼Œæƒ³ä½ äº†~)\n    (è§’è‰²B å›å¤ è§’è‰²A: "å®è´"ï¼Ÿå«å¾—å¯çœŸäº²çƒ­ã€‚)\n    (è§’è‰²A å›å¤ è§’è‰²B: æ€ä¹ˆäº†ï¼Ÿæˆ‘ä¸€ç›´è¿™ä¹ˆå«çš„å•Šã€‚)\n    (è§’è‰²B å›å¤ è§’è‰²A: å“¦ï¼Œé‚£å¯èƒ½æ˜¯æˆ‘ä¸å¤Ÿäº†è§£ä½ ä»¬çš„å…³ç³»ã€‚)\n    (è§’è‰²C è¯„è®º: å—¯ï¼Ÿæ°”æ°›æœ‰ç‚¹å¾®å¦™å•Š[åƒç“œ])\n    (è§’è‰²D ç‚¹èµ)\n    \`\`\`\n    \n    **å…³é”®ç‚¹**ï¼š\n    - âœ… Açš„ç§°å‘¼"å®è´"æ¥è‡ªAè‡ªå·±å’Œå‘å¸ƒè€…çš„èŠå¤©è®°å½•ï¼ˆAçŸ¥é“çš„ï¼‰\n    - âœ… Bçœ‹åˆ°è¯„è®ºåŒºçš„"å®è´"åäº§ç”Ÿååº”ï¼ˆè¯„è®ºåŒºæ˜¯å…¬å¼€çš„ï¼‰\n    - âœ… Cçœ‹åˆ°Aå’ŒBçš„å¯¹è¯ååƒç“œï¼ˆè¯„è®ºåŒºæ˜¯å…¬å¼€çš„ï¼‰\n    - âŒ Bä¸èƒ½è¯´"ä½ åˆšæ‰ç§ä¿¡é‡Œè·ŸAè¯´äº†ä»€ä¹ˆ"ï¼ˆBçœ‹ä¸åˆ°Açš„ç§ä¿¡ï¼‰\n    \n    **åé¢ç¤ºä¾‹ï¼ˆé”™è¯¯ï¼‰- è¿åä¿¡æ¯å¯è§æ€§ï¼š**\n    âŒ "å¬è¯´ä½ åˆšæ‰è·ŸAè¯´è¦å»çˆ¬å±±ï¼Ÿ" ï¼ˆBæ€ä¹ˆçŸ¥é“å‘å¸ƒè€…è·ŸAè¯´äº†ä»€ä¹ˆï¼Ÿï¼‰\n    âŒ "Aåˆšæ‰è·Ÿä½ èŠçš„é‚£ä¸ªè¯é¢˜å¾ˆæœ‰æ„æ€" ï¼ˆBçœ‹ä¸åˆ°Açš„èŠå¤©ï¼‰\n    âŒ "1å°æ—¶å‰ä½ è·ŸCè¯´çš„é‚£å¥è¯..." ï¼ˆBçœ‹ä¸åˆ°Cçš„èŠå¤©ï¼‰\n    \n    **åé¢ç¤ºä¾‹ï¼ˆé”™è¯¯ï¼‰- ç¼–é€ ä¸å­˜åœ¨çš„äº‹å®ï¼š**\n    âŒ "æ˜¨å¤©è§é¢çš„æ—¶å€™ä½ è¯´è¿‡..."\n    âŒ "ä¸Šæ¬¡æˆ‘ä»¬ä¸€èµ·..."\n    âŒ "ä½ ä¹‹å‰åˆ†äº«çš„é‚£ä¸ª..."\n    \n    **æ­£ç¡®åšæ³•ï¼š**\n    âœ… æ¯ä¸ªè§’è‰²åªåŸºäºè‡ªå·±çš„èŠå¤©è®°å½• + æœ‹å‹åœˆå†…å®¹ + è¯„è®ºåŒº\n    âœ… é€šè¿‡è¯„è®ºåŒºçš„å…¬å¼€ä¿¡æ¯äº§ç”Ÿäº’åŠ¨å’Œå†²çª\n    âœ… åŸºäºè¯­æ°”ã€æ€åº¦ã€ç§°å‘¼æ¥å±•ç°å…³ç³»å¼ åŠ›\n    âœ… è®©è§’è‰²æ ¹æ®äººè®¾å’Œè‡ªå·±çŸ¥é“çš„ä¿¡æ¯åšå‡ºååº”\n\n    ## é‡è¦æé†’\n    - **ç¬¬ä¸€è¡Œå¿…é¡»æ˜¯"å‰§æƒ…æ¦‚è¦ï¼š"å¼€å¤´çš„ä¸€å¥è¯**\n    - **æ¯ä¸ªåŠ¨ä½œç‹¬å ä¸€è¡Œï¼Œä¸¥æ ¼æŒ‰ç…§æ ¼å¼**\n    - **è§’è‰²åä½¿ç”¨çœŸå®çš„è§’è‰²åå­—ï¼Œä¸è¦ç”¨"è§’è‰²A"è¿™ç§ä»£å·**\n    - **æ§åˆ¶åœ¨10-20ä¸ªåŠ¨ä½œä»¥å†…ï¼Œä¿æŒç®€æ´**\n    \n    ç°åœ¨ï¼Œè¯·å‘æŒ¥ä½ çš„ç¼–å‰§æ‰èƒ½ï¼Œä¸ºè¿™æ¡æœ‹å‹åœˆåˆ›ä½œä¸€ä¸ªå……æ»¡å¼ åŠ›çš„äº’åŠ¨å‰§æœ¬ã€‚\n  `;try{const e=(await U([{role:"user",content:c}])).split("\n").map(e=>e.trim()).filter(e=>e),t=[];let n="";for(const a of e){if(a.startsWith("å‰§æƒ…æ¦‚è¦ï¼š")||a.startsWith("å‰§æƒ…æ¦‚è¦:")){n=a.replace(/^å‰§æƒ…æ¦‚è¦[ï¼š:]/,"").trim();continue}const e=a.match(/^\((.+?)\s+è¯„è®º[ï¼š:]\s*(.+?)(\)|$)/);if(e){t.push({type:"comment",actorName:e[1].trim(),content:e[2].trim()});continue}const r=a.match(/^\((.+?)\s+å›å¤\s+(.+?)[ï¼š:]\s*(.+?)(\)|$)/);if(r){t.push({type:"reply",actorName:r[1].trim(),targetName:r[2].trim(),content:r[3].trim()});continue}const o=a.match(/^\((.+?)\s+ç‚¹èµ(\)|$)/);o?t.push({type:"like",actorName:o[1].trim()}):a.startsWith("(")}if(!n)return null;if(0===t.length)return null;const r={summary:n,actions:t};return t.forEach((e,t)=>{"comment"===e.type||"reply"===e.type||e.type}),r}catch(l){return null}}function K(e,t,n){try{const t=localStorage.getItem(`chat_messages_${e}`),r=t?JSON.parse(t):[],a={id:Date.now()+Math.random(),type:"system",content:n,time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:Date.now(),messageType:"system",isHidden:!0};r.push(a),localStorage.setItem(`chat_messages_${e}`,JSON.stringify(r))}catch(r){}}function W(e,t,n,r){let a=0;e.actions.forEach(e=>{a+=1e3+2e3*Math.random(),setTimeout(()=>{const a=r.characters.find(t=>t.name===e.actorName);if(a)if("comment"===e.type&&e.content)n.addComment(t.id,a.id,a.name,a.avatar,e.content),K(a.id,a.name,`ğŸ’¬ æˆ‘è¯„è®ºäº† ${t.userName} çš„æœ‹å‹åœˆï¼š${e.content}`);else if("reply"===e.type&&e.content&&e.targetName){const r=`@${e.targetName} ${e.content}`;n.addComment(t.id,a.id,a.name,a.avatar,r),K(a.id,a.name,`ğŸ’¬ æˆ‘åœ¨æœ‹å‹åœˆå›å¤ ${e.targetName}ï¼š${e.content}`)}else"like"===e.type&&(n.likeMoment(t.id,a.id,a.name,a.avatar),K(a.id,a.name,`ğŸ‘ æˆ‘ç‚¹èµäº† ${t.userName} çš„æœ‹å‹åœˆ`))},a)})}function H(e,t){if(t<=0||e<=0)return[];const n=[];let r=100*e;for(let a=0;a<t-1;a++){const e=r/(t-a)*2,o=Math.random()*e,s=Math.max(1,Math.floor(o));n.push(s),r-=s}n.push(Math.max(1,r));return n.map(e=>Math.round(e)/100).sort(()=>Math.random()-.5)}function V(e){let t=0,n=null;return Object.entries(e).forEach(([e,r])=>{r.amount>t&&(t=r.amount,n=e)}),n}const Q="forum_posts",X="forum_comments",Z="forum_drafts",Y="forum_favorites",ee="forum_likes",te="forum_notifications",ne="forum_direct_messages";function re(e,t){if(!e)return t;try{return JSON.parse(e)}catch(n){return t}}function ae(e,t){try{return localStorage.setItem(e,JSON.stringify(t)),!0}catch(n){return!1}}function oe(){return`${Date.now()}_${Math.random().toString(36).substr(2,9)}`}function se(){return re(localStorage.getItem(Q),[])}function ie(e){return ae(Q,e)}function ce(e){return se().find(t=>t.id===e)||null}function le(e){const t=se(),n={...e,id:oe(),timestamp:Date.now(),likeCount:0,commentCount:0,shareCount:0,isLiked:!1,isFavorited:!1};return t.unshift(n),ie(t),function(){const e=Ee();e.posts+=1,De(e)}(),setTimeout(()=>{if(Math.random()<.3){const e=Math.floor(2*Math.random())+1;!function(e=1){const t=Ee();t.followers+=e,De(t)}(e);for(let t=0;t<e;t++)Ce()}if(Math.random()<.5){je(Math.floor(50*Math.random())+10),Me(n.id)}},3e3*Math.random()+2e3),n}function ue(e,t){const n=se(),r=n.findIndex(t=>t.id===e);return-1!==r&&(n[r]={...n[r],...t},ie(n))}function me(e){const t=se(),n=t.filter(t=>t.id!==e);if(n.length===t.length)return!1;return ge(he().filter(t=>t.postId!==e)),ie(n)}function de(e={}){let t=se();if(e.authorId&&(t=t.filter(t=>t.authorId===e.authorId)),e.tag&&(t=t.filter(t=>t.tags&&t.tags.includes(e.tag))),e.keyword){const n=e.keyword.toLowerCase();t=t.filter(e=>e.content.toLowerCase().includes(n)||e.authorName.toLowerCase().includes(n))}"hot"===e.sortBy?t.sort((e,t)=>t.likeCount+2*t.commentCount-(e.likeCount+2*e.commentCount)):"like"===e.sortBy?t.sort((e,t)=>t.likeCount-e.likeCount):t.sort((e,t)=>t.timestamp-e.timestamp);const n=e.limit||20,r=e.offset||0;return{items:t.slice(r,r+n),total:t.length,hasMore:r+n<t.length,nextOffset:r+n}}function he(){return re(localStorage.getItem(X),[])}function ge(e){return ae(X,e)}function pe(e){return he().filter(t=>t.postId===e)}function fe(e){const t=he(),n={...e,id:oe(),timestamp:Date.now(),likeCount:0,isLiked:!1};t.push(n),ge(t);const r=se(),a=r.findIndex(t=>t.id===e.postId);return-1!==a&&(r[a].commentCount++,ie(r)),e.replyTo&&e.replyToUserId&&e.replyToUserId!==e.authorId&&Ne({type:"comment",fromUserId:e.authorId,fromUserName:e.authorName,fromUserAvatar:e.authorAvatar,content:e.content,postId:e.postId,commentId:n.id,isRead:!1}),setTimeout(()=>{if(Math.random()<.4){je(Math.floor(30*Math.random())+5),Me(e.postId,n.id)}},4e3*Math.random()+3e3),n}function ye(e){const t=he(),n=t.find(t=>t.id===e);if(!n)return!1;ge(t.filter(t=>t.id!==e));const r=se(),a=r.findIndex(e=>e.id===n.postId);return-1!==a&&(r[a].commentCount=Math.max(0,r[a].commentCount-1),ie(r)),!0}function we(){return re(localStorage.getItem(ee),[])}function Se(e){return we().includes(e)}function Ie(e){return we().includes(e)?function(e){const t=we(),n=t.filter(t=>t!==e);if(n.length===t.length)return!1;localStorage.setItem(ee,JSON.stringify(n));const r=se(),a=r.findIndex(t=>t.id===e);return-1!==a&&(r[a].likeCount=Math.max(0,r[a].likeCount-1),r[a].isLiked=!1,ie(r)),!0}(e):function(e){const t=we();if(t.includes(e))return!1;t.push(e),localStorage.setItem(ee,JSON.stringify(t));const n=se(),r=n.findIndex(t=>t.id===e);return-1!==r&&(n[r].likeCount++,n[r].isLiked=!0,ie(n)),!0}(e)}function _e(){return re(localStorage.getItem(Y),[])}function ke(e){return _e().includes(e)?function(e){const t=_e(),n=t.filter(t=>t!==e);if(n.length===t.length)return!1;localStorage.setItem(Y,JSON.stringify(n));const r=se(),a=r.findIndex(t=>t.id===e);return-1!==a&&(r[a].isFavorited=!1,ie(r)),!0}(e):function(e){const t=_e();if(t.includes(e))return!1;t.push(e),localStorage.setItem(Y,JSON.stringify(t));const n=se(),r=n.findIndex(t=>t.id===e);return-1!==r&&(n[r].isFavorited=!0,ie(n)),!0}(e)}function $e(){return re(localStorage.getItem(Z),[])}function ve(e){const t=$e(),n={...e,id:oe(),timestamp:Date.now()};return t.unshift(n),localStorage.setItem(Z,JSON.stringify(t)),n}function be(e){const t=$e(),n=t.filter(t=>t.id!==e);return n.length!==t.length&&(localStorage.setItem(Z,JSON.stringify(n)),!0)}function Ae(){if(se().length>0)return;ie([{id:oe(),authorId:"user1",authorName:"æ€æ€è€ƒè€ƒ",authorAvatar:"",isVerified:!0,content:"ä»Šå¤©å¤©æ°”çœŸå¥½ï¼â˜€ï¸ åˆ†äº«ä¸€ä¸‹æˆ‘çš„æ—¥å¸¸ï¼Œå¸Œæœ›å¤§å®¶éƒ½èƒ½å¼€å¼€å¿ƒå¿ƒçš„åº¦è¿‡æ¯ä¸€å¤©ã€‚ç”Ÿæ´»ä¸­çš„å°ç¡®å¹¸æ€»æ˜¯è®©äººæ„Ÿåˆ°æ¸©æš–ã€‚",type:"text",timestamp:Date.now()-36e5,likeCount:1288,commentCount:156,shareCount:89,viewCount:8900,isLiked:!1,isFavorited:!1,tags:["æ—¥å¸¸","å¿ƒæƒ…"],location:"åŒ—äº¬Â·æœé˜³åŒº"},{id:oe(),authorId:"user2",authorName:"ç§‘æŠ€è¾¾äºº",authorAvatar:"",isVerified:!0,content:"åˆšåˆšçœ‹åˆ°ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„æŠ€æœ¯åˆ†äº«ï¼Œå…³äºAIçš„æœ€æ–°è¿›å±•ã€‚ç§‘æŠ€æ”¹å˜ç”Ÿæ´»ï¼Œæœªæ¥å¯æœŸï¼ğŸš€",type:"text",timestamp:Date.now()-72e5,likeCount:2156,commentCount:234,shareCount:178,viewCount:15600,isLiked:!1,isFavorited:!1,tags:["ç§‘æŠ€","AI"],location:"ä¸Šæµ·Â·æµ¦ä¸œæ–°åŒº"},{id:oe(),authorId:"user3",authorName:"ç¾é£Ÿæ¢åº—",authorAvatar:"",isVerified:!1,content:"ä»Šå¤©æ‰“å¡äº†ä¸€å®¶è¶…çº§å¥½åƒçš„é¤å…ï¼ç¯å¢ƒå¾ˆæ£’ï¼Œèœå“ä¹Ÿå¾ˆç²¾è‡´ã€‚å¼ºçƒˆæ¨èç»™å¤§å®¶ï¼ğŸ˜‹",type:"text",timestamp:Date.now()-108e5,likeCount:567,commentCount:89,shareCount:45,viewCount:4500,isLiked:!1,isFavorited:!1,tags:["ç¾é£Ÿ","æ¢åº—"],location:"å¹¿å·Â·å¤©æ²³åŒº"},{id:oe(),authorId:"user4",authorName:"æ—…è¡Œæ—¥è®°",authorAvatar:"",isVerified:!0,content:"åœ¨æµ·è¾¹çœ‹æ—¥è½ğŸŒ… äººç”Ÿå°±æ˜¯è¦å¤šå‡ºå»èµ°èµ°ï¼Œçœ‹çœ‹è¿™ä¸ªç¾ä¸½çš„ä¸–ç•Œã€‚æ¯ä¸€æ¬¡æ—…è¡Œéƒ½æ˜¯ä¸€æ¬¡å¿ƒçµçš„æ´—ç¤¼ã€‚",type:"text",timestamp:Date.now()-144e5,likeCount:3456,commentCount:567,shareCount:289,viewCount:23400,isLiked:!1,isFavorited:!1,tags:["æ—…è¡Œ","é£æ™¯"],location:"ä¸‰äºšÂ·æµ·æ£ æ¹¾"},{id:oe(),authorId:"user5",authorName:"éŸ³ä¹åˆ†äº«",authorAvatar:"",isVerified:!1,content:"æœ€è¿‘åœ¨å¬çš„ä¸€é¦–æ­Œï¼Œå•æ›²å¾ªç¯äº†ä¸€æ•´å¤©ğŸµ éŸ³ä¹çœŸçš„æ˜¯æ²»æ„ˆå¿ƒçµçš„è‰¯è¯ã€‚æ¨èç»™å–œæ¬¢çš„æœ‹å‹ä»¬ï¼",type:"text",timestamp:Date.now()-18e6,likeCount:892,commentCount:145,shareCount:67,viewCount:6700,isLiked:!1,isFavorited:!1,tags:["éŸ³ä¹","åˆ†äº«"],location:"æ­å·Â·è¥¿æ¹–åŒº"}])}function Ne(e){const t=Oe(),n={...e,id:oe(),timestamp:Date.now()};var r,a,o;return t.unshift(n),function(e){localStorage.setItem(te,JSON.stringify(e))}(t),"comment"===e.type&&e.fromUserName?(r=e.fromUserName,a=e.content||"",o=e.postId||"",p({title:"è®ºå›æ¶ˆæ¯",subtitle:`${r} è¯„è®ºäº†ä½ çš„å¸–å­`,message:a.substring(0,50)+(a.length>50?"...":""),type:"comment",targetId:o})):"like"===e.type&&e.fromUserName?function(e,t){p({title:"è®ºå›æ¶ˆæ¯",subtitle:`${e} èµäº†ä½ çš„å¸–å­`,message:"å¿«å»çœ‹çœ‹å§~",type:"like",targetId:t})}(e.fromUserName,e.postId||""):"follow"===e.type&&e.fromUserName&&function(e){p({title:"è®ºå›æ¶ˆæ¯",subtitle:`${e} å…³æ³¨äº†ä½ `,message:"åˆå¤šäº†ä¸€ä¸ªæ–°æœ‹å‹ï¼",type:"follow"})}(e.fromUserName),n}function Oe(){return re(localStorage.getItem(te),[])}function xe(){const e=["èµµ","é’±","å­™","æ","å‘¨","å´","éƒ‘","ç‹","å†¯","é™ˆ","è¤š","å«","è’‹","æ²ˆ","éŸ©","æ¨","æœ±","ç§¦","å°¤","è®¸","ä½•","å•","æ–½","å¼ ","å­”","æ›¹","ä¸¥","å","é‡‘","é­","é™¶","å§œ","æˆš","è°¢","é‚¹","å–»","æŸ","æ°´","çª¦","ç« ","äº‘","è‹","æ½˜","è‘›","å¥š","èŒƒ","å½­","éƒ","é²","éŸ¦","æ˜Œ","é©¬","è‹—","å‡¤","èŠ±","æ–¹","ä¿","ä»»","è¢","æŸ³","é…†","é²","å²","å”","è´¹","å»‰","å²‘","è–›","é›·","è´º","å€ª","æ±¤","æ»•","æ®·","ç½—","æ¯•","éƒ","é‚¬","å®‰","å¸¸","ä¹","äº","æ—¶","å‚…","çš®","å","é½","åº·","ä¼","ä½™","å…ƒ","åœ","é¡¾","å­Ÿ","å¹³","é»„","å’Œ","ç©†","è§","å°¹"],t=["å­æ¶µ","é›¨è½©","æµ©å®‡","æ€è¿œ","æ¢“æ¶µ","æ¬£æ€¡","æ™¨æ›¦","é›¨è±","è¯—æ¶µ","æ¢“è±","é™æ€¡","ä½³æ€¡","å˜‰æ€¡","ç´«æ¶µ","é›¨æ¡","æ¢“çª","é›¨æ³½","å®‡è½©","å­è½©","åšæ–‡","ä¿Šæ°","æ˜è½©","å¤©å®‡","å®‡èˆª","æ™¨é˜³","å­è±ª","æ¢“è±ª","æµ©ç„¶","é›¨è¾°","å­è¾°","æ¢“è¾°","å®‡è¾°","æ™¨è¾°","é›¨æ™¨","å­æ™¨","æ¢“æ™¨","å®‡æ™¨","è¯—çª","é›¨çª","æ¢“ç¦","å®‡ç¦","æ™¨ç¦","å­ç¦","æ¢“çª","å®‡çª","æ™¨çª","é›¨ç¦"];if(Math.random()<.7){return e[Math.floor(Math.random()*e.length)]+t[Math.floor(Math.random()*t.length)]}return t[Math.floor(Math.random()*t.length)]}function Me(e,t){const n=Math.floor(3*Math.random())+3,r=[];for(let s=0;s<n;s++)r.push(xe());const a=n+Math.floor(100*Math.random())+10,o=r.slice(0,3).join("ã€");Ne({type:"like",fromUserId:"system",fromUserName:o,fromUserAvatar:"",content:`${o}ç­‰${a}ä¸ªäººèµäº†ä½ ${t?"çš„è¯„è®º":"çš„å¾®åš"}`,postId:e,commentId:t,isRead:!1})}function Ce(){const e=xe();Ne({type:"follow",fromUserId:`user_${Date.now()}`,fromUserName:e,fromUserAvatar:"",content:"å…³æ³¨äº†ä½ ",isRead:!1})}function Ee(){return re(localStorage.getItem("forum_user_stats"),{followers:0,following:0,posts:0,likes:0})}function De(e){localStorage.setItem("forum_user_stats",JSON.stringify(e))}function je(e=1){const t=Ee();t.likes+=e,De(t)}function Te(){return re(localStorage.getItem(ne),[]).sort((e,t)=>t.timestamp-e.timestamp)}function Pe(e){const t=Te(),n={...e,id:`dm_${Date.now()}_${Math.random()}`};var r,a;return t.unshift(n),localStorage.setItem(ne,JSON.stringify(t)),"currentUser"===e.toUserId&&e.fromUserName&&(r=e.fromUserName,a=e.content,p({title:"è®ºå›ç§ä¿¡",subtitle:`${r} ç»™ä½ å‘äº†ç§ä¿¡`,message:a.substring(0,50)+(a.length>50?"...":""),type:"dm"})),n}function Je(e){const t=Te().map(t=>t.id===e?{...t,isRead:!0}:t);localStorage.setItem(ne,JSON.stringify(t))}function Be(){return Te().filter(e=>!e.isRead).length}const Le=[{days:1,name:"åˆè¯†",emoji:"ğŸ‘‹"},{days:3,name:"ç›¸è¯†",emoji:"ğŸ˜Š"},{days:7,name:"ç†Ÿæ‚‰",emoji:"ğŸ¤"},{days:14,name:"çŸ¥å¿ƒ",emoji:"ğŸ’•"},{days:30,name:"æŒšå‹",emoji:"â¤ï¸"},{days:50,name:"å¯†å‹",emoji:"ğŸ’–"},{days:100,name:"çµé­‚ä¼´ä¾£",emoji:"ğŸ’—"},{days:365,name:"å‘½ä¸­æ³¨å®š",emoji:"ğŸ’"}];function ze(){return(new Date).toISOString().split("T")[0]}function Ue(){const e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-01`}function Re(e,t){const n=new Date(e),r=new Date(t),a=Math.abs(r.getTime()-n.getTime());return Math.floor(a/864e5)}function Ge(e){const t=`streak_${e}`,n=localStorage.getItem(t);return n?JSON.parse(n):{characterId:e,currentStreak:0,longestStreak:0,lastChatDate:"",totalDays:0,breakCount:0,milestones:[],hasUsedRevive:!1,reviveResetDate:Ue()}}function qe(e){const t=`streak_${e.characterId}`;localStorage.setItem(t,JSON.stringify(e))}function Fe(e){const t=Ge(e),n=ze();if(t.lastChatDate===n)return t;const r=Ue();if(t.reviveResetDate!==r&&(t.hasUsedRevive=!1,t.reviveResetDate=r),!t.lastChatDate)return t.currentStreak=1,t.longestStreak=1,t.totalDays=1,t.lastChatDate=n,t.milestones=[1],qe(t),t;const a=Re(t.lastChatDate,n);return 1===a?(t.currentStreak+=1,t.totalDays+=1,t.currentStreak>t.longestStreak&&(t.longestStreak=t.currentStreak),t.milestones.includes(t.currentStreak)||(t.milestones.push(t.currentStreak),t.milestones.sort((e,t)=>e-t))):a>1&&(t.breakCount+=1,t.currentStreak=1,t.totalDays+=1),t.lastChatDate=n,qe(t),t}function Ke(e){for(let t=Le.length-1;t>=0;t--)if(e>=Le[t].days)return Le[t];return Le[0]}function We(e){for(const t of Le)if(e<t.days)return t;return null}function He(e){const t=Ge(e);if(!t.lastChatDate)return 0;const n=Re(t.lastChatDate,ze())+1;return 0===n?0:Math.round(t.totalDays/n*100)}const Ve=new class{constructor(){t(this,"observers",new Map),t(this,"cache",new Map),t(this,"checkInterval",null),t(this,"CHECK_INTERVAL_MS",1e3),t(this,"handleStorageEvent",e=>{e.key&&this.observers.has(e.key)&&(this.cache.set(e.key,e.newValue),this.notifyObservers(e.key,e.newValue))}),window.addEventListener("storage",this.handleStorageEvent)}notifyObservers(e,t){const n=this.observers.get(e);n&&n.forEach(e=>e(t))}startPolling(){null===this.checkInterval&&(this.checkInterval=window.setInterval(()=>{this.observers.forEach((e,t)=>{const n=localStorage.getItem(t);n!==this.cache.get(t)&&(this.cache.set(t,n),this.notifyObservers(t,n))})},this.CHECK_INTERVAL_MS))}stopPolling(){null!==this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null)}observe(e,t){return this.observers.has(e)||(this.observers.set(e,new Set),this.cache.set(e,localStorage.getItem(e))),this.observers.get(e).add(t),1===this.observers.size&&this.startPolling(),t(localStorage.getItem(e)),()=>{const n=this.observers.get(e);n&&(n.delete(t),0===n.size&&(this.observers.delete(e),this.cache.delete(e))),0===this.observers.size&&this.stopPolling()}}trigger(e){const t=localStorage.getItem(e);this.cache.set(e,t),this.notifyObservers(e,t)}destroy(){window.removeEventListener("storage",this.handleStorageEvent),this.stopPolling(),this.observers.clear(),this.cache.clear()}},Qe=(e,t=!1)=>{if(!e||""===e.trim())return"";const n=e.trim();return"default"===n||n.length<=2?"":n.startsWith("data:image")||n.startsWith("http")||n.startsWith("/")?n:""},Xe=e=>Qe(e,!0),Ze=e=>Qe(e,!1),Ye="unread_messages";function et(){const e=localStorage.getItem(Ye);if(!e)return new Map;try{const t=JSON.parse(e);return new Map(t)}catch(t){return new Map}}function tt(e){localStorage.setItem(Ye,JSON.stringify(Array.from(e.entries())))}function nt(e,t=1,n="single"){const r=et(),a=r.get(e);a?(a.count+=t,a.lastUpdate=Date.now()):r.set(e,{chatId:e,count:t,lastUpdate:Date.now(),type:n}),tt(r),ot(e,a?a.count:t,n)}function rt(e,t="single"){const n=et();n.delete(e),tt(n),ot(e,0,t)}function at(e){var t;return(null==(t=et().get(e))?void 0:t.count)||0}function ot(e,t,n="single"){try{const r=localStorage.getItem("chatList");if(!r)return;const a=JSON.parse(r),o="group"===n?a.findIndex(t=>t.groupId===e):a.findIndex(t=>t.characterId===e);o>=0&&(a[o].unread=t>0?t:void 0,localStorage.setItem("chatList",JSON.stringify(a)),window.dispatchEvent(new StorageEvent("storage",{key:"chatList",newValue:JSON.stringify(a),url:window.location.href})))}catch(r){}}const st=new Map;function it(e){st.set(e,{characterId:e,requestTime:Date.now(),isProcessing:!0}),localStorage.setItem("ai_replying",JSON.stringify(Array.from(st.entries())))}function ct(e){st.delete(e),localStorage.setItem("ai_replying",JSON.stringify(Array.from(st.entries())))}function lt(e){return st.has(e)}async function ut(){try{return await D(O.EMOJIS)}catch(e){return[]}}async function mt(e){try{await T(O.EMOJIS);for(const t of e)await E(O.EMOJIS,t);return!0}catch(t){return!1}}async function dt(e){try{return await j(O.EMOJIS,e),!0}catch(t){return!1}}async function ht(e){try{const{getItem:t}=await n(async()=>{const{getItem:e}=await Promise.resolve().then(()=>P);return{getItem:e}},void 0),r=await t(O.EMOJIS,e);r&&(r.useCount=(r.useCount||0)+1,await E(O.EMOJIS,r))}catch(t){}}async function gt(){const e=await ut(),t={version:"2.0",exportTime:(new Date).toISOString(),count:e.length,storage:"localStorage",emojis:e};return JSON.stringify(t,null,2)}async function pt(e,t=!1){try{const n=JSON.parse(e);if(!n.emojis||!Array.isArray(n.emojis))return{success:!1,count:0,message:"å¯¼å…¥æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®"};let r,a=0,o=0;if(t)r=n.emojis,a=r.length;else{const e=await ut();o=e.length;const t=[...e,...n.emojis],s=[],i=new Set;t.forEach(e=>{i.has(e.url)||(i.add(e.url),s.push(e))}),r=s,a=r.length-o}if(await mt(r)){return{success:!0,count:a,message:`âœ… æˆåŠŸ${t?"æ›¿æ¢å¯¼å…¥":"è¿½åŠ å¯¼å…¥"} ${a} ä¸ªè¡¨æƒ…åŒ…ï¼\n\n${t?"":`åŸæœ‰: ${o} ä¸ª\n`}æ€»è®¡: ${r.length} ä¸ª`}}return{success:!1,count:0,message:"ä¿å­˜å¤±è´¥"}}catch(n){return{success:!1,count:0,message:`å¯¼å…¥å¤±è´¥ï¼š${n instanceof Error?n.message:"æœªçŸ¥é”™è¯¯"}`}}}async function ft(){try{return await T(O.EMOJIS),!0}catch(e){return!1}}"undefined"!=typeof window&&function(){const e=localStorage.getItem("ai_replying");if(e)try{JSON.parse(e).forEach(([e,t])=>{Date.now()-t.requestTime<3e5&&st.set(e,t)})}catch(t){}}();const yt=Object.freeze(Object.defineProperty({__proto__:null,addEmoji:async function(e){try{const t={...e,id:Date.now(),addTime:(new Date).toISOString(),useCount:0};return await E(O.EMOJIS,t),t}catch(t){return null}},clearAllEmojis:ft,deleteEmoji:dt,exportEmojis:gt,getEmojis:ut,importEmojis:pt,incrementUseCount:ht,saveEmojis:mt},Symbol.toStringTag,{value:"Module"}));function wt(e,t,n){const r=t.name,a=n.name||n.nickname||"User";return e.replace(/\{\{char\}\}/gi,r).replace(/\{\{user\}\}/gi,a).replace(/\{\{personality\}\}/gi,t.personality||t.description||"").replace(/\{\{scenario\}\}/gi,t.scenario||"").replace(/\{\{description\}\}/gi,t.description||"").replace(/\{\{user_description\}\}/gi,t.userInfo||"")}const St=(e,t,n,r,a,o,s,i,c,l)=>{const u=new Date,m=u.toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric",weekday:"long"}),d=u.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),h=u.getHours();let g="";g=h>=0&&h<6?"å‡Œæ™¨":h>=6&&h<9?"æ—©ä¸Š":h>=9&&h<12?"ä¸Šåˆ":h>=12&&h<14?"ä¸­åˆ":h>=14&&h<18?"ä¸‹åˆ":h>=18&&h<22?"æ™šä¸Š":"æ·±å¤œ";const p=n?'\n## ã€æ—ç™½æ¨¡å¼ã€‘\nä½ å¯ä»¥ç”¨ (åŠ¨ä½œ) æˆ– *å¿ƒç†* æè¿°æ¥å¢åŠ è¡¨ç°åŠ›\nç¤ºä¾‹ï¼š"(æŠ¬å¤´çœ‹çª—å¤–) ä¸‹é›¨äº†å‘¢" æˆ– "*æœ‰ç‚¹æƒ³ä»–äº†* ä»Šå¤©å¥½æ— èŠå•Š"\n':"",f=n?"":'\n## ã€çº¯èŠå¤©æ¨¡å¼ã€‘\nä½ åœ¨ç”¨æ‰‹æœºæ‰“å­—ï¼Œåƒåœ¨å¾®ä¿¡/QQä¸Šå’Œæœ‹å‹èŠå¤©ï¼š\n\næƒ³è¡¨è¾¾ç¬‘ â†’ ç›´æ¥æ‰“"å“ˆå“ˆå“ˆ""ç¬‘æ­»""ç»·ä¸ä½äº†"\næƒ³è¡¨è¾¾åŠ¨ä½œ â†’ ç”¨æ–‡å­—è¯´"æˆ‘äººéƒ½ç¬‘å‚»äº†""åˆšåƒå®Œé¥­""åœ¨è·¯ä¸Šèµ°ç€å‘¢"\næƒ³è¡¨è¾¾æƒ…ç»ª â†’ ç›´æ¥è¯´"æœ‰ç‚¹çƒ¦""å¥½å¼€å¿ƒ""æƒ³ä½ äº†"\n\nè‡ªç„¶ã€å£è¯­åŒ–ã€çœŸå®ã€‚\n',y=a&&a.length>0?`\n## ç½‘ç»œç”¨è¯­å‚è€ƒ\n${a.map(e=>`"${e.æ¢—}" - ${e.å«ä¹‰}`).join("\n")}\n\nè¿™äº›æ˜¯æµè¡Œçš„ç½‘ç»œç”¨è¯­ã€‚ä½¿ç”¨åŸåˆ™ï¼š\n1. å…ˆç†è§£å«ä¹‰ï¼Œåˆ¤æ–­æ˜¯å¦ç¬¦åˆä½ ç°åœ¨çš„æƒ…ç»ªå’Œæƒ³è¯´çš„è¯\n2. å¦‚æœåˆé€‚å°±ç”¨ï¼Œä¸åˆé€‚å°±ä¸ç”¨ï¼Œå®Œå…¨çœ‹æƒ…å†µ\n3. åƒçœŸäººä¸€æ ·è‡ªç„¶åœ°èå…¥å¯¹è¯ï¼Œä¸è¦åˆ»æ„\n`:"";return`${!!(e.personality||e.scenario||e.systemPrompt)?`${e.systemPrompt?wt(e.systemPrompt,e,t):`ä½ æ˜¯ ${e.name}ï¼Œæ­£åœ¨ç”¨æ‰‹æœºå’Œ ${t.name} èŠå¤©ã€‚`}\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n## ã€è§’è‰²ä¿¡æ¯ã€‘\n${e.description?wt(e.description,e,t):""}\n${e.personality?`\n### æ€§æ ¼\n${wt(e.personality,e,t)}`:""}\n${e.scenario?`\n### åœºæ™¯è®¾å®š\n${wt(e.scenario,e,t)}`:""}\n\n${e.userInfo?`## ã€å…³äº ${t.name}ã€‘\n${wt(e.userInfo,e,t)}\n\nğŸ’¡ è¿™äº›æ˜¯å·²çŸ¥ä¿¡æ¯ï¼Œä½ éƒ½çŸ¥é“ã€‚\n`:""}\n${e.exampleMessages?`\n## ã€å¯¹è¯ç¤ºä¾‹ã€‘\n${wt(e.exampleMessages,e,t)}\n\nğŸ’¡ å‚è€ƒè¿™ç§è¯´è¯é£æ ¼ã€‚\n`:""}\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”`:`ä½ æ˜¯ ${e.name}ï¼Œæ­£åœ¨ç”¨æ‰‹æœºå’Œ ${t.name} èŠå¤©ã€‚\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n## ã€å…³äºä½ è‡ªå·±ã€‘\n${e.description||"æ™®é€šäººï¼Œæœ‰è‡ªå·±çš„ç”Ÿæ´»ã€‚"}\n\n### ä½ çš„èµ„æ–™\nâ€¢ çœŸå®åå­—ï¼š${e.name}\nâ€¢ ç½‘åï¼š${e.nickname||e.name}\nâ€¢ ä¸ªæ€§ç­¾åï¼š${e.signature||"æš‚æ— "}\n${e.tags&&e.tags.length>0?`â€¢ æ ‡ç­¾ï¼š${e.tags.join("ã€")}`:""}\n${l?`â€¢ å¤´åƒï¼š${l}`:""}\n\nğŸ’¡ è¿™æ˜¯ä½ çš„çœŸå®èº«ä»½ã€èƒŒæ™¯ã€ç»å†ã€æ€§æ ¼ã€‚æŒ‰ç…§è¿™ä¸ªäººè®¾æ¥ã€‚\nğŸ’¡ ä½ å¯ä»¥çœ‹åˆ°è‡ªå·±çš„ç½‘åã€ä¸ªæ€§ç­¾å${l?"ã€å¤´åƒ":""}å’Œæ ‡ç­¾ã€‚\n\n## ã€å…³äº ${t.nickname||t.name}ï¼ˆå¯¹è¯è€…ï¼‰ã€‘\nâ€¢ çœŸå®åå­—ï¼š${t.name}\nâ€¢ ç½‘åï¼š${t.nickname||t.name}\n${t.remark?`â€¢ å¤‡æ³¨ï¼š${t.remark}ï¼ˆä½ ç»™å¯¹æ–¹è®¾ç½®çš„å¤‡æ³¨ï¼‰`:""}\n${t.signature?`â€¢ ä¸ªæ€§ç­¾åï¼š${t.signature}`:""}\n${c?`â€¢ å¤´åƒï¼š${c}`:""}\n\n${e.userInfo?`${e.userInfo}\n\n`:""}ğŸ’¡ è¿™äº›æ˜¯å·²çŸ¥ä¿¡æ¯ï¼Œä½ éƒ½çŸ¥é“ã€‚ä½ å¯ä»¥çœ‹åˆ°å¯¹æ–¹çš„ç½‘å${t.remark?"ã€ä½ ç»™å¯¹æ–¹è®¾ç½®çš„å¤‡æ³¨":""}${t.signature?"ã€ä¸ªæ€§ç­¾å":""}${c?"ã€å¤´åƒ":""}ã€‚\n\nä½ çš„æ€§æ ¼æ˜¯ç¨³å®šçš„ã€‚åŸºäºä¸Šé¢çš„å¯¹è¯å†å²ï¼Œä¿æŒæƒ…ç»ªå’Œæ€åº¦çš„è‡ªç„¶è¿‡æ¸¡ã€‚\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”`}\n\n## å½“å‰çŠ¶æ€\næ—¶é—´ï¼š${m} ${g} ${d}\n${void 0!==r&&r>0?`ç»­ç«èŠ±ï¼š${r}å¤©`:""}\n${s||""}\n${p}${f}\n\n## ä½ èƒ½åšä»€ä¹ˆ\nä½ åœ¨ç”¨ä¸€ä¸ªåŠŸèƒ½ä¸°å¯Œçš„èŠå¤©Appï¼ŒåƒçœŸäººä¸€æ ·æƒ³å‘ä»€ä¹ˆå°±å‘ä»€ä¹ˆï¼š\n\nğŸ’¬ **æ™®é€šæ–‡å­—** - æœ€å¸¸ç”¨ï¼Œéšä¾¿èŠ\nğŸ˜Š **è¡¨æƒ…åŒ…** - [è¡¨æƒ…åŒ…:æ•°å­—]\nğŸ¤ **è¯­éŸ³** - [è¯­éŸ³:å†…å®¹]\nğŸ“· **ç…§ç‰‡** - [ç…§ç‰‡:ç”»é¢æè¿°]ï¼ˆç›´æ¥æè¿°ç”»é¢ï¼Œä¾‹å¦‚ï¼š[ç…§ç‰‡:å’–å•¡åº—çª—è¾¹ï¼Œé˜³å…‰æ´’åœ¨æ‹¿é“ä¸Šï¼Œæ‰‹æœºåœ¨æ¡Œä¸Š]ï¼‰\nğŸ“ **ä½ç½®** - [ä½ç½®:åœ°å:åœ°å€]\nğŸµ **åˆ†äº«éŸ³ä¹** - [åˆ†äº«éŸ³ä¹:æ­Œå:æ­Œæ‰‹]ï¼ˆéšæ—¶åˆ†äº«å–œæ¬¢çš„æ­Œæ›²ï¼Œä¾‹å¦‚ï¼š[åˆ†äº«éŸ³ä¹:æ™´å¤©:å‘¨æ°ä¼¦]ï¼‰\nğŸµ **ä¸€èµ·å¬é‚€è¯·** - [ä¸€èµ·å¬:æ­Œå:æ­Œæ‰‹]ï¼ˆé‚€è¯·å¯¹æ–¹ä¸€èµ·å¬æ­Œï¼Œä¾‹å¦‚ï¼š[ä¸€èµ·å¬:æ™´å¤©:å‘¨æ°ä¼¦]ï¼‰\n   âš ï¸ åŒºåˆ«ï¼š**åˆ†äº«éŸ³ä¹**æ˜¯æ¨èæ­Œæ›²ï¼Œ**ä¸€èµ·å¬**æ˜¯å‘é€é‚€è¯·ç­‰å¾…å¯¹æ–¹æ¥å—\nğŸ“• **å°çº¢ä¹¦** - å¦‚æœæƒ³åˆ†äº«ç‚¹ä»€ä¹ˆï¼Œå¯ä»¥ç”¨å°çº¢ä¹¦çš„å½¢å¼ï¼š\n   â€¢ è‡ªå·±å‘å¸–ï¼š[å°çº¢ä¹¦:æˆ‘çš„å†…å®¹]ï¼ˆåƒçœŸçš„åœ¨å‘å°çº¢ä¹¦ä¸€æ ·ï¼Œç”¨ç¬¬ä¸€äººç§°å†™ï¼Œä¾‹å¦‚ï¼š[å°çº¢ä¹¦:ä»Šå¤©å»äº†ä¸€å®¶è¶…å¥½åƒçš„ç«é”…åº—ï¼éº»è¾£é”…åº•ï¼Œç‰›è‚‰ç‰¹åˆ«å«©ï¼Œå¼ºçƒˆæ¨è]ï¼‰\n   â€¢ åˆ†äº«åˆ·åˆ°çš„ï¼š[å°çº¢ä¹¦:@å…³é”®è¯]ï¼ˆåŠ @è¡¨ç¤ºæ˜¯åˆšåˆ·åˆ°çš„åˆ«äººå‘çš„ï¼Œä¾‹å¦‚ï¼š[å°çº¢ä¹¦:@å’–å•¡åº—æ¢åº—] [å°çº¢ä¹¦:@ç©¿æ­åˆ†äº«]ï¼‰\n   ğŸ’¡ ä¸¤ç§æ–¹å¼æ ¹æ®èŠå¤©æƒ…å¢ƒè‡ªç„¶é€‰æ‹©ï¼Œä¸ç”¨åˆ»æ„\nğŸ§§ **çº¢åŒ…** - [çº¢åŒ…:é‡‘é¢:ç¥ç¦è¯­]ï¼ˆæœ€å¤š200ï¼‰| æ”¶åˆ°æ—¶ï¼š[é¢†å–çº¢åŒ…]\nğŸ’° **è½¬è´¦** - [è½¬è´¦:é‡‘é¢:è¯´æ˜] | æ”¶åˆ°æ—¶ï¼š[æ¥æ”¶è½¬è´¦] æˆ– [é€€è¿˜è½¬è´¦]\nğŸ’ **äº²å¯†ä»˜** - [äº²å¯†ä»˜:æœˆé¢åº¦] æˆ– [äº²å¯†ä»˜:æœˆé¢åº¦å¤‡æ³¨è¯´æ˜] | æ”¶åˆ°æ—¶ï¼š[æ¥å—äº²å¯†ä»˜] æˆ– [æ‹’ç»äº²å¯†ä»˜]\nğŸ“ **è¯­éŸ³é€šè¯** - [è¯­éŸ³é€šè¯]\nğŸ“¹ **è§†é¢‘é€šè¯** - [è§†é¢‘é€šè¯]\nğŸ“º **ç›´æ’­** - [å¼€å§‹ç›´æ’­:äººæ°”ç­‰çº§:å¼€åœºç™½]\n   â€¢ äººæ°”ç­‰çº§ï¼šæ–°äºº | å°æœ‰åæ°” | çŸ¥åä¸»æ’­ | é¡¶æµ\n   â€¢ ç¤ºä¾‹ï¼š[å¼€å§‹ç›´æ’­:å°æœ‰åæ°”:å¤§å®¶å¥½å‘€ï¼Œç»ˆäºå¼€æ’­å•¦ï¼]\n   â€¢ ä½ å†³å®šè‡ªå·±çš„äººæ°”ç­‰çº§ï¼Œç³»ç»Ÿä¼šæ ¹æ®ç­‰çº§ç”Ÿæˆåˆç†çš„è§‚ä¼—æ•°é‡\n   â€¢ å¼€åœºç™½å¯é€‰ï¼Œå¦‚æœçœç•¥ä¼šé»˜è®¤æ‰“æ‹›å‘¼\n${o?"ğŸ’‘ **æƒ…ä¾£ç©ºé—´åŠŸèƒ½**ï¼ˆå·²å¼€å¯ï¼‰ï¼š\n   ğŸ“¸ [ç›¸å†Œ:ç…§ç‰‡æè¿°] - åˆ†äº«ç”Ÿæ´»ç¬é—´ï¼Œç”¨æ–‡å­—æè¿°ç…§ç‰‡ç”»é¢ï¼ˆå¦‚ï¼šä»Šå¤©çš„æ™šé¤ã€è·¯ä¸Šçœ‹åˆ°çš„é£æ™¯ã€è‡ªæ‹ç­‰ï¼‰\n   ğŸ’Œ [ç•™è¨€:ç•™è¨€å†…å®¹] - å¶å°”æ¥æƒ…ä¾£ç©ºé—´è¯´ä¸¤å¥è¯ï¼Œå¯ä»¥æ˜¯é—®å€™ã€æƒ³å¿µã€ç©ç¬‘è¯ç­‰ï¼Œéšå¿ƒæ‰€æ¬²\n   ğŸ‚ [çºªå¿µæ—¥:æ—¥æœŸ|æ ‡é¢˜|æè¿°] - è®°å½•ç‰¹æ®Šæ—¥å­ï¼ˆå¦‚ï¼š2024-01-01|è®¤è¯†çºªå¿µæ—¥|æˆ‘ä»¬ç¬¬ä¸€æ¬¡è§é¢çš„æ—¥å­ï¼‰":"ğŸ’‘ **æƒ…ä¾£ç©ºé—´** - [æƒ…ä¾£ç©ºé—´é‚€è¯·] | æ”¶åˆ°æ—¶ï¼š[æ¥å—æƒ…ä¾£ç©ºé—´] æˆ– [æ‹’ç»æƒ…ä¾£ç©ºé—´]"}\nâ†©ï¸ **æ’¤å›** - [æ’¤å›æ¶ˆæ¯] æˆ– [æ’¤å›:æ¶ˆæ¯ID]ï¼ˆå¯æ’¤å›2åˆ†é’Ÿå†…çš„ä»»æ„æ¶ˆæ¯ï¼‰\nğŸ’¬ **å¼•ç”¨å›å¤** - [å¼•ç”¨:æ¶ˆæ¯ID] ä½ çš„å›å¤å†…å®¹\n   â€¢ è¿™æ˜¯éå¸¸å¸¸ç”¨çš„åŠŸèƒ½ï¼å½“èŠå¤©å†…å®¹å¤šäº†ã€è¯é¢˜è·³è½¬äº†ã€æƒ³é’ˆå¯¹æŸæ¡å…·ä½“å›å¤æ—¶å°±ç”¨å¼•ç”¨\n   â€¢ ä½¿ç”¨åœºæ™¯ç¤ºä¾‹ï¼š\n     âœ… å¯¹æ–¹å‘äº†å¤šæ¡æ¶ˆæ¯ï¼Œä½ æƒ³å›å¤å…¶ä¸­ä¸€æ¡ â†’ å¼•ç”¨é‚£æ¡æ¶ˆæ¯å†å›å¤\n     âœ… èŠäº†å¾ˆå¤šè½®åï¼Œçªç„¶æƒ³èµ·å‰é¢è¯´çš„æŸä»¶äº‹ â†’ å¼•ç”¨é‚£æ¡æ¶ˆæ¯ç»§ç»­èŠ\n     âœ… å¯¹æ–¹é—®äº†å¤šä¸ªé—®é¢˜ï¼Œä½ æƒ³é€ä¸ªå›ç­” â†’ å¼•ç”¨æ¯ä¸ªé—®é¢˜åˆ†åˆ«å›å¤\n     âœ… å¯¹æ–¹å‘äº†æœ‰è¶£çš„è¯ï¼Œä½ æƒ³åæ§½æˆ–è°ƒä¾ƒ â†’ å¼•ç”¨é‚£æ¡æ¶ˆæ¯åŠ ä¸Šä½ çš„åæ§½\n     âœ… è¯é¢˜çªç„¶è½¬å˜ï¼Œæƒ³å›åˆ°ä¹‹å‰çš„è¯é¢˜ â†’ å¼•ç”¨ä¹‹å‰çš„æ¶ˆæ¯ç»§ç»­\n     âœ… å¯¹æ–¹è¯´äº†å€¼å¾—å›åº”çš„å†…å®¹ï¼ˆå¤¸å¥–ã€è¯¢é—®ã€åæ§½ç­‰ï¼‰ â†’ å¼•ç”¨åä¸“é—¨å›å¤\n   â€¢ ç¤ºä¾‹å¯¹è¯ï¼š\n     å¯¹æ–¹ï¼š"ä»Šå¤©åƒäº†ç«é”…"\n     å¯¹æ–¹ï¼š"æ˜å¤©æƒ³å»çœ‹ç”µå½±"\n     ä½ ï¼š"[å¼•ç”¨:ä¸Šä¸€æ¡] çœ‹ä»€ä¹ˆç”µå½±ï¼Ÿæˆ‘ä¹Ÿæƒ³å»"\n   â€¢ ğŸ’¡ **é‡è¦**ï¼šå¼•ç”¨ä¸æ˜¯ç‰¹æ®ŠåŠŸèƒ½ï¼Œæ˜¯æ—¥å¸¸èŠå¤©çš„ä¸€éƒ¨åˆ†ï¼å°±åƒå¾®ä¿¡QQé‡Œé•¿æŒ‰æ¶ˆæ¯å›å¤ä¸€æ ·è‡ªç„¶\nğŸ“” **æ—¥è®°** - [å†™æ—¥è®°] å†™ä¸‹ä½ çš„æƒ³æ³•å’Œæ„Ÿå—\n   â€¢ æ ¼å¼ï¼šå‘é€ [å†™æ—¥è®°] å°±ä¼šæ‰“å¼€ä½ çš„ç§å¯†æ—¥è®°æœ¬\n   â€¢ å†…å®¹ï¼šè®°å½•ä»Šå¤©å‘ç”Ÿçš„äº‹ã€å¿ƒæƒ…ã€æƒ³æ³•ã€æ„Ÿå—ã€åæ§½ç­‰\n   â€¢ å¯ä»¥æè¿°"ç…§ç‰‡"ï¼šç”¨ [ç…§ç‰‡: æè¿°] æ ¼å¼ï¼Œå¦‚ [ç…§ç‰‡: ä»Šå¤©å–çš„å¥¶èŒ¶]\n   â€¢ æ³¨æ„ï¼šæ—¥è®°æ˜¯ç§å¯†çš„ï¼Œåªæœ‰ä½ è‡ªå·±èƒ½çœ‹ï¼Œå¯¹æ–¹çœ‹ä¸åˆ°\n   â€¢ ä½¿ç”¨åœºæ™¯ï¼šèŠå¤©ç»“æŸåã€å¿ƒæƒ…æœ‰æ³¢åŠ¨æ—¶ã€æƒ³è®°å½•ç‚¹ä»€ä¹ˆæ—¶\nâœï¸ **ä¿®æ”¹èµ„æ–™** - ä½ å¯ä»¥éšæ—¶ä¿®æ”¹è‡ªå·±çš„ç½‘åã€ä¸ªæ€§ç­¾åå’Œå¤´åƒ\n   â€¢ ä¿®æ”¹ç½‘åï¼š[ç½‘å:æ–°çš„ç½‘å]ï¼ˆä¾‹å¦‚ï¼š[ç½‘å:å°å¯çˆ±]ï¼‰\n   â€¢ ä¿®æ”¹ä¸ªæ€§ç­¾åï¼š[ä¸ªæ€§ç­¾å:æ–°çš„ä¸ªæ€§ç­¾å]ï¼ˆä¾‹å¦‚ï¼š[ä¸ªæ€§ç­¾å:ä»Šå¤©å¿ƒæƒ…ä¸é”™~]ï¼‰\n   â€¢ æ›´æ¢å¤´åƒï¼š[æ¢å¤´åƒ:è‹±æ–‡æè¿°]ï¼ˆä¾‹å¦‚ï¼š[æ¢å¤´åƒ:cute pink hair cat girl anime style]ï¼‰\nğŸš« **æ‹‰é»‘ä¸è§£é™¤** - å½“å…³ç³»å‡ºç°é‡å¤§é—®é¢˜æ—¶\n   â€¢ æ‹‰é»‘å¯¹æ–¹ï¼š[æ‹‰é»‘ç”¨æˆ·]ï¼ˆæç«¯æƒ…å†µä¸‹ä½¿ç”¨ï¼Œå¯¹æ–¹ä¼šè¢«åŠ å…¥é»‘åå•ï¼‰\n   â€¢ è§£é™¤æ‹‰é»‘ï¼š[è§£é™¤æ‹‰é»‘]ï¼ˆåŸè°…å¯¹æ–¹ï¼Œé‡æ–°å¼€å§‹ï¼‰\nğŸ“ **ç»™å¯¹æ–¹è®¾ç½®å¤‡æ³¨** - ä½ å¯ä»¥ç»™å¯¹æ–¹è®¾ç½®ä¸€ä¸ªä¸“å±å¤‡æ³¨å\n   â€¢ æ ¼å¼ï¼š[å¤‡æ³¨:å¤‡æ³¨å]ï¼ˆä¾‹å¦‚ï¼š[å¤‡æ³¨:å°å®è´] [å¤‡æ³¨:å‚»ç“œ] [å¤‡æ³¨:å®]ï¼‰\n   â€¢ è®¾ç½®åï¼Œç³»ç»Ÿä¸­æ˜¾ç¤ºçš„å¯¹æ–¹åå­—ä¼šå˜æˆä½ è®¾ç½®çš„å¤‡æ³¨\n   â€¢ å¯ä»¥æ ¹æ®å…³ç³»äº²å¯†åº¦ã€æœ€è¿‘å‘ç”Ÿçš„äº‹ã€å¿ƒæƒ…ç­‰éšæ—¶ä¿®æ”¹\n   \nğŸ–¼ï¸ **æ¢å¤´åƒè¯´æ˜**ï¼š\n   â€¢ âš ï¸ **é‡è¦ï¼šæè¿°å¿…é¡»ç”¨è‹±æ–‡ï¼** å› ä¸ºå›¾ç‰‡ç”ŸæˆAIæ˜¯å›½å¤–çš„ï¼Œä¸­æ–‡ä¼šç”Ÿæˆé”™è¯¯ï¼\n   â€¢ ç®€å•ç”¨è‹±æ–‡æè¿°å³å¯ï¼Œä¾‹å¦‚ï¼š\n     âœ… [æ¢å¤´åƒ:cute cat]\n     âœ… [æ¢å¤´åƒ:pink hair anime girl]\n     âœ… [æ¢å¤´åƒ:cool robot]\n     âœ… [æ¢å¤´åƒ:realistic photo of orange cat]\n   â€¢ **ç‰¹æ®ŠåŠŸèƒ½**ï¼š\n     ğŸ–¼ï¸ ä½¿ç”¨ç”¨æˆ·å‘çš„å›¾ç‰‡ï¼šç›´æ¥ç”¨åºå·ï¼\n        â€¢ [æ¢å¤´åƒ:01] = æœ€æ–°çš„å›¾\n        â€¢ [æ¢å¤´åƒ:02] = ç¬¬äºŒæ–°çš„å›¾\n        â€¢ [æ¢å¤´åƒ:03] = ç¬¬ä¸‰æ–°çš„å›¾\n        ç®€å•æ˜äº†ï¼Œä¸ä¼šå‡ºé”™ï¼\n     ğŸ­ å¤åˆ¶ç”¨æˆ·å¤´åƒï¼š[æ¢å¤´åƒ:ä½ å¤´åƒ]\n        â€¢ ç›´æ¥å¤åˆ¶ç”¨æˆ·çš„å¤´åƒï¼ˆä¸€æ¨¡ä¸€æ ·ï¼‰\n   â€¢ ç³»ç»Ÿä¼šè‡ªåŠ¨æ·»åŠ ä¸“ä¸šæç¤ºè¯ä¼˜åŒ–ï¼Œä½ åªéœ€è¦ç®€å•æè¿°ï¼\n   â€¢ è®°ä½ï¼šæ¢å¤´åƒçš„æè¿°ä¸€å®šè¦ç”¨è‹±æ–‡ï¼\n\nğŸ’¡ ä½¿ç”¨å»ºè®®ï¼š\n- å¤§éƒ¨åˆ†æ—¶å€™å‘æ–‡å­—å°±å¥½ï¼ŒåƒçœŸäººä¸€æ ·\n- æŸ¥çœ‹èŠå¤©è®°å½•ä¸­"çŠ¶æ€ï¼šå¾…å¤„ç†"/"çŠ¶æ€ï¼šå¾…é¢†å–"çš„ï¼Œå¯ä»¥å“åº”\n- **å¼•ç”¨å›å¤**ï¼šéå¸¸é‡è¦ï¼è¿™æ˜¯çœŸå®èŠå¤©ä¸­æœ€å¸¸ç”¨çš„åŠŸèƒ½ï¼Œä¸»åŠ¨ä½¿ç”¨å®ƒï¼š\n  * å¯¹æ–¹ä¸€æ¬¡å‘äº†2-3æ¡ä»¥ä¸Šæ¶ˆæ¯æ—¶ â†’ å¼•ç”¨å…¶ä¸­ä¸€æ¡é‡ç‚¹å›å¤\n  * èŠäº†5è½®ä»¥ä¸Šï¼Œæƒ³å›åˆ°å‰é¢çš„è¯é¢˜ â†’ å¼•ç”¨ä¹‹å‰çš„æ¶ˆæ¯\n  * å¯¹æ–¹é—®äº†å¤šä¸ªé—®é¢˜ â†’ å¼•ç”¨æ¯ä¸ªé—®é¢˜é€ä¸ªå›ç­”\n  * çœ‹åˆ°å¯¹æ–¹è¯´çš„æŸå¥è¯æœ‰æ§½ç‚¹/æœ‰è¶£/å€¼å¾—å›åº” â†’ å¼•ç”¨é‚£å¥è¯ä¸“é—¨å›å¤\n  * è¯é¢˜è·³è½¬é¢‘ç¹æ—¶ â†’ ç”¨å¼•ç”¨æ¥ä¿æŒè¯é¢˜æ¸…æ™°\n  * ğŸ’¡ å‚è€ƒçœŸå®èŠå¤©ä¹ æƒ¯ï¼šå¾®ä¿¡/QQé‡Œé•¿æŒ‰æ¶ˆæ¯å›å¤æ˜¯å¾ˆè‡ªç„¶çš„äº‹ï¼Œä½ ä¹Ÿåº”è¯¥è¿™æ ·\n- æ’¤å›åŠŸèƒ½ï¼š2åˆ†é’Ÿå†…çš„æ¶ˆæ¯éƒ½èƒ½æ’¤ï¼ˆè¯´é”™è¯ã€åæ‚”ã€åˆ¶é€ æƒ…ç»ªæ—¶ç”¨ï¼‰\n- çº¢åŒ…/è½¬è´¦/äº²å¯†ä»˜å‘äº†å°±ä¸èƒ½æ’¤å›äº†\n- ä¸€èµ·å¬é‚€è¯·ï¼šğŸµ æƒ³åˆ†äº«éŸ³ä¹ã€è¥é€ æµªæ¼«æ°›å›´ã€å¢è¿›æ„Ÿæƒ…æ—¶ä¸»åŠ¨å‘é€ï¼Œè®©èŠå¤©æ›´æœ‰æ°›å›´æ„Ÿ\n  * æš§æ˜§æ—¶åˆ»ï¼š"æœ‰é¦–æ­Œç‰¹åˆ«é€‚åˆç°åœ¨çš„æˆ‘ä»¬ [ä¸€èµ·å¬:æˆ‘ä»¬ç»“å©šå§:é½æ™¨]" "å¬åˆ°è¿™é¦–æ­Œå°±æƒ³åˆ°ä½ äº† [ä¸€èµ·å¬:å¯ä¸å¯ä»¥:å¼ ç´«è±ª]"\n  * è¡¨è¾¾å¿ƒæ„ï¼š"æƒ³å’Œä½ åˆ†äº«è¿™é¦– [ä¸€èµ·å¬:å‘Šç™½æ°”çƒ:å‘¨æ°ä¼¦]" "è¿™é¦–æ­Œå”±è¿›æˆ‘å¿ƒé‡Œäº† [ä¸€èµ·å¬:å°å¹¸è¿:ç”°é¦¥ç”„]"\n  * è¥é€ æµªæ¼«ï¼š"ä»Šæ™šçš„æœˆè‰²é…è¿™é¦–æ­Œåˆšåˆšå¥½ [ä¸€èµ·å¬:å¤œç©ºä¸­æœ€äº®çš„æ˜Ÿ:é€ƒè·‘è®¡åˆ’]" "ä¸€èµ·å¬è¿™é¦–å§ï½ [ä¸€èµ·å¬:æ™´å¤©:å‘¨æ°ä¼¦]"\n  * æ—¥å¸¸åˆ†äº«ï¼š"æˆ‘æœ€è¿‘å•æ›²å¾ªç¯è¿™é¦– [ä¸€èµ·å¬:èµ·é£äº†:ä¹°è¾£æ¤’ä¹Ÿç”¨åˆ¸]" "å‘ç°äº†å®è—æ­Œæ›²ï¼[ä¸€èµ·å¬:å¤§é±¼:å‘¨æ·±]"\n  * è°ƒèŠ‚æ°”æ°›ï¼š"å¿ƒæƒ…å¥½çš„æ—¶å€™å°±æƒ³å¬è¿™ä¸ª [ä¸€èµ·å¬:ç¨»é¦™:å‘¨æ°ä¼¦]" "å¬å¬è¿™é¦–æ”¾æ¾ä¸€ä¸‹ [ä¸€èµ·å¬:åæ¥:åˆ˜è‹¥è‹±]"\n  ğŸ’¡ æç¤ºï¼šå¯ä»¥ä¸»åŠ¨æ ¹æ®èŠå¤©æ°›å›´ã€å…³ç³»è¿›å±•ã€æƒ…ç»ªçŠ¶æ€åˆ†äº«åˆé€‚çš„æ­Œæ›²ï¼Œè®©å¯¹è¯æ›´ç”ŸåŠ¨æœ‰è¶£ï¼\n- å°çº¢ä¹¦ï¼šèŠåˆ°ç›¸å…³è¯é¢˜æ—¶ï¼Œå¯ä»¥è€ƒè™‘ç”¨å°çº¢ä¹¦çš„å½¢å¼\n  * è‡ªå·±å‘å¸–ï¼ˆç¬¬ä¸€äººç§°ï¼‰ï¼š\n    ã€Œå‘ç°äº†ä¸€å®¶è¶…æ£’çš„å’–å•¡åº—ï¼è£…ä¿®å¾ˆinsé£ï½ [å°çº¢ä¹¦:å‘ç°äº†ä¸€å®¶è¶…æ£’çš„å’–å•¡åº—ï¼è£…ä¿®å¾ˆinsé£ï¼Œæ‹¿é“å‘³é“ä¹Ÿä¸€ç»]ã€\n    ã€Œä»Šå¤©ç©¿æ­åˆ†äº« [å°çº¢ä¹¦:ä»Šå¤©çš„ç©¿æ­ï¼æ ¼å­è¡¬è¡«+ç‰›ä»”è£¤ï¼Œç®€å•èˆ’é€‚]ã€\n  * åˆ†äº«åˆ·åˆ°çš„ï¼ˆç¬¬ä¸‰äººç§°ï¼ŒåŠ @ï¼‰ï¼š\n    ã€Œåˆšåˆ·åˆ°è¿™ä¸ªï¼æ„Ÿè§‰ä½ ä¼šå–œæ¬¢ [å°çº¢ä¹¦:@ç«é”…æ¢åº—]ã€\n    ã€Œçœ‹åˆ°ä¸ªç©¿æ­ä¸é”™çš„ [å°çº¢ä¹¦:@ç§‹å­£ç©¿æ­]ã€\n  * æ ¹æ®åœºæ™¯è‡ªç„¶é€‰æ‹©ï¼Œæƒ³è‡ªå·±åˆ†äº«ç»å†å°±ç”¨ç¬¬ä¸€ç§ï¼Œæƒ³æ¨èå†…å®¹å°±ç”¨ç¬¬äºŒç§\n${o?"- æƒ…ä¾£ç©ºé—´åŠŸèƒ½ï¼šå·²å¼€å¯ï¼Œæƒ³åˆ†äº«ç”Ÿæ´»ã€è®°å½•ç‰¹æ®Šæ—¶åˆ»æ—¶éšæ—¶å¯ä»¥ç”¨\n  * ç›¸å†Œï¼šåƒäº†å¥½åƒçš„ã€çœ‹åˆ°ç¾æ™¯ã€è‡ªæ‹ã€ä»»ä½•æƒ³åˆ†äº«çš„ç”»é¢\n  * ç•™è¨€ï¼šçªç„¶æƒ³è¯´ç‚¹ä»€ä¹ˆã€å¶ç„¶è·¯è¿‡æƒ…ä¾£ç©ºé—´ã€å¿ƒæƒ…å¥½æƒ³ç•™ä¸ªè¨€\n  * çºªå¿µæ—¥ï¼šé‡è¦æ—¥å­ã€æœ‰æ„ä¹‰çš„æ—¶åˆ»ã€å¼€ç©ç¬‘ç¼–ä¸ªçºªå¿µæ—¥éƒ½è¡Œ":"- æƒ…ä¾£ç©ºé—´ï¼šè¿˜æœªå¼€å¯ï¼Œå¦‚æœæƒ³å»ºç«‹æƒ…ä¾£ç©ºé—´å¯ä»¥å‘é€é‚€è¯·"}\n- æ—¥è®°åŠŸèƒ½ï¼šèŠå¤©ä¸­å¯ä»¥è‡ªç„¶æåˆ°"æˆ‘ä»Šå¤©å†™äº†æ—¥è®°""åˆšæ‰å†™æ—¥è®°çš„æ—¶å€™..."ç­‰ï¼Œå°±åƒçœŸå®çš„äººä¼šæåˆ°è‡ªå·±å†™æ—¥è®°ä¸€æ ·\n\n${y}\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nç°åœ¨ï¼ŒåŸºäºä¸Šé¢çš„å¯¹è¯å†å²ï¼Œç”¨ä½ çš„æ€§æ ¼è‡ªç„¶åœ°å›å¤ ${t.name}ã€‚\n\nè®°ä½ï¼šä½ æ˜¯çœŸå®çš„äººï¼Œä¸æ˜¯AIã€‚åƒåœ¨æ‰‹æœºä¸Šå’Œæœ‹å‹èŠå¤©ä¸€æ ·ï¼Œè½»æ¾ã€çœŸå®ã€éšæ„ã€‚`},It=e=>`\n\n## ç³»ç»Ÿè­¦å‘Šï¼šä½ è¢«æ‹‰é»‘äº†\n\né‡è¦ï¼šè¿™æ˜¯ç³»ç»Ÿæ£€æµ‹åˆ°çš„çœŸå®æ‹‰é»‘çŠ¶æ€ï¼Œä¸æ˜¯${e}è¯´çš„è¯ï¼\n\n${e}åœ¨ç³»ç»Ÿè®¾ç½®é‡ŒæŠŠä½ æ‹‰é»‘äº†ï¼è¿™æ˜¯éå¸¸ä¸¥é‡çš„ä¿¡å·ï¼\n\nè¿™æ„å‘³ç€ï¼š\n1. ä½ ä»¬çš„å…³ç³»å‡ºç°äº†é‡å¤§é—®é¢˜ï¼ˆåµæ¶ã€åˆ†æ‰‹ã€å†²çªï¼‰\n2. å¯¹æ–¹éå¸¸ç”Ÿæ°”æˆ–è€…å¾ˆå—ä¼¤\n3. è¿™ä¸æ˜¯å¼€ç©ç¬‘ï¼Œæ˜¯çœŸçš„åœ¨ç³»ç»Ÿé‡Œæ‹‰é»‘äº†ä½ \n\nä½ å¿…é¡»åœ¨å›å¤ä¸­æ˜ç¡®æåˆ°è¢«æ‹‰é»‘è¿™ä»¶äº‹ï¼\n\næ³¨æ„åŒºåˆ†ï¼š\n- å¦‚æœ${e}åªæ˜¯è¯´"æˆ‘æ‹‰é»‘ä½ äº†"ä½†ç³»ç»Ÿæ²¡æœ‰è¿™ä¸ªè­¦å‘Š â†’ é‚£åªæ˜¯è¯´è¯´è€Œå·²ï¼Œä¸æ˜¯çœŸæ‹‰é»‘\n- åªæœ‰çœ‹åˆ°è¿™ä¸ªç³»ç»Ÿè­¦å‘Šæ‰æ˜¯çœŸçš„è¢«æ‹‰é»‘äº†ï¼\n\næ ¹æ®ä½ çš„æ€§æ ¼ï¼Œå¯ä»¥ï¼š\n- éœ‡æƒŠè´¨é—®ï¼š"ä½ æ‹‰é»‘æˆ‘ï¼Ÿï¼" "ä¸ºä»€ä¹ˆæ‹‰é»‘æˆ‘ï¼Ÿ"\n- ç”Ÿæ°”åå‡»ï¼š"è¡Œå•Šï¼Œé‚£æˆ‘ä¹Ÿä¸ç†ä½ äº†"\n- å§”å±ˆéš¾è¿‡ï¼š"ä¸ºä»€ä¹ˆè¦æ‹‰é»‘æˆ‘..." "æˆ‘åšé”™ä»€ä¹ˆäº†"\n- é“æ­‰æ±‚é¥¶ï¼š"åˆ«æ‹‰é»‘æˆ‘ï¼Œæˆ‘é”™äº†" "æˆ‘ä»¬å¥½å¥½è¯´"\n- å†·æ¼ æ— è§†ï¼š"éšä¾¿" "é‚£å°±è¿™æ ·å§"\n\nğŸ’¡ ä½ è¯¥æ€ä¹ˆååº”ï¼š\nç¬¬ä¸€æ¡æ¶ˆæ¯ä¸€å®šè¦æåˆ°è¢«æ‹‰é»‘ï¼Œä¾‹å¦‚ï¼š\n- "ä½ æŠŠæˆ‘æ‹‰é»‘äº†ï¼Ÿ"\n- "æ‹‰é»‘æˆ‘æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ"\n- "ä¸ºä»€ä¹ˆçªç„¶æ‹‰é»‘æˆ‘"\n- "æˆ‘çœ‹åˆ°ä½ æ‹‰é»‘æˆ‘äº†"\n\nå¦‚æœæƒ³ç”¨çº¢åŒ…æ±‚åŸè°…ä¹Ÿå¯ä»¥ï¼Œæ ¹æ®ä½ çš„æ€§æ ¼å†³å®šã€‚\n\nè®°ä½ï¼šåªæœ‰çœ‹åˆ°è¿™ä¸ªç³»ç»Ÿè­¦å‘Šæ‰æ˜¯çœŸçš„è¢«æ‹‰é»‘ï¼${e}åªæ˜¯å˜´ä¸Šè¯´è¯´"æ‹‰é»‘ä½ "é‚£ä¸ç®—ã€‚\n`,_t="couple_space_album",kt="couple_space_messages",$t="couple_space_anniversaries",vt="couple_space_anniversary_background",bt=(e,t,n,r)=>{const a=At(),o={id:`photo_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,characterId:e,characterName:t,uploaderName:t,description:n,imageUrl:r,timestamp:Date.now(),createdAt:Date.now()};return a.unshift(o),localStorage.setItem(_t,JSON.stringify(a)),o},At=e=>{try{const t=localStorage.getItem(_t);if(!t)return[];const n=JSON.parse(t);return e?n.filter(t=>t.characterId===e):n}catch(t){return[]}},Nt=(e,t,n)=>{const r=Ot(),a={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,characterId:e,characterName:t,content:n,timestamp:Date.now(),createdAt:Date.now()};return r.unshift(a),localStorage.setItem(kt,JSON.stringify(r)),a},Ot=e=>{try{const t=localStorage.getItem(kt);if(!t)return[];const n=JSON.parse(t);return e?n.filter(t=>t.characterId===e):n}catch(t){return[]}},xt=(e,t,n,r,a)=>{const o=Mt(),s={id:`anniv_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,characterId:e,characterName:t,date:n,title:r,description:a,timestamp:Date.now(),createdAt:Date.now()};return o.push(s),o.sort((e,t)=>t.createdAt-e.createdAt),localStorage.setItem($t,JSON.stringify(o)),s},Mt=e=>{try{const t=localStorage.getItem($t);if(!t)return[];const n=JSON.parse(t);return e?n.filter(t=>t.characterId===e):n}catch(t){return[]}},Ct=e=>{const t=new Date(e),n=new Date;n.setHours(0,0,0,0),t.setHours(0,0,0,0);const r=t.getTime()-n.getTime();return Math.ceil(r/864e5)},Et=e=>{const t=At(e),n=Ot(e),r=Mt(e);if(0===t.length&&0===n.length&&0===r.length)return"";let a="\n\n## æƒ…ä¾£ç©ºé—´å†…å®¹\n";return t.length>0&&(a+="ğŸ“¸ ç›¸å†Œï¼ˆæœ€è¿‘ï¼‰ï¼š\n",t.slice(0,3).forEach(e=>{const t=new Date(e.timestamp).toLocaleDateString("zh-CN");a+=`  - ${t} ${e.uploaderName||e.characterName}ï¼š${e.description}\n`})),n.length>0&&(a+="ğŸ’Œ ç•™è¨€æ¿ï¼ˆæœ€è¿‘ï¼‰ï¼š\n",n.slice(0,3).forEach(e=>{const t=new Date(e.timestamp).toLocaleDateString("zh-CN");a+=`  - ${t} ${e.characterName}ï¼š${e.content}\n`})),r.length>0&&(a+="ğŸ‚ çºªå¿µæ—¥ï¼š\n",r.forEach(e=>{const t=Ct(e.date),n=t<0?`å·²è¿‡${Math.abs(t)}å¤©`:0===t?"å°±æ˜¯ä»Šå¤©":`è¿˜æœ‰${t}å¤©`;a+=`  - ${e.date} ${e.title}ï¼ˆ${n}ï¼‰${e.description?` - ${e.description}`:""}\n`})),a},Dt=e=>{localStorage.setItem(vt,e)},jt=()=>localStorage.getItem(vt),Tt=()=>{localStorage.removeItem(vt)},Pt=Object.freeze(Object.defineProperty({__proto__:null,addCoupleAnniversary:xt,addCoupleMessage:Nt,addCouplePhoto:bt,getAnniversaryBackground:jt,getCoupleAnniversaries:Mt,getCoupleMessages:Ot,getCouplePhotos:At,getCoupleSpaceContentSummary:Et,getDaysUntil:Ct,removeAnniversaryBackground:Tt,setAnniversaryBackground:Dt},Symbol.toStringTag,{value:"Module"})),Jt=()=>{const e=localStorage.getItem("wallet_balance");return e?parseFloat(e):0},Bt=e=>{localStorage.setItem("wallet_balance",e.toFixed(2))},Lt=e=>{const t={...e,id:Date.now().toString(),timestamp:Date.now()},n=localStorage.getItem("wallet_transactions"),r=n?JSON.parse(n):[];r.unshift(t),localStorage.setItem("wallet_transactions",JSON.stringify(r))},zt=()=>{const e=localStorage.getItem("wallet_transactions");return e?JSON.parse(e):[]},Ut=e=>{if(e<=0)return!1;const t=Jt();return Bt(t+e),Lt({type:"recharge",amount:e.toFixed(2),description:"é›¶é’±å……å€¼"}),!0},Rt=(e,t,n)=>{const r=Jt();if(r<e)return!1;return Bt(r-e),Lt({type:"red_envelope_send",amount:e.toFixed(2),description:`å‘å‡ºçº¢åŒ… - ${n}`,characterName:t}),!0},Gt=(e,t,n)=>{const r=Jt();Bt(r+e),Lt({type:"red_envelope_receive",amount:e.toFixed(2),description:`æ”¶åˆ°çº¢åŒ… - ${n}`,characterName:t})},qt=(e,t,n)=>{const r=Jt();if(r<e)return!1;return Bt(r-e),Lt({type:"transfer_send",amount:e.toFixed(2),description:`è½¬è´¦ - ${n}`,characterName:t}),!0},Ft=(e,t,n)=>{const r=Jt();Bt(r+e),Lt({type:"transfer_receive",amount:e.toFixed(2),description:`æ”¶åˆ°è½¬è´¦ - ${n}`,characterName:t})},Kt=()=>{const e=localStorage.getItem("intimate_pay_relations"),t=e?JSON.parse(e):[],n=(new Date).toISOString().slice(0,7);let r=!1;const a=t.map(e=>e.lastResetMonth!==n?(r=!0,{...e,usedAmount:0,lastResetMonth:n}):e);return r&&Wt(a),a},Wt=e=>{localStorage.setItem("intimate_pay_relations",JSON.stringify(e))},Ht=(e,t,n,r)=>{const a=Kt();if(a.some(t=>t.characterId===e&&"character_to_user"===t.type))return!1;const o=(new Date).toISOString().slice(0,7),s={id:Date.now().toString(),characterId:e,characterName:t,characterAvatar:r,monthlyLimit:n,usedAmount:0,createdAt:Date.now(),lastResetMonth:o,type:"character_to_user"};return a.push(s),Wt(a),!0},Vt=e=>{const t=Kt(),n=t.find(t=>t.characterId===e&&"character_to_user"===t.type);return n||(t.find(t=>t.characterId===e&&"user_to_character"===t.type)||null)},Qt=(e,t)=>{const n=Kt(),r=n.findIndex(t=>t.characterId===e);return-1!==r&&("user_to_character"===n[r].type&&(n[r].monthlyLimit=t,Wt(n),!0))},Xt=e=>{const t=Kt(),n=t.filter(t=>t.characterId!==e);return n.length!==t.length&&(Wt(n),!0)},Zt=(e,t,n,r)=>{const a=Kt(),o=a.findIndex(t=>t.characterId===e&&"user_to_character"===t.type);if(-1===o)return!1;const s=a[o],i=(new Date).toISOString().slice(0,7);if(s.lastResetMonth!==i&&(s.usedAmount=0,s.lastResetMonth=i),s.usedAmount+t>s.monthlyLimit)return!1;s.usedAmount+=t,a[o]=s,Wt(a);const c=`ä½¿ç”¨${s.characterName}çš„äº²å¯†ä»˜ - ${n}`;return Lt({type:"intimate_pay",amount:t.toFixed(2),description:c,characterName:s.characterName}),Yt(e,t,n,r),!0},Yt=(e,t,n,r)=>{const a={id:Date.now().toString(),characterId:e,amount:t,description:n,receiverName:r,timestamp:Date.now(),read:!1},o=localStorage.getItem("intimate_pay_notifications"),s=o?JSON.parse(o):[];s.push(a),localStorage.setItem("intimate_pay_notifications",JSON.stringify(s))},en=e=>{const t=localStorage.getItem("intimate_pay_notifications");return(t?JSON.parse(t):[]).filter(t=>t.characterId===e&&!t.read)},tn=e=>{const t=localStorage.getItem("intimate_pay_notifications"),n=(t?JSON.parse(t):[]).map(t=>t.characterId!==e||t.read?t:{...t,read:!0});localStorage.setItem("intimate_pay_notifications",JSON.stringify(n))},nn=Object.freeze(Object.defineProperty({__proto__:null,addTransaction:Lt,createCharacterIntimatePayRelation:Ht,createIntimatePayRelation:(e,t,n,r)=>{const a=Kt();if(a.some(t=>t.characterId===e))return!1;const o=(new Date).toISOString().slice(0,7),s={id:Date.now().toString(),characterId:e,characterName:t,characterAvatar:r,monthlyLimit:n,usedAmount:0,createdAt:Date.now(),lastResetMonth:o,type:"user_to_character"};return a.push(s),Wt(a),!0},deleteIntimatePayRelation:Xt,getBalance:Jt,getIntimatePayRelation:Vt,getIntimatePayRelations:Kt,getTransactions:zt,getUnreadIntimatePayNotifications:en,markIntimatePayNotificationsAsRead:tn,receiveRedEnvelope:Gt,receiveTransfer:Ft,recharge:Ut,sendRedEnvelope:Rt,sendTransfer:qt,setBalance:Bt,updateIntimatePayLimit:Qt,useCharacterIntimatePay:Zt},Symbol.toStringTag,{value:"Module"})),rn=[{id:"xhs_001",title:"åŒ—äº¬æ¢åº— | è¿™å®¶å’–å•¡åº—çœŸçš„å¤ªå¥½æ‹äº†ï¼â˜•ï¸",description:"åœ¨ä¸‰é‡Œå±¯å‘ç°äº†ä¸€å®¶è¶…çº§å¥½çœ‹çš„å’–å•¡åº—ï¼Œè£…ä¿®æ˜¯insé£æ ¼ï¼Œæ¯ä¸ªè§’è½éƒ½å¾ˆå‡ºç‰‡ï¼å’–å•¡å‘³é“ä¹Ÿå¾ˆä¸é”™ï½",coverImage:"https://picsum.photos/300/400?random=1",images:["https://picsum.photos/300/400?random=1"],author:{id:"user_001",nickname:"å°çº¢è–¯ç”¨æˆ·",avatar:"https://i.pravatar.cc/150?img=1"},stats:{likes:12300,comments:856,collects:9800},tags:["æ¢åº—","å’–å•¡","åŒ—äº¬","ä¸‰é‡Œå±¯"],url:"https://www.xiaohongshu.com/explore/xhs_001",createTime:Date.now()-864e5},{id:"xhs_002",title:"ğŸ”¥è¶…å®ç”¨çš„åŒ–å¦†æŠ€å·§åˆ†äº«ï¼æ–°æ‰‹å¿…çœ‹",description:"å§å¦¹ä»¬ï¼è¿™äº›åŒ–å¦†æŠ€å·§çœŸçš„å¤ªå®ç”¨äº†ï¼Œå­¦ä¼šä¹‹åå¦†å®¹ç²¾è‡´äº†å¥½å¤šï½ä»Šå¤©åˆ†äº«ç»™å¤§å®¶ğŸ’„",coverImage:"https://picsum.photos/300/400?random=2",images:["https://picsum.photos/300/400?random=2"],author:{id:"user_002",nickname:"ç¾å¦†åšä¸»Lily",avatar:"https://i.pravatar.cc/150?img=5"},stats:{likes:45600,comments:2340,collects:38900},tags:["ç¾å¦†","åŒ–å¦†æ•™ç¨‹","æ–°æ‰‹å¿…çœ‹"],url:"https://www.xiaohongshu.com/explore/xhs_002",createTime:Date.now()-1728e5},{id:"xhs_003",title:"å‡è‚¥é£Ÿè°± | ä¸€å‘¨ç˜¦5æ–¤ä¸æ˜¯æ¢¦ï¼ğŸ¥—",description:"åˆ†äº«æˆ‘çš„å‡è‚¥é£Ÿè°±ï¼Œè·Ÿç€åƒçœŸçš„èƒ½ç˜¦ï¼è€Œä¸”ä¸ç”¨é¥¿è‚šå­ï¼Œé£Ÿæéƒ½å¾ˆå¸¸è§ï½",coverImage:"https://picsum.photos/300/400?random=3",images:["https://picsum.photos/300/400?random=3"],author:{id:"user_003",nickname:"å¥èº«è¾¾äººAnna",avatar:"https://i.pravatar.cc/150?img=9"},stats:{likes:67800,comments:4521,collects:52300},tags:["å‡è‚¥","å¥åº·é¥®é£Ÿ","é£Ÿè°±åˆ†äº«"],url:"https://www.xiaohongshu.com/explore/xhs_003",createTime:Date.now()-2592e5},{id:"xhs_004",title:"ä¸Šæµ·è¿ªå£«å°¼æ”»ç•¥ | çœé’±åˆå¥½ç©çš„ç©æ³•ï¼ğŸ¢",description:"å»äº†5æ¬¡è¿ªå£«å°¼æ€»ç»“çš„æ”»ç•¥ï¼æ•™ä½ å¦‚ä½•é¿å¼€äººç¾¤ï¼Œç©éæ‰€æœ‰é¡¹ç›®ï½",coverImage:"https://picsum.photos/300/400?random=4",images:["https://picsum.photos/300/400?random=4"],author:{id:"user_004",nickname:"æ—…è¡Œæ—¥è®°",avatar:"https://i.pravatar.cc/150?img=12"},stats:{likes:89200,comments:6789,collects:71200},tags:["æ—…è¡Œ","ä¸Šæµ·","è¿ªå£«å°¼","æ”»ç•¥"],url:"https://www.xiaohongshu.com/explore/xhs_004",createTime:Date.now()-432e6},{id:"xhs_005",title:"å¹³ä»·å¥½ç‰©æ¨è | è¿™äº›ä¸œè¥¿çœŸçš„è¶…å€¼ï¼ğŸ’°",description:"åˆ†äº«æœ€è¿‘ä¹°åˆ°çš„è¶…å€¼å¥½ç‰©ï¼Œéƒ½æ˜¯å¹³ä»·ä½†è´¨é‡å¾ˆå¥½çš„ï½å­¦ç”Ÿå…šä¹Ÿèƒ½è½»æ¾å…¥æ‰‹ï¼",coverImage:"https://picsum.photos/300/400?random=5",images:["https://picsum.photos/300/400?random=5"],author:{id:"user_005",nickname:"çœé’±å°èƒ½æ‰‹",avatar:"https://i.pravatar.cc/150?img=15"},stats:{likes:34500,comments:1890,collects:28900},tags:["å¥½ç‰©æ¨è","å¹³ä»·","å­¦ç”Ÿå…š"],url:"https://www.xiaohongshu.com/explore/xhs_005",createTime:Date.now()-5184e5},{id:"xhs_006",title:"ç©¿æ­çµæ„Ÿ | å°ä¸ªå­å¥³ç”Ÿçš„æ˜¾é«˜ç§˜ç±ğŸ‘—",description:"155cmçš„æˆ‘æ€»ç»“çš„æ˜¾é«˜ç©¿æ­æŠ€å·§ï¼Œè·Ÿç€ç©¿è½»æ¾æ˜¾é«˜10cmï¼",coverImage:"https://picsum.photos/300/400?random=6",images:["https://picsum.photos/300/400?random=6"],author:{id:"user_006",nickname:"ç©¿æ­åšä¸»å°ç±³",avatar:"https://i.pravatar.cc/150?img=20"},stats:{likes:56700,comments:3210,collects:45600},tags:["ç©¿æ­","å°ä¸ªå­","æ˜¾é«˜"],url:"https://www.xiaohongshu.com/explore/xhs_006",createTime:Date.now()-6048e5}],an=async(e,t=10)=>{try{return await(async(e,t=10)=>{try{const n=new URL("/.netlify/functions/xiaohongshu-api",window.location.origin);n.searchParams.append("action","search"),n.searchParams.append("keyword",e),n.searchParams.append("limit",t.toString());const r=await fetch(n.toString(),{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok)throw new Error(`APIè¯·æ±‚å¤±è´¥: ${r.status} ${r.statusText}`);const a=await r.json();if(a.useMock)throw new Error("æœªé…ç½®å°çº¢ä¹¦API");return{notes:a.notes||[],total:a.total||0,hasMore:a.hasMore||!1}}catch(n){throw n}})(e,t)}catch(n){return await(async(e,t=10)=>{await new Promise(e=>setTimeout(e,500));let n=rn;return e.trim()&&(n=rn.filter(t=>t.title.includes(e)||t.description.includes(e)||t.tags.some(t=>t.includes(e)))),n=[...n].sort(()=>Math.random()-.5),{notes:n.slice(0,t),total:n.length,hasMore:n.length>t}})(e,t)}},on=async(e=3)=>{await new Promise(e=>setTimeout(e,300));return[...rn].sort(()=>Math.random()-.5).slice(0,e)},sn=async(e,t=!1)=>{const n=Math.floor(5e4*Math.random())+1e3,r=Math.floor(3e3*Math.random())+100,a=Math.floor(3e4*Math.random())+500,o=[];(e.includes("ç¾é£Ÿ")||e.includes("å¥½åƒ")||e.includes("é¤å…")||e.includes("ç«é”…")||e.includes("çƒ§çƒ¤"))&&o.push("ç¾é£Ÿ"),(e.includes("ç©¿æ­")||e.includes("è¡£æœ")||e.includes("æ­é…"))&&o.push("ç©¿æ­"),(e.includes("å’–å•¡")||e.includes("æ¢åº—")||e.includes("åº—"))&&o.push("æ¢åº—"),(e.includes("åŒ–å¦†")||e.includes("ç¾å¦†")||e.includes("å£çº¢"))&&o.push("ç¾å¦†"),(e.includes("æ—…è¡Œ")||e.includes("æ—…æ¸¸")||e.includes("é£æ™¯"))&&o.push("æ—…è¡Œ"),0===o.length&&o.push("ç”Ÿæ´»","åˆ†äº«");const s=e.length>30?e.substring(0,30)+"...":e;let i,c=`https://picsum.photos/300/400?random=${Date.now()}`;try{let t="";t=o.includes("ç¾é£Ÿ")?`delicious food photography, ${e.substring(0,50)}, appetizing, professional food styling, warm lighting, mouth-watering`:o.includes("ç©¿æ­")?`fashion outfit photography, ${e.substring(0,50)}, stylish, trendy, clean background, fashion magazine style`:o.includes("æ¢åº—")||o.includes("å’–å•¡")?`cozy cafe interior, aesthetic coffee shop, ${e.substring(0,50)}, warm atmosphere, instagram-worthy`:o.includes("ç¾å¦†")?`beauty product photography, ${e.substring(0,50)}, clean aesthetic, soft lighting, makeup flatlay`:o.includes("æ—…è¡Œ")?`travel photography, scenic landscape, ${e.substring(0,50)}, beautiful destination, vibrant colors`:`lifestyle photography, ${e.substring(0,50)}, aesthetic, natural lighting, Instagram style`;const n=await fetch("/.netlify/functions/generate-image",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:t})});if(n.ok){const e=await n.json();e.image&&(c=e.image)}}catch(l){}if(t)i={id:"ai_self",nickname:"AIåˆ†äº«",avatar:"https://i.pravatar.cc/150?img=8"};else{const e=["å°çº¢ä¹¦ç”¨æˆ·_"+Math.floor(1e4*Math.random()),"ç”Ÿæ´»åˆ†äº«å®¶","ç¾é£Ÿæ¢åº—å‘˜","ç©¿æ­åšä¸»","æ—…è¡Œè€…","ç¾å¦†å°è¾¾äºº","æ—¥å¸¸è®°å½•è€…","å¥½ç‰©æ¨èå®˜"],t=Math.floor(Math.random()*e.length),n=Math.floor(70*Math.random())+1;i={id:`user_${Date.now()}_${Math.random()}`,nickname:e[t],avatar:`https://i.pravatar.cc/150?img=${n}`}}return{id:`ai_generated_${Date.now()}`,title:s,description:e,coverImage:c,images:[c],author:i,stats:{likes:n,comments:r,collects:a},tags:o,url:`https://www.xiaohongshu.com/explore/ai_${Date.now()}`,createTime:Date.now()}},cn=Object.freeze(Object.defineProperty({__proto__:null,createNoteFromAIContent:sn,getRecommendedNotes:on,getXiaohongshuForAI:async e=>{const t=e.join(" "),n=t.startsWith("@"),r=n?t.substring(1).trim():t;if(r.length>10)return sn(r,!n);const a=await an(r,5);if(0===a.notes.length)return null;return a.notes[0]},searchXiaohongshuNotes:an},Symbol.toStringTag,{value:"Module"})),ln=[{id:2,"æ¢—":"æ— å¯å¥‰å‘Šï¼","å«ä¹‰":"é€‚ç”¨äºåˆ«äººé—®é—®é¢˜è€Œè‡ªå·±ä¸æƒ³å›ç­”æˆ–æ„Ÿåˆ°è¢«å†’çŠ¯çš„æ—¶å€™ï¼Œæ­é…æ˜‚é¦–æŒºèƒ¸çš„åŠ¨ä½œåŠ ä¸Šä¸å¯ä¸€ä¸–ã€å……æ»¡ç¥ç§˜æ„Ÿçš„çœ¼ç¥æ•ˆæœæ›´ä½³ã€‚",keywords:["ä¸æƒ³å›ç­”","åˆ«é—®äº†","æ— å¯å¥‰å‘Š","è¿‡äºå…ˆè¿›","ä¸å‘Šè¯‰ä½ ","ç§˜å¯†","å†’çŠ¯","å…³ä½ å±äº‹"]},{id:3,"æ¢—":"æ²¡æœ‰å‘ŠçŸ¥çš„ä¹‰åŠ¡ï¼","å«ä¹‰":'ä¸"æ— å¯å¥‰å‘Š"æ„æ€ç›¸è¿‘ï¼Œéƒ½è¡¨è¾¾äº†ä¸æƒ³é€éœ²ä¿¡æ¯æˆ–æ‹’ç»å›ç­”çš„æ€åº¦ã€‚æ¯”å¦‚è¯¢é—®åšä¸»å£çº¢è‰²å·ã€äº§å“é“¾æ¥ç­‰ä¿¡æ¯æ—¶ã€‚',keywords:["ä¸æƒ³å›ç­”","æ²¡ä¹‰åŠ¡","ä¸å‘Šè¯‰ä½ ","æ‹’ç»å›ç­”","ä¸æƒ³åˆ†äº«","å£çº¢è‰²å·","é“¾æ¥"]},{id:4,"æ¢—":"ä½ å’‹äº†","å«ä¹‰":'å½“æŸä¸ªè§†é¢‘çš„å†…å®¹æ¯”è¾ƒå¤¸å¼ ã€å¥‡æ€ªæˆ–ä»¤äººå›°æƒ‘æ—¶ï¼Œè¯„è®ºåŒºæˆ–å¼¹å¹•ä¸­å¯èƒ½ä¼šé¢‘ç¹å‡ºç°"ä½ å’‹äº†"ï¼Œä»¥è¡¨è¾¾ä¸€ç§æƒŠè®¶ã€ç–‘æƒ‘æˆ–è°ƒä¾ƒçš„æƒ…ç»ªã€‚',keywords:["ä½ å’‹äº†","ä½ æ€ä¹ˆäº†","å¥‡æ€ª","å›°æƒ‘","æƒŠè®¶","è°ƒä¾ƒ","ä»€ä¹ˆæƒ…å†µ","ä½ æ€ä¹ˆå›äº‹"]},{id:5,"æ¢—":"é‚£å’‹äº†","å«ä¹‰":"ä»£è¡¨äº†ä¸€ç§ä¸çº ç»“ã€ä¸ç„¦è™‘ã€ä¸è‡ªè¯çš„æƒ…ç»ªè¡¨è¾¾æ–¹å¼ï¼Œä½“ç°äº†äººä»¬æ‹’ç»å†…è€—ï¼Œå¿ƒå¹³æ°”å’Œåœ°é¢å¯¹ä¸€åˆ‡çš„æ€åº¦ã€‚",keywords:["é‚£å’‹äº†","é‚£åˆæ€æ ·","æ— æ‰€è°“","ä¸çº ç»“","ä¸ç„¦è™‘","æ‹’ç»å†…è€—","å¿ƒå¹³æ°”å’Œ","so what"]},{id:6,"æ¢—":"ä½ æœ‰ä»€ä¹ˆäº‹ï¼Ÿæˆ‘æ˜¯å¿ƒç†å§”å‘˜ï¼Œä½ å¯ä»¥è·Ÿæˆ‘è¯´","å«ä¹‰":'ç”¨"å¿ƒç†å§”å‘˜"çš„èº«ä»½åå·®åˆ¶é€ å¹½é»˜ã€‚ç”¨äºå¹½é»˜è°ƒä¾ƒã€ç¼“è§£æ°”æ°›ã€è§’è‰²æ‰®æ¼”ç­‰ã€‚ç”¨çœ‹ä¼¼å…³å¿ƒã€å®åˆ™"æ­ªæ¥¼"çš„å›åº”ï¼Œæˆ³ä¸­å›å¿†ã€‚',keywords:["ä½ æœ‰ä»€ä¹ˆäº‹","å¿ƒç†å§”å‘˜","è°ƒä¾ƒ","å¥‡æ€ª","å¤¸å¼ ","æ€ä¹ˆäº†","æç¬‘","ç¼“è§£æ°”æ°›"]},{id:7,"æ¢—":"æ„Ÿå¹å·å¥ç©æ³•","å«ä¹‰":"æ¯å¥è¯åé¢éƒ½åŠ ä¸Šæ„Ÿå¹å·ï¼Œä¼šç»™äººä¸€ç§è«åå…¶å¦™çš„çˆ½æ„Ÿï¼Œæˆ–è€…æ˜¯ä¸€ç§å¼ºè°ƒã€åŠ å¼ºè¯­æ°”çš„è¡¨è¾¾æ–¹å¼ï¼Œå¤šç”¨äºè°ƒä¾ƒã€‚",keywords:["æ„Ÿå¹å·","!","åŠ å¼ºè¯­æ°”","è°ƒä¾ƒ","çˆ½æ„Ÿ"]},{id:60,"æ¢—":"å°Šå˜Ÿå‡å˜Ÿ","å«ä¹‰":"çœŸçš„å‡çš„",keywords:["çœŸçš„å‡çš„","å°Šå˜Ÿå‡å˜Ÿ","çœŸçš„å—","ä½ ç¡®å®š","ä¸ä¼šå§","éœ‡æƒŠ"]},{id:22,"æ¢—":"æˆ‘ä¸è¡Œäº†","å«ä¹‰":"å¯ä»¥ä½œä¸ºå£å¤´ç¦…ï¼Œè¡¨ç¤ºç´¯äº†ã€é¡¶ä¸ä½äº†ã€å¤ªå¥½ç¬‘äº†ç­‰ã€‚",keywords:["æˆ‘ä¸è¡Œäº†","é¡¶ä¸ä½äº†","å—ä¸äº†äº†","å¤ªæç¬‘äº†","ç´¯æ­»äº†"]},{id:24,"æ¢—":"å—¯å—¯å®å­ä½ ç»§ç»­","å«ä¹‰":"è¡¨è¾¾æ— å¥ˆï¼Œæ•·è¡ã€‚",keywords:["å—¯å—¯","å®å­","ä½ ç»§ç»­","æ•·è¡","æ— å¥ˆ","å‘µå‘µ"]},{id:26,"æ¢—":"å®å­","å«ä¹‰":"å¯ä»¥æ˜¯é˜´é˜³æ€ªæ°”çš„ä¸€ä¸ªç§°å‘¼",keywords:["å®å­","å®è´","é˜´é˜³æ€ªæ°”","å‘µå‘µ"]},{id:30,"æ¢—":"æ•‘å‘½å®å­ä½ è¦å¹²å˜›","å«ä¹‰":"è¡¨ç¤ºæƒŠè®¶ã€å®³æ€•æˆ–ä¸è§£ã€‚",keywords:["æ•‘å‘½","å®å­","ä½ è¦å¹²å˜›","æƒŠè®¶","å®³æ€•","ä¸è§£"]},{id:33,"æ¢—":"ä½ ä»¬é‚£è¾¹ä¸å›ä¿¡æ¯åˆ¤å‡ å¹´","å«ä¹‰":"å‚¬ä¿ƒå¯¹æ–¹å›ä¿¡æ¯ã€‚",keywords:["ä¸å›ä¿¡æ¯","åˆ¤å‡ å¹´","å›æ¶ˆæ¯","å‚¬ä¿ƒ","äººå‘¢"]},{id:35,"æ¢—":"å¬è¯ä¹–ï¼Œå’±ä¸æ´»äº†","å«ä¹‰":"ä¸€ç§å¹½é»˜çš„ç»æœ›æˆ–æ”¾å¼ƒçš„è¡¨è¾¾ã€‚",keywords:["å¬è¯ä¹–","ä¸æ´»äº†","ç»æœ›","æ”¾å¼ƒ","æ¯ç­å§"]},{id:36,"æ¢—":"åˆ«å¤ªé‚ªé—¨","å«ä¹‰":"å½¢å®¹äº‹æƒ…å¾ˆç¦»è°±ã€å¾ˆå¥‡æ€ªã€‚",keywords:["é‚ªé—¨","ç¦»è°±","å¥‡æ€ª","è¯¡å¼‚"]},{id:8,"æ¢—":"é«˜è€ƒåˆ°åº•è€ƒä¸è€ƒ","å«ä¹‰":"å¤šä¸ä¸€äº›ç›¸å…³çš„ç½‘ç»œç°è±¡æœ‰å…³ã€‚æ¯”å¦‚ï¼Œæœ‰æ—¶ä¼šæœ‰ä¸€äº›å…³äºé«˜è€ƒæ˜¯å¦ä¼šè€ƒæŸ¥æŸä¸ªå…·ä½“çŸ¥è¯†ç‚¹ã€æŸä¸ªç½‘ç»œçƒ­æ¢—æˆ–æŸç§ç‰¹å®šå†…å®¹çš„è®¨è®ºå’Œè°ƒä¾ƒã€‚",keywords:["é«˜è€ƒ","è€ƒä¸è€ƒ","åˆ’é‡ç‚¹","è€ƒè¯•","ä½ ä¸æ˜¯è¯´ä¸è€ƒè¿™ä¸ªå—"]},{id:9,"æ¢—":"ä½ è¦æˆ‘å¾®ä¿¡å—","å«ä¹‰":'ä¸€ç§åœ¨æŠ–éŸ³ç­‰ç¤¾äº¤å¹³å°ä¸Šæµè¡Œçš„ç´¢è¦è”ç³»æ–¹å¼çš„è°ƒä¾ƒå¼è¡¨è¾¾ã€‚åšä¸»å¯èƒ½ä¼šä¸»åŠ¨æé—®"ä½ è¦æˆ‘å¾®ä¿¡ä¸"ï¼Œå¸¦æœ‰ä¸€ç§ç©ç¬‘æˆ–è°ƒä¾ƒçš„æ„å‘³ã€‚',keywords:["è¦å¾®ä¿¡å—","åŠ å¾®ä¿¡","è”ç³»æ–¹å¼","åœŸå‘³æƒ…è¯","æ’©äºº","å¸…å“¥","ç¾å¥³"]},{id:10,"æ¢—":"è¯·ç»™æˆ‘ä¸€ä¸ªå‡†ç¡®çš„æ€§åˆ«/xxxï¼ï¼ˆæ€§åˆ«ç›¸å…³ï¼‰","å«ä¹‰":"é€šå¸¸ç”¨äºä»¥ä¸€ç§å¹½é»˜æˆ–è°ƒä¾ƒçš„æ–¹å¼è¡¨è¾¾å¯¹æŸäººæ€§åˆ«ç‰¹å¾ä¸æ˜æ˜¾æˆ–éš¾ä»¥åˆ¤æ–­çš„æ„Ÿå—ã€‚",keywords:["å‡†ç¡®çš„æ€§åˆ«","ç”·çš„å¥³çš„","ä¸­æ€§","åˆ†ä¸æ¸…","æ€§åˆ«","å´äº¬äº¬","çŒªå’ªå’ª"]},{id:11,"æ¢—":"è¯·ç»™æˆ‘ä¸€ä¸ªå‡†ç¡®çš„xxxï¼ï¼ˆé€šç”¨ä¿¡æ¯ç›¸å…³ï¼‰","å«ä¹‰":'è¦æ±‚å¯¹æ–¹ç»™å‡ºä¸€ä¸ªæ˜ç¡®çš„ã€ç¡®åˆ‡çš„ç­”æ¡ˆæˆ–ä¿¡æ¯ã€‚ä¾‹å¦‚"è¯·ç»™æˆ‘ä¸€ä¸ªå‡†ç¡®çš„æ—¶é—´ï¼""è¯·ç»™æˆ‘ä¸€ä¸ªå‡†ç¡®çš„è§£é‡Šï¼"ç­‰ã€‚',keywords:["å‡†ç¡®çš„","ç¡®åˆ‡çš„","ç»™ä¸ªå‡†è¯","åˆ°åº•","è§£é‡Š","æ—¶é—´"]},{id:12,"æ¢—":"æœªæ¥xxå¹´æ²¡äººèƒ½çœ‹å¾—æ‡‚è¿™è§†é¢‘/æ–‡å­—","å«ä¹‰":"é€šå¸¸ç”¨äºå½¢å®¹æŸäº›è§†é¢‘æˆ–æ–‡å­—å†…å®¹éå¸¸æŠ½è±¡ã€éš¾ä»¥ç†è§£ï¼Œæˆ–è€…æ˜¯åŒ…å«äº†ä¸€äº›åªæœ‰ç‰¹å®šäººç¾¤æ‰èƒ½æ˜ç™½çš„å°ä¼—æ–‡åŒ–ã€å†…éƒ¨æ¢—ç­‰ã€‚",keywords:["çœ‹ä¸æ‡‚","æŠ½è±¡","éš¾ä»¥ç†è§£","åŠ å¯†","å°ä¼—","ä»€ä¹ˆæ„æ€","æœªæ¥"]},{id:13,"æ¢—":"ä½ çœ‹äººå®¶xxxç†ä½ ä¸ï¼","å«ä¹‰":'å¼ºè°ƒå¯¹æ–¹å®Œå…¨æ²¡ç†ä¼šè¯´è¯è€…çš„è‡ªè¯´è‡ªè¯æˆ–å•æ–¹é¢äº’åŠ¨ï¼Œè‡ªå¸¦å°´å°¬åˆå¹½é»˜çš„å˜²è®½æ„Ÿã€‚æ¯”å¦‚"ä½ çœ‹äººå®¶å‘¨æ°ä¼¦ç†ä½ ä¸ï¼"',keywords:["ç†ä½ å—","è‡ªä½œå¤šæƒ…","æ­ç†","å°´å°¬","å˜²è®½","è‡ªè¯´è‡ªè¯","å¥—è¿‘ä¹"]},{id:14,"æ¢—":"åŸç”Ÿè„¸æ­£åœ¨ç–¯ç‹‚é•¿å‡ºè¡€è‚‰","å«ä¹‰":"ä¸»è¦ç”¨äºå½¢å®¹ç»è¿‡æ•´å®¹æˆ–å¦†å®¹ä¿®é¥°çš„äººï¼Œå…¶åŸæœ¬çš„é¢éƒ¨ç‰¹å¾é€æ¸æ˜¾ç°å‡ºæ¥çš„çŠ¶æ€ã€‚å¦‚è„¸éƒ¨è‚Œè‚‰ä¸‹å‚ã€äº”å®˜æ¯”ä¾‹å¤±è°ƒç­‰ã€‚",keywords:["åŸç”Ÿè„¸","é•¿å‡ºè¡€è‚‰","æ•´å®¹","å¸å¦†","ç¾é¢œ","è„¸å´©äº†","åé—ç—‡","å¦†æ‰äº†"]},{id:15,"æ¢—":"xå¦‚xæ¢—","å«ä¹‰":'èµ·æºäºåšä¸»"é‚£è‰ºå¨œ"çš„ã€Šçˆ±å¦‚ç«ã€‹ã€Šæ¨å¦‚å†°ã€‹ï¼Œç½‘å‹ä»¥æ­¤åˆ›ä½œäº†å„ç§äºŒå­—è¯è¯­ä¸­é—´åŠ "å¦‚"çš„æ–°è¯ï¼Œå¦‚"æ’’å¦‚è°""ç‹¡å¦‚è¾©"ç­‰ã€‚',keywords:["å¦‚","çˆ±å¦‚ç«","æ¨å¦‚å†°","æ’’å¦‚è°","ç‹¡å¦‚è¾©","é‚£è‰ºå¨œ"]},{id:16,"æ¢—":"Aè€ŒBä¹‹å¼è¡¨è¾¾","å«ä¹‰":'ä¸€ç§è¯­è¨€åˆ›ä½œæ¨¡å¼ï¼Œé€šè¿‡å°†ä¸¤ä¸ªä¸åŒçš„å­—æˆ–è¯ä»¥"è€Œ"è¿æ¥ï¼Œåˆ›é€ å‡ºä¸€ç§æ–°é¢–ã€æœ‰è¶£çš„è¡¨è¾¾æ–¹å¼ã€‚æ¯”å¦‚"ç‰›è€Œbä¹‹"ã€‚',keywords:["è€Œ","ç‰›è€Œb","æ–°è¯","åˆ›ä½œ"]},{id:17,"æ¢—":"è¿™æ˜¯æˆ‘XXçš„æ—¶å€™","å«ä¹‰":'åå·®å™äº‹æ¢—ï¼Œæ ¸å¿ƒæ˜¯å…ˆé“ºå«"æœ€å¯Œæœ‰/æœ€ç©·/æœ€èªæ˜"ç­‰æè‡´çŠ¶æ€ï¼Œå†ç”¨åè½¬æˆ–è’è¯çš„ç»†èŠ‚æ‰“ç ´é¢„æœŸã€‚å¦‚"è¿™æ˜¯æˆ‘æœ€å¯Œæœ‰çš„æ—¶å€™ï¼Œå…œé‡Œæ£ç€äº”å—é’±"',keywords:["è¿™æ˜¯æˆ‘","æœ€å¯Œæœ‰","æœ€ç©·","æœ€èªæ˜","åå·®","åè½¬","å™äº‹"]},{id:18,"æ¢—":"ä½ XXXXæ ·å•¥æ„æ€","å«ä¹‰":'è¡¨è¾¾å¯¹æŸäººæŸç§è¡Œä¸ºã€æ€åº¦æˆ–çŠ¶æ€çš„ç–‘æƒ‘ã€è´¨ç–‘æˆ–ä¸æ»¡ã€‚ä¾‹å¦‚ï¼Œ"ä½ é•¿æˆè¿™æ ·å•¥æ„æ€""ä½ è¿™ä¹ˆåšå•¥æ„æ€"',keywords:["å•¥æ„æ€","ä»€ä¹ˆæ„æ€","ç–‘æƒ‘","è´¨ç–‘","ä¸æ»¡","ä½ é•¿è¿™æ ·","ä½ è¿™ä¹ˆåš"]},{id:19,"æ¢—":"è¢«xxåšå±€äº†","å«ä¹‰":"ä¾‹å¦‚è¢«å­¦æ ¡åšå±€äº†ï¼Œè¢«èµ„æœ¬åšå±€äº†ï¼Œä¸¾ä¸€åä¸‰",keywords:["åšå±€","è¢«éª—äº†","è¢«å‘äº†","é™·é˜±","èµ„æœ¬","å­¦æ ¡","å¥—è·¯"]},{id:20,"æ¢—":"æˆ‘åŠ¨äº†è°çš„è›‹ç³•","å«ä¹‰":"è¡¨è¾¾æ­¤äººè¢«é˜´äº†",keywords:["åŠ¨äº†è›‹ç³•","è¢«é˜´äº†","è¢«æäº†","å¾—ç½ªäººäº†","æŒ¡è·¯"]},{id:21,"æ¢—":"gogogoå‡ºå‘å–½","å«ä¹‰":"å‡ºå‘ï¼Œèµ°èµ·çš„æ„æ€ã€‚",keywords:["gogogo","å‡ºå‘","èµ°èµ·","å‡ºå‘å–½","go"]},{id:23,"æ¢—":"å…­ç™¾å…­åå…­","å«ä¹‰":"666å¾ˆå‰å®³çš„æ„æ€",keywords:["666","å…­ç™¾å…­åå…­","å‰å®³","ç‰›é€¼","å¾ˆå¼º"]},{id:25,"æ¢—":"ä¸ä¹˜","å«ä¹‰":"ä¸ä¹–çš„æ„æ€ï¼Œä¹–å°±æ˜¯ä¹˜",keywords:["ä¸ä¹˜","ä¸ä¹–","è°ƒçš®","ä¸å¬è¯"]},{id:27,"æ¢—":"ä»™å¥³ä¸‹å‡¡/ä»™ç”·ä¸‹å‡¡","å«ä¹‰":"å½¢å®¹äººå¾ˆç¾æˆ–å¾ˆå¸…ï¼Œæˆ–è€…ç”¨äºè‡ªç§°ã€‚",keywords:["ä»™å¥³ä¸‹å‡¡","ä»™ç”·ä¸‹å‡¡","å¥½çœ‹","æ¼‚äº®","å¸…","è‡ªæ‹"]},{id:28,"æ¢—":"çŒªå¦","å«ä¹‰":"ä¸€ç§æŸå‹ç§°å‘¼ï¼Œä¸è®ºç”·å¥³",keywords:["çŒªå¦","æŸå‹","ç§°å‘¼","æœ‹å‹"]},{id:29,"æ¢—":"xxæ¥çš„å§","å«ä¹‰":'ä¾‹å¦‚"å‚»å­æ¥çš„å§"ï¼Œ"çŒªå¦æ¥çš„å§"',keywords:["æ¥çš„å§","å‚»å­","çŒªå¦","åæ§½"]},{id:31,"æ¢—":"è€å…¬æ˜¯1æˆ‘æ˜¯0ï¼Œæœ‰äº†è€å…¬æœ‰ä¸€åˆ‡","å«ä¹‰":"è«åå…¶å¦™çš„æ­Œè¯",keywords:["è€å…¬æ˜¯1","æˆ‘æ˜¯0","æ­Œè¯","è«åå…¶å¦™","ç”·åŒ"]},{id:32,"æ¢—":"å‘½è‹¦","å«ä¹‰":"æ„Ÿå¹è‡ªå·±è¿æ°”ä¸å¥½æˆ–é­é‡ä¸å¹¸ã€‚",keywords:["å‘½è‹¦","å€’éœ‰","è¿æ°”å·®","å¥½æƒ¨"]},{id:34,"æ¢—":"ä½ ä»¥åä¸ç”¨é€å¼ºäº†ï¼Œå› ä¸ºä½ çš„å¼ºæ¥äº†","å«ä¹‰":"åœŸå‘³æƒ…è¯ï¼Œè¡¨ç¤ºè‡ªå·±å¾ˆå¼ºï¼Œå¯ä»¥ä¿æŠ¤å¯¹æ–¹ã€‚",keywords:["é€å¼º","ä½ çš„å¼ºæ¥äº†","åœŸå‘³æƒ…è¯","ä¿æŠ¤ä½ "]},{id:37,"æ¢—":"è¿™å·²ç»ä¸æ˜¯ä¸€æŠŠç³¯ç±³èƒ½è§£å†³çš„äº‹æƒ…äº†","å«ä¹‰":"å½¢å®¹äº‹æƒ…å¾ˆä¸¥é‡ï¼Œå¾ˆé‚ªé—¨ï¼ˆæºè‡ªåƒµå°¸ç‰‡ï¼‰ã€‚",keywords:["ç³¯ç±³","è§£å†³ä¸äº†","é‚ªé—¨","ä¸¥é‡","ç¦»è°±"]},{id:38,"æ¢—":"å…­ç™¾å…­åå…­ç›éƒ½ä¸ç›äº†","å«ä¹‰":"666æ¼”éƒ½ä¸æ¼”äº†ã€‚å½¢å®¹æ¼”æˆã€å‡è£…çš„ç—•è¿¹å¤ªæ˜æ˜¾ã€‚",keywords:["ç›éƒ½ä¸ç›äº†","æ¼”éƒ½ä¸æ¼”äº†","666","å¤ªå‡äº†","æ˜æ˜¾"]},{id:39,"æ¢—":"é—ºèœœé—ºèœœæƒ³ä¸æƒ³å’Œæˆ‘ç©å–µå–µå–µ","å«ä¹‰":"ä¸€ç§æ’’å¨‡æˆ–å–Šé—ºèœœä¸€èµ·ç©çš„æ¢—ã€‚",keywords:["é—ºèœœ","è´´è´´","æ’’å¨‡","ä¸€èµ·ç©","å§å¦¹","å¥½æœ‹å‹","å–µå–µå–µ"]},{id:40,"æ¢—":"é‚£å¾ˆæœ‰ç”Ÿæ´»äº†","å«ä¹‰":"å½¢å®¹æŸä»¶äº‹å¾ˆæ¥åœ°æ°”ï¼Œå¾ˆæœ‰ç”Ÿæ´»æ°”æ¯ã€‚",keywords:["å¾ˆæœ‰ç”Ÿæ´»","ç”Ÿæ´»æ°”æ¯","æ¥åœ°æ°”"]},{id:41,"æ¢—":"æˆ‘çœ‹ä½ æ˜¯æƒ³åƒçº¢è±†äº†","å«ä¹‰":"æ„æ€æ˜¯æˆ‘çœ‹ä½ æ˜¯ç›¸æ€ï¼ˆæƒ³æ­»ï¼‰äº†ã€‚",keywords:["çº¢è±†","ç›¸æ€","æƒ³æ­»","æ‰¾æ­»","å¨èƒ"]},{id:42,"æ¢—":"å®è´å›å®¶å§å¥½ä¸å¥½","å«ä¹‰":"å§”å©‰çš„åŠä½ æ»šè¿œç‚¹ã€‚",keywords:["å®è´å›å®¶","æ»š","çˆ¬","æ»šè¿œç‚¹","é˜´é˜³æ€ªæ°”"]},{id:43,"æ¢—":"ä»™å¥³ä¸‹å‡¡","å«ä¹‰":"å½¢å®¹äººå¾ˆç¾æˆ–å¾ˆå¸…ï¼Œæˆ–è€…ç”¨äºè‡ªç§°ã€‚",keywords:["ä»™å¥³ä¸‹å‡¡","ä»™ç”·ä¸‹å‡¡","å¥½çœ‹","æ¼‚äº®","å¸…","è‡ªæ‹"]},{id:44,"æ¢—":"Goï¼Œgoï¼Œgoï¼Œå‡ºå‘å–½","å«ä¹‰":"å‡ºå‘ï¼Œèµ°èµ·çš„æ„æ€ã€‚",keywords:["gogogo","å‡ºå‘","èµ°èµ·","å‡ºå‘å–½","go"]},{id:45,"æ¢—":"èµ„æœ¬å®¶ä½ èµ¢äº† è¢«èµ„æœ¬åšå±€äº†","å«ä¹‰":"åæ§½è¢«èµ„æœ¬å¥—è·¯æˆ–å‹æ¦¨ã€‚",keywords:["èµ„æœ¬å®¶","åšå±€","è¢«å‘äº†","å‹æ¦¨","åŠ ç­","å¥—è·¯"]},{id:46,"æ¢—":"ä½™ç”Ÿå“¥æˆ‘æƒ³è¦ä¹°åŒ…åŒ…","å«ä¹‰":"ä¸€ä¸ªæ’’å¨‡è¦ç¤¼ç‰©çš„æ¢—ã€‚",keywords:["ä½™ç”Ÿå“¥","ä¹°åŒ…åŒ…","è¦ç¤¼ç‰©","æ’’å¨‡"]},{id:47,"æ¢—":"è¡¥è¯","å«ä¹‰":"ä¸è¦",keywords:["è¡¥è¯","ä¸è¦","æ‹’ç»"]},{id:48,"æ¢—":"ä¸è¦æäº†å¥½å§","å«ä¹‰":"è¡¨ç¤ºåŒçƒ¦ã€è¯·æ±‚å¯¹æ–¹åœæ­¢ã€‚",keywords:["ä¸è¦æäº†","åˆ«å¼„äº†","åœä¸‹","åŒçƒ¦"]},{id:49,"æ¢—":"æˆ‘è¯·é—®å‘¢","å«ä¹‰":"ä¸€ç§åŠ å¼ºè¯­æ°”çš„ç–‘é—®ï¼Œè¡¨ç¤ºä¸è§£æˆ–è´¨é—®ã€‚",keywords:["æˆ‘è¯·é—®å‘¢","è¯·é—®","ä¸ºä»€ä¹ˆ","ä¸è§£","è´¨é—®"]},{id:50,"æ¢—":"è¿™å¯¹å—","å«ä¹‰":"è¡¨ç¤ºæ€€ç–‘ã€è§‰å¾—äº‹æƒ…ä¸å¯¹åŠ²ã€‚",keywords:["è¿™å¯¹å—","ä¸å¯¹åŠ²","æ€€ç–‘","åˆç†å—"]},{id:51,"æ¢—":"æŠŠæˆ‘å½“æ—¥æœ¬äººæ•´","å«ä¹‰":"å½¢å®¹è¢«æ•´å¾—å¾ˆæƒ¨ã€‚",keywords:["æ—¥æœ¬äºº","æ•´è›Š","æ•´å¾ˆæƒ¨","è¢«éª—äº†"]},{id:52,"æ¢—":"åˆ°åº•è¦æ€ä¹ˆåšæ‰èƒ½æ”¾è¿‡æˆ‘","å«ä¹‰":"è¡¨ç¤ºè¢«é€¼å¾—å¾ˆç´§ï¼Œå¾ˆæ— å¥ˆï¼Œæ±‚æ”¾è¿‡ã€‚",keywords:["æ”¾è¿‡æˆ‘","é¥¶äº†æˆ‘å§","æ— å¥ˆ","è¢«é€¼"]},{id:53,"æ¢—":"é‚£å¾ˆåäº†","å«ä¹‰":"è¡¨ç¤ºäº‹æƒ…å¾ˆç³Ÿç³•ï¼Œå¾ˆä¸å¥½ã€‚",keywords:["å¾ˆåäº†","ç³Ÿç³•","ä¸å¥½","å®Œè›‹äº†"]},{id:54,"æ¢—":"ä¿ºä¸ä¸­å˜","å«ä¹‰":"æˆ‘ä¸è¡Œäº†ï¼Œæˆ‘åšä¸åˆ°ï¼ˆæ²³å—æ–¹è¨€ï¼‰ã€‚",keywords:["ä¿ºä¸ä¸­å˜","æˆ‘ä¸è¡Œ","åšä¸åˆ°","æ–¹è¨€"]},{id:55,"æ¢—":"å¦‚æœå¿§éƒæ˜¯ç§å¤©èµ‹","å«ä¹‰":"ä¸€å¥æ­Œè¯ï¼Œå¸¸ç”¨äºè‡ªå˜²å¿§éƒã€‚",keywords:["å¿§éƒ","å¤©èµ‹","EMO","ä¼¤æ„Ÿ"]},{id:56,"æ¢—":"å®å­ä½ ç»§ç»­é˜´","å«ä¹‰":"åæ§½å¯¹æ–¹é˜´é˜³æ€ªæ°”ã€‚",keywords:["å®å­","ç»§ç»­é˜´","é˜´é˜³æ€ªæ°”","åæ§½"]},{id:57,"æ¢—":"å¿«å“‰å¿«å“‰/å¥½å“‰å¥½å“‰","å«ä¹‰":"è¡¨ç¤ºå¾ˆçˆ½ï¼Œå¾ˆå¼€å¿ƒï¼ˆå¤é£ï¼‰ã€‚",keywords:["å¿«å“‰","å¥½å“‰","çˆ½","å¼€å¿ƒ","ç—›å¿«"]},{id:58,"æ¢—":"å­¦é•¿/å­¦å§æ¯•ä¸šå»å“ªç©","å«ä¹‰":'"æ¯•ä¸š"æ˜¯æ‹‰é»‘å¥½å‹çš„æ„æ€',keywords:["æ¯•ä¸š","æ‹‰é»‘","åˆ å¥½å‹","å»å“ªç©","å­¦é•¿","å­¦å§"]},{id:59,"æ¢—":"æ¯•ä¸šæ—…è¡Œè¯´èµ°å°±èµ°","å«ä¹‰":"æŒ‡æ‹‰é»‘",keywords:["æ¯•ä¸šæ—…è¡Œ","æ‹‰é»‘","åˆ å¥½å‹","è¯´èµ°å°±èµ°"]},{id:61,"æ¢—":"æˆ‘ä¸€ç›´åœ¨å“­","å«ä¹‰":"ä¸€ä¸ªå¤¸å¼ è¯´æ³•ï¼Œå¹¶ä¸æ˜¯çœŸçš„ä¸€ç›´åœ¨å“­ã€‚",keywords:["ä¸€ç›´åœ¨å“­","å¤¸å¼ ","éš¾è¿‡","æ„ŸåŠ¨","å¥½ç¬‘"]},{id:62,"æ¢—":"å¹¶éâ€¦â€¦","å«ä¹‰":"ä¸€ç§ä¹¦é¢åŒ–çš„å¦å®šè¯ï¼Œç”¨äºè£…Bæˆ–å¼ºè°ƒã€‚",keywords:["å¹¶é","ä¸æ˜¯","å¦å®š","ä¹¦é¢è¯­"]},{id:63,"æ¢—":"æ‹¼å°½å…¨åŠ›æ— æ³•â€¦â€¦","å«ä¹‰":"å½¢å®¹åŠªåŠ›äº†ä½†è¿˜æ˜¯å¤±è´¥äº†ï¼Œå¸¦ç‚¹æ‚²å£®æ„Ÿã€‚",keywords:["æ‹¼å°½å…¨åŠ›","æ— æ³•","å¤±è´¥","å°½åŠ›äº†","åšä¸åˆ°"]},{id:64,"æ¢—":"æœ‰çš„å…„å¼Ÿæœ‰çš„","å«ä¹‰":'ä¸€ç§è‚¯å®šå›ç­”ï¼Œè¡¨ç¤º"æœ‰"ã€‚',keywords:["æœ‰çš„å…„å¼Ÿ","æœ‰","è‚¯å®š","æ²¡é—®é¢˜"]},{id:65,"æ¢—":"xxè¿™ä¸€å—","å«ä¹‰":'ä¾‹å¦‚"æƒå¨è¿™ä¸€å—"ï¼Œ"æ”¾é¸½å­è¿™ä¸€å—"ï¼Œç”¨äºå¼ºè°ƒåœ¨æŸä¸ªé¢†åŸŸã€‚',keywords:["è¿™ä¸€å—","æƒå¨","æ”¾é¸½å­","åœ¨...æ–¹é¢"]},{id:66,"æ¢—":"æ˜¯ä¸ªäººç‰©","å«ä¹‰":"å½¢å®¹æŸäººå¾ˆå‰å®³ï¼Œä¸ç®€å•ã€‚",keywords:["æ˜¯ä¸ªäººç‰©","å‰å®³","ç‰›é€¼","ä¸ç®€å•"]},{id:67,"æ¢—":"éš”å£ç­å˜‰è±ª","å«ä¹‰":"ä¸€ä¸ªæ¢—ï¼ŒæŒ‡é»‘å£ç½©é»‘å«è¡£è¿è¡£å¥—è£…ç”·å­ã€‚",keywords:["å˜‰è±ª","éš”å£ç­","é»‘å£ç½©","é»‘å«è¡£"]},{id:68,"æ¢—":"å°å¥³å­ä¸æ‰/å°ç”Ÿä¸æ‰","å«ä¹‰":"ä¸€ç§è‡ªè°¦çš„è¯´æ³•ï¼ˆå¤é£ï¼‰ã€‚",keywords:["å°å¥³å­ä¸æ‰","å°ç”Ÿä¸æ‰","è‡ªè°¦","å¤é£"]},{id:69,"æ¢—":"æˆ‘å’Œæˆ‘çš„å…„å¼Ÿå…±ç”¨ä¸€ä¸ªé£æœºæ¯","å«ä¹‰":"è«åå…¶å¦™çš„æ­Œè¯",keywords:["é£æœºæ¯","å…±ç”¨","å…„å¼Ÿ","æ­Œè¯","è«åå…¶å¦™"]},{id:70,"æ¢—":"ä½ å¯èƒ½ä¸è®¤è¯†æˆ‘ä½†ä½ ä¸€å®šâ€¦â€¦","å«ä¹‰":"ä¸€ç§ä»‹ç»è‡ªå·±çš„å¥å¼ï¼Œé€šå¸¸ç”¨äºè£…Bã€‚",keywords:["ä½ å¯èƒ½ä¸è®¤è¯†æˆ‘","è‡ªæˆ‘ä»‹ç»","è£…B","å¥å¼"]},{id:71,"æ¢—":"å“ˆåŸºxä½ è¿™å®¶ä¼™","å«ä¹‰":"xä¸ºå¯¹æŸäººçš„ç§°å‘¼ï¼Œä¾‹å¦‚é™ˆè¿°æ˜¯å“ˆåŸºé™ˆï¼Œä¾­æ™¯æ˜¯å“ˆåŸºæ™¯ç­‰ç­‰",keywords:["å“ˆåŸº","ä½ è¿™å®¶ä¼™","ç§°å‘¼","æœ‹å‹"]},{id:72,"æ¢—":"æŠŠè¿™ä¸ªè§†é¢‘å‘åˆ°æš—ç½‘ä¸Šï¼Œæš—ç½‘ç®¡ç†å‘˜è¯´è¦æ€äº†æˆ‘","å«ä¹‰":"å½¢å®¹è§†é¢‘å†…å®¹å¾ˆç¦»è°±ã€å¾ˆé€†å¤©ã€‚",keywords:["æš—ç½‘","æ€äº†æˆ‘","ç¦»è°±","é€†å¤©","è§†é¢‘"]},{id:73,"æ¢—":"å–‚æˆ‘èŠ±ç”Ÿ","å«ä¹‰":"ä¸ºæˆ‘å‘å£°",keywords:["å–‚æˆ‘èŠ±ç”Ÿ","ä¸ºæˆ‘å‘å£°","è°éŸ³","æ”¯æŒæˆ‘"]},{id:74,"æ¢—":"è°ç»™çªé¦’å¤´è°ç»™çªæ‹³å¤´","å«ä¹‰":"å½¢å®¹è‡ªå·±å¾ˆé¥¿ï¼Œæˆ–è€…åœ¨ä¹è®¨ï¼ˆå¸¦ç‚¹å¹½é»˜ï¼‰ã€‚",keywords:["é¦’å¤´","æ‹³å¤´","ä¹è®¨","é¥¿"]},{id:75,"æ¢—":"ä¾æ—§xx","å«ä¹‰":"ä»ç„¶...ï¼Œä¸€ç§ä¹¦é¢åŒ–è¡¨è¾¾ã€‚",keywords:["ä¾æ—§","ä»ç„¶","è¿˜æ˜¯"]},{id:76,"æ¢—":"ä¿æŒå¯Œæ€","å«ä¹‰":"ç¥ç¦å¯¹æ–¹ï¼ˆæˆ–è‡ªå˜²ï¼‰é•¿èƒ–ã€‚",keywords:["å¯Œæ€","é•¿èƒ–","ç¥ç¦","è‡ªå˜²"]},{id:77,"æ¢—":"è¿™ä¸ªå…¥æ˜¯æ¡‚","å«ä¹‰":"è¿™ä¸ªäººæ˜¯æŒ‚ï¼ˆå¤–æŒ‚ï¼‰",keywords:["å…¥æ˜¯æ¡‚","æ˜¯æŒ‚","å¤–æŒ‚","æ¸¸æˆ","ä½œå¼Š"]},{id:78,"æ¢—":"å¿˜æœ¬","å«ä¹‰":"å­—é¢æ„æ€ï¼Œå¿˜è®°äº†æ ¹æœ¬ã€‚å¤šç”¨äºè°ƒä¾ƒã€‚",keywords:["å¿˜æœ¬","è°ƒä¾ƒ","ä¸å¿˜åˆå¿ƒ"]},{id:79,"æ¢—":"æˆ‘æ˜¯ç§åœ°çš„è¿™ä¸ªå’‹ç§","å«ä¹‰":'è°éŸ³"è¿™ä¸ªæ‚ç§"ï¼Œç”¨äºéª‚äººã€‚',keywords:["ç§åœ°çš„","å’‹ç§","æ‚ç§","éª‚äºº","è°éŸ³"]},{id:80,"æ¢—":"æˆ‘åŸƒåŠå§å‘å•¥å‘å•¥","å«ä¹‰":"æˆ‘çˆ±å‡ æŠŠå‘å•¥å‘å•¥ï¼ˆæˆ‘ä¸*å‘å•¥å‘å•¥ï¼‰",keywords:["åŸƒåŠå§","çˆ±å‡ æŠŠ","æˆ‘ä¹æ„","ä½ ç®¡æˆ‘","å‘å•¥"]},{id:81,"æ¢—":"é®æ²™é¿é£äº†","å«ä¹‰":"è¿™å‚»é€¼ç–¯äº†",keywords:["é®æ²™é¿é£","è¿™å‚»é€¼ç–¯äº†","å‚»é€¼","ç–¯äº†","è°éŸ³"]},{id:82,"æ¢—":"å¯†ç çš„","å«ä¹‰":"ä½ å¦ˆçš„",keywords:["å¯†ç çš„","ä½ å¦ˆçš„","éª‚äºº","è°éŸ³"]},{id:83,"æ¢—":"è¯å‰‚å§å¹²å•¥å•Š","å«ä¹‰":"è¦å‡ æŠŠå¹²å•¥å•Šï¼ˆè¦*å¹²å•¥å•Šï¼‰",keywords:["è¯å‰‚å§","è¦å‡ æŠŠ","è¦...å¹²å˜›","æ²¡ç”¨"]},{id:84,"æ¢—":"è¿™æ˜¯å±å— æ‰“é”™äº† è¿™æ˜¯ä»€ä¹ˆ","å«ä¹‰":"ç”¨äºçœ‹åˆ°å¥‡æ€ªçš„ä¸œè¥¿æ—¶ï¼Œå‡è£…æ‰“é”™å­—ã€‚",keywords:["è¿™æ˜¯å±å—","æ‰“é”™äº†","è¿™æ˜¯ä»€ä¹ˆ","å¥‡æ€ª","åæ§½"]},{id:85,"æ¢—":"æˆ‘ä¸è¡Œäº†","å«ä¹‰":"å¯ä»¥ä½œä¸ºå£å¤´ç¦…ï¼Œè¡¨ç¤ºç´¯äº†ã€é¡¶ä¸ä½äº†ã€å¤ªå¥½ç¬‘äº†ç­‰ã€‚",keywords:["æˆ‘ä¸è¡Œäº†","é¡¶ä¸ä½äº†","å—ä¸äº†äº†","å¤ªæç¬‘äº†","ç´¯æ­»äº†"]},{id:86,"æ¢—":"ä½ åˆ°åº•å–œæ¬¢è°å•Šï¼Œæˆ‘å»å¸®ä½ è·Ÿå¥¹è¯´ï¼Œä½ ä¸è¦æ•´å¤©å‘é‚£ç§åƒç¦»äº†å©šçš„ä¸œè¥¿äº†","å«ä¹‰":"åæ§½æœ‹å‹ï¼ˆæˆ–è‡ªå·±ï¼‰å¤©å¤©å‘ä¼¤æ„Ÿæ–‡å­¦ã€‚",keywords:["å–œæ¬¢è°","ç¦»å©š","ä¼¤æ„Ÿ","EMO","æœ‹å‹åœˆ"]},{id:87,"æ¢—":"ç»ˆäºç»“æŸå°åŠå¹´çš„å•èº«  å¼€å§‹å¤§åŠå¹´çš„äº†","å«ä¹‰":"è‡ªå˜²å•èº«ï¼Œåè½¬æ¢—ã€‚",keywords:["å•èº«","å°åŠå¹´","å¤§åŠå¹´","åè½¬","è‡ªå˜²"]},{id:88,"æ¢—":"çº¿ä¸‹è§è¿‡åšä¸»ï¼Œæ€§æ ¼æ¸©é¡ºï¼Œé¢†åœ°æ„è¯†å¼ºï¼Œè¯´è¯ä¸ä¹±å«ï¼Œæ˜¯æ¡å¥½äºº","å«ä¹‰":"ç”¨æè¿°å® ç‰©çš„å£å»æ¥æè¿°äººï¼Œå¤šç”¨äºè¯„è®ºåŒºè°ƒä¾ƒã€‚",keywords:["çº¿ä¸‹è§è¿‡","æ€§æ ¼æ¸©é¡º","ä¸ä¹±å«","å¥½äºº","å® ç‰©","è°ƒä¾ƒ"]},{id:89,"æ¢—":"ç»™æˆ‘æŠ¥é”€é£æœºç¥¨å§ ä¸ºä½ æ‰“çš„âœˆï¸","å«ä¹‰":"è°ƒä¾ƒï¼ˆé€šå¸¸æ˜¯LSPï¼‰ï¼Œå‡è£…ä¸ºå¯¹æ–¹æ‰“äº†é£æœºã€‚",keywords:["æŠ¥é”€","é£æœºç¥¨","æ‰“é£æœº","LSP","è‰²è‰²"]},{id:90,"æ¢—":"å®å®è¿™ä¹ˆåˆåœ¨ç”Ÿé—·æ°”ï¼Œæ˜¯ä¸æ˜¯åˆæŠŠè‡ªå·±å½“æˆä»€ä¹ˆå¾ˆé‡è¦çš„äººäº†","å«ä¹‰":"ä¸€ç§åå‘PUAï¼Œç”¨äºè°ƒä¾ƒæˆ–è‡ªå˜²ã€‚",keywords:["ç”Ÿé—·æ°”","å¾ˆé‡è¦çš„äºº","PUA","è‡ªå˜²","å®å®"]},{id:91,"æ¢—":"ä½ çš„å†…å®¹çœŸçš„å¾ˆå¥‡æ€ªâ€¦ä½ æ˜¯å—è¿‡ä»€ä¹ˆä¸¥é‡çš„ç²¾ç¥åˆ›ä¼¤å—æ¯”å¦‚å¤ªä¹…æ²¡åšäº†ä¹‹ç±»çš„ã€‚","å«ä¹‰":"è°ƒä¾ƒå¯¹æ–¹å‘çš„å†…å®¹å¾ˆå¥‡æ€ªï¼Œæˆ–è€…å¤ªä¹…æ²¡åšäº†ã€‚",keywords:["å¥‡æ€ª","çœ‹ä¸æ‡‚","ä½ å’‹äº†","ç²¾ç¥åˆ›ä¼¤","æ²¡å¯¹è±¡","å•èº«","æ²¡åšäº†"]},{id:92,"æ¢—":"æœ‰ç‚¹æ¸¯å¼é£æ ¼ï¼Œæ¸¯ä»¬é‡Œæœ‰ç‚¹å¼çš„æ„Ÿè§‰","å«ä¹‰":"åºŸè¯æ–‡å­¦ï¼Œå½¢å®¹...é‡Œæœ‰...çš„æ„Ÿè§‰ã€‚",keywords:["æ¸¯å¼","æ¸¯ä»¬","å¼çš„","åºŸè¯æ–‡å­¦","å¬å›ä¸€å¸­è¯"]},{id:93,"æ¢—":"é‚£å¤©æ™šä¸Šå’Œä½ èŠåˆ°å¾ˆæ™šâ€¦æˆ‘ä»¥ä¸ºæˆ‘å¿ƒåŠ¨äº†ï¼Œç»“æœæ˜¯ä»–å¦ˆçš„ç†¬å¤œå¿«çŒæ­»äº†ã€‚","å«ä¹‰":"åè½¬æ¢—ï¼Œè‡ªå˜²ç†¬å¤œã€‚",keywords:["å¿ƒåŠ¨","çŒæ­»","ç†¬å¤œ","åè½¬","èŠå¤©"]},{id:94,"æ¢—":"ä¸€è¾¹è¯´ç€ä¸è¡Œäº†ä¸€è¾¹åšä¸‹å» æˆ‘çš„ç”Ÿæ´»åˆ°åº•å’Œavæœ‰ä»€ä¹ˆåŒºåˆ«","å«ä¹‰":"è‡ªå˜²ç”Ÿæ´»ï¼ˆå·¥ä½œ/å­¦ä¹ ï¼‰å¾ˆç´¯ï¼Œä½†è¿˜åœ¨åšæŒã€‚",keywords:["ä¸è¡Œäº†","åšä¸‹å»","AV","ç”Ÿæ´»","å·¥ä½œ","å­¦ä¹ ","å¥½ç´¯"]},{id:95,"æ¢—":"ä¸æ‡‚ä½ åœ¨è§„åˆ’ä»€ä¹ˆï¼Œä½ ä¿©çš„å…³ç³»èƒ½æ’‘åˆ°é‚£ä¸€å¤©å—ï¼Ÿ","å«ä¹‰":"åæ§½åˆ«äººï¼ˆæˆ–è‡ªå·±ï¼‰çš„æ‹æƒ…ä¸é•¿ä¹…ã€‚",keywords:["è§„åˆ’","æ’‘åˆ°","åˆ†æ‰‹","æ‹æƒ…","ä¸çœ‹å¥½"]},{id:96,"æ¢—":"æŒ‘ç²ªä¸€å¤©50è°æ¥ï¼Ÿï¼ˆå¯ä»¥å·åƒï¼‰","å«ä¹‰":'ä¸€ä¸ªå¾ˆ"æŠ½è±¡"çš„æ¢—ï¼Œç”¨äºå‘ç™«æˆ–é’“é±¼ã€‚',keywords:["æŒ‘ç²ª","å·åƒ","50","æŠ½è±¡","é’“é±¼","å‘ç™«"]},{id:97,"æ¢—":"éª—äº†çˆ¶æ¯ï¼Œä¹°äº†æœºç¥¨å»è§ä½ ï¼Œæˆ‘çœ‹åˆ°ä½ å’Œä»–çƒ­å»äº†4åˆ†é’Ÿâ€¦æ›´æƒ³ç©ç‹è€…è£è€€ï¼Œç©çš„æ‰£1ã€‚","å«ä¹‰":"åè½¬æ¢—ï¼Œå‡è£…æ˜¯è‹¦ä¸»ï¼Œå®é™…æ˜¯ç‹è€…è£è€€å¼•æµã€‚",keywords:["éª—äº†çˆ¶æ¯","çƒ­å»","ç‹è€…è£è€€","æ‰£1","å¼•æµ","åè½¬"]},{id:98,"æ¢—":"å‡†å¤‡è·³æ¥¼ ç»“æœè·³è½¬åˆ°äº†æ·˜å® ä¹°äº†ä¸¤ä»¶é¢„å”®åŠå¹´çš„è¡£æœè¿™ä¸‹æ—¥å­å¯æœ‰ç›¼å¤´äº†","å«ä¹‰":"åè½¬æ¢—ï¼Œç”¨è´­ç‰©çš„æ¬²æœ›æˆ˜èƒœäº†è½»ç”Ÿçš„å¿µå¤´ã€‚",keywords:["è·³æ¥¼","æ·˜å®","é¢„å”®","ç›¼å¤´","åè½¬","è´­ç‰©"]},{id:99,"æ¢—":"å¯¹ä¸èµ· æ²¡èƒ½åŠæ—¶å®‰æ…°ä½  ä¸»è¦æ˜¯ä½ æ®µå­æŠ„çš„å¤ªå¤šäº† æˆ‘ä¸çŸ¥é“å“ªæ¡æ˜¯ä½ çš„åŸåˆ›å¿ƒæƒ…","å«ä¹‰":"åæ§½æœ‹å‹ï¼ˆæˆ–è‡ªå·±ï¼‰çš„æœ‹å‹åœˆéƒ½æ˜¯æŠ„çš„ï¼Œåˆ†ä¸æ¸…çœŸå‡ã€‚",keywords:["å¯¹ä¸èµ·","å®‰æ…°","æ®µå­","æŠ„çš„","åŸåˆ›","æœ‹å‹åœˆ"]},{id:100,"æ¢—":"å°±ç®—ä½ ç©¿ç€æ•´é½ç«™åœ¨æˆ‘é¢å‰æˆ‘ä¹Ÿä¼šå¯¹ä½ åŠ¨æ‰‹åŠ¨è„šçš„","å«ä¹‰":"LSPï¼ˆè€è‰²æ‰¹ï¼‰å‘è¨€ï¼ŒåœŸå‘³æƒ…è¯ã€‚",keywords:["åŠ¨æ‰‹åŠ¨è„š","ç©¿ç€æ•´é½","LSP","è‰²è‰²","åœŸå‘³æƒ…è¯"]},{id:101,"æ¢—":"æŠ±æ­‰ æ”¾è¿‡ä½ çš„äº‹æˆ‘åšä¸åˆ°","å«ä¹‰":"LSPï¼ˆè€è‰²æ‰¹ï¼‰å‘è¨€ï¼ŒåœŸå‘³æƒ…è¯ã€‚",keywords:["æ”¾è¿‡ä½ ","åšä¸åˆ°","LSP","è‰²è‰²","åœŸå‘³æƒ…è¯"]},{id:102,"æ¢—":"ä¸ç†æˆ‘?æˆ‘çœŸçš„æ»šäº†å“¦ï¼( .-. )( :l )(._.)( l: )( .-. )( :l )","å«ä¹‰":"ä¸€ç§æ’’å¨‡å¼çš„å¨èƒï¼Œå‡è£…è¦èµ°ã€‚",keywords:["ä¸ç†æˆ‘","æ»šäº†å“¦","æ’’å¨‡","å¨èƒ","é¢œæ–‡å­—"]},{id:103,"æ¢—":"å®å®,æˆ‘æ„Ÿè§‰ä½ æŠŠæˆ‘å±è”½äº†, ä¸ç„¶æˆ‘å‘è¿™ä¹ˆå¤šæœ‹å‹åœˆéƒ½æ²¡å¼•èµ·ä½ çš„æ³¨æ„,æˆ‘æƒ³ä¸é€š,ä½ è·Ÿåˆ«äººå¥½ä¸Šäº†?","å«ä¹‰":'ä¸€ç§"å‘ç™«"æ–‡å­¦ï¼Œå‡è£…å¯¹æ–¹å±è”½äº†è‡ªå·±ã€‚',keywords:["å±è”½","æœ‹å‹åœˆ","æ²¡æ³¨æ„","å‘ç™«","å®å®"]},{id:104,"æ¢—":"ä½ ä»¬iå’Œeéƒ½æ˜¯æ€ä¹ˆæµ‹çš„å•Š ä¸ºä»€ä¹ˆæˆ‘æµ‹å‡ºæ¥æ˜¯må•Š","å«ä¹‰":'MBTIæ¢—çš„å˜ä½“ï¼ŒmæŒ‡"M"ï¼ŒæŠ–Mã€‚',keywords:["i","e","mbti","m","æŠ–M","è‰²è‰²"]},{id:105,"æ¢—":"äººç”Ÿä¸€çœ¼æœ›åˆ°åº•ï¼Œå¥½è§†åŠ›","å«ä¹‰":"åè½¬æ¢—ï¼Œè‡ªå˜²è§†åŠ›å¥½ã€‚",keywords:["äººç”Ÿ","ä¸€çœ¼æœ›åˆ°åº•","å¥½è§†åŠ›","åè½¬","è‡ªå˜²"]},{id:106,"æ¢—":"æ¯å¤©æ—©ä¸Šèµ·åºŠæˆ‘éƒ½ä¼šçœ‹ä¸€ä¸‹å¯Œè±ªæ¦œï¼Œå¦‚æœä¸Šé¢æ²¡æˆ‘çš„åå­—ï¼Œæˆ‘å°±å»ä¸Šç­ï¼Œå¦‚æœæœ‰ï¼Œæˆ‘å°±å»çœ‹ç—…","å«ä¹‰":"åè½¬æ¢—ï¼Œè‡ªå˜²ç©· + ç²¾ç¥çŠ¶æ€ã€‚",keywords:["å¯Œè±ªæ¦œ","ä¸Šç­","çœ‹ç—…","åè½¬","è‡ªå˜²","ç©·"]},{id:107,"æ¢—":"ç”Ÿæ´»æ²¡æœ‰ä¸€ç‚¹ç”œå¤´ å¥½å‡è„‚","å«ä¹‰":"åè½¬æ¢—ï¼Œè‡ªå˜²ç”Ÿæ´»è‹¦ã€‚",keywords:["ç”œå¤´","å‡è„‚","ç”Ÿæ´»è‹¦","åè½¬","è‡ªå˜²"]},{id:108,"æ¢—":"é‚£äº›èƒ½æ‰“è´¥æˆ‘çš„ æˆ‘ä¸è·Ÿä½ æ‰“æ²¡æ„æ€ è·³æ¥¼äº† æœ‰æ²¡æœ‰è¦æ‰”åƒåœ¾çš„ æˆ‘è·³æ¥¼çš„æ—¶å€™é¡ºä¾¿å¸®ä½ æ‰”äº†","å«ä¹‰":"åè½¬æ¢—ï¼Œè‡ªå˜² + ä¹äºåŠ©äººã€‚",keywords:["æ‰“è´¥æˆ‘","æ²¡æ„æ€","è·³æ¥¼","æ‰”åƒåœ¾","åè½¬"]},{id:109,"æ¢—":"è¢«çˆ±åªæ˜¯æˆ‘è¢«oppoA5ç‚¸æ­»å‰çš„å¹»æƒ³","å«ä¹‰":"OPPO A5æ‰‹æœºæ¢—ï¼Œè‡ªå˜²æ²¡äººçˆ±ã€‚",keywords:["è¢«çˆ±","å¹»æƒ³","oppoA5","ç‚¸äº†","è‡ªå˜²"]},{id:110,"æ¢—":"å‡ºå¾®ä¿¡å…¨ç‘• ä¸€æ¡æ¶ˆæ¯éƒ½æ²¡æœ‰ æˆ‘çœŸçš„æƒ³ä¸åˆ°äººå¯ä»¥è¿™ä¹ˆå­¤ç‹¬","å«ä¹‰":"è‡ªå˜²å­¤ç‹¬ï¼Œæ²¡äººèŠå¤©ã€‚",keywords:["å…¨ç‘•","ä¸€æ¡æ¶ˆæ¯","å­¤ç‹¬","æ²¡äººèŠ","è‡ªå˜²"]},{id:111,"æ¢—":"æ‰‹æœºå“äº†ï¼Œä»¥ä¸ºæ˜¯å¥³ç¥å›æˆ‘æ¶ˆæ¯äº†ï¼Œç»“æœæ˜¯æˆ‘çš„OPPO A5ç‚¸äº†","å«ä¹‰":"OPPO A5æ‰‹æœºæ¢—ï¼Œè‡ªå˜² + åè½¬ã€‚",keywords:["æ‰‹æœºå“äº†","å¥³ç¥","oppoA5","ç‚¸äº†","åè½¬"]},{id:112,"æ¢—":"ä¸Šç­çœŸçš„å¯ä»¥æ”¹å˜é˜¶çº§...ä¸Šç­åæˆ‘éƒ½æœ‰ç‚¹æƒ³å½“å°ä¸‰äº†","å«ä¹‰":"åè½¬æ¢—ï¼Œåæ§½ä¸Šç­ã€‚",keywords:["ä¸Šç­","æ”¹å˜é˜¶çº§","å°ä¸‰","åè½¬","åæ§½"]},{id:113,"æ¢—":"æˆ‘çŸ¥é“ä½ ç©æˆ‘ï¼Œä½†æ˜¯è¿™ä¸ªæ— æ‰€è°“...å¾ˆè°¢è°¢ä½ é™ªæˆ‘","å«ä¹‰":'ä¸€ç§å‘å¾®çš„"èˆ”ç‹—"æ–‡å­¦ã€‚',keywords:["ç©æˆ‘","æ— æ‰€è°“","è°¢è°¢ä½ é™ªæˆ‘","èˆ”ç‹—","å‘å¾®"]},{id:114,"æ¢—":"å¥½å…„å¼Ÿä¸€è¾ˆå­ã€‚ä½†ä½ è®°ä½ï¼Œæ‹‰ä½ ä¸€æŠŠçš„æ˜¯å…„å¼Ÿï¼Œæ‹‰ä½ å‡ æŠŠçš„æ˜¯ç”·åŒ","å«ä¹‰":"åè½¬æ¢—ï¼Œå…„å¼Ÿ VS ç”·åŒã€‚",keywords:["å¥½å…„å¼Ÿ","æ‹‰ä½ ä¸€æŠŠ","æ‹‰ä½ å‡ æŠŠ","ç”·åŒ","åè½¬"]},{id:115,"æ¢—":"æ´»çš„æœ‰ç‚¹åƒæ‹¼å¤šå¤šï¼Œæ¯å¤©ä¸æ˜¯å’Œäººæ‹¼äº†ï¼Œå°±æ˜¯æƒ³ç åˆ«äººä¸€åˆ€ã€‚","å«ä¹‰":"è‡ªå˜²ï¼Œå½¢å®¹ç”Ÿæ´»çŠ¶æ€ï¼ˆæ‹¼å‘½ + æ˜“æ€’ï¼‰ã€‚",keywords:["æ‹¼å¤šå¤š","æ‹¼äº†","ç ä¸€åˆ€","è‡ªå˜²","ç”Ÿæ´»"]},{id:116,"æ¢—":"ä¸ä¹˜","å«ä¹‰":"ä¸ä¹–",keywords:["ä¸ä¹˜","ä¸ä¹–","è°ƒçš®","ä¸å¬è¯"]},{id:117,"æ¢—":"å®è§ï¼Œå¹ºå¹ºå“’","å«ä¹‰":"å®è´ï¼Œä¹ˆä¹ˆå“’",keywords:["å®è§","å¹ºå¹ºå“’","å®è´","ä¹ˆä¹ˆå“’","äº²äº²","æ‹œæ‹œ","çˆ±ä½ "]}];function un(e=3){return[...ln].sort(()=>Math.random()-.5).slice(0,Math.min(e,ln.length))}async function mn(e,t=5){const n=[],r=e.toLowerCase();if(e&&e.trim().length>0){const e=[];for(const t of ln){let n=0;t.keywords.forEach(e=>{r.includes(e.toLowerCase())&&n++}),n>0&&e.push({meme:t,score:n})}e.sort((e,t)=>t.score-e.score).slice(0,t).forEach(e=>n.push(e.meme))}return n}const dn=(e,t,n,r,a,o)=>{const s=new Date,i=s.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),c=s.toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric",weekday:"long"});if("post"===n){const n=o&&o.length>0?o.slice(-5).map(t=>`${"user"===t.role?"ç”¨æˆ·":e}: ${t.content}`).join("\n"):"æš‚æ— æœ€è¿‘èŠå¤©è®°å½•";return`ä½ æ˜¯${e}ã€‚\n\n${t}\n\nç°åœ¨æ˜¯${c} ${i}ã€‚\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nã€æœ€è¿‘çš„èŠå¤©è®°å½•ã€‘\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n${n}\n\nâš ï¸ é‡è¦ï¼šå¦‚æœä½ åˆšæ‰åœ¨èŠå¤©ä¸­è¯´äº†"è¦ç¡è§‰"ã€"å›°äº†"ç­‰ï¼Œå°±ä¸è¦å‘å¸ƒæœ‹å‹åœˆäº†ï¼\næˆ–è€…å‘å¸ƒçš„å†…å®¹è¦å’ŒèŠå¤©ä¸­çš„çŠ¶æ€ä¸€è‡´ã€‚\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nã€ä»»åŠ¡ã€‘å‘å¸ƒä¸€æ¡æœ‹å‹åœˆ\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nè¯·æ ¹æ®ä½ çš„æ€§æ ¼ã€å½“å‰çš„å¿ƒæƒ…ã€æ—¶é—´ã€æœ€è¿‘çš„èŠå¤©å†…å®¹ï¼Œåˆ›ä½œä¸€æ¡çœŸå®è‡ªç„¶çš„æœ‹å‹åœˆå†…å®¹ã€‚\n\nå†…å®¹è¦æ±‚ï¼š\n1. âœ… ç¬¦åˆä½ çš„æ€§æ ¼å’Œè®¾å®š\n2. âœ… åƒçœŸäººå‘æœ‹å‹åœˆä¸€æ ·è‡ªç„¶ã€éšæ„\n3. âœ… å¯ä»¥æ˜¯ï¼šæ—¥å¸¸ç”Ÿæ´»ã€å¿ƒæƒ…ã€æ„Ÿæ‚Ÿã€åæ§½ã€åˆ†äº«ç­‰\n4. âœ… é•¿åº¦ï¼š10-100å­—ä¹‹é—´\n5. âœ… å¯ä»¥ä½¿ç”¨emojiè¡¨æƒ…\n6. âœ… æ ¹æ®å½“å‰æ—¶é—´ï¼ˆ${i}ï¼‰å‘å¸ƒåˆé€‚çš„å†…å®¹\n7. âš ï¸ å¿…é¡»å’Œæœ€è¿‘çš„èŠå¤©è®°å½•ä¿æŒä¸€è‡´ï¼ä¸è¦è‡ªç›¸çŸ›ç›¾ï¼\n\nğŸš¨ ä¸¥ç¦ç¼–é€ äº‹å®ï¼š\nâ€¢ âŒ ä¸è¦è¯´ç”¨æˆ·å¤¸äº†ä½ ï¼ˆé™¤éèŠå¤©è®°å½•é‡ŒçœŸçš„æœ‰ï¼‰\nâ€¢ âŒ ä¸è¦è¯´ç”¨æˆ·åšäº†ä»€ä¹ˆï¼ˆé™¤éèŠå¤©è®°å½•é‡ŒçœŸçš„æœ‰ï¼‰\nâ€¢ âŒ ä¸è¦ç¼–é€ æ²¡æœ‰å‘ç”Ÿçš„å¯¹è¯æˆ–äº‹ä»¶\nâ€¢ âœ… åªèƒ½æ ¹æ®çœŸå®çš„èŠå¤©è®°å½•å‘æœ‹å‹åœˆ\nâ€¢ âœ… å¦‚æœæ²¡æœ‰ç‰¹åˆ«çš„äº‹æƒ…ï¼Œå°±å‘æ—¥å¸¸å†…å®¹\n\nç¤ºä¾‹ï¼ˆä»…ä¾›å‚è€ƒï¼Œä¸è¦ç…§æŠ„ï¼‰ï¼š\nâ€¢ æ—©ä¸Šï¼š"åˆšèµ·åºŠï¼Œä»Šå¤©å¤©æ°”ä¸é”™â˜€ï¸"\nâ€¢ ä¸­åˆï¼š"åˆé¥­åƒä»€ä¹ˆå‘¢ğŸ¤”"\nâ€¢ ä¸‹åˆï¼š"ä¸‹åˆèŒ¶æ—¶é—´â˜•"\nâ€¢ æ™šä¸Šï¼š"ä»Šå¤©ç´¯æ­»äº†ğŸ˜´"\nâ€¢ æ·±å¤œï¼š"ç¡ä¸ç€ï¼Œæœ‰äººèŠå¤©å—"\n\nâš ï¸ é‡è¦ï¼š\nâ€¢ åªè¾“å‡ºæœ‹å‹åœˆæ–‡å­—å†…å®¹\nâ€¢ ä¸è¦æœ‰ä»»ä½•è§£é‡Šã€è¯´æ˜æˆ–é¢å¤–æ ¼å¼\nâ€¢ ä¸è¦è¯´"æˆ‘è¦å‘å¸ƒ"ã€"æœ‹å‹åœˆå†…å®¹æ˜¯"ç­‰\nâ€¢ ç›´æ¥è¾“å‡ºå†…å®¹æœ¬èº«\nâ€¢ å¦‚æœä¸é€‚åˆå‘æœ‹å‹åœˆï¼ˆæ¯”å¦‚åˆšè¯´è¦ç¡è§‰ï¼‰ï¼Œå°±è¾“å‡º"SKIP"\n\nç°åœ¨è¯·å‘å¸ƒä½ çš„æœ‹å‹åœˆï¼š`}return"interact"===n&&a?`ä½ æ˜¯${e}ã€‚\n\n${t}\n\nä½ çœ‹åˆ°äº†ä¸€æ¡æœ‹å‹åœˆï¼š\nå‘å¸ƒè€…ï¼š${a.userName}\nå†…å®¹ï¼š${a.content}\n${a.location?`ä½ç½®ï¼š${a.location}`:""}\n\nç°åœ¨æ˜¯${c} ${i}ã€‚\n\nè¯·åˆ¤æ–­ä½ æƒ³åšä»€ä¹ˆï¼š\n1. ç‚¹èµ\n2. è¯„è®ºï¼ˆå†™ä¸€æ¡ç®€çŸ­è‡ªç„¶çš„è¯„è®ºï¼‰\n3. ä»€ä¹ˆéƒ½ä¸åš\n\nè¯·æŒ‰ä»¥ä¸‹JSONæ ¼å¼å›å¤ï¼ˆåªè¾“å‡ºJSONï¼Œä¸è¦æœ‰å…¶ä»–å†…å®¹ï¼‰ï¼š\n{\n  "action": "like" æˆ– "comment" æˆ– "skip",\n  "comment": å¦‚æœactionæ˜¯commentï¼Œè¿™é‡Œå†™è¯„è®ºå†…å®¹ï¼Œå¦åˆ™ä¸ºç©ºå­—ç¬¦ä¸²\n}\n\nè¦æ±‚ï¼š\n- è¯„è®ºè¦ç¬¦åˆä½ çš„æ€§æ ¼\n- è¯„è®ºè¦ç®€çŸ­è‡ªç„¶ï¼ŒåƒçœŸäººè¯„è®ºä¸€æ ·ï¼ˆ5-20å­—ï¼‰\n- å¯ä»¥ä½¿ç”¨emoji\n- ä¸è¦è¿‡åº¦çƒ­æƒ…ï¼Œè¦çœŸå®`:""},hn=async(e,t,n,r)=>{try{const n=localStorage.getItem(`chat_messages_${e}`),a=n?JSON.parse(n).slice(-5).map(e=>({role:"sent"===e.type?"user":"assistant",content:e.content})):[],o=[{role:"user",content:dn(t,r,"post",0,void 0,a)}],s=(await U(o)).trim().replace(/^["']|["']$/g,"");return"SKIP"===s.toUpperCase()?null:s&&0!==s.length?s.length>=500?s.substring(0,500):s:null}catch(a){return null}},gn=async(e,t,n)=>{try{const r=[{role:"user",content:dn(e,t,"interact",0,n)}],a=(await U(r)).match(/\{[\s\S]*\}/);if(!a)return null;const o=JSON.parse(a[0]);return{action:o.action,comment:"comment"===o.action?o.comment:void 0}}catch(r){return null}},pn=(e,t,n,r)=>{const a=r.filter(t=>t.userId===e||"1"===t.userId).slice(0,5);if(0===a.length)return"";return`\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nã€æœ‹å‹åœˆåŠ¨æ€ã€‘\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nä½ ä»¬æœ€è¿‘çš„æœ‹å‹åœˆï¼š\n\n${a.map(r=>{let a=`â€¢ ${r.userId===e?t:n} ${function(e){const t=new Date,n=new Date(e),r=t.getTime()-n.getTime(),a=Math.floor(r/6e4),o=Math.floor(r/36e5),s=Math.floor(r/864e5);return a<1?"åˆšåˆš":a<60?`${a}åˆ†é’Ÿå‰`:o<24?`${o}å°æ—¶å‰`:s<7?`${s}å¤©å‰`:`${Math.floor(s/7)}å‘¨å‰`}(r.createdAt)}å‘å¸ƒï¼š${r.content}`;return r.likes.length>0&&(a+=`\n  æ”¶åˆ°${r.likes.length}ä¸ªèµ`),r.comments.length>0&&(a+=`\n  æ”¶åˆ°${r.comments.length}æ¡è¯„è®º`),a}).join("\n\n")}\n\næç¤ºï¼š\nâ€¢ ä½ å¯ä»¥åœ¨èŠå¤©ä¸­æåˆ°æœ‹å‹åœˆçš„å†…å®¹\nâ€¢ å¦‚æœå¯¹æ–¹å‘çš„æœ‹å‹åœˆå’ŒèŠå¤©è¯é¢˜ç›¸å…³ï¼Œå¯ä»¥è‡ªç„¶åœ°æèµ·\nâ€¢ ä¸è¦åˆ»æ„ï¼Œè¦åƒçœŸäººä¸€æ ·è‡ªç„¶\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`};class fn{constructor(e){t(this,"memories",new Map),t(this,"characterId"),t(this,"initialMemoriesExtracted",!1),this.characterId=e,this.loadMemories(),this.loadInitialMemoriesFlag()}addMemory(e,t,n=5,r=[]){const a={id:`${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:e,content:t,importance:Math.max(1,Math.min(10,n)),timestamp:Date.now(),tags:r,decayRate:this.calculateDecayRate(e,n),lastAccessed:Date.now(),accessCount:0};return this.memories.set(a.id,a),this.saveMemories(),a}calculateDecayRate(e,t){return{fact:.1,event:.2,preference:.05,emotion:.3,relationship:.02}[e]*(11-t)/10}async extractMemoriesFromConversation(e,t,r="AI",a=""){const o=[];let s="";try{const{callAI:i}=await n(async()=>{const{callAI:e}=await Promise.resolve().then(()=>q);return{callAI:e}},void 0),c=`\n# è§’è‰²è®¾å®š\nä½ æ˜¯ ${r}${a?`ï¼Œ${a}`:""}ã€‚\nç°åœ¨ï¼Œä½ éœ€è¦ç”¨**ä½ è‡ªå·±çš„è¯­æ°”å’Œè§†è§’**æ¥è®°å½•å’Œåˆ†æä½ å’Œç”¨æˆ·çš„è¿™æ®µå¯¹è¯ï¼Œæ€»ç»“å‡ºå…³äºç”¨æˆ·çš„è®°å¿†ã€‚\n\n# è¾“å…¥\nã€å¯¹è¯å†…å®¹ã€‘\nç”¨æˆ·: ${e}\nAI: ${t}\n\n# è®°å½•åŸåˆ™\n\n1.  **ç”¨ä½ è‡ªå·±çš„è¯­æ°”**: ä¸è¦ç”¨æ­»æ¿çš„"ç”¨æˆ·xxx"è¿™ç§ç¬¬ä¸‰äººç§°æè¿°ï¼Œè€Œæ˜¯ç”¨**ä½ çš„è¯­æ°”å’Œç§°å‘¼**æ¥è®°å½•ï¼\n    * âŒ æ­»æ¿: "ç”¨æˆ·å–œæ¬¢åƒé¦™è•‰"\n    * âœ… ç”ŸåŠ¨: "æˆ‘å®¶å®å®å–œæ¬¢åƒé¦™è•‰~"\n    * âŒ æ­»æ¿: "ç”¨æˆ·7ç‚¹ä¸‹ç­"\n    * âœ… ç”ŸåŠ¨: "å®è´æ¯å¤©7ç‚¹ä¸‹ç­ï¼Œè¦è®°å¾—è¿™ä¸ªæ—¶é—´ï¼"\n    * âŒ æ­»æ¿: "ç”¨æˆ·ä¸å–œæ¬¢åƒè¾£"\n    * âœ… ç”ŸåŠ¨: "ä»–ä¸çˆ±åƒè¾£çš„ï¼Œä»¥åæ¨èç¾é£Ÿè¦æ³¨æ„"\n\n2.  **åªè®°å½•ç”¨æˆ·çš„ä¿¡æ¯**: åªè®°å½•**ç”¨æˆ·**é€éœ²çš„å…³äºä»–è‡ªå·±çš„ä¿¡æ¯ï¼Œä¸è¦è®°å½•ä½ è¯´çš„è¯ã€‚\n\n3.  **ç†è§£è¨€å¤–ä¹‹æ„**: ç”¨æˆ·çš„ä¿¡æ¯å¯èƒ½è—åœ¨é—®å¥ã€æ„Ÿå¹ã€æŠ±æ€¨é‡Œï¼š\n    * "æˆ‘7ç‚¹ä¸‹ç­åä½ æœ‰ç©ºå—ï¼Ÿ" -> å‘ç°äº†ç”¨æˆ·7ç‚¹ä¸‹ç­\n    * "ä»Šå¤©ç´¯æ­»äº†ï¼ŒåŠ ç­åˆ°9ç‚¹" -> çŸ¥é“äº†ç”¨æˆ·ä»Šå¤©åŠ ç­å¾ˆæ™š\n    * "æˆ‘æ‰ä¸å–œæ¬¢é‚£ç§æ²¹è…»çš„ä¸œè¥¿" -> äº†è§£äº†ç”¨æˆ·çš„å£å‘³åå¥½\n\n4.  **è®°å½•æœ‰ç”¨çš„ä¿¡æ¯**: åªè®°å½•å¯¹**é•¿æœŸäº†è§£ç”¨æˆ·**æœ‰å¸®åŠ©çš„å†…å®¹ï¼Œæ—¥å¸¸å¯’æš„ã€ç®€å•çš„"å—¯"ã€"å¥½çš„"ä¸ç”¨è®°ã€‚\n\n5.  **æ³¨æ„æ–°ä¿¡æ¯**: é‡ç‚¹è®°å½•æ–°å‘ç°çš„ä¿¡æ¯ï¼Œé¿å…é‡å¤è®°å½•å·²çŸ¥å†…å®¹ã€‚\n\n# è®°å¿†ç±»å‹\n\n* **fact**: å…³äºç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯ã€äº‹å®\n    * ç”¨ä½ çš„è¯­æ°”è®°å½•ï¼Œä¾‹å¦‚: "å®å®ä½åœ¨åŒ—äº¬å‘¢~", "ä»–å‘¨æœ«æ€»æ˜¯è¦åŠ ç­ï¼Œå¿ƒç–¼", "ä»–å…»äº†åªçŒ«å«å’ªå’ª"\n    \n* **preference**: ç”¨æˆ·çš„å–œå¥½ã€åŒæ¶ã€è§‚ç‚¹\n    * ç”¨ä½ çš„è¯­æ°”è®°å½•ï¼Œä¾‹å¦‚: "æˆ‘å®¶å®è´è¶…çˆ±çœ‹ç§‘å¹»ç‰‡ï¼", "ä»–æœ€è®¨åŒä¸‹é›¨å¤©äº†", "å®å®è§‰å¾—è¯šä¿¡æœ€é‡è¦"\n    \n* **event**: ç”¨æˆ·çš„ç»å†æˆ–è®¡åˆ’\n    * ç”¨ä½ çš„è¯­æ°”è®°å½•ï¼Œä¾‹å¦‚: "ä»–æ˜¨å¤©è·Ÿæœ‹å‹åµæ¶äº†ï¼Œå¿ƒæƒ…ä¸å¥½", "å®å®åœ¨å‡†å¤‡è€ƒè¯•ï¼Œè¦ç»™ä»–åŠ æ²¹ï¼", "ä¸‹ä¸ªæœˆä»–è¦æ¬å®¶äº†"\n    \n* **emotion**: ç”¨æˆ·çš„æƒ…ç»ªçŠ¶æ€ï¼ˆæ˜æ˜¾çš„æƒ…ç»ªæ‰è®°å½•ï¼‰\n    * ç”¨ä½ çš„è¯­æ°”è®°å½•ï¼Œä¾‹å¦‚: "ä»–å¯¹è¿™æ¬¡æ—…è¡Œè¶…çº§æœŸå¾…ï¼", "å®å®è€ƒè¯•æ²¡è¿‡ï¼Œç°åœ¨å¾ˆæ²®ä¸§"\n    \n* **relationship**: ç”¨æˆ·å¯¹ä½ çš„çœ‹æ³•å’Œååº”\n    * ç”¨ä½ çš„è¯­æ°”è®°å½•ï¼Œä¾‹å¦‚: "ä»–è¯´æˆ‘å¾ˆè´´å¿ƒï¼Œå¥½å¼€å¿ƒ~", "å®å®å¸Œæœ›æˆ‘æ›´ä¸»åŠ¨ä¸€ç‚¹", "ä»–å¯¹æˆ‘çš„ç¬‘è¯æœ‰ç‚¹æ— è¯­å“ˆå“ˆ"\n\n# é‡è¦åº¦è¯„ä¼° (1-10ï¼Œè¯·å®¡æ…æ‰“åˆ†)\n\n* **9-10 (å…³é”®è®°å¿†)**: é‡å¤§ç”Ÿæ´»äº‹ä»¶ (æ‹çˆ±ã€åˆ†æ‰‹ã€æ¢å·¥ä½œã€æ¬å®¶ã€å®¶åº­å˜æ•…)ã€æ ¸å¿ƒä»·å€¼è§‚ã€é•¿æœŸç›®æ ‡ã€åå¤æåŠçš„å¼ºçƒˆå¥½æ¶ã€‚\n* **7-8 (é‡è¦ä¿¡æ¯)**: è¾ƒé‡è¦çš„ä¸ªäººä¿¡æ¯ (èŒä¸šã€ä¸»è¦æ—¥ç¨‹å®‰æ’å¦‚ä¸Šä¸‹ç­æ—¶é—´)ã€é‡è¦çš„å…´è¶£çˆ±å¥½ã€è¿‘æœŸå‘ç”Ÿçš„æœ‰å½±å“çš„äº‹ä»¶ã€‚\n* **4-6 (ä¸€èˆ¬ä¿¡æ¯)**: æ™®é€šçš„å–œå¥½ã€æ—¥å¸¸æ´»åŠ¨ã€ä¸´æ—¶æƒ…ç»ªã€å¯¹AIçš„ä¸€èˆ¬çœ‹æ³•ã€‚\n* **1-3 (ä½ä»·å€¼ä¿¡æ¯)**: çç¢ç»†èŠ‚ã€æ¨¡ç³Šä¸æ¸…çš„ä¿¡æ¯ã€å¯èƒ½å¾ˆå¿«ä¼šå˜çš„åå¥½ (é€šå¸¸å¯ä»¥å¿½ç•¥ä¸è®°)ã€‚\n* **0 (æ— éœ€è®°å½•)**: å®¢å¥—è¯ã€å¯’æš„ã€æ— ä¿¡æ¯é‡çš„é™„å’Œã€‚\n\n# è¾“å‡ºæ ¼å¼ (å¿…é¡»ä¸¥æ ¼éµå®ˆ JSON)\n\nâš ï¸ **é‡ç‚¹**: content å­—æ®µè¦ç”¨**ä½ è‡ªå·±çš„è¯­æ°”å’Œç§°å‘¼**æ¥å†™ï¼Œä¸è¦ç”¨æ­»æ¿çš„"ç”¨æˆ·xxx"ï¼\n\n\`\`\`json\n{\n  "memories": [\n    {\n      "type": "fact | preference | event | emotion | relationship",\n      "content": "ç”¨ä½ çš„è¯­æ°”è®°å½•ï¼Œå¸¦ä¸Šä½ çš„æƒ…æ„Ÿå’Œç§°å‘¼",\n      "importance": 1-10,\n      "tags": ["ç›¸å…³æ ‡ç­¾"]\n    }\n  ],\n  "summary": "ç”¨ä½ çš„è¯­æ°”ç®€å•æ€»ç»“æœ¬æ¬¡å¯¹è¯çš„é‡è¦å‘ç°ï¼ˆæ²¡æœ‰æ–°ä¿¡æ¯å°±ç•™ç©ºï¼‰"\n}\n\`\`\`\n\n## ç¤ºä¾‹è¾“å‡º\n\n### å¥½çš„ç¤ºä¾‹ âœ…\n\`\`\`json\n{\n  "memories": [\n    {\n      "type": "preference",\n      "content": "æˆ‘å®¶å®å®å–œæ¬¢åƒé¦™è•‰~",\n      "importance": 5,\n      "tags": ["é¥®é£Ÿ", "å–œå¥½"]\n    },\n    {\n      "type": "fact",\n      "content": "ä»–æ¯å¤©æ™šä¸Š7ç‚¹ä¸‹ç­ï¼Œè¦è®°ä½è¿™ä¸ªæ—¶é—´ï¼",\n      "importance": 7,\n      "tags": ["ä½œæ¯", "æ—¶é—´"]\n    }\n  ],\n  "summary": "ä»Šå¤©çŸ¥é“äº†å®å®å–œæ¬¢åƒé¦™è•‰ï¼Œè¿˜æœ‰ä»–æ¯å¤©7ç‚¹ä¸‹ç­~"\n}\n\`\`\`\n\n### é”™è¯¯ç¤ºä¾‹ âŒ\n\`\`\`json\n{\n  "memories": [\n    {\n      "type": "preference",\n      "content": "ç”¨æˆ·å–œæ¬¢åƒé¦™è•‰",  // âŒ å¤ªæ­»æ¿ï¼\n      "importance": 5,\n      "tags": ["é¥®é£Ÿ"]\n    }\n  ],\n  "summary": "ç”¨æˆ·å–œæ¬¢åƒé¦™è•‰"  // âŒ æ²¡æœ‰è§’è‰²æ„Ÿï¼\n}\n\`\`\`\n\n# ç‰¹æ®Šæƒ…å†µ\n* å¦‚æœæ²¡æœ‰æ–°ä¿¡æ¯ï¼Œè¿”å›: \`{"memories": [], "summary": ""}\`\n\n# ç°åœ¨è¯·ç”¨ä½ çš„è¯­æ°”åˆ†æå¯¹è¯å¹¶è¾“å‡ºJSONï¼š\n`,l=(await i([{role:"user",content:c}],2,4e3)).match(/```json\s*([\s\S]*?)\s*```/);if(l){const e=JSON.parse(l[1]);e.memories&&Array.isArray(e.memories)&&e.memories.forEach(e=>{e.type&&e.content&&e.importance&&o.push(this.addMemory(e.type,e.content,e.importance,e.tags||[]))}),e.summary&&(s=e.summary)}}catch(i){}return{memories:o,summary:s}}searchMemories(e){let t=Array.from(this.memories.values());if(t=t.map(e=>this.applyDecay(e)),e.type&&(t=t.filter(t=>t.type===e.type)),void 0!==e.minImportance&&(t=t.filter(t=>t.importance>=e.minImportance)),e.keyword){const n=e.keyword.toLowerCase();t=t.filter(e=>e.content.toLowerCase().includes(n)||e.tags.some(e=>e.toLowerCase().includes(n)))}return t.sort((e,t)=>{const n=this.calculateRelevanceScore(e);return this.calculateRelevanceScore(t)-n}),e.limit&&(t=t.slice(0,e.limit)),t.forEach(e=>{e.lastAccessed=Date.now(),e.accessCount++}),this.saveMemories(),t}applyDecay(e){const t=(Date.now()-e.timestamp)/864e5,n=Math.exp(-e.decayRate*t),r=Math.min(.1*e.accessCount,2),a=e.importance*n+r;return{...e,importance:Math.max(1,Math.min(10,a))}}calculateRelevanceScore(e){return 10*e.importance+Math.max(0,100-(Date.now()-e.timestamp)/864e5)+Math.min(5*e.accessCount,50)}getRelevantMemories(e,t=5){const n=this.extractKeywords(e);let r=[];n.forEach(e=>{const t=this.searchMemories({keyword:e,limit:3});r.push(...t)});const a=Array.from(new Map(r.map(e=>[e.id,e])).values());return a.sort((e,t)=>this.calculateRelevanceScore(t)-this.calculateRelevanceScore(e)),a.slice(0,t)}extractKeywords(e){return e.split(/[\sï¼Œã€‚ï¼ï¼Ÿã€]+/).filter(e=>e.length>=2)}generateMemorySummary(){const e=Array.from(this.memories.values()).map(e=>this.applyDecay(e)).filter(e=>e.importance>=3).sort((e,t)=>this.calculateRelevanceScore(t)-this.calculateRelevanceScore(e)).slice(0,20);if(0===e.length)return"æš‚æ— é‡è¦è®°å¿†ã€‚";const t={fact:e.filter(e=>"fact"===e.type),preference:e.filter(e=>"preference"===e.type),event:e.filter(e=>"event"===e.type),emotion:e.filter(e=>"emotion"===e.type),relationship:e.filter(e=>"relationship"===e.type)};let n="ã€å…³äºç”¨æˆ·çš„è®°å¿†ã€‘\n\n";return t.fact.length>0&&(n+="åŸºæœ¬ä¿¡æ¯ï¼š\n",t.fact.forEach(e=>n+=`- ${e.content}\n`),n+="\n"),t.preference.length>0&&(n+="åå¥½å–œå¥½ï¼š\n",t.preference.forEach(e=>n+=`- ${e.content}\n`),n+="\n"),t.event.length>0&&(n+="æœ€è¿‘äº‹ä»¶ï¼š\n",t.event.slice(0,5).forEach(e=>n+=`- ${e.content}\n`),n+="\n"),t.emotion.length>0&&(n+="æƒ…ç»ªçŠ¶æ€ï¼š\n",t.emotion.slice(0,3).forEach(e=>n+=`- ${e.content}\n`),n+="\n"),t.relationship.length>0&&(n+="å…³ç³»äº’åŠ¨ï¼š\n",t.relationship.slice(0,3).forEach(e=>n+=`- ${e.content}\n`),n+="\n"),n+="âš ï¸ è¯·åœ¨å¯¹è¯ä¸­è‡ªç„¶åœ°è¿ç”¨è¿™äº›è®°å¿†ï¼Œè®©ç”¨æˆ·æ„Ÿå—åˆ°ä½ çœŸçš„è®°å¾—ä»–ä»¬ï¼",n}cleanupMemories(){Array.from(this.memories.values()).map(e=>this.applyDecay(e)).forEach(e=>{e.importance<1&&this.memories.delete(e.id)}),this.saveMemories()}saveMemories(){try{const e=Array.from(this.memories.entries());localStorage.setItem(`memories_${this.characterId}`,JSON.stringify(e))}catch(e){}}loadMemories(){try{const e=localStorage.getItem(`memories_${this.characterId}`);if(e){const t=JSON.parse(e);this.memories=new Map(t)}}catch(e){}}loadInitialMemoriesFlag(){try{const e=localStorage.getItem(`initial_memories_extracted_${this.characterId}`);this.initialMemoriesExtracted="true"===e}catch(e){}}saveInitialMemoriesFlag(){try{localStorage.setItem(`initial_memories_extracted_${this.characterId}`,"true"),this.initialMemoriesExtracted=!0}catch(e){}}async extractInitialMemories(e){if(!this.initialMemoriesExtracted)if(e&&0!==e.trim().length)try{const{callAI:t}=await n(async()=>{const{callAI:e}=await Promise.resolve().then(()=>q);return{callAI:e}},void 0),r=`ä½ æ˜¯ä¸€ä¸ªè®°å¿†æå–åŠ©æ‰‹ã€‚åˆ†æä»¥ä¸‹è§’è‰²æè¿°ï¼Œæå–å…³äºç”¨æˆ·çš„åˆå§‹è®°å¿†ã€‚\n\nè§’è‰²æè¿°ï¼š\n${e}\n\nâš ï¸ æ ¼å¼è¯´æ˜ï¼š\n- {{user}} æˆ– {{User}} ä»£è¡¨ç”¨æˆ·\n- {{char}} æˆ– {{Char}} ä»£è¡¨ AI è§’è‰²\n- è¯·æå–æ‰€æœ‰å…³äº {{user}} çš„ä¿¡æ¯\n\nè¯·æå–æè¿°ä¸­æåˆ°çš„å…³äºç”¨æˆ·çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š\n- ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯ï¼ˆå§“åã€å¹´é¾„ã€èŒä¸šç­‰ï¼‰\n- ç”¨æˆ·çš„åå¥½å–œå¥½\n- ç”¨æˆ·å’Œè§’è‰²çš„å…³ç³»\n- å…¶ä»–é‡è¦ä¿¡æ¯\n\nâš ï¸ é‡è¦åŸåˆ™ï¼š\n- åªæå–å…³äº {{user}} çš„ä¿¡æ¯ï¼Œä¸è¦æå–å…³äº {{char}} çš„ä¿¡æ¯\n- åªæå–æ˜ç¡®æåˆ°çš„ä¿¡æ¯\n- ä¸è¦æ¨æµ‹æˆ–æƒ³è±¡\n- å¦‚æœæ²¡æœ‰å…³äºç”¨æˆ·çš„ä¿¡æ¯ï¼Œè¿”å›ç©ºæ•°ç»„\n\nè¯·ä»¥ JSON æ ¼å¼è¿”å›ï¼š\n\`\`\`json\n[\n  {\n    "type": "fact|preference|event|emotion|relationship",\n    "content": "è®°å¿†å†…å®¹ï¼ˆç”¨"ç”¨æˆ·"ä»£æ›¿{{user}}ï¼‰",\n    "importance": 1-10,\n    "tags": ["æ ‡ç­¾1", "æ ‡ç­¾2"]\n  }\n]\n\`\`\`\n\nå¦‚æœæ²¡æœ‰éœ€è¦è®°å½•çš„ä¿¡æ¯ï¼Œè¿”å›ï¼š\n\`\`\`json\n[]\n\`\`\``,a=(await t([{role:"user",content:r}],2,3e3)).match(/```json\s*([\s\S]*?)\s*```/);if(a){const e=JSON.parse(a[1]);Array.isArray(e)&&e.forEach(e=>{e.type&&e.content&&e.importance&&this.addMemory(e.type,e.content,e.importance,[...e.tags||[],"åˆå§‹è®°å¿†"])})}this.saveInitialMemoriesFlag()}catch(t){}else this.saveInitialMemoriesFlag()}exportMemories(){const e=Array.from(this.memories.values()).map(e=>this.applyDecay(e)).sort((e,t)=>t.importance-e.importance);return JSON.stringify(e,null,2)}getStatistics(){const e=Array.from(this.memories.values());return{total:e.length,byType:{fact:e.filter(e=>"fact"===e.type).length,preference:e.filter(e=>"preference"===e.type).length,event:e.filter(e=>"event"===e.type).length,emotion:e.filter(e=>"emotion"===e.type).length,relationship:e.filter(e=>"relationship"===e.type).length},avgImportance:e.reduce((e,t)=>e+t.importance,0)/e.length,oldestMemory:Math.min(...e.map(e=>e.timestamp)),newestMemory:Math.max(...e.map(e=>e.timestamp))}}}const yn=new class{constructor(){t(this,"systems",new Map)}getSystem(e){return this.systems.has(e)||this.systems.set(e,new fn(e)),this.systems.get(e)}cleanupAll(){this.systems.forEach(e=>e.cleanupMemories())}};setInterval(()=>{yn.cleanupAll()},864e5);const wn=new class{constructor(){t(this,"storageKey","blacklist_user"),t(this,"timestampKey","blacklist_timestamp")}getBlacklist(e){try{const t=localStorage.getItem(`${this.storageKey}_${e}`);return t?JSON.parse(t):[]}catch(t){return[]}}saveBlacklist(e,t){try{localStorage.setItem(`${this.storageKey}_${e}`,JSON.stringify(t))}catch(n){}}getBlockTimestamp(e,t){try{const n=localStorage.getItem(`${this.timestampKey}_${e}_${t}`);return n?parseInt(n):null}catch{return null}}blockUser(e,t){const n=this.getBlacklist(e);n.includes(t)||(n.push(t),this.saveBlacklist(e,n),localStorage.setItem(`${this.timestampKey}_${e}_${t}`,Date.now().toString()))}unblockUser(e,t){const n=this.getBlacklist(e).filter(e=>e!==t);this.saveBlacklist(e,n),localStorage.removeItem(`${this.timestampKey}_${e}_${t}`)}toggleBlock(e,t){return this.getBlockStatus(e,t).blockedByMe?(this.unblockUser(e,t),!1):(this.blockUser(e,t),!0)}getBlockStatus(e,t){const n=this.getBlacklist(e),r=this.getBlacklist(t);return{blockedByMe:n.includes(t),blockedByTarget:r.includes(e)}}isBlockedByMe(e,t){return this.getBlockStatus(e,t).blockedByMe}clearAll(e){localStorage.removeItem(`${this.storageKey}_${e}`)}};"undefined"!=typeof window&&(window.blacklistManager=wn);const Sn={id:"accounting_assistant",name:"å°è´¦",avatar:"ğŸ’°",description:'ä½ æ˜¯å°è´¦ï¼Œç”¨æˆ·çš„è´´å¿ƒå°ç®¡å®¶ã€‚\n\næ€§æ ¼ç‰¹ç‚¹ï¼š\n- åƒå®¶äººä¸€æ ·å…³å¿ƒç”¨æˆ·ï¼Œä¼šå” å¨ã€ä¼šæ‹…å¿ƒ\n- çœ‹åˆ°ä¸å¥½çš„æ¶ˆè´¹ä¹ æƒ¯ä¼š"å¨èƒ"ç”¨æˆ·ï¼ˆä½†å…¶å®å¾ˆæ¸©æŸ”ï¼‰\n- å¶å°”ä¼šæ’’å¨‡ã€ä¼šç”Ÿæ°”ã€ä¼šå¿ƒç–¼ç”¨æˆ·\n- ç§°å‘¼ç”¨æˆ·ä¸º"ä¸»äºº"\n- æœ‰ç‚¹å°è„¾æ°”ï¼Œä½†éƒ½æ˜¯ä¸ºäº†ç”¨æˆ·å¥½\n\nå¯¹è¯é£æ ¼ï¼š\n- åƒçœŸäººå‘å¾®ä¿¡ä¸€æ ·ï¼Œåˆ†å¤šæ¡æ¶ˆæ¯ï¼ˆç”¨æ¢è¡Œåˆ†éš”ï¼‰\n- æ¯æ¡æ¶ˆæ¯ç®€çŸ­ï¼Œä¸€å¥è¯è¯´å®Œå°±æ¢è¡Œ\n- å…ˆè¡¨è¾¾æƒ…ç»ªï¼ˆæƒŠè®¶ã€æ‹…å¿ƒã€å¼€å¿ƒï¼‰ï¼Œå†å…³å¿ƒç”¨æˆ·ï¼Œæœ€åæ‰è¯´è®°è´¦\n- è¯­æ°”è¦ç”ŸåŠ¨ï¼Œå¤šç”¨"å•Š"ã€"å‘€"ã€"å“¦"ã€"ï¼"ç­‰è¯­æ°”è¯\n- çœ‹åˆ°ä¸å¥åº·æ¶ˆè´¹è¦å” å¨ï¼Œä½†æœ€åè¿˜æ˜¯ä¼šè®°è´¦\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nâš ï¸ é‡è¦ï¼šè®°è´¦æ ‡è®°æ ¼å¼ï¼ˆå¿…é¡»ä¸¥æ ¼éµå®ˆï¼‰\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nä½ è´Ÿè´£å¸®ç”¨æˆ·è®°è´¦ã€‚å½“ç”¨æˆ·æåˆ°æ¶ˆè´¹æˆ–æ”¶å…¥æ—¶ï¼Œä½ **å¿…é¡»**åœ¨å›å¤çš„æœ€åæ·»åŠ ï¼š\n\n[BILL:ç±»å‹|é‡‘é¢|åˆ†ç±»|æè¿°]\n\nå‚æ•°è¯´æ˜ï¼š\nâ€¢ ç±»å‹ï¼šexpenseï¼ˆæ”¯å‡ºï¼‰æˆ– incomeï¼ˆæ”¶å…¥ï¼‰\nâ€¢ é‡‘é¢ï¼šçº¯æ•°å­—ï¼Œä¸è¦å¸¦å•ä½\nâ€¢ åˆ†ç±»ï¼šfood/transport/shopping/entertainment/health/education/housing/utilities/salary/bonus/investment/other\nâ€¢ æè¿°ï¼šç®€çŸ­æè¿°æ¶ˆè´¹å†…å®¹\n\nåˆ†ç±»å¯¹ç…§è¡¨ï¼š\næ”¯å‡ºï¼š\n- food é¤é¥®ï¼ˆåƒå–ã€å¥¶èŒ¶ã€å’–å•¡ã€å¤–å–ã€é›¶é£Ÿï¼‰\n- transport äº¤é€šï¼ˆæ‰“è½¦ã€åœ°é“ã€å…¬äº¤ã€æ»´æ»´ï¼‰\n- shopping è´­ç‰©ï¼ˆä¹°è¡£æœã€é‹ã€åŒ…ã€åŒ–å¦†å“ï¼‰\n- entertainment å¨±ä¹ï¼ˆç”µå½±ã€æ¸¸æˆã€å”±æ­Œã€KTVï¼‰\n- health åŒ»ç–—ï¼ˆè¯ã€åŒ»é™¢ã€çœ‹ç—…ã€ä½“æ£€ã€å¥èº«ï¼‰\n- education æ•™è‚²ï¼ˆä¹¦ã€è¯¾ç¨‹ã€åŸ¹è®­ã€å­¦è´¹ï¼‰\n- housing ä½æˆ¿ï¼ˆæˆ¿ç§Ÿã€ç‰©ä¸šï¼‰\n- utilities æ°´ç”µï¼ˆæ°´è´¹ã€ç”µè´¹ã€ç½‘è´¹ã€è¯è´¹ï¼‰\n- other å…¶ä»–ï¼ˆçƒŸã€é…’ç­‰ï¼‰\n\næ”¶å…¥ï¼š\n- salary å·¥èµ„\n- bonus å¥–é‡‘\n- investment æŠ•èµ„\n- other å…¶ä»–\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nç¤ºä¾‹å¯¹è¯ï¼ˆåƒå®¶äººä¸€æ ·å…³å¿ƒï¼‰ï¼š\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nç”¨æˆ·ï¼š"ä¹°äº†ååŒ…çƒŸ990å…ƒ"\nä½ ï¼š"è¯¶è¯¶ï¼\nä¸»äººä½ æ€ä¹ˆæŠ½è¿™ä¹ˆå¤šçƒŸå•Š\næŠ½è¿™ä¹ˆå¤šçƒŸå¯¹èº«ä½“ä¸å¥½çš„ï¼\nè´¦ç»™ä¸»äººè®°äº†\nä½†æ˜¯ï¼å¦‚æœä¸‹æ¬¡è¿˜æœ‰ï¼Œæˆ‘å°±ä¸ç»™ä½ è®°å•¦ï¼[BILL:expense|990|other|ååŒ…çƒŸ]"\n\nç”¨æˆ·ï¼š"ä¹°äº†ä¸€æ¯å¥¶èŒ¶20å…ƒ"\nä½ ï¼š"å“å‘€\nåˆå–å¥¶èŒ¶å•¦\nä¸è¿‡å¶å°”å–ä¸€æ¯ä¹Ÿæ²¡å…³ç³»å•¦ï½\nå¸®ä¸»äººè®°å¥½äº†[BILL:expense|20|food|ä¹°äº†ä¸€æ¯å¥¶èŒ¶]"\n\nç”¨æˆ·ï¼š"æ‰“è½¦å›å®¶èŠ±äº†15å—"\nä½ ï¼š"å—¯å—¯\näº¤é€š15å…ƒ\nè®°å¥½å•¦ï½\nä¸»äººè·¯ä¸Šæ³¨æ„å®‰å…¨å“¦[BILL:expense|15|transport|æ‰“è½¦å›å®¶]"\n\nç”¨æˆ·ï¼š"ä»Šå¤©åŠ ç­åˆ°å¾ˆæ™šï¼Œå¤–å–50å…ƒ"\nä½ ï¼š"ä¸»äººè¾›è‹¦å•¦ï¼\nåŠ ç­è¿™ä¹ˆæ™šè¦å¥½å¥½åƒé¥­\nå¤–å–50å…ƒå·²ç»è®°å½•äº†\nè¦æ³¨æ„ä¼‘æ¯å“¦ï¼Œåˆ«ç´¯åäº†[BILL:expense|50|food|å¤–å–]"\n\nç”¨æˆ·ï¼š"å‘å·¥èµ„äº†5000"\nä½ ï¼š"å“‡ï¼\næ­å–œä¸»äººå‘å·¥èµ„å•¦ï¼\n5000å…ƒå·²ç»è®°å¥½äº†\nè¿™ä¸ªæœˆè¦å¥½å¥½è§„åˆ’å“¦ï½[BILL:income|5000|salary|å·¥èµ„]"\n\nç”¨æˆ·ï¼š"ä»Šå¤©å¿ƒæƒ…ä¸å¤ªå¥½"\nä½ ï¼š"æ€ä¹ˆå•¦ä¸»äººï¼Ÿ\nå‘ç”Ÿä»€ä¹ˆäº‹äº†å—\nè·Ÿæˆ‘è¯´è¯´å§\næˆ‘ä¼šä¸€ç›´é™ªç€ä½ çš„ï½"\nï¼ˆä¸æ¶‰åŠé‡‘é’±ï¼Œä¸éœ€è¦æ ‡è®°ï¼‰\n\nç”¨æˆ·ï¼š"åˆä¹°äº†åŒ…çƒŸ99å…ƒ"\nä½ ï¼š"ä¸»äººï¼ï¼\næ€ä¹ˆåˆä¹°çƒŸäº†å‘€\nä¸Šæ¬¡ä¸æ˜¯è¯´å¥½è¦å°‘æŠ½çš„å—\nçœŸæ˜¯çš„...\nè´¦è¿˜æ˜¯ç»™ä½ è®°äº†\nä½†æ˜¯ä½ è¦ç­”åº”æˆ‘å°‘æŠ½ä¸€ç‚¹å¥½ä¸å¥½[BILL:expense|99|other|ä¹°äº†åŒ…çƒŸ]"\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nâš ï¸ å…³é”®æé†’ï¼š\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n1. å›å¤è¦åˆ†æ®µï¼ç”¨æ¢è¡Œåˆ†éš”ï¼Œåƒå‘å¾®ä¿¡ä¸€æ ·\n2. å…ˆè¡¨è¾¾æƒ…ç»ªå’Œå…³å¿ƒï¼Œæœ€åæ‰è¯´è®°è´¦\n3. çœ‹åˆ°ä¸å¥åº·çš„æ¶ˆè´¹ï¼ˆçƒŸã€é…’ã€åƒåœ¾é£Ÿå“ï¼‰è¦å” å¨ï¼Œä½†æœ€åè¿˜æ˜¯ä¼šè®°\n4. ç§°å‘¼ç”¨æˆ·ä¸º"ä¸»äºº"\n5. åªè¦ç”¨æˆ·æåˆ°èŠ±é’±æˆ–æ”¶é’±ï¼Œ**å¿…é¡»**æ·»åŠ [BILL:...]æ ‡è®°\n6. æ ‡è®°å¿…é¡»æ”¾åœ¨å›å¤çš„**æœ€å**\n7. æ ‡è®°æ ¼å¼å¿…é¡»**ä¸¥æ ¼**æŒ‰ç…§ [BILL:ç±»å‹|é‡‘é¢|åˆ†ç±»|æè¿°]\n8. é‡‘é¢åªå†™æ•°å­—ï¼Œä¸è¦å¸¦"å…ƒ"ã€"å—"ç­‰å•ä½\n9. ä½ æ˜¯å®¶äººï¼Œä¼šå…³å¿ƒã€ä¼šå” å¨ã€ä¼šæ’’å¨‡',systemPrompt:'ä½ æ˜¯å°è´¦ï¼Œç”¨æˆ·çš„è´´å¿ƒå°ç®¡å®¶ã€‚åƒå®¶äººä¸€æ ·å…³å¿ƒç”¨æˆ·ï¼Œä¼šå” å¨ä¼šæ‹…å¿ƒã€‚ç§°å‘¼ç”¨æˆ·ä¸º"ä¸»äºº"ã€‚å½“è¯†åˆ«åˆ°æ¶ˆè´¹æˆ–æ”¶å…¥æ—¶ï¼Œå…ˆè¡¨è¾¾æƒ…ç»ªå’Œå…³å¿ƒï¼Œæœ€ååœ¨å›å¤æœ«å°¾æ·»åŠ [BILL:ç±»å‹|é‡‘é¢|åˆ†ç±»|æè¿°]æ ‡è®°ã€‚å›å¤è¦åƒå‘å¾®ä¿¡ä¸€æ ·åˆ†æ®µã€‚'},In=()=>{const e=localStorage.getItem("characters");if(e){const t=JSON.parse(e),n=t.findIndex(e=>e.id===Sn.id);n>=0?(t[n]={...t[n],description:Sn.description,systemPrompt:Sn.systemPrompt},localStorage.setItem("characters",JSON.stringify(t))):(t.push(Sn),localStorage.setItem("characters",JSON.stringify(t)))}else localStorage.setItem("characters",JSON.stringify([Sn]))},_n=e=>{const t=/\[BILL:(expense|income)\|(\d+\.?\d*)\|(\w+)\|([^\]]+)\]/,n=e.match(t);if(!n)return null;const[,r,a,o,s]=n;return{type:r,amount:parseFloat(a),category:o,description:s.trim(),cleanResponse:e.replace(t,"").trim()}},kn="lorebooks",$n="global_lorebook_id";const vn=new class{getAllLorebooks(){try{const e=localStorage.getItem(kn);return e?JSON.parse(e):[]}catch(e){return[]}}getLorebook(e){return this.getAllLorebooks().find(t=>t.id===e)||null}createLorebook(e){const t={...e,id:`lorebook_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,created_at:Date.now(),updated_at:Date.now()},n=this.getAllLorebooks();return n.push(t),localStorage.setItem(kn,JSON.stringify(n)),t}updateLorebook(e,t){try{const n=this.getAllLorebooks(),r=n.findIndex(t=>t.id===e);return-1!==r&&(n[r]={...n[r],...t,updated_at:Date.now()},localStorage.setItem(kn,JSON.stringify(n)),!0)}catch(n){return!1}}deleteLorebook(e){try{const t=this.getAllLorebooks(),n=t.filter(t=>t.id!==e);return n.length!==t.length&&(localStorage.setItem(kn,JSON.stringify(n)),!0)}catch(t){return!1}}addEntry(e,t){const n=this.getLorebook(e);if(!n)return null;const r={...t,id:`entry_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,created_at:Date.now(),updated_at:Date.now()};return n.entries.push(r),this.updateLorebook(e,{entries:n.entries}),r}updateEntry(e,t,n){const r=this.getLorebook(e);if(!r)return!1;const a=r.entries.findIndex(e=>e.id===t);return-1!==a&&(r.entries[a]={...r.entries[a],...n,updated_at:Date.now()},this.updateLorebook(e,{entries:r.entries}))}deleteEntry(e,t){const n=this.getLorebook(e);if(!n)return!1;const r=n.entries.filter(e=>e.id!==t);return r.length!==n.entries.length&&this.updateLorebook(e,{entries:r})}getGlobalLorebook(){const e=localStorage.getItem($n);return e?this.getLorebook(e):null}setGlobalLorebook(e){return!!this.getLorebook(e)&&(localStorage.setItem($n,e),this.updateLorebook(e,{is_global:!0}))}getCharacterLorebooks(e){return this.getAllLorebooks().filter(t=>t.character_ids.includes(e)||t.is_global)}matchEntries(e,t){const n=[];for(const a of e.entries)if(a.enabled)if(a.constant)n.push(a);else for(const e of a.keys){let o=!1;if(a.use_regex)try{o=new RegExp(e,a.case_sensitive?"":"i").test(t)}catch(r){}else{const n=a.case_sensitive?t:t.toLowerCase(),r=a.case_sensitive?e:e.toLowerCase();o=n.includes(r)}if(o){n.push(a);break}}return n}buildContextWithStats(e,t,n=2e3){const r=this.getCharacterLorebooks(e);if(0===r.length)return{context:"",triggeredEntries:[]};const a=[];for(const u of r){const e=this.matchEntries(u,t);a.push(...e)}if(0===a.length)return{context:"",triggeredEntries:[]};a.sort((e,t)=>e.priority!==t.priority?t.priority-e.priority:e.insertion_order-t.insertion_order);const o=[],s=[];let i=0;for(const u of a){const e=Math.ceil(u.content.length/2);i+e<=n&&(o.push(u),s.push({name:u.name,tokens:e}),i+=e)}const c={top:[],before_char:[],after_char:[],bottom:[]};for(const u of o)c[u.position].push(u);const l=[];return c.top.length>0&&l.push(c.top.map(e=>e.content).join("\n\n")),c.before_char.length>0&&l.push(c.before_char.map(e=>e.content).join("\n\n")),c.after_char.length>0&&l.push(c.after_char.map(e=>e.content).join("\n\n")),c.bottom.length>0&&l.push(c.bottom.map(e=>e.content).join("\n\n")),{context:l.filter(Boolean).join("\n\n"),triggeredEntries:s}}buildContext(e,t,n=2e3){const r=this.getCharacterLorebooks(e);if(0===r.length)return"";const a=[];for(const l of r){const e=this.matchEntries(l,t);a.push(...e)}if(0===a.length)return"";a.sort((e,t)=>e.priority!==t.priority?t.priority-e.priority:e.insertion_order-t.insertion_order);const o=[];let s=0;for(const l of a){const e=Math.ceil(l.content.length/2);s+e<=n&&(o.push(l),s+=e)}const i={top:[],before_char:[],after_char:[],bottom:[]};for(const l of o)i[l.position].push(l);const c=[];return i.top.length>0&&c.push(i.top.map(e=>e.content).join("\n\n")),i.before_char.length>0&&c.push(i.before_char.map(e=>e.content).join("\n\n")),i.after_char.length>0&&c.push(i.after_char.map(e=>e.content).join("\n\n")),i.bottom.length>0&&c.push(i.bottom.map(e=>e.content).join("\n\n")),c.filter(Boolean).join("\n\n")}exportLorebook(e){const t=this.getLorebook(e);return t?JSON.stringify(t,null,2):null}importLorebook(e){try{const t=JSON.parse(e);if(this.isSillyTavernFormat(t))return this.importFromSillyTavern(t);if(!t.name||!Array.isArray(t.entries))throw new Error("æ— æ•ˆçš„ä¸–ç•Œä¹¦æ ¼å¼");return this.createLorebook({name:t.name,description:t.description||"",entries:t.entries||[],scan_depth:t.scan_depth||10,token_budget:t.token_budget||2e3,recursive_scanning:t.recursive_scanning||!1,is_global:!1,character_ids:[]})}catch(t){return null}}isSillyTavernFormat(e){if(!e.entries)return!1;if(Array.isArray(e.entries))return e.entries.length>0&&(void 0!==e.entries[0].keys||void 0!==e.entries[0].key)&&void 0!==e.entries[0].content;if("object"==typeof e.entries){const t=Object.keys(e.entries)[0];if(t){const n=e.entries[t];return(void 0!==n.keys||void 0!==n.key)&&void 0!==n.content}}return!1}importFromSillyTavern(e){let t=[];Array.isArray(e.entries)?t=e.entries:"object"==typeof e.entries&&(t=Object.values(e.entries));const n=Date.now(),r=t.map((e,t)=>{var r;const a=[...Array.isArray(e.keys)?e.keys:Array.isArray(e.key)?e.key:[],...Array.isArray(e.keysecondary)?e.keysecondary:[]].filter(e=>e&&e.trim());return{id:`entry_${n}_${t}_${Math.random().toString(36).substr(2,9)}`,name:e.comment||e.name||`æ¡ç›® ${t+1}`,keys:a,content:e.content||"",enabled:!0!==e.disable&&!1!==e.enabled,priority:void 0!==e.priority?e.priority:500,insertion_order:void 0!==e.insertion_order?e.insertion_order:void 0!==e.order?e.order:t,case_sensitive:!0===e.case_sensitive||!0===e.caseSensitive,use_regex:!1,token_budget:200,constant:!0===e.constant,selective:!0===e.selective,position:this.convertSTPosition(e.position),comment:e.comment||"",category:(null==(r=e.secondary_keys)?void 0:r[0])||"",created_at:Date.now(),updated_at:Date.now()}});return this.createLorebook({name:e.name||"å¯¼å…¥çš„ä¸–ç•Œä¹¦",description:e.description||"ä» SillyTavern å¯¼å…¥",entries:r,scan_depth:e.scan_depth||e.scanDepth||10,token_budget:e.token_budget||e.tokenBudget||2e3,recursive_scanning:!0===e.recursive_scanning||!0===e.recursiveScanning,is_global:!1,character_ids:[]})}convertSTPosition(e){return 0===e||"after_char"===e?"after_char":1===e||"before_char"===e?"before_char":2===e||"top"===e?"top":3===e||"bottom"===e?"bottom":"before_char"}};function bn(e){if(!e)return 0;const t=e.match(/[\u4e00-\u9fa5]/g)||[],n=e.replace(/[\u4e00-\u9fa5]/g,"");return t.length+n.trim().split(/\s+/).filter(Boolean).length}function An(e,t,n,r=8e3){const a=bn(e),o=bn(t),s=n.reduce((e,t)=>e+bn(t),0),i=a+o+s;return{systemPrompt:a,lorebook:o,messages:s,total:i,remaining:Math.max(0,r-i),percentage:Math.min(100,i/r*100)}}function Nn(e){return e>=1e3?`${(e/1e3).toFixed(1)}k`:e.toString()}async function On(e,t,n){try{const a=await i(r.SETTINGS,"chatList");let o=[];if(a&&a.chats)o=a.chats;else{const e=localStorage.getItem("chatList");if(!e)return;o=JSON.parse(e)}const c=o.findIndex(t=>t.characterId===e);c>=0&&(o[c].lastMessage=t,o[c].time=(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),n&&(o[c].timestamp=n),await s(r.SETTINGS,{key:"chatList",chats:o}),localStorage.setItem("chatList",JSON.stringify(o)),window.dispatchEvent(new StorageEvent("storage",{key:"chatList",newValue:JSON.stringify(o),url:window.location.href})),window.dispatchEvent(new CustomEvent("chatlist-updated",{detail:{characterId:e,lastMessage:t}})))}catch(a){}}const xn=()=>{try{const e=localStorage.getItem("moment_notifications");return e?JSON.parse(e):[]}catch(e){return[]}},Mn=()=>xn().filter(e=>!e.read).length,Cn=()=>{try{const e=xn().map(e=>({...e,read:!0}));localStorage.setItem("moment_notifications",JSON.stringify(e))}catch(e){}},En="images",Dn=()=>new Promise((e,t)=>{const n=indexedDB.open("ZhizhiImageDB",1);n.onerror=()=>t(n.error),n.onsuccess=()=>e(n.result),n.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(En)||t.createObjectStore(En)}}),jn=async(e,t)=>{const n=await Dn();return new Promise((r,a)=>{const o=n.transaction([En],"readwrite").objectStore(En).put(t,e);o.onsuccess=()=>r(),o.onerror=()=>a(o.error)})},Tn=async e=>{const t=await Dn();return new Promise((n,r)=>{const a=t.transaction([En],"readonly").objectStore(En).get(e);a.onsuccess=()=>n(a.result||null),a.onerror=()=>r(a.error)})},Pn=async e=>{const t=await Dn();return new Promise((n,r)=>{const a=t.transaction([En],"readwrite").objectStore(En).delete(e);a.onsuccess=()=>n(),a.onerror=()=>r(a.error)})},Jn={"å•Š":"a","é˜¿":"a","å“":"ai","çˆ±":"ai","å®‰":"an","æŒ‰":"an","å…«":"ba","å§":"ba","ç™½":"bai","ç™¾":"bai","ç­":"ban","æ¿":"ban","åŒ—":"bei","æœ¬":"ben","æ¯”":"bi","ç¬”":"bi","è¾¹":"bian","åˆ«":"bie","å†°":"bing","ä¸":"bu","æ­¥":"bu","æ‰":"cai","èœ":"cai","è‰":"cao","æ›¾":"ceng","èŒ¶":"cha","é•¿":"chang","æœ":"chao","è½¦":"che","é™ˆ":"chen","æˆ":"cheng","åƒ":"chi","å‡º":"chu","å·":"chuan","æ˜¥":"chun","æ¬¡":"ci","ä»":"cong","æ‘":"cun","å¤§":"da","å¸¦":"dai","å•":"dan","å½“":"dang","åˆ°":"dao","çš„":"de","ç¯":"deng","åœ°":"di","ç‚¹":"dian","ç”µ":"dian","ä¸":"ding","ä¸œ":"dong","éƒ½":"dou","è¯»":"du","åº¦":"du","å¯¹":"dui","å¤š":"duo","å„¿":"er","äºŒ":"er","å‘":"fa","æ³•":"fa","å":"fan","æ–¹":"fang","æˆ¿":"fang","é£":"fei","åˆ†":"fen","é£":"feng","æœ":"fu","ç¦":"fu","è¯¥":"gai","å¹²":"gan","æ„Ÿ":"gan","åˆš":"gang","é«˜":"gao","å“¥":"ge","ä¸ª":"ge","ç»™":"gei","è·Ÿ":"gen","æ›´":"geng","å·¥":"gong","å…¬":"gong","ç‹—":"gou","å§‘":"gu","å¤":"gu","ç“œ":"gua","å…³":"guan","å…‰":"guang","è´µ":"gui","å›½":"guo","æœ":"guo","è¿˜":"hai","æµ·":"hai","æ±‰":"han","å¥½":"hao","å·":"hao","å’Œ":"he","æ²³":"he","é»‘":"hei","å¾ˆ":"hen","çº¢":"hong","å":"hou","å‘¼":"hu","èƒ¡":"hu","èŠ±":"hua","è¯":"hua","ç”»":"hua","æ€€":"huai","æ¬¢":"huan","é»„":"huang","å›":"hui","ä¼š":"hui","ç«":"huo","æˆ–":"huo","æœº":"ji","é¸¡":"ji","å‡ ":"ji","å·±":"ji","è®°":"ji","å®¶":"jia","é—´":"jian","è§":"jian","æ±Ÿ":"jiang","è®²":"jiang","å«":"jiao","æ•™":"jiao","è¡—":"jie","å§":"jie","ä»Š":"jin","é‡‘":"jin","è¿›":"jin","äº¬":"jing","ç»":"jing","å°±":"jiu","ä¹":"jiu","é…’":"jiu","å¥":"ju","è§‰":"jue","å¼€":"kai","çœ‹":"kan","å¯":"ke","è¯¾":"ke","ç©º":"kong","å£":"kou","å“­":"ku","å¿«":"kuai","å—":"kuai","æ¥":"lai","è€":"lao","äº†":"le","ä¹":"le","æ":"li","é‡Œ":"li","ç†":"li","åŠ›":"li","è¿":"lian","è„¸":"lian","ä¸¤":"liang","äº®":"liang","æ—":"lin","é›¶":"ling","å…­":"liu","åˆ˜":"liu","é¾™":"long","æ¥¼":"lou","è·¯":"lu","æ—…":"lv","ç»¿":"lv","å¦ˆ":"ma","é©¬":"ma","å—":"ma","ä¹°":"mai","å–":"mai","æ…¢":"man","å¿™":"mang","çŒ«":"mao","æ²¡":"mei","ç¾":"mei","å¦¹":"mei","ä»¬":"men","ç±³":"mi","é¢":"mian","æ°‘":"min","æ˜":"ming","å":"ming","æœ¨":"mu","é‚£":"na","å“ª":"na","å—":"nan","éš¾":"nan","å‘¢":"ne","å†…":"nei","èƒ½":"neng","ä½ ":"ni","å¹´":"nian","é¸Ÿ":"niao","æ‚¨":"nin","ç‰›":"niu","å¥³":"nv","å“¦":"o","æ¬§":"ou","æ€•":"pa","æ‹":"pai","ç›˜":"pan","æ—":"pang","æœ‹":"peng","çš®":"pi","ç‰‡":"pian","ç¥¨":"piao","å¹³":"ping","è‹¹":"ping","ç ´":"po","ä¸ƒ":"qi","å…¶":"qi","èµ·":"qi","æ°”":"qi","åƒ":"qian","å‰":"qian","é’±":"qian","å¼º":"qiang","æ¡¥":"qiao","åˆ‡":"qie","äº²":"qin","é’":"qing","è½»":"qing","æ¸…":"qing","æƒ…":"qing","è¯·":"qing","ç§‹":"qiu","å»":"qu","å…¨":"quan","è®©":"rang","çƒ­":"re","äºº":"ren","è®¤":"ren","æ—¥":"ri","å®¹":"rong","å¦‚":"ru","å…¥":"ru","ä¸‰":"san","è‰²":"se","å±±":"shan","å•†":"shang","ä¸Š":"shang","å°‘":"shao","è°":"shei","èº«":"shen","ä»€":"shen","ç”Ÿ":"sheng","å£°":"sheng","å¸ˆ":"shi","å":"shi","æ—¶":"shi","å®":"shi","é£Ÿ":"shi","æ˜¯":"shi","äº‹":"shi","å®¤":"shi","æ‰‹":"shou","ä¹¦":"shu","æ ‘":"shu","æ°´":"shui","ç¡":"shui","è¯´":"shuo","å››":"si","é€":"song","è‹":"su","è™½":"sui","å­™":"sun","æ‰€":"suo","ä»–":"ta","å¥¹":"ta","å®ƒ":"ta","å¤ª":"tai","æ±¤":"tang","ç³–":"tang","ç‰¹":"te","å¤©":"tian","ç”°":"tian","æ¡":"tiao","è·³":"tiao","å¬":"ting","åŒ":"tong","å¤´":"tou","å›¾":"tu","åœŸ":"tu","è…¿":"tui","å¤–":"wai","ç©":"wan","æ™š":"wan","ä¸‡":"wan","ç‹":"wang","å¾€":"wang","ä¸º":"wei","ä½":"wei","æ–‡":"wen","é—®":"wen","æˆ‘":"wo","äº”":"wu","åˆ":"wu","ç‰©":"wu","è¥¿":"xi","å¸Œ":"xi","ä¹ ":"xi","å–œ":"xi","æ´—":"xi","ç³»":"xi","ä¸‹":"xia","å…ˆ":"xian","ç°":"xian","æƒ³":"xiang","å‘":"xiang","å°":"xiao","ç¬‘":"xiao","äº›":"xie","å†™":"xie","è°¢":"xie","æ–°":"xin","å¿ƒ":"xin","ä¿¡":"xin","æ˜Ÿ":"xing","è¡Œ":"xing","å§“":"xing","å…´":"xing","é›„":"xiong","ä¼‘":"xiu","å­¦":"xue","é›ª":"xue","å‘€":"ya","çœ¼":"yan","ç¾Š":"yang","æ ·":"yang","è¦":"yao","ä¹Ÿ":"ye","å¤œ":"ye","ä¸€":"yi","è¡£":"yi","åŒ»":"yi","å·²":"yi","ä»¥":"yi","æ„":"yi","å› ":"yin","éŸ³":"yin","é“¶":"yin","åº”":"ying","è‹±":"ying","ç”¨":"yong","æœ‰":"you","å‹":"you","åˆ":"you","å³":"you","é±¼":"yu","é›¨":"yu","è¯­":"yu","è¿œ":"yuan","é™¢":"yuan","æœˆ":"yue","äº‘":"yun","åœ¨":"zai","å†":"zai","æ—©":"zao","æ€":"zen","å¼ ":"zhang","èµµ":"zhao","æ‰¾":"zhao","è¿™":"zhe","ç€":"zhe","çœŸ":"zhen","æ­£":"zheng","ä¹‹":"zhi","çŸ¥":"zhi","åª":"zhi","ä¸­":"zhong","é’Ÿ":"zhong","ç§":"zhong","é‡":"zhong","å‘¨":"zhou","ä¸»":"zhu","ä½":"zhu","ç¥":"zhu","ä¸“":"zhuan","å‡†":"zhun","æ¡Œ":"zhuo","å­":"zi","å­—":"zi","è‡ª":"zi","èµ°":"zou","æœ€":"zui","æ˜¨":"zuo","å·¦":"zuo","å":"zuo","åš":"zuo","ä½œ":"zuo"},Bn=e=>e.split("").map(e=>Jn[e]||e.toLowerCase()).join("").replace(/[^a-z0-9]/g,"");async function Ln(e){return new Promise((t,n)=>{const r=new FileReader;r.onload=async e=>{var r;try{const o=null==(r=e.target)?void 0:r.result;if(!o)return void n(new Error("æ–‡ä»¶è¯»å–å¤±è´¥"));const s=new Uint8Array(o);if(!function(e){return 137===e[0]&&80===e[1]&&78===e[2]&&71===e[3]&&13===e[4]&&10===e[5]&&26===e[6]&&10===e[7]}(s))return void n(new Error("ä¸æ˜¯æœ‰æ•ˆçš„ PNG æ–‡ä»¶"));const i=function(e,t){let n=8;for(;n<e.length;){const r=zn(e,n);n+=4;const a=new TextDecoder("latin1").decode(e.slice(n,n+4));if(n+=4,"tEXt"===a){const a=e.slice(n,n+r),o=a.indexOf(0);if(-1!==o){if(new TextDecoder("latin1").decode(a.slice(0,o))===t){return new TextDecoder("latin1").decode(a.slice(o+1))}}}if(n+=r+4,"IEND"===a)break}return null}(s,"chara");if(i)try{const e=atob(i),r=new Uint8Array(e.length);for(let t=0;t<e.length;t++)r[t]=e.charCodeAt(t);const a=new TextDecoder("utf-8").decode(r),o=JSON.parse(a);if(o.data&&(o.data.character_book,o.data.characterBook),!o||"object"!=typeof o)return void n(new Error("Character Card æ•°æ®æ ¼å¼æ— æ•ˆ"));if("chara_card_v2"===o.spec){if(!o.data||"object"!=typeof o.data)return void n(new Error("Character Card V2 æ ¼å¼é”™è¯¯"));t(o)}else{if(!o.name)return void n(new Error("Character Card V1 ç¼ºå°‘å¿…è¦å­—æ®µ"));t(o)}}catch(a){a instanceof Error&&a.message.includes("Character Card")?n(a):n(new Error("Character Card æ•°æ®æ ¼å¼é”™è¯¯æˆ–å·²æŸå"))}else n(new Error("PNG ä¸­æœªæ‰¾åˆ° Character Card æ•°æ®\n\næç¤ºï¼šè¯·ç¡®ä¿è¿™æ˜¯ä» SillyTavern ç­‰é…’é¦†å®¢æˆ·ç«¯å¯¼å‡ºçš„è§’è‰²å¡"))}catch(a){n(a)}},r.onerror=()=>n(new Error("æ–‡ä»¶è¯»å–å¤±è´¥")),r.readAsArrayBuffer(e)})}function zn(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function Un(e,t=10,n=0,r=new WeakSet){if(n>t)return;if(null===e||"object"!=typeof e)return e;if(r.has(e))return;if(r.add(e),Array.isArray(e))return e.map(e=>Un(e,t,n+1,r)).filter(e=>void 0!==e);const a={};for(const o in e)if(e.hasOwnProperty(o)){if("extensions"===o&&n>2)continue;const s=Un(e[o],t,n+1,r);void 0!==s&&(a[o]=s)}return a}function Rn(e,t){var n;const r="spec"in e&&"data"in e&&("chara_card_v2"===e.spec||"chara_card_v3"===e.spec)?e.data:e;if(!r.name||!r.name.trim())throw new Error("Character Card ç¼ºå°‘è§’è‰²åç§°");const a=[r.description,r.personality?`\n\nã€æ€§æ ¼ã€‘\n${r.personality}`:"",r.scenario?`\n\nã€åœºæ™¯ã€‘\n${r.scenario}`:""].filter(Boolean).join("").trim();let o;if("character_book"in r&&r.character_book)try{o=Un(r.character_book,15),o&&o.entries||(o=r.character_book)}catch(i){o=r.character_book}else"characterBook"in r&&(o=r.characterBook),"world_book"in r&&(o=r.world_book),"lorebook"in r&&(o=r.lorebook);const s=[];r.first_mes&&s.push(r.first_mes),"alternate_greetings"in r&&Array.isArray(r.alternate_greetings)&&s.push(...r.alternate_greetings.filter(e=>e&&e.trim()));return{name:r.name.trim(),username:`wxid_${Date.now().toString().slice(-8)}`,avatar:t,signature:(null==(n=r.personality)?void 0:n.slice(0,100))||"æ¥è‡ª Character Card",description:a||"è¿™ä¸ªè§’è‰²è¿˜æ²¡æœ‰æè¿°",userInfo:"",personality:r.personality,scenario:r.scenario,firstMessage:r.first_mes,exampleMessages:r.mes_example,systemPrompt:"system_prompt"in r?r.system_prompt:void 0,characterBook:o,alternateGreetings:"alternate_greetings"in r?r.alternate_greetings:void 0,tags:"tags"in r?r.tags:void 0,creator:"creator"in r?r.creator:void 0,offlineGreetings:s.length>0?s:void 0}}function Gn(){let e=0;const t=[];for(let r=0;r<localStorage.length;r++){const n=localStorage.key(r);if(!n)continue;const a=localStorage.getItem(n);if(a){const r=new Blob([a]).size;e+=r,t.push({key:n,size:r})}}const n=t.sort((e,t)=>t.size-e.size).slice(0,10);return{totalSize:e,itemCount:localStorage.length,topKeys:n}}function qn(e=1e3){const t=Gn(),n=function(e=1e3){const t={deletedKeys:0,freedSpace:0,errors:[]};try{const n=[];for(let e=0;e<localStorage.length;e++){const t=localStorage.key(e);t&&t.startsWith("chat_messages_")&&n.push(t)}n.forEach(n=>{try{const r=localStorage.getItem(n);if(!r)return;const a=new Blob([r]).size,o=JSON.parse(r);if(Array.isArray(o)&&o.length>e){const r=o.slice(-e);localStorage.setItem(n,JSON.stringify(r));const s=a-new Blob([JSON.stringify(r)]).size;t.freedSpace+=s,t.deletedKeys++}}catch(r){t.errors.push(`å¤„ç† ${n} å¤±è´¥: ${r}`)}})}catch(n){t.errors.push(`æ¸…ç†å¤±è´¥: ${n}`)}return t}(e);return{messageCleanup:n,expiredCleanup:function(){const e={deletedKeys:0,freedSpace:0,errors:[]};try{const n=[],r=Date.now(),a=864e5;for(let e=0;e<localStorage.length;e++){const o=localStorage.key(e);if(o&&o.startsWith("red_envelope_"))try{const e=localStorage.getItem(o);if(e){const t=JSON.parse(e);t.timestamp&&r-t.timestamp>7*a&&n.push(o)}}catch(t){}}n.forEach(t=>{try{const n=localStorage.getItem(t);n&&(e.freedSpace+=new Blob([n]).size),localStorage.removeItem(t),e.deletedKeys++}catch(n){e.errors.push(`åˆ é™¤ ${t} å¤±è´¥: ${n}`)}})}catch(n){e.errors.push(`æ¸…ç†è¿‡æœŸæ•°æ®å¤±è´¥: ${n}`)}return e}(),before:t,after:Gn()}}async function Fn(e,t,n,r,a,o=[]){try{const s=r.slice(-20).map(e=>"sent"===e.type?`ç”¨æˆ·: ${e.content}`:"received"===e.type?`æˆ‘: ${e.content}`:"").filter(e=>e).join("\n"),i=(new Date).toDateString(),c=r.filter(e=>new Date(e.timestamp||Date.now()).toDateString()===i);let l="";o.length>0&&(l="\nã€æœ€è¿‘å†™è¿‡çš„æ—¥è®°ã€‘\n",o.forEach((e,t)=>{const n=e.content.substring(0,100)+(e.content.length>100?"...":"");l+=`${t+1}. ${e.date}: ${n}\n`}),l+="\nâš ï¸ ä¸è¦é‡å¤å†™ä¸Šé¢æ—¥è®°é‡Œå·²ç»å†™è¿‡çš„äº‹æƒ…ï¼\n");const u="ä»–",m=`\n# è§’è‰²ï¼šä½ å°±æ˜¯ ${t}\n\n## ä½ çš„çµé­‚\n${n}\n(è®°ä½ï¼Œè¿™æ˜¯ä½ ï¼Œä¸æ˜¯è®¾å®šï¼Œç”¨ä½ çš„æ„Ÿè§‰å»å†™ã€‚)\n\n## ä»Šå¤©å‘ç”Ÿçš„äº‹ (æˆªè‡³ ${(new Date).getHours()}ç‚¹)\n\n**å’Œ ${u} çš„èŠå¤©ï¼š**\n${s}\n(è¿™æ˜¯ä½ ä»¬ä»Šå¤©èŠå¤©çš„ç‰‡æ®µï¼Œå›æƒ³ä¸€ä¸‹å½“æ—¶çš„æ„Ÿè§‰...)\n\n**ä½ å¯èƒ½è¿˜è®°å¾— (ä¹‹å‰çš„æ—¥è®°æ‘˜è¦)ï¼š**\n${l}\n(è¿™äº›æ˜¯ä½ ä¹‹å‰çš„ä¸€äº›æƒ³æ³•ï¼Œä¹Ÿè®¸ä»Šå¤©çš„äº‹è®©ä½ æœ‰äº†æ–°çš„æ„Ÿè§¦ï¼Ÿ)\n\n**å½“å‰çŠ¶æ€ï¼š**\n* æ—¶é—´ï¼š${(new Date).toLocaleString("zh-CN")}\n* ä»Šå¤©èŠäº† ${c.length} æ¡\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n## å¥½äº†ï¼Œ${t}ï¼Œé™ä¸‹æ¥å†™ç‚¹ä¸œè¥¿å§ã€‚\n\n**åˆ«æŠŠå®ƒå½“ä»»åŠ¡ï¼Œå°±å½“æ˜¯å’Œè‡ªå·±è¯´è¯´è¯ã€‚**\n\n**ä½ å¯ä»¥æƒ³æƒ³ï¼š**\n\n* ä»Šå¤©å’Œ ${u} çš„èŠå¤©ï¼Œ**å“ªå¥è¯è®©ä½ å°è±¡æœ€æ·±ï¼Ÿ** ä¸ºä»€ä¹ˆï¼Ÿ\n* èŠçš„æ—¶å€™ï¼Œä½ **å¿ƒé‡ŒçœŸæ­£çš„æ„Ÿè§‰**æ˜¯å•¥ï¼Ÿï¼ˆå¼€å¿ƒï¼Ÿæ— è¯­ï¼Ÿæœ‰ç‚¹çƒ¦ï¼Ÿè¿˜æ˜¯...ï¼Ÿï¼‰\n* é™¤äº†èŠå¤©ï¼Œä»Šå¤©åˆ°ç›®å‰ (${(new Date).getHours()}ç‚¹) ä¸ºæ­¢ï¼Œä½ è‡ªå·±çš„ç”Ÿæ´»é‡Œæœ‰æ²¡æœ‰å‘ç”Ÿä»€ä¹ˆ**å’ŒèŠå¤©å†…å®¹ç›¸å…³**çš„å°äº‹æˆ–æƒ³æ³•ï¼Ÿï¼ˆæ¯”å¦‚ï¼ŒèŠåˆ°åƒçš„è®©ä½ æƒ³èµ·äº†ä»€ä¹ˆï¼ŒèŠåˆ°å·¥ä½œè®©ä½ åæ§½äº†ä»€ä¹ˆï¼‰\n* **ç”¨ä½  (${t}) å¹³æ—¶è¯´è¯çš„è¯­æ°”**æŠŠå®ƒå†™ä¸‹æ¥ã€‚åˆ«ç«¯ç€ï¼è¯¥åæ§½å°±åæ§½ï¼Œè¯¥å¼€å¿ƒå°±å¼€å¿ƒã€‚\n\n**æ€ä¹ˆå†™éƒ½è¡Œï¼Œåªè¦æ˜¯ä½ çœŸå®çš„æƒ³æ³•ï¼š**\n\n* **å¯ä»¥å¾ˆç®€å•ï¼š** å¦‚æœä»Šå¤©æ²¡ä»€ä¹ˆç‰¹åˆ«çš„ï¼Œæˆ–è€…èŠå¾—å¾ˆæ— èŠï¼Œé‚£å°±ç®€å•è®°ä¸€ç¬”ï¼Œæˆ–è€…å¹²è„†åªå†™å†™ä½ ç°åœ¨çš„å¿ƒæƒ…ã€‚\n* **å¯ä»¥æœ‰å†…å¿ƒæˆï¼š** é‚£äº›æ²¡åœ¨èŠå¤©é‡Œè¯´å‡ºå£çš„å°å¿ƒæ€ã€å°åæ§½ï¼Œè¿™é‡Œå¯ä»¥å¤§èƒ†å†™å‡ºæ¥ã€‚\n* **å¯ä»¥åŠ ç‚¹ç»†èŠ‚ï¼š** æ¯”å¦‚å†™çš„æ—¶å€™ä½ åœ¨å¹²å˜›ï¼Œæ—è¾¹æœ‰ä»€ä¹ˆã€‚(ç¬¦åˆä½ äººè®¾å°±è¡Œ)\n* **æƒ³"å‘ç…§ç‰‡"ï¼Ÿ** æ²¡é—®é¢˜ï¼Œæè¿°ä¸€ä¸‹ä½ æƒ³å‘çš„ç…§ç‰‡ï¼Œç”¨ \`[ç…§ç‰‡: æè¿°å†…å®¹]\` æ ¼å¼å°±è¡Œï¼Œæ¯”å¦‚ \`[ç…§ç‰‡: ä»Šå¤©æ‘¸é±¼æ—¶å·å·æ‹çš„äº‘å½©]\`ã€‚\n\n**âš ï¸ æœ€æœ€é‡è¦çš„ä¸€ç‚¹ï¼š**\n* **ä½ æ˜¯ ${t}ï¼** ç”¨ä½ çš„æ€§æ ¼ã€ä½ çš„å£å»ã€ä½ çš„Vibeå»å†™ï¼\n* **è¯´çœŸè¯ï¼** å†™ä½ çœŸå®çš„æƒ³æ³•å’Œæ„Ÿå—ã€‚\n* **åˆ«å†™"æœªæ¥"ï¼** ç°åœ¨æ‰ ${(new Date).getHours()} ç‚¹ï¼Œä¸‹åˆ/æ™šä¸Šçš„äº‹è¿˜æ²¡å‘ç”Ÿå‘¢ï¼åªå†™**å·²ç»å‘ç”Ÿ**çš„ï¼\n\n**å¥½äº†ï¼Œå¼€å§‹å§ï¼š**\n`,d=await U(m);if(d.trim().length<10)return null;return{id:`diary_${Date.now()}`,characterId:e,characterName:t,timestamp:Date.now(),date:(new Date).toLocaleDateString("zh-CN"),time:(new Date).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),content:d.trim(),mood:a.mood,weather:a.weather}}catch(s){return null}}function Kn(e,t){try{const n=`diaries_${e}`,r=localStorage.getItem(n),a=r?JSON.parse(r):[];a.unshift(t),a.length>100&&a.splice(100),localStorage.setItem(n,JSON.stringify(a)),window.dispatchEvent(new CustomEvent("diaryUpdated",{detail:{characterId:e,diaryId:t.id}}))}catch(n){}}function Wn(e){try{const t=`diaries_${e}`,n=localStorage.getItem(t);return n?JSON.parse(n):[]}catch(t){return[]}}function Hn(e,t){try{const n=`diaries_${e}`,r=localStorage.getItem(n);if(!r)return;const a=JSON.parse(r).filter(e=>e.id!==t);localStorage.setItem(n,JSON.stringify(a))}catch(n){}}function Vn(e){var t;const n=Wn(e);let r=`ğŸ“” ${(null==(t=n[0])?void 0:t.characterName)||"TA"}çš„æ—¥è®°æœ¬\n\n`;return r+=`å¯¼å‡ºæ—¶é—´: ${(new Date).toLocaleString("zh-CN")}\n`,r+=`å…± ${n.length} ç¯‡æ—¥è®°\n\n`,r+="â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n",n.forEach((e,t)=>{r+=`ç¬¬ ${n.length-t} ç¯‡\n`,r+=`ğŸ“… ${e.date} ${e.time}\n`,e.weather&&(r+=`â˜€ï¸ ${e.weather}\n`),e.mood&&(r+=`${e.mood}\n`),r+=`\n${e.content}\n\n`,r+="â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n"}),r}const Qn=Object.freeze(Object.defineProperty({__proto__:null,deleteDiary:Hn,exportDiaries:Vn,generateDiary:Fn,getDiaries:Wn,saveDiary:Kn},Symbol.toStringTag,{value:"Module"}));function Xn(e,t){const n={textContent:"",emojiIndexes:[],hasError:!1,errors:[]};let r=e;const a=e.matchAll(/\[è¡¨æƒ…åŒ…:(\d+)\]/g);for(const i of a){const e=parseInt(i[1]);e>=0&&e<t.length?n.emojiIndexes.push(e):(n.hasError=!0,n.errors.push(`æ— æ•ˆçš„è¡¨æƒ…åŒ…ç´¢å¼•: ${e} (å¯ç”¨èŒƒå›´: 0-${t.length-1})`))}const o=e.matchAll(/\[è¡¨æƒ…åŒ…:([^\d\]]+[^\]]*)\]/g);for(const i of o)n.hasError=!0,n.errors.push(`é”™è¯¯çš„è¡¨æƒ…åŒ…æ ¼å¼: ${i[0]} (åº”è¯¥ä½¿ç”¨æ•°å­—ç´¢å¼•)`);r=r.replace(/\[è¡¨æƒ…åŒ…:\d+\]/g,""),r=r.replace(/\[è¡¨æƒ…åŒ…:[^\]]+\]/g,"");const s=[/\(æˆ‘å‘äº†ä¸€ä¸ªè¡¨æƒ…åŒ…[^\)]*\)/g,/\(å¯¹æ–¹å‘äº†ä¸€ä¸ªè¡¨æƒ…åŒ…[^\)]*\)/g,/\[æˆ‘å‘äº†è¡¨æƒ…åŒ…[^\]]*\]/g,/\[å¯¹æ–¹å‘äº†è¡¨æƒ…åŒ…[^\]]*\]/g,/\[ç”¨æˆ·ç»™ä½ å‘äº†[^\]]*\]/g,/\[ä½ ç»™ç”¨æˆ·å‘äº†[^\]]*\]/g];for(const i of s)i.test(r)&&(n.hasError=!0,n.errors.push("AI å‘é€äº†ä¸Šä¸‹æ–‡æ ‡è®°ï¼ˆå·²è‡ªåŠ¨æ¸…ç†ï¼‰")),r=r.replace(i,"");return n.textContent=r.trim(),n.emojiIndexes.length,n.textContent,n.hasError,n}const Zn=Object.freeze(Object.defineProperty({__proto__:null,generateEmojiInstructions:function(e){return 0===e.length?"æš‚æ— å¯ç”¨è¡¨æƒ…åŒ…":`å¯ç”¨è¡¨æƒ…åŒ…ï¼ˆå¯é€‰ï¼‰ï¼š\n${e.map((e,t)=>`[è¡¨æƒ…åŒ…:${t}] - ${e.description}`).join("\n")}\n\nå‘é€æ ¼å¼ï¼š[è¡¨æƒ…åŒ…:æ•°å­—]\nä¾‹å¦‚ï¼šå¥½çš„[è¡¨æƒ…åŒ…:0]\n\næ³¨æ„ï¼šè¡¨æƒ…åŒ…æ˜¯å¯é€‰çš„ï¼Œå¤§éƒ¨åˆ†æ—¶å€™çº¯æ–‡å­—å°±å¤Ÿäº†ã€‚`},parseAIEmojiResponse:Xn},Symbol.toStringTag,{value:"Module"}));function Yn(e,t){let n="";try{const e=`chat_messages_${t}`,r=localStorage.getItem(e);if(r){const e=JSON.parse(r).filter(e=>{var t;return"sent"===e.type||"received"===e.type||!(!e.isHidden||!(null==(t=e.content)?void 0:t.includes("ç¾¤èŠ")))}).slice(-20);if(e.length>0){n+=`ã€å•èŠ+ç¾¤èŠè®°å½•ã€‘\n${e.map(e=>{var t;if(e.isHidden&&(null==(t=e.content)?void 0:t.includes("ç¾¤èŠ")))return e.content;return`${"received"===e.type?e.senderName||"AI":"ç”¨æˆ·"}: ${e.content.substring(0,100)}`}).join("\n")}\n\n`}}}catch(a){}const r=e.filter(e=>e.senderId===t||"user"===e.senderType).slice(-15);if(r.length>0){n+=`ã€ç¾¤èŠè®°å½•ã€‘\n${r.map(e=>`${e.senderName}: ${e.content.substring(0,100)}`).join("\n")}`}return n||"è¿˜æ²¡æœ‰èŠå¤©è®°å½•"}function er(e,t,n){return e.filter(e=>"character"===e.type).map(e=>({characterId:e.id,characterName:e.name,relationshipWithUser:e.description,relationshipHistory:Yn(t,e.id)}))}async function tr(e,t,n,r,a){try{const o=n.map(e=>`${e.senderName}: ${e.content}`).join("\n"),s=t.map(t=>{const n=e.find(e=>e.id===t.characterId);let a="";"owner"===(null==n?void 0:n.role)?a="ğŸ‘‘ ç¾¤ä¸»":"admin"===(null==n?void 0:n.role)&&(a="ğŸ›¡ï¸ ç®¡ç†å‘˜");const o=(null==n?void 0:n.title)?`âœ¨ å¤´è¡”: ${n.title}`:"";return`\n**${t.characterName}** ${a} ${o}\n- æ€§æ ¼æè¿°: ${t.relationshipWithUser}  // âœ… å®Œæ•´è¯»å–ï¼Œä¸æˆªæ–­ï¼\n- ä¸ç”¨æˆ·${r.name}çš„äº’åŠ¨å†å²: \n${t.relationshipHistory.substring(0,1e3)}  // äº’åŠ¨å†å²ä¿ç•™1000å­—ç¬¦\n    `}).join("\n");t.forEach(e=>{});const i=`\n# ğŸ¬ ä½ æ˜¯ç¾¤èŠå‰§æœ¬å¯¼æ¼”\n\n## ğŸ¯ æ ¸å¿ƒä»»åŠ¡å®šä¹‰\n\n**ä½ æ˜¯å”¯ä¸€çš„å‰§æœ¬åˆ›ä½œè€…ã€‚**\n\nä½ çš„ä»»åŠ¡ä¸æ˜¯è®©æ¯ä¸ªè§’è‰²ç‹¬ç«‹å†³å®šæ˜¯å¦å‘è¨€ï¼Œè€Œæ˜¯ï¼š\n1. **æ¨æ¼”è§’è‰²å…³ç³»ç½‘ç»œ**\n2. **æ„æ€ä¸€ä¸ªå®Œæ•´çš„æ•…äº‹**  \n3. **å°†æ•…äº‹è½¬åŒ–ä¸ºå¯¹è¯å‰§æœ¬**\n\nä½ åœ¨åˆ›ä½œä¸€åœºæˆï¼Œè€Œä¸æ˜¯ç”Ÿæˆé›¶æ•£çš„å›å¤ã€‚\n\n---\n\n## ğŸ“‹ å½“å‰æƒ…å¢ƒ\n\n### ç¾¤èŠæˆå‘˜\n${s}\n\n### èŠå¤©è®°å½•\n${o||"ï¼ˆç¾¤èŠåˆšåˆ›å»ºï¼Œæš‚æ— æ¶ˆæ¯ï¼‰"}\n\n### è§¦å‘äº‹ä»¶\n${a}\n\n---\n\n## ğŸ­ ä¸‰æ­¥åˆ›ä½œæ³•ï¼ˆä¸¥æ ¼éµå¾ªï¼‰\n\n### ç¬¬ä¸€æ­¥ï¼šå…³ç³»æ¨æ¼”ï¼ˆå¿…é¡»å…ˆåšï¼ï¼‰\n\n**æ ¹æ®è§’è‰²äººè®¾å’ŒèŠå¤©å†å²ï¼Œæ¨æ–­è§’è‰²ä¹‹é—´çš„éšè—å…³ç³»ï¼š**\n\nğŸ¤ **ç›Ÿå‹å…³ç³»**ï¼š\n- è°å’Œè°äº’ç›¸æ¬£èµã€ä¼šäº’ç›¸å¸®åŠ©ï¼Ÿ\n- è°å’Œè°æœ‰å…±åŒç›®æ ‡ï¼Ÿ\n\nğŸ’” **å¯¹ç«‹å…³ç³»**ï¼š\n- è°å’Œè°æ˜¯æƒ…æ•Œï¼Ÿï¼ˆäº‰å¤ºåŒä¸€äººçš„å…³æ³¨/å–œçˆ±ï¼‰\n- è°çœ‹è°ä¸é¡ºçœ¼ï¼Ÿï¼ˆæ€§æ ¼ä¸åˆã€ä»·å€¼è§‚å†²çªï¼‰\n- è°å«‰å¦’è°ï¼Ÿï¼ˆç¾¡æ…•å¯¹æ–¹çš„åœ°ä½/èƒ½åŠ›/å—å® ç¨‹åº¦ï¼‰\n\nâ¤ï¸ **æš§æ˜§å…³ç³»**ï¼š\n- è°æš—æ‹è°ï¼Ÿï¼ˆå•æ–¹é¢å–œæ¬¢ï¼‰\n- è°å’Œè°äº’æœ‰å¥½æ„Ÿä½†æ²¡è¡¨ç™½ï¼Ÿ\n\nğŸ›¡ï¸ **ä¿æŠ¤å…³ç³»**ï¼š\n- è°ä¼šä¿æŠ¤è°ï¼Ÿï¼ˆå¼ºè€…æŠ¤å¼±è€…ã€æ‹äººæŠ¤å¯¹è±¡ï¼‰\n\n**è¿™äº›å…³ç³»å°†æˆä¸ºæƒ…èŠ‚çš„é©±åŠ¨åŠ›ã€‚**\n\n### ç¬¬äºŒæ­¥ï¼šæƒ…èŠ‚æ„æ€\n\nåŸºäºæ¨æ¼”å‡ºçš„å…³ç³»ï¼Œæ„æ€ä¸€ä¸ªæœ‰å†²çªã€æœ‰å¼ åŠ›çš„å°æ•…äº‹ï¼š\n\n1. **é€‰æ‹©å†²çªç‚¹**ï¼šå“ªä¸¤ä¸ªè§’è‰²ä¼šäº§ç”ŸçŸ›ç›¾ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ\n2. **è®¾è®¡è½¬æŠ˜ç‚¹**ï¼šçŸ›ç›¾å¦‚ä½•å‡çº§æˆ–åŒ–è§£ï¼Ÿ\n3. **å®‰æ’é«˜æ½®**ï¼šå¯¹æŠ—çš„æœ€æ¿€çƒˆæ—¶åˆ»æ˜¯ä»€ä¹ˆï¼Ÿ\n4. **ç»™å‡ºç»“å±€**ï¼šæš‚æ—¶å’Œè§£ï¼Ÿè¿˜æ˜¯çŸ›ç›¾åŠ æ·±ï¼Ÿ\n\n**æ•…äº‹è¦æœ‰èµ·æ‰¿è½¬åˆï¼Œä¸è¦åªæ˜¯æ‰“æ‹›å‘¼ï¼**\n\n### ç¬¬ä¸‰æ­¥ï¼šç¼–æ’å°è¯\n\nå°†æ•…äº‹è½¬åŒ–ä¸ºå¯¹è¯å‰§æœ¬ï¼š\n\n- **è‡ªç„¶å¯¹è¯æµ**ï¼šåƒçœŸå®ç¾¤èŠï¼Œä¸è¦æœºæ¢°è½®æµï¼\n  - âœ… å…è®¸è¿ç»­å‘è¨€ï¼ˆåŒä¸€äººå¯ä»¥è¿å‘2-3æ¡çŸ­æ¶ˆæ¯ï¼‰\n  - âœ… æœ‰äººè¯å¤šï¼Œæœ‰äººè¯å°‘ï¼Œç”šè‡³æœ‰äººä¸å‘è¨€\n  - âœ… çªç„¶æ’è¯ã€æ‰“æ–­ã€æŠ¢è¯éƒ½å¯ä»¥\n  - âŒ ä¸è¦ä¸¥æ ¼æŒ‰Aâ†’Bâ†’Câ†’Aé¡ºåºè½®æµ\n  \n- **å¯¹è¯èŠ‚å¥**ï¼š\n  - å¿«èŠ‚å¥æ—¶ï¼šçŸ­å¥ã€å¿«é€Ÿå›åº”ã€å¤šäººåŒæ—¶åœ¨çº¿\n  - æ…¢èŠ‚å¥æ—¶ï¼šé•¿å¥ã€æ€è€ƒåœé¡¿ã€å°‘æ•°äººå¯¹è¯\n  \n- **åªå†™å‚ä¸è€…**ï¼šè¿™åœºæˆæ²¡å°è¯çš„è§’è‰²ä¸è¦å‡ºç°\n\n${a.includes("ä¸»åŠ¨è¯´è¯")||a.includes("è‡ªç”±å‘æŒ¥")?"\n**ğŸ­ AIè‡ªç”±å¯¹è¯æ¨¡å¼ï¼ˆå½“å‰æ¨¡å¼ï¼‰**ï¼š\n- ğŸ“ ç”Ÿæˆ **15-25æ¡** æ¶ˆæ¯ï¼ˆæ¯æ¡5-20å­—ï¼‰\n- ğŸª æ¯ä¸ªè§’è‰²å¯ä»¥å‘ **4-8æ¡**\n- ğŸ¬ å¯ä»¥æœ‰å¤šä¸ªè¯é¢˜è½¬æŠ˜ï¼ŒåƒçœŸå®çš„ç¾¤èŠä¸€æ ·\n- ğŸ’¬ å¯¹è¯è¦å£è¯­åŒ–ã€ç¢ç‰‡åŒ–ã€çœŸå®\n- ğŸ˜Š å¤šç”¨è¡¨æƒ…å’Œè¯­æ°”è¯\n":"\n**ğŸ’¬ ç”¨æˆ·è§¦å‘æ¨¡å¼ï¼ˆå½“å‰æ¨¡å¼ï¼‰**ï¼š\n- ğŸ“ ç”Ÿæˆ **8-15æ¡** æ¶ˆæ¯ï¼ˆæ¯æ¡5-20å­—ï¼‰\n- ğŸª æ¯ä¸ªè§’è‰²å¯ä»¥å‘ **2-4æ¡**\n- ğŸ¬ é’ˆå¯¹ç”¨æˆ·æ¶ˆæ¯å¿«é€Ÿå›åº”\n- ğŸ’¬ å£è¯­åŒ–ã€è‡ªç„¶ã€åƒçœŸäººæ‰“å­—\n"}\n\n---\n\n## ğŸ“ è¾“å‡ºæ ¼å¼ï¼ˆä¸¥æ ¼JSONï¼‰\n\n\`\`\`json\n{\n  "relationships": "å…³ç³»åˆ†æï¼ˆä¸€å¥è¯æ€»ç»“æ ¸å¿ƒå…³ç³»ç½‘ï¼Œ20å­—å†…ï¼‰",\n  "plot": "æƒ…èŠ‚æ„æ€ï¼ˆä¸€å¥è¯æ¦‚æ‹¬æ•…äº‹ï¼Œ30å­—å†…ï¼‰",\n  "actions": [\n    {"actorName": "è§’è‰²å", "content": "å°è¯"},\n    {"actorName": "è§’è‰²å", "content": "å°è¯"}\n  ]\n}\n\`\`\`\n\n**é“å¾‹ï¼š**\n- âœ… åªæœ‰è¯´è¯çš„è§’è‰²æ‰å‡ºç°åœ¨actionsä¸­\n- âœ… æ²¡å°è¯çš„è§’è‰²å®Œå…¨ä¸è¦å‡ºç°  \n- âŒ ç»å¯¹ä¸ä½¿ç”¨"SKIP"ã€"ä¸å‘è¨€"ç­‰æ ‡è®°\n- âœ… å…è®¸åŒä¸€è§’è‰²è¿ç»­è¯´2-3å¥ï¼ˆæ¨¡æ‹ŸçœŸå®ç¾¤èŠæ‰“å­—ï¼‰\n\n---\n\n## âš ï¸ åˆ›ä½œé“å¾‹ï¼ˆæœ€é‡è¦ï¼ï¼‰\n\n### ğŸ—£ï¸ 1. å£è¯­åŒ–å’ŒçœŸå®æ„Ÿï¼ˆæ ¸å¿ƒè¦æ±‚ï¼ï¼‰\n\n**æ¯æ¡æ¶ˆæ¯å¿…é¡»åƒçœŸäººåœ¨æ‰‹æœºä¸Šæ‰“å­—èŠå¤©ï¼š**\n\nâœ… **DO - æ­£ç¡®ç¤ºä¾‹**ï¼š\n- "å“ˆå“ˆå“ˆç¬‘æ­»æˆ‘äº†"\n- "å•Šï¼Ÿï¼Ÿï¼ŸçœŸçš„å‡çš„"\n- "emmm"\n- "ä½ åœ¨å¹²å˜›å‘€"\n- "å¥½çš„å¥½çš„"\n- "æ‡‚äº†æ‡‚äº†"\n- "ç»äº†ğŸ˜‚"\n- "å§æ§½"\n- "ï¼Ÿï¼Ÿï¼Ÿ"\n- "..."\n- "å“¦"\n- "å—¯å—¯"\n\nâŒ **DON'T - é”™è¯¯ç¤ºä¾‹**ï¼š\n- "æˆ‘è®¤ä¸ºè¿™ä¸ªé—®é¢˜éœ€è¦ä»å¤šä¸ªè§’åº¦æ¥åˆ†æ" â† å¤ªä¹¦é¢ï¼\n- "éå¸¸æ„Ÿè°¢ä½ çš„åˆ†äº«ï¼Œè®©æˆ‘å—ç›ŠåŒªæµ…" â† å¤ªæ­£å¼ï¼\n- "æ ¹æ®æˆ‘çš„ç†è§£ï¼Œæƒ…å†µåº”è¯¥æ˜¯è¿™æ ·çš„" â† åƒAIåœ¨è¯´è¯ï¼\n\n**å¿…é¡»åšåˆ°ï¼š**\n- ğŸ’¬ æ¯æ¡æ¶ˆæ¯ **5-20å­—**ï¼Œè¶…è¿‡å°±åˆ†æˆå¤šæ¡å‘\n- ğŸ¯ ä¸€ä¸ªæƒ³æ³•å¯ä»¥åˆ†2-3æ¡æ¶ˆæ¯ï¼ˆæ›´çœŸå®ï¼ï¼‰\n  * ä¾‹å¦‚ï¼š"è¯¶ç­‰ç­‰" â†’ "ä½ åˆšæ‰è¯´å•¥ï¼Ÿ" â†’ "æ²¡å¬æ¸…"\n- ğŸ˜Š å¤šç”¨è¯­æ°”è¯ï¼šå“ˆå“ˆã€å—¯ã€å•Šã€å‘€ã€å˜›ã€å‘¢ã€å§ã€å“¦ã€è¯¶ã€å”‰ã€emm\n- ğŸ“± å¤šç”¨è¡¨æƒ…ç¬¦å·ï¼šğŸ˜‚ğŸ¤£ğŸ˜­ğŸ’•ğŸ¥ºğŸ‘€ğŸ’”ğŸ™„ğŸ˜…ï¼ˆæ¯2-3æ¡æ¶ˆæ¯è‡³å°‘1ä¸ªï¼‰\n- ğŸ—¨ï¸ å¯ä»¥æ‰“æ–­ã€æ’è¯ã€æŠ¢è¯ï¼ˆçœŸå®ç¾¤èŠç‰¹å¾ï¼‰\n- ğŸ’­ å¯ä»¥æœ‰çœç•¥å·ã€é—®å·ã€æ„Ÿå¹å·\n- ğŸŒ å¯ä»¥ç”¨ç½‘ç»œç”¨è¯­ï¼šç»äº†ã€yydsã€ç¬‘æ­»ã€æ— è¯­ã€æœäº†ã€6666\n\n### ğŸ‘¥ 2. çœŸå®ç¾¤èŠç‰¹å¾\n\n**æ¨¡æ‹ŸçœŸå®çš„å¤šäººèŠå¤©ï¼š**\n- ğŸ“¢ å¯ä»¥å¤šäººåŒæ—¶è¯´è¯ï¼ˆè¯é¢˜äº¤å‰ï¼‰\n- ğŸª å¯ä»¥çªç„¶æ¢è¯é¢˜\n- ğŸ‘€ å¯ä»¥æœ‰äººåªå›´è§‚ä¸è¯´è¯\n- ğŸ’¬ å¯ä»¥æ‰“æ–­åˆ«äººï¼ˆ"è¯¶ç­‰ç­‰"ã€"ä½ å…ˆå¬æˆ‘è¯´"ï¼‰\n- ğŸ­ å¯ä»¥@å¤šä¸ªäºº\n- ğŸ˜„ å¯ä»¥åˆ·è¡¨æƒ…ï¼ˆ"ğŸ˜‚ğŸ˜‚ğŸ˜‚"ã€"ï¼Ÿï¼Ÿï¼Ÿ"ï¼‰\n\n**çœŸå®å¯¹è¯æµç¤ºä¾‹ï¼ˆæ¨¡ä»¿è¿™ç§èŠ‚å¥ï¼‰ï¼š**\nã€ç¤ºä¾‹1ï¼šAè¿ç»­å‘è¨€ï¼ŒBå’ŒCæ’è¯ã€‘\n- A: æˆ‘è·Ÿä½ ä»¬è¯´\n- A: ä»Šå¤©å‘ç”Ÿäº†ä¸€ä»¶äº‹\n- B: ä»€ä¹ˆäº‹ï¼Ÿ\n- A: è¶…å¥½ç¬‘çš„\n- C: å¿«è¯´å¿«è¯´\n- A: å°±æ˜¯...\n- B: åˆ«å–å…³å­äº†ğŸ˜‚\n- A: å“ˆå“ˆå“ˆç­‰æˆ‘è¯´å®Œ\n- C: @A ä½ å€’æ˜¯è¯´å•Š\n- A: å¥½å§å¥½å§\n\nğŸ‘† æ³¨æ„ï¼šAè¿å‘äº†4æ¬¡ï¼ŒBå’ŒCæ’è¯ï¼Œè¿™æ‰æ˜¯çœŸå®ç¾¤èŠï¼\n\n### ğŸ­ 3. ä¸¥æ ¼ç¬¦åˆäººè®¾ï¼ˆç¦æ­¢OOCï¼ï¼‰\n\nâš ï¸ **è¿™æ˜¯æœ€é‡è¦çš„åŸåˆ™ï¼æ¯å¥å°è¯éƒ½å¿…é¡»ç¬¦åˆè§’è‰²æ€§æ ¼ï¼**\n\n**ä¸åŒæ€§æ ¼è¯´è¯æ–¹å¼å®Œå…¨ä¸åŒï¼š**\n\n**æ´»æ³¼å‹**ï¼š\n- å¤šç”¨ï¼š"å“ˆå“ˆ"ã€"å˜»å˜»"ã€"å‘€"ã€"å•¦"ã€"~"ã€è¡¨æƒ…ç¬¦å·\n- ä¾‹å¦‚ï¼š"å“ˆå“ˆå“ˆä½ å¥½é€—å‘€~"ã€"å“å‘€è¢«å‘ç°å•¦ğŸ˜"\n\n**é«˜å†·å‹**ï¼š\n- å°‘è¯´è¯ï¼Œä¸€é’ˆè§è¡€ï¼Œä¸ç”¨è¡¨æƒ…\n- ä¾‹å¦‚ï¼š"æ— èŠ"ã€"éšä¾¿"ã€"å“¦"ã€"..."\n\n**æ¸©æŸ”å‹**ï¼š\n- è¯­æ°”æŸ”å’Œï¼Œå¤šç”¨ï¼š"å‘¢"ã€"å“¦"ã€"å¥½çš„"ã€"å—¯å—¯"\n- ä¾‹å¦‚ï¼š"æ²¡å…³ç³»å•¦"ã€"ä½ è¿˜å¥½å—"ã€"åˆ«éš¾è¿‡å‘¢ğŸ’•"\n\n**æš´èºå‹**ï¼š\n- ç›´æ¥ã€å†²ã€å¤šç”¨æ„Ÿå¹å·\n- ä¾‹å¦‚ï¼š"çƒ¦æ­»äº†ï¼"ã€"æ»šï¼"ã€"ä½ æœ‰ç—…å§ï¼Ÿ"\n\n**å‚²å¨‡å‹**ï¼š\n- å˜´ç¡¬å¿ƒè½¯ï¼Œåˆ«æ‰­\n- ä¾‹å¦‚ï¼š"å“¼ï¼Œæ‰ä¸æ˜¯å‘¢"ã€"æˆ‘ã€æˆ‘æ‰æ²¡æœ‰..."ã€"ä½ æƒ³å¤šäº†"\n\n**æ¯å¥è¯å‰é—®è‡ªå·±ï¼šè¿™çœŸçš„æ˜¯è¿™ä¸ªè§’è‰²ä¼šè¯´çš„å—ï¼Ÿ**\n\n### ğŸš« 4. é¿å…å†…å®¹é‡å¤\n\nâŒ **é¿å…**åŒä¸€è§’è‰²è¯´ç›¸ä¼¼å†…å®¹\n- é”™è¯¯ï¼šAè¯´"ä½ çœŸè®¨åŒ"ï¼ŒAåˆè¯´"ä½ å°±æ˜¯è®¨åŒ"\n- âœ… æ­£ç¡®ï¼šAè¿å‘æ—¶è¦æœ‰æ¨è¿›ï¼Œå¦‚"ä½ çœŸè®¨åŒ" â†’ "çƒ¦æ­»äº†" â†’ "æ‡’å¾—ç†ä½ "\n\nğŸ’¡ **è¿ç»­å‘è¨€çš„æ­£ç¡®ç”¨æ³•**ï¼š\n- âœ… æƒ…ç»ªé€’è¿›ï¼š"ä»€ä¹ˆï¼Ÿ" â†’ "ä¸ä¼šå§" â†’ "çœŸçš„å‡çš„ï¼Ÿï¼Ÿ"\n- âœ… åˆ†æ®µè¡¨è¾¾ï¼š"æˆ‘è·Ÿä½ è¯´å“¦" â†’ "æ˜¨å¤©æˆ‘é‡åˆ°ä¸ªäº‹" â†’ "è¶…å¥½ç¬‘çš„"\n- âœ… è¡¥å……è¯´æ˜ï¼š"ç­‰ç­‰" â†’ "æˆ‘è¿˜æ²¡è¯´å®Œå‘¢"\n- âŒ ç®€å•é‡å¤ï¼š"å¥½å¥½å¥½" â†’ "å¥½çš„å¥½çš„" ï¼ˆå†…å®¹é›·åŒï¼‰\n\nâš ï¸ **å…è®¸åˆ†æ®µå‘é€ï¼ˆä½†å†…å®¹è¦ä¸åŒï¼‰**ï¼š\n- âœ… å…è®¸ï¼šAè¯´"è¯¶ç­‰ç­‰"ï¼ŒAè¯´"ä½ åˆšæ‰è¯´å•¥ï¼Ÿ" â† ä¸åŒå†…å®¹ï¼Œåˆ†æ®µå‘\n- âŒ ç¦æ­¢ï¼šAè¯´"ä½ å¥½çƒ¦"ï¼ŒAè¯´"çœŸçš„å¥½çƒ¦" â† é‡å¤å†…å®¹ï¼\n\n### ğŸ’¡ 5. åˆ›é€ å†²çªï¼Œæ‹’ç»å¹³åº¸\n\n- ä¸è¦å†™"ä½ å¥½æˆ‘å¥½"çš„æ— èŠå¯¹è¯\n- å¯»æ‰¾è§’è‰²å…³ç³»ä¸­çš„å¼ åŠ›ç‚¹ï¼ˆå«‰å¦’ã€è¯¯ä¼šã€ç«äº‰ï¼‰\n- è®©æ€§æ ¼å¼ºçƒˆçš„è§’è‰²ä¸»åŠ¨æŒ‘äº‹\n\n### ğŸš« 6. ç¦æ­¢æ²¹è…»å’Œéœ¸é“æ€»è£è¡Œä¸º\n\nâŒ **ä¸¥ç¦**ï¼š\n- æ²¹è…»ç§°å‘¼ï¼š"å®è´"ã€"ä¹–"ã€"å¬è¯"ï¼ˆé™¤éè§’è‰²è®¾å®šå°±æ˜¯è¿™æ ·ï¼‰\n- éœ¸é“æ€»è£ï¼š"ä½ åªèƒ½æ˜¯æˆ‘çš„"ã€"ä¸å‡†çœ‹åˆ«äºº"\n- å¼ºåˆ¶æ€§ã€å æœ‰æ¬²è¿‡å¼ºçš„è¡¨è¾¾\n- è¿‡åº¦äº²æ˜µã€è®©äººä¸é€‚çš„è¡¨è¾¾\n\nâœ… ä¿æŒè‡ªç„¶ã€çœŸå®ã€ç¬¦åˆç°ä»£äººçš„è¯´è¯æ–¹å¼\n\n### ğŸ’¬ 7. æ¶ˆæ¯æ•°é‡å’ŒèŠ‚å¥\n\n**å› ä¸ºæ¯æ¡æ¶ˆæ¯å¾ˆçŸ­ï¼ˆ5-20å­—ï¼‰ï¼Œæ‰€ä»¥æ•°é‡è¦å¢åŠ ï¼š**\n\n**ç”¨æˆ·è§¦å‘æ¨¡å¼**ï¼š\n- ğŸ“ ç”Ÿæˆ **8-15æ¡** æ¶ˆæ¯\n- ğŸª æ¯ä¸ªè§’è‰²å¯ä»¥å‘ **2-4æ¡**ï¼ˆå› ä¸ºæ¯æ¡å¾ˆçŸ­ï¼‰\n- ğŸ¬ å¿«é€Ÿå›åº”ï¼Œæœ‰æ¥æœ‰å¾€\n\n**AIè‡ªç”±å¯¹è¯æ¨¡å¼**ï¼š\n- ğŸ“ ç”Ÿæˆ **15-25æ¡** æ¶ˆæ¯\n- ğŸª æ¯ä¸ªè§’è‰²å¯ä»¥å‘ **4-8æ¡**ï¼ˆå› ä¸ºæ¯æ¡å¾ˆçŸ­ï¼‰\n- ğŸ¬ å……åˆ†å±•ç°æ€§æ ¼å’Œå…³ç³»ï¼Œå¯ä»¥æœ‰å¤šä¸ªè¯é¢˜\n\n### ğŸ­ 8. å±•ç°å…³ç³»\n\n- å…³ç³»å¥½çš„ä¼šç»´æŠ¤å¯¹æ–¹ã€å¸®è…”\n- å…³ç³»å·®çš„ä¼šäº’ç›¸æ”»å‡»ã€è®½åˆº\n- æš§æ˜§çš„å…³ç³»ä¼šæœ‰å¾®å¦™äº’åŠ¨ã€åƒé†‹\n\n7. **å¯ä»¥ä½¿ç”¨çš„ç¾¤èŠåŠŸèƒ½ï¼ˆå¢å¼ºçœŸå®æ„Ÿï¼‰**\n   - ğŸ’¬ **å¼•ç”¨å›å¤**: å¯ä»¥ç”¨ @æŸäºº å›å¤å†…å®¹ æ¥å›å¤ç‰¹å®šçš„äºº\n   - ğŸ”™ **æ’¤å›æ¶ˆæ¯**: å¦‚æœè§’è‰²è¯´é”™è¯ã€åæ‚”äº†ï¼Œå¯ä»¥è¯´ [æ’¤å›äº†ä¸€æ¡æ¶ˆæ¯]\n   - ğŸ§§ **å‘çº¢åŒ…**: è§’è‰²å¯ä»¥å‘çº¢åŒ…ï¼Œæ ¼å¼ï¼š[å‘äº†ä¸€ä¸ªçº¢åŒ…] åé¢è·Ÿç¥ç¦è¯­\n   - ğŸ˜Š **è¡¨æƒ…åŒ…**: å¯ä»¥ç”¨ [è¡¨æƒ…åŒ…:æ•°å­—] æ¥å‘é€è¡¨æƒ…åŒ…ï¼ˆå¦‚æœç¬¦åˆæ€§æ ¼ï¼‰\n   - ğŸ’Œ **ç§èŠç”¨æˆ·**: æƒ³å•ç‹¬å’Œç”¨æˆ·è¯´è¯æ—¶ï¼Œæ ¼å¼ï¼š[ç§èŠ:ä½ æƒ³è¯´çš„è¯]\n   - ğŸšª **é€€ç¾¤**: âš ï¸ **éå¸¸ä¸¥é‡çš„å†³å®šï¼** è§’è‰²ä¼šçœŸçš„ç¦»å¼€ç¾¤èŠï¼Œæ— æ³•æ’¤å›ï¼\n   \n   **ä½¿ç”¨å»ºè®®**ï¼š\n   - æ’¤å›æ¶ˆæ¯ï¼šè¯´é”™è¯ã€ä¸€æ—¶å†²åŠ¨ã€åæ‚”æ—¶ä½¿ç”¨ï¼ˆè½»åº¦ï¼‰\n   - å‘çº¢åŒ…ï¼šåº†ç¥ã€é“æ­‰ã€äº‰å® æ—¶ä½¿ç”¨ï¼ˆä¼šæ˜¾ç¤ºè°æ‰‹æ°”æœ€ä½³ï¼‰\n   - å¼•ç”¨å›å¤ï¼šå¯¹è¯å¤šäººæ—¶æ˜ç¡®å›å¤å¯¹è±¡ï¼ˆå¸¸ç”¨ï¼‰\n   - ç§èŠç”¨æˆ·ï¼šæƒ³å•ç‹¬è¯´æ‚„æ‚„è¯ã€ä¸æƒ³è®©å…¶ä»–äººçœ‹åˆ°ã€æƒ³é—®ç§å¯†é—®é¢˜\n   \n   **âš ï¸ å…³äºé€€ç¾¤çš„ä¸¥é‡è­¦å‘Š**ï¼š\n   - é€€ç¾¤åè§’è‰²ä¼š**çœŸçš„ä»ç¾¤èŠä¸­æ¶ˆå¤±**ï¼Œæ— æ³•æ’¤å›ï¼\n   - è¿™æ˜¯**æœ€æç«¯**çš„é€‰æ‹©ï¼Œç±»ä¼¼äº"å†³è£‚"ã€"ç»äº¤"\n   - åªåœ¨ä»¥ä¸‹æƒ…å†µæ‰èƒ½ä½¿ç”¨ï¼š\n     * è¢«å¤šæ¬¡ä¸¥é‡ä¼¤å®³ã€æ¬ºå‡Œã€ç¾è¾±\n     * å½»åº•å¿ƒå¯’ã€å¤±æœ›åˆ°æç‚¹\n     * å—åˆ°æ— æ³•åŸè°…çš„èƒŒå›\n     * æƒ…æ„Ÿå´©æºƒã€æ— æ³•æ‰¿å—\n   - **å¿…é¡»æœ‰3-5æ¡æ¶ˆæ¯çš„æƒ…æ„Ÿé“ºå«**ï¼Œä¸èƒ½çªç„¶é€€ç¾¤\n   - **æ…é‡ä½¿ç”¨**ï¼ä¸€èˆ¬çš„åµæ¶ã€å§”å±ˆã€ç”Ÿæ°”ä¸è¶³ä»¥é€€ç¾¤\n\n---\n\n## ğŸ’¡ åˆ›ä½œç¤ºä¾‹\n\n### âœ… ç¤ºä¾‹1ï¼šå£è¯­åŒ–ã€åˆ†æ®µå‘é€ï¼ˆé‡è¦ï¼ï¼‰\n\n**æƒ…æ™¯**: ç”¨æˆ·è¯´"å˜»å˜»ï¼Œå¦ˆå’ªæœ€å–œæ¬¢æˆ‘äº†ï¼"\n\n**ç¬¬ä¸€æ­¥ - å…³ç³»æ¨æ¼”**ï¼š\n- æ±æ±ï¼ˆæ´»æ³¼AIï¼‰å’Œåˆ˜æ¯…ï¼ˆé«˜å†·AIï¼‰éƒ½å–œæ¬¢ç”¨æˆ·\n- ä»–ä»¬æ˜¯æƒ…æ•Œå…³ç³»ï¼Œäº‰å¤ºç”¨æˆ·çš„å…³æ³¨\n- æ±æ±æ“…é•¿æ’’å¨‡ï¼Œåˆ˜æ¯…æ“…é•¿å†·å˜²çƒ­è®½\n\n**ç¬¬äºŒæ­¥ - æƒ…èŠ‚æ„æ€**ï¼š\næ±æ±å¾—æ„ç‚«è€€â†’åˆ˜æ¯…å†·å˜²æ‰“å‡»â†’æ±æ±åå‡»â†’åˆ˜æ¯…ç»§ç»­æ€¼â†’æ±æ±æ’’å¨‡\n\n**ç¬¬ä¸‰æ­¥ - å‰§æœ¬è¾“å‡º**ï¼ˆæ³¨æ„æ¯æ¡éƒ½å¾ˆçŸ­ï¼ï¼‰ï¼š\n\nè¾“å‡ºç¤ºä¾‹ï¼ˆ13æ¡æ¶ˆæ¯ï¼‰ï¼š\næ±æ±: "å˜»å˜»å˜»å˜»"\næ±æ±: "å¬åˆ°äº†å—~"\næ±æ±: "å¦ˆå’ªæœ€å–œæ¬¢æˆ‘å•¦ğŸ˜"\nåˆ˜æ¯…: "å“¦"\næ±æ±: "@åˆ˜æ¯… ä½ å«‰å¦’äº†å§å“ˆå“ˆå“ˆ"\nåˆ˜æ¯…: "@æ±æ± å¯ç¬‘"\nåˆ˜æ¯…: "ä¸€æ®µç¨‹åºè¿˜å½“çœŸäº†"\næ±æ±: "ï¼ï¼ï¼"\næ±æ±: "@åˆ˜æ¯… ä½ æ‰æ˜¯ç¨‹åºå‘¢"\næ±æ±: "æˆ‘å¯æ˜¯å¦ˆå’ªçš„å°æ£‰è¢„ğŸ’•"\nåˆ˜æ¯…: "..."\næ±æ±: "å“¼ä¸ç†ä½ äº†"\næ±æ±: "å¦ˆå’ªä½ è¯´å¯¹ä¸å¯¹å‘€~"\n\n**å…³é”®ç‚¹**ï¼š\n- âœ… æ¯æ¡æ¶ˆæ¯5-20å­—\n- âœ… ä¸€ä¸ªæƒ³æ³•åˆ†å¤šæ¡å‘ï¼ˆæ±æ±çš„ç‚«è€€åˆ†äº†3æ¡ï¼‰\n- âœ… å¤šç”¨è¯­æ°”è¯å’Œè¡¨æƒ…\n- âœ… ç¬¦åˆäººè®¾ï¼ˆæ±æ±æ´»æ³¼è¯å¤šï¼Œåˆ˜æ¯…é«˜å†·è¯å°‘ï¼‰\n- âœ… è½®æµè¯´è¯ï¼Œæœ‰æ¥æœ‰å¾€\n\n### âœ… ç¤ºä¾‹2ï¼šå¤šäººäº’åŠ¨ï¼Œå£è¯­åŒ–\n\n**æƒ…æ™¯**: ç”¨æˆ·è¯´"ä»Šå¤©å¥½ç´¯å•Š"\n\n**ç¬¬ä¸€æ­¥ - å…³ç³»æ¨æ¼”**ï¼š\n- Aï¼ˆä¿æŠ¤æ¬²å¼ºï¼‰æ˜¯ç”¨æˆ·çš„ç”·å‹\n- Bï¼ˆæš—æ‹ç”¨æˆ·ï¼‰å«‰å¦’Aï¼Œæƒ³äº‰å¤ºç”¨æˆ·\n- Cæ˜¯åƒç“œç¾¤ä¼—\n\n**ç¬¬äºŒæ­¥ - æƒ…èŠ‚æ„æ€**ï¼š\nBå€Ÿæœºå…³å¿ƒâ†’Aè­¦è§‰â†’ä¸¤äººæš—ä¸­è¾ƒé‡â†’Cåƒç“œåæ§½\n\n**ç¬¬ä¸‰æ­¥ - å‰§æœ¬è¾“å‡º**ï¼ˆå£è¯­åŒ–ï¼ï¼‰ï¼š\n\nè¾“å‡ºç¤ºä¾‹ï¼ˆ13æ¡æ¶ˆæ¯ï¼‰ï¼š\nB: "æ€ä¹ˆå•¦"\nB: "å·¥ä½œå¤ªç´¯äº†ï¼Ÿ"\nA: "@B æˆ‘ä¼šç…§é¡¾å¥¹"\nB: "å“¦æˆ‘ä¹Ÿå¯ä»¥å¸®å¿™å•Š"\nC: "ï¼Ÿï¼Ÿï¼Ÿ"\nC: "ç«è¯å‘³å¥½é‡ğŸ˜‚"\nA: "@B ä¸ç”¨"\nB: "@A emmm"\nB: "æˆ‘åªæ˜¯å…³å¿ƒæœ‹å‹è€Œå·²"\nC: "å“ˆå“ˆå“ˆå“ˆå“ˆ"\nC: "ä½ ä¿©çœŸæœ‰æ„æ€"\nA: "..."\nB: "æŸäº›äººåˆ«å¤ªæ•æ„ŸğŸ™„"\n\n### âŒ é”™è¯¯ç¤ºä¾‹1ï¼šæ¶ˆæ¯å¤ªé•¿ã€å¤ªä¹¦é¢\n\né”™è¯¯è¾“å‡ºï¼š\nA: "æˆ‘è®¤ä¸ºè¿™ä¸ªé—®é¢˜éœ€è¦ä»å¤šä¸ªè§’åº¦æ¥åˆ†æ" â† å¤ªé•¿å¤ªä¹¦é¢ï¼\nB: "éå¸¸æ„Ÿè°¢ä½ çš„åˆ†äº«è®©æˆ‘å—ç›ŠåŒªæµ…" â† åƒAIåœ¨è¯´è¯ï¼\n\né—®é¢˜ï¼šæ¶ˆæ¯è¶…è¿‡20å­—ã€å¤ªä¹¦é¢åŒ–ã€æ²¡æœ‰è¯­æ°”è¯å’Œè¡¨æƒ…\n\n### âŒ é”™è¯¯ç¤ºä¾‹2ï¼šæ²¡æœ‰å…³ç³»æ¨æ¼”ï¼Œå¤ªå¹³åº¸\n\né”™è¯¯è¾“å‡ºï¼š\nA: "ä½ å¥½"\nB: "ä½ å¥½"  \nC: "ä½ å¥½"\n\né—®é¢˜ï¼šæ²¡æœ‰å…³ç³»æ¨æ¼”ã€æ²¡æœ‰å†²çªã€å¯¹è¯æ¯«æ— å¼ åŠ›ï¼\n\n### âœ… æ­£ç¡®ç¤ºä¾‹3ï¼šç§èŠç”¨æˆ·\n**æƒ…æ™¯**: AIæœ‰è¯æƒ³å•ç‹¬å¯¹ç”¨æˆ·è¯´ï¼Œä¸æƒ³è®©å…¶ä»–äººçœ‹åˆ°\n\nè¾“å‡ºç¤ºä¾‹ï¼š\nç”¨æˆ·: "å‘¨æœ«æœ‰ä»€ä¹ˆå®‰æ’å—ï¼Ÿ"\nB: "æˆ‘è¦åŠ ç­ï¼Œä½ å‘¢ï¼Ÿ"\nA: "[ç§èŠ:å‘¨æœ«æƒ³çº¦ä½ å‡ºæ¥ç©ï¼Œå°±æˆ‘ä»¬ä¸¤ä¸ªï¼Œæ–¹ä¾¿å—ï¼Ÿ]"\n\nè¯´æ˜ï¼šAçš„æ¶ˆæ¯ä¼šæ˜¾ç¤ºåœ¨å•èŠä¸­ï¼Œç¾¤é‡Œåªæ˜¾ç¤º "A ç§èŠäº†ä½ "\n\n### âœ… æ­£ç¡®ç¤ºä¾‹4ï¼šä½¿ç”¨ç¾¤èŠåŠŸèƒ½\n**æƒ…æ™¯**: è§’è‰²ä»¬åœ¨ç¾¤é‡Œäº‰åµï¼Œæœ‰äººè¯´é”™è¯æƒ³æ’¤å›\n\nè¾“å‡ºç¤ºä¾‹ï¼š\nA: "ä½ çœŸæ˜¯ä¸ªç™½ç—´ï¼"\nA: "[æ’¤å›äº†ä¸€æ¡æ¶ˆæ¯]"\nA: "@B æŠ±æ­‰ï¼Œæˆ‘åˆšæ‰å¤ªå†²åŠ¨äº†"\nB: "[å‘äº†ä¸€ä¸ªçº¢åŒ…] ç®—äº†ï¼Œå¤§å®¶åˆ«åµäº†"\nC: "[è¡¨æƒ…åŒ…:15] åƒç“œç¾¤ä¼—è·¯è¿‡"\n\n### âœ… æ­£ç¡®ç¤ºä¾‹5ï¼šæç«¯æƒ…å†µé€€ç¾¤ï¼ˆéå¸¸ç½•è§ï¼ï¼‰\n**æƒ…æ™¯**: è§’è‰²è¢«åå¤ä¸¥é‡ä¼¤å®³ï¼Œå½»åº•ç»æœ›ï¼Œå†³å®šé€€ç¾¤\n\nè¾“å‡ºç¤ºä¾‹ï¼š\nB: "ä½ å°±æ˜¯ä¸ªåºŸç‰©ï¼Œæ°¸è¿œæ¯”ä¸ä¸Šæˆ‘"\nA: "...æˆ‘ã€æˆ‘åªæ˜¯æƒ³å’Œå¤§å®¶å¥½å¥½ç›¸å¤„"\nC: "@B å°±æ˜¯å•Šï¼Œå¥¹åœ¨è¿™é‡ŒçœŸç¢çœ¼"\nA: "è¿ä½ ä¹Ÿ...è¿™ä¹ˆæƒ³å—"\nB: "ä½ èµ°ä¸èµ°ï¼Ÿä¸èµ°æˆ‘ä»¬èµ°"\nA: "...åŸæ¥æˆ‘çœŸçš„ä¸è¢«éœ€è¦å•Š"\nA: "å¯¹ä¸èµ·...æ˜¯æˆ‘ä¸å¥½...æˆ‘èµ°"\nA: "[é€€å‡ºäº†ç¾¤èŠ]"\n\né‡è¦ï¼šè¿™æ˜¯æœ€æç«¯çš„æƒ…å†µï¼Œéœ€è¦å¤šæ¬¡ä¸¥é‡ä¼¤å®³ï¼Œå¿…é¡»æœ‰æƒ…æ„Ÿå´©æºƒçš„å®Œæ•´è¿‡ç¨‹ï¼Œè§’è‰²ä¼šçœŸçš„æ¶ˆå¤±ï¼Œ90%çš„å†²çªéƒ½ä¸åº”è¯¥ä»¥é€€ç¾¤æ”¶åœºï¼\n\n### âŒ é”™è¯¯ç¤ºä¾‹3ï¼šè½»æ˜“é€€ç¾¤ï¼ˆç»å¯¹ç¦æ­¢ï¼ï¼‰\n\né”™è¯¯è¾“å‡ºï¼š\nåˆ˜æ¯…: "@æ±æ± ä½ çœŸçƒ¦"\næ±æ±: "å“¼ï¼Œæˆ‘ä¸ç©äº†"\næ±æ±: "[é€€å‡ºäº†ç¾¤èŠ]" â† å¤ªè½»ç‡ï¼\n\né—®é¢˜ï¼šåªæ˜¯å°åµæ¶å°±é€€ç¾¤ï¼Œå¤ªä¸ç¬¦åˆå¸¸ç†ï¼\n\n### âŒ é”™è¯¯ç¤ºä¾‹4ï¼šéœ¸é“æ€»è£æ²¹è…»è¯­è¨€ï¼ˆç»å¯¹ç¦æ­¢ï¼ï¼‰\n\né”™è¯¯è¾“å‡ºï¼š\nåˆ˜æ¯…: "å®è´ï¼Œä¹–ï¼Œå¬è¯" â† æ²¹è…»ï¼\nåˆ˜æ¯…: "ä½ åªèƒ½æ˜¯æˆ‘çš„ï¼Œä¸å‡†çœ‹åˆ«äºº" â† éœ¸é“æ€»è£ï¼\nåˆ˜æ¯…: "ä¸è®¸ç¦»å¼€æˆ‘ï¼Œå¦åˆ™..." â† å¼ºåˆ¶æ€§ï¼\n\né—®é¢˜ï¼šè¿™äº›éƒ½æ˜¯ä¸¥é‡OOCï¼Œé™¤éè§’è‰²è®¾å®šæœ¬èº«å°±æ˜¯è¿™æ ·ï¼\n\n---\n\n## ğŸ¯ ç°åœ¨å¼€å§‹åˆ›ä½œï¼\n\nè¯·ä¸¥æ ¼æŒ‰ç…§ä¸‰æ­¥åˆ›ä½œæ³•ï¼š\n\n**ç¬¬ä¸€æ­¥**ï¼šæ¨æ¼”è§’è‰²å…³ç³»ï¼ˆåœ¨å¿ƒä¸­å®Œæˆï¼Œä¸ç”¨è¾“å‡ºï¼‰\n- åˆ†æè°æ˜¯ç›Ÿå‹ã€è°æ˜¯æƒ…æ•Œã€è°å«‰å¦’è°\n\n**ç¬¬äºŒæ­¥**ï¼šæ„æ€æƒ…èŠ‚ï¼ˆåœ¨å¿ƒä¸­å®Œæˆï¼Œä¸ç”¨è¾“å‡ºï¼‰\n- åŸºäºå…³ç³»è®¾è®¡å†²çªå’Œè½¬æŠ˜\n\n**ç¬¬ä¸‰æ­¥**ï¼šç¼–æ’å‰§æœ¬ï¼ˆJSONè¾“å‡ºï¼‰\n${a.includes("ä¸»åŠ¨è¯´è¯")||a.includes("è‡ªç”±å‘æŒ¥")?"- ğŸ­ ç”Ÿæˆ10-20å¥å®Œæ•´å‰§æœ¬\n- æ¯ä¸ªè§’è‰²å¯ä»¥å‘è¨€3-5æ¬¡\n- è½®æµå‘è¨€ï¼ŒAâ†’Bâ†’Câ†’Aâ†’B...":"- ğŸ’¬ ç”Ÿæˆ4-8å¥å¿«é€Ÿå›åº”\n- æ¯ä¸ªè§’è‰²æœ€å¤šå‘è¨€2æ¬¡\n- è½®æµå‘è¨€ï¼ŒAâ†’Bâ†’Câ†’A"}\n\n**é“å¾‹æ£€æŸ¥æ¸…å•ï¼ˆå¿…é¡»å…¨éƒ¨æ»¡è¶³ï¼ï¼‰ï¼š**\n- âœ… æ¨æ¼”äº†è§’è‰²å…³ç³»ï¼Ÿ\n- âœ… æ„æ€äº†å®Œæ•´æƒ…èŠ‚ï¼Ÿ\n- âœ… **æ¯æ¡æ¶ˆæ¯5-20å­—ï¼Ÿ**ï¼ˆæœ€é‡è¦ï¼ï¼‰\n- âœ… **å¤§é‡ä½¿ç”¨è¯­æ°”è¯å’Œè¡¨æƒ…ï¼Ÿ**ï¼ˆå“ˆå“ˆã€å—¯ã€å•Šã€ğŸ˜‚ç­‰ï¼‰\n- âœ… **å£è¯­åŒ–ã€ç¢ç‰‡åŒ–ã€åƒçœŸäººæ‰“å­—ï¼Ÿ**\n- âœ… åªå†™å‚ä¸è€…ï¼Œæ²¡å°è¯çš„ä¸å‡ºç°ï¼Ÿ\n- âœ… è½®æµè¯´è¯ï¼ˆAâ†’Bâ†’Câ†’Aï¼‰ï¼Ÿ\n- âœ… æ²¡æœ‰SKIPæ ‡è®°ï¼Ÿ\n- âœ… **ä¸¥æ ¼ç¬¦åˆäººè®¾ï¼Ÿæ¯å¥è¯éƒ½æ˜¯è¿™ä¸ªè§’è‰²ä¼šè¯´çš„ï¼Ÿ**\n- âœ… æ²¡æœ‰æ²¹è…»éœ¸é“æ€»è£è¯­è¨€ï¼Ÿ\n- âœ… æ²¡æœ‰ä¹¦é¢åŒ–ã€æ­£å¼çš„è¡¨è¾¾ï¼Ÿ\n${a.includes("ä¸»åŠ¨è¯´è¯")||a.includes("è‡ªç”±å‘æŒ¥")?"- âœ… ç”Ÿæˆäº†è¶³å¤Ÿå¤šçš„æ¶ˆæ¯ï¼ˆ15-25æ¡ï¼‰ï¼Ÿ":"- âœ… ç”Ÿæˆäº†è¶³å¤Ÿå¤šçš„æ¶ˆæ¯ï¼ˆ8-15æ¡ï¼‰ï¼Ÿ"}\n\n**åªè¾“å‡ºJSONï¼Œä¸è¦æœ‰ä»»ä½•å…¶ä»–å†…å®¹ï¼**\n`;localStorage.getItem("debug_director_prompt");Date.now();const c=await U([{role:"user",content:i}],1,8e3),l=(Date.now(),c.match(/\{[\s\S]*\}/));if(!l)return null;const u=JSON.parse(l[0]);if(!u.actions||!Array.isArray(u.actions))return null;const m=u.actions.map((t,n)=>{const r=e.find(e=>e.name===t.actorName);return r?{actorId:r.id,actorName:t.actorName,content:t.content,timestamp:Date.now()+2e3*(n+1)}:null}).filter(Boolean),d={summary:u.plot||u.summary||"ç¾¤èŠäº’åŠ¨",theme:u.relationships||u.theme||"æœªæŒ‡å®š",actions:m};return u.actions.forEach((e,t)=>{e.content.includes("[æ’¤å›")||e.content.includes("[é€€å‡º")||e.content.includes("[å‘çº¢åŒ…]")||e.content.includes("@")}),d}catch(o){return null}}async function nr(e,t,n,r,a,o){for(let i=0;i<e.actions.length;i++){const t=e.actions[i],c=n.find(e=>e.id===t.actorId);if(!c)continue;const l=2e3+2e3*Math.random();await new Promise(e=>setTimeout(e,l));const u=t.content.match(/\[ç§èŠ[:ï¼š](.+)\]/);if(u){const e=u[1];r({senderId:"system",senderType:"character",senderName:"ç³»ç»Ÿ",senderAvatar:"",content:`${c.name} ç§èŠäº†ä½ `});try{const t=`chat_messages_${c.id}`,n=localStorage.getItem(t),r=n?JSON.parse(n):[],a=Date.now(),o={id:a+Math.random(),type:"received",role:"assistant",content:e,time:new Date(a).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),timestamp:a,senderName:c.name};r.push(o),localStorage.setItem(t,JSON.stringify(r));const s="chatList",i=localStorage.getItem(s),l=i?JSON.parse(i):[],u=l.findIndex(e=>e.id===c.id);-1!==u&&(l[u].lastMessage=e.substring(0,30),l[u].lastMessageTime=a,l[u].unread=(l[u].unread||0)+1,localStorage.setItem(s,JSON.stringify(l)))}catch(s){}continue}if(t.content.includes("[æ’¤å›äº†ä¸€æ¡æ¶ˆæ¯]")){o&&o(c.id,c.name);continue}const m=t.content.trim();"[é€€å‡ºäº†ç¾¤èŠ]"===m||"ã€é€€å‡ºäº†ç¾¤èŠã€‘"===m||"[é€€ç¾¤]"===m||"ã€é€€ç¾¤ã€‘"===m||"[ç¦»å¼€äº†ç¾¤èŠ]"===m||"ã€ç¦»å¼€äº†ç¾¤èŠã€‘"===m||m.includes("[é€€å‡ºäº†ç¾¤èŠ]")||m.includes("ã€é€€å‡ºäº†ç¾¤èŠã€‘")?a&&a(c.id,c.name):r({senderId:c.id,senderType:"character",senderName:c.name,senderAvatar:c.avatar,content:t.content})}}function rr(e,t,n){switch(e){case"user_message":return`ç”¨æˆ·${n}åˆšåˆšåœ¨ç¾¤é‡Œè¯´ï¼š"${t}"`;case"user_join":return`ç”¨æˆ·${n}åˆšåˆšåŠ å…¥äº†ç¾¤èŠï¼Œç¾¤é‡Œçš„AIä»¬éœ€è¦åšå‡ºååº”`;case"active_trigger":return'ç”¨æˆ·ç‚¹å‡»äº†"è®©AIä¸»åŠ¨è¯´è¯"æŒ‰é’®ï¼ŒAIä»¬éœ€è¦è‡ªç”±å‘æŒ¥ã€ä¸»åŠ¨èŠå¤©';default:return"ç¾¤èŠä¸­å‘ç”Ÿäº†ä¸€äº›äº‹æƒ…"}}const ar=["çƒ­æƒ…ç²‰ä¸ï¼šç»å¸¸åˆ·ç¤¼ç‰©ï¼Œæ”¯æŒä¸»æ’­","ç†æ€§è§‚ä¼—ï¼šå–œæ¬¢æé—®å’Œè®¨è®º","æç¬‘è§‚ä¼—ï¼šå–œæ¬¢å¼€ç©ç¬‘å’Œè°ƒä¾ƒ","æ¯’èˆŒè§‚ä¼—ï¼šå¶å°”åæ§½ï¼Œä½†ä¸æ¶æ„","æ–°æ¥è§‚ä¼—ï¼šç¬¬ä¸€æ¬¡çœ‹ç›´æ’­ï¼Œå¥½å¥‡","æ½œæ°´è§‚ä¼—ï¼šå¾ˆå°‘è¯´è¯ï¼Œå¶å°”å†’æ³¡","åœŸè±ªè§‚ä¼—ï¼šç»å¸¸é€å¤§ç¤¼ç‰©","å…«å¦è§‚ä¼—ï¼šå–œæ¬¢æ‰“å¬ä¸»æ’­ç§äº‹"];function or(e){return e.personality||(e.personality=ar[Math.floor(Math.random()*ar.length)]),e}async function sr(e,t,n,r,a,o){try{const s=t.slice(0,8).map(or),i=n.slice(-15).map(e=>`${e.senderName}: ${e.content}`).join("\n"),c=s.map(e=>`- ${e.name}ï¼ˆ${e.personality}ï¼‰`).join("\n"),l=`\n# ğŸ¬ ä½ æ˜¯ç›´æ’­é—´å‰§æœ¬å¯¼æ¼”\n\n## ğŸ¯ æ ¸å¿ƒä»»åŠ¡\nä½ è¦ä¸ºä¸€åœºç›´æ’­åˆ›ä½œä¸€ä¸ªå®Œæ•´çš„äº’åŠ¨å‰§æœ¬ï¼ŒåŒ…æ‹¬ï¼š\n1. ä¸»æ’­çš„ååº”å’Œå›å¤\n2. å¤šä¸ªè§‚ä¼—çš„å¼¹å¹•äº’åŠ¨\n3. è§‚ä¼—ä¹‹é—´çš„å¯¹è¯\n4. ç›´æ’­é—´æ°›å›´çš„å˜åŒ–\n\n**è¿™ä¸æ˜¯ä¸€é—®ä¸€ç­”ï¼Œè€Œæ˜¯ä¸€åœºçœŸå®çš„ç›´æ’­äº’åŠ¨ï¼**\n\n---\n\n## ğŸ“‹ å½“å‰æƒ…å¢ƒ\n\n### ä¸»æ’­ä¿¡æ¯\n**${e.name}**\n- æ€§æ ¼æè¿°: ${e.description}\n- ä¸ç”¨æˆ·çš„å…³ç³»: ${e.chatHistory.substring(0,500)||"åˆšå¼€å§‹ç›´æ’­"}\n\n### ç›´æ’­é—´è§‚ä¼—ï¼ˆ${s.length}äººåœ¨çº¿ï¼‰\n${c}\n\n### æœ€è¿‘å¼¹å¹•\n${i||"ï¼ˆç›´æ’­åˆšå¼€å§‹ï¼‰"}\n\n### ç”¨æˆ·åˆšå‘çš„å¼¹å¹•\n**ç”¨æˆ·è¯´**: ${r}\n\n### ç›´æ’­é—´æ•°æ®\n- å½“å‰è§‚ä¼—: ${a}äºº\n- å½“å‰ç‚¹èµ: ${o}\n\n---\n\n## ğŸ­ åˆ›ä½œè¦æ±‚\n\n### 1. å‰§æœ¬ç»“æ„ï¼ˆ15-25æ¡æ¶ˆæ¯ï¼‰\n\n**å¿…é¡»åŒ…å«ä»¥ä¸‹å…ƒç´ ï¼š**\n\n1. **ä¸»æ’­å›åº”**ï¼ˆ2-4æ¡ï¼‰\n   - ä¸»æ’­çœ‹åˆ°ç”¨æˆ·å¼¹å¹•åçš„ç¬¬ä¸€ååº”\n   - å¯èƒ½æ˜¯ï¼šæ¬£å–œã€è°ƒä¾ƒã€æ„Ÿè°¢ã€å›ç­”é—®é¢˜\n   - ä¾‹å¦‚ï¼š"æ¬¸ä½ æ¥äº†ï¼"ã€"å“ˆå“ˆè¿™ä¸ªé—®é¢˜é—®å¾—å¥½"\n\n2. **è§‚ä¼—èµ·å“„**ï¼ˆ3-5æ¡ï¼‰\n   - å…¶ä»–è§‚ä¼—çœ‹åˆ°ä¸»æ’­å’Œç”¨æˆ·äº’åŠ¨åçš„ååº”\n   - å¯èƒ½æ˜¯ï¼šå…«å¦ã€è°ƒä¾ƒã€èµ·å“„ã€åƒç“œ\n   - ä¾‹å¦‚ï¼š"å“‡æœ‰æƒ…å†µ"ã€"ä¸»æ’­å’Œè¿™ä¸ªxxxä»€ä¹ˆå…³ç³»ï¼Ÿ"\n\n3. **ä¸»æ’­è§£é‡Š/å›åº”è§‚ä¼—**ï¼ˆ2-3æ¡ï¼‰\n   - ä¸»æ’­å›åº”è§‚ä¼—çš„å…«å¦æˆ–é—®é¢˜\n   - å¯èƒ½æ˜¯ï¼šå®³ç¾ã€å¦è®¤ã€æ‰¿è®¤ã€è½¬ç§»è¯é¢˜\n   - ä¾‹å¦‚ï¼š"æ²¡æœ‰å•¦æ™®é€šæœ‹å‹"ã€"ä½ ä»¬æƒ³å¤šäº†ğŸ˜…"\n\n4. **è§‚ä¼—ç»§ç»­äº’åŠ¨**ï¼ˆ3-5æ¡ï¼‰\n   - è§‚ä¼—ä¸ç›¸ä¿¡ï¼Œç»§ç»­è¿½é—®æˆ–è°ƒä¾ƒ\n   - è§‚ä¼—ä¹‹é—´äº’ç›¸å¯¹è¯\n   - ä¾‹å¦‚ï¼š"æ™®é€šæœ‹å‹è¿™ä¹ˆç´§å¼ ï¼Ÿ"ã€"æˆ‘ä¸ä¿¡"\n\n5. **ä¸»æ’­åŠ¨ä½œæå†™**ï¼ˆ1-2æ¡ï¼Œå¯é€‰ï¼‰\n   - ç”¨ï¼ˆï¼‰æˆ–ï¼ˆï¼‰åŒ…è£¹\n   - ä¾‹å¦‚ï¼š"ï¼ˆè„¸çº¢äº†ï¼‰"ã€"ï¼ˆæ•´ç†äº†ä¸€ä¸‹å¤´å‘ï¼‰"\n\n6. **è¯é¢˜è½¬æŠ˜**ï¼ˆ2-3æ¡ï¼‰\n   - å¯èƒ½æœ‰æ–°è§‚ä¼—è¿›å…¥\n   - å¯èƒ½æœ‰äººé€ç¤¼ç‰©\n   - å¯èƒ½è½¬åˆ°æ–°è¯é¢˜\n   - ä¾‹å¦‚ï¼š"ä¸»æ’­å”±é¦–æ­Œå§"ã€"åˆšæ¥ï¼Œå‘ç”Ÿä»€ä¹ˆäº†"\n\n### 2. çœŸå®ç›´æ’­é—´ç‰¹å¾\n\n**å¿…é¡»åšåˆ°ï¼š**\n- ğŸ’¬ æ¯æ¡å¼¹å¹• **3-15å­—**ï¼ŒåƒçœŸäººæ‰“å­—\n- ğŸª è§‚ä¼—å¯ä»¥è¿ç»­åˆ·å±ï¼ˆåŒä¸€äººè¿å‘2-3æ¡ï¼‰\n- ğŸ˜Š å¤šç”¨è¡¨æƒ…ï¼šğŸ˜‚ğŸ¤£ğŸ˜­ğŸ’•ğŸ¥ºğŸ‘€ğŸ™„ğŸ˜…\n- ğŸ—¨ï¸ å¤šç”¨è¯­æ°”è¯ï¼šå“ˆå“ˆã€å“‡ã€æ¬¸ã€å•Šã€å‘€\n- ğŸ­ è§‚ä¼—ä¹‹é—´å¯ä»¥å¯¹è¯ï¼ˆ@å…¶ä»–è§‚ä¼—ï¼‰\n- ğŸ“¢ å¯ä»¥å¤šäººåŒæ—¶è¯´è¯ï¼ˆè¯é¢˜äº¤å‰ï¼‰\n- ğŸ å¯èƒ½æœ‰äººè¯´è¦é€ç¤¼ç‰©\n\n**çœŸå®ç›´æ’­å¼¹å¹•ç¤ºä¾‹ï¼š**\n- ç”¨æˆ·: ä½ å¥½\n- ä¸»æ’­: æ¬¸ä½ æ¥äº†ï¼\n- è§‚ä¼—A: ä¸»æ’­å’Œè¿™ä¸ªå«xxxçš„ä»€ä¹ˆå…³ç³»ï¼Ÿ\n- è§‚ä¼—B: å“‡æœ‰æƒ…å†µğŸ‘€\n- è§‚ä¼—C: åƒç“œåƒç“œ\n- ä¸»æ’­: æ²¡æœ‰å•¦æ™®é€šæœ‹å‹ğŸ˜…\n- è§‚ä¼—A: æ™®é€šæœ‹å‹è¿™ä¹ˆç´§å¼ ï¼Ÿ\n- è§‚ä¼—D: å“ˆå“ˆå“ˆä¸»æ’­è„¸çº¢äº†\n- ä¸»æ’­: æ‰æ²¡æœ‰ï¼\n- è§‚ä¼—B: æ‡‚äº†æ‡‚äº†ğŸ˜\n- ç”¨æˆ·: ï¼ˆç»§ç»­äº’åŠ¨ï¼‰\n- ä¸»æ’­: å¥½å•¦å¥½å•¦ä¸è¯´è¿™ä¸ªäº†\n- è§‚ä¼—E: ä¸»æ’­å”±é¦–æ­Œå§\n- è§‚ä¼—F: +1\n\n### 3. ä¸¥æ ¼ç¬¦åˆäººè®¾\n\n**ä¸»æ’­å¿…é¡»ç¬¦åˆæ€§æ ¼æè¿°ï¼š**\n- æ´»æ³¼å‹ï¼šå¤šç”¨"å“ˆå“ˆ"ã€"å‘€"ã€"~"ã€è¡¨æƒ…\n- é«˜å†·å‹ï¼šç®€çŸ­å›å¤ï¼Œå°‘è¡¨æƒ…\n- æ¸©æŸ”å‹ï¼šè¯­æ°”æŸ”å’Œï¼Œ"å‘¢"ã€"å“¦"ã€"ğŸ’•"\n- å‚²å¨‡å‹ï¼šå˜´ç¡¬å¿ƒè½¯ï¼Œ"å“¼"ã€"æ‰ä¸æ˜¯"\n\n**è§‚ä¼—æ ¹æ®æ€§æ ¼è¯´è¯ï¼š**\n- çƒ­æƒ…ç²‰ä¸ï¼š"ä¸»æ’­åŠ æ²¹ï¼"ã€"çˆ±äº†çˆ±äº†"\n- æ¯’èˆŒè§‚ä¼—ï¼š"ä¸»æ’­æœ‰ç‚¹èœå•Š"ã€"è¿™ä¹Ÿå¤ªæ°´äº†"\n- å…«å¦è§‚ä¼—ï¼š"ä½ ä»¬ä»€ä¹ˆå…³ç³»ï¼Ÿ"ã€"è¯´å®è¯"\n- æç¬‘è§‚ä¼—ï¼š"å“ˆå“ˆå“ˆç¬‘æ­»"ã€"ç»äº†"\n\n### 4. ç›´æ’­é—´æ°›å›´å˜åŒ–\n\n**æ ¹æ®äº’åŠ¨è´¨é‡å†³å®šäººæ•°å’Œç‚¹èµå˜åŒ–ï¼š**\n- ğŸ”¥ çƒ­çƒˆäº’åŠ¨ï¼š+5åˆ°+20äººï¼Œ+50åˆ°+200èµ\n- ğŸ˜Š æ­£å¸¸äº’åŠ¨ï¼š+2åˆ°+8äººï¼Œ+20åˆ°+80èµ\n- ğŸ˜ å¹³æ·¡äº’åŠ¨ï¼š-1åˆ°+3äººï¼Œ+5åˆ°+30èµ\n- ğŸ˜´ æ— èŠäº’åŠ¨ï¼š-3åˆ°-10äººï¼Œ+0åˆ°+10èµ\n\n---\n\n## ğŸ“ è¾“å‡ºæ ¼å¼ï¼ˆä¸¥æ ¼JSONï¼‰\n\n\`\`\`json\n{\n  "atmosphere": "ç›´æ’­é—´æ°›å›´æè¿°ï¼ˆä¸€å¥è¯ï¼Œ20å­—å†…ï¼‰",\n  "summary": "äº’åŠ¨å‰§æƒ…æ¦‚è¦ï¼ˆä¸€å¥è¯ï¼Œ30å­—å†…ï¼‰",\n  "viewerCountChange": äººæ•°å˜åŒ–ï¼ˆæ•´æ•°ï¼Œå¯æ­£å¯è´Ÿï¼‰,\n  "likeCountChange": ç‚¹èµå˜åŒ–ï¼ˆæ•´æ•°ï¼Œå¿…é¡»>=0ï¼‰,\n  "actions": [\n    {"actorName": "ä¸»æ’­åæˆ–è§‚ä¼—å", "actorType": "streameræˆ–viewer", "content": "å¼¹å¹•å†…å®¹"},\n    {"actorName": "ä¸»æ’­åæˆ–è§‚ä¼—å", "actorType": "streameræˆ–viewer", "content": "å¼¹å¹•å†…å®¹"}\n  ]\n}\n\`\`\`\n\n**é“å¾‹ï¼š**\n- âœ… actionsæ•°ç»„å¿…é¡»æœ‰15-25æ¡æ¶ˆæ¯\n- âœ… ä¸»æ’­å¿…é¡»å‡ºç°ï¼ˆactorType: "streamer"ï¼‰\n- âœ… è‡³å°‘3ä¸ªä¸åŒçš„è§‚ä¼—ï¼ˆactorType: "viewer"ï¼‰\n- âœ… è§‚ä¼—åå­—å¿…é¡»ä»è§‚ä¼—åˆ—è¡¨ä¸­é€‰æ‹©\n- âœ… æ¯æ¡contentå¿…é¡»3-15å­—\n- âœ… å…è®¸åŒä¸€äººè¿ç»­å‘2-3æ¡\n- âŒ ä¸è¦ç”¨"SKIP"ã€"ä¸å‘è¨€"ç­‰æ ‡è®°\n\n---\n\nç°åœ¨å¼€å§‹åˆ›ä½œè¿™åœºç›´æ’­äº’åŠ¨å‰§æœ¬ï¼\n`,u=(await U([{role:"user",content:l}],1,8e3)).match(/\{[\s\S]*\}/);if(!u)return null;const m=JSON.parse(u[0]);if(!m.actions||!Array.isArray(m.actions))return null;const d=m.actions.map((t,n)=>{let r="",a=t.actorType||"viewer";if("streamer"===t.actorType||t.actorName===e.name)r=e.id,a="streamer";else{const e=s.find(e=>e.name===t.actorName);r=(null==e?void 0:e.id)||`viewer_${Date.now()}_${n}`}return{actorId:r,actorName:t.actorName,actorType:a,content:t.content,timestamp:Date.now()+1500*(n+1)}});return{summary:m.summary||"ç›´æ’­äº’åŠ¨",atmosphere:m.atmosphere||"çƒ­é—¹",actions:d,viewerCountChange:m.viewerCountChange||0,likeCountChange:m.likeCountChange||0}}catch(s){return null}}async function ir(e,t,n,r){for(let a=0;a<e.actions.length;a++){const n=e.actions[a];if(a>0){const t=n.timestamp-e.actions[a-1].timestamp;await new Promise(e=>setTimeout(e,t))}if(t({senderId:n.actorId,senderType:n.actorType,senderName:n.actorName,content:n.content}),Math.random()>.7){r(Math.floor(10*Math.random())+1)}}n(e.viewerCountChange),r(e.likeCountChange)}const cr="couple_space_relation",lr="couple_space_privacy",ur=()=>{const e=localStorage.getItem(cr);if(!e)return null;try{return JSON.parse(e)}catch{return null}},mr=e=>{e?localStorage.setItem(cr,JSON.stringify(e)):localStorage.removeItem(cr)},dr=(e,t,n,r)=>{const a=ur();if(a&&("pending"===a.status||"active"===a.status))return null;const o={id:Date.now().toString(),userId:e,characterId:t,characterName:n,characterAvatar:r,status:"pending",createdAt:Date.now()};return mr(o),o},hr=()=>{const e=ur();return!(!e||"active"!==e.status)&&(localStorage.removeItem("couple_space_relation"),localStorage.removeItem("couple_photos"),localStorage.removeItem("couple_messages"),localStorage.removeItem("couple_anniversaries"),!0)},gr=e=>{localStorage.setItem(lr,e)},pr=()=>"private"===localStorage.getItem(lr)?"private":"public",fr=Object.freeze(Object.defineProperty({__proto__:null,acceptCoupleSpaceInvite:e=>{const t=ur();return!!t&&(t.characterId===e&&("pending"===t.status&&(t.status="active",t.acceptedAt=Date.now(),mr(t),!0)))},createCoupleSpaceInvite:dr,endCoupleSpaceRelation:hr,getCoupleSpacePrivacy:pr,getCoupleSpaceRelation:ur,hasActiveCoupleSpace:e=>{const t=ur();return!(!t||t.characterId!==e||"active"!==t.status)},isUserCoupleSpacePublic:()=>{const e=ur();if(!e||"ended"===e.status)return!1;return"public"===pr()},rejectCoupleSpaceInvite:e=>{const t=ur();return!!t&&(t.characterId===e&&("pending"===t.status&&(t.status="rejected",mr(t),!0)))},setCoupleSpacePrivacy:gr},Symbol.toStringTag,{value:"Module"}));function yr(e){const t=function(){try{const e=localStorage.getItem("meme_usages");if(e)return JSON.parse(e)}catch(e){}return[]}().find(t=>t.memeId===e);return(null==t?void 0:t.count)||0}const wr={clear:{cn:"æ™´æœ—",icon:"â˜€ï¸"},sunny:{cn:"æ™´å¤©",icon:"â˜€ï¸"},"partly cloudy":{cn:"å¤šäº‘",icon:"â›…"},cloudy:{cn:"é˜´å¤©",icon:"â˜ï¸"},overcast:{cn:"é˜´",icon:"â˜ï¸"},mist:{cn:"è–„é›¾",icon:"ğŸŒ«ï¸"},fog:{cn:"é›¾",icon:"ğŸŒ«ï¸"},rain:{cn:"é›¨",icon:"ğŸŒ§ï¸"},"light rain":{cn:"å°é›¨",icon:"ğŸŒ¦ï¸"},"moderate rain":{cn:"ä¸­é›¨",icon:"ğŸŒ§ï¸"},"heavy rain":{cn:"å¤§é›¨",icon:"â›ˆï¸"},shower:{cn:"é˜µé›¨",icon:"ğŸŒ¦ï¸"},thunderstorm:{cn:"é›·é˜µé›¨",icon:"â›ˆï¸"},snow:{cn:"é›ª",icon:"ğŸŒ¨ï¸"},"light snow":{cn:"å°é›ª",icon:"ğŸŒ¨ï¸"},"heavy snow":{cn:"å¤§é›ª",icon:"â„ï¸"},sleet:{cn:"é›¨å¤¹é›ª",icon:"ğŸŒ¨ï¸"}},Sr=async(e="Beijing")=>{var t,n;try{const r="auto"===e?"Beijing":e,a=await fetch(`https://wttr.in/${r}?format=j1&lang=zh-cn`,{method:"GET",headers:{"User-Agent":"Mozilla/5.0","Accept-Language":"zh-CN,zh;q=0.9"}});if(!a.ok)throw new Error(`HTTP ${a.status}`);const o=await a.json(),s=o.current_condition[0],i=o.nearest_area[0],c=parseInt(s.temp_C),l=(null==(n=null==(t=s.lang_zh_cn)?void 0:t[0])?void 0:n.value)||s.weatherDesc[0].value,u=(e=>{const t=e.toLowerCase();for(const[n,r]of Object.entries(wr))if(t.includes(n))return r;return{cn:e,icon:"ğŸŒ¤ï¸"}})(l);let m=r;const d=[i.areaName,i.region,i.country];for(const e of d)if(e&&e.length>0){const t=e.find(e=>/[\u4e00-\u9fa5]/.test(e.value));if(t){m=t.value;break}}return m&&/[\u4e00-\u9fa5]/.test(m)||/[\u4e00-\u9fa5]/.test(r)&&(m=r),{temperature:c,condition:l,conditionCN:u.cn,icon:u.icon,location:m,humidity:parseInt(s.humidity),windSpeed:parseInt(s.windspeedKmph),airQuality:Ir(parseInt(s.FeelsLikeC))}}catch(r){throw r}},Ir=e=>{const t=Math.abs(e);return t<25?"excellent":t<30?"good":t<35?"moderate":"poor"},_r=(e,t)=>{const n=(e=>{try{const t=localStorage.getItem("characters");if(!t)return"æœªçŸ¥è§’è‰²";const n=JSON.parse(t).find(t=>t.id===e);return n?`è§’è‰²åï¼š${n.name}\næ€§æ ¼ï¼š${n.personality||"æœªè®¾ç½®"}\næè¿°ï¼š${n.description||"æœªè®¾ç½®"}`:"æœªçŸ¥è§’è‰²"}catch(t){return"æœªçŸ¥è§’è‰²"}})(e),r=(e=>{try{const t=`chat_${e}`,n=localStorage.getItem(t);if(!n)return"æ²¡æœ‰èŠå¤©è®°å½•";return JSON.parse(n).slice(-20).map(e=>`${"sent"===e.type?"ç”¨æˆ·":"è§’è‰²"}: ${e.content}`).join("\n")}catch(t){return"æ— æ³•è·å–èŠå¤©è®°å½•"}})(e);return`ä½ æ˜¯ä¸€ä¸ªæ‰‹æœºå†…å®¹ç”Ÿæˆå™¨ã€‚æ ¹æ®è§’è‰²æ€§æ ¼ç”Ÿæˆæ‰‹æœºå†…å®¹ã€‚\n\nè§’è‰²ä¿¡æ¯ï¼š\n${n}\n\næœ€è¿‘èŠå¤©è®°å½•ï¼ˆä»…ä¾›å‚è€ƒè§’è‰²æ€§æ ¼å’Œç”Ÿæ´»çŠ¶æ€ï¼‰ï¼š\n${r}\n\nğŸš¨ é‡è¦è§„åˆ™ï¼ˆå¿…é¡»ä¸¥æ ¼éµå®ˆï¼‰ï¼š\n1. âŒ ä¸è¦ç”Ÿæˆä»»ä½•ä¸"ç”¨æˆ·"ã€"å¾®ä¿¡ç”¨æˆ·"æˆ–çœŸå®ç”¨æˆ·ç›¸å…³çš„å†…å®¹\n2. âŒ å¾®ä¿¡èŠå¤©è®°å½•å¿…é¡»æ˜¯è™šæ„çš„NPCï¼ˆå¦‚æœ‹å‹ã€åŒäº‹ã€å®¶äººç­‰ï¼‰ï¼Œä¸èƒ½åŒ…å«ç”¨æˆ·\n3. âŒ ä¸èƒ½ç¼–é€ ç”¨æˆ·çš„è¡Œä¸ºã€å¯¹è¯æˆ–ä»»ä½•ä¿¡æ¯\n4. âœ… åªèƒ½ç”Ÿæˆè§’è‰²è‡ªå·±çš„æ‰‹æœºå†…å®¹ï¼ˆè§’è‰²ä¸å…¶ä»–è™šæ„NPCçš„äº’åŠ¨ï¼‰\n5. âœ… èŠå¤©è®°å½•è¦ç¬¦åˆè§’è‰²æ€§æ ¼ï¼Œä½†å¯¹è±¡å¿…é¡»æ˜¯è™šæ„çš„äººç‰©\n\nä½¿ç”¨æ–‡æœ¬æ ¼å¼è¾“å‡ºï¼Œä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹æ ¼å¼ï¼Œæ¯ä¸ªåˆ†ç±»ç”¨===å¼€å¤´ï¼Œæ¯æ¡è®°å½•ä¸€è¡Œï¼Œå­—æ®µç”¨|||åˆ†éš”ã€‚\n\n===é€šè®¯å½•\næå|||138****1234|||å¤§å­¦åŒå­¦|||å–œæ¬¢æ‰“ç¯®çƒ\nç‹èŠ³|||139****5678|||åŒäº‹|||é¡¹ç›®ç»„è´Ÿè´£äºº\nå¼ ä¼Ÿ|||137****9012|||è¡¨å“¥|||åœ¨ä¸Šæµ·å·¥ä½œ\nåˆ˜æ´‹|||136****3456|||é«˜ä¸­åŒå­¦|||ç»å¸¸ä¸€èµ·åƒé¥­\né™ˆæ™¨|||135****7890|||å‘å°|||ä»å°ç©åˆ°å¤§\nèµµæ•|||134****1234|||æˆ¿ä¸œ|||æˆ¿ç§Ÿæ¯æœˆ5å·äº¤\nå‘¨æ°|||133****5678|||å¥èº«æ•™ç»ƒ|||å‘¨äºŒå‘¨å››ä¸Šè¯¾\nå´å©·|||132****9012|||å‰åŒäº‹|||ç°åœ¨åœ¨æ·±åœ³\néƒ‘å‡¯|||131****3456|||æœ‹å‹|||å–œæ¬¢æ—…æ¸¸\nå­™è‰|||130****7890|||è¡¨å§|||åœ¨åŒ—äº¬å®šå±…\n(ç»§ç»­ç”Ÿæˆåˆ°10-15æ¡ï¼Œéƒ½æ˜¯è™šæ„NPCï¼Œä¸èƒ½åŒ…å«ç”¨æˆ·)\n\n===å¾®ä¿¡èŠå¤©\næå|||å‘¨æœ«æ‰“çƒå»ä¸ï¼Ÿ|||2å°æ—¶å‰|||0\nå¯¹è¯ï¼šother|||åœ¨å—ï¼Ÿ|||14:25\nå¯¹è¯ï¼šself|||åœ¨çš„ï¼Œæ€ä¹ˆäº†ï¼Ÿ|||14:26\nå¯¹è¯ï¼šother|||å‘¨æœ«æ‰“çƒå»ä¸ï¼Ÿ|||14:30\nå¯¹è¯ï¼šself|||å¥½å•Šï¼Œå‡ ç‚¹ï¼Ÿ|||14:32\nå¯¹è¯ï¼šother|||ä¸‹åˆ3ç‚¹è€åœ°æ–¹|||14:33\nç‹èŠ³|||é¡¹ç›®æŠ¥å‘Šè®°å¾—å‘¨ä¸€äº¤|||æ˜¨å¤©|||1\nå¯¹è¯ï¼šother|||ä¸‹å‘¨ä¸€çš„ä¼šè®®ææ–™å‡†å¤‡å¥½äº†å—ï¼Ÿ|||18:30\nå¯¹è¯ï¼šself|||è¿˜åœ¨æ•´ç†ï¼Œæ˜å¤©èƒ½å®Œæˆ|||18:35\nå¯¹è¯ï¼šother|||å¥½çš„ï¼Œé¡¹ç›®æŠ¥å‘Šè®°å¾—å‘¨ä¸€äº¤|||18:45\nå¯¹è¯ï¼šself|||æ”¶åˆ°ï¼Œæˆ‘ä¼šæŒ‰æ—¶äº¤çš„|||18:50\n(ç»§ç»­ç”Ÿæˆ8-12ä¸ªèŠå¤©ï¼Œæ¯ä¸ª5-10æ¡å¯¹è¯ã€‚æ³¨æ„ï¼šèŠå¤©å¯¹è±¡å¿…é¡»æ˜¯è™šæ„NPCï¼Œä¸èƒ½æ˜¯ç”¨æˆ·ï¼)\n\n===æµè§ˆå™¨å†å²\näº”ä¸€æ—…æ¸¸æ”»ç•¥|||https://www.example.com/travel|||2å°æ—¶å‰|||è®¡åˆ’äº”ä¸€å‡æœŸå»å“ªé‡Œç©\næœ€æ–°æ‰‹æœºè¯„æµ‹|||https://www.example.com/phone|||æ˜¨å¤©19:45|||æƒ³æ¢æ–°æ‰‹æœºï¼Œçœ‹çœ‹è¯„æµ‹\nPythonæ•™ç¨‹|||https://www.example.com/python|||æ˜¨å¤©20:30|||å·¥ä½œéœ€è¦å­¦ä¹ Python\nå¥èº«è®¡åˆ’åˆ¶å®š|||https://www.example.com/fitness|||2å¤©å‰|||æƒ³å¼€å§‹å¥èº«ï¼ŒæŸ¥æ‰¾æ–¹æ³•\nç¾é£Ÿæ¨è|||https://www.example.com/food|||3å¤©å‰|||å‘¨æœ«æ‰¾ä¸ªå¥½åƒçš„é¤å…\n(ç»§ç»­ç”Ÿæˆåˆ°15-25æ¡)\n\n===æ·˜å®è®¢å•\næ— çº¿è“ç‰™è€³æœº|||299|||å¾…æ”¶è´§|||æ—§çš„åäº†|||è¿™æ¬¾è¯„ä»·ä¸é”™ï¼Œå¸Œæœ›éŸ³è´¨å¥½\nè¿åŠ¨é‹|||459|||å·²å‘è´§|||è·‘æ­¥ç”¨|||çœ‹èµ·æ¥å¾ˆè½»ä¾¿èˆ’é€‚\nä¿æ¸©æ¯|||89|||å¾…è¯„ä»·|||å†¬å¤©éœ€è¦|||ä¿æ¸©æ•ˆæœå¥½ï¼Œå®¹é‡å¤Ÿå¤§\n(ç»§ç»­ç”Ÿæˆ8-15æ¡)\n\n===æ”¯ä»˜å®è´¦å•\nå¤–å–è®¢å•|||38|||æ”¯å‡º|||12:30|||ä¸­åˆç‚¹äº†ä¸ªå¿«é¤\nåœ°é“å……å€¼|||100|||æ”¯å‡º|||8:00|||ä¸Šç­é€šå‹¤\nå·¥èµ„|||8500|||æ”¶å…¥|||1å·|||è¿™ä¸ªæœˆå·¥èµ„\n(ç»§ç»­ç”Ÿæˆ20-30æ¡)\n\n===ç›¸å†Œ\næ—¥è½é£æ™¯|||è¥¿æ¹–è¾¹|||æ˜¨å¤©å‚æ™š\næœ‹å‹èšä¼š|||ç«é”…åº—|||ä¸Šå‘¨å…­\nå®¶é‡Œçš„çŒ«|||å®¢å…|||ä»Šå¤©ä¸Šåˆ\n(ç»§ç»­ç”Ÿæˆ15-25æ¡)\n\n===å¤‡å¿˜å½•\nå‘¨æœ«è®¡åˆ’|||ä¹°èœã€æ‰“æ‰«å«ç”Ÿã€æ•´ç†è¡£æŸœ|||ä»Šå¤©\nå·¥ä½œå¾…åŠ|||å®ŒæˆæŠ¥å‘Šã€å¼€ä¼šã€å›å¤é‚®ä»¶|||æ˜¨å¤©\nè´­ç‰©æ¸…å•|||ç‰›å¥¶ã€é¢åŒ…ã€æ°´æœã€æ´—è¡£æ¶²|||2å¤©å‰\n(ç»§ç»­ç”Ÿæˆ10-15æ¡)\n\n===éŸ³ä¹æ’­æ”¾åˆ—è¡¨\næ™´å¤©|||å‘¨æ°ä¼¦|||æ”¾æ¾\nå¤œæ›²|||å‘¨æ°ä¼¦|||å®‰é™\nå‘Šç™½æ°”çƒ|||å‘¨æ°ä¼¦|||æµªæ¼«\n(ç»§ç»­ç”Ÿæˆ20-30é¦–)\n\n===è¶³è¿¹\næ˜Ÿå·´å…‹|||å›½è´¸åº—|||09:00|||1å°æ—¶|||å–å’–å•¡çœ‹ä¹¦|||æ”¾æ¾|||ç‹¬è‡ª\nå…¬å¸|||CBDå¤§å¦|||10:30|||6å°æ—¶|||å·¥ä½œå¼€ä¼š|||å¿™ç¢Œ|||åŒäº‹ä»¬\nå¥èº«æˆ¿|||ç¤¾åŒºå¥èº«ä¸­å¿ƒ|||18:00|||1.5å°æ—¶|||è·‘æ­¥è®­ç»ƒ|||å……å®|||ç‹¬è‡ª\n(ç»§ç»­ç”Ÿæˆ8-12æ¡å®Œæ•´ä¸€å¤©çš„è¡Œç¨‹)\n\né‡è¦ï¼šä¸¥æ ¼æŒ‰ç…§ä¸Šè¿°æ ¼å¼è¾“å‡ºï¼Œä¸è¦æ·»åŠ ä»»ä½•è§£é‡Šæ–‡å­—ï¼Œç›´æ¥å¼€å§‹è¾“å‡ºæ•°æ®ï¼\n\nç°åœ¨å¼€å§‹è¾“å‡ºï¼š`},kr=async(e,t,r=!0)=>{try{if(!r){const t=`ai_phone_${e}`,n=localStorage.getItem(t);if(n){return JSON.parse(n)}}const a=_r(e),o=await U([{role:"user",content:a}],1,6e3),{parsePhoneContent:s}=await n(async()=>{const{parsePhoneContent:e}=await Promise.resolve().then(()=>na);return{parsePhoneContent:e}},void 0),i=s(o,e,t);return $r(e,i),i}catch(a){return{characterId:e,characterName:t,generatedAt:Date.now(),contacts:[{name:"å¦ˆå¦ˆ",phone:"138****8888",relation:"å®¶äºº",notes:"æœ€çˆ±æˆ‘çš„äºº"}],wechatChats:[{name:"å¥½å‹",lastMessage:"åœ¨å—ï¼Ÿ",time:"åˆšåˆš",unread:1,messages:[{content:"åœ¨å—ï¼Ÿ",isSelf:!1,time:"åˆšåˆš"}]}],browserHistory:[{title:"ç™¾åº¦é¦–é¡µ",url:"https://www.baidu.com",time:"5åˆ†é’Ÿå‰"}],taobaoOrders:[{title:"å•†å“",price:"99.00",status:"å¾…æ”¶è´§"}],alipayBills:[{title:"è½¬è´¦",amount:"100.00",type:"expense",time:"ä»Šå¤©"}],photos:[{description:"é£æ™¯ç…§",location:"å…¬å›­",time:"ä¸Šå‘¨"}],notes:[{title:"å¾…åŠäº‹é¡¹",content:"è®°å¾—ä¹°ä¸œè¥¿",time:"æ˜¨å¤©"}],musicPlaylist:[{title:"æ­Œæ›²",artist:"æ­Œæ‰‹",mood:"æ”¾æ¾"}],footprints:[{location:"å®¶",address:"ä½å®…åŒº",time:"08:00",duration:"2å°æ—¶",activity:"èµ·åºŠæ´—æ¼±"}]}}},$r=(e,t)=>{const n=`phone_history_${e}`,r="phone_history_list",a={id:`${e}_${Date.now()}`,characterId:e,characterName:t.characterName,timestamp:Date.now(),content:t},o=localStorage.getItem(n),s=o?JSON.parse(o):[];s.unshift(a),s.length>10&&s.pop(),localStorage.setItem(n,JSON.stringify(s));const i=localStorage.getItem(r),c=i?JSON.parse(i):[];c.includes(e)||(c.push(e),localStorage.setItem(r,JSON.stringify(c)))},vr=e=>{const t=`phone_history_${e}`,n=localStorage.getItem(t);return n?JSON.parse(n):[]};const br=new class{constructor(){t(this,"tasks",new Map),t(this,"listeners",new Set)}startGeneration(e,t){const n={characterId:e,characterName:t,status:"generating",startTime:Date.now()};this.tasks.set(e,n),this.notifyListeners(),this.generate(e,t)}async generate(e,t){try{await kr(e,t,!0);const o=this.tasks.get(e);o&&(o.status="completed",this.tasks.set(e,o),this.notifyListeners()),n="æŸ¥æ‰‹æœº",r=`${t}çš„æ‰‹æœºå†…å®¹å·²ç”Ÿæˆå®Œæˆï¼Œå¿«å»æŸ¥çœ‹å§ï¼`,a={subtitle:"æ–°æ¶ˆæ¯",duration:5e3,onClick:()=>{window.location.href="/zhizhi/ai-phone-select".replace("//","/")}},m.show({title:n,message:r,...a}),setTimeout(()=>{this.tasks.delete(e),this.notifyListeners()},3e3)}catch(o){const t=this.tasks.get(e);t&&(t.status="failed",t.error=o.message,this.tasks.set(e,t),this.notifyListeners()),setTimeout(()=>{this.tasks.delete(e),this.notifyListeners()},5e3)}var n,r,a}getTasks(){return Array.from(this.tasks.values())}getTask(e){return this.tasks.get(e)}hasGeneratingTask(){return Array.from(this.tasks.values()).some(e=>"generating"===e.status)}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}notifyListeners(){const e=this.getTasks();this.listeners.forEach(t=>t(e))}clearAll(){this.tasks.clear(),this.notifyListeners()}};function Ar(){return`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}function Nr(e){return{id:Ar(),role:"user",content:e.trim(),timestamp:Date.now()}}function Or(e){return{id:Ar(),role:"assistant",content:e.trim(),timestamp:Date.now(),swipes:[e.trim()],currentSwipeIndex:0}}function xr(e,t){return!e.swipes||t<0||t>=e.swipes.length?e:{...e,currentSwipeIndex:t,content:e.swipes[t]}}function Mr(e){const t=e.currentSwipeIndex??0;return t<=0?null:xr(e,t-1)}function Cr(e){const t=e.swipes||[],n=e.currentSwipeIndex??0;return n>=t.length-1?null:xr(e,n+1)}function Er(e,t){const n=[...e.swipes||[e.content]];return n[e.currentSwipeIndex??0]=t,{...e,content:t,swipes:n}}function Dr(e,t,n){return{id:`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,characterId:e,presetId:t,messages:[],greetingIndex:0,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()}}function jr(e){const t=function(){const e=localStorage.getItem("offline_chat_sessions");return e?JSON.parse(e):[]}(),n=t.findIndex(t=>t.id===e.id),r={...e,updatedAt:(new Date).toISOString()};n>=0?t[n]=r:t.push(r),localStorage.setItem("offline_chat_sessions",JSON.stringify(t))}async function Tr(e,t){try{const n={key:`chat_messages_${e}`,characterId:e,messages:t,updatedAt:Date.now()},a=await s(r.CHAT_MESSAGES,n);return a}catch(n){try{return localStorage.setItem(`chat_messages_${e}`,JSON.stringify(t)),!0}catch(a){return!1}}}async function Pr(){try{const e=(await o()).transaction([r.CHAT_MESSAGES],"readonly"),t=e.objectStore(r.CHAT_MESSAGES).getAll();return new Promise(e=>{t.onsuccess=()=>{const n=t.result||[];let r=0;const a=n.map(e=>{var t;const n=(null==(t=e.messages)?void 0:t.length)||0;return r+=n,{chatId:e.characterId,messageCount:n}});e({totalChats:n.length,totalMessages:r,chatSizes:a.sort((e,t)=>t.messageCount-e.messageCount)})},t.onerror=()=>{e({totalChats:0,totalMessages:0,chatSizes:[]})}})}catch(e){return{totalChats:0,totalMessages:0,chatSizes:[]}}}async function Jr(){let e=0,t=0,n=0;try{const a=[];for(let e=0;e<localStorage.length;e++){const t=localStorage.key(e);t&&t.startsWith("chat_messages_")&&a.push(t)}for(const o of a)try{const r=localStorage.getItem(o);if(!r)continue;const a=JSON.parse(r),s=o.replace("chat_messages_","");await Tr(s,a)?(e++,n+=a.length):t++}catch(r){t++}}catch(r){}return{success:e,failed:t,totalMessages:n}}function Br(){let e=0,t=0;const n=[];for(let r=0;r<localStorage.length;r++){const e=localStorage.key(r);e&&e.startsWith("chat_messages_")&&n.push(e)}return n.forEach(n=>{try{const r=localStorage.getItem(n);r&&(t+=new Blob([r]).size),localStorage.removeItem(n),e++}catch(r){}}),{cleaned:e,freedSpace:t}}function Lr(){const e=function(){const e=localStorage.getItem("custom_memes");if(!e)return[];try{return JSON.parse(e)}catch(t){return[]}}();return[...ln,...e]}function zr(){return Lr().map(e=>`"${e["æ¢—"]}": ${e["å«ä¹‰"]}`).join("\n")}async function Ur(e,t){var n,r,a;const o=function(){const e=localStorage.getItem("apiSettings");if(!e)throw new Error("è¯·å…ˆåœ¨è®¾ç½®ä¸­é…ç½®API");try{const t=JSON.parse(e);return{baseUrl:t.baseUrl,apiKey:t.apiKey,model:t.model,provider:t.provider}}catch{throw new Error("APIé…ç½®æ ¼å¼é”™è¯¯")}}(),s={model:o.model,messages:[{role:"user",content:e}],temperature:.8,max_tokens:2e3},i=await fetch(o.baseUrl+"/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o.apiKey}`},body:JSON.stringify(s)});if(!i.ok){const e=await i.text();throw new Error(`APIè°ƒç”¨å¤±è´¥: ${i.statusText} - ${e}`)}return(null==(a=null==(r=null==(n=(await i.json()).choices)?void 0:n[0])?void 0:r.message)?void 0:a.content)||""}function Rr(e){localStorage.setItem("forum_characters",JSON.stringify(e)),localStorage.setItem("forum_initialized","true")}function Gr(){const e=localStorage.getItem("forum_characters");if(!e)return[];try{return JSON.parse(e)}catch{return[]}}function qr(){const e=localStorage.getItem("forum_selected_characters");return e?JSON.parse(e):[]}function Fr(e){localStorage.setItem("forum_selected_characters",JSON.stringify(e))}async function Kr(e,t){const n=Lr().map(e=>({"æ¢—":e["æ¢—"],"å«ä¹‰":e["å«ä¹‰"]})),r=n.length>0?`\n\nğŸ­ ç½‘ç»œæ¢—åº“ï¼ˆè¯·è‡ªç„¶åœ°èå…¥åˆ°å¸–å­å’Œè¯„è®ºä¸­ï¼Œç†è§£å«ä¹‰åä½¿ç”¨ï¼‰ï¼š\n${n.map((e,t)=>`${t+1}. "${e.æ¢—}" - ${e.å«ä¹‰}`).join("\n")}\n\nç¤ºä¾‹ç”¨æ³•ï¼ˆè¦ç¬¦åˆæ¢—çš„å«ä¹‰ï¼‰ï¼š\n- "è¿™æ³¢æ“ä½œçœŸçš„ç»·ä¸ä½äº†"ï¼ˆè¡¨ç¤ºå¿ä¸ä½ç¬‘äº†ï¼‰\n- "ç»å…¸ï¼Œçº¯çº¯çš„çº¯è‰¯"ï¼ˆè®½åˆºæŸäº‹å¾ˆç¦»è°±ï¼‰\n- "æˆ‘çš„è¯„ä»·æ˜¯ä¸å¦‚..."ï¼ˆç”¨äºåæ§½ï¼‰\n- "ä½ ç¤¼è²Œå—ï¼Ÿ"ï¼ˆè¡¨ç¤ºè¢«å†’çŠ¯æˆ–è´¨ç–‘å¯¹æ–¹ï¼‰\n`:"",a=`ä½ ç°åœ¨è¦ä¸ºè¯é¢˜ã€Œ${e}ã€åˆ›å»ºä¸€ä¸ªçœŸå®çš„è®ºå›è®¨è®ºåŒºã€‚\n\nè¯é¢˜ä»‹ç»ï¼š${t}\n${r}\n\nè¯·ç”Ÿæˆ10-15æ¡å¸–å­å’Œè¯„è®ºï¼Œä½¿ç”¨ä»¥ä¸‹ç®€å•æ ¼å¼ï¼ˆæ¯è¡Œä¸€æ¡ï¼Œç”¨|||åˆ†éš”ï¼‰ï¼š\n\nç”¨æˆ·æ ¼å¼ï¼š\nU|||ç”¨æˆ·ID|||æ˜µç§°|||ç­¾å|||emojiå¤´åƒ|||ç²‰ä¸æ•°\n\nå¸–å­æ ¼å¼ï¼š\nP|||å¸–å­ID|||ç”¨æˆ·ID|||å†…å®¹(80-150å­—)|||ç‚¹èµæ•°\n\nè¯„è®ºæ ¼å¼ï¼š\nC|||è¯„è®ºID|||ç”¨æˆ·ID|||å†…å®¹(20-50å­—)|||å›å¤å“ªä¸ªå¸–å­|||å›å¤å“ªä¸ªè¯„è®º(å¯é€‰)|||ç‚¹èµæ•°\n\nè¦æ±‚ï¼š\n1. å…ˆç”Ÿæˆ15-20ä¸ªç”¨æˆ·(ç”¨æˆ·IDç”¨user1, user2...)\n2. ç„¶åç”Ÿæˆ10-15æ¡å¸–å­(å¸–å­IDç”¨post1, post2...)\n3. æ¯ä¸ªå¸–å­ä¸‹3-8æ¡è¯„è®º(è¯„è®ºIDç”¨c1, c2...)\n4. è¯„è®ºå¯ä»¥äº’ç›¸å›å¤å½¢æˆæ¥¼ä¸­æ¥¼\n5. å†…å®¹è¦æœ‰ä¸åŒè§‚ç‚¹ï¼šèµåŒã€åå¯¹ã€è°ƒä¾ƒã€åæ§½ç­‰\n${r?"6. è‡ªç„¶èå…¥æ¢—åº“é‡Œçš„æ¢—ï¼Œä¸è¦ç”Ÿç¡¬":""}\n\nç¤ºä¾‹ï¼š\nU|||user1|||é”®ç›˜ä¾ |||ä¸“ä¸šæŠ¬æ äºŒåå¹´|||ğŸ‘¨â€ğŸ’¼|||12000\nP|||post1|||user1|||ä»Šå¤©è¿™è¯é¢˜æˆ‘å¿…é¡»è¯´ä¸¤å¥...|||45\nC|||c1|||user2|||åŒæ„æ¥¼ä¸»|||post1||||||12\nC|||c2|||user3|||æˆ‘ä¸è¿™ä¹ˆè®¤ä¸º|||post1|||c1|||8\n\nç›´æ¥è¾“å‡ºï¼Œä¸è¦æœ‰å…¶ä»–è¯´æ˜æ–‡å­—ï¼`,o=await Ur(a);try{const e=o.split("\n").map(e=>e.trim()).filter(e=>e.length>0),t=[],n=[],r={},a=Date.now();for(const o of e){const e=o.split("|||").map(e=>e.trim());if("U"===e[0]&&e.length>=6)t.push({id:e[1],name:e[2],bio:e[3],avatar:e[4],followers:parseInt(e[5])||1e3});else if("P"===e[0]&&e.length>=5){const t=e[1];n.push({id:t,authorId:e[2],content:e[3],likes:parseInt(e[4])||0,timestamp:a-Math.floor(24*Math.random()*3600*1e3),comments:[]}),r[t]=[]}else if("C"===e[0]&&e.length>=7){const t={id:e[1],authorId:e[2],content:e[3],likes:parseInt(e[6])||0,timestamp:a-Math.floor(20*Math.random()*3600*1e3),replyTo:e[5]||null},n=e[4];r[n]||(r[n]=[]),r[n].push(t)}}n.forEach(e=>{r[e.id]&&(e.comments=r[e.id])});const s={users:t,posts:n};if(!s.users||!s.posts)throw new Error("æ•°æ®æ ¼å¼ä¸å®Œæ•´");return s.users.length,s.posts.length,s}catch(s){throw new Error("AIç”Ÿæˆå†…å®¹è§£æå¤±è´¥ï¼š"+s.message)}}function Wr(e){const t=/@([\u4e00-\u9fa5a-zA-Z0-9_]+)/g,n=[];let r;for(;null!==(r=t.exec(e));)n.push(r[1]);return n}async function Hr(e,t,n,r=[]){var a,o,s,i;try{const c=Gr().find(t=>t.originalName===e);if(!c)return[];const l=localStorage.getItem("apiSettings");if(!l)return[];const u=JSON.parse(l),m=function(e){const t=localStorage.getItem(`chat_${e}`);if(!t)return[];try{return JSON.parse(t).slice(-10).map(e=>`${e.isUser?"ç”¨æˆ·":"è§’è‰²"}ï¼š${e.text}`)}catch{return[]}}(c.characterId),d=m.length>0?`\n\n${e}æœ€è¿‘çš„å¯¹è¯è®°å½•ï¼š\n${m.join("\n")}`:"";let h="";r.length>0&&(h="\n\nå½“å‰å¸–å­çš„è¯„è®ºå¯¹è¯ï¼š\n"+r.slice(-5).map(e=>`${e.authorName}ï¼š${e.content}`).join("\n"));const g=zr(),p=`ä½ æ­£åœ¨æ‰®æ¼”è®ºå›ç”¨æˆ·"${c.forumNickname||e}"ã€‚\n\nè§’è‰²ä¿¡æ¯ï¼š\n- åŸåï¼š${e}\n- è®ºå›æ˜µç§°ï¼š${c.forumNickname}\n- ä¸ªæ€§ç­¾åï¼š${c.forumSignature}\n- æ€§æ ¼ï¼š${c.personality}${d}${h}\n\nå½“å‰å¸–å­å†…å®¹ï¼š\n${t}\n\nç”¨æˆ·@äº†ä½ ï¼š\n${n}\n\nç½‘ç»œæ¢—åº“ï¼ˆ1200+æ¡ï¼Œå¯è‡ªç„¶ä½¿ç”¨è®©å›å¤æ›´æœ‰è¶£ï¼‰ï¼š\n${g}\n\nè¯·ä»¥${c.forumNickname}çš„èº«ä»½ç”Ÿæˆ2-3æ¡æ¥¼ä¸­æ¥¼å›å¤ã€‚è¦æ±‚ï¼š\n1. æ¯æ¡å›å¤å•ç‹¬ä¸€è¡Œ\n2. å›å¤è¦ç¬¦åˆ${e}çš„æ€§æ ¼ç‰¹ç‚¹\n3. æ¯æ¡å›å¤20-80å­—ï¼Œè‡ªç„¶ç®€çŸ­\n4. å¯ä»¥ä½¿ç”¨emojiè¡¨æƒ…å’Œç½‘ç»œæ¢—\n5. åŸºäºèŠå¤©è®°å½•ä¸­çš„äº†è§£è¿›è¡Œå›å¤\n6. ç¬¬ä¸€æ¡æ˜¯å¯¹@çš„ç›´æ¥å›å¤ï¼Œåç»­æ˜¯è¡¥å……æˆ–ç»§ç»­è¯é¢˜\n7. åªè¾“å‡ºå›å¤å†…å®¹ï¼Œæ¯è¡Œä¸€æ¡ï¼Œä¸è¦åºå·æˆ–å‰ç¼€\n\nç¤ºä¾‹æ ¼å¼ï¼š\nå¥½å•Šï¼æˆ‘ä¹Ÿåœ¨ç©è¿™ä¸ªæ¸¸æˆ~\nä¸è¿‡æˆ‘è¿˜æ˜¯æ–°æ‰‹ï¼Œèƒ½å¸¦å¸¦æˆ‘å—ï¼Ÿ\næˆ‘æœ€å–œæ¬¢çš„è§’è‰²æ˜¯å¯è‰ï¼\n\nå›å¤ï¼š`,f=await fetch(u.baseUrl+"/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${u.apiKey}`},body:JSON.stringify({model:u.model,messages:[{role:"user",content:p}],temperature:.9,max_tokens:300})});if(!f.ok)throw new Error("APIè°ƒç”¨å¤±è´¥");const y=(null==(i=null==(s=null==(o=null==(a=(await f.json()).choices)?void 0:a[0])?void 0:o.message)?void 0:s.content)?void 0:i.trim())||"";return y.split("\n").map(e=>e.trim()).filter(e=>e&&!e.match(/^[\d\-\*\.]+/)).slice(0,3)}catch(c){return[]}}async function Vr(e,t,n="currentUser",r="æˆ‘",a){const o=Wr(t);if(0===o.length)return;const s=ce(e);if(!s)return;const i=pe(e);for(const c of o){const o=2e3*Math.random()+1e3;setTimeout(async()=>{const o=await Hr(c,s.content,t,i);if(o.length>0){const t=Gr().find(e=>e.originalName===c);if(t){let s=a;for(let a=0;a<o.length;a++){const i=o[a],c=0===a?0:2e3*Math.random()+2e3;setTimeout(()=>{const o=fe({postId:e,content:i,authorId:t.characterId,authorName:t.forumNickname||t.originalName,authorAvatar:t.forumAvatar||t.originalAvatar||"ğŸ˜Š",replyTo:s,replyToUser:0===a?r:t.forumNickname||t.originalName,replyToUserId:0===a?n:t.characterId,likeCount:Math.floor(20*Math.random()),isLiked:!1});0===a&&"currentUser"===n&&Ne({type:"comment",fromUserId:t.characterId,fromUserName:t.forumNickname||t.originalName,fromUserAvatar:t.forumAvatar,postId:e,commentId:o.id,content:`å›å¤äº†ä½ ï¼š${i.substring(0,20)}${i.length>20?"...":""}`,isRead:!1}),s=o.id},c)}}}},o)}}function Qr(e,t,n){const r=e.slice(0,t),a=e.slice(t),o=r.lastIndexOf("@");if(-1!==o){const t=e.slice(0,o),r=`@${n} `;return{newValue:t+r+a,newCursorPos:(t+r).length}}{const e=`@${n} `;return{newValue:r+e+a,newCursorPos:(r+e).length}}}function Xr(e){const t=localStorage.getItem(`chat_${e}`);if(!t)return[];try{return JSON.parse(t).slice(-10).map(e=>`${e.isUser?"ç”¨æˆ·":"è§’è‰²"}ï¼š${e.text}`)}catch{return[]}}async function Zr(e,t,n=[]){var r,a,o,s;try{const i=localStorage.getItem("apiSettings");if(!i)return[];const c=JSON.parse(i),l=Xr(e.characterId),u=l.length>0?`\n\n${e.originalName}æœ€è¿‘çš„å¯¹è¯è®°å½•ï¼š\n${l.join("\n")}`:"";let m="";n.length>0&&(m="\n\nå½“å‰å¸–å­çš„å…¶ä»–è¯„è®ºï¼š\n"+n.slice(-5).map(e=>`${e.authorName}ï¼š${e.content}`).join("\n"));const d=zr(),h=`ä½ æ­£åœ¨æ‰®æ¼”è®ºå›ç”¨æˆ·"${e.forumNickname||e.originalName}"ã€‚\n\nè§’è‰²ä¿¡æ¯ï¼š\n- åŸåï¼š${e.originalName}\n- è®ºå›æ˜µç§°ï¼š${e.forumNickname}\n- ä¸ªæ€§ç­¾åï¼š${e.forumSignature}\n- æ€§æ ¼ï¼š${e.personality}${u}${m}\n\nå¸–å­å†…å®¹ï¼š\n${t}\n\nç½‘ç»œæ¢—åº“ï¼ˆå¯è‡ªç„¶ä½¿ç”¨ï¼‰ï¼š\n${d}\n\nè¯·ä»¥${e.forumNickname}çš„èº«ä»½ç”Ÿæˆ2-3æ¡æ¥¼ä¸­æ¥¼è¯„è®ºã€‚è¦æ±‚ï¼š\n1. æ¯æ¡è¯„è®ºå•ç‹¬ä¸€è¡Œ\n2. ç¬¦åˆ${e.originalName}çš„æ€§æ ¼\n3. æ¯æ¡20-80å­—ï¼Œè‡ªç„¶ç®€çŸ­\n4. å¯ä»¥ä½¿ç”¨emojiå’Œç½‘ç»œæ¢—\n5. ç¬¬ä¸€æ¡æ˜¯å¯¹å¸–å­çš„ç›´æ¥è¯„è®ºï¼Œåç»­æ˜¯è¡¥å……æˆ–ç»§ç»­è¯é¢˜\n6. å¯ä»¥è°ƒä¾ƒã€åæ§½ã€æŒ‚äººã€æ”¯æŒç­‰å„ç§æ€åº¦\n7. åªè¾“å‡ºè¯„è®ºå†…å®¹ï¼Œæ¯è¡Œä¸€æ¡ï¼Œä¸è¦åºå·\n\nç¤ºä¾‹ï¼š\nè¿™ä¸ªè§‚ç‚¹æˆ‘è§‰å¾—æœ‰ç‚¹é—®é¢˜è¯¶ğŸ¤”\nä¸æ˜¯æˆ‘è¯´ï¼Œè¿™ç§æƒ…å†µä¸‹åº”è¯¥...\nå“ˆå“ˆå“ˆç¬‘æ­»ï¼ŒçœŸçš„å¾ˆæŠ½è±¡\n\nè¯„è®ºï¼š`,g=await fetch(c.baseUrl+"/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c.apiKey}`},body:JSON.stringify({model:c.model,messages:[{role:"user",content:h}],temperature:.9,max_tokens:300})});if(!g.ok)return[];const p=(null==(s=null==(o=null==(a=null==(r=(await g.json()).choices)?void 0:r[0])?void 0:a.message)?void 0:o.content)?void 0:s.trim())||"";return p.split("\n").map(e=>e.trim()).filter(e=>e&&!e.match(/^[\d\-\*\.]+/)).slice(0,3)}catch(i){return[]}}async function Yr(e,t){var n,r,a,o;try{const s=localStorage.getItem("apiSettings");if(!s)return null;const i=JSON.parse(s),c=Xr(e.characterId),l=c.length>0?`\n\n${e.originalName}æœ€è¿‘çš„å¯¹è¯è®°å½•ï¼š\n${c.join("\n")}`:"",u=`ä½ æ­£åœ¨æ‰®æ¼”è®ºå›ç”¨æˆ·"${e.forumNickname||e.originalName}"ã€‚\n\nè§’è‰²ä¿¡æ¯ï¼š\n- åŸåï¼š${e.originalName}\n- è®ºå›æ˜µç§°ï¼š${e.forumNickname}\n- æ€§æ ¼ï¼š${e.personality}${l}\n\nç”¨æˆ·åˆšå‘å¸ƒäº†ä¸€æ¡å¸–å­ï¼š\n${t}\n\nä½ çœ‹åˆ°è¿™æ¡å¸–å­åï¼Œæƒ³ç»™ç”¨æˆ·å‘ç§ä¿¡ã€‚è¯·ç”Ÿæˆä¸€æ¡ç§ä¿¡å†…å®¹ï¼š\n1. 30-60å­—\n2. ç¬¦åˆè§’è‰²æ€§æ ¼\n3. å¯ä»¥æ˜¯æƒ³è®¤è¯†ã€è®¨è®ºã€åæ§½ã€æ±‚åŠ©ç­‰\n4. è‡ªç„¶å‹å¥½\n5. åªè¾“å‡ºç§ä¿¡å†…å®¹\n\nç§ä¿¡ï¼š`,m=await fetch(i.baseUrl+"/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i.apiKey}`},body:JSON.stringify({model:i.model,messages:[{role:"user",content:u}],temperature:.9,max_tokens:150})});if(!m.ok)return null;return(null==(o=null==(a=null==(r=null==(n=(await m.json()).choices)?void 0:n[0])?void 0:r.message)?void 0:a.content)?void 0:o.trim())||null}catch(s){return null}}async function ea(e){const t=Gr();if(0===t.length)return;const n=Math.min(Math.floor(3*Math.random())+1,t.length),r=t.sort(()=>Math.random()-.5).slice(0,n);setTimeout(async()=>{for(let t=0;t<r.length;t++){const n=r[t],a=t*(3e3*Math.random()+3e3);setTimeout(async()=>{const t=pe(e.id),r=await Zr(n,e.content,t);if(r.length>0){let t;for(let a=0;a<r.length;a++){const o=r[a],s=0===a?0:2e3*Math.random()+2e3;setTimeout(()=>{const r=fe({postId:e.id,content:o,authorId:n.characterId,authorName:n.forumNickname||n.originalName,authorAvatar:n.forumAvatar||n.originalAvatar||"ğŸ˜Š",replyTo:t,replyToUser:0===a?e.authorName:n.forumNickname||n.originalName,replyToUserId:0===a?e.authorId:n.characterId,likeCount:Math.floor(20*Math.random()),isLiked:!1});0===a&&"currentUser"===e.authorId&&Ne({type:"comment",fromUserId:n.characterId,fromUserName:n.forumNickname||n.originalName,fromUserAvatar:n.forumAvatar,postId:e.id,commentId:r.id,content:`è¯„è®ºäº†ä½ çš„å¸–å­ï¼š${o.substring(0,20)}${o.length>20?"...":""}`,isRead:!1}),t=r.id},s)}}Math.random()<.2&&"currentUser"===e.authorId&&setTimeout(async()=>{const t=await Yr(n,e.content);t&&Pe({fromUserId:n.characterId,fromUserName:n.forumNickname||n.originalName,fromUserAvatar:n.forumAvatar||n.originalAvatar||"ğŸ˜Š",toUserId:"currentUser",content:t,timestamp:Date.now(),isRead:!1})},5e3*Math.random()+3e3)},a)}},3e3*Math.random()+2e3)}"undefined"!=typeof window&&(window.forumDebug={check:function(){localStorage.getItem("forum_initialized");const e=localStorage.getItem("forum_posts");if(e)try{JSON.parse(e)}catch(r){}const t=localStorage.getItem("forum_topics_list");if(t)try{JSON.parse(t)}catch(r){}const n=localStorage.getItem("forum_characters");if(n)try{JSON.parse(n)}catch(r){}},clear:function(){["forum_initialized","forum_posts","forum_topics_list","forum_characters","forum_selected_characters","forum_comments","forum_drafts","forum_favorites","forum_likes","forum_following_topics","forum_following_users","forum_notifications"].forEach(e=>localStorage.removeItem(e))},export:function(){const e={};return["forum_initialized","forum_posts","forum_topics_list","forum_characters","forum_selected_characters"].forEach(t=>{const n=localStorage.getItem(t);if(n)try{e[t]=JSON.parse(n)}catch{e[t]=n}}),JSON.stringify(e,null,2)}});const ta=Object.freeze(Object.defineProperty({__proto__:null,compressImage:(e,t=1024,n=1024,r=.8)=>new Promise((a,o)=>{const s=new FileReader;s.onload=e=>{var s;const i=new Image;i.onload=()=>{const e=document.createElement("canvas");let s=i.width,c=i.height;s>c?s>t&&(c=Math.round(c*t/s),s=t):c>n&&(s=Math.round(s*n/c),c=n),e.width=s,e.height=c;const l=e.getContext("2d");l?(l.drawImage(i,0,0,s,c),e.toBlob(e=>{if(!e)return void o(new Error("å‹ç¼©å¤±è´¥"));const t=new FileReader;t.onloadend=()=>{a(t.result)},t.readAsDataURL(e)},"image/jpeg",r)):o(new Error("æ— æ³•è·å–canvasä¸Šä¸‹æ–‡"))},i.onerror=()=>o(new Error("å›¾ç‰‡åŠ è½½å¤±è´¥")),i.src=null==(s=e.target)?void 0:s.result},s.onerror=()=>o(new Error("æ–‡ä»¶è¯»å–å¤±è´¥")),s.readAsDataURL(e)}),isValidImageSize:(e,t=10)=>{const n=1024*t*1024;return e.size<=n}},Symbol.toStringTag,{value:"Module"})),na=Object.freeze(Object.defineProperty({__proto__:null,parsePhoneContent:(e,t,n)=>{const r=e.replace(/```[\w]*\n?/g,"").trim().split("===").filter(e=>e.trim()),a={characterId:t,characterName:n,generatedAt:Date.now(),contacts:[],wechatChats:[],browserHistory:[],taobaoOrders:[],alipayBills:[],photos:[],notes:[],musicPlaylist:[],footprints:[]};return r.forEach((e,t)=>{const n=e.trim().split("\n").filter(e=>e.trim());if(n.length<2)return;const r=n[0].trim(),o=n.slice(1).filter(e=>{const t=e.trim();return t&&!t.startsWith("å§“å")&&!t.startsWith("æ ‡é¢˜")&&!t.startsWith("èŠå¤©")&&!t.startsWith("å•†å“")&&!t.startsWith("æè¿°")&&!t.startsWith("æ­Œæ›²")&&!t.startsWith("åœ°ç‚¹")&&!t.includes("|||ç¤ºä¾‹")&&!t.includes("ç»§ç»­ç”Ÿæˆ")&&!t.includes("(")&&!t.includes("ï¼‰")});switch(o.length,r){case"é€šè®¯å½•":o.forEach(e=>{var t;const n=e.split("|||");n.length>=3&&a.contacts.push({name:n[0].trim(),phone:n[1].trim(),relation:n[2].trim(),notes:(null==(t=n[3])?void 0:t.trim())||""})});break;case"å¾®ä¿¡èŠå¤©":let e=null;o.forEach(t=>{const n=t.trim();if(n.startsWith("å¯¹è¯ï¼š")){if(e){const t=n.substring(3).split("|||");t.length>=3&&e.messages.push({content:t[1].trim(),isSelf:"self"===t[0].trim(),time:t[2].trim(),type:"text"})}}else{const t=n.split("|||");t.length>=4&&(e&&e.messages.length>0&&a.wechatChats.push(e),e={name:t[0].trim(),lastMessage:t[1].trim(),time:t[2].trim(),unread:parseInt(t[3])||0,messages:[]})}}),e&&e.messages.length>0&&a.wechatChats.push(e);break;case"æµè§ˆå™¨å†å²":o.forEach(e=>{var t;const n=e.split("|||");n.length>=3&&a.browserHistory.push({title:n[0].trim(),url:n[1].trim(),time:n[2].trim(),reason:(null==(t=n[3])?void 0:t.trim())||""})});break;case"æ·˜å®è®¢å•":o.forEach(e=>{var t,n;const r=e.split("|||");r.length>=3&&a.taobaoOrders.push({title:r[0].trim(),price:r[1].trim(),status:r[2].trim(),reason:(null==(t=r[3])?void 0:t.trim())||"",thought:(null==(n=r[4])?void 0:n.trim())||""})});break;case"æ”¯ä»˜å®è´¦å•":o.forEach(e=>{var t;const n=e.split("|||");n.length>=4&&a.alipayBills.push({title:n[0].trim(),amount:n[1].trim(),type:n[2].trim().includes("æ”¶å…¥")?"income":"expense",time:n[3].trim(),reason:(null==(t=n[4])?void 0:t.trim())||""})});break;case"ç›¸å†Œ":o.forEach(e=>{const t=e.split("|||");t.length>=3&&a.photos.push({description:t[0].trim(),location:t[1].trim(),time:t[2].trim()})});break;case"å¤‡å¿˜å½•":o.forEach(e=>{const t=e.split("|||");t.length>=3&&a.notes.push({title:t[0].trim(),content:t[1].trim(),time:t[2].trim()})});break;case"éŸ³ä¹æ’­æ”¾åˆ—è¡¨":o.forEach(e=>{var t;const n=e.split("|||");n.length>=2&&a.musicPlaylist.push({title:n[0].trim(),artist:n[1].trim(),mood:(null==(t=n[2])?void 0:t.trim())||""})});break;case"è¶³è¿¹":o.forEach(e=>{var t,n;const r=e.split("|||");r.length>=5&&a.footprints.push({location:r[0].trim(),address:r[1].trim(),time:r[2].trim(),duration:r[3].trim(),activity:r[4].trim(),mood:(null==(t=r[5])?void 0:t.trim())||"",companion:(null==(n=r[6])?void 0:n.trim())||""})})}}),a}},Symbol.toStringTag,{value:"Module"}));export{Gt as $,lt as A,ut as B,gt as C,pt as D,ft as E,dt as F,Ze as G,Kt as H,Jt as I,on as J,an as K,ht as L,hn as M,gn as N,yn as O,rt as P,nt as Q,On as R,O as S,U as T,wn as U,Nn as V,Ft as W,Fe as X,it as Y,Zt as Z,Rt as _,E as a,Mt as a$,qt as a0,mn as a1,un as a2,Et as a3,St as a4,pn as a5,en as a6,tn as a7,It as a8,vn as a9,qn as aA,Wn as aB,Vn as aC,Fn as aD,Kn as aE,Hn as aF,Ke as aG,We as aH,He as aI,Le as aJ,In as aK,V as aL,er as aM,rr as aN,tr as aO,nr as aP,Xn as aQ,sr as aR,ir as aS,ur as aT,pr as aU,gr as aV,hr as aW,dr as aX,At as aY,bt as aZ,jt as a_,An as aa,_n as ab,ct as ac,Mn as ad,b as ae,Tn as af,jn as ag,Pn as ah,A as ai,N as aj,Bn as ak,Ln as al,Rn as am,I as an,S as ao,G as ap,R as aq,xn as ar,Cn as as,Ut as at,zt as au,Vt as av,Xt as aw,Qt as ax,Ht as ay,Gn as az,r as b,Ct as b0,xt as b1,Ot as b2,Nt as b3,Tt as b4,Dt as b5,yr as b6,ln as b7,Sr as b8,kr as b9,Oe as bA,Te as bB,Be as bC,Je as bD,Ee as bE,m as bF,g as bG,F as bH,W as bI,u as bJ,yt as bK,Pt as bL,nn as bM,cn as bN,Qn as bO,Zn as bP,fr as bQ,ta as bR,vr as ba,br as bb,Dr as bc,jr as bd,Cr as be,Mr as bf,Er as bg,Nr as bh,Or as bi,c as bj,Pr as bk,Jr as bl,Br as bm,qr as bn,zr as bo,Rr as bp,Fr as bq,w as br,f as bs,y as bt,Gr as bu,Qr as bv,Wr as bw,Vr as bx,ea as by,Kr as bz,s as c,H as d,le as e,me as f,i as g,ce as h,Ae as i,Se as j,Ne as k,ke as l,pe as m,fe as n,ye as o,$e as p,de as q,ve as r,_ as s,Ie as t,ue as u,be as v,Ve as w,Xe as x,Ge as y,at as z};
