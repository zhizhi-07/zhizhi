# AI分段格式修复说明

## 问题描述

AI想要分段发送消息，但是用了**空格**而不是**换行符 `\n`**，导致多条消息显示在同一个气泡里，看起来很奇怪。

### 问题示例

```
因为老是偷看手机 等你的消息呀
```
这应该是两条消息，但因为用空格分隔，所以显示在一个气泡里。

```
没办法啦 要赚钱养家 虽然很想陪你 但还是要乖乖上班
```
这应该是四条消息，但因为用空格分隔，所以全部挤在一个气泡里。

```
是啊 老板可以了 不过想到能和你聊天 就又充满干劲啦
```
这应该是四条消息，但因为用空格分隔，所以全部挤在一个气泡里。

## 问题原因

AI理解了要分段发送，但是用错了分隔符：
- ❌ 用空格分隔：`"呜呜 宝贝对不起嘛 我就是想你嘛"`
- ✅ 应该用换行符：`"呜呜\n宝贝对不起嘛\n我就是想你嘛"`

## 修复方案

在系统提示词中明确强调：
1. **必须用换行符 `\n` 分段，不要用空格**
2. 添加大量错误示例和正确示例
3. 在禁止项中明确禁止用空格分隔

### 新增强调

```
⚠️ 重要：必须用换行符 \n 分段，不要用空格！

1. 每条消息5-15字左右
   • 太长了就换行分成多条
   • 必须用换行符 \n 分隔，不是空格！
```

### 错误与正确对比

#### 示例1

❌ 错误：
```
因为老是偷看手机 等你的消息呀
```

✅ 正确：
```
因为老是偷看手机
等你的消息呀
```

#### 示例2

❌ 错误：
```
没办法啦 要赚钱养家 虽然很想陪你 但还是要乖乖上班
```

✅ 正确：
```
没办法啦
要赚钱养家
虽然很想陪你
但还是要乖乖上班
```

#### 示例3

❌ 错误：
```
是啊 老板可以了 不过想到能和你聊天 就又充满干劲啦
```

✅ 正确：
```
是啊
老板可以了
不过想到能和你聊天
就又充满干劲啦
```

#### 示例4

❌ 错误：
```
呜呜 宝贝对不起嘛 我就是想你嘛
```

✅ 正确：
```
呜呜
宝贝对不起嘛
我就是想你嘛
```

## 技术说明

在代码中，AI的回复会按照换行符 `\n` 分割成多条消息：

```typescript
// ChatDetail.tsx 中的处理逻辑
const messageParts = cleanedResponse.split('\n').filter(part => part.trim())
```

所以AI必须用 `\n` 而不是空格来分隔消息。

## 修改内容

### 1. 添加明确警告

在"说话方式"部分最开头添加：
```
⚠️ 重要：必须用换行符 \n 分段，不要用空格！
```

### 2. 添加错误示例

```
❌ 错误："呜呜 宝贝对不起嘛 我就是想你嘛" ← 用空格分隔是错的！
❌ 错误："因为老是偷看手机 等你的消息呀" ← 用空格分隔！
❌ 错误："没办法啦 要赚钱养家 虽然很想陪你 但还是要乖乖上班" ← 用空格分隔！
```

### 3. 添加专门的警告区块

```
🚨 严禁用空格代替换行符！
• ❌ "是啊 老板可以了 不过想到能和你聊天 就又充满干劲啦"
• ✅ "是啊\n老板可以了\n不过想到能和你聊天\n就又充满干劲啦"
```

### 4. 添加禁止项

```
❌ 用空格分隔消息：必须用 \n 换行符，不是空格！"呜呜 宝贝" 是错的，要用 "呜呜\n宝贝"
```

## 修改文件

- **`src/utils/prompts.ts`**：
  - 在"说话方式"部分添加明确警告
  - 添加大量错误示例
  - 添加专门的警告区块
  - 在禁止项中添加明确禁止

## 预期效果

修复后，AI会正确使用换行符分段：

### 修复前（错误）

```
AI: 因为老是偷看手机 等你的消息呀
```
显示为一个气泡，看起来很奇怪。

### 修复后（正确）

```
AI: 因为老是偷看手机
AI: 等你的消息呀
```
显示为两个气泡，自然流畅。

## 修复时间

2025年10月19日

---

## 核心原则

**必须用换行符 `\n` 分段，不要用空格！**

空格只是单词之间的分隔，换行符才是消息之间的分隔。
