# 修复 404 问题

## 问题原因

Google API 调用返回 404，是因为 URL 路径不正确。

---

## 已修复的内容

### 1. 修改了 `src/utils/api.ts`
- ✅ 自动识别反代地址
- ✅ 反代使用完整路径：`/v1beta/models/gemini-pro:generateContent`
- ✅ 官方 API 使用带 key 参数的路径

### 2. 修改了 `src/context/ApiContext.tsx`
- ✅ 使用 `gemini-pro` 模型（更稳定）

---

## 测试步骤

### 方法 1：使用测试页面（推荐）

1. 打开桌面上的 `test-proxy.html` 文件
2. 用浏览器打开
3. 点击 "测试 API 调用" 按钮
4. 查看结果

**如果成功：**
- 会显示 ✅ API 调用成功
- 会显示 AI 的回复内容

**如果失败：**
- 会显示错误信息
- 截图发给我

### 方法 2：直接测试反代

在浏览器打开：
```
https://zhizhi.2373922440jhj.workers.dev/health
```

应该看到：
```json
{
  "status": "ok",
  "service": "Gemini API Proxy",
  "totalKeys": 10,
  ...
}
```

### 方法 3：重启项目测试

```bash
# 停止项目（Ctrl+C）
# 重新启动
npm run dev
```

然后在项目里发送消息测试。

---

## 如果还是 404

### 检查清单

1. **清除浏览器缓存**
   - 按 F12 打开开发者工具
   - 右键点击刷新按钮
   - 选择 "清空缓存并硬性重新加载"

2. **检查反代是否正常**
   - 访问：`https://zhizhi.2373922440jhj.workers.dev/health`
   - 应该返回 JSON 数据

3. **检查请求 URL**
   - 打开浏览器 F12
   - 切换到 Network 标签
   - 发送消息
   - 查看请求的完整 URL
   - 截图发给我

4. **检查模型名称**
   - 在项目设置中
   - 确认模型是 `gemini-pro` 或 `gemini-1.5-flash`
   - 不要有 `models/` 前缀

---

## 正确的 URL 格式

### 反代 URL（你的）
```
https://zhizhi.2373922440jhj.workers.dev/v1beta/models/gemini-pro:generateContent
```

### 官方 API URL（对比）
```
https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=YOUR_KEY
```

---

## 下一步

1. **先用测试页面验证反代是否正常**
   - 打开 `test-proxy.html`
   - 点击测试按钮

2. **如果测试页面成功，但项目还是失败**
   - 清除浏览器缓存
   - 重启项目
   - 截图错误信息发给我

3. **如果测试页面也失败**
   - 截图错误信息
   - 检查 Cloudflare Workers 是否正常部署

---

## 快速验证命令

### PowerShell 测试
```powershell
# 测试健康检查
curl https://zhizhi.2373922440jhj.workers.dev/health

# 测试 API 调用
$body = @{
    contents = @(
        @{
            parts = @(
                @{ text = "你好" }
            )
        }
    )
} | ConvertTo-Json -Depth 10

curl -Method POST `
  -Uri "https://zhizhi.2373922440jhj.workers.dev/v1beta/models/gemini-pro:generateContent" `
  -Headers @{"Content-Type"="application/json"} `
  -Body $body
```

---

**现在去测试吧！用 `test-proxy.html` 文件，告诉我结果！**
