# 📚 梗库更新说明

## 🎯 统一梗库架构

所有模块（小程序和论坛）都使用同一个梗库源：

```
src/utils/memesRetrieval.ts  ← 内置梗库（1200+条）
         ↓
src/utils/memeManager.ts      ← 统一管理器
         ↓
    ┌────┴────┐
    ↓         ↓
小程序      论坛
```

## ✅ 更新方式

### 方法1：更新内置梗库（推荐）

**文件位置**：`src/utils/memesRetrieval.ts`

**操作步骤**：
1. 打开 `memesRetrieval.ts`
2. 在 `memesData` 数组中添加/修改梗
3. 保存文件

**示例**：
```typescript
export const memesData: Meme[] = [
  // 现有的梗...
  
  // 添加新梗
  {
    id: 1234,
    '梗': "新梗名称",
    '含义': "梗的含义和用法说明",
    keywords: ["关键词1", "关键词2"]
  }
]
```

**效果**：
- ✅ 小程序梗库立即更新
- ✅ 论坛AI回复立即更新
- ✅ 论坛初始化内容立即更新
- ✅ 所有@角色互动立即更新

### 方法2：用户自定义梗

**添加位置**：小程序梗库页面

**操作步骤**：
1. 打开小程序 → 梗库
2. 点击"添加自定义梗"
3. 填写梗名称、含义、关键词
4. 保存

**存储位置**：`localStorage.custom_memes`

**效果**：
- ✅ 自定义梗立即生效
- ✅ 与内置梗一起使用
- ✅ 论坛和小程序同步

## 📊 梗库统计

查看当前梗库状态：

```typescript
import { getMemeStats } from './utils/memeManager'

const stats = getMemeStats()
// {
//   total: 1256,    // 总计
//   builtin: 1200,  // 内置
//   custom: 56      // 自定义
// }
```

## 🔧 API使用

### 获取所有梗（内置+自定义）

```typescript
import { getAllMemes } from './utils/memeManager'

const allMemes = getAllMemes()
// 返回: Meme[]
```

### 获取AI用的梗库文本

```typescript
import { getMemesForAI } from './utils/memeManager'

const memesText = getMemesForAI()
// 返回: 格式化的字符串
// "yyds": 永远的神
// "破防了": 心理防线被攻破
// ...
```

### 添加自定义梗

```typescript
import { addCustomMeme } from './utils/memeManager'

addCustomMeme({
  '梗': '新梗',
  '含义': '含义说明',
  keywords: ['关键词']
})
```

### 删除自定义梗

```typescript
import { deleteCustomMeme } from './utils/memeManager'

deleteCustomMeme(10001) // 自定义梗的ID从10000开始
```

## 🎮 使用场景

### 论坛初始化

```typescript
// src/pages/ForumInitialize.tsx
import { getMemesForAI } from '../utils/memeManager'

const allMemes = getMemesForAI()
// 注入到AI prompt中
```

### @角色回复

```typescript
// src/utils/forumAIReply.ts
import { getMemesForAI } from './memeManager'

const allMemes = getMemesForAI()
// AI回复时可使用所有梗
```

### 自动互动

```typescript
// src/utils/forumAutoReply.ts
import { getMemesForAI } from './memeManager'

const allMemes = getMemesForAI()
// 发帖后角色评论可使用所有梗
```

### 小程序梗库

```typescript
// src/pages/MemesLibrary.tsx
import { getAllMemes } from '../utils/memeManager'

const allMemes = getAllMemes()
// 显示所有梗（内置+自定义）
```

## 💡 最佳实践

1. **内置梗更新**：
   - 适合批量添加常用梗
   - 需要重新部署应用
   - 所有用户同步获得

2. **自定义梗**：
   - 适合用户个性化需求
   - 无需重新部署
   - 仅当前用户可用

3. **ID分配**：
   - 内置梗：1-9999
   - 自定义梗：10000+

4. **keywords优化**：
   - 添加多个相关关键词
   - 便于搜索和匹配

## 🔄 同步机制

```
更新 memesRetrieval.ts
      ↓
重启应用/热更新
      ↓
  ┌───┴───┐
  ↓       ↓
小程序   论坛
  ↓       ↓
自动同步使用
```

## ⚠️ 注意事项

1. **ID唯一性**：确保每个梗的ID唯一
2. **字段完整**：`梗`、`含义`、`keywords`都要填写
3. **存储限制**：localStorage有大小限制（约5MB）
4. **性能考虑**：梗库过大可能影响加载速度

## 📝 更新日志示例

### v1.1.0 (2025-01-01)
- 新增100条2024年度热梗
- 优化梗的含义说明
- 添加更多关键词

### v1.0.0 (2024-12-01)
- 初始化1200+条梗库
- 实现统一管理系统
- 支持自定义梗
