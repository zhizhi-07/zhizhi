# AI分段过度问题修复说明

## 问题描述

AI把每句话都拆得太短，导致对话很不自然。

### 问题示例

```
AI: 嗯嗯
AI: 我在呢
AI: 你今天
AI: 出去玩了吗
AI: 看到你发的朋友圈了
```

这样拆分太碎了，真人不会这样说话。

## 问题原因

之前的规则说"每条消息5-15字左右"，AI理解得太死板，把每个短句都拆开了。

实际上：
- "嗯嗯我在呢" 只有5个字，不需要拆
- "你今天出去玩了吗" 只有8个字，不需要拆

## 修复方案

调整分段规则，从"强制分段"改为"自然分段"：

### 新的分段原则

1. **一个完整的意思可以是一条消息**
   - 不要强制把每句话都拆开
   - 短句可以合并在一起

2. **什么时候才需要分段？**
   - 一句话太长（超过20-30字）→ 分段
   - 换话题 → 分段
   - 表达不同情绪 → 分段
   - 短句（10字以内）→ **不用分段**

3. **自然分段的标准**
   - 像真人打字一样
   - 不要太碎，也不要太长
   - 一条消息10-20字左右最自然

## 对比示例

### 示例1：日常问候

❌ 太碎了（修复前）：
```
嗯嗯
我在呢
你今天
出去玩了吗
```

✅ 自然（修复后）：
```
嗯嗯我在呢
你今天出去玩了吗
```

### 示例2：解释原因

❌ 太碎了：
```
因为
老是偷看手机
等你的消息呀
```

✅ 自然：
```
因为老是偷看手机
等你的消息呀
```

### 示例3：长句适当分段

❌ 太长了（一大段）：
```
没办法啦要赚钱养家虽然很想陪你但还是要乖乖上班不过想到能和你聊天就又充满干劲啦
```

✅ 自然（适当分段）：
```
没办法啦要赚钱养家
虽然很想陪你
但还是要乖乖上班
不过想到能和你聊天
就又充满干劲啦
```

### 示例4：短句不拆

❌ 太碎了：
```
好啊
没问题
```

✅ 自然：
```
好啊没问题
```

或者：
```
好啊
```
（如果只想回复一个"好啊"）

## 分段判断标准

| 长度 | 是否分段 | 示例 |
|------|---------|------|
| 5字以内 | 不分段 | "嗯嗯我在" |
| 6-15字 | 不分段 | "你今天出去玩了吗" |
| 16-30字 | 看情况 | 如果是一个完整意思，不分段 |
| 30字以上 | 必须分段 | 拆成2-3条 |

## 核心原则

### ✅ 正确理解
- 分段是为了**自然**，不是为了**短**
- 真人打字会一次发一个完整的意思
- 不要机械地按字数拆分

### ❌ 错误理解
- ~~每句话都要拆开~~
- ~~每条消息必须5-15字~~
- ~~越短越好~~

## 修改内容

### 1. 标题改变
从"必须分段发送"改为"自然分段"

### 2. 原则调整
- 强调"一个完整的意思可以是一条消息"
- 强调"不要强制把每句话都拆开"
- 强调"短句可以合并在一起"

### 3. 添加判断标准
- 太长（超过20-30字）→ 分段
- 换话题 → 分段
- 表达不同情绪 → 分段
- 短句（10字以内）→ **不用分段**

### 4. 添加对比示例
展示"太碎了"和"自然"的对比

## 修改文件

- **`src/utils/prompts.ts`**：调整分段规则，从强制分段改为自然分段

## 预期效果

### 修复前
```
AI: 嗯嗯
AI: 我在呢
AI: 你今天
AI: 出去玩了吗
AI: 看到你发的朋友圈了
```
太碎了，不自然。

### 修复后
```
AI: 嗯嗯我在呢
AI: 你今天出去玩了吗
AI: 看到你发的朋友圈了
```
自然流畅。

## 修复时间

2025年10月19日

---

## 总结

**不要死板地按字数拆分，要像真人一样自然分段。**

短句可以合并，长句才需要拆分。一个完整的意思就是一条消息。
