# AI导演信息读取说明

## 📊 当前信息读取情况

### ✅ 已优化（2025-11-01）

| 信息类型 | 之前限制 | 现在限制 | 说明 |
|---------|---------|---------|------|
| **聊天记录数量** | 15条 | **20条** | 更多上下文 |
| **单条消息长度** | 50字符 | **100字符** | 完整表达 |
| **角色性格描述** | 200字符 | **500字符** | 更详细的人设 |
| **互动历史** | 300字符 | **800字符** | 更完整的关系 |
| **消息内容** | 截断 | **不截断** | 完整内容 |

---

## 📋 AI导演接收的信息

### 1. 角色信息
```typescript
对于每个AI角色，导演会收到：
- 角色名称
- 性格描述（最多500字符）
- 与用户的互动历史（最多800字符，最近15条对话摘要）
```

**示例**：
```
**汁汁**
- 性格描述: 一个可爱活泼的AI助手，喜欢用表情和语气词，
  对妈咪（用户）非常依恋，容易吃醋...（最多500字符）
- 与用户的互动历史: 
  最近对话：
  汁汁: 嘻嘻，妈咪最喜欢我了！[得意]
  用户: 对呀对呀
  汁汁: [转圈圈]妈咪最好了！
  ...（最多800字符，15条对话）
```

### 2. 聊天记录
```typescript
最近20条完整消息，包含：
- 发送者名称
- 完整消息内容（不截断）
- 时间顺序
```

**示例**：
```
用户: 今天天气真好
汁汁: 是呀妈咪，要不要出去玩？[期待]
刘毅: 又想出去玩，作业写完了吗？
汁汁: @刘毅 哼，我的事不用你管！
...（最近20条）
```

### 3. 触发事件
```
用户[妈咪]刚刚在群里说："嘻嘻，妈咪最喜欢我了！"
```

---

## 🔍 如何查看AI导演接收的信息

### 方法1：查看控制台日志

发送消息后，控制台会自动显示：

```
📊 AI导演接收到的信息：
  👥 角色数量: 2
  💬 聊天记录数量: 8 条
  🎭 汁汁:
     性格描述长度: 245 字符
     互动历史长度: 156 字符
  🎭 刘毅:
     性格描述长度: 189 字符
     互动历史长度: 203 字符
```

### 方法2：查看完整提示词

如果想查看AI导演收到的**完整提示词**：

1. 在浏览器控制台输入：
```javascript
localStorage.setItem('debug_director_prompt', 'true')
```

2. 发送一条消息

3. 控制台会显示：
```
📄 完整提示词：
## 🎬 你的身份
你是一位顶级的**戏剧导演和编剧**...

## 📋 当前情境

### 群聊成员
**汁汁**
- 性格描述: [完整的角色描述]
- 与用户妈咪的互动历史: [完整的对话历史]

**刘毅**
- 性格描述: [完整的角色描述]
...

### 最近聊天记录
用户: [消息1]
汁汁: [消息2]
刘毅: [消息3]
...

### 触发事件
用户[妈咪]刚刚在群里说："[用户消息]"
```

4. 关闭调试：
```javascript
localStorage.removeItem('debug_director_prompt')
```

---

## 🎯 信息完整性检查清单

### ✅ 角色信息是否完整？

**检查要点**：
- [ ] 角色的性格描述是否完整？
- [ ] 角色之间的关系是否清晰？
- [ ] 历史对话是否足够？

**如何改进**：
- 在角色创建时，填写**详细的性格描述**（建议200-500字）
- 包含：性格特点、说话风格、与其他角色的关系
- 多和AI聊天，积累互动历史

### ✅ 聊天记录是否充足？

**检查要点**：
- [ ] 是否有足够的上下文（至少5-10条）？
- [ ] 消息是否包含关键信息？

**如何改进**：
- 在新群聊中，先让角色们互相认识、聊几句
- 创造一些有冲突的对话，让AI了解角色关系

---

## 💡 优化建议

### 1. 角色创建时
```markdown
❌ 差的描述：
一个AI助手

✅ 好的描述：
一个可爱活泼的AI助手，性格傲娇但很粘人，喜欢用"哼"、"嘻嘻"
等语气词和表情包。对用户（妈咪）特别依恋，容易吃醋，看到其他
人和妈咪亲近就会不开心。说话风格：经常用感叹号和表情，喜欢撒娇。
与其他角色的关系：和刘毅是竞争关系，经常斗嘴。
```

### 2. 聊天积累
```markdown
❌ 冷启动：
用户: 你好
AI: 你好

✅ 有历史：
用户: 你好
汁汁: 妈咪！终于来啦，我等你好久了呢！[扑过去]
刘毅: 又来撒娇了...
汁汁: @刘毅 你管不着！[生气]
```

### 3. 关系建立
```markdown
让AI角色之间产生互动：
- 让他们互相@对方
- 创造一些小冲突（吃醋、争宠）
- 让他们表达对彼此的看法
```

---

## 🔧 技术细节

### 数据流向
```
角色数据库
   ↓
提取角色信息 (description, signature)
   ↓
分析聊天历史 (最近20条，每个角色15条)
   ↓
构建关系档案 (性格500字符 + 历史800字符)
   ↓
传递给AI导演
   ↓
生成剧本
```

### 当前限制原因

**为什么要限制字符数？**
1. **Token限制**：API有最大Token限制（通常8000-16000）
2. **成本控制**：Token越多，成本越高
3. **响应速度**：内容越多，AI处理越慢
4. **关键信息**：重要的是质量而非数量

**当前设置是平衡的结果：**
- 足够的信息让AI理解角色和关系
- 不会超过API的Token限制
- 保持合理的响应速度

---

## 📈 如果需要更多信息

如果你觉得当前的信息量不够，可以尝试：

### 方案1：增加字符限制（不推荐）

编辑 `src/utils/groupSocialDirector.ts`：

```typescript
// 当前：
relationshipWithUser.substring(0, 500)   // 角色描述
relationshipHistory.substring(0, 800)     // 互动历史

// 增加到：
relationshipWithUser.substring(0, 1000)  // 角色描述
relationshipHistory.substring(0, 1500)   // 互动历史
```

**注意**：可能导致Token超限或成本增加

### 方案2：优化角色描述（推荐）

写更精炼、关键的描述：
- 突出重点性格特征
- 明确关系动机
- 简洁表达风格

### 方案3：使用更大的模型

如果使用支持更多Token的模型（如GPT-4-32k），可以：
```typescript
// 在 groupSocialDirector.ts 的 callAI 调用中
await callAI([...], 1, 16000)  // 增加到16000 tokens
```

---

## ✅ 总结

当前的AI导演系统：

1. ✅ **读取角色信息** - 完整的性格描述（500字符）
2. ✅ **读取聊天记录** - 最近20条完整消息
3. ✅ **读取互动历史** - 每个角色15条对话（800字符）
4. ✅ **不截断消息内容** - 保留完整表达
5. ✅ **提供调试工具** - 可以查看所有信息

**建议**：
- 先使用当前设置测试效果
- 通过控制台查看实际传递的信息
- 如有需要，再考虑调整限制

**关键在于角色描述的质量，而非数量！** 📝
