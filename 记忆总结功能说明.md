# 📝 记忆总结功能

## 🎯 功能介绍

**记忆总结**是一个手动触发的功能，让 AI 分析你们的对话历史，生成一份关于你的信息总结。

### 与自动记忆提取的区别

| 功能 | 自动记忆提取 | 记忆总结 |
|------|------------|---------|
| **触发方式** | 自动（每 30 轮对话） | 手动点击按钮 |
| **分析范围** | 最近 30 轮对话 | 最近 100 条消息 |
| **输出格式** | 结构化数据（JSON） | 可读的文字总结 |
| **用途** | 供 AI 回忆使用 | 供用户查看 |
| **API 调用** | 定期自动调用 | 用户主动调用 |

---

## 📍 入口位置

### 聊天设置页面

```
聊天详情 → 右上角 ⋯ → 聊天设置 → AI 记忆 → 记忆总结
```

或者：

```
聊天列表 → 长按聊天 → 聊天设置 → AI 记忆 → 记忆总结
```

---

## 🎨 界面设计

### 入口按钮（ChatSettings.tsx）

```
┌─────────────────────────────────┐
│ AI 记忆                          │
├─────────────────────────────────┤
│ 💭 查看记忆                      │
│    查看 AI 记住的关于你的信息     │
├─────────────────────────────────┤
│ 📝 记忆总结                      │
│    AI 总结当前对话的重要信息      │
└─────────────────────────────────┘
```

### 总结页面（MemorySummary.tsx）

**初始状态**：
```
┌─────────────────────────────────┐
│         📝                       │
│                                  │
│     AI 记忆总结                   │
│                                  │
│  让 AI 分析你们的对话，           │
│  总结出关于你的重要信息            │
│                                  │
│  ┌─────────────────┐             │
│  │ 生成记忆总结     │             │
│  └─────────────────┘             │
└─────────────────────────────────┘
```

**生成后**：
```
┌─────────────────────────────────┐
│ 📌 基本信息                      │
│ • 用户名字是小明                  │
│ • 用户25岁                       │
│ • 用户在北京工作                  │
│                                  │
│ ❤️ 偏好喜好                      │
│ • 用户不喜欢吃榴莲                │
│ • 用户喜欢打篮球                  │
│                                  │
│ 📅 重要事件                      │
│ • 用户和对象分手了                │
│                                  │
│ ⏰ 作息习惯                      │
│ • 用户每天早上7点上班              │
│                                  │
│ ┌─────────────────┐             │
│ │ 重新生成总结     │             │
│ └─────────────────┘             │
│                                  │
│ 💡 提示：总结基于最近 100 条      │
│    对话生成，只包含你明确说过     │
│    的信息。                       │
└─────────────────────────────────┘
```

---

## 🔧 技术实现

### 工作流程

```
1. 用户点击"生成记忆总结"
   ↓
2. 从 localStorage 读取聊天记录
   ↓
3. 提取最近 100 条有效对话
   ↓
4. 构建对话历史文本
   ↓
5. 调用 AI 分析并生成总结
   ↓
6. 显示总结结果
```

### 提示词设计

```typescript
const prompt = `你是一个记忆总结助手。请分析以下对话，总结出用户的重要信息。

对话历史（最近 ${recentMessages.length} 条消息）：
${conversationHistory}

请按以下格式总结：

## 📌 基本信息
（用户的姓名、年龄、职业、学校、居住地等基本信息）

## ❤️ 偏好喜好
（用户喜欢/不喜欢的东西、兴趣爱好、愿望等）

## 📅 重要事件
（用户提到的重要事件，如分手、毕业、入职等）

## 😊 情绪状态
（用户最近的情绪状态）

## 🤝 关系互动
（用户和 AI 的关系变化、重要互动）

## ⏰ 作息习惯
（用户的作息时间、日常习惯）

⚠️ 重要原则：
- 只总结用户明确说过的信息
- 不要推测、想象、编造
- 如果某个类别没有信息，写"暂无相关信息"
- 简洁明了，每条信息一行

请用 Markdown 格式输出总结。`
```

---

## 📊 总结格式

### 六大类别

#### 1. 📌 基本信息
- 姓名、年龄、职业、学校
- 居住地、家庭成员
- 其他基本个人信息

**示例**：
```
## 📌 基本信息
• 用户名字是小明
• 用户25岁
• 用户在北京工作
• 用户住在朝阳区
```

#### 2. ❤️ 偏好喜好
- 喜欢/不喜欢的东西
- 兴趣爱好
- 愿望、梦想

**示例**：
```
## ❤️ 偏好喜好
• 用户不喜欢吃榴莲
• 用户喜欢打篮球
• 用户想去日本旅游
```

#### 3. 📅 重要事件
- 重大生活事件
- 最近发生的事
- 计划要做的事

**示例**：
```
## 📅 重要事件
• 用户和对象分手了
• 用户今年刚毕业
• 用户准备换工作
```

#### 4. 😊 情绪状态
- 最近的情绪
- 心情变化

**示例**：
```
## 😊 情绪状态
• 用户最近心情不太好
• 用户对工作感到压力大
```

#### 5. 🤝 关系互动
- 用户和 AI 的关系
- 重要互动

**示例**：
```
## 🤝 关系互动
• 用户表达了深刻的感谢
• 用户希望成为好朋友
```

#### 6. ⏰ 作息习惯
- 作息时间
- 日常习惯

**示例**：
```
## ⏰ 作息习惯
• 用户每天早上7点上班
• 用户晚上11点睡觉
```

---

## 💡 使用场景

### 1. 检查记忆准确性
定期生成总结，查看 AI 是否正确记住了你的信息。

### 2. 发现遗漏信息
如果某些重要信息没有被总结，说明 AI 可能没有记住。

### 3. 了解对话重点
快速了解你们聊天的主要内容和重点。

### 4. 纠正错误信息
如果总结中有错误，可以在对话中明确纠正。

---

## 🎯 优势

### 1. 手动触发
- ✅ 不增加自动 API 调用
- ✅ 用户自主决定何时生成
- ✅ 按需使用，节省成本

### 2. 全面分析
- ✅ 分析最近 100 条消息
- ✅ 比自动提取更全面
- ✅ 提供可读的文字总结

### 3. 可重复生成
- ✅ 可以随时重新生成
- ✅ 对话越多，总结越准确
- ✅ 实时反映最新对话内容

---

## 📝 使用建议

### 1. 定期生成
建议每聊 50-100 条消息后生成一次总结，检查记忆是否准确。

### 2. 对比记忆查看器
- **记忆总结**：AI 自动分类整理的总结
- **记忆查看器**：手动记录的结构化记忆

两者结合使用，效果更好。

### 3. 发现问题及时纠正
如果总结中有错误或遗漏，在对话中明确告诉 AI 正确的信息。

---

## 🔄 与自动记忆的关系

### 互补关系

**自动记忆提取**：
- 每 30 轮对话自动提取
- 结构化存储
- 供 AI 回忆使用

**记忆总结**：
- 用户手动触发
- 文字总结
- 供用户查看

### 配合使用

1. **自动记忆**持续在后台工作，记录重要信息
2. **记忆总结**定期生成，检查记忆准确性
3. 发现问题后，在对话中纠正
4. 自动记忆会更新为正确信息

---

## 🎊 总结

### ✅ 功能完成

1. ✅ 添加了"记忆总结"入口
2. ✅ 创建了总结页面
3. ✅ 实现了 AI 分析功能
4. ✅ 支持重新生成总结

### 🎯 使用方法

1. 进入聊天设置
2. 点击"记忆总结"
3. 点击"生成记忆总结"
4. 查看 AI 生成的总结
5. 如需更新，点击"重新生成"

### 💰 成本控制

- 手动触发，不自动调用 API
- 用户自主决定何时生成
- 按需使用，节省成本

---

**功能状态**: ✅ 已完成  
**入口位置**: 聊天设置 → AI 记忆 → 记忆总结  
**分析范围**: 最近 100 条消息

🎉 **现在可以让 AI 总结你们的对话了！** 🎉
