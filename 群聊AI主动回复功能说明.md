# 群聊AI主动回复功能说明

## ✨ 新增功能

在群聊中添加了**AI主动发消息按钮**（纸飞机按钮），与单聊功能保持一致。

## 🎯 功能特点

### 智能按钮切换
- **有输入内容**：显示绿色发送按钮 ✅
- **无输入内容**：显示灰色纸飞机按钮 ✈️

### 使用场景

#### 场景1：空群聊（刚创建）
```
用户点击纸飞机
  ↓
AI们收到提示："这是群聊刚创建，AI们可以主动打招呼、介绍自己"
  ↓
AI们依次打招呼
```

**示例对话**：
```
[汁汁] 妈咪好呀~新群聊建好啦！人家是汁汁，很高兴认识大家~
[小明] 哈哈大家好！我是小明，喜欢开玩笑，多多关照！
[小红] 大家好呀，我是小红，希望我们能成为好朋友~
```

#### 场景2：有对话历史
```
用户点击纸飞机
  ↓
AI们收到提示："用户希望AI们主动聊聊天，可以聊最近的话题或者发起新话题"
  ↓
AI们根据上下文主动发起话题
```

**示例对话**：
```
最近对话：
用户: 今天天气真好
汁汁: 是呀主人~
小明: 确实不错

[用户点击纸飞机]

[汁汁] 妈咪~天气这么好，我们要不要出去玩呀？
[小明] 好主意！@小红 你有什么推荐的地方吗？
[小红] 公园怎么样？可以散步聊天，很惬意的
```

## 🎨 交互体验

### 按钮状态
| 状态 | 外观 | 功能 |
|------|------|------|
| 有输入 | 🟢 绿色圆形按钮 | 发送消息 |
| 无输入 | ⚪ 灰色纸飞机 | AI主动说话 |
| AI输入中 | 🔒 禁用状态 | 等待AI回复 |

### 键盘操作
- **有输入 + 回车**：发送消息
- **无输入 + 回车**：触发AI主动说话
- **AI输入中**：回车无效

## 🔧 技术实现

### 核心逻辑
```typescript
// 智能切换按钮
{inputValue.trim() ? (
  // 有输入：显示发送按钮
  <button onClick={handleSend}>
    <SendIcon />
  </button>
) : (
  // 无输入：显示AI主动回复按钮
  <button onClick={handleAIReply}>
    <SendIcon />
  </button>
)}
```

### AI主动回复流程
```typescript
const handleAIReply = async () => {
  // 1. 判断是否为空群聊
  const isEmptyChat = messages.length === 0
  
  // 2. 生成提示内容
  const promptHint = isEmptyChat 
    ? '(这是群聊刚创建，AI们可以主动打招呼、介绍自己)'
    : '(用户希望AI们主动聊聊天，可以聊最近的话题或者发起新话题)'
  
  // 3. 创建虚拟消息（不显示给用户）
  const virtualMessage = {
    content: promptHint,
    // ... 其他字段
  }
  
  // 4. 触发AI回复
  await handleAiReplies(virtualMessage)
}
```

### 提示词优化
AI会收到特殊提示，知道这是用户主动触发的：
- 空群聊：强调"打招呼、介绍自己"
- 有对话：强调"主动聊天、发起话题"

## 💡 使用建议

### 适合场景
✅ 刚创建群聊，想让AI们活跃气氛  
✅ 对话冷场，想让AI们发起新话题  
✅ 想看AI们互动聊天  
✅ 测试AI的主动性和创造力  

### 不适合场景
❌ 正在等待AI回复时（按钮已禁用）  
❌ 想回复具体问题时（应该输入内容后发送）  

## 🎯 与单聊的区别

| 特性 | 单聊 | 群聊 |
|------|------|------|
| 按钮位置 | 输入框右侧 | 输入框右侧 |
| 触发方式 | 点击或回车 | 点击或回车 |
| AI数量 | 1个AI回复 | 最多3个AI回复 |
| 回复间隔 | 无 | 2秒间隔显示 |
| 提示内容 | 单个AI的提示 | 多个AI的群聊提示 |

## 📊 效果对比

### 优化前
```
群聊只能：
- 用户发消息 → AI回复
- 无法让AI主动说话
```

### 优化后
```
群聊可以：
- 用户发消息 → AI回复
- 点击纸飞机 → AI主动说话 ✨
- 空输入框回车 → AI主动说话 ✨
```

## 🎉 总结

通过添加**AI主动回复按钮**：

✅ **体验一致**：群聊和单聊功能对齐  
✅ **操作便捷**：点击或回车即可触发  
✅ **智能切换**：自动识别有无输入  
✅ **场景适配**：空群聊和有对话分别优化  

现在群聊和单聊的体验完全一致了！🎊
