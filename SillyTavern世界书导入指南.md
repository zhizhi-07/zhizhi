# SillyTavern 世界书导入指南

## 快速导入

### 第一步：从 SillyTavern 导出

1. 打开 SillyTavern
2. 进入 World Info（世界书）
3. 点击你要导出的世界书
4. 点击"Export"按钮
5. 保存为 `.json` 文件

### 第二步：导入到本系统

1. 打开本应用的"世界书"
2. 点击"导入世界书"按钮（在空状态页面或底部）
3. 选择刚才导出的 `.json` 文件
4. 系统自动识别格式并转换
5. 导入成功！

**导入按钮位置**:
- 如果还没有世界书：中间会显示"创建世界书"和"导入世界书"两个按钮
- 如果已有世界书：底部会显示"导入世界书"按钮

---

## 自动转换说明

系统会自动识别 SillyTavern 格式并转换以下内容：

**支持的格式**:
- 标准数组格式：`"entries": [...]`
- 对象格式：`"entries": {"0": {...}, "1": {...}}`
- 字段变体：`keys` 或 `key`、`enabled` 或 `disable`

### 基本信息
| SillyTavern | 本系统 | 说明 |
|------------|--------|------|
| name | 名称 | 世界书名称 |
| description | 描述 | 世界书描述 |
| entries | 条目 | 所有条目列表 |

### 条目信息
| SillyTavern | 本系统 | 说明 |
|------------|--------|------|
| keys | 关键词 | 触发关键词列表 |
| content | 内容 | 注入的文本内容 |
| comment | 名称 | 条目名称 |
| enabled | 启用 | 是否启用 |
| priority | 优先级 | 0-999 |
| insertion_order | 插入顺序 | 排序用 |
| case_sensitive | 大小写敏感 | 匹配选项 |
| constant | 始终注入 | 触发条件 |
| selective | 选择性注入 | 触发条件 |

### 位置转换
| SillyTavern | 本系统 | 说明 |
|------------|--------|------|
| 0 | 角色后 | after_char |
| 1 | 角色前 | before_char |
| 2 | 顶部 | top |
| 3 | 底部 | bottom |

### 全局设置
| SillyTavern | 本系统 | 说明 |
|------------|--------|------|
| scan_depth | 扫描深度 | 默认 10 |
| token_budget | Token预算 | 默认 2000 |
| recursive_scanning | 递归扫描 | 默认关闭 |

---

## 概念对照表

### 关键词（Keys）
**SillyTavern 叫法**: Keys  
**本系统叫法**: 关键词  
**作用**: 触发这个条目的词语

**例子**:
```json
"keys": ["北京", "Beijing", "首都"]
```
**意思**: 当对话中出现"北京"或"Beijing"或"首都"时，这条内容就会被激活

---

### 内容（Content）
**SillyTavern 叫法**: Content  
**本系统叫法**: 内容  
**作用**: 要告诉 AI 的信息

**例子**:
```json
"content": "北京是中国的首都，有故宫、长城等名胜古迹"
```
**意思**: 当关键词被触发时，AI 会看到这段描述

---

### 优先级（Priority）
**SillyTavern 叫法**: Priority  
**本系统叫法**: 优先级  
**作用**: 决定哪些信息更重要（0-999）

**例子**:
```
900 = 超级重要（主角名字）
500 = 一般重要（配角信息）
100 = 不太重要（路人信息）
```

**通俗理解**: 
- 就像考试，重点题目优先做
- 当空间不够时，优先级高的先保留
- 优先级低的可能被舍弃

---

### 插入顺序（Insertion Order）
**SillyTavern 叫法**: Insertion Order  
**本系统叫法**: 插入顺序  
**作用**: 相同优先级时，按这个顺序排列

**例子**:
```
条目A: 优先级 500, 插入顺序 0
条目B: 优先级 500, 插入顺序 1
→ A 会排在 B 前面
```

**通俗理解**: 就像排队，号码小的先进

---

### 大小写敏感（Case Sensitive）
**SillyTavern 叫法**: Case Sensitive  
**本系统叫法**: 大小写敏感  
**作用**: 是否区分大小写

**例子**:
```
关闭: "Beijing" = "beijing" = "BEIJING" (都能匹配)
开启: "Beijing" ≠ "beijing" (必须完全一样)
```

**通俗理解**: 
- 关闭 = 不管大小写，都算对
- 开启 = 必须大小写完全一致

---

### 始终注入（Constant）
**SillyTavern 叫法**: Constant  
**本系统叫法**: 始终注入  
**作用**: 不管有没有关键词，都要告诉 AI

**例子**:
```json
"constant": true
"content": "这是一个修仙世界"
```
**意思**: 每次对话都会告诉 AI 这个信息，不需要触发关键词

**通俗理解**: 
- 就像"必读须知"
- 不管聊什么，都要记住这个

---

### 选择性注入（Selective）
**SillyTavern 叫法**: Selective  
**本系统叫法**: 选择性注入  
**作用**: 只在真正相关时才注入

**例子**:
```
关闭: 只要有关键词就注入
开启: 关键词出现 + 内容相关才注入
```

**通俗理解**: 
- 关闭 = 看到关键词就上
- 开启 = 看到关键词还要判断是不是真的需要

---

### 位置（Position）
**SillyTavern 叫法**: Position (0/1/2/3)  
**本系统叫法**: 位置（顶部/角色前/角色后/底部）  
**作用**: 信息插入到哪里

**对照**:
```
SillyTavern 0 = 本系统"角色后"
SillyTavern 1 = 本系统"角色前"
SillyTavern 2 = 本系统"顶部"
SillyTavern 3 = 本系统"底部"
```

**通俗理解**:
```
【顶部】世界观总则
【角色前】角色背景故事
角色设定
【角色后】补充信息
对话历史
【底部】可选内容
```

---

### 扫描深度（Scan Depth）
**SillyTavern 叫法**: Scan Depth  
**本系统叫法**: 扫描深度  
**作用**: 检查最近多少条消息

**例子**:
```
扫描深度 10 = 只看最近 10 条对话
如果关键词在第 11 条，就不会触发
```

**通俗理解**: 
- AI 的"短期记忆"
- 只记得最近说的话
- 太久以前的就"忘了"

---

### Token 预算（Token Budget）
**SillyTavern 叫法**: Token Budget  
**本系统叫法**: Token 预算  
**作用**: 限制使用多少"字数"

**换算**:
```
1000 tokens ≈ 1500-2000 个中文字
2000 tokens ≈ 3000-4000 个中文字
```

**通俗理解**: 
- AI 一次能看的内容有限
- 就像考试答题纸，只有这么大
- 超过了就放不下了

---

### 递归扫描（Recursive Scanning）
**SillyTavern 叫法**: Recursive Scanning  
**本系统叫法**: 递归扫描  
**作用**: 在触发的内容中继续查找关键词

**例子**:
```
第一次触发: "北京" → 内容提到"故宫"
递归扫描: 继续查找"故宫"相关的条目
```

**通俗理解**: 
- 关闭 = 只找一次
- 开启 = 找到后继续找，像套娃一样

---

## 实际例子

### SillyTavern 格式
```json
{
  "name": "修仙世界",
  "entries": [
    {
      "keys": ["境界", "修为"],
      "content": "修炼境界分为：炼气、筑基、金丹、元婴",
      "comment": "境界设定",
      "enabled": true,
      "priority": 800,
      "insertion_order": 0,
      "case_sensitive": false,
      "constant": false,
      "position": 1
    }
  ],
  "scan_depth": 10,
  "token_budget": 2000
}
```

### 转换后（本系统）
```
名称: 修仙世界
描述: 从 SillyTavern 导入

条目:
  名称: 境界设定
  关键词: 境界, 修为
  内容: 修炼境界分为：炼气、筑基、金丹、元婴
  启用: 是
  优先级: 800
  位置: 角色前
  大小写敏感: 否
  始终注入: 否

扫描深度: 10
Token预算: 2000
```

---

## 常见问题

### Q: 导入后找不到世界书？
A: 导入成功后会自动出现在世界书列表中，刷新页面即可看到

### Q: 导入失败怎么办？
A: 检查 JSON 文件是否完整，是否是从 SillyTavern 正确导出的

### Q: 可以导入 Character Card 中的世界书吗？
A: 可以！导入 Character Card 时，系统会自动提取 character_book 并转换

### Q: 导入后可以编辑吗？
A: 完全可以！导入后就是普通的世界书，可以随意编辑

### Q: 会覆盖现有世界书吗？
A: 不会！导入会创建新的世界书，不影响现有的

---

## 兼容性说明

### 完全支持
- SillyTavern 标准世界书格式
- Character Card V2 的 character_book
- 所有标准字段

### 部分支持
- extensions 扩展字段（会被忽略）
- 自定义字段（会被忽略）

### 不支持
- 图片和多媒体内容
- 脚本和代码
- 外部链接

---

## 导入后建议

1. **检查条目**: 确认所有条目都正确导入
2. **测试关键词**: 在聊天中测试是否正常触发
3. **调整优先级**: 根据需要调整优先级
4. **设置关联**: 为世界书关联角色或设为全局
5. **备份**: 导出一份备份以防万一

---

**提示**: 系统会自动识别 SillyTavern 格式，你只需要选择文件，其他的交给系统自动处理！
