# AI朋友圈功能说明

## 功能概述

AI朋友圈功能让AI角色能够：
1. **主动发布朋友圈** - AI会根据自己的性格和当前时间，自主创作并发布朋友圈内容
2. **查看用户朋友圈** - AI能够看到用户发布的朋友圈
3. **互动朋友圈** - AI会对用户的朋友圈进行点赞和评论

## 如何启用

1. 进入与AI角色的聊天页面
2. 点击右上角的"更多"按钮（三个点）
3. 选择"聊天设置"
4. 找到"AI朋友圈"选项
5. 打开开关即可启用

## 如何测试

### 方法1：使用测试按钮（推荐）

1. 进入聊天设置 → AI朋友圈
2. 点击"🧪 测试发布"按钮 - AI会立即发布一条朋友圈
3. 点击"🧪 测试互动"按钮 - AI会立即对你的朋友圈进行互动
4. 查看弹出的提示信息
5. 去朋友圈页面查看结果

### 方法2：自动运行

启用后，打开浏览器控制台（F12），你会看到以下日志：

1. **启用确认**：
   ```
   ✅ AI朋友圈功能已启用 (角色: xxx)
   ⏰ 首次检查将在 xx 秒后执行
   ```

2. **首次活动**：
   ```
   🎬 开始首次AI朋友圈活动
   🤖 xxx 正在查看朋友圈...
   📱 朋友圈总数: x, AI ID: xxx
   👤 用户发布的朋友圈数: x
   ```

3. **互动成功**：
   ```
   👍 xxx 给 xxx 的朋友圈点赞了
   或
   💬 xxx 评论了 xxx 的朋友圈: xxx
   ```

**快速测试步骤**：
1. 先发布一条自己的朋友圈
2. 启用AI朋友圈功能
3. 等待30秒-2分钟
4. 查看控制台日志
5. 刷新朋友圈页面，查看AI是否点赞或评论

## 功能特点

### 1. AI主动发布朋友圈

- **时间感知**：AI会根据当前真实时间发布合适的内容
  - 早上：可能发早安、早餐、出门等内容
  - 中午：可能发午餐、午休相关
  - 晚上：可能发晚餐、休闲活动等
  
- **性格一致**：发布的内容完全符合AI角色的性格设定
  - 活泼的角色会发更多有趣的内容
  - 高冷的角色会发简短酷酷的内容
  - 温柔的角色会发温暖治愈的内容

- **发布频率**：
  - 首次启用后，30秒-2分钟内会有第一次活动
  - 之后每5分钟检查一次
  - 20%概率发布新朋友圈
  - 至少间隔10分钟才会发布新内容

### 2. AI查看并互动朋友圈

- **智能选择**：AI会浏览用户发布的朋友圈，选择性地进行互动
- **互动方式**：
  - 点赞：对感兴趣的内容点赞
  - 评论：发表符合自己性格的评论
  - 跳过：不是所有朋友圈都会互动，保持真实感

- **互动频率**：
  - 首次启用优先查看用户朋友圈
  - 每5分钟检查一次
  - 70%概率进行互动（提高互动率）
  - 至少间隔2分钟才会进行新的互动

### 3. 评论特点

- 简短自然（5-20字）
- 符合AI角色性格
- 可能包含emoji表情
- 不会过度热情，保持真实感

## 技术实现

### 文件结构

```
src/
├── utils/
│   └── aiMomentsService.ts      # AI朋友圈核心服务
├── hooks/
│   └── useAiMoments.ts          # AI朋友圈管理Hook
├── pages/
│   └── ChatSettings.tsx         # 聊天设置页面（包含开关）
└── context/
    └── MomentsContext.tsx       # 朋友圈数据管理
```

### 核心功能

1. **aiMomentsService.ts**
   - `buildAiMomentsPrompt()` - 构建AI提示词
   - `aiPostMoment()` - AI发布朋友圈
   - `aiInteractWithMoments()` - AI批量查看并互动
   - `aiInteractWithSingleMoment()` - AI对单条朋友圈互动

2. **useAiMoments.ts**
   - 定时检查和触发AI朋友圈活动
   - 管理发布和互动的时间间隔
   - 防止重复处理

3. **ChatSettings.tsx**
   - 提供AI朋友圈功能开关
   - 保存设置到localStorage

## API调用

所有AI朋友圈功能都会调用配置的AI API：

1. **发布朋友圈**：
   - 输入：角色信息、当前时间
   - 输出：朋友圈文字内容

2. **查看朋友圈**：
   - 输入：角色信息、朋友圈列表
   - 输出：JSON格式的互动决策

3. **互动判断**：
   - 输入：角色信息、单条朋友圈
   - 输出：JSON格式的互动决策（点赞/评论/跳过）

## 注意事项

1. **API消耗**：启用此功能会增加API调用次数
2. **时间间隔**：为避免过度调用，设置了最小时间间隔
3. **随机性**：AI的行为具有随机性，不是每次都会发布或互动
4. **性格一致性**：所有行为都严格遵循角色设定

## 使用建议

1. 为AI角色设置详细的性格描述，这样发布的朋友圈会更有特色
2. 定期查看朋友圈，看看AI发布了什么有趣的内容
3. 多发布自己的朋友圈，AI会与你互动
4. 如果不需要此功能，可以随时在设置中关闭

## 未来扩展

可能的功能扩展方向：
- [ ] AI发布带图片的朋友圈
- [ ] AI回复用户对其朋友圈的评论
- [ ] 多个AI角色之间的朋友圈互动
- [ ] 自定义AI发布频率
- [ ] 朋友圈内容风格偏好设置
