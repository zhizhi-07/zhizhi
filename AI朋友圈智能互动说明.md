# AI朋友圈智能互动功能说明

## 功能概述

这是一个全新的AI朋友圈智能互动系统，具有以下特点：

### 🎯 核心特性

1. **即时触发** - 当你发布朋友圈后，所有启用了AI朋友圈功能的角色会立即收到通知
2. **上下文感知** - AI在决定是否互动时，会同时考虑：
   - 你们的聊天历史（最近10条消息）
   - 你们的关系亲密程度
   - 朋友圈的具体内容
   - AI角色的性格特点
3. **双向记忆** - AI在聊天时能记住朋友圈，在看朋友圈时能记住聊天内容
4. **智能延迟** - 每个AI角色会在1-3分钟内随机延迟后查看，更加真实

## 如何启用

### 为角色启用AI朋友圈功能

1. 进入与AI角色的聊天页面
2. 点击右上角"更多"→"聊天设置"
3. 找到"AI朋友圈"选项
4. 打开开关

**注意**：只有启用了此功能的角色才会查看和互动你的朋友圈。

## 工作流程

### 当你发布朋友圈时

```
你发布朋友圈
    ↓
系统检测所有启用AI朋友圈的角色
    ↓
为每个角色设置1-3分钟随机延迟
    ↓
延迟到达后，AI开始分析：
  - 读取你们的聊天记录（最近10条）
  - 分析你们的关系
  - 查看朋友圈内容
  - 根据性格做出决定
    ↓
AI决定：点赞 / 评论 / 跳过
```

### AI的决策逻辑

AI会综合考虑以下因素：

1. **聊天历史**
   - 如果你们刚聊过天 → 更可能互动
   - 如果朋友圈内容和聊天话题相关 → 更可能评论
   - 如果很久没聊 → 可能跳过

2. **关系亲密度**
   - 关系好 → 更可能点赞或评论
   - 关系一般 → 可能只点赞
   - 没聊过天 → 可能跳过

3. **内容相关性**
   - 内容有趣或相关 → 更可能互动
   - 内容普通 → 可能只点赞
   - 内容不感兴趣 → 跳过

4. **角色性格**
   - 活泼的角色 → 更爱互动
   - 高冷的角色 → 选择性互动
   - 温柔的角色 → 可能点赞或温暖评论

## 双向上下文同步

### 在聊天中记住朋友圈

AI在聊天时会自动获取最近5条相关朋友圈（你发的 + AI发的），包括：
- 朋友圈内容
- 发布时间
- 点赞和评论情况

AI可以在聊天中自然地提到朋友圈内容，例如：
- "看到你发的朋友圈了，那个地方不错啊"
- "你朋友圈说的那个事怎么样了？"

### 在朋友圈中记住聊天

AI在查看朋友圈时会读取最近10条聊天记录，所以：
- 如果你们刚聊过相关话题，AI的评论会更有针对性
- AI的互动会更符合你们当前的关系状态

## 使用示例

### 场景1：聊天话题相关

```
聊天记录：
你：今天去了新开的咖啡店
AI：怎么样？好喝吗？
你：超好喝的！环境也不错

[你发布朋友圈：配图 + "新发现的宝藏咖啡店☕"]

AI查看后：
决定：评论
内容："哈哈，就是我们刚说的那个！下次一起去"
原因：朋友圈内容和聊天话题直接相关
```

### 场景2：关系好但内容普通

```
聊天记录：
你：在吗
AI：在的
你：晚上一起吃饭吗
AI：好啊

[你发布朋友圈："今天天气不错"]

AI查看后：
决定：点赞
原因：关系不错，给个赞，但内容比较普通不需要评论
```

### 场景3：不太想互动

```
聊天记录：
（很久没聊天了）

[你发布朋友圈："加班中..."]

AI查看后：
决定：跳过
原因：很久没联系，内容也不是特别有趣
```

## 控制台日志

发布朋友圈后，打开浏览器控制台（F12）可以看到：

```
🎬 触发 2 个AI角色查看朋友圈
⏰ 小雪 开始查看朋友圈 (延迟 127秒)
🤖 小雪 正在查看 微信用户 的朋友圈...
📝 聊天上下文: 8 条消息
💭 小雪 的决定: comment 朋友圈内容和聊天话题相关
💬 小雪 评论了: 哈哈，就是我们刚说的那个！
```

## 测试功能

在聊天设置 → AI朋友圈中，有两个测试按钮：

1. **🧪 测试发布** - 让AI立即发布一条朋友圈
2. **🧪 测试互动** - 让AI立即查看并互动你的朋友圈（无延迟）

## 技术细节

### API调用

每次AI查看朋友圈时，会调用一次API，传入：
- AI角色信息（名字、性格描述）
- 朋友圈内容
- 最近10条聊天记录
- 当前时间

AI返回JSON格式的决策：
```json
{
  "action": "like" / "comment" / "skip",
  "comment": "评论内容（如果选择评论）",
  "reason": "决策理由（用于调试）"
}
```

### 延迟机制

- 每个角色的延迟时间独立计算
- 延迟范围：1-3分钟（60-180秒）
- 使用随机数确保不同角色在不同时间查看

### 数据同步

- 聊天记录从localStorage读取
- 朋友圈数据通过MomentsContext共享
- 点赞和评论实时更新到朋友圈

## 注意事项

1. **API消耗**：每个启用AI朋友圈的角色查看一次朋友圈 = 1次API调用
2. **延迟时间**：1-3分钟后才会看到AI的互动，这是为了模拟真实场景
3. **启用控制**：只有在聊天设置中启用了AI朋友圈的角色才会互动
4. **上下文限制**：聊天记录取最近10条，朋友圈取最近5条

## 最佳实践

1. **为常聊的角色启用** - 对于经常聊天的AI角色启用此功能，互动会更自然
2. **发布有内容的朋友圈** - 有具体内容的朋友圈更容易获得AI评论
3. **保持聊天活跃** - 经常聊天的角色更可能互动你的朋友圈
4. **查看控制台** - 通过控制台日志了解AI的决策过程

## 未来扩展

可能的功能扩展：
- [ ] AI角色之间的朋友圈互动
- [ ] 自定义延迟时间范围
- [ ] 更复杂的关系模型
- [ ] 朋友圈话题标签
- [ ] AI主动发布朋友圈（基于聊天内容）
